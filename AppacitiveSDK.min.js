try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(b,f){Object.defineProperty(this,b,{get:f,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(b,f){Object.defineProperty(this,b,{set:f,enumerable:!0,configurable:!0})}}))}catch(defPropException){}var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(a){if(!a||!a.send||"function"!=typeof a.send)throw Error("No applicable httpTransport class found");a.onResponse=this.onResponse;var c=[],e={},d=0,b={},f=0;this.addProcessor=function(a){if(a){a.pre=a.pre||function(){};a.post=a.post||function(){};var c=a.pre;d+=1;e[d]=c;a=a.post;f+=1;b[f]=a}};this.enqueueRequest=
function(a){c.push(a)};this.notify=function(){if(0!==c.length){var d=[],l;for(l in b)b.hasOwnProperty(l)&&d.push(b[l]);for(;0<c.length;){var f=c.shift(),m=[];for(l in e)e.hasOwnProperty(l)&&m.push(e[l](f));a.send(f,d,m)}}};this.onResponse=function(a){console.dir(a)}},f=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(){a()};this.onError=function(){a()}},e=null,e=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,
d=function(a,c){if("undefined"!==typeof XDomainRequest)throw Error("Appacitive doesn't support versions of IE6, IE7, IE8, IE9 due to crossdomain calls");if(!a.url)throw Error("Please specify request url");a.method||(a.method="GET");a.headers||(a.headers=[]);var d={};if(c)d=a.data;else try{a.data&&(d=a.data),d=JSON.stringify(d)}catch(b){}if(!a.onSuccess||"function"!=typeof a.onSuccess)a.onSuccess=function(){};if(!a.onError||"function"!=typeof a.onError)a.onError=function(){};var f=new e;f.onreadystatechange=
function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var e=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==e.toLowerCase()||"application/javascript"==e.toLowerCase())e=c,global.Appacitive.runtime.isBrowser||"{"!=e[0]&&(e=e.substr(1,e.length-1)),c=JSON.parse(e)}catch(d){}a.onSuccess(c,this)}else a.onError({code:this.status,message:this.statusText},this)};f.open(a.method,a.url,!0);for(var m=
0;m<a.headers.length;m+=1)f.setRequestHeader(a.headers[m].key,a.headers[m].value);global.Appacitive.runtime.isBrowser||f.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");f.send(d);return f},c=function(){var a=new f;a.isOnline=function(){return!0};var c=function(c,e,b,j){j||c.headers.push({key:"content-type",value:"application/json"});new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d){if(d){try{d=JSON.parse(d)}catch(j){}var f=d;if(e.length!=b.length)throw Error("Callback length and state length mismatch!");
for(var m=0;m<e.length;m+=1)e[m].apply({},[f,b[m]]);a.onResponse(d,c)}else a.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(e){a.onError(c,e)}})};a.send=function(a,g,e){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,g,e)};a.upload=function(a,g,e){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,g,e,!0)};return a};global.Appacitive.http=new function(){var a=new c,e=new b(a),d=!1;this.pause=
function(){d=!0};this.unpause=function(){d=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;e.addProcessor(a)};this.send=function(c){e.enqueueRequest(c);a.isOnline()&&!1==d&&e.notify()};this.flush=function(c){c?e.notify():a.isOnline()&&e.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,[c]);else a.onError(c)};a.onError=this.onError;this.onResponse=
function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[a]);else c.onSuccess(a)};a.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new d(this,a)}};var a=global;a.Appacitive&&a.Appacitive.http&&(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,
e){try{a.Appacitive.Session.isSessionValid(c)?c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(e))}catch(d){}}}),a.Appacitive.http.addProcessor({pre:function(){return(new Date).getTime()},post:function(a,c){var e=(new Date).getTime()-c;a._timeTakenInMilliseconds=e}}))})();
(function(b){String.format=function(b,e){if(1>=arguments.length)return b;for(var d=arguments.length-2,c=0;c<=d;c++)b=b.replace(RegExp("\\{"+c+"\\}","gi"),arguments[c+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var e=RegExp("^"+b),d=this;e.test(d)&&(d=d.slice(1,d.length));e=RegExp(b+"$");e.test(d)&&(d=d.slice(0,-1));return d};String.toSearchString=function(b){"undefined"==typeof b&&(b="");for(var e=
"",d=0;d<b.length;d+=1)-1==" .,;#".indexOf(b[d])&&(e+=b[d]);return e=e.toLowerCase()};String.contains=function(b,e){return-1!=b.indexOf(e)};String.startsWith=function(b,e){return 0==b.indexOf(e)};Array.distinct=function(b){var e=[],d=b.length,c,a,g;for(a=0;a<d;a++){c=void 0;for(g=0;g<e.length;g++)if(b[a].toLowerCase()===e[g].toLowerCase()){c=!0;break}c||e.push(b[a])}return e};b.dateFromWcf=function(b,e){var d=/Date\(([^)]+)\)/.exec(b);if(2!=d.length){if(!e)return s;throw Error(s+" is not .net json date.");
}return new Date(parseFloat(d[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var f=function(e){if("object"==typeof e&&0<e.length&&("string"==typeof e[0]||"number"==typeof e[0]))e=e.join(",");e||(e="");return e};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(e){return String.format("{0}/create?fields={1}",
this.userServiceUrl,f(e))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(e,b){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,e,f(b))},getUserByTokenUrl:function(e){return string.format("{0}/me?useridtype=token&token=",this.userServiceUrl,e)},getUserByUsernameUrl:function(e){return string.format("{0}/{1}?useridtype=username",this.userServiceUrl,e)},getUpdateUrl:function(e,b){return String.format("{0}/{1}?fields={2}",
this.userServiceUrl,e,f(b))},getDeleteUrl:function(e){return String.format("{0}/{1}",this.userServiceUrl,e)},getGetAllLinkedAccountsUrl:function(e){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,e)},getValidateTokenUrl:function(e){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,e)},getInvalidateTokenUrl:function(e){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,e)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",
this.userServiceUrl)},getUpdatePasswordUrl:function(e){return String.format("{0}/{1}/changepassword",this.userServiceUrl,e)},getLinkAccountUrl:function(e){return String.format("{0}/{1}/link",this.userServiceUrl,e)},getDelinkAccountUrl:function(e,b){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,e,b)},getCheckinUrl:function(e,b,c){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,e,b,c)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(e){return String.format("{0}/register?fields={1}",
this.deviceServiceUrl,f(e))},getGetUrl:function(e,b){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,e,f(b))},getUpdateUrl:function(e,b){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,e,f(b))},getDeleteUrl:function(e){return String.format("{0}/{1}",this.deviceServiceUrl,e)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(e,b,c){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,e),a=c?a+"?psize="+c:a+"?psize=10";if("undefined"!==
typeof b&&0<b.length)for(e=0;e<b.length;e+=1)0!=b[e].trim().length&&(a=a+"&"+b[e]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(e,b){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,e,b)},getMultiGetUrl:function(b,d,c){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.articleServiceUrl,b,d,f(c))},getCreateUrl:function(b,d){return String.format("{0}/{1}?fields={2}",
this.articleServiceUrl,b,f(d))},getGetUrl:function(b,d,c){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,d,f(c))},getUpdateUrl:function(b,d,c){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,d,f(c))},getDeleteUrl:function(b,d){return String.format("{0}/{1}/{2}",this.articleServiceUrl,b,d)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,
d,c){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,d,f(c))},getMultiGetUrl:function(b,d,c){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,d,f(c))},getCreateUrl:function(b,d){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,f(d))},getUpdateUrl:function(b,d,c){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,d,f(c))},getDeleteUrl:function(b,d){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,
b,d)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,d,c,a){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,c,d);if("undefined"!==typeof a&&0<a.length)for(b=0;b<a.length;b+=1)g=g+"&"+a[b];return g},getConnectedArticles:function(b,d,c){var a="",a=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,b,d);if(c&&c.length&&0<c.length)for(b=0;b<c.length;b+=1)a=0==
b?a+("?"+c[b]):a+("&"+c[b]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,d){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,d)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},
getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,d){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,
escape(d))},getDownloadUrl:function(b,d){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,d)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var d=[];return""==location.search||-1==location.search.indexOf("?")?d:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(c,a){var g=a.split("="),j=g[1];2<g.length&&g.forEach(function(a){0==a||1==a||(j=j+"="+g[a])});g[0].toLowerCase()==
b&&(d=[g[0],j])}),d):location.search.split("?")[1].split("=")}}}})(global);
(function(b){b.Appacitive.eventManager=new function(){var b={};this.subscribe=function(e,d){if("string"!=typeof e||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof b[e]&&(b[e]=[]);var c;c=function(){return Math.floor(65536*Math.random()).toString(16)};c=c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c();b[e].push({callback:d,id:c});return c};this.unsubscribe=function(e){if(!e)return!1;var d=-1,c=null,a;for(a in b)for(var g=0;g<b[a].length;g+=1)if(b[a][g].id==e){d=g;
c=a;break}return-1!=d?(b[c].splice(d,1),!0):!1};this.fire=function(e,d,c){if("string"!=typeof e)throw Error("Incorrect fire call");if("undefined"==typeof c||null===c)c={};c.eventName=e;if("undefined"!=typeof b.all)for(var a=0;a<b.all.length;a+=1)b.all[a].callback(d,c);a=function(a,c,b){setTimeout(function(){a(c,b)},0)};if("undefined"!=typeof b[e])for(var g=0;g<b[e].length;g+=1)a(b[e][g].callback,d,c)};this.clearSubscriptions=function(e){if("string"!=typeof e)throw Error("Event Name must be string in EventManager.clearSubscriptions");
b[e]&&(b[e].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(b)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"}})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var f=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},e=null,d=null,c=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){b.Appacitive.Session.create(null)};this.create=function(a,c){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var g=new f;g.apikey=d;var k=new b.Appacitive.HttpRequest;k.url=b.Appacitive.config.apiBaseUrl+"application.svc/session";
k.method="put";k.data=g;k.onSuccess=function(g){g&&g.status&&"200"==g.status.code?(e=g.session.sessionkey,b.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(g),b.Appacitive.Session.onSessionCreated()):c&&"function"==typeof c&&c(g)};k.onError=c;b.Appacitive.http.send(k)};b.Appacitive.http.addProcessor({pre:function(g){b.Appacitive.Session.useApiKey?g.headers.push({key:"appacitive-apikey",value:d}):g.headers.push({key:"appacitive-session",value:e});!0===a&&(1==g.headers.filter(function(a){return"appacitive-user-auth"==
a.key}).length?g.headers.forEach(function(a){"appacitive-user-auth"==a.key&&(a.value=c)}):g.headers.push({key:"appacitive-user-auth",value:c}))}});this.setUserAuthHeader=function(g,d,e){try{g&&(a=!0,c=g,e||(d||(d=60),-1==d&&(d=null),b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.setCookie("Appacitive-UserToken",g,d),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",d?d:-1,d))))}catch(f){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(g,d){g&&("function"!=typeof g&&
"boolean"==typeof g)&&(d=g,g=function(){});a=!1;g=g||function(){};b.Appacitive.localStorage.remove("Appacitive-User");b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(c&&!d)try{var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(c);c=null;e.method="POST";e.data={};e.onSuccess=function(){"function"==typeof g&&g()};b.Appacitive.http.send(e)}catch(f){}else c=
null,"function"==typeof g&&g()};this.isSessionValid=function(a){if(!a)return!0;if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){e=null;this.useApiKey=!0};this.get=function(){return e};this.setSession=function(a){a&&(e=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(d=a,this.useApiKey=!0)};var g="sandbox";this.__defineGetter__("environment",function(){return g});
this.__defineSetter__("environment",function(a){"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a})};b.Appacitive.initialize=function(f){if(!b.Appacitive.Session.initialized){if(!f.apikey||0==f.apikey.length)throw Error("apikey is mandatory");b.Appacitive.Session.setApiKey(f.apikey);b.Appacitive.Session.environment=f.env||"sandbox";b.Appacitive.useApiKey=!0;b.Appacitive.Session.initialized=!0;if(f.userToken)-1==f.expiry?f.expiry=null:f.expiry||(f.expiry=3600),b.Appacitive.Session.setUserAuthHeader(f.userToken,
f.expiry),f.user?b.Appacitive.Users.setCurrentUser(f.user):(f=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(f);else if(b.Appacitive.runtime.isBrowser){var e=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(e){var d=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");d||(d=60);(f=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(f,e,d)}}}}})(global);
(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(f){f.headers.push({key:"appacitive-environment",value:b.Appacitive.Session.environment})}})})(global);
(function(b){b.Appacitive.Queries={};var f=function(c){c=c||{};var a=1,b=200;this.__defineGetter__("pageNumber",function(){return a});this.__defineSetter__("pageNumber",function(c){a=c||1});this.__defineGetter__("pageSize",function(){return b});this.__defineSetter__("pageSize",function(a){b=a||200});this.pageNumber=c.pageNumber;this.pageSize=c.pageSize};f.prototype.toString=function(){return"psize="+this.pageSize+"&pnum="+this.pageNumber};var e=function(c){c=c||{};var a="__UtcLastUpdatedDate",b=!1;
this.__defineGetter__("orderBy",function(){return a});this.__defineSetter__("orderBy",function(c){a=c||"__UtcLastUpdatedDate"});this.__defineGetter__("isAscending",function(){return b});this.__defineSetter__("isAscending",function(a){b="undefined"==typeof a?!1:a});this.orderBy=c.orderBy;this.isAscending=c.isAscending};e.prototype.toString=function(){return"orderBy="+this.orderBy+"&isAsc="+this.isAscending};var d=function(c){var a=c||{},g="",d="",h="",l=a.queryType||"BasicQuery",k=new f(c),m=new e(c),
n=a.schema||a.relation,p=a.relation?"connection":"article";this.__defineGetter__("type",function(){return p});this.__defineGetter__("entityType",function(){return n});this.__defineGetter__("queryType",function(){return l});this.__defineGetter__("pageQuery",function(){return k});this.__defineGetter__("pageNumber",function(){return k.pageNumber});this.__defineSetter__("pageNumber",function(a){k.pageNumber=a});this.__defineGetter__("pageSize",function(){return k.pageSize});this.__defineSetter__("pageSize",
function(a){k.pageSize=a});this.__defineGetter__("sortQuery",function(){return m});this.__defineGetter__("orderBy",function(){return m.orderBy});this.__defineSetter__("orderBy",function(a){m.orderBy=a});this.__defineGetter__("isAscending",function(){return m.isAscending});this.__defineSetter__("isAscending",function(a){m.isAscending=a});this.__defineGetter__("filter",function(){return g});this.__defineSetter__("filter",function(a){g=a});this.__defineGetter__("freeText",function(){return d});this.__defineSetter__("freeText",
function(a){"string"==typeof a?d=a:"object"==typeof a&&a.length&&(d=a.join(" "))});this.__defineGetter__("fields",function(){return h});this.__defineSetter__("fields",function(a){"string"==typeof a?h=a:"object"==typeof a&&a.length&&(h=a.join(","))});this.filter=a.filter||"";this.freeText=a.freeText||"";this.fields=a.fields||"";this.setFilter=function(a){this.filter=a};this.setFreeText=function(a){this.freeText=a};this.setFields=function(a){this.fields=a};this.extendOptions=function(c){for(var b in c)a[b]=
c[b];k=new f(a);m=new e(a);return this};this.getQueryString=function(){var a=this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(a+="&query="+this.filter);this.freeText&&0<this.freeText.trim().length&&(a+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(a+="&fields="+this.fields);return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+p+"/"+n+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=
new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},c;for(c in this)this.hasOwnProperty(c)&&"function"!=typeof this[c]&&(a[c]=this[c]);return a};this.fetch=function(a,c){var g=this.toRequest();g.onSuccess=function(g){if(g&&g.status&&"200"==g.status.code){if("function"==typeof a){var d=g[p+"s"],e=[];d||(d=[]);var l="article"==p?"Article":"Connection";d.forEach(function(a){e.push(new b.Appacitive[l](a,!0))});a(e,g.paginginfo)}}else g=g||{},"function"==
typeof c&&c(g.status||{message:"Server error",code:400})};g.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(g);return this};this.count=function(a,c){a=a||function(){};c=c||function(){};var g=k.pageSize,d=k.pageNumber;k.pageSize=1;k.pageNumber=999999999;var e=this,l=this.toRequest();l.onSuccess=function(b){k.pageSize=g;k.pageNumber=d;b=b||{};var l=b.paginginfo,h=0;if(l)h=l.totalrecords;else if(b.status&&b.status.code&&"200"==
b.status.code)h=0;else{b=b.status||{message:"Server error",code:400};"function"==typeof c&&c(b,e);return}"function"==typeof a&&a(h)};l.onError=function(a){k.pageSize=g;k.pageNumber=d;a=a||{message:"Server error",code:400};"function"==typeof c&&c(a,e)};b.Appacitive.http.send(l);return this}};b.Appacitive.Queries.FindAllQuery=function(c){c=c||{};if(!c.schema&&!c.relation||c.schema&&c.relation)throw Error("Specify either schema or relation for basic filter query");c.queryType="BasicFilterQuery";d.call(this,
c);return this};b.Appacitive.Queries.FindAllQuery.prototype=new d;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedArticlesQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for connected articles query");if(!c.articleId)throw Error("Specify articleId for connected articles query");c.schema&&delete c.schema;c.queryType="ConnectedArticlesQuery";d.call(this,c);this.articleId=c.articleId;this.relation=c.relation;
this.label="";c.label&&("string"==typeof c.label&&0<c.label.length)&&(this.label="&label="+c.label);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.ConnectedArticlesQuery.prototype=new d;b.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=b.Appacitive.Queries.ConnectedArticlesQuery;
b.Appacitive.Queries.GetConnectionsQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!c.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!c.label||0==c.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");c.schema&&delete c.schema;c.queryType="GetConnectionsQuery";d.call(this,c);this.articleId=c.articleId;this.relation=c.relation;this.label=c.label;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;
a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+this.getQueryString()};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new d;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(c,a){c=c||{};if(!c.articleAId||"string"!=typeof c.articleAId||
0==c.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!c.articleBId||"string"!=typeof c.articleBId||0==c.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");c.schema&&delete c.schema;c.queryType=a||"GetConnectionsBetweenArticlesQuery";d.call(this,c);this.articleAId=c.articleAId;this.articleBId=c.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"==this.queryType&&c.label&&"string"==
typeof c.label&&0<c.label.length?"&label="+c.label:"";this.relation=c.relation&&"string"==typeof c.relation&&0<c.relation.length?c.relation+"/":"";this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=
new d;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(a,c){this.toUrl();var d=this.toRequest();
d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"==typeof a&&a(new b.Appacitive.Connection(d.connection)):(d=d||{},"function"==typeof c&&c(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};return c};b.Appacitive.Queries.InterconnectsQuery=function(c){c=c||{};if(!c.articleAId||"string"!=typeof c.articleAId||0==c.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");
if(!c.articleBIds||"object"!=typeof c.articleBIds||!(0<c.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");c.schema&&delete c.schema;c.queryType="InterconnectsQuery";d.call(this,c);this.articleAId=c.articleAId;this.articleBIds=c.articleBIds;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+
"connection/interconnects?"+this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new d;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphQuery=function(c){c=c||{};if(!c.graphQuery)throw Error("graphQuery object is mandatory");this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=b.Appacitive.config.apiBaseUrl;a.url+=b.Appacitive.storage.urlFactory.article.getProjectionQueryUrl();
a.method="post";a.data=c.graphQuery;return a}}})(global);
(function(b){b.Appacitive.BaseObject=function(f,e){var d={},c=function(a,c){for(var b in a)if("string"==typeof a[b])c[b]=a[b];else if("object"==typeof a[b]){c[b]=0<=a[b].length?[]:{};for(var g in a[b])c[b][g]=a[b][g]}else c[b]=a[b]},a={};c(f,a);e&&c(a,d);!d.__id&&a.__id&&(d.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.__defineGetter__("cid",function(){return g});var j="__revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),h=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=
function(){return JSON.parse(JSON.stringify(a))};this.toJSON=function(){return a};this.__defineGetter__("id",function(){return this.get("__id")});this.__defineSetter__("id",function(a){this.set("__id",a)});a.__attributes||(a.__attributes={});d.__attributes||(d.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==
typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var k=function(){var c=!1,b=JSON.parse(JSON.stringify(d.__attributes)),g;for(g in a.__attributes)"undefined"==typeof a.__attributes[g]||null===a.__attributes[g]?(b[g]=null,c=!0):a.__attributes[g]!=
d.__attributes[g]?(b[g]=a.__attributes[g],c=!0):a.__attributes[g]==d.__attributes[g]&&delete b[g];return!c?null:b};this.getChangedAttributes=k;this.aggregates=function(){var c={},b;for(b in a){if(!a.hasOwnProperty(b))return;"$"==b[0]&&(c[b]=a[b])}if(0===arguments.length)return c;if(1==arguments.length)return c[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var m=[];a.__tags||(a.__tags=[]);d.__tags||(d.__tags=[]);this.__defineGetter__("tags",
function(){return!a.__tags?[]:a.__tags});this.addTag=function(c){if(!c||"string"!=typeof c||!c.length)return this;a.__tags.push(c);a.__tags=Array.distinct(a.__tags);if(!m||!m.length)return this;c=m.indexOf(c);-1!=c&&m.splice(c,1);return this};this.removeTag=function(c){if(!c||"string"!=typeof c||!c.length)return this;m.push(c);m=Array.distinct(m);if(!a.__tags||!a.__tags.length)return this;c=a.__tags.indexOf(c);-1!=c&&a.__tags.splice(c,1);return this};var n=function(){var c=[];a.__tags.every(function(a){-1==
d.__tags.indexOf(a)&&c.push(a)});return c};this.getChangedTags=n;this.getRemovedTags=function(){return _removetags};var p=function(c){var b=!1,g=JSON.parse(JSON.stringify(d)),e;for(e in a)"undefined"==typeof a[e]||null===a[e]?(g[e]=null,b=!0):a[e]!=d[e]?"__tags"==e||"__attributes"==e?delete g[e]:(g[e]=a[e],b=!0):a[e]==d[e]&&delete g[e];try{j.forEach(function(a){g[a]&&delete g[a]})}catch(l){}c?(a.__tags&&0<a.__tags.length&&(g.__addtags=n(),b=!0),m&&0<m.length&&(g.__removetags=m,b=!0)):a.__tags&&0<
a.__tags.length&&(g.__tags=n(),b=!0);(c=k())?(g.__attributes=c,b=!0):delete g.__attributes;return b?g:!1};this.__defineGetter__("changed",function(){return p()});this.hasChanged=function(){var a=p(!0);return 0===arguments.length?a?!0:!1:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=p(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var c={};
arguments[0].forEach(function(b){a[b]&&c.push(a[b])});return c}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&arguments[0].length?d[arguments[0]]:null};this.previousAttributes=function(){return d};var q="";this.__defineGetter__("fields",function(){return q});this.__defineSetter__("fields",function(a){"string"==typeof a?q=a:"object"==typeof a&&a.length&&(q=a.join(","))});this.get=function(c){if(c)return a[c]};this.set=function(c,b){if(!c||"string"!=typeof c||
0==c.length)return this;null==b||"undefined"==b?a[c]=null:"string"==typeof b?a[c]=b:"number"==typeof b?a[c]=b+"":"object"==typeof b&&(0<=b.length?a[c]=b:-1!==h.indexOf(c)&&(a[c]=b));return this};this.unset=function(c){if(!c||"string"!=typeof c||0==c.length||0==c.indexOf("__"))return this;try{delete a[c]}catch(b){}return this};this.has=function(c){return!c||"string"!=typeof c||0==c.length?!1:a[c]&&"undefined"!=typeof a[c]?!0:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=
function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(b){b&&c(b,a);return this};this.save=function(c,b){a.__id?t.apply(this,arguments):r.apply(this,arguments);return this};var r=function(g,e){g=g||function(){};e=e||function(){};var h=this,j=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,q);if(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))j=
b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl();var f=new b.Appacitive.HttpRequest;f.url=j;f.method="put";a.__revision&&delete a.__revision;f.data=a;f.onSuccess=function(f){var j=null;if(f&&(f.article||f.connection||f.user||f.device))j=f.article||f.connection||f.user||f.device;f&&j?(d=j,a.__id=j.__id,c(j,a),h.connectionCollections&&0<h.connectionCollections.length&&h.connectionCollections.forEach(function(c){c.getQuery().extendOptions({articleId:a.__id})}),
"connection"==h.type&&h.parseConnection(),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".created",h,{object:h}),"function"==typeof g&&g(h)):(f=f||{},f.status=f.status||{},f.status=l(f.status),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".createFailed",h,{error:f.status}),"function"==typeof e&&e(f.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this},t=function(g,e){g=g||function(){};e=e||function(){};
var h=p(!0),f=this;if(h){var j=new b.Appacitive.HttpRequest,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||a.__relationtype,d.__id?d.__id:a.__id,q);if(a&&a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(d.__id);j.url=k;j.method="post";j.data=h;j.onSuccess=function(h){h&&(h.article||h.connection||
h.user||h.device)?(d=h.article||h.connection||h.user||h.device,c(d,a),m=[],b.Appacitive.eventManager.fire((f.schema||f.relation)+"."+f.type+"."+a.__id+".updated",f,{object:f}),"function"==typeof g&&g(f)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((f.schema||f.relation)+"."+f.type+"."+a.__id+".updateFailed",f,{object:h.status}),"function"==typeof e&&e(h.status,f))};j.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==
typeof e&&e(a,f)};b.Appacitive.http.send(j)}else"function"==typeof g&&g(f);return this};this.fetch=function(g,e){g=g||function(){};e=e||function(){};if(a.__id){var h=this,f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,q),j=new b.Appacitive.HttpRequest;j.url=f;j.method="get";j.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(d=b.article||b.connection||b.user||b.device,c(d,a),h.___collection&&"article"==
h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof g&&g(h)):(b=b||{},b.status=b.status||{},b.status=l(b),"function"==typeof e&&e(b.status,h))};j.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(j);return this}"function"==typeof e&&e({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,d,e){if(!a.__id&&this.___collection)this.___collection.removeByCId(g),"function"==typeof c&&c(this);else{c=c||function(){};
d=d||function(){};var h=this,f=b.Appacitive.config.apiBaseUrl,f=f+b.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);if(a&&a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))f=b.Appacitive.config.apiBaseUrl,f+=b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id);e&&!0===e&&(f=-1==f.indexOf("?")?f+"?deleteconnections=true":f+"&deleteconnections=true");e=new b.Appacitive.HttpRequest;
e.url=f;e.method="delete";e.onSuccess=function(b){"200"==b.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof c&&c(b)):(b=l(b),"function"==typeof d&&d(b,h))};e.onError=function(a){a=l(a);"function"==typeof d&&d(a,h)};b.Appacitive.http.send(e)}}};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var f=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f(),d="",c,a,g,j,h,l,k=0,b=b.replace(/\r\n/g,"\n");a="";for(g=0;g<b.length;g++)j=b.charCodeAt(g),128>j?a+=String.fromCharCode(j):(127<j&&2048>j?a+=String.fromCharCode(j>>6|192):(a+=String.fromCharCode(j>>12|224),a+=String.fromCharCode(j>>6&63|128)),a+=String.fromCharCode(j&63|128));for(b=a;k<b.length;)c=b.charCodeAt(k++),a=b.charCodeAt(k++),
g=b.charCodeAt(k++),j=c>>2,c=(c&3)<<4|a>>4,h=(a&15)<<2|g>>6,l=g&63,isNaN(a)?h=l=64:isNaN(g)&&(l=64),d=d+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return d.toString()}})(global);
(function(b){b.Appacitive.ArticleCollection=function(f){var e=null,d=null,c=[],a={};"string"==typeof f?a.schema=f:a=f;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var e=a.schema,g=this;f=function(c){c.type="article";c.schema?e=c.schema:c.schema=e;d=new b.Appacitive.Queries.FindAllQuery(c);a=c;g.extendOptions=d.extendOptions};this.setFilter=function(c){a.filter=c;a.type="article";d?d.filter=c:(d=new b.Appacitive.Queries.FindAllQuery(a),
g.extendOptions=d.extendOptions);return this};this.setFreeText=function(c){!c&&0==c.trim().length&&(a.freeText="");a.freeText=c;a.type="article";d?d.freeText=c:(d=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=d.extendOptions);return this};this.setFields=function(c){c||(a.fields="");a.fields=c;a.type="article";d?d.fields=c:(d=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=d.extendOptions);return this};this.reset=function(){e=a=null;c.length=0;d=null};this.__defineGetter__("query",
function(){return d});this.getQuery=function(){return d};var j=["BasicFilterQuery"];this.__defineSetter__("query",function(a){if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==j.indexOf(a.queryType))throw Error("ArticleCollection only accepts "+j.join(", "));c.length=0;d=a});this.setQuery=function(a){this.query=a;return this};this.setOptions=f;f(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=c.length?
null:c.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=e)throw Error("Null article passed or schema type mismatch");var b=null;c.forEach(function(c,g){c.get("__id")==a.get("__id")&&(b=g)});null!=b?c.splice(b,1):c.push(a);return this};this.getArticleById=function(a){var b=c.filter(function(c){return c.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(c)};this.getAllArticles=function(){return Array.prototype.slice.call(c).map(function(a){return a.getArticle()})};
this.removeById=function(a){if(!a)return!1;var b=null;c.forEach(function(c,g){c.getArticle().__id&&c.getArticle().__id==a&&(b=g)});null!==b&&c.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;c.forEach(function(c,g){c.cid&&c.cid==a&&(b=g)});null!==b&&c.splice(b,1);return this};this.fetch=function(a,b){c.length=0;this.query.fetch(function(b,d){var e=b;if(!e.length||0===e.length)e=[];e.forEach(function(a){a.___collection=g;c.push(a)});"function"==typeof a&&a(d,g)},function(a){"function"==
typeof b&&b(a,g)});return this};this.count=function(a,c){this.query.count(a,c);return this};this.fetchByPageNumber=function(a,c,b){d.getOptions().pageQuery.pageNumber=b;this.fetch(a,c);return this};this.fetchNextPage=function(a,c){d.getOptions().pageQuery.pageNumber+=1;this.fetch(a,c);return this};this.fetchPreviousPage=function(a,c){var b=d.getOptions().pageQuery;b.pageNumber-=1;0===b.pageNumber&&(b.pageNumber=1);this.fetch(a,c);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=
e;a=new b.Appacitive.Article(a);a.___collection=g;c.push(a);return a};this.map=function(){return c.map.apply(this,arguments)};this.forEach=function(){return c.forEach.apply(this,arguments)};this.filter=function(){return c.filter.apply(this,arguments)}};b.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};b.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};b.Appacitive.ArticleCollection.prototype.__defineGetter__("articles",
function(){return this.getAll()});b.Appacitive.ArticleCollection.prototype.__defineGetter__("length",function(){return this.articles.length})})(global);
(function(b){b.Appacitive.ConnectionCollection=function(f){var e=null,d=null,c=[],a=[],g={};"string"==typeof f?g.relation=f:g=f;this.collectionType="connection";var j=this;if(!f||!f.relation)throw Error("Must provide relation while initializing ConnectionCollection.");e=f.relation;f=function(a){a.type="connection";a.relation?e=a.relation:a.relation=e;d=new b.Appacitive.Queries.FindAllQuery(a);g=a;return j};this.setFilter=function(a){g.filter=a;g.type="connection";d?d.filter=a:(d=new b.Appacitive.Queries.FindAllQuery(g),
j.extendOptions=d.extendOptions);return this};this.setFreeText=function(a){!a&&0==a.trim().length&&(g.freeText="");g.freeText=a;g.type="connection";d?d.freeText=a:(d=new b.Appacitive.Queries.FindAllQuery(g),j.extendOptions=d.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";d?d.fields=a:(d=new b.Appacitive.Queries.FindAllQuery(g),j.extendOptions=d.extendOptions);return this};this.__defineGetter__("query",function(){return d});this.getQuery=function(){return d};
var h=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.__defineSetter__("query",function(b){if(!b||!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==h.indexOf(b.queryType))throw Error("ConnectionCollection only accepts "+h.join(", "));a.length=0;c.length=0;d=b});this.setQuery=function(a){this.query=a;return this};this.reset=function(){e=g=null;a.length=0;c.length=0;d=null};this.setOptions=
f;f(g);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=c.length?null:c.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=e)throw Error("Null connection passed or relation type mismatch");var b=null;c.forEach(function(c,g){c.get("__id")==a.get("__id")&&(b=g)});null!==b?c.splice(b,1):c.push(a);return this};this.getConnection=function(a){var b=c.filter(function(c){return c.get("__id")==a});return 1==b.length?b[0]:null};
this.getAll=function(){return Array.prototype.slice.call(c)};this.getAllConnections=function(){return Array.prototype.slice.call(c).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;c.forEach(function(c,g){c.getConnection().__id&&c.getConnection().__id==a&&(b=g)});null!==b&&c.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;c.forEach(function(c,g){c.cid&&c.cid==a&&(b=g)});null!==b&&c.splice(b,1);return this};this.getConnectedArticle=
function(c){if(!a||0===a.length)return null;var b=a.filter(function(a){return a.get("__id")==c});return 0<b.length?b[0]:null};this.fetch=function(b,g){c.length=0;this.query.fetch(function(g,e){var f=g;"GetConnectionsBetweenArticlesForRelationQuery"==d.queryType&&(f=[f]);if(!f.length||0===f.length)f=[];f.forEach(function(b){b.___collection=j;if(b.endpointA.article||b.endpointB.article){var g=b.endpointA.article||b.endpointB.article;g.___collection=j;a.push(g)}try{b.___collection.connectedArticle||
delete b.connectedArticle}catch(d){}c.push(b)});"function"==typeof b&&b(e,j)},function(a){"function"==typeof g&&g(a,j)});return this};this.count=function(a,c){this.query.count(a,c);return this};this.fetchByPageNumber=function(a,c,b){d.getOptions().pageQuery.pageNumber=b;this.fetch(a,c);return this};this.fetchNextPage=function(a,c){d.getOptions().pageQuery.pageNumber+=1;this.fetch(a,c);return this};this.fetchPreviousPage=function(a,c){var b=d.getOptions().pageQuery;b.pageNumber-=1;0===b.pageNumber&&
(b.pageNumber=1);this.fetch(a,c);return this};this.createNewConnection=function(a){a=a||{};a.__relationtype=e;a=new b.Appacitive.Connection(a);a.___collection=j;c.push(a);return a};this.map=function(){return c.map.apply(this,arguments)};this.forEach=function(a,b){return c.forEach(a,b||this)};this.filter=function(){return c.filter.apply(this,arguments)}}})(global);
(function(b){var f=function(e,d){e=e||function(){};d=d||function(){};var c=new b.Appacitive.HttpRequest;c.method="get";c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));c.onSuccess=function(a){var c=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(c=a[0].username));null!==c?FB.api("/"+c,function(a){a?e(a):d()}):d({code:"404",message:"fb account not found"})};
c.onError=d;b.Appacitive.http.send(c)};b.Appacitive.Article=function(e,d){e=e||{};"string"==typeof e&&(e={__schematype:e});if(!e.__schematype&&!e.schema)throw Error("Cannot set article without __schematype");e.schema&&(e.__schematype=e.schema,delete e.schema);b.Appacitive.BaseObject.call(this,e,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=f);return this};b.Appacitive.Article.prototype=new b.Appacitive.BaseObject;
b.Appacitive.Article.prototype.constructor=b.Appacitive.Article;b.Appacitive.Article.prototype.getConnections=function(e){if("article"!=this.type)return null;e=e||{};e.articleId=this.get("__id");var d=new b.Appacitive.ConnectionCollection({relation:e.relation});this.connectionCollections.push(d);d.query=new b.Appacitive.Queries.GetConnectionsQuery(e);return d};b.Appacitive.Article.prototype.getConnectedArticles=function(e){e=e||{};"string"==typeof e&&(rName=e,e={relation:rName});e.articleId=this.get("__id");
var d=new b.Appacitive.ConnectionCollection({relation:e.relation});d.connectedArticle=this;this.connectionCollections.push(d);d.query=new b.Appacitive.Queries.ConnectedArticlesQuery(e);return d};b.Appacitive.Article.multiDelete=function(e,d,c){e=e||{};if(!e.schema||"string"!=typeof e.schema||0==e.schema.length)throw Error("Specify valid schema");if("user"==e.schema.toLowerCase()||"device"==e.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(e.ids&&0<e.ids.length){d=
d||function(){};c=c||function(){};var a=new b.Appacitive.HttpRequest;a.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(e.schema);a.method="post";a.data={idlist:e.ids};a.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d():(a=a||{},"function"==typeof c&&c(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(a)}else d()};b.Appacitive.Article.multiGet=
function(e,d,c){e=e||{};if(!e.schema||"string"!=typeof e.schema||0==e.schema.length)throw Error("Specify valid schema");if(e.ids&&0<e.ids.length){var a=new b.Appacitive.HttpRequest;a.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(e.schema,e.ids.join(","),e.fields);a.method="get";a.onSuccess=function(a){if(a&&a.articles){if("function"==typeof d){var e=[];a.articles.forEach(function(a){e.push(new b.Appacitive.Article(a))});d(e,a.paginginfo)}}else a=a||{},"function"==
typeof c&&c(a.status||{message:"Server error",code:400})};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof c&&c(a)};b.Appacitive.http.send(a)}else"function"==typeof d&&d([])};b.Appacitive.Article.get=function(e,d,c){e=e||{};if(!e.schema)throw Error("Specify schema");if(!e.id)throw Error("Specify id to fetch");var a={},a="user"==e.schema.toLowerCase()?new b.Appacitive.User({__id:e.id}):new b.Appacitive.Article({__schematype:e.schema,__id:e.id});a.fields=e.fields;a.fetch(d,
c);return a}})(global);
(function(b){var f=function(c,a,g){var d={label:c.label};c.articleid&&(d.articleid=c.articleid);if(c.article)"function"==typeof c.article.getArticle?c.article.get("__id")?d.articleid=c.article.get("__id"):d.article=c.article.getArticle():"object"==typeof c.article&&c.article.__schematype&&(c.article.__id?d.articleid=c.article.__id:d.article=c.article,c.article=new b.Appacitive.Article(c.article));else if(!d.articleid&&!d.article)throw Error("Incorrectly configured endpoints provided to setupConnection");g["endpoint"+
a]=c;return d},e=function(c,a,g){c.article&&"object"==typeof c.article?(g["endpoint"+a]?g["endpoint"+a]&&g["endpoint"+a].article&&g["endpoint"+a].article.getArticle?g["endpoint"+a].article.copy(c.article):g["endpoint"+a].article=new b.Appacitive.Article(c.article):(g["endpoint"+a]={},g["endpoint"+a].article=new b.Appacitive.Article(c.article)),g["endpoint"+a].articleid=c.articleid,g["endpoint"+a].label=c.label,g["endpoint"+a].type=c.type,g["endpoint"+a].article.___collection=g.___collection):g["endpoint"+
a]=c};b.Appacitive.Connection=function(c,a){c=c||{};"string"==typeof c&&(c={__relationtype:c});if(!c.__relationtype&&!c.relation)throw new error("Cannot set connection without relation");c.relation&&(c.__relationtype=c.relation,delete c.relation);c.endpoints&&2==c.endpoints.length&&(c.__endpointa=c.endpoints[0],c.__endpointb=c.endpoints[1],delete c.endpoints);b.Appacitive.BaseObject.call(this,c);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var a="A",b="B";
if(c.__endpointa.label==this.get("__endpointb").label&&c.__endpointa.label!=c.__endpointb.label&&(c.__endpointa.articleid==this.get("__endpointb").articleid||!c.__endpointa.articleid))a="B",b="A";e(this.get("__endpointa"),a,this);e(this.get("__endpointb"),b,this);this.__defineGetter__("endpoints",function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a});return this};a?(this.__defineGetter__("connectedArticle",function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var c=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(c=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(c)}),this.parseConnection(c)):c.__endpointa&&c.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.prototype.setupConnection=function(c,a){if(!c||!c.articleid&&!c.article||!c.label||!a||!a.articleid&&!a.article||!a.label)throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",f(c,"A",this));this.set("__endpointb",f(a,"B",this))};b.Appacitive.Connection.get=function(c,a,g,d){options=options||{};if(!options.relation)throw Error("Specify relation");if(!options.id)throw Error("Specify id to fetch");c=new b.Appacitive.Connection({__relationtype:options.relation,
__id:options.id});c.fields=options.fields;c.fetch(g,d)};var d=function(c,a,g){c.onSuccess=function(c){if(c&&c.status&&"200"==c.status.code){if("function"==typeof a){var d=c.connections,e=[];d||(d=[]);d.forEach(function(a){e.push(new b.Appacitive.Connection(a))});a(e,c.paginginfo)}}else c=c||{},"function"==typeof g&&g(c.status||{message:"Server error",code:400})};c.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof g&&g(a)};b.Appacitive.http.send(c)};b.Appacitive.Connection.multiGet=
function(c,a,g,e){options=options||{};if(!options.relation||"string"!=typeof options.relation||0==options.relation.length)throw Error("Specify valid relation");if(options.ids&&0<options.ids.length)return c=new b.Appacitive.HttpRequest,c.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(options.relation,options.ids.join(","),options.fields),c.method="get",d(c,g,e);"function"==typeof g&&g([])};b.Appacitive.Connection.multiDelete=function(c,a,g){c=c||{};if(!c.relation||
"string"!=typeof c.relation||0==c.relation.length)throw Error("Specify valid relation");if(c.ids&&0<c.ids.length){var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(c.relation);d.method="post";d.data={idlist:c.ids};d.onSuccess=function(c){c&&"200"==c.code?"function"==typeof a&&a():(c=c||{},"function"==typeof g&&g(c||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof g&&g(a||{message:"Server error",
code:400})};b.Appacitive.http.send(d)}else a()};b.Appacitive.Connection.getInterconnects=function(c,a,b){c=new Appacitive.Queries.InterconnectsQuery(c);d(c.toRequest(),request,a,b)};b.Appacitive.Connection.getBetweenArticles=function(c,a,b){c=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c);d(c.toRequest(),a,b)};b.Appacitive.Connection.getBetweenArticlesForRelation=function(c,a,b){(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(c)).fetch(a,b)}})(global);
(function(b){b.Appacitive.Users=new function(){var f=null;this.__defineGetter__("currentUser",function(){return f});var e=function(a,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var k=new b.Appacitive.HttpRequest;k.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);k.method="post";k.data=f;k.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof d&&
d(c)):e(a,c)};k.onError=e;b.Appacitive.http.send(k)}else c.set("__link",f),"function"==typeof d&&d(c)},d=function(a,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var k=new b.Appacitive.HttpRequest;k.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);k.method="post";k.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof d&&d(c)):e(a,c)};k.onError=e;b.Appacitive.http.send(k)}else"function"==typeof d&&
d(c)};this.setCurrentUser=function(a,c,j){if(!a||"object"!=typeof a||0<=a.length)throw Error("Cannot set null object as user");var h=a;a.getArticle||(h=new b.Appacitive.User(a,!0));if(!h.get("__id")||0==h.get("__id").length)throw Error("Specify user __id");b.Appacitive.localStorage.set("Appacitive-User",a);j||(j=60);f=h;c&&b.Appacitive.Session.setUserAuthHeader(c,j);f.logout=function(a){b.Appacitive.Users.logout(a)};f.updatePassword=function(a,c,d,e){var g=this,f=d,j=e;d=g.get("__id");if(!d||"string"!==
typeof d||0==d.length)throw Error("Please specify valid userid");if(!a||"string"!==typeof a||0==a.length)throw Error("Please specify valid oldPassword");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid newPassword");f=f||function(){};j=j||function(){};a==c?"function"==typeof f&&f(g):(a={oldpassword:a,newpassword:c},c=new b.Appacitive.HttpRequest,c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(d),c.method="post",c.data=a,c.onSuccess=
function(a){a&&"200"==a.code&&("function"==typeof f?f(g):j(a,g))},c.onError=j,b.Appacitive.http.send(c));return this};f.linkFacebookAccount=function(a,c){var d=function(){e(Appacitive.Facebook.accessToken,f,function(c){b.Appacitive.eventManager.fire("user..article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c)};Appacitive.Facebook.getCurrentUserInfo(function(){d()},function(){Appacitive.Facebook.requestLogin(function(){d()},c)});return this};f.unlinkFacebookAccount=function(a,
c){d("facebook",this,function(c){b.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};f.logout=function(a){Appacitive.Users.logout(a)};f.checkin=function(a,c,d){var g=this,e=c,f=d;c=g.get("__id");(!c||"string"!==typeof c||0==c.length)&&e&&"function"==typeof e&&e();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");e=e||function(){};f=f||function(){};d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getCheckinUrl(c,a.lat,a.lng);d.method="post";d.onSuccess=function(a){a&&"200"==a.code?"function"==typeof e&&e(accounts,g):"function"==typeof f&&f(a,g)};d.onError=f;b.Appacitive.http.send(d);return this};b.Appacitive.eventManager.clearAndSubscribe("user.article."+h.get("__id")+".updated",function(a,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return f};b.Appacitive.User=function(a){a=a||{};a.__schematype="user";b.Appacitive.Article.call(this,
a);return this};b.Appacitive.User.prototype=new b.Appacitive.Article("user");b.Appacitive.User.prototype.constructor=b.Appacitive.User;b.Appacitive.User.prototype.__defineGetter__("linkedAccounts",function(){var a=this.get("__link");a?"object"==typeof a&&!(0<=a.length)?a=[a]:0<=a.length||(a=a[0]):a=[];return a});b.Appacitive.User.prototype.getAllLinkedAccounts=function(a,c){a=a||function(){};var d=this,e=this,f=function(c){"function"==typeof a&&a(c,d)},k=c,m=e.get("__id");(!m||"string"!==typeof m||
0==m.length)&&"function"==typeof f&&f(e.linkedAccounts,e);var f=f||function(){},k=k||function(){},n=new b.Appacitive.HttpRequest;n.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(m);n.method="get";n.onSuccess=function(a){a&&a.status&&"200"==a.status.code?(a=a.identities||[],0<a.length?e.set("__link",a):e.set("__link",null),"function"==typeof f&&f(a,e)):k(a.status,e)};n.onError=k;b.Appacitive.http.send(n);return this};b.Appacitive.User.prototype.linkFacebookAccount=
function(a,c,b){e(a,this,c,b);return this};b.Appacitive.User.prototype.unlinkFacebookAccount=function(a,c){var b=this;d("facebook",this,function(){var c=b.get("__link");c?0<=c.length||(c=[c]):c=[];0<c.length&&"facebook"==c[0].name&&b.set("__link",null);"function"==typeof a&&a(b)},c);return this};b.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,d){if(!a)throw Error("Specify userid for user delete");(new b.Appacitive.Article({__schematype:"user",
__id:a})).del(c||function(){},d||function(){})};this.deleteCurrentUser=function(a,c){a=a||function(){};if(null===f)throw Error("Current user is not yet set for delete operation");var d=f.get("__id");this.deleteUser(d,function(c){b.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a(c)},c)};this.createUser=this.createNewUser=function(a,c,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new b.Appacitive.User(a)).save(c,d)};this.signup=function(a,c,b){var d=this;this.createUser(a,function(){d.login(a.username,a.password,c,b)},function(a){b(a)})};this.authenticateUser=function(a,c,d,e){c=c||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var f=this,k=new b.Appacitive.HttpRequest;k.method="post";k.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();k.data=a;k.onSuccess=function(b){b&&b.user?(e&&(b.user.__authType=e),f.setCurrentUser(b.user,
b.token,a.expiry),c({user:f.currentUser,token:b.token})):(b=b||{},d(b.status))};k.onError=d;b.Appacitive.http.send(k)};this.login=function(a,c,b,d){if(!a||!c||0==a.length||0==c.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:c,expiry:864E5},b||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,c){this.loginWithFacebook(a,c,!1,!0)};this.loginWithFacebook=function(a,c,d,e){a=a||function(){};c=c||function(){};var f=this,k=function(){f.authenticateUser({accesstoken:b.Appacitive.Facebook.accessToken,
type:"facebook",expiry:864E5,createnew:e},function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:f.currentUser,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};d?k():FB?Appacitive.Facebook.requestLogin(function(){k()},c):"function"==typeof c&&c()};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var d=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getValidateTokenUrl(d);e.method="POST";e.data={};e.onSuccess=function(c){"function"==typeof a&&a(c.result)};b.Appacitive.http.send(e)}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");
if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,subject:c};c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code&&("function"==typeof d?d():e(a))};c.onError=e;b.Appacitive.http.send(c)};var c=function(a,c,d){c=c||function(){};d=d||function(){};var e=new b.Appacitive.HttpRequest;e.url=a;e.method="get";
e.onSuccess=function(a){a&&a.user&&("function"==typeof c?c(new Appacitive.User(a.user)):"function"==typeof d&&d(a.status))};e.onError=d;b.Appacitive.http.send(e)};this.getUserByToken=function(a,d,e){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);c(a,d,e)};this.getUserByUsername=function(a,d,e){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");
a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);c(a,d,e)};this.logout=function(a,c){f=null;b.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(b){b.Appacitive.Email=new function(){var f={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return f};var e=function(d,c,a){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=d;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?c(b.email):(b=b||{},b.status=b.status||{},a(b.status.message||"Server error"))};
b.Appacitive.http.send(e)};this.setupEmail=function(b){b=b||{};f.smtp.username=b.username||f.smtp.username;f.from=b.from||f.from;f.smtp.password=b.password||f.smtp.password;f.smtp.host=b.smtp.host||f.smtp.host;f.smtp.port=b.smtp.port||f.smtp.port;f.smtp.enablessl=b.enableSSL||f.smtp.enablessl;f.replyto=b.replyTo||f.replyto};this.sendTemplatedEmail=function(b,c,a){c=c||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.templateName)throw Error("template name is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1==b.isHtml?!1:!0}};if(b.useConfig){g.smtp=f.smtp;if(!b.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=b.from||f.from;g.replyto=b.replyTo||f.replyto}e(g,c,a)};this.sendRawEmail=function(b,c,a){c=c||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.body)throw Error("body is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{content:b.body||"",ishtml:!1==b.isHtml?
!1:!0}};if(b.useConfig){g.smtp=f.smtp;if(!b.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=b.from||f.from;g.replyto=b.replyTo||f.replyto}e(g,c,a)}}})(global);
(function(b){var f=function(){var b=require("facebook-node-sdk"),d=null,c=this.FB=null,a=!0;this.initialize=function(d){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!d.appId)throw Error("Please provide appid");if(!d.appSecret)throw Error("Please provide app secret");c=d.appSecret;this.FB=new b({appId:_appId,secret:c});a=!0};this.requestLogin=function(c,b,e){a?(d=accesstoken,FB.setAccessToken(e),Appacitive.Users.loginWithFacebook(c,b,!0)):"function"==typeof b&&
b("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(c,b){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&d?(c=c||function(){},b=b||function(){},this.FB.api("/me",function(a,e){e?"function"==typeof c&&c(e):"function"==typeof b&&b("Access token is invalid")})):b("Either intialize facebook with your appid and appsecret or set accesstoken")};this.__defineGetter__("accessToken",function(){return d});this.__defineSetter__("accessToken",
function(a){console.log(a);d=a;this.FB&&this.FB.setAccessToken(a)});this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a){a=a||function(){};Appacitive.facebook.accessToken="";"function"==typeof a&&a()}};b.Appacitive.Facebook=b.Appacitive.runtime.isBrowser?new function(){var b=null,d=!0;this.initialize=function(c){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!c.appId)throw Error("Please provide appid");FB.init(c);
d=!0};this.requestLogin=function(c,a){if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");c=c||function(){};a=a||function(){};FB.login(function(d){d&&"connected"===d.status&&d.authResponse?(b=d.authResponse.accessToken,"function"==typeof c&&c(d.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(c,a){if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");c=c||function(){};
a=a||function(){};FB.api("/me",function(d){d&&!d.error?(b=FB.getAuthResponse().accessToken,"function"==typeof c&&c(d)):"function"==typeof a&&a()})};this.__defineGetter__("accessToken",function(){return b});this.__defineSetter__("accessToken",function(c){b=c});this.getProfilePictureUrl=function(c){return"https://graph.facebook.com/"+c+"/picture"};this.logout=function(c,a){c=c||function(){};a=a||function(){};Appacitive.facebook.accessToken="";try{FB.logout(function(){Appacitive.Users.logout();"function"==
typeof c&&c()})}catch(b){"function"==typeof a&&a(b.message)}}}:new f})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(f,e,d){e=e||function(){};d=d||function(){};if(!f)throw Error("Please specify push options");var c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();c.method="post";c.data=f;c.onSuccess=function(a){a&&a.status&&"200"==a.status.code?e(a.id):(a=a||{},a.status=a.status||{},d(a.status.message||"Server error"))};c.onError=function(a){d(a||"Server error")};b.Appacitive.http.send(c)};
this.getNotification=function(f,e,d){e=e||function(){};d=d||function(){};if(!f)throw Error("Please specify notification id");var c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(f);c.method="get";c.onSuccess=function(a){a&&a.status&&"200"==a.status.code?e(a.pushnotification):(a=a||{},a.status=a.status||{},d(a.status.message||"Server error"))};c.onError=function(a){d(a||"Server error")};b.Appacitive.http.send(c)};this.getAllNotifications=
function(f,e,d){e=e||function(){};d=d||function(){};f?(f.pnum=f.pnum||1,f.psize=f.psize||20):f={pnum:1,psize:20};var c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(f);c.method="get";c.onSuccess=function(a){a&&a.status&&"200"==a.status.code?e(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},d(a.status.message||"Server error"))};c.onError=function(a){d(a||"Server error")};b.Appacitive.http.send(c)}}})(global);
(function(b){b.Appacitive.File=function(f){f=f||{};this.fileId=f.fileId;this.contentType=f.contentType;this.fileData=f.fileData;var e=function(a,c,e){var d=new b.Appacitive.HttpRequest;d.url=a;d.method="GET";d.onSuccess=c;d.onError=e;b.Appacitive.http.send(d)},d=function(a,c,d,e,f){(new FormData).append("fileToUpload",c);var m=new b.Appacitive.HttpRequest;m.url=a;m.method="PUT";m.data=c;m.headers.push({key:"content-type",value:d});m.onSuccess=e;m.onError=f;m.send(!0)};this.save=function(b,d,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,b,d,e):c(this,b,d,e)};var c=function(a,c,f,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{if(!a.contentType||"string"!==typeof l||0==a.contentType.length)a.contentType="text/plain";try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);c=c||function(){};f=f||function(){};e(l,function(b){b&&b.status&&"200"==
b.status.code?d(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){c(b,a)},f)},f):"function"==typeof f&&f(b.status,a)},f);return this},a=function(a,c,f,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{if(!a.contentType||"string"!==typeof l||0==a.contentType.length)a.contentType="text/plain";try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);c=c||function(){};f=f||function(){};e(l,function(b){b&&b.status&&"200"==b.status.code?d(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){c(b,a)},f)},f):"function"==typeof f&&f(b.status,a)},f);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(b,that)};d.onError=c;b.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};c=c||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(b){b&&b.status&&"200"==b.status.code?(d.url=b.uri,"function"==typeof a&&a(b.uri)):"function"==typeof c&&"function"==typeof c&&c(b.status,d)};e.onError=c;b.Appacitive.http.send(e);return this}}})(global);
(function(b){b.Appacitive.Date={};b.Appacitive.Date.parseISODate=function(b){try{var e=new Date(b);if(isNaN(e)){var d=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,c=!1;if(!d.exec(b))if(d=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,d.exec(b))c=!0;else return null;var a=b.split("T"),g=a[0].split("-"),j=a[1].split("Z")[0].split(":"),h=j[2].split("."),l=Number(j[0]),e=new Date;e.setUTCFullYear(Number(g[0]));e.setUTCMonth(Number(g[1])-1);e.setUTCDate(Number(g[2]));
c||(e.setUTCHours(Number(l)),e.setUTCMinutes(Number(j[1])),e.setUTCSeconds(Number(h[0])),h[1]&&e.setUTCMilliseconds(Number(h[1])))}return e}catch(k){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(e){return null}};b.Appacitive.Date.toISODate=function(b){try{return b=b.toISOString()[0]}catch(e){return null}};b.Appacitive.Date.toISOTime=function(b){try{return b=b.toISOString().split("T")[1],b=b.replace("Z","0000Z")}catch(e){return null}};
b.Appacitive.Date.parseISOTime=function(b){try{var e=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b))return null;var d=b.split("T");1==d.length&&d.push(d[0]);var c=d[1].split("Z")[0].split(":"),a=c[2].split(".");e.setUTCHours(Number(Number(c[0])));e.setUTCMinutes(Number(c[1]));e.setUTCSeconds(Number(a[0]));a[1]&&e.setUTCMilliseconds(Number(a[1]));return e}catch(g){return null}}})(global);
(function(b){b.Appacitive.localStorage=new function(){var f=b.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(b,d){d=d||"";if(!b)return!1;if("object"==typeof d)try{d=JSON.stringify(d)}catch(c){}f[b]=d;return!0};this.get=function(b){if(!b)return null;b=f.getItem(b);if(!b)return null;if("{"==b[0])try{b=JSON.parse(b)}catch(d){}return b};this.remove=function(b){if(b)try{delete f[b]}catch(d){}}}})(global);
(function(b){b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie=new function(){this.setCookie=function(b,e,d,c){if(d){var a=new Date;a.setTime(a.getTime()+6E4*d);a="; expires="+a.toGMTString()}c||(a="");document.cookie=b+"="+e+a+"; path=/;"+("domain="+window.location.hostname)};this.readCookie=function(b){b+="=";for(var e=document.cookie.split(";"),d=0;d<e.length;d++){for(var c=e[d];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(b))return c.substring(b.length,c.length)}return null};
this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}})})(global);"undefined"!=typeof module&&!global.Appacitive.runtime.isBrowser&&(module.exports=global.Appacitive);