try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{set:e,enumerable:!0,configurable:!0})}}))}catch(defPropException){}
Array.prototype.forEach||(Array.prototype.forEach=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var c=0;c<f;c++)c in this&&b.call(e,this[c],c,this)});"bind"in Function.prototype||(Function.prototype.bind=function(b){var e=this;if(1>=arguments.length)return function(){return e.apply(b,arguments)};var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(b,0===arguments.length?f:f.concat(Array.prototype.slice.call(arguments)))}});
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,e){void 0===e&&(e=0);0>e&&(e+=this.length);0>e&&(e=0);for(var f=this.length;e<f;e++)if(e in this&&this[e]===b)return e;return-1});
"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,e){void 0===e&&(e=this.length-1);0>e&&(e+=this.length);e>this.length-1&&(e=this.length-1);for(e++;0<e--;)if(e in this&&this[e]===b)return e;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,e){for(var f=0,c=this.length;f<c;f++)f in this&&b.call(e,this[f],f,this)});
"map"in Array.prototype||(Array.prototype.map=function(b,e){for(var f=Array(this.length),c=0,d=this.length;c<d;c++)c in this&&(f[c]=b.call(e,this[c],c,this));return f});"filter"in Array.prototype||(Array.prototype.filter=function(b,e){for(var f=[],c,d=0,a=this.length;d<a;d++)d in this&&b.call(e,c=this[d],d,this)&&f.push(c);return f});"every"in Array.prototype||(Array.prototype.every=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&!b.call(e,this[f],f,this))return!1;return!0});
"some"in Array.prototype||(Array.prototype.some=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&b.call(e,this[f],f,this))return!0;return!1});var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(a){if(a&&a.send&&"function"==typeof a.send)a.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],d={},b=0,f={},e=0;this.addProcessor=function(a){a&&(a.pre=a.pre||function(){},a.post=a.post||function(){},p(a.pre),q(a.post))};var p=function(a){b+=1;d[b]=a;return b},
q=function(a){e+=1;f[e]=a;return e};this.enqueueRequest=function(a){c.push(a)};this.changeRequestForCors=function(a){var c={m:a.method.toUpperCase()};a.headers.forEach(function(a){c[a.key]=a.value});a.headers=[];a.headers.push({key:"Content-Type",value:"text/plain"});a.method="POST";a.data&&(c.b=a.data);delete a.data;global.Appacitive.config.debug&&(-1==a.url.indexOf("?")?a.url+="?debug=true":a.url+="&debug=true");try{a.data=JSON.stringify(c)}catch(d){}return a};this.notify=function(){if(0!==c.length){var b=
[],l;for(l in f)f.hasOwnProperty(l)&&b.push(f[l]);for(;0<c.length;){var e=c.shift(),n=[];for(l in d)d.hasOwnProperty(l)&&n.push(d[l](e));this.changeRequestForCors(e);a.send(e,b,n)}}};this.onResponse=function(a){console.dir(a)}},e=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(c,b){a()};this.onError=function(c){a()}},f=null,f=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,c=function(a){var c=
new XDomainRequest;c.onload=function(){var b=c.responseText;try{var d=c.contentType;if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=b,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),b=JSON.parse(d)}catch(f){}a.onSuccess(b,this)};c.onerror=c.ontimeout=function(){a.onError({code:"400",message:"Server Error"},c)};c.onprogress=function(){};c.open(a.method,a.url,!0);c.send(a.data);return c},d=function(a){if(!a.url)throw Error("Please specify request url");
a.method||(a.method="GET");a.headers||(a.headers=[]);var d={},b=!0;a.headers.forEach(function(a){"content-type"==a.key.toLowerCase()&&(b=!0,"application/json"==a.value.toLowerCase()||"application/javascript"==a.value.toLowerCase())&&(b=!1)});if(b)d=a.data;else if(a.data&&(d=a.data,"object"==typeof a.data))try{d=JSON.stringify(d)}catch(l){}a.onSuccess&&"function"==typeof a.onSuccess||(a.onSuccess=function(){});a.onError&&"function"==typeof a.onError||(a.onError=function(){});if(-1!=navigator.userAgent.indexOf("MSIE 8")||
-1!=navigator.userAgent.indexOf("MSIE 9"))return a.data=d,new c(a);var k=new f;k.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var d=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=c,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),c=JSON.parse(d)}catch(b){}a.onSuccess(c,
this)}else a.onError({code:this.status,message:this.statusText},this)};k.open(a.method,a.url,!0);for(var e=0;e<a.headers.length;e+=1)k.setRequestHeader(a.headers[e].key,a.headers[e].value);global.Appacitive.runtime.isBrowser||k.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");k.send(d);return k},a=function(){var a=new e;a.isOnline=function(){return!0};var c=function(c,b,f){new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d,e){if(d){try{d=JSON.parse(d)}catch(m){}var r=
d;if(b.length!=f.length)throw Error("Callback length and state length mismatch!");for(var t=0;t<b.length;t+=1)b[t].apply({},[r,f[t]]);a.onResponse(d,c)}else a.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(d){a.onError(c,d)}})};a.send=function(a,d,b){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,d,b)};a.upload=function(a,d,b){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,d,b,!0)};
return a};global.Appacitive.http=new function(){var c=new a,d=new b(c),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;d.addProcessor(a)};this.send=function(a){d.enqueueRequest(a);c.isOnline()&&!1==f&&d.notify()};this.flush=function(a){a?d.notify():c.isOnline()&&d.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,
[c]);else a.onError(c)};c.onError=this.onError;this.onResponse=function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[a]);else c.onSuccess(a)};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new d(this,a)}};(function(a){a.Appacitive&&a.Appacitive.http&&
(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,d){try{a.Appacitive.Session.isSessionValid(c)?c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(d))}catch(b){}}}),a.Appacitive.http.addProcessor({pre:function(a){return(new Date).getTime()},post:function(a,c){var d=(new Date).getTime()-
c;a._timeTakenInMilliseconds=d}}))})(global)})();
(function(b){String.format=function(b,f){if(1>=arguments.length)return b;for(var c=arguments.length-2,d=0;d<=c;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var f=RegExp("^"+b),c=this;f.test(c)&&(c=c.slice(1,c.length));f=RegExp(b+"$");f.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(b){"undefined"==typeof b&&(b="");for(var f=
"",c=0;c<b.length;c+=1)-1==" .,;#".indexOf(b[c])&&(f+=b[c]);return f=f.toLowerCase()};String.contains=function(b,f){return-1!=b.indexOf(f)};String.startsWith=function(b,f){return 0==b.indexOf(f)};Array.distinct=function(b){var f=[],c=b.length,d,a,g;for(a=0;a<c;a++){d=void 0;for(g=0;g<f.length;g++)if(b[a].toLowerCase()===f[g].toLowerCase()){d=!0;break}d||f.push(b[a])}return f};Object.isEmpty=function(b){if(!b)return!0;var f=!0;for(keys in b){f=!1;break}return f};b.dateFromWcf=function(b,f){var c=/Date\(([^)]+)\)/.exec(b);
if(2!=c.length){if(!f)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var e=function(b){"object"==typeof b&&(0<b.length&&("string"==typeof b[0]||"number"==typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user=
{userServiceUrl:"user",getCreateUrl:function(b){return String.format("{0}/create?fields={1}",this.userServiceUrl,e(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token=",this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,b)},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,d){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,b,c,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,e(b))},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.deviceServiceUrl,b)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,
c,d){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),a=d?a+"?psize="+d:a+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!=c[b].trim().length&&(a=a+"&"+c[b]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,b,c)},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.articleServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,e(c))},getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,e(c))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,
b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,d,a){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,d,c);if("undefined"!==typeof a&&0<a.length)for(b=0;b<a.length;b+=1)g=g+"&"+a[b];return g},getConnectedArticles:function(b,c,d){var a="",a=String.format("{0}/{1}/{2}/find",
this.connectionServiceUrl,b,c);if(d&&d.length&&0<d.length)for(b=0;b<d.length;b+=1)a=0==b?a+("?"+d[b]):a+("&"+d[b]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push=
{pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,
c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(d,a){var g=a.split("="),
e=g[1];2<g.length&&g.forEach(function(a,b){0!=a&&1!=a&&(e=e+"="+g[a])});g[0].toLowerCase()==b&&(c=[g[0],e])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var f={};this.subscribe=function(c,d){if("string"!=typeof c||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof f[c]&&(f[c]=[]);var a=b();f[c].push({callback:d,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var d=-1,a=null,g;for(g in f)for(var e=0;e<f[g].length;e+=
1)if(f[g][e].id==b){d=e;a=g;break}return-1!=d?(f[a].splice(d,1),!0):!1};this.fire=function(b,d,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;if("undefined"!=typeof f.all)for(var g=0;g<f.all.length;g+=1)f.all[g].callback(d,a);g=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof f[b])for(var e=0;e<f[b].length;e+=1)g(f[b][e].callback,d,a)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
f[b]&&(f[b].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(f)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},f=null,c=null,d=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){b.Appacitive.Session.create(null)};this.create=function(a,d){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var l=new e;l.apikey=c;var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+"application.svc/session";
g.method="put";g.data=l;g.onSuccess=function(c){c&&c.status&&"200"==c.status.code?(f=c.session.sessionkey,b.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(c),b.Appacitive.Session.onSessionCreated()):d&&"function"==typeof d&&d(c)};g.onError=d;b.Appacitive.http.send(g)};b.Appacitive.http.addProcessor({pre:function(g){b.Appacitive.Session.useApiKey?g.headers.push({key:"ak",value:c}):g.headers.push({key:"as",value:f});!0===a&&(1==g.headers.filter(function(a){return"ut"==a.key}).length?g.headers.forEach(function(a){"ut"==
a.key&&(a.value=d)}):g.headers.push({key:"ut",value:d}))}});this.setUserAuthHeader=function(c,g,l){try{c&&(a=!0,d=c,l||(g||(g=60),-1==g&&(g=null),b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,g),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",g?g:-1,g))))}catch(e){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c,g){c&&("function"!=typeof c&&"boolean"==typeof c)&&(g=c,c=function(){});a=!1;c=c||function(){};b.Appacitive.localStorage.remove("Appacitive-User");
b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(d&&!g)try{var l=new b.Appacitive.HttpRequest;l.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(d);d=null;l.method="POST";l.data={};l.onSuccess=function(){"function"==typeof c&&c()};b.Appacitive.http.send(l)}catch(e){}else d=null,"function"==typeof c&&c()};this.isSessionValid=function(a){if(!a)return!0;
if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){f=null;this.useApiKey=!0};this.get=function(){return f};this.setSession=function(a){a&&(f=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(c=a,this.useApiKey=!0)};var g="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a}return g}};b.Appacitive.initialize=
function(e){if(!b.Appacitive.Session.initialized){if(!e.apikey||0==e.apikey.length)throw Error("apikey is mandatory");b.Appacitive.Session.setApiKey(e.apikey);b.Appacitive.Session.environment(e.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=e.persistUserToken;e.debug&&(b.Appacitive.config.debug=!0);if(e.userToken)-1==e.expiry?e.expiry=null:e.expiry||(e.expiry=3600),b.Appacitive.Session.setUserAuthHeader(e.userToken,e.expiry),e.user?
b.Appacitive.Users.setCurrentUser(e.user):(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e);else if(b.Appacitive.runtime.isBrowser){var f=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(f){var c=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");c||(c=60);(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e,f,c)}}}}})(global);
(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(e){e.headers.push({key:"e",value:b.Appacitive.Session.environment()})}})})(global);
(function(b){var e=b.Appacitive;e.GeoCoord=function(a,b){_validateGeoCoord=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(_validateGeoCoord(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var f=function(){this.toString=function(){}},c=function(a){f.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};c.prototype=new f;c.prototype.constructor=c;var d=function(a){a=a||"";if("object"!=typeof a.value||!a.value.length)throw Error("Specify field value as array");c.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,"string"==typeof this.value[b]?"'"+this.value[b]+"'":"number"==typeof this.value[b]?this.value[b]:this.value[b].toString()));return"("+a.join(" or ")+
")"}};d.prototype=new c;d.prototype.constructor=d;var a=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;c.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};a.prototype=new c;a.prototype.constructor=a;var g=function(a){a=a||"";if(!(a.geoCoord&&a.geoCoord instanceof
e.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};g.prototype=new c;g.prototype.constructor=a;var m=function(a){a=a||"";if(!a.geoCoords||0==a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");c.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0==b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new c;m.prototype.constructor=a;_tagFilter=function(a){f.call(this);a=a||{};if(!a.tags||"object"!=
typeof a.tags||0==a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};_tagFilter.prototype=new f;_tagFilter.prototype.constructor=_tagFilter;_compoundFilter=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var c=0;c<b.length;c+=1){if(!(b[c]instanceof f))throw Error("Invalid filter provided");
this.innerFilters.push(b[c])}this.toString=function(){var a=this.operator,b="(";this.innerFilters.forEach(function(c){b=1==b.length?b+(" "+c.toString()):b+String.format(" {0} {1} ",a,c.toString())});return b+=")"}};_compoundFilter.prototype=new f;_compoundFilter.prototype.constructor=_compoundFilter;var h=function(a){if(!a||0==a.length)throw Error("Specify value");this.value=a;this.getValue=function(){return"string"==typeof this.value?"'"+this.value+"'":"number"==typeof this.value?this.value:"object"==
typeof this.value&&this.value instanceof date?"datetime('"+e.Date.toISOString(this.value)+"')":this.value.toString()}},l=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"date('"+e.Date.toISODate(this.value)+"')":"date('"+this.value+"'')"}},k=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"time('"+e.Date.toISOTime(this.value)+"')":"time('"+this.value+"'')"}},n=function(a){this.value=
a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"datetime('"+e.Date.toISOString(this.value)+"')":"datetime('"+this.value+"'')"}},p=function(b,e,f){f||(f=this);f.type=b;f.name=e;f.equalTo=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"=="})};f.equalToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};f.equalToTime=function(a){return new c({field:this.name,fieldType:this.type,
value:new k(a),operator:"=="})};f.equalToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"=="})};f.greaterThan=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">"})};f.greaterThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};f.greaterThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">"})};f.greaterThanDateTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new n(a),operator:">"})};f.greaterThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">="})};f.greaterThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};f.greaterThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">="})};f.greaterThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),
operator:">="})};f.lessThan=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<"})};f.lessThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};f.lessThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<"})};f.lessThanDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<"})};f.lessThanEqualTo=function(a){return new c({field:this.name,
fieldType:this.type,value:new h(a),operator:"<="})};f.lessThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};f.lessThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<="})};f.lessThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<="})};f.like=function(a){return new c({field:this.name,fieldType:this.type,value:new h("*"+a+"*"),operator:"like"})};
f.startsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a+"*"),operator:"like"})};f.endsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new h("*"+a),operator:"like"})};f.contains=function(a){return new d({field:this.name,fieldType:this.type,value:a,operator:"=="})};f.between=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new h(b),val2:new h(c),operator:"between"})};f.betweenDate=function(b,c){return new a({field:this.name,
fieldType:this.type,val1:new l(b),val2:new l(c),operator:"between"})};f.betweenTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new k(b),val2:new k(c),operator:"between"})};f.betweenDateTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new n(b),val2:new n(c),operator:"between"})};f.withinCircle=function(a,b,c){return new g({field:this.name,fieldType:this.type,geoCoord:a,distance:b,unit:c,operator:"within_circle"})};f.withinPolygon=function(a){return new m({field:this.name,
fieldType:this.type,geoCoords:a,operator:"within_polygon"})}};_propertyExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;p("property",a,this);return this};_aggregateExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=function(a){return b.greaterThanEqualTo(a)};this.lessThan=
function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,c){return b.between(a,c)};return this};_attributeExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};this.contains=function(a){return b.contains(a)};
return this};e.Filter={Property:function(a){return new _propertyExpression(a)},Aggregate:function(a){return new _aggregateExpression(a)},Attribute:function(a){return new _attributeExpression(a)},Or:function(){return new _compoundFilter("or",arguments)},And:function(){return new _compoundFilter("and",arguments)},taggedWithOneOrMore:function(a){return new _tagFilter({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new _tagFilter({tags:a,operator:"tagged_with_all"})}}})(global);
(function(b){b.Appacitive.Queries={};var e=function(b){b=b||{};var a=1,c=20;this.pageNumber=function(){return 1==arguments.length?(a=arguments[0]||1,this):a};this.pageSize=function(){return 1==arguments.length?(c=arguments[0]||20,this):c};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};e.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var f=function(b){b=b||{};var a="__UtcLastUpdatedDate",c=!1;this.orderBy=function(){return 1==arguments.length?(a=
arguments[0]||"__UtcLastUpdatedDate",this):a};this.isAscending=function(){return 1==arguments.length?(c="undefined"==typeof arguments[0]?!1:arguments[0],this):c};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};f.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var c=function(c){var a=c||{},g="",m="",h="",l=a.queryType||"BasicQuery",k=new e(c),n=new f(c),p=a.schema||a.relation,q=a.relation?"connection":"article";this.type=function(){return q};this.entityType=
function(){return p};this.queryType=function(){return l};this.pageQuery=function(){return k};this.pageNumber=function(){return 1==arguments.length?(k.pageNumber(arguments[0]),this):k.pageNumber};this.pageSize=function(){return 1==arguments.length?(k.pageSize(arguments[0]),this):k.pageSize};this.sortQuery=function(){return n};this.orderby=function(){return 1==arguments.length?(n.orderby(arguments[0]),this):n.orderby};this.isAscending=function(){return 1==arguments.length?(n.isAscending(arguments[0]),
this):n.isAscending};this.filter=function(){return 1==arguments.length?(g=arguments[0],this):g};this.freeText=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?m=arguments[0]:"object"==typeof a&&a.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?h=a:"object"==typeof a&&a.length&&(h=a.join(","));return this}return h};this.filter(a.filter||"");this.freeText(a.freeText||"");this.fields(a.fields||
"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(b){for(var c in b)a[c]=b[c];k=new e(a);n=new f(a);return this};this.getQueryString=function(){var a=k.toString()+"&"+n.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");this.fields()&&0<this.fields().trim().length&&
(a+="&fields="+this.fields());return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+q+"/"+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};var r=function(a){var c=[];a||(a=[]);var d="article"==q?"Article":"Connection";a.forEach(function(a){c.push(new b.Appacitive[d](a,
!0))});return c};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(r(b[q+"s"]),b.paginginfo):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};this.count=function(a,c){a=a||function(){};c=c||function(){};var d=k.pageSize,g=k.pageNumber;k.pageSize=1;k.pageNumber=
999999999;var l=this,h=this.toRequest();h.onSuccess=function(b){k.pageSize=d;k.pageNumber=g;b=b||{};var h=b.paginginfo,e=0;if(h)e=h.totalrecords;else if(b.status&&b.status.code&&"200"==b.status.code)e=0;else{b=b.status||{message:"Server error",code:400};"function"==typeof c&&c(b,l);return}"function"==typeof a&&a(e)};h.onError=function(a){k.pageSize=d;k.pageNumber=g;a=a||{message:"Server error",code:400};"function"==typeof c&&c(a,l)};b.Appacitive.http.send(h);return this}};b.Appacitive.Queries.FindAllQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";c.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new c;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedArticlesQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for connected articles query");if(!d.articleId)throw Error("Specify articleId for connected articles query");
d.schema&&delete d.schema;d.queryType="ConnectedArticlesQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.label="";d.label&&("string"==typeof d.label&&0<d.label.length)&&(this.label="&label="+d.label);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.ConnectedArticlesQuery.prototype=
new c;b.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=b.Appacitive.Queries.ConnectedArticlesQuery;b.Appacitive.Queries.GetConnectionsQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!d.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!d.label||0==d.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");d.schema&&delete d.schema;d.queryType="GetConnectionsQuery";c.call(this,
d);this.articleId=d.articleId;this.relation=d.relation;this.label=d.label;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+this.getQueryString()};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;
b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(d,a){d=d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!d.articleBId||"string"!=typeof d.articleBId||0==d.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");d.schema&&delete d.schema;d.queryType=a||"GetConnectionsBetweenArticlesQuery";c.call(this,d);this.articleAId=d.articleAId;
this.articleBId=d.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"==this.queryType&&d.label&&"string"==typeof d.label&&0<d.label.length?"&label="+d.label:"";this.relation=d.relation&&"string"==typeof d.relation&&0<d.relation.length?d.relation+"/":"";this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+
"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,
"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"==typeof a&&a(new b.Appacitive.Connection(d.connection)):(d=d||{},"function"==typeof c&&c(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};return c};b.Appacitive.Queries.InterconnectsQuery=function(d){d=
d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(d.articleBIds&&"object"==typeof d.articleBIds&&0<d.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");d.schema&&delete d.schema;d.queryType="InterconnectsQuery";c.call(this,d);this.articleAId=d.articleAId;this.articleBIds=d.articleBIds;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();
a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new c;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,a){if(!c||0==c.length)throw Error("Specify name of filter query");this.name=c;this.data=
{};this.queryType="GraphFilterQuery";a&&(this.data.placeholders=a);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(b.ids?b.ids:[]):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};
d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}};b.Appacitive.Queries.GraphProjectQuery=function(c,a,g){if(!c||0==c.length)throw Error("Specify name of project query");if(!a||!a.length)throw Error("Specify ids to project");this.name=c;this.data={ids:a};this.queryType="GraphProjectQuery";g&&(this.data.placeholders=g);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";
a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var e=function(a){var b,c;for(c in a)if("status"!==c){b=a[c];break}var d=function(a,b,c){var g=[];a.forEach(function(a){var l=a.__children;delete a.__children;var e=a.__edge;delete a.__edge;a=new Appacitive.Article(a,!0);a.children={};for(var h in l)a.children[h]=[],a.children[h]=d(l[h].values,l[h].parent,a.id);e&&(e.__endpointa={articleid:c,label:b},e.__endpointb={articleid:a.id,
label:e.label},delete e.label,a.connection=new Appacitive.Connection(e));g.push(a)});return g};return d(b.values)};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(e(b)):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}}})(global);
(function(b){b.Appacitive.BaseObject=function(e,f){var c={},d=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var d in a[c])b[c][d]=a[c][d]}else b[c]=a[c]},a={};d(e,a);f&&d(a,c);!c.__id&&a.__id&&(c.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.cid=g;var m="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),h=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=function(){return JSON.parse(JSON.stringify(a))};
this.toJSON=function(){return JSON.parse(JSON.stringify(a))};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};a.__attributes||(a.__attributes={});c.__attributes||(c.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");
a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var k=function(){var b=!1,d=JSON.parse(JSON.stringify(c.__attributes)),g;for(g in a.__attributes)"undefined"==typeof a.__attributes[g]||null===a.__attributes[g]?(d[g]=null,b=!0):a.__attributes[g]!=c.__attributes[g]?(d[g]=a.__attributes[g],b=!0):a.__attributes[g]==c.__attributes[g]&&delete d[g];return b?
d:null};this.getChangedAttributes=k;this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var n=[];a.__tags||(a.__tags=[]);c.__tags||(c.__tags=[]);this.tags=function(){return a.__tags?a.__tags:[]};this.addTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;a.__tags.push(b);
a.__tags=Array.distinct(a.__tags);if(!n||!n.length)return this;b=n.indexOf(b);-1!=b&&n.splice(b,1);return this};this.removeTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;n.push(b);n=Array.distinct(n);if(!a.__tags||!a.__tags.length)return this;b=a.__tags.indexOf(b);-1!=b&&a.__tags.splice(b,1);return this};var p=function(){var b=[];a.__tags.every(function(a){-1==c.__tags.indexOf(a)&&b.push(a)});return b};this.getChangedTags=p;this.getRemovedTags=function(){return _removetags};var q=
function(b){var d=!1,g=JSON.parse(JSON.stringify(c)),e;for(e in a)"undefined"==typeof a[e]||null===a[e]?(g[e]=null,d=!0):a[e]!=c[e]?"__tags"==e||"__attributes"==e?delete g[e]:(g[e]=a[e],d=!0):a[e]==c[e]&&delete g[e];try{m.forEach(function(a){g[a]&&delete g[a]})}catch(l){}b?(a.__tags&&0<a.__tags.length&&(g.__addtags=p(),d=!0),n&&0<n.length&&(g.__removetags=n,d=!0)):a.__tags&&0<a.__tags.length&&(g.__tags=p(),d=!0);(b=k())?(g.__attributes=b,d=!0):delete g.__attributes;return d?g:!1};this.changed=function(){return q()};
this.hasChanged=function(){var a=q(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=q(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&
arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return c};var r="";this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?r=a:"object"==typeof a&&a.length&&(r=a.join(","));return this}return r};this.get=function(b){if(b)return a[b]};this.set=function(b,c){if(!b||"string"!=typeof b||0==b.length)return this;null==c||"undefined"==c?a[b]=null:"string"==typeof c?a[b]=c:"number"==typeof c?a[b]=c+"":"object"==typeof c&&(0<=c.length?a[b]=c:-1!==h.indexOf(b)&&
(a[b]=c));return this};this.unset=function(b){if(!b||"string"!=typeof b||0==b.length||0==b.indexOf("__"))return this;try{delete a[b]}catch(c){}return this};this.has=function(b){return b&&"string"==typeof b&&0!=b.length?a[b]&&"undefined"!=typeof a[b]?!0:!1:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(b,g){b&&(d(b,a),d(b,c));return this};this.save=function(b,c){a.__id?
u.apply(this,arguments):t.apply(this,arguments);return this};var t=function(g,e){g=g||function(){};e=e||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,r);!a.__schematype||"user"!=a.__schematype.toLowerCase()&&"device"!=a.__schematype.toLowerCase()||(k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl());var f=new b.Appacitive.HttpRequest;f.url=
k;f.method="put";a.__revision&&delete a.__revision;f.data=a;f.onSuccess=function(k){var f=null;k&&(k.article||k.connection||k.user||k.device)&&(f=k.article||k.connection||k.user||k.device);k&&f?(c=f,a.__id=f.__id,d(f,a),h.connectionCollections&&0<h.connectionCollections.length&&h.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})}),"connection"==h.type&&h.parseConnection(),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".created",h,{object:h}),
"function"==typeof g&&g(h)):(k=k||{},k.status=k.status||{},k.status=l(k.status),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".createFailed",h,{error:k.status}),"function"==typeof e&&e(k.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this},u=function(g,e){g=g||function(){};e=e||function(){};var h=q(!0),k=this;if(h){var f=new b.Appacitive.HttpRequest,m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||
a.__relationtype,c.__id?c.__id:a.__id,r);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&(m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(c.__id));f.url=m;f.method="post";f.data=h;f.onSuccess=function(h){h&&(h.article||h.connection||h.user||h.device)?(c=h.article||h.connection||h.user||h.device,d(c,a),n=[],b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updated",
k,{object:k}),"function"==typeof g&&g(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updateFailed",k,{object:h.status}),"function"==typeof e&&e(h.status,k))};f.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==typeof e&&e(a,k)};b.Appacitive.http.send(f)}else"function"==typeof g&&g(k);return this};this.fetch=function(g,e){g=g||function(){};e=e||function(){};if(a.__id){var h=
this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,r),f=new b.Appacitive.HttpRequest;f.url=k;f.method="get";f.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,d(c,a),h.___collection&&"article"==h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof g&&g(h)):(b=b||{},b.status=b.status||{},b.status=l(b),"function"==typeof e&&
e(b.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this}"function"==typeof e&&e({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,d,e){if(a.__id){c=c||function(){};d=d||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl,k=k+b.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&
(k=b.Appacitive.config.apiBaseUrl,k+=b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id));e&&!0===e&&(k=-1==k.indexOf("?")?k+"?deleteconnections=true":k+"&deleteconnections=true");e=new b.Appacitive.HttpRequest;e.url=k;e.method="delete";e.onSuccess=function(b){"200"==b.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof c&&c(b)):(b=l(b),"function"==typeof d&&d(b,h))};e.onError=function(a){a=l(a);"function"==typeof d&&d(a,h)};b.Appacitive.http.send(e)}else this.___collection&&
this.___collection.removeByCId(g),"function"==typeof c&&c(this)}};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var e=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),c="",d,a,g,m,h,l,k=0,b=b.replace(/\r\n/g,"\n");a="";for(g=0;g<b.length;g++)m=b.charCodeAt(g),128>m?a+=String.fromCharCode(m):(127<m&&2048>m?a+=String.fromCharCode(m>>6|192):(a+=String.fromCharCode(m>>12|224),a+=String.fromCharCode(m>>6&63|128)),a+=String.fromCharCode(m&63|128));for(b=a;k<b.length;)d=b.charCodeAt(k++),a=b.charCodeAt(k++),
g=b.charCodeAt(k++),m=d>>2,d=(d&3)<<4|a>>4,h=(a&15)<<2|g>>6,l=g&63,isNaN(a)?h=l=64:isNaN(g)&&(l=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return c.toString()}})(global);
(function(b){b.Appacitive.ArticleCollection=function(e){var f=null,c=null,d=[],a={};"string"==typeof e?a.schema=e:a=e;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var f=a.schema,g=this;e=function(d){d.type="article";d.schema?f=d.schema:d.schema=f;c=new b.Appacitive.Queries.FindAllQuery(d);a=d;g.extendOptions=c.extendOptions};this.setFilter=function(d){a.filter=d;a.type="article";c?c.filter(d):(c=new b.Appacitive.Queries.FindAllQuery(a),
g.extendOptions=c.extendOptions);return this};this.setFreeText=function(d){d||0!=d.trim().length||(a.freeText="");a.freeText=d;a.type="article";c?c.freeText(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.setFields=function(d){d||(d="");a.fields=d;a.type="article";c?c.fields(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.reset=function(){f=a=null;d.length=0;c=null};var m=["BasicFilterQuery"];this.query=
function(){if(1==arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==m.indexOf(a.queryType()))throw Error("ArticleCollection only accepts "+m.join(", "));d.length=0;c=a;return this}return c};this.setOptions=e;e(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=f)throw Error("Null article passed or schema type mismatch");
var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!=b?d.splice(b,1):d.push(a);return this};this.getArticleById=function(a){var b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllArticles=function(){return Array.prototype.slice.call(d).map(function(a){return a.getArticle()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getArticle().__id&&
c.getArticle().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var h=function(a,b,c){a.length&&0!==a.length||(a=[]);a.forEach(function(a){a.___collection=g;d.push(a)});"function"==typeof c&&c(b,g)};this.fetch=function(a,b){d.length=0;c.fetch(function(b,c){h(b,c,a)},function(a){"function"==typeof b&&b(a,g)});return this};this.count=function(a,b){this.query.count(a,
b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=f;a=new b.Appacitive.Article(a);a.___collection=g;d.push(a);return a};this.map=
function(){return d.map.apply(this,arguments)};this.forEach=function(){return d.forEach.apply(this,arguments)};this.filter=function(){return d.filter.apply(this,arguments)}};b.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};b.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};b.Appacitive.ArticleCollection.prototype.articles=function(){return this.getAll()};b.Appacitive.ArticleCollection.prototype.length=
function(){return this.articles.length}})(global);
(function(b){b.Appacitive.ConnectionCollection=function(e){var f=null,c=null,d=[],a=[],g={};"string"==typeof e?g.relation=e:g=e;this.collectionType="connection";var m=this;if(!e||!e.relation)throw Error("Must provide relation while initializing ConnectionCollection.");f=e.relation;e=function(a){a.type="connection";a.relation?f=a.relation:a.relation=f;c=new b.Appacitive.Queries.FindAllQuery(a);g=a;return m};this.setFilter=function(a){g.filter=a;g.type="connection";c?c.filter(a):(c=new b.Appacitive.Queries.FindAllQuery(g),
m.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){a||0!=a.trim().length||(g.freeText="");g.freeText=a;g.type="connection";c?c.freeText(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";c?c.fields(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.query=function(){if(1==arguments.length){var b=arguments[0];if(!b||
!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==h.indexOf(b.queryType()))throw Error("ConnectionCollection only accepts "+h.join(", "));a.length=0;d.length=0;c=b;return this}return c};var h=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.reset=function(){f=g=null;a.length=0;d.length=0;c=null};this.setOptions=e;e(g);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,
10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=f)throw Error("Null connection passed or relation type mismatch");var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!==b?d.splice(b,1):d.push(a);return this};this.getConnection=function(a,b,c){b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllConnections=
function(){return Array.prototype.slice.call(d).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getConnection().__id&&c.getConnection().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var l=function(b,g,e){"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&(b=[b]);b.length&&
0!==b.length||(b=[]);b.forEach(function(b){b.___collection=m;if(b.endpointA.article||b.endpointB.article){var c=b.endpointA.article||b.endpointB.article;c.___collection=m;a.push(c)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(g){}d.push(b)});"function"==typeof e&&e(g,m)};this.getConnectedArticle=function(b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(a,b){d.length=0;c.fetch(function(b,
c){l(b,c,a)},function(a){"function"==typeof b&&b(a,m)});return this};this.count=function(a,b){c.count(a,b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewConnection=function(a){a=
a||{};a.__relationtype=f;a=new b.Appacitive.Connection(a);a.___collection=m;d.push(a);return a};this.map=function(){return d.map.apply(this,arguments)};this.forEach=function(a,b){return d.forEach(a,b||this)};this.filter=function(){return d.filter.apply(this,arguments)}}})(global);
(function(b){var e=function(c,d){c=c||function(){};d=d||function(){};var a=new b.Appacitive.HttpRequest;a.method="get";a.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(a){a?c(a):d()}):d({code:"404",message:"fb account not found"})};
a.onError=d;b.Appacitive.http.send(a)};b.Appacitive.Article=function(c,d){c=c||{};"string"==typeof c&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);b.Appacitive.BaseObject.call(this,c,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=e);return this};b.Appacitive.Article.prototype=new b.Appacitive.BaseObject;
b.Appacitive.Article.prototype.constructor=b.Appacitive.Article;b.Appacitive.Article.prototype.getConnections=function(c){if("article"!=this.type)return null;c=c||{};c.articleId=this.get("__id");var d=new b.Appacitive.ConnectionCollection({relation:c.relation});this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.GetConnectionsQuery(c));return d};b.Appacitive.Article.prototype.getConnectedArticles=function(c){c=c||{};"string"==typeof c&&(rName=c,c={relation:rName});c.articleId=this.get("__id");
var d=new b.Appacitive.ConnectionCollection({relation:c.relation});d.connectedArticle=this;this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.ConnectedArticlesQuery(c));return d};b.Appacitive.Article.multiDelete=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if("user"==c.schema.toLowerCase()||"device"==c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(c.ids&&0<c.ids.length){d=
d||function(){};a=a||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);e.method="post";e.data={idlist:c.ids};e.onSuccess=function(b){b&&"200"==b.code?"function"==typeof d&&d():(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else d()};var f=function(c){var d=
[];c.forEach(function(a){d.push(new b.Appacitive.Article(a))});return d};b.Appacitive.Article.multiGet=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if(c.ids&&0<c.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);e.method="get";e.onSuccess=function(b){b&&b.articles?"function"==typeof d&&d(f(b.articles),b.paginginfo):
(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof a&&a(b)};b.Appacitive.http.send(e)}else"function"==typeof d&&d([])};b.Appacitive.Article.get=function(c,d,a){c=c||{};if(!c.schema)throw Error("Specify schema");if(!c.id)throw Error("Specify id to fetch");var e={},e="user"==c.schema.toLowerCase()?new b.Appacitive.User({__id:c.id}):new b.Appacitive.Article({__schematype:c.schema,__id:c.id});
e.fields=c.fields;e.fetch(d,a);return e}})(global);
(function(b){var e=function(a,c,d){var e={label:a.label};a.articleid&&(e.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?e.articleid=a.article.get("__id"):e.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?e.articleid=a.article.__id:e.article=a.article,a.article=new b.Appacitive.Article(a.article));else if(!e.articleid&&!e.article)throw Error("Incorrectly configured endpoints provided to setupConnection");d["endpoint"+
c]=a;return e},f=function(a,c,d){a.article&&"object"==typeof a.article?(d["endpoint"+c]?d["endpoint"+c]&&d["endpoint"+c].article&&d["endpoint"+c].article.getArticle?d["endpoint"+c].article.copy(a.article):d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0):(d["endpoint"+c]={},d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0)),d["endpoint"+c].articleid=a.articleid,d["endpoint"+c].label=a.label,d["endpoint"+c].type=a.type,d["endpoint"+c].article.___collection=d.___collection):
d["endpoint"+c]=a};b.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw Error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);b.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b=
"A",c="B";a.__endpointa.label!=this.get("__endpointb").label||(a.__endpointa.label==a.__endpointb.label||a.__endpointa.articleid!=this.get("__endpointb").articleid&&a.__endpointa.articleid)||(b="B",c="A");f(this.get("__endpointa"),b,this);f(this.get("__endpointb"),c,this);this.endpoints=function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};c?(this.connectedArticle=function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(b=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(b)},this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.prototype.setupConnection=function(a,b){if(!(a&&(a.articleid||a.article)&&a.label&&b&&(b.articleid||b.article)&&b.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",e(a,"A",this));this.set("__endpointb",e(b,"B",this))};b.Appacitive.Connection.get=function(a,c,d){a=a||{};if(!a.relation)throw Error("Specify relation");if(!a.id)throw Error("Specify id to fetch");var e=new b.Appacitive.Connection({__relationtype:a.relation,
__id:a.id});e.fields=a.fields;e.fetch(c,d)};var c=function(a){var c=[];a||(a=[]);a.forEach(function(a){c.push(new b.Appacitive.Connection(a))});return c},d=function(a,d,e){a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"==typeof d&&d(c(a.connections),a.paginginfo):(a=a||{},"function"==typeof e&&e(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof e&&e(a)};b.Appacitive.http.send(a)};b.Appacitive.Connection.multiGet=
function(a,c,e){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var h=new b.Appacitive.HttpRequest;h.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(a.relation,a.ids.join(","),a.fields);h.method="get";return d(h,c,e)}"function"==typeof c&&c([])};b.Appacitive.Connection.multiDelete=function(a,c,d){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");
if(a.ids&&0<a.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);e.method="post";e.data={idlist:a.ids};e.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof d&&d(a||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof d&&d(a||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else c()};b.Appacitive.Connection.getInterconnects=
function(a,b,c){a=new Appacitive.Queries.InterconnectsQuery(a);d(a.toRequest(),request,b,c)};b.Appacitive.Connection.getBetweenArticles=function(a,b,c){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);d(a.toRequest(),b,c)};b.Appacitive.Connection.getBetweenArticlesForRelation=function(a,b,c){(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).fetch(b,c)}})(global);
(function(b){b.Appacitive.Users=new function(){var e=null;this.currentUser=function(){return e};var f=function(a,c,d,e,f){var g=a.get("__id");if(!g||"string"!==typeof g||0==g.length)throw Error("Please specify valid userid");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid oldPassword");if(!d||"string"!==typeof d||0==d.length)throw Error("Please specify valid newPassword");e=e||function(){};f=f||function(){};c==d?"function"==typeof e&&e(a):(c={oldpassword:c,newpassword:d},
d=new b.Appacitive.HttpRequest,d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g),d.method="post",d.data=c,d.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof e?e(a):f(b,a))},d.onError=f,b.Appacitive.http.send(d))},c=function(a,c,d){var e=a.get("__id");e&&"string"===typeof e&&0!=e.length||"function"==typeof c&&c(a.linkedAccounts(),a);c=c||function(){};d=d||function(){};var f=new b.Appacitive.HttpRequest;f.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(e);f.method="get";f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(b=b.identities||[],0<b.length?a.set("__link",b):a.set("__link",null),"function"==typeof c&&c(b,a)):d(b.status,a)};f.onError=d;b.Appacitive.http.send(f)},d=function(a,c,d,e){var f=c.get("__id");f&&"string"===typeof f&&0!=f.length||d&&"function"==typeof d&&d();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");d=d||function(){};e=e||function(){};
var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getCheckinUrl(f,a.lat,a.lng);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d(accounts,c):"function"==typeof e&&e(a,c)};g.onError=e;b.Appacitive.http.send(g)},a=function(a,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);g.method="post";g.data=f;g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else c.set("__link",f),"function"==typeof d&&d(c)},g=function(a,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);g.method=
"post";g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else"function"==typeof d&&d(c)};this.setCurrentUser=function(c,l,k){if(!c)throw Error("Cannot set null object as user");var m=c;if(m instanceof Appacitive.User)if(m.get("__id")&&0!=m.get("__id").length)c=m.toJSON();else throw Error("Specify user __id");else m=new b.Appacitive.User(c,!0);b.Appacitive.localStorage.set("Appacitive-User",c);k||(k=60);e=m;l&&b.Appacitive.Session.setUserAuthHeader(l,
k);e.logout=function(a){b.Appacitive.Users.logout(a)};e.updatePassword=function(a,b,c,d){f(this,a,b,c,d);return this};e.linkFacebookAccount=function(c,d){var f=function(){a(Appacitive.Facebook.accessToken(),e,function(a){b.Appacitive.eventManager.fire("user..article."+a.get("__id")+".updated",a,{object:a});"function"==typeof c&&c(a)},d)};Appacitive.Facebook.getCurrentUserInfo(function(){f()},function(){Appacitive.Facebook.requestLogin(function(){f()},d)});return this};e.unlinkFacebookAccount=function(a,
c){g("facebook",this,function(c){b.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};e.logout=function(a){Appacitive.Users.logout(a)};e.checkin=function(a,b,c){d(a,this,b,c);return this};b.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(a,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return e};b.Appacitive.User=function(a){a=a||{};a.__schematype="user";
b.Appacitive.Article.call(this,a);return this};b.Appacitive.User.prototype=new b.Appacitive.Article("user");b.Appacitive.User.prototype.constructor=b.Appacitive.User;b.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?"object"!=typeof a||0<=a.length?0<=a.length||(a=a[0]):a=[a]:a=[];return a};b.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this;c(this,function(b){"function"==typeof a&&a(b,d)},b);return this};b.Appacitive.User.prototype.linkFacebookAccount=
function(b,c,d){a(b,this,c,d);return this};b.Appacitive.User.prototype.unlinkFacebookAccount=function(a,b){var c=this;g("facebook",this,function(){var b=c.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&c.set("__link",null);"function"==typeof a&&a(c)},b);return this};b.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,d){if(!a)throw Error("Specify userid for user delete");c=c||function(){};d=d||function(){};
(new b.Appacitive.Article({__schematype:"user",__id:a})).del(c,d)};this.deleteCurrentUser=function(a,c){var d=function(){b.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a()};if(null===e)d();else{var f=e.get("__id");this.deleteUser(f,function(){d()},c)}};this.createUser=this.createNewUser=function(a,c,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new b.Appacitive.User(a)).save(c,d)};this.signup=function(a,b,c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(a,c,d,f){c=c||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var g=this,m=new b.Appacitive.HttpRequest;m.method="post";m.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();m.data=a;m.onSuccess=function(b){b&&b.user?(f&&(b.user.__authType=f),g.setCurrentUser(b.user,
b.token,a.expiry),c({user:e,token:b.token})):(b=b||{},d(b.status))};m.onError=d;b.Appacitive.http.send(m)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(a,c,d,f){a=a||function(){};c=c||function(){};var g=this,m=function(){var d=
{accesstoken:b.Appacitive.Facebook.accessToken(),type:"facebook",expiry:864E5,createnew:!0};g.authenticateUser(d,function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:e,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};d?m():Appacitive.Facebook.requestLogin(function(a){m()},c)};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var d=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=this;this.getUserByToken(d,function(b){e.setCurrentUser(b,d);"function"==typeof a&&a(!0)},function(){"function"==typeof a&&a(!1)})}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,
subject:c};c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d():e(a)};c.onError=e;b.Appacitive.http.send(c)};var m=function(a,c,d){c=c||function(){};d=d||function(){};var e=new b.Appacitive.HttpRequest;e.url=a;e.method="get";e.onSuccess=function(a){a&&a.user?"function"==typeof c&&c(new Appacitive.User(a.user)):"function"==typeof d&&
d(a.status)};e.onError=d;b.Appacitive.http.send(e)};this.getUserByToken=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);m(a,c,d)};this.getUserByUsername=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);m(a,c,d)};this.logout=
function(a,c){e=null;b.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(b){b.Appacitive.Email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var f=function(c,d,a){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=c;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.email):(b=b||{},b.status=b.status||{},a(b.status.message||"Server error"))};
b.Appacitive.http.send(e)};this.setupEmail=function(b){b=b||{};e.smtp.username=b.username||e.smtp.username;e.from=b.from||e.from;e.smtp.password=b.password||e.smtp.password;e.smtp.host=b.smtp.host||e.smtp.host;e.smtp.port=b.smtp.port||e.smtp.port;e.smtp.enablessl=b.enableSSL||e.smtp.enablessl;e.replyto=b.replyTo||e.replyto};this.sendTemplatedEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.templateName)throw Error("template name is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1==b.isHtml?!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)};this.sendRawEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.body)throw Error("body is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{content:b.body||"",ishtml:!1==b.isHtml?
!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)}}})(global);
(function(b){var e=function(){var b=require("facebook-node-sdk"),c=null,d=this.FB=null,a=!0;this.initialize=function(c){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!c.appId)throw Error("Please provide appid");if(!c.appSecret)throw Error("Please provide app secret");d=c.appSecret;this.FB=new b({appId:_appId,secret:d});a=!0};this.requestLogin=function(b,d,e){a?(c=accesstoken,FB.setAccessToken(e),Appacitive.Users.loginWithFacebook(b,d,!0)):"function"==typeof d&&
d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,d){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&c?(b=b||function(){},d=d||function(){},this.FB.api("/me",function(a,c){c?"function"==typeof b&&b(c):"function"==typeof d&&d("Access token is invalid")})):d("Either intialize facebook with your appid and appsecret or set accesstoken")};this.accessToken=function(){return 1==arguments.length?(c=arguments[0],this):
c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,b){a=a||function(){};Appacitive.Facebook.accessToken="";"function"==typeof a&&a()}};b.Appacitive.Facebook=b.Appacitive.runtime.isBrowser?new function(){var b=null,c=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);c=!0};this.requestLogin=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
d=d||function(){};a=a||function(){};FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,"function"==typeof d&&d(c.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");d=d||function(){};a=a||function(){};FB.api("/me",function(c){c&&!c.error?(b=FB.getAuthResponse().accessToken,"function"==typeof d&&d(c)):"function"==
typeof a&&a()})};this.accessToken=function(){return 1==arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.Facebook.accessToken="";try{FB.logout(function(a){Appacitive.Users.logout();"function"==typeof b&&b()})}catch(c){"function"==typeof a&&a(c.message)}}}:new e})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify push options");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();d.method="post";d.data=e;d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};
this.getNotification=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify notification id");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};this.getAllNotifications=
function(e,f,c){f=f||function(){};c=c||function(){};e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)}}})(global);
(function(b){b.Appacitive.File=function(e){e=e||{};this.fileId=e.fileId;this.contentType=e.contentType;this.fileData=e.fileData;var f=function(a,c,d){var e=new b.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=c;e.onError=d;b.Appacitive.http.send(e)},c=function(a,c,d,e,f){(new FormData).append("fileToUpload",c);var n=new b.Appacitive.HttpRequest;n.url=a;n.method="PUT";n.data=c;n.headers.push({key:"content-type",value:d});n.onSuccess=e;n.onError=f;n.send()};this.save=function(b,c,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,b,c,e):d(this,b,c,e)};var d=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==
b.status.code?c(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this},a=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==b.status.code?c(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(b,that)};d.onError=c;b.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};c=c||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(b){b&&b.status&&"200"==b.status.code?(d.url=b.uri,"function"==typeof a&&a(b.uri)):"function"==typeof c&&"function"==typeof c&&c(b.status,d)};e.onError=c;b.Appacitive.http.send(e);return this}}})(global);
(function(b){b.Appacitive.Date={};b.Appacitive.Date.parseISODate=function(b){try{var f=new Date(b);if(isNaN(f)){var c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,d=!1;if(!c.exec(b))if(c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,c.exec(b))d=!0;else return null;var a=b.split("T"),g=a[0].split("-"),m=a[1].split("Z")[0].split(":"),h=m[2].split("."),l=Number(m[0]),f=new Date;f.setUTCFullYear(Number(g[0]));f.setUTCMonth(Number(g[1])-1);f.setUTCDate(Number(g[2]));
d||(f.setUTCHours(Number(l)),f.setUTCMinutes(Number(m[1])),f.setUTCSeconds(Number(h[0])),h[1]&&f.setUTCMilliseconds(Number(h[1])))}return f}catch(k){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(f){return null}};b.Appacitive.Date.toISODate=function(b){try{return b=b.toISOString().split("T")[0]}catch(f){return null}};b.Appacitive.Date.toISOTime=function(b){try{return b=b.toISOString().split("T")[1],b=b.replace("Z","0000Z")}catch(f){return null}};
b.Appacitive.Date.parseISOTime=function(b){try{var f=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b))return null;var c=b.split("T");1==c.length&&c.push(c[0]);var d=c[1].split("Z")[0].split(":"),a=d[2].split(".");f.setUTCHours(Number(Number(d[0])));f.setUTCMinutes(Number(d[1]));f.setUTCSeconds(Number(a[0]));a[1]&&f.setUTCMilliseconds(Number(a[1]));return f}catch(g){return null}}})(global);
(function(b){b.Appacitive.localStorage=new function(){var e=b.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(b,c){c=c||"";if(!b)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(d){}e[b]=c;return!0};this.get=function(b){if(!b)return null;b=e.getItem(b);if(!b)return null;if("{"==b[0])try{b=JSON.parse(b)}catch(c){}return b};this.remove=function(b){if(b)try{delete e[b]}catch(c){}}}})(global);
(function(b){b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie=new function(){this.setCookie=function(e,f,c,d){var a="";c&&(a=new Date,a.setTime(a.getTime()+6E4*c),a.toGMTString());a=d?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=e+"="+f+a+"; path=/;"+c};this.readCookie=function(b){b+="=";for(var f=document.cookie.split(";"),
c=0;c<f.length;c++){for(var d=f[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(b))return d.substring(b.length,d.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}})})(global);"undefined"==typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{set:e,enumerable:!0,configurable:!0})}}))}catch(defPropException){}
Array.prototype.forEach||(Array.prototype.forEach=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var c=0;c<f;c++)c in this&&b.call(e,this[c],c,this)});"bind"in Function.prototype||(Function.prototype.bind=function(b){var e=this;if(1>=arguments.length)return function(){return e.apply(b,arguments)};var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(b,0===arguments.length?f:f.concat(Array.prototype.slice.call(arguments)))}});
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,e){void 0===e&&(e=0);0>e&&(e+=this.length);0>e&&(e=0);for(var f=this.length;e<f;e++)if(e in this&&this[e]===b)return e;return-1});
"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,e){void 0===e&&(e=this.length-1);0>e&&(e+=this.length);e>this.length-1&&(e=this.length-1);for(e++;0<e--;)if(e in this&&this[e]===b)return e;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,e){for(var f=0,c=this.length;f<c;f++)f in this&&b.call(e,this[f],f,this)});
"map"in Array.prototype||(Array.prototype.map=function(b,e){for(var f=Array(this.length),c=0,d=this.length;c<d;c++)c in this&&(f[c]=b.call(e,this[c],c,this));return f});"filter"in Array.prototype||(Array.prototype.filter=function(b,e){for(var f=[],c,d=0,a=this.length;d<a;d++)d in this&&b.call(e,c=this[d],d,this)&&f.push(c);return f});"every"in Array.prototype||(Array.prototype.every=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&!b.call(e,this[f],f,this))return!1;return!0});
"some"in Array.prototype||(Array.prototype.some=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&b.call(e,this[f],f,this))return!0;return!1});Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(b){function e(b){return 10>b?"0"+b:b}return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON);
var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(a){if(a&&a.send&&"function"==typeof a.send)a.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],b={},d=0,f={},e=0;this.addProcessor=function(a){a&&(a.pre=a.pre||function(){},a.post=a.post||function(){},p(a.pre),q(a.post))};var p=function(a){d+=1;b[d]=a;return d},
q=function(a){e+=1;f[e]=a;return e};this.enqueueRequest=function(a){c.push(a)};this.changeRequestForCors=function(a){var c={m:a.method.toUpperCase()};a.headers.forEach(function(a){c[a.key]=a.value});a.headers=[];a.headers.push({key:"Content-Type",value:"text/plain"});a.method="POST";a.data&&(c.b=a.data);delete a.data;global.Appacitive.config.debug&&(-1==a.url.indexOf("?")?a.url+="?debug=true":a.url+="&debug=true");try{a.data=JSON.stringify(c)}catch(b){}return a};this.notify=function(){if(0!==c.length){var d=
[],l;for(l in f)f.hasOwnProperty(l)&&d.push(f[l]);for(;0<c.length;){var e=c.shift(),n=[];for(l in b)b.hasOwnProperty(l)&&n.push(b[l](e));this.changeRequestForCors(e);a.send(e,d,n)}}};this.onResponse=function(a){console.dir(a)}},e=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(c,b){a()};this.onError=function(c){a()}},f=null,f=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,c=function(a){var c=
new XDomainRequest;c.onload=function(){var b=c.responseText;try{var d=c.contentType;if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=b,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),b=JSON.parse(d)}catch(f){}a.onSuccess(b,this)};c.onerror=c.ontimeout=function(){a.onError({code:"400",message:"Server Error"},c)};c.onprogress=function(){};c.open(a.method,a.url,!0);c.send(a.data);return c},d=function(a){if(!a.url)throw Error("Please specify request url");
a.method||(a.method="GET");a.headers||(a.headers=[]);var d={},b=!0;a.headers.forEach(function(a){"content-type"==a.key.toLowerCase()&&(b=!0,"application/json"==a.value.toLowerCase()||"application/javascript"==a.value.toLowerCase())&&(b=!1)});if(b)d=a.data;else if(a.data&&(d=a.data,"object"==typeof a.data))try{d=JSON.stringify(d)}catch(l){}a.onSuccess&&"function"==typeof a.onSuccess||(a.onSuccess=function(){});a.onError&&"function"==typeof a.onError||(a.onError=function(){});if(-1!=navigator.userAgent.indexOf("MSIE 8")||
-1!=navigator.userAgent.indexOf("MSIE 9"))return a.data=d,new c(a);var k=new f;k.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var d=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=c,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),c=JSON.parse(d)}catch(b){}a.onSuccess(c,
this)}else a.onError({code:this.status,message:this.statusText},this)};k.open(a.method,a.url,!0);for(var e=0;e<a.headers.length;e+=1)k.setRequestHeader(a.headers[e].key,a.headers[e].value);global.Appacitive.runtime.isBrowser||k.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");k.send(d);return k},a=function(){var a=new e;a.isOnline=function(){return!0};var c=function(c,b,f){new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d,e){if(d){try{d=JSON.parse(d)}catch(m){}var r=
d;if(b.length!=f.length)throw Error("Callback length and state length mismatch!");for(var t=0;t<b.length;t+=1)b[t].apply({},[r,f[t]]);a.onResponse(d,c)}else a.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(d){a.onError(c,d)}})};a.send=function(a,d,b){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,d,b)};a.upload=function(a,d,b){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,d,b,!0)};
return a};global.Appacitive.http=new function(){var c=new a,d=new b(c),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;d.addProcessor(a)};this.send=function(a){d.enqueueRequest(a);c.isOnline()&&!1==f&&d.notify()};this.flush=function(a){a?d.notify():c.isOnline()&&d.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,
[c]);else a.onError(c)};c.onError=this.onError;this.onResponse=function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[a]);else c.onSuccess(a)};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new d(this,a)}};(function(a){a.Appacitive&&a.Appacitive.http&&
(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,d){try{a.Appacitive.Session.isSessionValid(c)?c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(d))}catch(b){}}}),a.Appacitive.http.addProcessor({pre:function(a){return(new Date).getTime()},post:function(a,c){var d=(new Date).getTime()-
c;a._timeTakenInMilliseconds=d}}))})(global)})();
(function(b){String.format=function(b,f){if(1>=arguments.length)return b;for(var c=arguments.length-2,d=0;d<=c;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var f=RegExp("^"+b),c=this;f.test(c)&&(c=c.slice(1,c.length));f=RegExp(b+"$");f.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(b){"undefined"==typeof b&&(b="");for(var f=
"",c=0;c<b.length;c+=1)-1==" .,;#".indexOf(b[c])&&(f+=b[c]);return f=f.toLowerCase()};String.contains=function(b,f){return-1!=b.indexOf(f)};String.startsWith=function(b,f){return 0==b.indexOf(f)};Array.distinct=function(b){var f=[],c=b.length,d,a,g;for(a=0;a<c;a++){d=void 0;for(g=0;g<f.length;g++)if(b[a].toLowerCase()===f[g].toLowerCase()){d=!0;break}d||f.push(b[a])}return f};Object.isEmpty=function(b){if(!b)return!0;var f=!0;for(keys in b){f=!1;break}return f};b.dateFromWcf=function(b,f){var c=/Date\(([^)]+)\)/.exec(b);
if(2!=c.length){if(!f)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var e=function(b){"object"==typeof b&&(0<b.length&&("string"==typeof b[0]||"number"==typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user=
{userServiceUrl:"user",getCreateUrl:function(b){return String.format("{0}/create?fields={1}",this.userServiceUrl,e(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token=",this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,b)},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,d){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,b,c,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,e(b))},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.deviceServiceUrl,b)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,
c,d){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),a=d?a+"?psize="+d:a+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!=c[b].trim().length&&(a=a+"&"+c[b]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,b,c)},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.articleServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,e(c))},getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,e(c))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,
b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,d,a){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,d,c);if("undefined"!==typeof a&&0<a.length)for(b=0;b<a.length;b+=1)g=g+"&"+a[b];return g},getConnectedArticles:function(b,c,d){var a="",a=String.format("{0}/{1}/{2}/find",
this.connectionServiceUrl,b,c);if(d&&d.length&&0<d.length)for(b=0;b<d.length;b+=1)a=0==b?a+("?"+d[b]):a+("&"+d[b]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push=
{pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,
c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(d,a){var g=a.split("="),
e=g[1];2<g.length&&g.forEach(function(a,b){0!=a&&1!=a&&(e=e+"="+g[a])});g[0].toLowerCase()==b&&(c=[g[0],e])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var f={};this.subscribe=function(c,d){if("string"!=typeof c||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof f[c]&&(f[c]=[]);var a=b();f[c].push({callback:d,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var d=-1,a=null,g;for(g in f)for(var e=0;e<f[g].length;e+=
1)if(f[g][e].id==b){d=e;a=g;break}return-1!=d?(f[a].splice(d,1),!0):!1};this.fire=function(b,d,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;if("undefined"!=typeof f.all)for(var g=0;g<f.all.length;g+=1)f.all[g].callback(d,a);g=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof f[b])for(var e=0;e<f[b].length;e+=1)g(f[b][e].callback,d,a)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
f[b]&&(f[b].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(f)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},f=null,c=null,d=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){b.Appacitive.Session.create(null)};this.create=function(a,d){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var l=new e;l.apikey=c;var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+"application.svc/session";
g.method="put";g.data=l;g.onSuccess=function(c){c&&c.status&&"200"==c.status.code?(f=c.session.sessionkey,b.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(c),b.Appacitive.Session.onSessionCreated()):d&&"function"==typeof d&&d(c)};g.onError=d;b.Appacitive.http.send(g)};b.Appacitive.http.addProcessor({pre:function(g){b.Appacitive.Session.useApiKey?g.headers.push({key:"ak",value:c}):g.headers.push({key:"as",value:f});!0===a&&(1==g.headers.filter(function(a){return"ut"==a.key}).length?g.headers.forEach(function(a){"ut"==
a.key&&(a.value=d)}):g.headers.push({key:"ut",value:d}))}});this.setUserAuthHeader=function(c,g,l){try{c&&(a=!0,d=c,l||(g||(g=60),-1==g&&(g=null),b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,g),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",g?g:-1,g))))}catch(e){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c,g){c&&("function"!=typeof c&&"boolean"==typeof c)&&(g=c,c=function(){});a=!1;c=c||function(){};b.Appacitive.localStorage.remove("Appacitive-User");
b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(d&&!g)try{var l=new b.Appacitive.HttpRequest;l.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(d);d=null;l.method="POST";l.data={};l.onSuccess=function(){"function"==typeof c&&c()};b.Appacitive.http.send(l)}catch(e){}else d=null,"function"==typeof c&&c()};this.isSessionValid=function(a){if(!a)return!0;
if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){f=null;this.useApiKey=!0};this.get=function(){return f};this.setSession=function(a){a&&(f=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(c=a,this.useApiKey=!0)};var g="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a}return g}};b.Appacitive.initialize=
function(e){if(!b.Appacitive.Session.initialized){if(!e.apikey||0==e.apikey.length)throw Error("apikey is mandatory");b.Appacitive.Session.setApiKey(e.apikey);b.Appacitive.Session.environment(e.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=e.persistUserToken;e.debug&&(b.Appacitive.config.debug=!0);if(e.userToken)-1==e.expiry?e.expiry=null:e.expiry||(e.expiry=3600),b.Appacitive.Session.setUserAuthHeader(e.userToken,e.expiry),e.user?
b.Appacitive.Users.setCurrentUser(e.user):(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e);else if(b.Appacitive.runtime.isBrowser){var f=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(f){var c=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");c||(c=60);(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e,f,c)}}}}})(global);
(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(e){e.headers.push({key:"e",value:b.Appacitive.Session.environment()})}})})(global);
(function(b){var e=b.Appacitive;e.GeoCoord=function(a,b){_validateGeoCoord=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(_validateGeoCoord(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var f=function(){this.toString=function(){}},c=function(a){f.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};c.prototype=new f;c.prototype.constructor=c;var d=function(a){a=a||"";if("object"!=typeof a.value||!a.value.length)throw Error("Specify field value as array");c.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,"string"==typeof this.value[b]?"'"+this.value[b]+"'":"number"==typeof this.value[b]?this.value[b]:this.value[b].toString()));return"("+a.join(" or ")+
")"}};d.prototype=new c;d.prototype.constructor=d;var a=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;c.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};a.prototype=new c;a.prototype.constructor=a;var g=function(a){a=a||"";if(!(a.geoCoord&&a.geoCoord instanceof
e.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};g.prototype=new c;g.prototype.constructor=a;var m=function(a){a=a||"";if(!a.geoCoords||0==a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");c.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0==b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new c;m.prototype.constructor=a;_tagFilter=function(a){f.call(this);a=a||{};if(!a.tags||"object"!=
typeof a.tags||0==a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};_tagFilter.prototype=new f;_tagFilter.prototype.constructor=_tagFilter;_compoundFilter=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var c=0;c<b.length;c+=1){if(!(b[c]instanceof f))throw Error("Invalid filter provided");
this.innerFilters.push(b[c])}this.toString=function(){var a=this.operator,b="(";this.innerFilters.forEach(function(c){b=1==b.length?b+(" "+c.toString()):b+String.format(" {0} {1} ",a,c.toString())});return b+=")"}};_compoundFilter.prototype=new f;_compoundFilter.prototype.constructor=_compoundFilter;var h=function(a){if(!a||0==a.length)throw Error("Specify value");this.value=a;this.getValue=function(){return"string"==typeof this.value?"'"+this.value+"'":"number"==typeof this.value?this.value:"object"==
typeof this.value&&this.value instanceof date?"datetime('"+e.Date.toISOString(this.value)+"')":this.value.toString()}},l=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"date('"+e.Date.toISODate(this.value)+"')":"date('"+this.value+"'')"}},k=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"time('"+e.Date.toISOTime(this.value)+"')":"time('"+this.value+"'')"}},n=function(a){this.value=
a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"datetime('"+e.Date.toISOString(this.value)+"')":"datetime('"+this.value+"'')"}},p=function(b,e,f){f||(f=this);f.type=b;f.name=e;f.equalTo=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"=="})};f.equalToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};f.equalToTime=function(a){return new c({field:this.name,fieldType:this.type,
value:new k(a),operator:"=="})};f.equalToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"=="})};f.greaterThan=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">"})};f.greaterThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};f.greaterThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">"})};f.greaterThanDateTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new n(a),operator:">"})};f.greaterThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">="})};f.greaterThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};f.greaterThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">="})};f.greaterThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),
operator:">="})};f.lessThan=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<"})};f.lessThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};f.lessThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<"})};f.lessThanDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<"})};f.lessThanEqualTo=function(a){return new c({field:this.name,
fieldType:this.type,value:new h(a),operator:"<="})};f.lessThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};f.lessThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<="})};f.lessThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<="})};f.like=function(a){return new c({field:this.name,fieldType:this.type,value:new h("*"+a+"*"),operator:"like"})};
f.startsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a+"*"),operator:"like"})};f.endsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new h("*"+a),operator:"like"})};f.contains=function(a){return new d({field:this.name,fieldType:this.type,value:a,operator:"=="})};f.between=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new h(b),val2:new h(c),operator:"between"})};f.betweenDate=function(b,c){return new a({field:this.name,
fieldType:this.type,val1:new l(b),val2:new l(c),operator:"between"})};f.betweenTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new k(b),val2:new k(c),operator:"between"})};f.betweenDateTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new n(b),val2:new n(c),operator:"between"})};f.withinCircle=function(a,b,c){return new g({field:this.name,fieldType:this.type,geoCoord:a,distance:b,unit:c,operator:"within_circle"})};f.withinPolygon=function(a){return new m({field:this.name,
fieldType:this.type,geoCoords:a,operator:"within_polygon"})}};_propertyExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;p("property",a,this);return this};_aggregateExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=function(a){return b.greaterThanEqualTo(a)};this.lessThan=
function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,c){return b.between(a,c)};return this};_attributeExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};this.contains=function(a){return b.contains(a)};
return this};e.Filter={Property:function(a){return new _propertyExpression(a)},Aggregate:function(a){return new _aggregateExpression(a)},Attribute:function(a){return new _attributeExpression(a)},Or:function(){return new _compoundFilter("or",arguments)},And:function(){return new _compoundFilter("and",arguments)},taggedWithOneOrMore:function(a){return new _tagFilter({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new _tagFilter({tags:a,operator:"tagged_with_all"})}}})(global);
(function(b){b.Appacitive.Queries={};var e=function(b){b=b||{};var a=1,c=20;this.pageNumber=function(){return 1==arguments.length?(a=arguments[0]||1,this):a};this.pageSize=function(){return 1==arguments.length?(c=arguments[0]||20,this):c};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};e.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var f=function(b){b=b||{};var a="__UtcLastUpdatedDate",c=!1;this.orderBy=function(){return 1==arguments.length?(a=
arguments[0]||"__UtcLastUpdatedDate",this):a};this.isAscending=function(){return 1==arguments.length?(c="undefined"==typeof arguments[0]?!1:arguments[0],this):c};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};f.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var c=function(c){var a=c||{},g="",m="",h="",l=a.queryType||"BasicQuery",k=new e(c),n=new f(c),p=a.schema||a.relation,q=a.relation?"connection":"article";this.type=function(){return q};this.entityType=
function(){return p};this.queryType=function(){return l};this.pageQuery=function(){return k};this.pageNumber=function(){return 1==arguments.length?(k.pageNumber(arguments[0]),this):k.pageNumber};this.pageSize=function(){return 1==arguments.length?(k.pageSize(arguments[0]),this):k.pageSize};this.sortQuery=function(){return n};this.orderby=function(){return 1==arguments.length?(n.orderby(arguments[0]),this):n.orderby};this.isAscending=function(){return 1==arguments.length?(n.isAscending(arguments[0]),
this):n.isAscending};this.filter=function(){return 1==arguments.length?(g=arguments[0],this):g};this.freeText=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?m=arguments[0]:"object"==typeof a&&a.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?h=a:"object"==typeof a&&a.length&&(h=a.join(","));return this}return h};this.filter(a.filter||"");this.freeText(a.freeText||"");this.fields(a.fields||
"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(b){for(var c in b)a[c]=b[c];k=new e(a);n=new f(a);return this};this.getQueryString=function(){var a=k.toString()+"&"+n.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");this.fields()&&0<this.fields().trim().length&&
(a+="&fields="+this.fields());return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+q+"/"+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};var r=function(a){var c=[];a||(a=[]);var d="article"==q?"Article":"Connection";a.forEach(function(a){c.push(new b.Appacitive[d](a,
!0))});return c};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(r(b[q+"s"]),b.paginginfo):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};this.count=function(a,c){a=a||function(){};c=c||function(){};var d=k.pageSize,g=k.pageNumber;k.pageSize=1;k.pageNumber=
999999999;var l=this,h=this.toRequest();h.onSuccess=function(b){k.pageSize=d;k.pageNumber=g;b=b||{};var h=b.paginginfo,e=0;if(h)e=h.totalrecords;else if(b.status&&b.status.code&&"200"==b.status.code)e=0;else{b=b.status||{message:"Server error",code:400};"function"==typeof c&&c(b,l);return}"function"==typeof a&&a(e)};h.onError=function(a){k.pageSize=d;k.pageNumber=g;a=a||{message:"Server error",code:400};"function"==typeof c&&c(a,l)};b.Appacitive.http.send(h);return this}};b.Appacitive.Queries.FindAllQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";c.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new c;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedArticlesQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for connected articles query");if(!d.articleId)throw Error("Specify articleId for connected articles query");
d.schema&&delete d.schema;d.queryType="ConnectedArticlesQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.label="";d.label&&("string"==typeof d.label&&0<d.label.length)&&(this.label="&label="+d.label);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.ConnectedArticlesQuery.prototype=
new c;b.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=b.Appacitive.Queries.ConnectedArticlesQuery;b.Appacitive.Queries.GetConnectionsQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!d.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!d.label||0==d.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");d.schema&&delete d.schema;d.queryType="GetConnectionsQuery";c.call(this,
d);this.articleId=d.articleId;this.relation=d.relation;this.label=d.label;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+this.getQueryString()};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;
b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(d,a){d=d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!d.articleBId||"string"!=typeof d.articleBId||0==d.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");d.schema&&delete d.schema;d.queryType=a||"GetConnectionsBetweenArticlesQuery";c.call(this,d);this.articleAId=d.articleAId;
this.articleBId=d.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"==this.queryType&&d.label&&"string"==typeof d.label&&0<d.label.length?"&label="+d.label:"";this.relation=d.relation&&"string"==typeof d.relation&&0<d.relation.length?d.relation+"/":"";this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+
"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,
"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"==typeof a&&a(new b.Appacitive.Connection(d.connection)):(d=d||{},"function"==typeof c&&c(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};return c};b.Appacitive.Queries.InterconnectsQuery=function(d){d=
d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(d.articleBIds&&"object"==typeof d.articleBIds&&0<d.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");d.schema&&delete d.schema;d.queryType="InterconnectsQuery";c.call(this,d);this.articleAId=d.articleAId;this.articleBIds=d.articleBIds;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();
a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new c;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,a){if(!c||0==c.length)throw Error("Specify name of filter query");this.name=c;this.data=
{};this.queryType="GraphFilterQuery";a&&(this.data.placeholders=a);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(b.ids?b.ids:[]):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};
d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}};b.Appacitive.Queries.GraphProjectQuery=function(c,a,g){if(!c||0==c.length)throw Error("Specify name of project query");if(!a||!a.length)throw Error("Specify ids to project");this.name=c;this.data={ids:a};this.queryType="GraphProjectQuery";g&&(this.data.placeholders=g);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";
a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var e=function(a){var b,c;for(c in a)if("status"!==c){b=a[c];break}var d=function(a,b,c){var g=[];a.forEach(function(a){var e=a.__children;delete a.__children;var l=a.__edge;delete a.__edge;a=new Appacitive.Article(a,!0);a.children={};for(var h in e)a.children[h]=[],a.children[h]=d(e[h].values,e[h].parent,a.id);l&&(l.__endpointa={articleid:c,label:b},l.__endpointb={articleid:a.id,
label:l.label},delete l.label,a.connection=new Appacitive.Connection(l));g.push(a)});return g};return d(b.values)};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(e(b)):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}}})(global);
(function(b){b.Appacitive.BaseObject=function(e,f){var c={},d=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var d in a[c])b[c][d]=a[c][d]}else b[c]=a[c]},a={};d(e,a);f&&d(a,c);!c.__id&&a.__id&&(c.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.cid=g;var m="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),h=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=function(){return JSON.parse(JSON.stringify(a))};
this.toJSON=function(){return JSON.parse(JSON.stringify(a))};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};a.__attributes||(a.__attributes={});c.__attributes||(c.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");
a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var k=function(){var b=!1,d=JSON.parse(JSON.stringify(c.__attributes)),g;for(g in a.__attributes)"undefined"==typeof a.__attributes[g]||null===a.__attributes[g]?(d[g]=null,b=!0):a.__attributes[g]!=c.__attributes[g]?(d[g]=a.__attributes[g],b=!0):a.__attributes[g]==c.__attributes[g]&&delete d[g];return b?
d:null};this.getChangedAttributes=k;this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var n=[];a.__tags||(a.__tags=[]);c.__tags||(c.__tags=[]);this.tags=function(){return a.__tags?a.__tags:[]};this.addTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;a.__tags.push(b);
a.__tags=Array.distinct(a.__tags);if(!n||!n.length)return this;b=n.indexOf(b);-1!=b&&n.splice(b,1);return this};this.removeTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;n.push(b);n=Array.distinct(n);if(!a.__tags||!a.__tags.length)return this;b=a.__tags.indexOf(b);-1!=b&&a.__tags.splice(b,1);return this};var p=function(){var b=[];a.__tags.every(function(a){-1==c.__tags.indexOf(a)&&b.push(a)});return b};this.getChangedTags=p;this.getRemovedTags=function(){return _removetags};var q=
function(b){var d=!1,g=JSON.parse(JSON.stringify(c)),e;for(e in a)"undefined"==typeof a[e]||null===a[e]?(g[e]=null,d=!0):a[e]!=c[e]?"__tags"==e||"__attributes"==e?delete g[e]:(g[e]=a[e],d=!0):a[e]==c[e]&&delete g[e];try{m.forEach(function(a){g[a]&&delete g[a]})}catch(l){}b?(a.__tags&&0<a.__tags.length&&(g.__addtags=p(),d=!0),n&&0<n.length&&(g.__removetags=n,d=!0)):a.__tags&&0<a.__tags.length&&(g.__tags=p(),d=!0);(b=k())?(g.__attributes=b,d=!0):delete g.__attributes;return d?g:!1};this.changed=function(){return q()};
this.hasChanged=function(){var a=q(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=q(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&
arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return c};var r="";this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?r=a:"object"==typeof a&&a.length&&(r=a.join(","));return this}return r};this.get=function(b){if(b)return a[b]};this.set=function(b,c){if(!b||"string"!=typeof b||0==b.length)return this;null==c||"undefined"==c?a[b]=null:"string"==typeof c?a[b]=c:"number"==typeof c?a[b]=c+"":"object"==typeof c&&(0<=c.length?a[b]=c:-1!==h.indexOf(b)&&
(a[b]=c));return this};this.unset=function(b){if(!b||"string"!=typeof b||0==b.length||0==b.indexOf("__"))return this;try{delete a[b]}catch(c){}return this};this.has=function(b){return b&&"string"==typeof b&&0!=b.length?a[b]&&"undefined"!=typeof a[b]?!0:!1:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(b,g){b&&(d(b,a),d(b,c));return this};this.save=function(b,c){a.__id?
u.apply(this,arguments):t.apply(this,arguments);return this};var t=function(g,e){g=g||function(){};e=e||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,r);!a.__schematype||"user"!=a.__schematype.toLowerCase()&&"device"!=a.__schematype.toLowerCase()||(k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl());var f=new b.Appacitive.HttpRequest;f.url=
k;f.method="put";a.__revision&&delete a.__revision;f.data=a;f.onSuccess=function(k){var f=null;k&&(k.article||k.connection||k.user||k.device)&&(f=k.article||k.connection||k.user||k.device);k&&f?(c=f,a.__id=f.__id,d(f,a),h.connectionCollections&&0<h.connectionCollections.length&&h.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})}),"connection"==h.type&&h.parseConnection(),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".created",h,{object:h}),
"function"==typeof g&&g(h)):(k=k||{},k.status=k.status||{},k.status=l(k.status),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".createFailed",h,{error:k.status}),"function"==typeof e&&e(k.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this},u=function(g,e){g=g||function(){};e=e||function(){};var h=q(!0),k=this;if(h){var f=new b.Appacitive.HttpRequest,m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||
a.__relationtype,c.__id?c.__id:a.__id,r);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&(m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(c.__id));f.url=m;f.method="post";f.data=h;f.onSuccess=function(h){h&&(h.article||h.connection||h.user||h.device)?(c=h.article||h.connection||h.user||h.device,d(c,a),n=[],b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updated",
k,{object:k}),"function"==typeof g&&g(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updateFailed",k,{object:h.status}),"function"==typeof e&&e(h.status,k))};f.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==typeof e&&e(a,k)};b.Appacitive.http.send(f)}else"function"==typeof g&&g(k);return this};this.fetch=function(g,e){g=g||function(){};e=e||function(){};if(a.__id){var h=
this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,r),f=new b.Appacitive.HttpRequest;f.url=k;f.method="get";f.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,d(c,a),h.___collection&&"article"==h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof g&&g(h)):(b=b||{},b.status=b.status||{},b.status=l(b),"function"==typeof e&&
e(b.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this}"function"==typeof e&&e({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,d,e){if(a.__id){c=c||function(){};d=d||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl,k=k+b.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&
(k=b.Appacitive.config.apiBaseUrl,k+=b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id));e&&!0===e&&(k=-1==k.indexOf("?")?k+"?deleteconnections=true":k+"&deleteconnections=true");e=new b.Appacitive.HttpRequest;e.url=k;e.method="delete";e.onSuccess=function(b){"200"==b.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof c&&c(b)):(b=l(b),"function"==typeof d&&d(b,h))};e.onError=function(a){a=l(a);"function"==typeof d&&d(a,h)};b.Appacitive.http.send(e)}else this.___collection&&
this.___collection.removeByCId(g),"function"==typeof c&&c(this)}};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var e=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),c="",d,a,g,m,h,l,k=0,b=b.replace(/\r\n/g,"\n");a="";for(g=0;g<b.length;g++)m=b.charCodeAt(g),128>m?a+=String.fromCharCode(m):(127<m&&2048>m?a+=String.fromCharCode(m>>6|192):(a+=String.fromCharCode(m>>12|224),a+=String.fromCharCode(m>>6&63|128)),a+=String.fromCharCode(m&63|128));for(b=a;k<b.length;)d=b.charCodeAt(k++),a=b.charCodeAt(k++),
g=b.charCodeAt(k++),m=d>>2,d=(d&3)<<4|a>>4,h=(a&15)<<2|g>>6,l=g&63,isNaN(a)?h=l=64:isNaN(g)&&(l=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return c.toString()}})(global);
(function(b){b.Appacitive.ArticleCollection=function(e){var f=null,c=null,d=[],a={};"string"==typeof e?a.schema=e:a=e;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var f=a.schema,g=this;e=function(d){d.type="article";d.schema?f=d.schema:d.schema=f;c=new b.Appacitive.Queries.FindAllQuery(d);a=d;g.extendOptions=c.extendOptions};this.setFilter=function(d){a.filter=d;a.type="article";c?c.filter(d):(c=new b.Appacitive.Queries.FindAllQuery(a),
g.extendOptions=c.extendOptions);return this};this.setFreeText=function(d){d||0!=d.trim().length||(a.freeText="");a.freeText=d;a.type="article";c?c.freeText(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.setFields=function(d){d||(d="");a.fields=d;a.type="article";c?c.fields(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.reset=function(){f=a=null;d.length=0;c=null};var m=["BasicFilterQuery"];this.query=
function(){if(1==arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==m.indexOf(a.queryType()))throw Error("ArticleCollection only accepts "+m.join(", "));d.length=0;c=a;return this}return c};this.setOptions=e;e(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=f)throw Error("Null article passed or schema type mismatch");
var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!=b?d.splice(b,1):d.push(a);return this};this.getArticleById=function(a){var b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllArticles=function(){return Array.prototype.slice.call(d).map(function(a){return a.getArticle()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getArticle().__id&&
c.getArticle().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var h=function(a,b,c){a.length&&0!==a.length||(a=[]);a.forEach(function(a){a.___collection=g;d.push(a)});"function"==typeof c&&c(b,g)};this.fetch=function(a,b){d.length=0;c.fetch(function(b,c){h(b,c,a)},function(a){"function"==typeof b&&b(a,g)});return this};this.count=function(a,b){this.query.count(a,
b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=f;a=new b.Appacitive.Article(a);a.___collection=g;d.push(a);return a};this.map=
function(){return d.map.apply(this,arguments)};this.forEach=function(){return d.forEach.apply(this,arguments)};this.filter=function(){return d.filter.apply(this,arguments)}};b.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};b.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};b.Appacitive.ArticleCollection.prototype.articles=function(){return this.getAll()};b.Appacitive.ArticleCollection.prototype.length=
function(){return this.articles.length}})(global);
(function(b){b.Appacitive.ConnectionCollection=function(e){var f=null,c=null,d=[],a=[],g={};"string"==typeof e?g.relation=e:g=e;this.collectionType="connection";var m=this;if(!e||!e.relation)throw Error("Must provide relation while initializing ConnectionCollection.");f=e.relation;e=function(a){a.type="connection";a.relation?f=a.relation:a.relation=f;c=new b.Appacitive.Queries.FindAllQuery(a);g=a;return m};this.setFilter=function(a){g.filter=a;g.type="connection";c?c.filter(a):(c=new b.Appacitive.Queries.FindAllQuery(g),
m.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){a||0!=a.trim().length||(g.freeText="");g.freeText=a;g.type="connection";c?c.freeText(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";c?c.fields(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.query=function(){if(1==arguments.length){var b=arguments[0];if(!b||
!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==h.indexOf(b.queryType()))throw Error("ConnectionCollection only accepts "+h.join(", "));a.length=0;d.length=0;c=b;return this}return c};var h=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.reset=function(){f=g=null;a.length=0;d.length=0;c=null};this.setOptions=e;e(g);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,
10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=f)throw Error("Null connection passed or relation type mismatch");var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!==b?d.splice(b,1):d.push(a);return this};this.getConnection=function(a,b,c){b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllConnections=
function(){return Array.prototype.slice.call(d).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getConnection().__id&&c.getConnection().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var l=function(b,e,g){"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&(b=[b]);b.length&&
0!==b.length||(b=[]);b.forEach(function(b){b.___collection=m;if(b.endpointA.article||b.endpointB.article){var c=b.endpointA.article||b.endpointB.article;c.___collection=m;a.push(c)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(e){}d.push(b)});"function"==typeof g&&g(e,m)};this.getConnectedArticle=function(b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(a,b){d.length=0;c.fetch(function(b,
c){l(b,c,a)},function(a){"function"==typeof b&&b(a,m)});return this};this.count=function(a,b){c.count(a,b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewConnection=function(a){a=
a||{};a.__relationtype=f;a=new b.Appacitive.Connection(a);a.___collection=m;d.push(a);return a};this.map=function(){return d.map.apply(this,arguments)};this.forEach=function(a,b){return d.forEach(a,b||this)};this.filter=function(){return d.filter.apply(this,arguments)}}})(global);
(function(b){var e=function(c,d){c=c||function(){};d=d||function(){};var a=new b.Appacitive.HttpRequest;a.method="get";a.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(a){a?c(a):d()}):d({code:"404",message:"fb account not found"})};
a.onError=d;b.Appacitive.http.send(a)};b.Appacitive.Article=function(c,d){c=c||{};"string"==typeof c&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);b.Appacitive.BaseObject.call(this,c,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=e);return this};b.Appacitive.Article.prototype=new b.Appacitive.BaseObject;
b.Appacitive.Article.prototype.constructor=b.Appacitive.Article;b.Appacitive.Article.prototype.getConnections=function(c){if("article"!=this.type)return null;c=c||{};c.articleId=this.get("__id");var d=new b.Appacitive.ConnectionCollection({relation:c.relation});this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.GetConnectionsQuery(c));return d};b.Appacitive.Article.prototype.getConnectedArticles=function(c){c=c||{};"string"==typeof c&&(rName=c,c={relation:rName});c.articleId=this.get("__id");
var d=new b.Appacitive.ConnectionCollection({relation:c.relation});d.connectedArticle=this;this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.ConnectedArticlesQuery(c));return d};b.Appacitive.Article.multiDelete=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if("user"==c.schema.toLowerCase()||"device"==c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(c.ids&&0<c.ids.length){d=
d||function(){};a=a||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);e.method="post";e.data={idlist:c.ids};e.onSuccess=function(b){b&&"200"==b.code?"function"==typeof d&&d():(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else d()};var f=function(c){var d=
[];c.forEach(function(a){d.push(new b.Appacitive.Article(a))});return d};b.Appacitive.Article.multiGet=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if(c.ids&&0<c.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);e.method="get";e.onSuccess=function(b){b&&b.articles?"function"==typeof d&&d(f(b.articles),b.paginginfo):
(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof a&&a(b)};b.Appacitive.http.send(e)}else"function"==typeof d&&d([])};b.Appacitive.Article.get=function(c,d,a){c=c||{};if(!c.schema)throw Error("Specify schema");if(!c.id)throw Error("Specify id to fetch");var e={},e="user"==c.schema.toLowerCase()?new b.Appacitive.User({__id:c.id}):new b.Appacitive.Article({__schematype:c.schema,__id:c.id});
e.fields=c.fields;e.fetch(d,a);return e}})(global);
(function(b){var e=function(a,c,d){var e={label:a.label};a.articleid&&(e.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?e.articleid=a.article.get("__id"):e.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?e.articleid=a.article.__id:e.article=a.article,a.article=new b.Appacitive.Article(a.article));else if(!e.articleid&&!e.article)throw Error("Incorrectly configured endpoints provided to setupConnection");d["endpoint"+
c]=a;return e},f=function(a,c,d){a.article&&"object"==typeof a.article?(d["endpoint"+c]?d["endpoint"+c]&&d["endpoint"+c].article&&d["endpoint"+c].article.getArticle?d["endpoint"+c].article.copy(a.article):d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0):(d["endpoint"+c]={},d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0)),d["endpoint"+c].articleid=a.articleid,d["endpoint"+c].label=a.label,d["endpoint"+c].type=a.type,d["endpoint"+c].article.___collection=d.___collection):
d["endpoint"+c]=a};b.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw Error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);b.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b=
"A",c="B";a.__endpointa.label!=this.get("__endpointb").label||(a.__endpointa.label==a.__endpointb.label||a.__endpointa.articleid!=this.get("__endpointb").articleid&&a.__endpointa.articleid)||(b="B",c="A");f(this.get("__endpointa"),b,this);f(this.get("__endpointb"),c,this);this.endpoints=function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};c?(this.connectedArticle=function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(b=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(b)},this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.prototype.setupConnection=function(a,b){if(!(a&&(a.articleid||a.article)&&a.label&&b&&(b.articleid||b.article)&&b.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",e(a,"A",this));this.set("__endpointb",e(b,"B",this))};b.Appacitive.Connection.get=function(a,c,d){a=a||{};if(!a.relation)throw Error("Specify relation");if(!a.id)throw Error("Specify id to fetch");var e=new b.Appacitive.Connection({__relationtype:a.relation,
__id:a.id});e.fields=a.fields;e.fetch(c,d)};var c=function(a){var c=[];a||(a=[]);a.forEach(function(a){c.push(new b.Appacitive.Connection(a))});return c},d=function(a,d,e){a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"==typeof d&&d(c(a.connections),a.paginginfo):(a=a||{},"function"==typeof e&&e(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof e&&e(a)};b.Appacitive.http.send(a)};b.Appacitive.Connection.multiGet=
function(a,c,e){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var h=new b.Appacitive.HttpRequest;h.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(a.relation,a.ids.join(","),a.fields);h.method="get";return d(h,c,e)}"function"==typeof c&&c([])};b.Appacitive.Connection.multiDelete=function(a,c,d){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");
if(a.ids&&0<a.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);e.method="post";e.data={idlist:a.ids};e.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof d&&d(a||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof d&&d(a||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else c()};b.Appacitive.Connection.getInterconnects=
function(a,b,c){a=new Appacitive.Queries.InterconnectsQuery(a);d(a.toRequest(),request,b,c)};b.Appacitive.Connection.getBetweenArticles=function(a,b,c){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);d(a.toRequest(),b,c)};b.Appacitive.Connection.getBetweenArticlesForRelation=function(a,b,c){(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).fetch(b,c)}})(global);
(function(b){b.Appacitive.Users=new function(){var e=null;this.currentUser=function(){return e};var f=function(a,c,d,e,f){var g=a.get("__id");if(!g||"string"!==typeof g||0==g.length)throw Error("Please specify valid userid");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid oldPassword");if(!d||"string"!==typeof d||0==d.length)throw Error("Please specify valid newPassword");e=e||function(){};f=f||function(){};c==d?"function"==typeof e&&e(a):(c={oldpassword:c,newpassword:d},
d=new b.Appacitive.HttpRequest,d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g),d.method="post",d.data=c,d.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof e?e(a):f(b,a))},d.onError=f,b.Appacitive.http.send(d))},c=function(a,c,d){var e=a.get("__id");e&&"string"===typeof e&&0!=e.length||"function"==typeof c&&c(a.linkedAccounts(),a);c=c||function(){};d=d||function(){};var f=new b.Appacitive.HttpRequest;f.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(e);f.method="get";f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(b=b.identities||[],0<b.length?a.set("__link",b):a.set("__link",null),"function"==typeof c&&c(b,a)):d(b.status,a)};f.onError=d;b.Appacitive.http.send(f)},d=function(a,c,d,e){var f=c.get("__id");f&&"string"===typeof f&&0!=f.length||d&&"function"==typeof d&&d();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");d=d||function(){};e=e||function(){};
var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getCheckinUrl(f,a.lat,a.lng);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d(accounts,c):"function"==typeof e&&e(a,c)};g.onError=e;b.Appacitive.http.send(g)},a=function(a,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);g.method="post";g.data=f;g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else c.set("__link",f),"function"==typeof d&&d(c)},g=function(a,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);g.method=
"post";g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else"function"==typeof d&&d(c)};this.setCurrentUser=function(c,l,k){if(!c)throw Error("Cannot set null object as user");var m=c;if(m instanceof Appacitive.User)if(m.get("__id")&&0!=m.get("__id").length)c=m.toJSON();else throw Error("Specify user __id");else m=new b.Appacitive.User(c,!0);b.Appacitive.localStorage.set("Appacitive-User",c);k||(k=60);e=m;l&&b.Appacitive.Session.setUserAuthHeader(l,
k);e.logout=function(a){b.Appacitive.Users.logout(a)};e.updatePassword=function(a,b,c,d){f(this,a,b,c,d);return this};e.linkFacebookAccount=function(c,d){var f=function(){a(Appacitive.Facebook.accessToken(),e,function(a){b.Appacitive.eventManager.fire("user..article."+a.get("__id")+".updated",a,{object:a});"function"==typeof c&&c(a)},d)};Appacitive.Facebook.getCurrentUserInfo(function(){f()},function(){Appacitive.Facebook.requestLogin(function(){f()},d)});return this};e.unlinkFacebookAccount=function(a,
c){g("facebook",this,function(c){b.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};e.logout=function(a){Appacitive.Users.logout(a)};e.checkin=function(a,b,c){d(a,this,b,c);return this};b.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(a,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return e};b.Appacitive.User=function(a){a=a||{};a.__schematype="user";
b.Appacitive.Article.call(this,a);return this};b.Appacitive.User.prototype=new b.Appacitive.Article("user");b.Appacitive.User.prototype.constructor=b.Appacitive.User;b.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?"object"!=typeof a||0<=a.length?0<=a.length||(a=a[0]):a=[a]:a=[];return a};b.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this;c(this,function(b){"function"==typeof a&&a(b,d)},b);return this};b.Appacitive.User.prototype.linkFacebookAccount=
function(b,c,d){a(b,this,c,d);return this};b.Appacitive.User.prototype.unlinkFacebookAccount=function(a,b){var c=this;g("facebook",this,function(){var b=c.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&c.set("__link",null);"function"==typeof a&&a(c)},b);return this};b.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,d){if(!a)throw Error("Specify userid for user delete");c=c||function(){};d=d||function(){};
(new b.Appacitive.Article({__schematype:"user",__id:a})).del(c,d)};this.deleteCurrentUser=function(a,c){var d=function(){b.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a()};if(null===e)d();else{var f=e.get("__id");this.deleteUser(f,function(){d()},c)}};this.createUser=this.createNewUser=function(a,c,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new b.Appacitive.User(a)).save(c,d)};this.signup=function(a,b,c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(a,c,d,f){c=c||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var g=this,m=new b.Appacitive.HttpRequest;m.method="post";m.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();m.data=a;m.onSuccess=function(b){b&&b.user?(f&&(b.user.__authType=f),g.setCurrentUser(b.user,
b.token,a.expiry),c({user:e,token:b.token})):(b=b||{},d(b.status))};m.onError=d;b.Appacitive.http.send(m)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(a,c,d,f){a=a||function(){};c=c||function(){};var g=this,m=function(){var d=
{accesstoken:b.Appacitive.Facebook.accessToken(),type:"facebook",expiry:864E5,createnew:!0};g.authenticateUser(d,function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:e,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};d?m():Appacitive.Facebook.requestLogin(function(a){m()},c)};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var d=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=this;this.getUserByToken(d,function(b){e.setCurrentUser(b,d);"function"==typeof a&&a(!0)},function(){"function"==typeof a&&a(!1)})}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,
subject:c};c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d():e(a)};c.onError=e;b.Appacitive.http.send(c)};var m=function(a,c,d){c=c||function(){};d=d||function(){};var e=new b.Appacitive.HttpRequest;e.url=a;e.method="get";e.onSuccess=function(a){a&&a.user?"function"==typeof c&&c(new Appacitive.User(a.user)):"function"==typeof d&&
d(a.status)};e.onError=d;b.Appacitive.http.send(e)};this.getUserByToken=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);m(a,c,d)};this.getUserByUsername=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);m(a,c,d)};this.logout=
function(a,c){e=null;b.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(b){b.Appacitive.Email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var f=function(c,d,a){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=c;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.email):(b=b||{},b.status=b.status||{},a(b.status.message||"Server error"))};
b.Appacitive.http.send(e)};this.setupEmail=function(b){b=b||{};e.smtp.username=b.username||e.smtp.username;e.from=b.from||e.from;e.smtp.password=b.password||e.smtp.password;e.smtp.host=b.smtp.host||e.smtp.host;e.smtp.port=b.smtp.port||e.smtp.port;e.smtp.enablessl=b.enableSSL||e.smtp.enablessl;e.replyto=b.replyTo||e.replyto};this.sendTemplatedEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.templateName)throw Error("template name is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1==b.isHtml?!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)};this.sendRawEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.body)throw Error("body is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{content:b.body||"",ishtml:!1==b.isHtml?
!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)}}})(global);
(function(b){var e=function(){var b=require("facebook-node-sdk"),c=null,d=this.FB=null,a=!0;this.initialize=function(c){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!c.appId)throw Error("Please provide appid");if(!c.appSecret)throw Error("Please provide app secret");d=c.appSecret;this.FB=new b({appId:_appId,secret:d});a=!0};this.requestLogin=function(b,d,e){a?(c=accesstoken,FB.setAccessToken(e),Appacitive.Users.loginWithFacebook(b,d,!0)):"function"==typeof d&&
d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,d){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&c?(b=b||function(){},d=d||function(){},this.FB.api("/me",function(a,c){c?"function"==typeof b&&b(c):"function"==typeof d&&d("Access token is invalid")})):d("Either intialize facebook with your appid and appsecret or set accesstoken")};this.accessToken=function(){return 1==arguments.length?(c=arguments[0],this):
c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,b){a=a||function(){};Appacitive.Facebook.accessToken="";"function"==typeof a&&a()}};b.Appacitive.Facebook=b.Appacitive.runtime.isBrowser?new function(){var b=null,c=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);c=!0};this.requestLogin=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
d=d||function(){};a=a||function(){};FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,"function"==typeof d&&d(c.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");d=d||function(){};a=a||function(){};FB.api("/me",function(c){c&&!c.error?(b=FB.getAuthResponse().accessToken,"function"==typeof d&&d(c)):"function"==
typeof a&&a()})};this.accessToken=function(){return 1==arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.Facebook.accessToken="";try{FB.logout(function(a){Appacitive.Users.logout();"function"==typeof b&&b()})}catch(c){"function"==typeof a&&a(c.message)}}}:new e})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify push options");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();d.method="post";d.data=e;d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};
this.getNotification=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify notification id");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};this.getAllNotifications=
function(e,f,c){f=f||function(){};c=c||function(){};e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)}}})(global);
(function(b){b.Appacitive.File=function(e){e=e||{};this.fileId=e.fileId;this.contentType=e.contentType;this.fileData=e.fileData;var f=function(a,c,d){var e=new b.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=c;e.onError=d;b.Appacitive.http.send(e)},c=function(a,c,d,e,f){(new FormData).append("fileToUpload",c);var n=new b.Appacitive.HttpRequest;n.url=a;n.method="PUT";n.data=c;n.headers.push({key:"content-type",value:d});n.onSuccess=e;n.onError=f;n.send()};this.save=function(b,c,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,b,c,e):d(this,b,c,e)};var d=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==
b.status.code?c(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this},a=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==b.status.code?c(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(b,that)};d.onError=c;b.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};c=c||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(b){b&&b.status&&"200"==b.status.code?(d.url=b.uri,"function"==typeof a&&a(b.uri)):"function"==typeof c&&"function"==typeof c&&c(b.status,d)};e.onError=c;b.Appacitive.http.send(e);return this}}})(global);
(function(b){b.Appacitive.Date={};b.Appacitive.Date.parseISODate=function(b){try{var f=new Date(b);if(isNaN(f)){var c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,d=!1;if(!c.exec(b))if(c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,c.exec(b))d=!0;else return null;var a=b.split("T"),g=a[0].split("-"),m=a[1].split("Z")[0].split(":"),h=m[2].split("."),l=Number(m[0]),f=new Date;f.setUTCFullYear(Number(g[0]));f.setUTCMonth(Number(g[1])-1);f.setUTCDate(Number(g[2]));
d||(f.setUTCHours(Number(l)),f.setUTCMinutes(Number(m[1])),f.setUTCSeconds(Number(h[0])),h[1]&&f.setUTCMilliseconds(Number(h[1])))}return f}catch(k){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(f){return null}};b.Appacitive.Date.toISODate=function(b){try{return b=b.toISOString().split("T")[0]}catch(f){return null}};b.Appacitive.Date.toISOTime=function(b){try{return b=b.toISOString().split("T")[1],b=b.replace("Z","0000Z")}catch(f){return null}};
b.Appacitive.Date.parseISOTime=function(b){try{var f=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b))return null;var c=b.split("T");1==c.length&&c.push(c[0]);var d=c[1].split("Z")[0].split(":"),a=d[2].split(".");f.setUTCHours(Number(Number(d[0])));f.setUTCMinutes(Number(d[1]));f.setUTCSeconds(Number(a[0]));a[1]&&f.setUTCMilliseconds(Number(a[1]));return f}catch(g){return null}}})(global);
(function(b){b.Appacitive.localStorage=new function(){var e=b.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(b,c){c=c||"";if(!b)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(d){}e[b]=c;return!0};this.get=function(b){if(!b)return null;b=e.getItem(b);if(!b)return null;if("{"==b[0])try{b=JSON.parse(b)}catch(c){}return b};this.remove=function(b){if(b)try{delete e[b]}catch(c){}}}})(global);
(function(b){b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie=new function(){this.setCookie=function(e,f,c,d){var a="";c&&(a=new Date,a.setTime(a.getTime()+6E4*c),a.toGMTString());a=d?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=e+"="+f+a+"; path=/;"+c};this.readCookie=function(b){b+="=";for(var f=document.cookie.split(";"),
c=0;c<f.length;c++){for(var d=f[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(b))return d.substring(b.length,d.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}})})(global);"undefined"==typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{set:e,enumerable:!0,configurable:!0})}}))}catch(defPropException){}
Array.prototype.forEach||(Array.prototype.forEach=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var c=0;c<f;c++)c in this&&b.call(e,this[c],c,this)});"bind"in Function.prototype||(Function.prototype.bind=function(b){var e=this;if(1>=arguments.length)return function(){return e.apply(b,arguments)};var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(b,0===arguments.length?f:f.concat(Array.prototype.slice.call(arguments)))}});
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,e){void 0===e&&(e=0);0>e&&(e+=this.length);0>e&&(e=0);for(var f=this.length;e<f;e++)if(e in this&&this[e]===b)return e;return-1});
"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,e){void 0===e&&(e=this.length-1);0>e&&(e+=this.length);e>this.length-1&&(e=this.length-1);for(e++;0<e--;)if(e in this&&this[e]===b)return e;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,e){for(var f=0,c=this.length;f<c;f++)f in this&&b.call(e,this[f],f,this)});
"map"in Array.prototype||(Array.prototype.map=function(b,e){for(var f=Array(this.length),c=0,d=this.length;c<d;c++)c in this&&(f[c]=b.call(e,this[c],c,this));return f});"filter"in Array.prototype||(Array.prototype.filter=function(b,e){for(var f=[],c,d=0,a=this.length;d<a;d++)d in this&&b.call(e,c=this[d],d,this)&&f.push(c);return f});"every"in Array.prototype||(Array.prototype.every=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&!b.call(e,this[f],f,this))return!1;return!0});
"some"in Array.prototype||(Array.prototype.some=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&b.call(e,this[f],f,this))return!0;return!1});Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(b){function e(b){return 10>b?"0"+b:b}return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON);
var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(a){if(a&&a.send&&"function"==typeof a.send)a.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],b={},d=0,f={},e=0;this.addProcessor=function(a){a&&(a.pre=a.pre||function(){},a.post=a.post||function(){},p(a.pre),q(a.post))};var p=function(a){d+=1;b[d]=a;return d},
q=function(a){e+=1;f[e]=a;return e};this.enqueueRequest=function(a){c.push(a)};this.changeRequestForCors=function(a){var c={m:a.method.toUpperCase()};a.headers.forEach(function(a){c[a.key]=a.value});a.headers=[];a.headers.push({key:"Content-Type",value:"text/plain"});a.method="POST";a.data&&(c.b=a.data);delete a.data;global.Appacitive.config.debug&&(-1==a.url.indexOf("?")?a.url+="?debug=true":a.url+="&debug=true");try{a.data=JSON.stringify(c)}catch(b){}return a};this.notify=function(){if(0!==c.length){var d=
[],l;for(l in f)f.hasOwnProperty(l)&&d.push(f[l]);for(;0<c.length;){var e=c.shift(),n=[];for(l in b)b.hasOwnProperty(l)&&n.push(b[l](e));this.changeRequestForCors(e);a.send(e,d,n)}}};this.onResponse=function(a){console.dir(a)}},e=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(c,b){a()};this.onError=function(c){a()}},f=null,f=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,c=function(a){var c=
new XDomainRequest;c.onload=function(){var b=c.responseText;try{var d=c.contentType;if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=b,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),b=JSON.parse(d)}catch(f){}a.onSuccess(b,this)};c.onerror=c.ontimeout=function(){a.onError({code:"400",message:"Server Error"},c)};c.onprogress=function(){};c.open(a.method,a.url,!0);c.send(a.data);return c},d=function(a){if(!a.url)throw Error("Please specify request url");
a.method||(a.method="GET");a.headers||(a.headers=[]);var d={},b=!0;a.headers.forEach(function(a){"content-type"==a.key.toLowerCase()&&(b=!0,"application/json"==a.value.toLowerCase()||"application/javascript"==a.value.toLowerCase())&&(b=!1)});if(b)d=a.data;else if(a.data&&(d=a.data,"object"==typeof a.data))try{d=JSON.stringify(d)}catch(l){}a.onSuccess&&"function"==typeof a.onSuccess||(a.onSuccess=function(){});a.onError&&"function"==typeof a.onError||(a.onError=function(){});if(-1!=navigator.userAgent.indexOf("MSIE 8")||
-1!=navigator.userAgent.indexOf("MSIE 9"))return a.data=d,new c(a);var k=new f;k.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var d=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=c,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),c=JSON.parse(d)}catch(b){}a.onSuccess(c,
this)}else a.onError({code:this.status,message:this.statusText},this)};k.open(a.method,a.url,!0);for(var e=0;e<a.headers.length;e+=1)k.setRequestHeader(a.headers[e].key,a.headers[e].value);global.Appacitive.runtime.isBrowser||k.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");k.send(d);return k},a=function(){var a=new e;a.isOnline=function(){return!0};var c=function(c,b,f){new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d,e){if(d){try{d=JSON.parse(d)}catch(m){}var r=
d;if(b.length!=f.length)throw Error("Callback length and state length mismatch!");for(var t=0;t<b.length;t+=1)b[t].apply({},[r,f[t]]);a.onResponse(d,c)}else a.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(d){a.onError(c,d)}})};a.send=function(a,d,b){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,d,b)};a.upload=function(a,d,b){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,d,b,!0)};
return a};global.Appacitive.http=new function(){var c=new a,d=new b(c),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;d.addProcessor(a)};this.send=function(a){d.enqueueRequest(a);c.isOnline()&&!1==f&&d.notify()};this.flush=function(a){a?d.notify():c.isOnline()&&d.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,
[c]);else a.onError(c)};c.onError=this.onError;this.onResponse=function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[a]);else c.onSuccess(a)};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new d(this,a)}};(function(a){a.Appacitive&&a.Appacitive.http&&
(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,d){try{a.Appacitive.Session.isSessionValid(c)?c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(d))}catch(b){}}}),a.Appacitive.http.addProcessor({pre:function(a){return(new Date).getTime()},post:function(a,c){var d=(new Date).getTime()-
c;a._timeTakenInMilliseconds=d}}))})(global)})();
(function(b){String.format=function(b,f){if(1>=arguments.length)return b;for(var c=arguments.length-2,d=0;d<=c;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var f=RegExp("^"+b),c=this;f.test(c)&&(c=c.slice(1,c.length));f=RegExp(b+"$");f.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(b){"undefined"==typeof b&&(b="");for(var f=
"",c=0;c<b.length;c+=1)-1==" .,;#".indexOf(b[c])&&(f+=b[c]);return f=f.toLowerCase()};String.contains=function(b,f){return-1!=b.indexOf(f)};String.startsWith=function(b,f){return 0==b.indexOf(f)};Array.distinct=function(b){var f=[],c=b.length,d,a,g;for(a=0;a<c;a++){d=void 0;for(g=0;g<f.length;g++)if(b[a].toLowerCase()===f[g].toLowerCase()){d=!0;break}d||f.push(b[a])}return f};Object.isEmpty=function(b){if(!b)return!0;var f=!0;for(keys in b){f=!1;break}return f};b.dateFromWcf=function(b,f){var c=/Date\(([^)]+)\)/.exec(b);
if(2!=c.length){if(!f)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var e=function(b){"object"==typeof b&&(0<b.length&&("string"==typeof b[0]||"number"==typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user=
{userServiceUrl:"user",getCreateUrl:function(b){return String.format("{0}/create?fields={1}",this.userServiceUrl,e(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token=",this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,b)},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,d){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,b,c,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,e(b))},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.deviceServiceUrl,b)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,
c,d){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),a=d?a+"?psize="+d:a+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!=c[b].trim().length&&(a=a+"&"+c[b]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,b,c)},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.articleServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,e(c))},getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,e(c))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,
b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,d,a){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,d,c);if("undefined"!==typeof a&&0<a.length)for(b=0;b<a.length;b+=1)g=g+"&"+a[b];return g},getConnectedArticles:function(b,c,d){var a="",a=String.format("{0}/{1}/{2}/find",
this.connectionServiceUrl,b,c);if(d&&d.length&&0<d.length)for(b=0;b<d.length;b+=1)a=0==b?a+("?"+d[b]):a+("&"+d[b]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push=
{pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,
c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(d,a){var g=a.split("="),
e=g[1];2<g.length&&g.forEach(function(a,b){0!=a&&1!=a&&(e=e+"="+g[a])});g[0].toLowerCase()==b&&(c=[g[0],e])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var f={};this.subscribe=function(c,d){if("string"!=typeof c||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof f[c]&&(f[c]=[]);var a=b();f[c].push({callback:d,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var d=-1,a=null,g;for(g in f)for(var e=0;e<f[g].length;e+=
1)if(f[g][e].id==b){d=e;a=g;break}return-1!=d?(f[a].splice(d,1),!0):!1};this.fire=function(b,d,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;if("undefined"!=typeof f.all)for(var g=0;g<f.all.length;g+=1)f.all[g].callback(d,a);g=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof f[b])for(var e=0;e<f[b].length;e+=1)g(f[b][e].callback,d,a)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
f[b]&&(f[b].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(f)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},f=null,c=null,d=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){b.Appacitive.Session.create(null)};this.create=function(a,d){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var l=new e;l.apikey=c;var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+"application.svc/session";
g.method="put";g.data=l;g.onSuccess=function(c){c&&c.status&&"200"==c.status.code?(f=c.session.sessionkey,b.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(c),b.Appacitive.Session.onSessionCreated()):d&&"function"==typeof d&&d(c)};g.onError=d;b.Appacitive.http.send(g)};b.Appacitive.http.addProcessor({pre:function(g){b.Appacitive.Session.useApiKey?g.headers.push({key:"ak",value:c}):g.headers.push({key:"as",value:f});!0===a&&(1==g.headers.filter(function(a){return"ut"==a.key}).length?g.headers.forEach(function(a){"ut"==
a.key&&(a.value=d)}):g.headers.push({key:"ut",value:d}))}});this.setUserAuthHeader=function(c,g,l){try{c&&(a=!0,d=c,l||(g||(g=60),-1==g&&(g=null),b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,g),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",g?g:-1,g))))}catch(e){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c,g){c&&("function"!=typeof c&&"boolean"==typeof c)&&(g=c,c=function(){});a=!1;c=c||function(){};b.Appacitive.localStorage.remove("Appacitive-User");
b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(d&&!g)try{var l=new b.Appacitive.HttpRequest;l.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(d);d=null;l.method="POST";l.data={};l.onSuccess=function(){"function"==typeof c&&c()};b.Appacitive.http.send(l)}catch(e){}else d=null,"function"==typeof c&&c()};this.isSessionValid=function(a){if(!a)return!0;
if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){f=null;this.useApiKey=!0};this.get=function(){return f};this.setSession=function(a){a&&(f=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(c=a,this.useApiKey=!0)};var g="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a}return g}};b.Appacitive.initialize=
function(e){if(!b.Appacitive.Session.initialized){if(!e.apikey||0==e.apikey.length)throw Error("apikey is mandatory");b.Appacitive.Session.setApiKey(e.apikey);b.Appacitive.Session.environment(e.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=e.persistUserToken;e.debug&&(b.Appacitive.config.debug=!0);if(e.userToken)-1==e.expiry?e.expiry=null:e.expiry||(e.expiry=3600),b.Appacitive.Session.setUserAuthHeader(e.userToken,e.expiry),e.user?
b.Appacitive.Users.setCurrentUser(e.user):(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e);else if(b.Appacitive.runtime.isBrowser){var f=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(f){var c=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");c||(c=60);(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e,f,c)}}}}})(global);
(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(e){e.headers.push({key:"e",value:b.Appacitive.Session.environment()})}})})(global);
(function(b){var e=b.Appacitive;e.GeoCoord=function(a,b){_validateGeoCoord=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(_validateGeoCoord(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var f=function(){this.toString=function(){}},c=function(a){f.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};c.prototype=new f;c.prototype.constructor=c;var d=function(a){a=a||"";if("object"!=typeof a.value||!a.value.length)throw Error("Specify field value as array");c.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,"string"==typeof this.value[b]?"'"+this.value[b]+"'":"number"==typeof this.value[b]?this.value[b]:this.value[b].toString()));return"("+a.join(" or ")+
")"}};d.prototype=new c;d.prototype.constructor=d;var a=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;c.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};a.prototype=new c;a.prototype.constructor=a;var g=function(a){a=a||"";if(!(a.geoCoord&&a.geoCoord instanceof
e.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};g.prototype=new c;g.prototype.constructor=a;var m=function(a){a=a||"";if(!a.geoCoords||0==a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");c.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0==b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new c;m.prototype.constructor=a;_tagFilter=function(a){f.call(this);a=a||{};if(!a.tags||"object"!=
typeof a.tags||0==a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};_tagFilter.prototype=new f;_tagFilter.prototype.constructor=_tagFilter;_compoundFilter=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var c=0;c<b.length;c+=1){if(!(b[c]instanceof f))throw Error("Invalid filter provided");
this.innerFilters.push(b[c])}this.toString=function(){var a=this.operator,b="(";this.innerFilters.forEach(function(c){b=1==b.length?b+(" "+c.toString()):b+String.format(" {0} {1} ",a,c.toString())});return b+=")"}};_compoundFilter.prototype=new f;_compoundFilter.prototype.constructor=_compoundFilter;var h=function(a){if(!a||0==a.length)throw Error("Specify value");this.value=a;this.getValue=function(){return"string"==typeof this.value?"'"+this.value+"'":"number"==typeof this.value?this.value:"object"==
typeof this.value&&this.value instanceof date?"datetime('"+e.Date.toISOString(this.value)+"')":this.value.toString()}},l=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"date('"+e.Date.toISODate(this.value)+"')":"date('"+this.value+"'')"}},k=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"time('"+e.Date.toISOTime(this.value)+"')":"time('"+this.value+"'')"}},n=function(a){this.value=
a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"datetime('"+e.Date.toISOString(this.value)+"')":"datetime('"+this.value+"'')"}},p=function(b,e,f){f||(f=this);f.type=b;f.name=e;f.equalTo=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"=="})};f.equalToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};f.equalToTime=function(a){return new c({field:this.name,fieldType:this.type,
value:new k(a),operator:"=="})};f.equalToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"=="})};f.greaterThan=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">"})};f.greaterThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};f.greaterThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">"})};f.greaterThanDateTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new n(a),operator:">"})};f.greaterThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">="})};f.greaterThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};f.greaterThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">="})};f.greaterThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),
operator:">="})};f.lessThan=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<"})};f.lessThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};f.lessThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<"})};f.lessThanDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<"})};f.lessThanEqualTo=function(a){return new c({field:this.name,
fieldType:this.type,value:new h(a),operator:"<="})};f.lessThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};f.lessThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<="})};f.lessThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<="})};f.like=function(a){return new c({field:this.name,fieldType:this.type,value:new h("*"+a+"*"),operator:"like"})};
f.startsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a+"*"),operator:"like"})};f.endsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new h("*"+a),operator:"like"})};f.contains=function(a){return new d({field:this.name,fieldType:this.type,value:a,operator:"=="})};f.between=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new h(b),val2:new h(c),operator:"between"})};f.betweenDate=function(b,c){return new a({field:this.name,
fieldType:this.type,val1:new l(b),val2:new l(c),operator:"between"})};f.betweenTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new k(b),val2:new k(c),operator:"between"})};f.betweenDateTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new n(b),val2:new n(c),operator:"between"})};f.withinCircle=function(a,b,c){return new g({field:this.name,fieldType:this.type,geoCoord:a,distance:b,unit:c,operator:"within_circle"})};f.withinPolygon=function(a){return new m({field:this.name,
fieldType:this.type,geoCoords:a,operator:"within_polygon"})}};_propertyExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;p("property",a,this);return this};_aggregateExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=function(a){return b.greaterThanEqualTo(a)};this.lessThan=
function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,c){return b.between(a,c)};return this};_attributeExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};this.contains=function(a){return b.contains(a)};
return this};e.Filter={Property:function(a){return new _propertyExpression(a)},Aggregate:function(a){return new _aggregateExpression(a)},Attribute:function(a){return new _attributeExpression(a)},Or:function(){return new _compoundFilter("or",arguments)},And:function(){return new _compoundFilter("and",arguments)},taggedWithOneOrMore:function(a){return new _tagFilter({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new _tagFilter({tags:a,operator:"tagged_with_all"})}}})(global);
(function(b){b.Appacitive.Queries={};var e=function(b){b=b||{};var a=1,c=20;this.pageNumber=function(){return 1==arguments.length?(a=arguments[0]||1,this):a};this.pageSize=function(){return 1==arguments.length?(c=arguments[0]||20,this):c};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};e.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var f=function(b){b=b||{};var a="__UtcLastUpdatedDate",c=!1;this.orderBy=function(){return 1==arguments.length?(a=
arguments[0]||"__UtcLastUpdatedDate",this):a};this.isAscending=function(){return 1==arguments.length?(c="undefined"==typeof arguments[0]?!1:arguments[0],this):c};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};f.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var c=function(c){var a=c||{},g="",m="",h="",l=a.queryType||"BasicQuery",k=new e(c),n=new f(c),p=a.schema||a.relation,q=a.relation?"connection":"article";this.type=function(){return q};this.entityType=
function(){return p};this.queryType=function(){return l};this.pageQuery=function(){return k};this.pageNumber=function(){return 1==arguments.length?(k.pageNumber(arguments[0]),this):k.pageNumber};this.pageSize=function(){return 1==arguments.length?(k.pageSize(arguments[0]),this):k.pageSize};this.sortQuery=function(){return n};this.orderby=function(){return 1==arguments.length?(n.orderby(arguments[0]),this):n.orderby};this.isAscending=function(){return 1==arguments.length?(n.isAscending(arguments[0]),
this):n.isAscending};this.filter=function(){return 1==arguments.length?(g=arguments[0],this):g};this.freeText=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?m=arguments[0]:"object"==typeof a&&a.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?h=a:"object"==typeof a&&a.length&&(h=a.join(","));return this}return h};this.filter(a.filter||"");this.freeText(a.freeText||"");this.fields(a.fields||
"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(b){for(var c in b)a[c]=b[c];k=new e(a);n=new f(a);return this};this.getQueryString=function(){var a=k.toString()+"&"+n.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");this.fields()&&0<this.fields().trim().length&&
(a+="&fields="+this.fields());return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+q+"/"+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};var r=function(a){var c=[];a||(a=[]);var d="article"==q?"Article":"Connection";a.forEach(function(a){c.push(new b.Appacitive[d](a,
!0))});return c};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(r(b[q+"s"]),b.paginginfo):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};this.count=function(a,c){a=a||function(){};c=c||function(){};var d=k.pageSize,g=k.pageNumber;k.pageSize=1;k.pageNumber=
999999999;var l=this,h=this.toRequest();h.onSuccess=function(b){k.pageSize=d;k.pageNumber=g;b=b||{};var h=b.paginginfo,e=0;if(h)e=h.totalrecords;else if(b.status&&b.status.code&&"200"==b.status.code)e=0;else{b=b.status||{message:"Server error",code:400};"function"==typeof c&&c(b,l);return}"function"==typeof a&&a(e)};h.onError=function(a){k.pageSize=d;k.pageNumber=g;a=a||{message:"Server error",code:400};"function"==typeof c&&c(a,l)};b.Appacitive.http.send(h);return this}};b.Appacitive.Queries.FindAllQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";c.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new c;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedArticlesQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for connected articles query");if(!d.articleId)throw Error("Specify articleId for connected articles query");
d.schema&&delete d.schema;d.queryType="ConnectedArticlesQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.label="";d.label&&("string"==typeof d.label&&0<d.label.length)&&(this.label="&label="+d.label);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.ConnectedArticlesQuery.prototype=
new c;b.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=b.Appacitive.Queries.ConnectedArticlesQuery;b.Appacitive.Queries.GetConnectionsQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!d.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!d.label||0==d.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");d.schema&&delete d.schema;d.queryType="GetConnectionsQuery";c.call(this,
d);this.articleId=d.articleId;this.relation=d.relation;this.label=d.label;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+this.getQueryString()};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;
b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(d,a){d=d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!d.articleBId||"string"!=typeof d.articleBId||0==d.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");d.schema&&delete d.schema;d.queryType=a||"GetConnectionsBetweenArticlesQuery";c.call(this,d);this.articleAId=d.articleAId;
this.articleBId=d.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"==this.queryType&&d.label&&"string"==typeof d.label&&0<d.label.length?"&label="+d.label:"";this.relation=d.relation&&"string"==typeof d.relation&&0<d.relation.length?d.relation+"/":"";this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+
"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,
"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"==typeof a&&a(new b.Appacitive.Connection(d.connection)):(d=d||{},"function"==typeof c&&c(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};return c};b.Appacitive.Queries.InterconnectsQuery=function(d){d=
d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(d.articleBIds&&"object"==typeof d.articleBIds&&0<d.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");d.schema&&delete d.schema;d.queryType="InterconnectsQuery";c.call(this,d);this.articleAId=d.articleAId;this.articleBIds=d.articleBIds;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();
a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new c;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,a){if(!c||0==c.length)throw Error("Specify name of filter query");this.name=c;this.data=
{};this.queryType="GraphFilterQuery";a&&(this.data.placeholders=a);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(b.ids?b.ids:[]):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};
d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}};b.Appacitive.Queries.GraphProjectQuery=function(c,a,g){if(!c||0==c.length)throw Error("Specify name of project query");if(!a||!a.length)throw Error("Specify ids to project");this.name=c;this.data={ids:a};this.queryType="GraphProjectQuery";g&&(this.data.placeholders=g);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";
a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var e=function(a){var b,c;for(c in a)if("status"!==c){b=a[c];break}var d=function(a,b,c){var g=[];a.forEach(function(a){var e=a.__children;delete a.__children;var l=a.__edge;delete a.__edge;a=new Appacitive.Article(a,!0);a.children={};for(var h in e)a.children[h]=[],a.children[h]=d(e[h].values,e[h].parent,a.id);l&&(l.__endpointa={articleid:c,label:b},l.__endpointb={articleid:a.id,
label:l.label},delete l.label,a.connection=new Appacitive.Connection(l));g.push(a)});return g};return d(b.values)};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(e(b)):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}}})(global);
(function(b){b.Appacitive.BaseObject=function(e,f){var c={},d=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var d in a[c])b[c][d]=a[c][d]}else b[c]=a[c]},a={};d(e,a);f&&d(a,c);!c.__id&&a.__id&&(c.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.cid=g;var m="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),h=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=function(){return JSON.parse(JSON.stringify(a))};
this.toJSON=function(){return JSON.parse(JSON.stringify(a))};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};a.__attributes||(a.__attributes={});c.__attributes||(c.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");
a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var k=function(){var b=!1,d=JSON.parse(JSON.stringify(c.__attributes)),g;for(g in a.__attributes)"undefined"==typeof a.__attributes[g]||null===a.__attributes[g]?(d[g]=null,b=!0):a.__attributes[g]!=c.__attributes[g]?(d[g]=a.__attributes[g],b=!0):a.__attributes[g]==c.__attributes[g]&&delete d[g];return b?
d:null};this.getChangedAttributes=k;this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var n=[];a.__tags||(a.__tags=[]);c.__tags||(c.__tags=[]);this.tags=function(){return a.__tags?a.__tags:[]};this.addTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;a.__tags.push(b);
a.__tags=Array.distinct(a.__tags);if(!n||!n.length)return this;b=n.indexOf(b);-1!=b&&n.splice(b,1);return this};this.removeTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;n.push(b);n=Array.distinct(n);if(!a.__tags||!a.__tags.length)return this;b=a.__tags.indexOf(b);-1!=b&&a.__tags.splice(b,1);return this};var p=function(){var b=[];a.__tags.every(function(a){-1==c.__tags.indexOf(a)&&b.push(a)});return b};this.getChangedTags=p;this.getRemovedTags=function(){return _removetags};var q=
function(b){var d=!1,g=JSON.parse(JSON.stringify(c)),e;for(e in a)"undefined"==typeof a[e]||null===a[e]?(g[e]=null,d=!0):a[e]!=c[e]?"__tags"==e||"__attributes"==e?delete g[e]:(g[e]=a[e],d=!0):a[e]==c[e]&&delete g[e];try{m.forEach(function(a){g[a]&&delete g[a]})}catch(l){}b?(a.__tags&&0<a.__tags.length&&(g.__addtags=p(),d=!0),n&&0<n.length&&(g.__removetags=n,d=!0)):a.__tags&&0<a.__tags.length&&(g.__tags=p(),d=!0);(b=k())?(g.__attributes=b,d=!0):delete g.__attributes;return d?g:!1};this.changed=function(){return q()};
this.hasChanged=function(){var a=q(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=q(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&
arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return c};var r="";this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?r=a:"object"==typeof a&&a.length&&(r=a.join(","));return this}return r};this.get=function(b){if(b)return a[b]};this.set=function(b,c){if(!b||"string"!=typeof b||0==b.length)return this;null==c||"undefined"==c?a[b]=null:"string"==typeof c?a[b]=c:"number"==typeof c?a[b]=c+"":"object"==typeof c&&(0<=c.length?a[b]=c:-1!==h.indexOf(b)&&
(a[b]=c));return this};this.unset=function(b){if(!b||"string"!=typeof b||0==b.length||0==b.indexOf("__"))return this;try{delete a[b]}catch(c){}return this};this.has=function(b){return b&&"string"==typeof b&&0!=b.length?a[b]&&"undefined"!=typeof a[b]?!0:!1:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(b,g){b&&(d(b,a),d(b,c));return this};this.save=function(b,c){a.__id?
u.apply(this,arguments):t.apply(this,arguments);return this};var t=function(g,e){g=g||function(){};e=e||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,r);!a.__schematype||"user"!=a.__schematype.toLowerCase()&&"device"!=a.__schematype.toLowerCase()||(k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl());var f=new b.Appacitive.HttpRequest;f.url=
k;f.method="put";a.__revision&&delete a.__revision;f.data=a;f.onSuccess=function(k){var f=null;k&&(k.article||k.connection||k.user||k.device)&&(f=k.article||k.connection||k.user||k.device);k&&f?(c=f,a.__id=f.__id,d(f,a),h.connectionCollections&&0<h.connectionCollections.length&&h.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})}),"connection"==h.type&&h.parseConnection(),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".created",h,{object:h}),
"function"==typeof g&&g(h)):(k=k||{},k.status=k.status||{},k.status=l(k.status),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".createFailed",h,{error:k.status}),"function"==typeof e&&e(k.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this},u=function(g,e){g=g||function(){};e=e||function(){};var h=q(!0),k=this;if(h){var f=new b.Appacitive.HttpRequest,m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||
a.__relationtype,c.__id?c.__id:a.__id,r);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&(m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(c.__id));f.url=m;f.method="post";f.data=h;f.onSuccess=function(h){h&&(h.article||h.connection||h.user||h.device)?(c=h.article||h.connection||h.user||h.device,d(c,a),n=[],b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updated",
k,{object:k}),"function"==typeof g&&g(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updateFailed",k,{object:h.status}),"function"==typeof e&&e(h.status,k))};f.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==typeof e&&e(a,k)};b.Appacitive.http.send(f)}else"function"==typeof g&&g(k);return this};this.fetch=function(g,e){g=g||function(){};e=e||function(){};if(a.__id){var h=
this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,r),f=new b.Appacitive.HttpRequest;f.url=k;f.method="get";f.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,d(c,a),h.___collection&&"article"==h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof g&&g(h)):(b=b||{},b.status=b.status||{},b.status=l(b),"function"==typeof e&&
e(b.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this}"function"==typeof e&&e({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,d,e){if(a.__id){c=c||function(){};d=d||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl,k=k+b.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&
(k=b.Appacitive.config.apiBaseUrl,k+=b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id));e&&!0===e&&(k=-1==k.indexOf("?")?k+"?deleteconnections=true":k+"&deleteconnections=true");e=new b.Appacitive.HttpRequest;e.url=k;e.method="delete";e.onSuccess=function(b){"200"==b.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof c&&c(b)):(b=l(b),"function"==typeof d&&d(b,h))};e.onError=function(a){a=l(a);"function"==typeof d&&d(a,h)};b.Appacitive.http.send(e)}else this.___collection&&
this.___collection.removeByCId(g),"function"==typeof c&&c(this)}};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var e=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),c="",d,a,g,m,h,l,k=0,b=b.replace(/\r\n/g,"\n");a="";for(g=0;g<b.length;g++)m=b.charCodeAt(g),128>m?a+=String.fromCharCode(m):(127<m&&2048>m?a+=String.fromCharCode(m>>6|192):(a+=String.fromCharCode(m>>12|224),a+=String.fromCharCode(m>>6&63|128)),a+=String.fromCharCode(m&63|128));for(b=a;k<b.length;)d=b.charCodeAt(k++),a=b.charCodeAt(k++),
g=b.charCodeAt(k++),m=d>>2,d=(d&3)<<4|a>>4,h=(a&15)<<2|g>>6,l=g&63,isNaN(a)?h=l=64:isNaN(g)&&(l=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return c.toString()}})(global);
(function(b){b.Appacitive.ArticleCollection=function(e){var f=null,c=null,d=[],a={};"string"==typeof e?a.schema=e:a=e;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var f=a.schema,g=this;e=function(d){d.type="article";d.schema?f=d.schema:d.schema=f;c=new b.Appacitive.Queries.FindAllQuery(d);a=d;g.extendOptions=c.extendOptions};this.setFilter=function(d){a.filter=d;a.type="article";c?c.filter(d):(c=new b.Appacitive.Queries.FindAllQuery(a),
g.extendOptions=c.extendOptions);return this};this.setFreeText=function(d){d||0!=d.trim().length||(a.freeText="");a.freeText=d;a.type="article";c?c.freeText(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.setFields=function(d){d||(d="");a.fields=d;a.type="article";c?c.fields(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.reset=function(){f=a=null;d.length=0;c=null};var m=["BasicFilterQuery"];this.query=
function(){if(1==arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==m.indexOf(a.queryType()))throw Error("ArticleCollection only accepts "+m.join(", "));d.length=0;c=a;return this}return c};this.setOptions=e;e(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=f)throw Error("Null article passed or schema type mismatch");
var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!=b?d.splice(b,1):d.push(a);return this};this.getArticleById=function(a){var b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllArticles=function(){return Array.prototype.slice.call(d).map(function(a){return a.getArticle()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getArticle().__id&&
c.getArticle().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var h=function(a,b,c){a.length&&0!==a.length||(a=[]);a.forEach(function(a){a.___collection=g;d.push(a)});"function"==typeof c&&c(b,g)};this.fetch=function(a,b){d.length=0;c.fetch(function(b,c){h(b,c,a)},function(a){"function"==typeof b&&b(a,g)});return this};this.count=function(a,b){this.query.count(a,
b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=f;a=new b.Appacitive.Article(a);a.___collection=g;d.push(a);return a};this.map=
function(){return d.map.apply(this,arguments)};this.forEach=function(){return d.forEach.apply(this,arguments)};this.filter=function(){return d.filter.apply(this,arguments)}};b.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};b.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};b.Appacitive.ArticleCollection.prototype.articles=function(){return this.getAll()};b.Appacitive.ArticleCollection.prototype.length=
function(){return this.articles.length}})(global);
(function(b){b.Appacitive.ConnectionCollection=function(e){var f=null,c=null,d=[],a=[],g={};"string"==typeof e?g.relation=e:g=e;this.collectionType="connection";var m=this;if(!e||!e.relation)throw Error("Must provide relation while initializing ConnectionCollection.");f=e.relation;e=function(a){a.type="connection";a.relation?f=a.relation:a.relation=f;c=new b.Appacitive.Queries.FindAllQuery(a);g=a;return m};this.setFilter=function(a){g.filter=a;g.type="connection";c?c.filter(a):(c=new b.Appacitive.Queries.FindAllQuery(g),
m.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){a||0!=a.trim().length||(g.freeText="");g.freeText=a;g.type="connection";c?c.freeText(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";c?c.fields(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.query=function(){if(1==arguments.length){var b=arguments[0];if(!b||
!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==h.indexOf(b.queryType()))throw Error("ConnectionCollection only accepts "+h.join(", "));a.length=0;d.length=0;c=b;return this}return c};var h=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.reset=function(){f=g=null;a.length=0;d.length=0;c=null};this.setOptions=e;e(g);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,
10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=f)throw Error("Null connection passed or relation type mismatch");var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!==b?d.splice(b,1):d.push(a);return this};this.getConnection=function(a,b,c){b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllConnections=
function(){return Array.prototype.slice.call(d).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getConnection().__id&&c.getConnection().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var l=function(b,e,g){"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&(b=[b]);b.length&&
0!==b.length||(b=[]);b.forEach(function(b){b.___collection=m;if(b.endpointA.article||b.endpointB.article){var c=b.endpointA.article||b.endpointB.article;c.___collection=m;a.push(c)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(e){}d.push(b)});"function"==typeof g&&g(e,m)};this.getConnectedArticle=function(b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(a,b){d.length=0;c.fetch(function(b,
c){l(b,c,a)},function(a){"function"==typeof b&&b(a,m)});return this};this.count=function(a,b){c.count(a,b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewConnection=function(a){a=
a||{};a.__relationtype=f;a=new b.Appacitive.Connection(a);a.___collection=m;d.push(a);return a};this.map=function(){return d.map.apply(this,arguments)};this.forEach=function(a,b){return d.forEach(a,b||this)};this.filter=function(){return d.filter.apply(this,arguments)}}})(global);
(function(b){var e=function(c,d){c=c||function(){};d=d||function(){};var a=new b.Appacitive.HttpRequest;a.method="get";a.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(a){a?c(a):d()}):d({code:"404",message:"fb account not found"})};
a.onError=d;b.Appacitive.http.send(a)};b.Appacitive.Article=function(c,d){c=c||{};"string"==typeof c&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);b.Appacitive.BaseObject.call(this,c,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=e);return this};b.Appacitive.Article.prototype=new b.Appacitive.BaseObject;
b.Appacitive.Article.prototype.constructor=b.Appacitive.Article;b.Appacitive.Article.prototype.getConnections=function(c){if("article"!=this.type)return null;c=c||{};c.articleId=this.get("__id");var d=new b.Appacitive.ConnectionCollection({relation:c.relation});this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.GetConnectionsQuery(c));return d};b.Appacitive.Article.prototype.getConnectedArticles=function(c){c=c||{};"string"==typeof c&&(rName=c,c={relation:rName});c.articleId=this.get("__id");
var d=new b.Appacitive.ConnectionCollection({relation:c.relation});d.connectedArticle=this;this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.ConnectedArticlesQuery(c));return d};b.Appacitive.Article.multiDelete=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if("user"==c.schema.toLowerCase()||"device"==c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(c.ids&&0<c.ids.length){d=
d||function(){};a=a||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);e.method="post";e.data={idlist:c.ids};e.onSuccess=function(b){b&&"200"==b.code?"function"==typeof d&&d():(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else d()};var f=function(c){var d=
[];c.forEach(function(a){d.push(new b.Appacitive.Article(a))});return d};b.Appacitive.Article.multiGet=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if(c.ids&&0<c.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);e.method="get";e.onSuccess=function(b){b&&b.articles?"function"==typeof d&&d(f(b.articles),b.paginginfo):
(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof a&&a(b)};b.Appacitive.http.send(e)}else"function"==typeof d&&d([])};b.Appacitive.Article.get=function(c,d,a){c=c||{};if(!c.schema)throw Error("Specify schema");if(!c.id)throw Error("Specify id to fetch");var e={},e="user"==c.schema.toLowerCase()?new b.Appacitive.User({__id:c.id}):new b.Appacitive.Article({__schematype:c.schema,__id:c.id});
e.fields=c.fields;e.fetch(d,a);return e}})(global);
(function(b){var e=function(a,c,d){var e={label:a.label};a.articleid&&(e.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?e.articleid=a.article.get("__id"):e.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?e.articleid=a.article.__id:e.article=a.article,a.article=new b.Appacitive.Article(a.article));else if(!e.articleid&&!e.article)throw Error("Incorrectly configured endpoints provided to setupConnection");d["endpoint"+
c]=a;return e},f=function(a,c,d){a.article&&"object"==typeof a.article?(d["endpoint"+c]?d["endpoint"+c]&&d["endpoint"+c].article&&d["endpoint"+c].article.getArticle?d["endpoint"+c].article.copy(a.article):d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0):(d["endpoint"+c]={},d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0)),d["endpoint"+c].articleid=a.articleid,d["endpoint"+c].label=a.label,d["endpoint"+c].type=a.type,d["endpoint"+c].article.___collection=d.___collection):
d["endpoint"+c]=a};b.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw Error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);b.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b=
"A",c="B";a.__endpointa.label!=this.get("__endpointb").label||(a.__endpointa.label==a.__endpointb.label||a.__endpointa.articleid!=this.get("__endpointb").articleid&&a.__endpointa.articleid)||(b="B",c="A");f(this.get("__endpointa"),b,this);f(this.get("__endpointb"),c,this);this.endpoints=function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};c?(this.connectedArticle=function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(b=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(b)},this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.prototype.setupConnection=function(a,b){if(!(a&&(a.articleid||a.article)&&a.label&&b&&(b.articleid||b.article)&&b.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",e(a,"A",this));this.set("__endpointb",e(b,"B",this))};b.Appacitive.Connection.get=function(a,c,d){a=a||{};if(!a.relation)throw Error("Specify relation");if(!a.id)throw Error("Specify id to fetch");var e=new b.Appacitive.Connection({__relationtype:a.relation,
__id:a.id});e.fields=a.fields;e.fetch(c,d)};var c=function(a){var c=[];a||(a=[]);a.forEach(function(a){c.push(new b.Appacitive.Connection(a))});return c},d=function(a,d,e){a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"==typeof d&&d(c(a.connections),a.paginginfo):(a=a||{},"function"==typeof e&&e(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof e&&e(a)};b.Appacitive.http.send(a)};b.Appacitive.Connection.multiGet=
function(a,c,e){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var h=new b.Appacitive.HttpRequest;h.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(a.relation,a.ids.join(","),a.fields);h.method="get";return d(h,c,e)}"function"==typeof c&&c([])};b.Appacitive.Connection.multiDelete=function(a,c,d){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");
if(a.ids&&0<a.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);e.method="post";e.data={idlist:a.ids};e.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof d&&d(a||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof d&&d(a||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else c()};b.Appacitive.Connection.getInterconnects=
function(a,b,c){a=new Appacitive.Queries.InterconnectsQuery(a);d(a.toRequest(),request,b,c)};b.Appacitive.Connection.getBetweenArticles=function(a,b,c){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);d(a.toRequest(),b,c)};b.Appacitive.Connection.getBetweenArticlesForRelation=function(a,b,c){(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).fetch(b,c)}})(global);
(function(b){b.Appacitive.Users=new function(){var e=null;this.currentUser=function(){return e};var f=function(a,c,d,e,f){var g=a.get("__id");if(!g||"string"!==typeof g||0==g.length)throw Error("Please specify valid userid");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid oldPassword");if(!d||"string"!==typeof d||0==d.length)throw Error("Please specify valid newPassword");e=e||function(){};f=f||function(){};c==d?"function"==typeof e&&e(a):(c={oldpassword:c,newpassword:d},
d=new b.Appacitive.HttpRequest,d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g),d.method="post",d.data=c,d.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof e?e(a):f(b,a))},d.onError=f,b.Appacitive.http.send(d))},c=function(a,c,d){var e=a.get("__id");e&&"string"===typeof e&&0!=e.length||"function"==typeof c&&c(a.linkedAccounts(),a);c=c||function(){};d=d||function(){};var f=new b.Appacitive.HttpRequest;f.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(e);f.method="get";f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(b=b.identities||[],0<b.length?a.set("__link",b):a.set("__link",null),"function"==typeof c&&c(b,a)):d(b.status,a)};f.onError=d;b.Appacitive.http.send(f)},d=function(a,c,d,e){var f=c.get("__id");f&&"string"===typeof f&&0!=f.length||d&&"function"==typeof d&&d();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");d=d||function(){};e=e||function(){};
var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getCheckinUrl(f,a.lat,a.lng);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d(accounts,c):"function"==typeof e&&e(a,c)};g.onError=e;b.Appacitive.http.send(g)},a=function(a,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);g.method="post";g.data=f;g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else c.set("__link",f),"function"==typeof d&&d(c)},g=function(a,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);g.method=
"post";g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else"function"==typeof d&&d(c)};this.setCurrentUser=function(c,l,k){if(!c)throw Error("Cannot set null object as user");var m=c;if(m instanceof Appacitive.User)if(m.get("__id")&&0!=m.get("__id").length)c=m.toJSON();else throw Error("Specify user __id");else m=new b.Appacitive.User(c,!0);b.Appacitive.localStorage.set("Appacitive-User",c);k||(k=60);e=m;l&&b.Appacitive.Session.setUserAuthHeader(l,
k);e.logout=function(a){b.Appacitive.Users.logout(a)};e.updatePassword=function(a,b,c,d){f(this,a,b,c,d);return this};e.linkFacebookAccount=function(c,d){var f=function(){a(Appacitive.Facebook.accessToken(),e,function(a){b.Appacitive.eventManager.fire("user..article."+a.get("__id")+".updated",a,{object:a});"function"==typeof c&&c(a)},d)};Appacitive.Facebook.getCurrentUserInfo(function(){f()},function(){Appacitive.Facebook.requestLogin(function(){f()},d)});return this};e.unlinkFacebookAccount=function(a,
c){g("facebook",this,function(c){b.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};e.logout=function(a){Appacitive.Users.logout(a)};e.checkin=function(a,b,c){d(a,this,b,c);return this};b.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(a,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return e};b.Appacitive.User=function(a){a=a||{};a.__schematype="user";
b.Appacitive.Article.call(this,a);return this};b.Appacitive.User.prototype=new b.Appacitive.Article("user");b.Appacitive.User.prototype.constructor=b.Appacitive.User;b.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?"object"!=typeof a||0<=a.length?0<=a.length||(a=a[0]):a=[a]:a=[];return a};b.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this;c(this,function(b){"function"==typeof a&&a(b,d)},b);return this};b.Appacitive.User.prototype.linkFacebookAccount=
function(b,c,d){a(b,this,c,d);return this};b.Appacitive.User.prototype.unlinkFacebookAccount=function(a,b){var c=this;g("facebook",this,function(){var b=c.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&c.set("__link",null);"function"==typeof a&&a(c)},b);return this};b.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,d){if(!a)throw Error("Specify userid for user delete");c=c||function(){};d=d||function(){};
(new b.Appacitive.Article({__schematype:"user",__id:a})).del(c,d)};this.deleteCurrentUser=function(a,c){var d=function(){b.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a()};if(null===e)d();else{var f=e.get("__id");this.deleteUser(f,function(){d()},c)}};this.createUser=this.createNewUser=function(a,c,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new b.Appacitive.User(a)).save(c,d)};this.signup=function(a,b,c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(a,c,d,f){c=c||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var g=this,m=new b.Appacitive.HttpRequest;m.method="post";m.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();m.data=a;m.onSuccess=function(b){b&&b.user?(f&&(b.user.__authType=f),g.setCurrentUser(b.user,
b.token,a.expiry),c({user:e,token:b.token})):(b=b||{},d(b.status))};m.onError=d;b.Appacitive.http.send(m)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(a,c,d,f){a=a||function(){};c=c||function(){};var g=this,m=function(){var d=
{accesstoken:b.Appacitive.Facebook.accessToken(),type:"facebook",expiry:864E5,createnew:!0};g.authenticateUser(d,function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:e,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};d?m():Appacitive.Facebook.requestLogin(function(a){m()},c)};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var d=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=this;this.getUserByToken(d,function(b){e.setCurrentUser(b,d);"function"==typeof a&&a(!0)},function(){"function"==typeof a&&a(!1)})}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,
subject:c};c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d():e(a)};c.onError=e;b.Appacitive.http.send(c)};var m=function(a,c,d){c=c||function(){};d=d||function(){};var e=new b.Appacitive.HttpRequest;e.url=a;e.method="get";e.onSuccess=function(a){a&&a.user?"function"==typeof c&&c(new Appacitive.User(a.user)):"function"==typeof d&&
d(a.status)};e.onError=d;b.Appacitive.http.send(e)};this.getUserByToken=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);m(a,c,d)};this.getUserByUsername=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);m(a,c,d)};this.logout=
function(a,c){e=null;b.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(b){b.Appacitive.Email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var f=function(c,d,a){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=c;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.email):(b=b||{},b.status=b.status||{},a(b.status.message||"Server error"))};
b.Appacitive.http.send(e)};this.setupEmail=function(b){b=b||{};e.smtp.username=b.username||e.smtp.username;e.from=b.from||e.from;e.smtp.password=b.password||e.smtp.password;e.smtp.host=b.smtp.host||e.smtp.host;e.smtp.port=b.smtp.port||e.smtp.port;e.smtp.enablessl=b.enableSSL||e.smtp.enablessl;e.replyto=b.replyTo||e.replyto};this.sendTemplatedEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.templateName)throw Error("template name is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1==b.isHtml?!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)};this.sendRawEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.body)throw Error("body is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{content:b.body||"",ishtml:!1==b.isHtml?
!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)}}})(global);
(function(b){var e=function(){var b=require("facebook-node-sdk"),c=null,d=this.FB=null,a=!0;this.initialize=function(c){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!c.appId)throw Error("Please provide appid");if(!c.appSecret)throw Error("Please provide app secret");d=c.appSecret;this.FB=new b({appId:_appId,secret:d});a=!0};this.requestLogin=function(b,d,e){a?(c=accesstoken,FB.setAccessToken(e),Appacitive.Users.loginWithFacebook(b,d,!0)):"function"==typeof d&&
d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,d){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&c?(b=b||function(){},d=d||function(){},this.FB.api("/me",function(a,c){c?"function"==typeof b&&b(c):"function"==typeof d&&d("Access token is invalid")})):d("Either intialize facebook with your appid and appsecret or set accesstoken")};this.accessToken=function(){return 1==arguments.length?(c=arguments[0],this):
c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,b){a=a||function(){};Appacitive.Facebook.accessToken="";"function"==typeof a&&a()}};b.Appacitive.Facebook=b.Appacitive.runtime.isBrowser?new function(){var b=null,c=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);c=!0};this.requestLogin=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
d=d||function(){};a=a||function(){};FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,"function"==typeof d&&d(c.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");d=d||function(){};a=a||function(){};FB.api("/me",function(c){c&&!c.error?(b=FB.getAuthResponse().accessToken,"function"==typeof d&&d(c)):"function"==
typeof a&&a()})};this.accessToken=function(){return 1==arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.Facebook.accessToken="";try{FB.logout(function(a){Appacitive.Users.logout();"function"==typeof b&&b()})}catch(c){"function"==typeof a&&a(c.message)}}}:new e})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify push options");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();d.method="post";d.data=e;d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};
this.getNotification=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify notification id");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};this.getAllNotifications=
function(e,f,c){f=f||function(){};c=c||function(){};e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)}}})(global);
(function(b){b.Appacitive.File=function(e){e=e||{};this.fileId=e.fileId;this.contentType=e.contentType;this.fileData=e.fileData;var f=function(a,c,d){var e=new b.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=c;e.onError=d;b.Appacitive.http.send(e)},c=function(a,c,d,e,f){(new FormData).append("fileToUpload",c);var n=new b.Appacitive.HttpRequest;n.url=a;n.method="PUT";n.data=c;n.headers.push({key:"content-type",value:d});n.onSuccess=e;n.onError=f;n.send()};this.save=function(b,c,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,b,c,e):d(this,b,c,e)};var d=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==
b.status.code?c(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this},a=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==b.status.code?c(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(b,that)};d.onError=c;b.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};c=c||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(b){b&&b.status&&"200"==b.status.code?(d.url=b.uri,"function"==typeof a&&a(b.uri)):"function"==typeof c&&"function"==typeof c&&c(b.status,d)};e.onError=c;b.Appacitive.http.send(e);return this}}})(global);
(function(b){b.Appacitive.Date={};b.Appacitive.Date.parseISODate=function(b){try{var f=new Date(b);if(isNaN(f)){var c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,d=!1;if(!c.exec(b))if(c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,c.exec(b))d=!0;else return null;var a=b.split("T"),g=a[0].split("-"),m=a[1].split("Z")[0].split(":"),h=m[2].split("."),l=Number(m[0]),f=new Date;f.setUTCFullYear(Number(g[0]));f.setUTCMonth(Number(g[1])-1);f.setUTCDate(Number(g[2]));
d||(f.setUTCHours(Number(l)),f.setUTCMinutes(Number(m[1])),f.setUTCSeconds(Number(h[0])),h[1]&&f.setUTCMilliseconds(Number(h[1])))}return f}catch(k){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(f){return null}};b.Appacitive.Date.toISODate=function(b){try{return b=b.toISOString().split("T")[0]}catch(f){return null}};b.Appacitive.Date.toISOTime=function(b){try{return b=b.toISOString().split("T")[1],b=b.replace("Z","0000Z")}catch(f){return null}};
b.Appacitive.Date.parseISOTime=function(b){try{var f=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b))return null;var c=b.split("T");1==c.length&&c.push(c[0]);var d=c[1].split("Z")[0].split(":"),a=d[2].split(".");f.setUTCHours(Number(Number(d[0])));f.setUTCMinutes(Number(d[1]));f.setUTCSeconds(Number(a[0]));a[1]&&f.setUTCMilliseconds(Number(a[1]));return f}catch(g){return null}}})(global);
(function(b){b.Appacitive.localStorage=new function(){var e=b.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(b,c){c=c||"";if(!b)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(d){}e[b]=c;return!0};this.get=function(b){if(!b)return null;b=e.getItem(b);if(!b)return null;if("{"==b[0])try{b=JSON.parse(b)}catch(c){}return b};this.remove=function(b){if(b)try{delete e[b]}catch(c){}}}})(global);
(function(b){b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie=new function(){this.setCookie=function(e,f,c,d){var a="";c&&(a=new Date,a.setTime(a.getTime()+6E4*c),a.toGMTString());a=d?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=e+"="+f+a+"; path=/;"+c};this.readCookie=function(b){b+="=";for(var f=document.cookie.split(";"),
c=0;c<f.length;c++){for(var d=f[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(b))return d.substring(b.length,d.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}})})(global);"undefined"==typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{set:e,enumerable:!0,configurable:!0})}}))}catch(defPropException){}
Array.prototype.forEach||(Array.prototype.forEach=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var c=0;c<f;c++)c in this&&b.call(e,this[c],c,this)});"bind"in Function.prototype||(Function.prototype.bind=function(b){var e=this;if(1>=arguments.length)return function(){return e.apply(b,arguments)};var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(b,0===arguments.length?f:f.concat(Array.prototype.slice.call(arguments)))}});
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,e){void 0===e&&(e=0);0>e&&(e+=this.length);0>e&&(e=0);for(var f=this.length;e<f;e++)if(e in this&&this[e]===b)return e;return-1});
"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,e){void 0===e&&(e=this.length-1);0>e&&(e+=this.length);e>this.length-1&&(e=this.length-1);for(e++;0<e--;)if(e in this&&this[e]===b)return e;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,e){for(var f=0,c=this.length;f<c;f++)f in this&&b.call(e,this[f],f,this)});
"map"in Array.prototype||(Array.prototype.map=function(b,e){for(var f=Array(this.length),c=0,d=this.length;c<d;c++)c in this&&(f[c]=b.call(e,this[c],c,this));return f});"filter"in Array.prototype||(Array.prototype.filter=function(b,e){for(var f=[],c,d=0,a=this.length;d<a;d++)d in this&&b.call(e,c=this[d],d,this)&&f.push(c);return f});"every"in Array.prototype||(Array.prototype.every=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&!b.call(e,this[f],f,this))return!1;return!0});
"some"in Array.prototype||(Array.prototype.some=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&b.call(e,this[f],f,this))return!0;return!1});Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(b){function e(b){return 10>b?"0"+b:b}return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON);
var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(a){if(a&&a.send&&"function"==typeof a.send)a.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],b={},d=0,f={},e=0;this.addProcessor=function(a){a&&(a.pre=a.pre||function(){},a.post=a.post||function(){},p(a.pre),q(a.post))};var p=function(a){d+=1;b[d]=a;return d},
q=function(a){e+=1;f[e]=a;return e};this.enqueueRequest=function(a){c.push(a)};this.changeRequestForCors=function(a){var c={m:a.method.toUpperCase()};a.headers.forEach(function(a){c[a.key]=a.value});a.headers=[];a.headers.push({key:"Content-Type",value:"text/plain"});a.method="POST";a.data&&(c.b=a.data);delete a.data;global.Appacitive.config.debug&&(-1==a.url.indexOf("?")?a.url+="?debug=true":a.url+="&debug=true");try{a.data=JSON.stringify(c)}catch(b){}return a};this.notify=function(){if(0!==c.length){var d=
[],l;for(l in f)f.hasOwnProperty(l)&&d.push(f[l]);for(;0<c.length;){var e=c.shift(),n=[];for(l in b)b.hasOwnProperty(l)&&n.push(b[l](e));this.changeRequestForCors(e);a.send(e,d,n)}}};this.onResponse=function(a){console.dir(a)}},e=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(c,b){a()};this.onError=function(c){a()}},f=null,f=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,c=function(a){var c=
new XDomainRequest;c.onload=function(){var b=c.responseText;try{var d=c.contentType;if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=b,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),b=JSON.parse(d)}catch(f){}a.onSuccess(b,this)};c.onerror=c.ontimeout=function(){a.onError({code:"400",message:"Server Error"},c)};c.onprogress=function(){};c.open(a.method,a.url,!0);c.send(a.data);return c},d=function(a){if(!a.url)throw Error("Please specify request url");
a.method||(a.method="GET");a.headers||(a.headers=[]);var d={},b=!0;a.headers.forEach(function(a){"content-type"==a.key.toLowerCase()&&(b=!0,"application/json"==a.value.toLowerCase()||"application/javascript"==a.value.toLowerCase())&&(b=!1)});if(b)d=a.data;else if(a.data&&(d=a.data,"object"==typeof a.data))try{d=JSON.stringify(d)}catch(l){}a.onSuccess&&"function"==typeof a.onSuccess||(a.onSuccess=function(){});a.onError&&"function"==typeof a.onError||(a.onError=function(){});if(-1!=navigator.userAgent.indexOf("MSIE 8")||
-1!=navigator.userAgent.indexOf("MSIE 9"))return a.data=d,new c(a);var k=new f;k.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var d=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=c,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),c=JSON.parse(d)}catch(b){}a.onSuccess(c,
this)}else a.onError({code:this.status,message:this.statusText},this)};k.open(a.method,a.url,!0);for(var e=0;e<a.headers.length;e+=1)k.setRequestHeader(a.headers[e].key,a.headers[e].value);global.Appacitive.runtime.isBrowser||k.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");k.send(d);return k},a=function(){var a=new e;a.isOnline=function(){return!0};var c=function(c,b,f){new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d,e){if(d){try{d=JSON.parse(d)}catch(m){}var r=
d;if(b.length!=f.length)throw Error("Callback length and state length mismatch!");for(var t=0;t<b.length;t+=1)b[t].apply({},[r,f[t]]);a.onResponse(d,c)}else a.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(d){a.onError(c,d)}})};a.send=function(a,d,b){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,d,b)};a.upload=function(a,d,b){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,d,b,!0)};
return a};global.Appacitive.http=new function(){var c=new a,d=new b(c),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;d.addProcessor(a)};this.send=function(a){d.enqueueRequest(a);c.isOnline()&&!1==f&&d.notify()};this.flush=function(a){a?d.notify():c.isOnline()&&d.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,
[c]);else a.onError(c)};c.onError=this.onError;this.onResponse=function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[a]);else c.onSuccess(a)};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new d(this,a)}};(function(a){a.Appacitive&&a.Appacitive.http&&
(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,d){try{a.Appacitive.Session.isSessionValid(c)?c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(d))}catch(b){}}}),a.Appacitive.http.addProcessor({pre:function(a){return(new Date).getTime()},post:function(a,c){var d=(new Date).getTime()-
c;a._timeTakenInMilliseconds=d}}))})(global)})();
(function(b){String.format=function(b,f){if(1>=arguments.length)return b;for(var c=arguments.length-2,d=0;d<=c;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var f=RegExp("^"+b),c=this;f.test(c)&&(c=c.slice(1,c.length));f=RegExp(b+"$");f.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(b){"undefined"==typeof b&&(b="");for(var f=
"",c=0;c<b.length;c+=1)-1==" .,;#".indexOf(b[c])&&(f+=b[c]);return f=f.toLowerCase()};String.contains=function(b,f){return-1!=b.indexOf(f)};String.startsWith=function(b,f){return 0==b.indexOf(f)};Array.distinct=function(b){var f=[],c=b.length,d,a,g;for(a=0;a<c;a++){d=void 0;for(g=0;g<f.length;g++)if(b[a].toLowerCase()===f[g].toLowerCase()){d=!0;break}d||f.push(b[a])}return f};Object.isEmpty=function(b){if(!b)return!0;var f=!0;for(keys in b){f=!1;break}return f};b.dateFromWcf=function(b,f){var c=/Date\(([^)]+)\)/.exec(b);
if(2!=c.length){if(!f)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var e=function(b){"object"==typeof b&&(0<b.length&&("string"==typeof b[0]||"number"==typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user=
{userServiceUrl:"user",getCreateUrl:function(b){return String.format("{0}/create?fields={1}",this.userServiceUrl,e(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token=",this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,b)},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,d){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,b,c,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,e(b))},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.deviceServiceUrl,b)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,
c,d){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),a=d?a+"?psize="+d:a+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!=c[b].trim().length&&(a=a+"&"+c[b]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,b,c)},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.articleServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,e(c))},getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,e(c))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,
b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,d,a){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,d,c);if("undefined"!==typeof a&&0<a.length)for(b=0;b<a.length;b+=1)g=g+"&"+a[b];return g},getConnectedArticles:function(b,c,d){var a="",a=String.format("{0}/{1}/{2}/find",
this.connectionServiceUrl,b,c);if(d&&d.length&&0<d.length)for(b=0;b<d.length;b+=1)a=0==b?a+("?"+d[b]):a+("&"+d[b]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push=
{pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,
c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(d,a){var g=a.split("="),
e=g[1];2<g.length&&g.forEach(function(a,b){0!=a&&1!=a&&(e=e+"="+g[a])});g[0].toLowerCase()==b&&(c=[g[0],e])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var f={};this.subscribe=function(c,d){if("string"!=typeof c||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof f[c]&&(f[c]=[]);var a=b();f[c].push({callback:d,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var d=-1,a=null,g;for(g in f)for(var e=0;e<f[g].length;e+=
1)if(f[g][e].id==b){d=e;a=g;break}return-1!=d?(f[a].splice(d,1),!0):!1};this.fire=function(b,d,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;if("undefined"!=typeof f.all)for(var g=0;g<f.all.length;g+=1)f.all[g].callback(d,a);g=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof f[b])for(var e=0;e<f[b].length;e+=1)g(f[b][e].callback,d,a)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
f[b]&&(f[b].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(f)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},f=null,c=null,d=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){b.Appacitive.Session.create(null)};this.create=function(a,d){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var l=new e;l.apikey=c;var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+"application.svc/session";
g.method="put";g.data=l;g.onSuccess=function(c){c&&c.status&&"200"==c.status.code?(f=c.session.sessionkey,b.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(c),b.Appacitive.Session.onSessionCreated()):d&&"function"==typeof d&&d(c)};g.onError=d;b.Appacitive.http.send(g)};b.Appacitive.http.addProcessor({pre:function(g){b.Appacitive.Session.useApiKey?g.headers.push({key:"ak",value:c}):g.headers.push({key:"as",value:f});!0===a&&(1==g.headers.filter(function(a){return"ut"==a.key}).length?g.headers.forEach(function(a){"ut"==
a.key&&(a.value=d)}):g.headers.push({key:"ut",value:d}))}});this.setUserAuthHeader=function(c,g,l){try{c&&(a=!0,d=c,l||(g||(g=60),-1==g&&(g=null),b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,g),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",g?g:-1,g))))}catch(e){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c,g){c&&("function"!=typeof c&&"boolean"==typeof c)&&(g=c,c=function(){});a=!1;c=c||function(){};b.Appacitive.localStorage.remove("Appacitive-User");
b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(d&&!g)try{var l=new b.Appacitive.HttpRequest;l.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(d);d=null;l.method="POST";l.data={};l.onSuccess=function(){"function"==typeof c&&c()};b.Appacitive.http.send(l)}catch(e){}else d=null,"function"==typeof c&&c()};this.isSessionValid=function(a){if(!a)return!0;
if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){f=null;this.useApiKey=!0};this.get=function(){return f};this.setSession=function(a){a&&(f=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(c=a,this.useApiKey=!0)};var g="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a}return g}};b.Appacitive.initialize=
function(e){if(!b.Appacitive.Session.initialized){if(!e.apikey||0==e.apikey.length)throw Error("apikey is mandatory");b.Appacitive.Session.setApiKey(e.apikey);b.Appacitive.Session.environment(e.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=e.persistUserToken;e.debug&&(b.Appacitive.config.debug=!0);if(e.userToken)-1==e.expiry?e.expiry=null:e.expiry||(e.expiry=3600),b.Appacitive.Session.setUserAuthHeader(e.userToken,e.expiry),e.user?
b.Appacitive.Users.setCurrentUser(e.user):(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e);else if(b.Appacitive.runtime.isBrowser){var f=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(f){var c=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");c||(c=60);(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e,f,c)}}}}})(global);
(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(e){e.headers.push({key:"e",value:b.Appacitive.Session.environment()})}})})(global);
(function(b){var e=b.Appacitive;e.GeoCoord=function(a,b){_validateGeoCoord=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(_validateGeoCoord(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var f=function(){this.toString=function(){}},c=function(a){f.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};c.prototype=new f;c.prototype.constructor=c;var d=function(a){a=a||"";if("object"!=typeof a.value||!a.value.length)throw Error("Specify field value as array");c.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,"string"==typeof this.value[b]?"'"+this.value[b]+"'":"number"==typeof this.value[b]?this.value[b]:this.value[b].toString()));return"("+a.join(" or ")+
")"}};d.prototype=new c;d.prototype.constructor=d;var a=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;c.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};a.prototype=new c;a.prototype.constructor=a;var g=function(a){a=a||"";if(!(a.geoCoord&&a.geoCoord instanceof
e.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};g.prototype=new c;g.prototype.constructor=a;var m=function(a){a=a||"";if(!a.geoCoords||0==a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");c.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0==b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new c;m.prototype.constructor=a;_tagFilter=function(a){f.call(this);a=a||{};if(!a.tags||"object"!=
typeof a.tags||0==a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};_tagFilter.prototype=new f;_tagFilter.prototype.constructor=_tagFilter;_compoundFilter=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var c=0;c<b.length;c+=1){if(!(b[c]instanceof f))throw Error("Invalid filter provided");
this.innerFilters.push(b[c])}this.toString=function(){var a=this.operator,b="(";this.innerFilters.forEach(function(c){b=1==b.length?b+(" "+c.toString()):b+String.format(" {0} {1} ",a,c.toString())});return b+=")"}};_compoundFilter.prototype=new f;_compoundFilter.prototype.constructor=_compoundFilter;var h=function(a){if(!a||0==a.length)throw Error("Specify value");this.value=a;this.getValue=function(){return"string"==typeof this.value?"'"+this.value+"'":"number"==typeof this.value?this.value:"object"==
typeof this.value&&this.value instanceof date?"datetime('"+e.Date.toISOString(this.value)+"')":this.value.toString()}},l=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"date('"+e.Date.toISODate(this.value)+"')":"date('"+this.value+"'')"}},k=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"time('"+e.Date.toISOTime(this.value)+"')":"time('"+this.value+"'')"}},n=function(a){this.value=
a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"datetime('"+e.Date.toISOString(this.value)+"')":"datetime('"+this.value+"'')"}},p=function(b,e,f){f||(f=this);f.type=b;f.name=e;f.equalTo=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"=="})};f.equalToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};f.equalToTime=function(a){return new c({field:this.name,fieldType:this.type,
value:new k(a),operator:"=="})};f.equalToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"=="})};f.greaterThan=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">"})};f.greaterThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};f.greaterThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">"})};f.greaterThanDateTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new n(a),operator:">"})};f.greaterThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">="})};f.greaterThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};f.greaterThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">="})};f.greaterThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),
operator:">="})};f.lessThan=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<"})};f.lessThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};f.lessThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<"})};f.lessThanDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<"})};f.lessThanEqualTo=function(a){return new c({field:this.name,
fieldType:this.type,value:new h(a),operator:"<="})};f.lessThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};f.lessThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<="})};f.lessThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<="})};f.like=function(a){return new c({field:this.name,fieldType:this.type,value:new h("*"+a+"*"),operator:"like"})};
f.startsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a+"*"),operator:"like"})};f.endsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new h("*"+a),operator:"like"})};f.contains=function(a){return new d({field:this.name,fieldType:this.type,value:a,operator:"=="})};f.between=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new h(b),val2:new h(c),operator:"between"})};f.betweenDate=function(b,c){return new a({field:this.name,
fieldType:this.type,val1:new l(b),val2:new l(c),operator:"between"})};f.betweenTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new k(b),val2:new k(c),operator:"between"})};f.betweenDateTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new n(b),val2:new n(c),operator:"between"})};f.withinCircle=function(a,b,c){return new g({field:this.name,fieldType:this.type,geoCoord:a,distance:b,unit:c,operator:"within_circle"})};f.withinPolygon=function(a){return new m({field:this.name,
fieldType:this.type,geoCoords:a,operator:"within_polygon"})}};_propertyExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;p("property",a,this);return this};_aggregateExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=function(a){return b.greaterThanEqualTo(a)};this.lessThan=
function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,c){return b.between(a,c)};return this};_attributeExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};this.contains=function(a){return b.contains(a)};
return this};e.Filter={Property:function(a){return new _propertyExpression(a)},Aggregate:function(a){return new _aggregateExpression(a)},Attribute:function(a){return new _attributeExpression(a)},Or:function(){return new _compoundFilter("or",arguments)},And:function(){return new _compoundFilter("and",arguments)},taggedWithOneOrMore:function(a){return new _tagFilter({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new _tagFilter({tags:a,operator:"tagged_with_all"})}}})(global);
(function(b){b.Appacitive.Queries={};var e=function(b){b=b||{};var a=1,c=20;this.pageNumber=function(){return 1==arguments.length?(a=arguments[0]||1,this):a};this.pageSize=function(){return 1==arguments.length?(c=arguments[0]||20,this):c};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};e.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var f=function(b){b=b||{};var a="__UtcLastUpdatedDate",c=!1;this.orderBy=function(){return 1==arguments.length?(a=
arguments[0]||"__UtcLastUpdatedDate",this):a};this.isAscending=function(){return 1==arguments.length?(c="undefined"==typeof arguments[0]?!1:arguments[0],this):c};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};f.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var c=function(c){var a=c||{},g="",m="",h="",l=a.queryType||"BasicQuery",k=new e(c),n=new f(c),p=a.schema||a.relation,q=a.relation?"connection":"article";this.type=function(){return q};this.entityType=
function(){return p};this.queryType=function(){return l};this.pageQuery=function(){return k};this.pageNumber=function(){return 1==arguments.length?(k.pageNumber(arguments[0]),this):k.pageNumber};this.pageSize=function(){return 1==arguments.length?(k.pageSize(arguments[0]),this):k.pageSize};this.sortQuery=function(){return n};this.orderby=function(){return 1==arguments.length?(n.orderby(arguments[0]),this):n.orderby};this.isAscending=function(){return 1==arguments.length?(n.isAscending(arguments[0]),
this):n.isAscending};this.filter=function(){return 1==arguments.length?(g=arguments[0],this):g};this.freeText=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?m=arguments[0]:"object"==typeof a&&a.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?h=a:"object"==typeof a&&a.length&&(h=a.join(","));return this}return h};this.filter(a.filter||"");this.freeText(a.freeText||"");this.fields(a.fields||
"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(b){for(var c in b)a[c]=b[c];k=new e(a);n=new f(a);return this};this.getQueryString=function(){var a=k.toString()+"&"+n.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");this.fields()&&0<this.fields().trim().length&&
(a+="&fields="+this.fields());return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+q+"/"+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};var r=function(a){var c=[];a||(a=[]);var d="article"==q?"Article":"Connection";a.forEach(function(a){c.push(new b.Appacitive[d](a,
!0))});return c};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(r(b[q+"s"]),b.paginginfo):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};this.count=function(a,c){a=a||function(){};c=c||function(){};var d=k.pageSize,g=k.pageNumber;k.pageSize=1;k.pageNumber=
999999999;var l=this,h=this.toRequest();h.onSuccess=function(b){k.pageSize=d;k.pageNumber=g;b=b||{};var h=b.paginginfo,e=0;if(h)e=h.totalrecords;else if(b.status&&b.status.code&&"200"==b.status.code)e=0;else{b=b.status||{message:"Server error",code:400};"function"==typeof c&&c(b,l);return}"function"==typeof a&&a(e)};h.onError=function(a){k.pageSize=d;k.pageNumber=g;a=a||{message:"Server error",code:400};"function"==typeof c&&c(a,l)};b.Appacitive.http.send(h);return this}};b.Appacitive.Queries.FindAllQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";c.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new c;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedArticlesQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for connected articles query");if(!d.articleId)throw Error("Specify articleId for connected articles query");
d.schema&&delete d.schema;d.queryType="ConnectedArticlesQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.label="";d.label&&("string"==typeof d.label&&0<d.label.length)&&(this.label="&label="+d.label);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.ConnectedArticlesQuery.prototype=
new c;b.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=b.Appacitive.Queries.ConnectedArticlesQuery;b.Appacitive.Queries.GetConnectionsQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!d.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!d.label||0==d.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");d.schema&&delete d.schema;d.queryType="GetConnectionsQuery";c.call(this,
d);this.articleId=d.articleId;this.relation=d.relation;this.label=d.label;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+this.getQueryString()};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;
b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(d,a){d=d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!d.articleBId||"string"!=typeof d.articleBId||0==d.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");d.schema&&delete d.schema;d.queryType=a||"GetConnectionsBetweenArticlesQuery";c.call(this,d);this.articleAId=d.articleAId;
this.articleBId=d.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"==this.queryType&&d.label&&"string"==typeof d.label&&0<d.label.length?"&label="+d.label:"";this.relation=d.relation&&"string"==typeof d.relation&&0<d.relation.length?d.relation+"/":"";this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+
"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,
"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"==typeof a&&a(new b.Appacitive.Connection(d.connection)):(d=d||{},"function"==typeof c&&c(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};return c};b.Appacitive.Queries.InterconnectsQuery=function(d){d=
d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(d.articleBIds&&"object"==typeof d.articleBIds&&0<d.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");d.schema&&delete d.schema;d.queryType="InterconnectsQuery";c.call(this,d);this.articleAId=d.articleAId;this.articleBIds=d.articleBIds;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();
a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new c;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,a){if(!c||0==c.length)throw Error("Specify name of filter query");this.name=c;this.data=
{};this.queryType="GraphFilterQuery";a&&(this.data.placeholders=a);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(b.ids?b.ids:[]):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};
d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}};b.Appacitive.Queries.GraphProjectQuery=function(c,a,g){if(!c||0==c.length)throw Error("Specify name of project query");if(!a||!a.length)throw Error("Specify ids to project");this.name=c;this.data={ids:a};this.queryType="GraphProjectQuery";g&&(this.data.placeholders=g);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";
a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var e=function(a){var b,c;for(c in a)if("status"!==c){b=a[c];break}var d=function(a,b,c){var g=[];a.forEach(function(a){var e=a.__children;delete a.__children;var l=a.__edge;delete a.__edge;a=new Appacitive.Article(a,!0);a.children={};for(var h in e)a.children[h]=[],a.children[h]=d(e[h].values,e[h].parent,a.id);l&&(l.__endpointa={articleid:c,label:b},l.__endpointb={articleid:a.id,
label:l.label},delete l.label,a.connection=new Appacitive.Connection(l));g.push(a)});return g};return d(b.values)};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(e(b)):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}}})(global);
(function(b){b.Appacitive.BaseObject=function(e,f){var c={},d=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var d in a[c])b[c][d]=a[c][d]}else b[c]=a[c]},a={};d(e,a);f&&d(a,c);!c.__id&&a.__id&&(c.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.cid=g;var m="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),h=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=function(){return JSON.parse(JSON.stringify(a))};
this.toJSON=function(){return JSON.parse(JSON.stringify(a))};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};a.__attributes||(a.__attributes={});c.__attributes||(c.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");
a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var k=function(){var b=!1,d=JSON.parse(JSON.stringify(c.__attributes)),g;for(g in a.__attributes)"undefined"==typeof a.__attributes[g]||null===a.__attributes[g]?(d[g]=null,b=!0):a.__attributes[g]!=c.__attributes[g]?(d[g]=a.__attributes[g],b=!0):a.__attributes[g]==c.__attributes[g]&&delete d[g];return b?
d:null};this.getChangedAttributes=k;this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var n=[];a.__tags||(a.__tags=[]);c.__tags||(c.__tags=[]);this.tags=function(){return a.__tags?a.__tags:[]};this.addTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;a.__tags.push(b);
a.__tags=Array.distinct(a.__tags);if(!n||!n.length)return this;b=n.indexOf(b);-1!=b&&n.splice(b,1);return this};this.removeTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;n.push(b);n=Array.distinct(n);if(!a.__tags||!a.__tags.length)return this;b=a.__tags.indexOf(b);-1!=b&&a.__tags.splice(b,1);return this};var p=function(){var b=[];a.__tags.every(function(a){-1==c.__tags.indexOf(a)&&b.push(a)});return b};this.getChangedTags=p;this.getRemovedTags=function(){return _removetags};var q=
function(b){var d=!1,g=JSON.parse(JSON.stringify(c)),e;for(e in a)"undefined"==typeof a[e]||null===a[e]?(g[e]=null,d=!0):a[e]!=c[e]?"__tags"==e||"__attributes"==e?delete g[e]:(g[e]=a[e],d=!0):a[e]==c[e]&&delete g[e];try{m.forEach(function(a){g[a]&&delete g[a]})}catch(l){}b?(a.__tags&&0<a.__tags.length&&(g.__addtags=p(),d=!0),n&&0<n.length&&(g.__removetags=n,d=!0)):a.__tags&&0<a.__tags.length&&(g.__tags=p(),d=!0);(b=k())?(g.__attributes=b,d=!0):delete g.__attributes;return d?g:!1};this.changed=function(){return q()};
this.hasChanged=function(){var a=q(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=q(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&
arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return c};var r="";this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?r=a:"object"==typeof a&&a.length&&(r=a.join(","));return this}return r};this.get=function(b){if(b)return a[b]};this.set=function(b,c){if(!b||"string"!=typeof b||0==b.length)return this;null==c||"undefined"==c?a[b]=null:"string"==typeof c?a[b]=c:"number"==typeof c?a[b]=c+"":"object"==typeof c&&(0<=c.length?a[b]=c:-1!==h.indexOf(b)&&
(a[b]=c));return this};this.unset=function(b){if(!b||"string"!=typeof b||0==b.length||0==b.indexOf("__"))return this;try{delete a[b]}catch(c){}return this};this.has=function(b){return b&&"string"==typeof b&&0!=b.length?a[b]&&"undefined"!=typeof a[b]?!0:!1:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(b,g){b&&(d(b,a),d(b,c));return this};this.save=function(b,c){a.__id?
u.apply(this,arguments):t.apply(this,arguments);return this};var t=function(g,e){g=g||function(){};e=e||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,r);!a.__schematype||"user"!=a.__schematype.toLowerCase()&&"device"!=a.__schematype.toLowerCase()||(k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl());var f=new b.Appacitive.HttpRequest;f.url=
k;f.method="put";a.__revision&&delete a.__revision;f.data=a;f.onSuccess=function(k){var f=null;k&&(k.article||k.connection||k.user||k.device)&&(f=k.article||k.connection||k.user||k.device);k&&f?(c=f,a.__id=f.__id,d(f,a),h.connectionCollections&&0<h.connectionCollections.length&&h.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})}),"connection"==h.type&&h.parseConnection(),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".created",h,{object:h}),
"function"==typeof g&&g(h)):(k=k||{},k.status=k.status||{},k.status=l(k.status),b.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".createFailed",h,{error:k.status}),"function"==typeof e&&e(k.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this},u=function(g,e){g=g||function(){};e=e||function(){};var h=q(!0),k=this;if(h){var f=new b.Appacitive.HttpRequest,m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||
a.__relationtype,c.__id?c.__id:a.__id,r);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&(m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(c.__id));f.url=m;f.method="post";f.data=h;f.onSuccess=function(h){h&&(h.article||h.connection||h.user||h.device)?(c=h.article||h.connection||h.user||h.device,d(c,a),n=[],b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updated",
k,{object:k}),"function"==typeof g&&g(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updateFailed",k,{object:h.status}),"function"==typeof e&&e(h.status,k))};f.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==typeof e&&e(a,k)};b.Appacitive.http.send(f)}else"function"==typeof g&&g(k);return this};this.fetch=function(g,e){g=g||function(){};e=e||function(){};if(a.__id){var h=
this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,r),f=new b.Appacitive.HttpRequest;f.url=k;f.method="get";f.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,d(c,a),h.___collection&&"article"==h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof g&&g(h)):(b=b||{},b.status=b.status||{},b.status=l(b),"function"==typeof e&&
e(b.status,h))};f.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};b.Appacitive.http.send(f);return this}"function"==typeof e&&e({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,d,e){if(a.__id){c=c||function(){};d=d||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl,k=k+b.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&
(k=b.Appacitive.config.apiBaseUrl,k+=b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id));e&&!0===e&&(k=-1==k.indexOf("?")?k+"?deleteconnections=true":k+"&deleteconnections=true");e=new b.Appacitive.HttpRequest;e.url=k;e.method="delete";e.onSuccess=function(b){"200"==b.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof c&&c(b)):(b=l(b),"function"==typeof d&&d(b,h))};e.onError=function(a){a=l(a);"function"==typeof d&&d(a,h)};b.Appacitive.http.send(e)}else this.___collection&&
this.___collection.removeByCId(g),"function"==typeof c&&c(this)}};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var e=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),c="",d,a,g,m,h,l,k=0,b=b.replace(/\r\n/g,"\n");a="";for(g=0;g<b.length;g++)m=b.charCodeAt(g),128>m?a+=String.fromCharCode(m):(127<m&&2048>m?a+=String.fromCharCode(m>>6|192):(a+=String.fromCharCode(m>>12|224),a+=String.fromCharCode(m>>6&63|128)),a+=String.fromCharCode(m&63|128));for(b=a;k<b.length;)d=b.charCodeAt(k++),a=b.charCodeAt(k++),
g=b.charCodeAt(k++),m=d>>2,d=(d&3)<<4|a>>4,h=(a&15)<<2|g>>6,l=g&63,isNaN(a)?h=l=64:isNaN(g)&&(l=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return c.toString()}})(global);
(function(b){b.Appacitive.ArticleCollection=function(e){var f=null,c=null,d=[],a={};"string"==typeof e?a.schema=e:a=e;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var f=a.schema,g=this;e=function(d){d.type="article";d.schema?f=d.schema:d.schema=f;c=new b.Appacitive.Queries.FindAllQuery(d);a=d;g.extendOptions=c.extendOptions};this.setFilter=function(d){a.filter=d;a.type="article";c?c.filter(d):(c=new b.Appacitive.Queries.FindAllQuery(a),
g.extendOptions=c.extendOptions);return this};this.setFreeText=function(d){d||0!=d.trim().length||(a.freeText="");a.freeText=d;a.type="article";c?c.freeText(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.setFields=function(d){d||(d="");a.fields=d;a.type="article";c?c.fields(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.reset=function(){f=a=null;d.length=0;c=null};var m=["BasicFilterQuery"];this.query=
function(){if(1==arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==m.indexOf(a.queryType()))throw Error("ArticleCollection only accepts "+m.join(", "));d.length=0;c=a;return this}return c};this.setOptions=e;e(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=f)throw Error("Null article passed or schema type mismatch");
var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!=b?d.splice(b,1):d.push(a);return this};this.getArticleById=function(a){var b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllArticles=function(){return Array.prototype.slice.call(d).map(function(a){return a.getArticle()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getArticle().__id&&
c.getArticle().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var h=function(a,b,c){a.length&&0!==a.length||(a=[]);a.forEach(function(a){a.___collection=g;d.push(a)});"function"==typeof c&&c(b,g)};this.fetch=function(a,b){d.length=0;c.fetch(function(b,c){h(b,c,a)},function(a){"function"==typeof b&&b(a,g)});return this};this.count=function(a,b){this.query.count(a,
b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=f;a=new b.Appacitive.Article(a);a.___collection=g;d.push(a);return a};this.map=
function(){return d.map.apply(this,arguments)};this.forEach=function(){return d.forEach.apply(this,arguments)};this.filter=function(){return d.filter.apply(this,arguments)}};b.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};b.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};b.Appacitive.ArticleCollection.prototype.articles=function(){return this.getAll()};b.Appacitive.ArticleCollection.prototype.length=
function(){return this.articles.length}})(global);
(function(b){b.Appacitive.ConnectionCollection=function(e){var f=null,c=null,d=[],a=[],g={};"string"==typeof e?g.relation=e:g=e;this.collectionType="connection";var m=this;if(!e||!e.relation)throw Error("Must provide relation while initializing ConnectionCollection.");f=e.relation;e=function(a){a.type="connection";a.relation?f=a.relation:a.relation=f;c=new b.Appacitive.Queries.FindAllQuery(a);g=a;return m};this.setFilter=function(a){g.filter=a;g.type="connection";c?c.filter(a):(c=new b.Appacitive.Queries.FindAllQuery(g),
m.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){a||0!=a.trim().length||(g.freeText="");g.freeText=a;g.type="connection";c?c.freeText(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";c?c.fields(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.query=function(){if(1==arguments.length){var b=arguments[0];if(!b||
!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==h.indexOf(b.queryType()))throw Error("ConnectionCollection only accepts "+h.join(", "));a.length=0;d.length=0;c=b;return this}return c};var h=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.reset=function(){f=g=null;a.length=0;d.length=0;c=null};this.setOptions=e;e(g);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,
10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=f)throw Error("Null connection passed or relation type mismatch");var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!==b?d.splice(b,1):d.push(a);return this};this.getConnection=function(a,b,c){b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllConnections=
function(){return Array.prototype.slice.call(d).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getConnection().__id&&c.getConnection().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var l=function(b,e,g){"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&(b=[b]);b.length&&
0!==b.length||(b=[]);b.forEach(function(b){b.___collection=m;if(b.endpointA.article||b.endpointB.article){var c=b.endpointA.article||b.endpointB.article;c.___collection=m;a.push(c)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(e){}d.push(b)});"function"==typeof g&&g(e,m)};this.getConnectedArticle=function(b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(a,b){d.length=0;c.fetch(function(b,
c){l(b,c,a)},function(a){"function"==typeof b&&b(a,m)});return this};this.count=function(a,b){c.count(a,b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewConnection=function(a){a=
a||{};a.__relationtype=f;a=new b.Appacitive.Connection(a);a.___collection=m;d.push(a);return a};this.map=function(){return d.map.apply(this,arguments)};this.forEach=function(a,b){return d.forEach(a,b||this)};this.filter=function(){return d.filter.apply(this,arguments)}}})(global);
(function(b){var e=function(c,d){c=c||function(){};d=d||function(){};var a=new b.Appacitive.HttpRequest;a.method="get";a.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(a){a?c(a):d()}):d({code:"404",message:"fb account not found"})};
a.onError=d;b.Appacitive.http.send(a)};b.Appacitive.Article=function(c,d){c=c||{};"string"==typeof c&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);b.Appacitive.BaseObject.call(this,c,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=e);return this};b.Appacitive.Article.prototype=new b.Appacitive.BaseObject;
b.Appacitive.Article.prototype.constructor=b.Appacitive.Article;b.Appacitive.Article.prototype.getConnections=function(c){if("article"!=this.type)return null;c=c||{};c.articleId=this.get("__id");var d=new b.Appacitive.ConnectionCollection({relation:c.relation});this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.GetConnectionsQuery(c));return d};b.Appacitive.Article.prototype.getConnectedArticles=function(c){c=c||{};"string"==typeof c&&(rName=c,c={relation:rName});c.articleId=this.get("__id");
var d=new b.Appacitive.ConnectionCollection({relation:c.relation});d.connectedArticle=this;this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.ConnectedArticlesQuery(c));return d};b.Appacitive.Article.multiDelete=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if("user"==c.schema.toLowerCase()||"device"==c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(c.ids&&0<c.ids.length){d=
d||function(){};a=a||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);e.method="post";e.data={idlist:c.ids};e.onSuccess=function(b){b&&"200"==b.code?"function"==typeof d&&d():(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else d()};var f=function(c){var d=
[];c.forEach(function(a){d.push(new b.Appacitive.Article(a))});return d};b.Appacitive.Article.multiGet=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if(c.ids&&0<c.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);e.method="get";e.onSuccess=function(b){b&&b.articles?"function"==typeof d&&d(f(b.articles),b.paginginfo):
(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof a&&a(b)};b.Appacitive.http.send(e)}else"function"==typeof d&&d([])};b.Appacitive.Article.get=function(c,d,a){c=c||{};if(!c.schema)throw Error("Specify schema");if(!c.id)throw Error("Specify id to fetch");var e={},e="user"==c.schema.toLowerCase()?new b.Appacitive.User({__id:c.id}):new b.Appacitive.Article({__schematype:c.schema,__id:c.id});
e.fields=c.fields;e.fetch(d,a);return e}})(global);
(function(b){var e=function(a,c,d){var e={label:a.label};a.articleid&&(e.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?e.articleid=a.article.get("__id"):e.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?e.articleid=a.article.__id:e.article=a.article,a.article=new b.Appacitive.Article(a.article));else if(!e.articleid&&!e.article)throw Error("Incorrectly configured endpoints provided to setupConnection");d["endpoint"+
c]=a;return e},f=function(a,c,d){a.article&&"object"==typeof a.article?(d["endpoint"+c]?d["endpoint"+c]&&d["endpoint"+c].article&&d["endpoint"+c].article.getArticle?d["endpoint"+c].article.copy(a.article):d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0):(d["endpoint"+c]={},d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0)),d["endpoint"+c].articleid=a.articleid,d["endpoint"+c].label=a.label,d["endpoint"+c].type=a.type,d["endpoint"+c].article.___collection=d.___collection):
d["endpoint"+c]=a};b.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw Error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);b.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b=
"A",c="B";a.__endpointa.label!=this.get("__endpointb").label||(a.__endpointa.label==a.__endpointb.label||a.__endpointa.articleid!=this.get("__endpointb").articleid&&a.__endpointa.articleid)||(b="B",c="A");f(this.get("__endpointa"),b,this);f(this.get("__endpointb"),c,this);this.endpoints=function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};c?(this.connectedArticle=function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(b=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(b)},this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.prototype.setupConnection=function(a,b){if(!(a&&(a.articleid||a.article)&&a.label&&b&&(b.articleid||b.article)&&b.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",e(a,"A",this));this.set("__endpointb",e(b,"B",this))};b.Appacitive.Connection.get=function(a,c,d){a=a||{};if(!a.relation)throw Error("Specify relation");if(!a.id)throw Error("Specify id to fetch");var e=new b.Appacitive.Connection({__relationtype:a.relation,
__id:a.id});e.fields=a.fields;e.fetch(c,d)};var c=function(a){var c=[];a||(a=[]);a.forEach(function(a){c.push(new b.Appacitive.Connection(a))});return c},d=function(a,d,e){a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"==typeof d&&d(c(a.connections),a.paginginfo):(a=a||{},"function"==typeof e&&e(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof e&&e(a)};b.Appacitive.http.send(a)};b.Appacitive.Connection.multiGet=
function(a,c,e){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var h=new b.Appacitive.HttpRequest;h.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(a.relation,a.ids.join(","),a.fields);h.method="get";return d(h,c,e)}"function"==typeof c&&c([])};b.Appacitive.Connection.multiDelete=function(a,c,d){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");
if(a.ids&&0<a.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);e.method="post";e.data={idlist:a.ids};e.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof d&&d(a||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof d&&d(a||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else c()};b.Appacitive.Connection.getInterconnects=
function(a,b,c){a=new Appacitive.Queries.InterconnectsQuery(a);d(a.toRequest(),request,b,c)};b.Appacitive.Connection.getBetweenArticles=function(a,b,c){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);d(a.toRequest(),b,c)};b.Appacitive.Connection.getBetweenArticlesForRelation=function(a,b,c){(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).fetch(b,c)}})(global);
(function(b){b.Appacitive.Users=new function(){var e=null;this.currentUser=function(){return e};var f=function(a,c,d,e,f){var g=a.get("__id");if(!g||"string"!==typeof g||0==g.length)throw Error("Please specify valid userid");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid oldPassword");if(!d||"string"!==typeof d||0==d.length)throw Error("Please specify valid newPassword");e=e||function(){};f=f||function(){};c==d?"function"==typeof e&&e(a):(c={oldpassword:c,newpassword:d},
d=new b.Appacitive.HttpRequest,d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g),d.method="post",d.data=c,d.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof e?e(a):f(b,a))},d.onError=f,b.Appacitive.http.send(d))},c=function(a,c,d){var e=a.get("__id");e&&"string"===typeof e&&0!=e.length||"function"==typeof c&&c(a.linkedAccounts(),a);c=c||function(){};d=d||function(){};var f=new b.Appacitive.HttpRequest;f.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(e);f.method="get";f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(b=b.identities||[],0<b.length?a.set("__link",b):a.set("__link",null),"function"==typeof c&&c(b,a)):d(b.status,a)};f.onError=d;b.Appacitive.http.send(f)},d=function(a,c,d,e){var f=c.get("__id");f&&"string"===typeof f&&0!=f.length||d&&"function"==typeof d&&d();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");d=d||function(){};e=e||function(){};
var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getCheckinUrl(f,a.lat,a.lng);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d(accounts,c):"function"==typeof e&&e(a,c)};g.onError=e;b.Appacitive.http.send(g)},a=function(a,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);g.method="post";g.data=f;g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else c.set("__link",f),"function"==typeof d&&d(c)},g=function(a,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);g.method=
"post";g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else"function"==typeof d&&d(c)};this.setCurrentUser=function(c,l,k){if(!c)throw Error("Cannot set null object as user");var m=c;if(m instanceof Appacitive.User)if(m.get("__id")&&0!=m.get("__id").length)c=m.toJSON();else throw Error("Specify user __id");else m=new b.Appacitive.User(c,!0);b.Appacitive.localStorage.set("Appacitive-User",c);k||(k=60);e=m;l&&b.Appacitive.Session.setUserAuthHeader(l,
k);e.logout=function(a){b.Appacitive.Users.logout(a)};e.updatePassword=function(a,b,c,d){f(this,a,b,c,d);return this};e.linkFacebookAccount=function(c,d){var f=function(){a(Appacitive.Facebook.accessToken(),e,function(a){b.Appacitive.eventManager.fire("user..article."+a.get("__id")+".updated",a,{object:a});"function"==typeof c&&c(a)},d)};Appacitive.Facebook.getCurrentUserInfo(function(){f()},function(){Appacitive.Facebook.requestLogin(function(){f()},d)});return this};e.unlinkFacebookAccount=function(a,
c){g("facebook",this,function(c){b.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};e.logout=function(a){Appacitive.Users.logout(a)};e.checkin=function(a,b,c){d(a,this,b,c);return this};b.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(a,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return e};b.Appacitive.User=function(a){a=a||{};a.__schematype="user";
b.Appacitive.Article.call(this,a);return this};b.Appacitive.User.prototype=new b.Appacitive.Article("user");b.Appacitive.User.prototype.constructor=b.Appacitive.User;b.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?"object"!=typeof a||0<=a.length?0<=a.length||(a=a[0]):a=[a]:a=[];return a};b.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this;c(this,function(b){"function"==typeof a&&a(b,d)},b);return this};b.Appacitive.User.prototype.linkFacebookAccount=
function(b,c,d){a(b,this,c,d);return this};b.Appacitive.User.prototype.unlinkFacebookAccount=function(a,b){var c=this;g("facebook",this,function(){var b=c.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&c.set("__link",null);"function"==typeof a&&a(c)},b);return this};b.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,d){if(!a)throw Error("Specify userid for user delete");c=c||function(){};d=d||function(){};
(new b.Appacitive.Article({__schematype:"user",__id:a})).del(c,d)};this.deleteCurrentUser=function(a,c){var d=function(){b.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a()};if(null===e)d();else{var f=e.get("__id");this.deleteUser(f,function(){d()},c)}};this.createUser=this.createNewUser=function(a,c,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new b.Appacitive.User(a)).save(c,d)};this.signup=function(a,b,c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(a,c,d,f){c=c||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var g=this,m=new b.Appacitive.HttpRequest;m.method="post";m.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();m.data=a;m.onSuccess=function(b){b&&b.user?(f&&(b.user.__authType=f),g.setCurrentUser(b.user,
b.token,a.expiry),c({user:e,token:b.token})):(b=b||{},d(b.status))};m.onError=d;b.Appacitive.http.send(m)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(a,c,d,f){a=a||function(){};c=c||function(){};var g=this,m=function(){var d=
{accesstoken:b.Appacitive.Facebook.accessToken(),type:"facebook",expiry:864E5,createnew:!0};g.authenticateUser(d,function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:e,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};d?m():Appacitive.Facebook.requestLogin(function(a){m()},c)};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var d=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=this;this.getUserByToken(d,function(b){e.setCurrentUser(b,d);"function"==typeof a&&a(!0)},function(){"function"==typeof a&&a(!1)})}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,
subject:c};c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d():e(a)};c.onError=e;b.Appacitive.http.send(c)};var m=function(a,c,d){c=c||function(){};d=d||function(){};var e=new b.Appacitive.HttpRequest;e.url=a;e.method="get";e.onSuccess=function(a){a&&a.user?"function"==typeof c&&c(new Appacitive.User(a.user)):"function"==typeof d&&
d(a.status)};e.onError=d;b.Appacitive.http.send(e)};this.getUserByToken=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);m(a,c,d)};this.getUserByUsername=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);m(a,c,d)};this.logout=
function(a,c){e=null;b.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(b){b.Appacitive.Email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var f=function(c,d,a){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=c;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.email):(b=b||{},b.status=b.status||{},a(b.status.message||"Server error"))};
b.Appacitive.http.send(e)};this.setupEmail=function(b){b=b||{};e.smtp.username=b.username||e.smtp.username;e.from=b.from||e.from;e.smtp.password=b.password||e.smtp.password;e.smtp.host=b.smtp.host||e.smtp.host;e.smtp.port=b.smtp.port||e.smtp.port;e.smtp.enablessl=b.enableSSL||e.smtp.enablessl;e.replyto=b.replyTo||e.replyto};this.sendTemplatedEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.templateName)throw Error("template name is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1==b.isHtml?!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)};this.sendRawEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.body)throw Error("body is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{content:b.body||"",ishtml:!1==b.isHtml?
!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)}}})(global);
(function(b){var e=function(){var b=require("facebook-node-sdk"),c=null,d=this.FB=null,a=!0;this.initialize=function(c){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!c.appId)throw Error("Please provide appid");if(!c.appSecret)throw Error("Please provide app secret");d=c.appSecret;this.FB=new b({appId:_appId,secret:d});a=!0};this.requestLogin=function(b,d,e){a?(c=accesstoken,FB.setAccessToken(e),Appacitive.Users.loginWithFacebook(b,d,!0)):"function"==typeof d&&
d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,d){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&c?(b=b||function(){},d=d||function(){},this.FB.api("/me",function(a,c){c?"function"==typeof b&&b(c):"function"==typeof d&&d("Access token is invalid")})):d("Either intialize facebook with your appid and appsecret or set accesstoken")};this.accessToken=function(){return 1==arguments.length?(c=arguments[0],this):
c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,b){a=a||function(){};Appacitive.Facebook.accessToken="";"function"==typeof a&&a()}};b.Appacitive.Facebook=b.Appacitive.runtime.isBrowser?new function(){var b=null,c=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);c=!0};this.requestLogin=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
d=d||function(){};a=a||function(){};FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,"function"==typeof d&&d(c.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");d=d||function(){};a=a||function(){};FB.api("/me",function(c){c&&!c.error?(b=FB.getAuthResponse().accessToken,"function"==typeof d&&d(c)):"function"==
typeof a&&a()})};this.accessToken=function(){return 1==arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.Facebook.accessToken="";try{FB.logout(function(a){Appacitive.Users.logout();"function"==typeof b&&b()})}catch(c){"function"==typeof a&&a(c.message)}}}:new e})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify push options");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();d.method="post";d.data=e;d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};
this.getNotification=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify notification id");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};this.getAllNotifications=
function(e,f,c){f=f||function(){};c=c||function(){};e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)}}})(global);
(function(b){b.Appacitive.File=function(e){e=e||{};this.fileId=e.fileId;this.contentType=e.contentType;this.fileData=e.fileData;var f=function(a,c,d){var e=new b.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=c;e.onError=d;b.Appacitive.http.send(e)},c=function(a,c,d,e,f){(new FormData).append("fileToUpload",c);var n=new b.Appacitive.HttpRequest;n.url=a;n.method="PUT";n.data=c;n.headers.push({key:"content-type",value:d});n.onSuccess=e;n.onError=f;n.send()};this.save=function(b,c,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,b,c,e):d(this,b,c,e)};var d=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==
b.status.code?c(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this},a=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(k){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==b.status.code?c(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(b,that)};d.onError=c;b.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};c=c||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(b){b&&b.status&&"200"==b.status.code?(d.url=b.uri,"function"==typeof a&&a(b.uri)):"function"==typeof c&&"function"==typeof c&&c(b.status,d)};e.onError=c;b.Appacitive.http.send(e);return this}}})(global);
(function(b){b.Appacitive.Date={};b.Appacitive.Date.parseISODate=function(b){try{var f=new Date(b);if(isNaN(f)){var c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,d=!1;if(!c.exec(b))if(c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,c.exec(b))d=!0;else return null;var a=b.split("T"),g=a[0].split("-"),m=a[1].split("Z")[0].split(":"),h=m[2].split("."),l=Number(m[0]),f=new Date;f.setUTCFullYear(Number(g[0]));f.setUTCMonth(Number(g[1])-1);f.setUTCDate(Number(g[2]));
d||(f.setUTCHours(Number(l)),f.setUTCMinutes(Number(m[1])),f.setUTCSeconds(Number(h[0])),h[1]&&f.setUTCMilliseconds(Number(h[1])))}return f}catch(k){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(f){return null}};b.Appacitive.Date.toISODate=function(b){try{return b=b.toISOString().split("T")[0]}catch(f){return null}};b.Appacitive.Date.toISOTime=function(b){try{return b=b.toISOString().split("T")[1],b=b.replace("Z","0000Z")}catch(f){return null}};
b.Appacitive.Date.parseISOTime=function(b){try{var f=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b))return null;var c=b.split("T");1==c.length&&c.push(c[0]);var d=c[1].split("Z")[0].split(":"),a=d[2].split(".");f.setUTCHours(Number(Number(d[0])));f.setUTCMinutes(Number(d[1]));f.setUTCSeconds(Number(a[0]));a[1]&&f.setUTCMilliseconds(Number(a[1]));return f}catch(g){return null}}})(global);
(function(b){b.Appacitive.localStorage=new function(){var e=b.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(b,c){c=c||"";if(!b)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(d){}e[b]=c;return!0};this.get=function(b){if(!b)return null;b=e.getItem(b);if(!b)return null;if("{"==b[0])try{b=JSON.parse(b)}catch(c){}return b};this.remove=function(b){if(b)try{delete e[b]}catch(c){}}}})(global);
(function(b){b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie=new function(){this.setCookie=function(e,f,c,d){var a="";c&&(a=new Date,a.setTime(a.getTime()+6E4*c),a.toGMTString());a=d?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=e+"="+f+a+"; path=/;"+c};this.readCookie=function(b){b+="=";for(var f=document.cookie.split(";"),
c=0;c<f.length;c++){for(var d=f[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(b))return d.substring(b.length,d.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}})})(global);"undefined"==typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{set:e,enumerable:!0,configurable:!0})}}))}catch(defPropException){}
Array.prototype.forEach||(Array.prototype.forEach=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var c=0;c<f;c++)c in this&&b.call(e,this[c],c,this)});"bind"in Function.prototype||(Function.prototype.bind=function(b){var e=this;if(1>=arguments.length)return function(){return e.apply(b,arguments)};var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(b,0===arguments.length?f:f.concat(Array.prototype.slice.call(arguments)))}});
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,e){void 0===e&&(e=0);0>e&&(e+=this.length);0>e&&(e=0);for(var f=this.length;e<f;e++)if(e in this&&this[e]===b)return e;return-1});
"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,e){void 0===e&&(e=this.length-1);0>e&&(e+=this.length);e>this.length-1&&(e=this.length-1);for(e++;0<e--;)if(e in this&&this[e]===b)return e;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,e){for(var f=0,c=this.length;f<c;f++)f in this&&b.call(e,this[f],f,this)});
"map"in Array.prototype||(Array.prototype.map=function(b,e){for(var f=Array(this.length),c=0,d=this.length;c<d;c++)c in this&&(f[c]=b.call(e,this[c],c,this));return f});"filter"in Array.prototype||(Array.prototype.filter=function(b,e){for(var f=[],c,d=0,a=this.length;d<a;d++)d in this&&b.call(e,c=this[d],d,this)&&f.push(c);return f});"every"in Array.prototype||(Array.prototype.every=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&!b.call(e,this[f],f,this))return!1;return!0});
"some"in Array.prototype||(Array.prototype.some=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&b.call(e,this[f],f,this))return!0;return!1});Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(b){function e(b){return 10>b?"0"+b:b}return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON);
var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(a){if(a&&a.send&&"function"==typeof a.send)a.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],b={},d=0,f={},e=0;this.addProcessor=function(a){a&&(a.pre=a.pre||function(){},a.post=a.post||function(){},p(a.pre),q(a.post))};var p=function(a){d+=1;b[d]=a;return d},
q=function(a){e+=1;f[e]=a;return e};this.enqueueRequest=function(a){c.push(a)};this.changeRequestForCors=function(a){var c={m:a.method.toUpperCase()};a.headers.forEach(function(a){c[a.key]=a.value});a.headers=[];a.headers.push({key:"Content-Type",value:"text/plain"});a.method="POST";a.data&&(c.b=a.data);delete a.data;global.Appacitive.config.debug&&(-1==a.url.indexOf("?")?a.url+="?debug=true":a.url+="&debug=true");try{a.data=JSON.stringify(c)}catch(b){}return a};this.notify=function(){if(0!==c.length){var d=
[],l;for(l in f)f.hasOwnProperty(l)&&d.push(f[l]);for(;0<c.length;){var e=c.shift(),n=[];for(l in b)b.hasOwnProperty(l)&&n.push(b[l](e));this.changeRequestForCors(e);a.send(e,d,n)}}};this.onResponse=function(a){console.dir(a)}},e=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(c,b){a()};this.onError=function(c){a()}},f=null,f=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,c=function(a){var c=
new XDomainRequest;c.onload=function(){var b=c.responseText;try{var d=c.contentType;if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=b,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),b=JSON.parse(d)}catch(f){}a.onSuccess(b,this)};c.onerror=c.ontimeout=function(){a.onError({code:"400",message:"Server Error"},c)};c.onprogress=function(){};c.open(a.method,a.url,!0);c.send(a.data);return c},d=function(a){if(!a.url)throw Error("Please specify request url");
a.method||(a.method="GET");a.headers||(a.headers=[]);var b={},d=!0;a.headers.forEach(function(a){"content-type"==a.key.toLowerCase()&&(d=!0,"application/json"==a.value.toLowerCase()||"application/javascript"==a.value.toLowerCase())&&(d=!1)});if(d)b=a.data;else if(a.data&&(b=a.data,"object"==typeof a.data))try{b=JSON.stringify(b)}catch(l){}a.onSuccess&&"function"==typeof a.onSuccess||(a.onSuccess=function(){});a.onError&&"function"==typeof a.onError||(a.onError=function(){});if(-1!=navigator.userAgent.indexOf("MSIE 8")||
-1!=navigator.userAgent.indexOf("MSIE 9"))return a.data=b,new c(a);var h=new f;h.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var b=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase())b=c,global.Appacitive.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),c=JSON.parse(b)}catch(d){}a.onSuccess(c,
this)}else a.onError({code:this.status,message:this.statusText},this)};h.open(a.method,a.url,!0);for(var e=0;e<a.headers.length;e+=1)h.setRequestHeader(a.headers[e].key,a.headers[e].value);global.Appacitive.runtime.isBrowser||h.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");h.send(b);return h},a=function(){var a=new e;a.isOnline=function(){return!0};var c=function(c,b,f){new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d,e){if(d){try{d=JSON.parse(d)}catch(m){}var r=
d;if(b.length!=f.length)throw Error("Callback length and state length mismatch!");for(var t=0;t<b.length;t+=1)b[t].apply({},[r,f[t]]);a.onResponse(d,c)}else a.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(b){a.onError(c,b)}})};a.send=function(a,b,d){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,b,d)};a.upload=function(a,b,d){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,b,d,!0)};
return a};global.Appacitive.http=new function(){var c=new a,d=new b(c),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;d.addProcessor(a)};this.send=function(a){d.enqueueRequest(a);c.isOnline()&&!1==f&&d.notify()};this.flush=function(a){a?d.notify():c.isOnline()&&d.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,
[c]);else a.onError(c)};c.onError=this.onError;this.onResponse=function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[a]);else c.onSuccess(a)};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new d(this,a)}};(function(a){a.Appacitive&&a.Appacitive.http&&
(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,b){try{a.Appacitive.Session.isSessionValid(c)?c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(b))}catch(d){}}}),a.Appacitive.http.addProcessor({pre:function(a){return(new Date).getTime()},post:function(a,c){var b=(new Date).getTime()-
c;a._timeTakenInMilliseconds=b}}))})(global)})();
(function(b){String.format=function(b,f){if(1>=arguments.length)return b;for(var c=arguments.length-2,d=0;d<=c;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var f=RegExp("^"+b),c=this;f.test(c)&&(c=c.slice(1,c.length));f=RegExp(b+"$");f.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(b){"undefined"==typeof b&&(b="");for(var f=
"",c=0;c<b.length;c+=1)-1==" .,;#".indexOf(b[c])&&(f+=b[c]);return f=f.toLowerCase()};String.contains=function(b,f){return-1!=b.indexOf(f)};String.startsWith=function(b,f){return 0==b.indexOf(f)};Array.distinct=function(b){var f=[],c=b.length,d,a,g;for(a=0;a<c;a++){d=void 0;for(g=0;g<f.length;g++)if(b[a].toLowerCase()===f[g].toLowerCase()){d=!0;break}d||f.push(b[a])}return f};Object.isEmpty=function(b){if(!b)return!0;var f=!0;for(keys in b){f=!1;break}return f};b.dateFromWcf=function(b,f){var c=/Date\(([^)]+)\)/.exec(b);
if(2!=c.length){if(!f)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var e=function(b){"object"==typeof b&&(0<b.length&&("string"==typeof b[0]||"number"==typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user=
{userServiceUrl:"user",getCreateUrl:function(b){return String.format("{0}/create?fields={1}",this.userServiceUrl,e(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token=",this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,b)},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,d){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,b,c,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,e(b))},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.deviceServiceUrl,b)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,
c,d){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),a=d?a+"?psize="+d:a+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!=c[b].trim().length&&(a=a+"&"+c[b]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,b,c)},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.articleServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,e(c))},getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,e(c))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,
b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,d,a){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,d,c);if("undefined"!==typeof a&&0<a.length)for(b=0;b<a.length;b+=1)g=g+"&"+a[b];return g},getConnectedArticles:function(b,c,d){var a="",a=String.format("{0}/{1}/{2}/find",
this.connectionServiceUrl,b,c);if(d&&d.length&&0<d.length)for(b=0;b<d.length;b+=1)a=0==b?a+("?"+d[b]):a+("&"+d[b]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push=
{pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,
c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(d,a){var g=a.split("="),
e=g[1];2<g.length&&g.forEach(function(a,b){0!=a&&1!=a&&(e=e+"="+g[a])});g[0].toLowerCase()==b&&(c=[g[0],e])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var f={};this.subscribe=function(c,d){if("string"!=typeof c||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof f[c]&&(f[c]=[]);var a=b();f[c].push({callback:d,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var d=-1,a=null,g;for(g in f)for(var e=0;e<f[g].length;e+=
1)if(f[g][e].id==b){d=e;a=g;break}return-1!=d?(f[a].splice(d,1),!0):!1};this.fire=function(b,d,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;if("undefined"!=typeof f.all)for(var g=0;g<f.all.length;g+=1)f.all[g].callback(d,a);g=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof f[b])for(var e=0;e<f[b].length;e+=1)g(f[b][e].callback,d,a)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
f[b]&&(f[b].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(f)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},f=null,c=null,d=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){b.Appacitive.Session.create(null)};this.create=function(a,d){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var l=new e;l.apikey=c;var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+"application.svc/session";
g.method="put";g.data=l;g.onSuccess=function(c){c&&c.status&&"200"==c.status.code?(f=c.session.sessionkey,b.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(c),b.Appacitive.Session.onSessionCreated()):d&&"function"==typeof d&&d(c)};g.onError=d;b.Appacitive.http.send(g)};b.Appacitive.http.addProcessor({pre:function(g){b.Appacitive.Session.useApiKey?g.headers.push({key:"ak",value:c}):g.headers.push({key:"as",value:f});!0===a&&(1==g.headers.filter(function(a){return"ut"==a.key}).length?g.headers.forEach(function(a){"ut"==
a.key&&(a.value=d)}):g.headers.push({key:"ut",value:d}))}});this.setUserAuthHeader=function(c,g,l){try{c&&(a=!0,d=c,l||(g||(g=60),-1==g&&(g=null),b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,g),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",g?g:-1,g))))}catch(e){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c,g){c&&("function"!=typeof c&&"boolean"==typeof c)&&(g=c,c=function(){});a=!1;c=c||function(){};b.Appacitive.localStorage.remove("Appacitive-User");
b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(d&&!g)try{var l=new b.Appacitive.HttpRequest;l.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(d);d=null;l.method="POST";l.data={};l.onSuccess=function(){"function"==typeof c&&c()};b.Appacitive.http.send(l)}catch(e){}else d=null,"function"==typeof c&&c()};this.isSessionValid=function(a){if(!a)return!0;
if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){f=null;this.useApiKey=!0};this.get=function(){return f};this.setSession=function(a){a&&(f=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(c=a,this.useApiKey=!0)};var g="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a}return g}};b.Appacitive.getAppPrefix=
function(e){return b.Appacitive.Session.environment+"/"+b.Appacitive.appId+"/"+e};b.Appacitive.initialize=function(e){e=e||{};if(!b.Appacitive.Session.initialized){if(!e.apikey||0==e.apikey.length)throw Error("apikey is mandatory");if(!e.appId||0==e.appId.length)throw Error("appId is mandatory");b.Appacitive.Session.setApiKey(e.apikey);b.Appacitive.Session.environment(e.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.appId=e.appId;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=
e.persistUserToken;e.debug&&(b.Appacitive.config.debug=!0);if(e.userToken)-1==e.expiry?e.expiry=null:e.expiry||(e.expiry=3600),b.Appacitive.Session.setUserAuthHeader(e.userToken,e.expiry),e.user?b.Appacitive.Users.setCurrentUser(e.user):(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e);else if(b.Appacitive.runtime.isBrowser){var f=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(f){var c=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");
c||(c=60);(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e,f,c)}}}}})(global);(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(e){e.headers.push({key:"e",value:b.Appacitive.Session.environment()})}})})(global);
(function(b){var e=b.Appacitive;e.GeoCoord=function(a,b){_validateGeoCoord=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(_validateGeoCoord(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var f=function(){this.toString=function(){}},c=function(a){f.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};c.prototype=new f;c.prototype.constructor=c;var d=function(a){a=a||"";if("object"!=typeof a.value||!a.value.length)throw Error("Specify field value as array");c.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,"string"==typeof this.value[b]?"'"+this.value[b]+"'":"number"==typeof this.value[b]?this.value[b]:this.value[b].toString()));return"("+a.join(" or ")+
")"}};d.prototype=new c;d.prototype.constructor=d;var a=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;c.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};a.prototype=new c;a.prototype.constructor=a;var g=function(a){a=a||"";if(!(a.geoCoord&&a.geoCoord instanceof
e.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};g.prototype=new c;g.prototype.constructor=a;var m=function(a){a=a||"";if(!a.geoCoords||0==a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");c.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0==b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new c;m.prototype.constructor=a;_tagFilter=function(a){f.call(this);a=a||{};if(!a.tags||"object"!=
typeof a.tags||0==a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};_tagFilter.prototype=new f;_tagFilter.prototype.constructor=_tagFilter;_compoundFilter=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var c=0;c<b.length;c+=1){if(!(b[c]instanceof f))throw Error("Invalid filter provided");
this.innerFilters.push(b[c])}this.toString=function(){var a=this.operator,b="(";this.innerFilters.forEach(function(c){b=1==b.length?b+(" "+c.toString()):b+String.format(" {0} {1} ",a,c.toString())});return b+=")"}};_compoundFilter.prototype=new f;_compoundFilter.prototype.constructor=_compoundFilter;var k=function(a){if(!a||0==a.length)throw Error("Specify value");this.value=a;this.getValue=function(){return"string"==typeof this.value?"'"+this.value+"'":"number"==typeof this.value?this.value:"object"==
typeof this.value&&this.value instanceof date?"datetime('"+e.Date.toISOString(this.value)+"')":this.value.toString()}},l=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"date('"+e.Date.toISODate(this.value)+"')":"date('"+this.value+"'')"}},h=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"time('"+e.Date.toISOTime(this.value)+"')":"time('"+this.value+"'')"}},n=function(a){this.value=
a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"datetime('"+e.Date.toISOString(this.value)+"')":"datetime('"+this.value+"'')"}},p=function(b,e,f){f||(f=this);f.type=b;f.name=e;f.equalTo=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"=="})};f.equalToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};f.equalToTime=function(a){return new c({field:this.name,fieldType:this.type,
value:new h(a),operator:"=="})};f.equalToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"=="})};f.greaterThan=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">"})};f.greaterThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};f.greaterThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">"})};f.greaterThanDateTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new n(a),operator:">"})};f.greaterThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">="})};f.greaterThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};f.greaterThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">="})};f.greaterThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),
operator:">="})};f.lessThan=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<"})};f.lessThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};f.lessThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<"})};f.lessThanDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<"})};f.lessThanEqualTo=function(a){return new c({field:this.name,
fieldType:this.type,value:new k(a),operator:"<="})};f.lessThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};f.lessThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<="})};f.lessThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<="})};f.like=function(a){return new c({field:this.name,fieldType:this.type,value:new k("*"+a+"*"),operator:"like"})};
f.startsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a+"*"),operator:"like"})};f.endsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new k("*"+a),operator:"like"})};f.contains=function(a){return new d({field:this.name,fieldType:this.type,value:a,operator:"=="})};f.between=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new k(b),val2:new k(c),operator:"between"})};f.betweenDate=function(b,c){return new a({field:this.name,
fieldType:this.type,val1:new l(b),val2:new l(c),operator:"between"})};f.betweenTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new h(b),val2:new h(c),operator:"between"})};f.betweenDateTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new n(b),val2:new n(c),operator:"between"})};f.withinCircle=function(a,b,c){return new g({field:this.name,fieldType:this.type,geoCoord:a,distance:b,unit:c,operator:"within_circle"})};f.withinPolygon=function(a){return new m({field:this.name,
fieldType:this.type,geoCoords:a,operator:"within_polygon"})}};_propertyExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;p("property",a,this);return this};_aggregateExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=function(a){return b.greaterThanEqualTo(a)};this.lessThan=
function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,c){return b.between(a,c)};return this};_attributeExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};this.contains=function(a){return b.contains(a)};
return this};e.Filter={Property:function(a){return new _propertyExpression(a)},Aggregate:function(a){return new _aggregateExpression(a)},Attribute:function(a){return new _attributeExpression(a)},Or:function(){return new _compoundFilter("or",arguments)},And:function(){return new _compoundFilter("and",arguments)},taggedWithOneOrMore:function(a){return new _tagFilter({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new _tagFilter({tags:a,operator:"tagged_with_all"})}}})(global);
(function(b){b.Appacitive.Queries={};var e=function(b){b=b||{};var a=1,c=20;this.pageNumber=function(){return 1==arguments.length?(a=arguments[0]||1,this):a};this.pageSize=function(){return 1==arguments.length?(c=arguments[0]||20,this):c};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};e.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var f=function(b){b=b||{};var a="__UtcLastUpdatedDate",c=!1;this.orderBy=function(){return 1==arguments.length?(a=
arguments[0]||"__UtcLastUpdatedDate",this):a};this.isAscending=function(){return 1==arguments.length?(c="undefined"==typeof arguments[0]?!1:arguments[0],this):c};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};f.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var c=function(c){var a=c||{},g="",m="",k="",l=a.queryType||"BasicQuery",h=new e(c),n=new f(c),p=a.schema||a.relation,q=a.relation?"connection":"article";this.type=function(){return q};this.entityType=
function(){return p};this.queryType=function(){return l};this.pageQuery=function(){return h};this.pageNumber=function(){return 1==arguments.length?(h.pageNumber(arguments[0]),this):h.pageNumber};this.pageSize=function(){return 1==arguments.length?(h.pageSize(arguments[0]),this):h.pageSize};this.sortQuery=function(){return n};this.orderby=function(){return 1==arguments.length?(n.orderby(arguments[0]),this):n.orderby};this.isAscending=function(){return 1==arguments.length?(n.isAscending(arguments[0]),
this):n.isAscending};this.filter=function(){return 1==arguments.length?(g=arguments[0],this):g};this.freeText=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?m=arguments[0]:"object"==typeof a&&a.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?k=a:"object"==typeof a&&a.length&&(k=a.join(","));return this}return k};this.filter(a.filter||"");this.freeText(a.freeText||"");this.fields(a.fields||
"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(b){for(var c in b)a[c]=b[c];h=new e(a);n=new f(a);return this};this.getQueryString=function(){var a=h.toString()+"&"+n.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");this.fields()&&0<this.fields().trim().length&&
(a+="&fields="+this.fields());return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+q+"/"+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};var r=function(a){var c=[];a||(a=[]);var d="article"==q?"Article":"Connection";a.forEach(function(a){c.push(new b.Appacitive[d](a,
!0))});return c};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(r(b[q+"s"]),b.paginginfo):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};this.count=function(a,c){a=a||function(){};c=c||function(){};var d=h.pageSize,g=h.pageNumber;h.pageSize=1;h.pageNumber=
999999999;var l=this,e=this.toRequest();e.onSuccess=function(b){h.pageSize=d;h.pageNumber=g;b=b||{};var e=b.paginginfo,k=0;if(e)k=e.totalrecords;else if(b.status&&b.status.code&&"200"==b.status.code)k=0;else{b=b.status||{message:"Server error",code:400};"function"==typeof c&&c(b,l);return}"function"==typeof a&&a(k)};e.onError=function(a){h.pageSize=d;h.pageNumber=g;a=a||{message:"Server error",code:400};"function"==typeof c&&c(a,l)};b.Appacitive.http.send(e);return this}};b.Appacitive.Queries.FindAllQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";c.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new c;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedArticlesQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for connected articles query");if(!d.articleId)throw Error("Specify articleId for connected articles query");
d.schema&&delete d.schema;d.queryType="ConnectedArticlesQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.label="";d.label&&("string"==typeof d.label&&0<d.label.length)&&(this.label="&label="+d.label);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.ConnectedArticlesQuery.prototype=
new c;b.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=b.Appacitive.Queries.ConnectedArticlesQuery;b.Appacitive.Queries.GetConnectionsQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!d.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!d.label||0==d.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");d.schema&&delete d.schema;d.queryType="GetConnectionsQuery";c.call(this,
d);this.articleId=d.articleId;this.relation=d.relation;this.label=d.label;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+this.getQueryString()};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;
b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(d,a){d=d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!d.articleBId||"string"!=typeof d.articleBId||0==d.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");d.schema&&delete d.schema;d.queryType=a||"GetConnectionsBetweenArticlesQuery";c.call(this,d);this.articleAId=d.articleAId;
this.articleBId=d.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"==this.queryType&&d.label&&"string"==typeof d.label&&0<d.label.length?"&label="+d.label:"";this.relation=d.relation&&"string"==typeof d.relation&&0<d.relation.length?d.relation+"/":"";this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+
"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,
"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"==typeof a&&a(new b.Appacitive.Connection(d.connection)):(d=d||{},"function"==typeof c&&c(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};return c};b.Appacitive.Queries.InterconnectsQuery=function(d){d=
d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(d.articleBIds&&"object"==typeof d.articleBIds&&0<d.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");d.schema&&delete d.schema;d.queryType="InterconnectsQuery";c.call(this,d);this.articleAId=d.articleAId;this.articleBIds=d.articleBIds;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();
a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new c;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,a){if(!c||0==c.length)throw Error("Specify name of filter query");this.name=c;this.data=
{};this.queryType="GraphFilterQuery";a&&(this.data.placeholders=a);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(b.ids?b.ids:[]):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};
d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}};b.Appacitive.Queries.GraphProjectQuery=function(c,a,e){if(!c||0==c.length)throw Error("Specify name of project query");if(!a||!a.length)throw Error("Specify ids to project");this.name=c;this.data={ids:a};this.queryType="GraphProjectQuery";e&&(this.data.placeholders=e);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";
a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var f=function(a){var b,c;for(c in a)if("status"!==c){b=a[c];break}var d=function(a,b,c){var e=[];a.forEach(function(a){var g=a.__children;delete a.__children;var l=a.__edge;delete a.__edge;a=new Appacitive.Article(a,!0);a.children={};for(var k in g)a.children[k]=[],a.children[k]=d(g[k].values,g[k].parent,a.id);l&&(l.__endpointa={articleid:c,label:b},l.__endpointb={articleid:a.id,
label:l.label},delete l.label,a.connection=new Appacitive.Connection(l));e.push(a)});return e};return d(b.values)};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(f(b)):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}}})(global);
(function(b){b.Appacitive.BaseObject=function(e,f){var c={},d=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var d in a[c])b[c][d]=a[c][d]}else b[c]=a[c]},a={};d(e,a);f&&d(a,c);!c.__id&&a.__id&&(c.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.cid=g;var m="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),k=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=function(){return JSON.parse(JSON.stringify(a))};
this.toJSON=function(){return JSON.parse(JSON.stringify(a))};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};a.__attributes||(a.__attributes={});c.__attributes||(c.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");
a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var h=function(){var b=!1,d=JSON.parse(JSON.stringify(c.__attributes)),e;for(e in a.__attributes)"undefined"==typeof a.__attributes[e]||null===a.__attributes[e]?(d[e]=null,b=!0):a.__attributes[e]!=c.__attributes[e]?(d[e]=a.__attributes[e],b=!0):a.__attributes[e]==c.__attributes[e]&&delete d[e];return b?
d:null};this.getChangedAttributes=h;this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var n=[];a.__tags||(a.__tags=[]);c.__tags||(c.__tags=[]);this.tags=function(){return a.__tags?a.__tags:[]};this.addTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;a.__tags.push(b);
a.__tags=Array.distinct(a.__tags);if(!n||!n.length)return this;b=n.indexOf(b);-1!=b&&n.splice(b,1);return this};this.removeTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;n.push(b);n=Array.distinct(n);if(!a.__tags||!a.__tags.length)return this;b=a.__tags.indexOf(b);-1!=b&&a.__tags.splice(b,1);return this};var p=function(){var b=[];a.__tags.every(function(a){-1==c.__tags.indexOf(a)&&b.push(a)});return b};this.getChangedTags=p;this.getRemovedTags=function(){return _removetags};var q=
function(b){var d=!1,e=JSON.parse(JSON.stringify(c)),g;for(g in a)"undefined"==typeof a[g]||null===a[g]?(e[g]=null,d=!0):a[g]!=c[g]?"__tags"==g||"__attributes"==g?delete e[g]:(e[g]=a[g],d=!0):a[g]==c[g]&&delete e[g];try{m.forEach(function(a){e[a]&&delete e[a]})}catch(l){}b?(a.__tags&&0<a.__tags.length&&(e.__addtags=p(),d=!0),n&&0<n.length&&(e.__removetags=n,d=!0)):a.__tags&&0<a.__tags.length&&(e.__tags=p(),d=!0);(b=h())?(e.__attributes=b,d=!0):delete e.__attributes;return d?e:!1};this.changed=function(){return q()};
this.hasChanged=function(){var a=q(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=q(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&
arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return c};var r="";this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?r=a:"object"==typeof a&&a.length&&(r=a.join(","));return this}return r};this.get=function(b){if(b)return a[b]};this.set=function(b,c){if(!b||"string"!=typeof b||0==b.length)return this;null==c||"undefined"==c?a[b]=null:"string"==typeof c?a[b]=c:"number"==typeof c?a[b]=c+"":"object"==typeof c&&(0<=c.length?a[b]=c:-1!==k.indexOf(b)&&
(a[b]=c));return this};this.unset=function(b){if(!b||"string"!=typeof b||0==b.length||0==b.indexOf("__"))return this;try{delete a[b]}catch(c){}return this};this.has=function(b){return b&&"string"==typeof b&&0!=b.length?a[b]&&"undefined"!=typeof a[b]?!0:!1:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(b,e){b&&(d(b,a),d(b,c));return this};this.save=function(b,c){a.__id?
u.apply(this,arguments):t.apply(this,arguments);return this};var t=function(e,g){e=e||function(){};g=g||function(){};var k=this,f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,r);!a.__schematype||"user"!=a.__schematype.toLowerCase()&&"device"!=a.__schematype.toLowerCase()||(f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl());var h=new b.Appacitive.HttpRequest;h.url=
f;h.method="put";a.__revision&&delete a.__revision;h.data=a;h.onSuccess=function(h){var f=null;h&&(h.article||h.connection||h.user||h.device)&&(f=h.article||h.connection||h.user||h.device);h&&f?(c=f,a.__id=f.__id,d(f,a),k.connectionCollections&&0<k.connectionCollections.length&&k.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})}),"connection"==k.type&&k.parseConnection(),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+".created",k,{object:k}),
"function"==typeof e&&e(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+".createFailed",k,{error:h.status}),"function"==typeof g&&g(h.status,k))};h.onError=function(a){a=l(a);"function"==typeof g&&g(a,k)};b.Appacitive.http.send(h);return this},u=function(e,g){e=e||function(){};g=g||function(){};var h=q(!0),k=this;if(h){var f=new b.Appacitive.HttpRequest,m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||
a.__relationtype,c.__id?c.__id:a.__id,r);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&(m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(c.__id));f.url=m;f.method="post";f.data=h;f.onSuccess=function(h){h&&(h.article||h.connection||h.user||h.device)?(c=h.article||h.connection||h.user||h.device,d(c,a),n=[],b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updated",
k,{object:k}),"function"==typeof e&&e(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updateFailed",k,{object:h.status}),"function"==typeof g&&g(h.status,k))};f.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==typeof g&&g(a,k)};b.Appacitive.http.send(f)}else"function"==typeof e&&e(k);return this};this.fetch=function(e,g){e=e||function(){};g=g||function(){};if(a.__id){var h=
this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,r),f=new b.Appacitive.HttpRequest;f.url=k;f.method="get";f.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,d(c,a),h.___collection&&"article"==h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof e&&e(h)):(b=b||{},b.status=b.status||{},b.status=l(b),"function"==typeof g&&
g(b.status,h))};f.onError=function(a){a=l(a);"function"==typeof g&&g(a,h)};b.Appacitive.http.send(f);return this}"function"==typeof g&&g({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,d,e){if(a.__id){c=c||function(){};d=d||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl,k=k+b.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&
(k=b.Appacitive.config.apiBaseUrl,k+=b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id));e&&!0===e&&(k=-1==k.indexOf("?")?k+"?deleteconnections=true":k+"&deleteconnections=true");e=new b.Appacitive.HttpRequest;e.url=k;e.method="delete";e.onSuccess=function(b){"200"==b.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof c&&c(b)):(b=l(b),"function"==typeof d&&d(b,h))};e.onError=function(a){a=l(a);"function"==typeof d&&d(a,h)};b.Appacitive.http.send(e)}else this.___collection&&
this.___collection.removeByCId(g),"function"==typeof c&&c(this)}};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var e=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),c="",d,a,g,m,k,l,h=0,b=b.replace(/\r\n/g,"\n");a="";for(g=0;g<b.length;g++)m=b.charCodeAt(g),128>m?a+=String.fromCharCode(m):(127<m&&2048>m?a+=String.fromCharCode(m>>6|192):(a+=String.fromCharCode(m>>12|224),a+=String.fromCharCode(m>>6&63|128)),a+=String.fromCharCode(m&63|128));for(b=a;h<b.length;)d=b.charCodeAt(h++),a=b.charCodeAt(h++),
g=b.charCodeAt(h++),m=d>>2,d=(d&3)<<4|a>>4,k=(a&15)<<2|g>>6,l=g&63,isNaN(a)?k=l=64:isNaN(g)&&(l=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return c.toString()}})(global);
(function(b){b.Appacitive.ArticleCollection=function(e){var f=null,c=null,d=[],a={};"string"==typeof e?a.schema=e:a=e;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var f=a.schema,g=this;e=function(d){d.type="article";d.schema?f=d.schema:d.schema=f;c=new b.Appacitive.Queries.FindAllQuery(d);a=d;g.extendOptions=c.extendOptions};this.setFilter=function(d){a.filter=d;a.type="article";c?c.filter(d):(c=new b.Appacitive.Queries.FindAllQuery(a),
g.extendOptions=c.extendOptions);return this};this.setFreeText=function(d){d||0!=d.trim().length||(a.freeText="");a.freeText=d;a.type="article";c?c.freeText(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.setFields=function(d){d||(d="");a.fields=d;a.type="article";c?c.fields(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.reset=function(){f=a=null;d.length=0;c=null};var m=["BasicFilterQuery"];this.query=
function(){if(1==arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==m.indexOf(a.queryType()))throw Error("ArticleCollection only accepts "+m.join(", "));d.length=0;c=a;return this}return c};this.setOptions=e;e(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=f)throw Error("Null article passed or schema type mismatch");
var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!=b?d.splice(b,1):d.push(a);return this};this.getArticleById=function(a){var b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllArticles=function(){return Array.prototype.slice.call(d).map(function(a){return a.getArticle()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getArticle().__id&&
c.getArticle().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var k=function(a,b,c){a.length&&0!==a.length||(a=[]);a.forEach(function(a){a.___collection=g;d.push(a)});"function"==typeof c&&c(b,g)};this.fetch=function(a,b){d.length=0;c.fetch(function(b,c){k(b,c,a)},function(a){"function"==typeof b&&b(a,g)});return this};this.count=function(a,b){this.query.count(a,
b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=f;a=new b.Appacitive.Article(a);a.___collection=g;d.push(a);return a};this.map=
function(){return d.map.apply(this,arguments)};this.forEach=function(){return d.forEach.apply(this,arguments)};this.filter=function(){return d.filter.apply(this,arguments)}};b.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};b.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};b.Appacitive.ArticleCollection.prototype.articles=function(){return this.getAll()};b.Appacitive.ArticleCollection.prototype.length=
function(){return this.articles.length}})(global);
(function(b){b.Appacitive.ConnectionCollection=function(e){var f=null,c=null,d=[],a=[],g={};"string"==typeof e?g.relation=e:g=e;this.collectionType="connection";var m=this;if(!e||!e.relation)throw Error("Must provide relation while initializing ConnectionCollection.");f=e.relation;e=function(a){a.type="connection";a.relation?f=a.relation:a.relation=f;c=new b.Appacitive.Queries.FindAllQuery(a);g=a;return m};this.setFilter=function(a){g.filter=a;g.type="connection";c?c.filter(a):(c=new b.Appacitive.Queries.FindAllQuery(g),
m.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){a||0!=a.trim().length||(g.freeText="");g.freeText=a;g.type="connection";c?c.freeText(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";c?c.fields(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.query=function(){if(1==arguments.length){var b=arguments[0];if(!b||
!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==k.indexOf(b.queryType()))throw Error("ConnectionCollection only accepts "+k.join(", "));a.length=0;d.length=0;c=b;return this}return c};var k=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.reset=function(){f=g=null;a.length=0;d.length=0;c=null};this.setOptions=e;e(g);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,
10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=f)throw Error("Null connection passed or relation type mismatch");var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!==b?d.splice(b,1):d.push(a);return this};this.getConnection=function(a,b,c){b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllConnections=
function(){return Array.prototype.slice.call(d).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getConnection().__id&&c.getConnection().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var l=function(b,e,g){"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&(b=[b]);b.length&&
0!==b.length||(b=[]);b.forEach(function(b){b.___collection=m;if(b.endpointA.article||b.endpointB.article){var c=b.endpointA.article||b.endpointB.article;c.___collection=m;a.push(c)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(e){}d.push(b)});"function"==typeof g&&g(e,m)};this.getConnectedArticle=function(b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(a,b){d.length=0;c.fetch(function(b,
c){l(b,c,a)},function(a){"function"==typeof b&&b(a,m)});return this};this.count=function(a,b){c.count(a,b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewConnection=function(a){a=
a||{};a.__relationtype=f;a=new b.Appacitive.Connection(a);a.___collection=m;d.push(a);return a};this.map=function(){return d.map.apply(this,arguments)};this.forEach=function(a,b){return d.forEach(a,b||this)};this.filter=function(){return d.filter.apply(this,arguments)}}})(global);
(function(b){var e=function(c,d){c=c||function(){};d=d||function(){};var a=new b.Appacitive.HttpRequest;a.method="get";a.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(a){a?c(a):d()}):d({code:"404",message:"fb account not found"})};
a.onError=d;b.Appacitive.http.send(a)};b.Appacitive.Article=function(c,d){c=c||{};"string"==typeof c&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);b.Appacitive.BaseObject.call(this,c,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=e);return this};b.Appacitive.Article.prototype=new b.Appacitive.BaseObject;
b.Appacitive.Article.prototype.constructor=b.Appacitive.Article;b.Appacitive.Article.prototype.getConnections=function(c){if("article"!=this.type)return null;c=c||{};c.articleId=this.get("__id");var d=new b.Appacitive.ConnectionCollection({relation:c.relation});this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.GetConnectionsQuery(c));return d};b.Appacitive.Article.prototype.getConnectedArticles=function(c){c=c||{};"string"==typeof c&&(rName=c,c={relation:rName});c.articleId=this.get("__id");
var d=new b.Appacitive.ConnectionCollection({relation:c.relation});d.connectedArticle=this;this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.ConnectedArticlesQuery(c));return d};b.Appacitive.Article.multiDelete=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if("user"==c.schema.toLowerCase()||"device"==c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(c.ids&&0<c.ids.length){d=
d||function(){};a=a||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);e.method="post";e.data={idlist:c.ids};e.onSuccess=function(b){b&&"200"==b.code?"function"==typeof d&&d():(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else d()};var f=function(c){var d=
[];c.forEach(function(a){d.push(new b.Appacitive.Article(a))});return d};b.Appacitive.Article.multiGet=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if(c.ids&&0<c.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);e.method="get";e.onSuccess=function(b){b&&b.articles?"function"==typeof d&&d(f(b.articles),b.paginginfo):
(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof a&&a(b)};b.Appacitive.http.send(e)}else"function"==typeof d&&d([])};b.Appacitive.Article.get=function(c,d,a){c=c||{};if(!c.schema)throw Error("Specify schema");if(!c.id)throw Error("Specify id to fetch");var e={},e="user"==c.schema.toLowerCase()?new b.Appacitive.User({__id:c.id}):new b.Appacitive.Article({__schematype:c.schema,__id:c.id});
e.fields=c.fields;e.fetch(d,a);return e}})(global);
(function(b){var e=function(a,c,d){var e={label:a.label};a.articleid&&(e.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?e.articleid=a.article.get("__id"):e.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?e.articleid=a.article.__id:e.article=a.article,a.article=new b.Appacitive.Article(a.article));else if(!e.articleid&&!e.article)throw Error("Incorrectly configured endpoints provided to setupConnection");d["endpoint"+
c]=a;return e},f=function(a,c,d){a.article&&"object"==typeof a.article?(d["endpoint"+c]?d["endpoint"+c]&&d["endpoint"+c].article&&d["endpoint"+c].article.getArticle?d["endpoint"+c].article.copy(a.article):d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0):(d["endpoint"+c]={},d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0)),d["endpoint"+c].articleid=a.articleid,d["endpoint"+c].label=a.label,d["endpoint"+c].type=a.type,d["endpoint"+c].article.___collection=d.___collection):
d["endpoint"+c]=a};b.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw Error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);b.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b=
"A",c="B";a.__endpointa.label!=this.get("__endpointb").label||(a.__endpointa.label==a.__endpointb.label||a.__endpointa.articleid!=this.get("__endpointb").articleid&&a.__endpointa.articleid)||(b="B",c="A");f(this.get("__endpointa"),b,this);f(this.get("__endpointb"),c,this);this.endpoints=function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};c?(this.connectedArticle=function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(b=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(b)},this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.prototype.setupConnection=function(a,b){if(!(a&&(a.articleid||a.article)&&a.label&&b&&(b.articleid||b.article)&&b.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",e(a,"A",this));this.set("__endpointb",e(b,"B",this))};b.Appacitive.Connection.get=function(a,c,d){a=a||{};if(!a.relation)throw Error("Specify relation");if(!a.id)throw Error("Specify id to fetch");var e=new b.Appacitive.Connection({__relationtype:a.relation,
__id:a.id});e.fields=a.fields;e.fetch(c,d)};var c=function(a){var c=[];a||(a=[]);a.forEach(function(a){c.push(new b.Appacitive.Connection(a))});return c},d=function(a,d,e){a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"==typeof d&&d(c(a.connections),a.paginginfo):(a=a||{},"function"==typeof e&&e(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof e&&e(a)};b.Appacitive.http.send(a)};b.Appacitive.Connection.multiGet=
function(a,c,e){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var k=new b.Appacitive.HttpRequest;k.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(a.relation,a.ids.join(","),a.fields);k.method="get";return d(k,c,e)}"function"==typeof c&&c([])};b.Appacitive.Connection.multiDelete=function(a,c,d){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");
if(a.ids&&0<a.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);e.method="post";e.data={idlist:a.ids};e.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof d&&d(a||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof d&&d(a||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else c()};b.Appacitive.Connection.getInterconnects=
function(a,b,c){a=new Appacitive.Queries.InterconnectsQuery(a);d(a.toRequest(),request,b,c)};b.Appacitive.Connection.getBetweenArticles=function(a,b,c){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);d(a.toRequest(),b,c)};b.Appacitive.Connection.getBetweenArticlesForRelation=function(a,b,c){(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).fetch(b,c)}})(global);
(function(b){b.Appacitive.Users=new function(){var e=null;this.currentUser=function(){return e};var f=function(a,c,d,e,f){var g=a.get("__id");if(!g||"string"!==typeof g||0==g.length)throw Error("Please specify valid userid");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid oldPassword");if(!d||"string"!==typeof d||0==d.length)throw Error("Please specify valid newPassword");e=e||function(){};f=f||function(){};c==d?"function"==typeof e&&e(a):(c={oldpassword:c,newpassword:d},
d=new b.Appacitive.HttpRequest,d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g),d.method="post",d.data=c,d.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof e?e(a):f(b,a))},d.onError=f,b.Appacitive.http.send(d))},c=function(a,c,d){var e=a.get("__id");e&&"string"===typeof e&&0!=e.length||"function"==typeof c&&c(a.linkedAccounts(),a);c=c||function(){};d=d||function(){};var f=new b.Appacitive.HttpRequest;f.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(e);f.method="get";f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(b=b.identities||[],0<b.length?a.set("__link",b):a.set("__link",null),"function"==typeof c&&c(b,a)):d(b.status,a)};f.onError=d;b.Appacitive.http.send(f)},d=function(a,c,d,e){var f=c.get("__id");f&&"string"===typeof f&&0!=f.length||d&&"function"==typeof d&&d();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");d=d||function(){};e=e||function(){};
var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getCheckinUrl(f,a.lat,a.lng);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d(accounts,c):"function"==typeof e&&e(a,c)};g.onError=e;b.Appacitive.http.send(g)},a=function(a,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);g.method="post";g.data=f;g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else c.set("__link",f),"function"==typeof d&&d(c)},g=function(a,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);g.method=
"post";g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else"function"==typeof d&&d(c)};this.setCurrentUser=function(c,l,h){if(!c)throw Error("Cannot set null object as user");var m=c;if(m instanceof Appacitive.User)if(m.get("__id")&&0!=m.get("__id").length)c=m.toJSON();else throw Error("Specify user __id");else m=new b.Appacitive.User(c,!0);b.Appacitive.localStorage.set("Appacitive-User",c);h||(h=60);e=m;l&&b.Appacitive.Session.setUserAuthHeader(l,
h);e.logout=function(a){b.Appacitive.Users.logout(a)};e.updatePassword=function(a,b,c,d){f(this,a,b,c,d);return this};e.linkFacebookAccount=function(c,d){var f=function(){a(Appacitive.Facebook.accessToken(),e,function(a){b.Appacitive.eventManager.fire("user..article."+a.get("__id")+".updated",a,{object:a});"function"==typeof c&&c(a)},d)};Appacitive.Facebook.getCurrentUserInfo(function(){f()},function(){Appacitive.Facebook.requestLogin(function(){f()},d)});return this};e.unlinkFacebookAccount=function(a,
c){g("facebook",this,function(c){b.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};e.logout=function(a){Appacitive.Users.logout(a)};e.checkin=function(a,b,c){d(a,this,b,c);return this};b.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(a,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return e};b.Appacitive.User=function(a){a=a||{};a.__schematype="user";
b.Appacitive.Article.call(this,a);return this};b.Appacitive.User.prototype=new b.Appacitive.Article("user");b.Appacitive.User.prototype.constructor=b.Appacitive.User;b.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?"object"!=typeof a||0<=a.length?0<=a.length||(a=a[0]):a=[a]:a=[];return a};b.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this;c(this,function(b){"function"==typeof a&&a(b,d)},b);return this};b.Appacitive.User.prototype.linkFacebookAccount=
function(b,c,d){a(b,this,c,d);return this};b.Appacitive.User.prototype.unlinkFacebookAccount=function(a,b){var c=this;g("facebook",this,function(){var b=c.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&c.set("__link",null);"function"==typeof a&&a(c)},b);return this};b.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,d){if(!a)throw Error("Specify userid for user delete");c=c||function(){};d=d||function(){};
(new b.Appacitive.Article({__schematype:"user",__id:a})).del(c,d)};this.deleteCurrentUser=function(a,c){var d=function(){b.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a()};if(null===e)d();else{var f=e.get("__id");this.deleteUser(f,function(){d()},c)}};this.createUser=this.createNewUser=function(a,c,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new b.Appacitive.User(a)).save(c,d)};this.signup=function(a,b,c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(a,c,d,f){c=c||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var g=this,m=new b.Appacitive.HttpRequest;m.method="post";m.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();m.data=a;m.onSuccess=function(b){b&&b.user?(f&&(b.user.__authType=f),g.setCurrentUser(b.user,
b.token,a.expiry),c({user:e,token:b.token})):(b=b||{},d(b.status))};m.onError=d;b.Appacitive.http.send(m)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(a,c,d,f){a=a||function(){};c=c||function(){};var g=this,m=function(){var d=
{accesstoken:b.Appacitive.Facebook.accessToken(),type:"facebook",expiry:864E5,createnew:!0};g.authenticateUser(d,function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:e,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};d?m():Appacitive.Facebook.requestLogin(function(a){m()},c)};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var d=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=this;this.getUserByToken(d,function(b){e.setCurrentUser(b,d);"function"==typeof a&&a(!0)},function(){"function"==typeof a&&a(!1)})}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,
subject:c};c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d():e(a)};c.onError=e;b.Appacitive.http.send(c)};var m=function(a,c,d){c=c||function(){};d=d||function(){};var e=new b.Appacitive.HttpRequest;e.url=a;e.method="get";e.onSuccess=function(a){a&&a.user?"function"==typeof c&&c(new Appacitive.User(a.user)):"function"==typeof d&&
d(a.status)};e.onError=d;b.Appacitive.http.send(e)};this.getUserByToken=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);m(a,c,d)};this.getUserByUsername=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);m(a,c,d)};this.logout=
function(a,c){e=null;b.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(b){b.Appacitive.Email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var f=function(c,d,a){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=c;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.email):(b=b||{},b.status=b.status||{},a(b.status.message||"Server error"))};
b.Appacitive.http.send(e)};this.setupEmail=function(b){b=b||{};e.smtp.username=b.username||e.smtp.username;e.from=b.from||e.from;e.smtp.password=b.password||e.smtp.password;e.smtp.host=b.smtp.host||e.smtp.host;e.smtp.port=b.smtp.port||e.smtp.port;e.smtp.enablessl=b.enableSSL||e.smtp.enablessl;e.replyto=b.replyTo||e.replyto};this.sendTemplatedEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.templateName)throw Error("template name is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1==b.isHtml?!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)};this.sendRawEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.body)throw Error("body is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{content:b.body||"",ishtml:!1==b.isHtml?
!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)}}})(global);
(function(b){var e=function(){var b=require("facebook-node-sdk"),c=null,d=this.FB=null,a=!0;this.initialize=function(c){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!c.appId)throw Error("Please provide appid");if(!c.appSecret)throw Error("Please provide app secret");d=c.appSecret;this.FB=new b({appId:_appId,secret:d});a=!0};this.requestLogin=function(b,d,e){a?(c=accesstoken,FB.setAccessToken(e),Appacitive.Users.loginWithFacebook(b,d,!0)):"function"==typeof d&&
d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,d){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&c?(b=b||function(){},d=d||function(){},this.FB.api("/me",function(a,c){c?"function"==typeof b&&b(c):"function"==typeof d&&d("Access token is invalid")})):d("Either intialize facebook with your appid and appsecret or set accesstoken")};this.accessToken=function(){return 1==arguments.length?(c=arguments[0],this):
c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,b){a=a||function(){};Appacitive.Facebook.accessToken="";"function"==typeof a&&a()}};b.Appacitive.Facebook=b.Appacitive.runtime.isBrowser?new function(){var b=null,c=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);c=!0};this.requestLogin=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
d=d||function(){};a=a||function(){};FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,"function"==typeof d&&d(c.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");d=d||function(){};a=a||function(){};FB.api("/me",function(c){c&&!c.error?(b=FB.getAuthResponse().accessToken,"function"==typeof d&&d(c)):"function"==
typeof a&&a()})};this.accessToken=function(){return 1==arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.Facebook.accessToken="";try{FB.logout(function(a){Appacitive.Users.logout();"function"==typeof b&&b()})}catch(c){"function"==typeof a&&a(c.message)}}}:new e})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify push options");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();d.method="post";d.data=e;d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};
this.getNotification=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify notification id");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};this.getAllNotifications=
function(e,f,c){f=f||function(){};c=c||function(){};e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)}}})(global);
(function(b){b.Appacitive.File=function(e){e=e||{};this.fileId=e.fileId;this.contentType=e.contentType;this.fileData=e.fileData;var f=function(a,c,d){var e=new b.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=c;e.onError=d;b.Appacitive.http.send(e)},c=function(a,c,d,e,f){(new FormData).append("fileToUpload",c);var n=new b.Appacitive.HttpRequest;n.url=a;n.method="PUT";n.data=c;n.headers.push({key:"content-type",value:d});n.onSuccess=e;n.onError=f;n.send()};this.save=function(b,c,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,b,c,e):d(this,b,c,e)};var d=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(h){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==
b.status.code?c(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this},a=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(h){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==b.status.code?c(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(b,that)};d.onError=c;b.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};c=c||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(b){b&&b.status&&"200"==b.status.code?(d.url=b.uri,"function"==typeof a&&a(b.uri)):"function"==typeof c&&"function"==typeof c&&c(b.status,d)};e.onError=c;b.Appacitive.http.send(e);return this}}})(global);
(function(b){b.Appacitive.Date={};b.Appacitive.Date.parseISODate=function(b){try{var f=new Date(b);if(isNaN(f)){var c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,d=!1;if(!c.exec(b))if(c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,c.exec(b))d=!0;else return null;var a=b.split("T"),g=a[0].split("-"),m=a[1].split("Z")[0].split(":"),k=m[2].split("."),l=Number(m[0]),f=new Date;f.setUTCFullYear(Number(g[0]));f.setUTCMonth(Number(g[1])-1);f.setUTCDate(Number(g[2]));
d||(f.setUTCHours(Number(l)),f.setUTCMinutes(Number(m[1])),f.setUTCSeconds(Number(k[0])),k[1]&&f.setUTCMilliseconds(Number(k[1])))}return f}catch(h){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(f){return null}};b.Appacitive.Date.toISODate=function(b){try{return b=b.toISOString().split("T")[0]}catch(f){return null}};b.Appacitive.Date.toISOTime=function(b){try{return b=b.toISOString().split("T")[1],b=b.replace("Z","0000Z")}catch(f){return null}};
b.Appacitive.Date.parseISOTime=function(b){try{var f=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b))return null;var c=b.split("T");1==c.length&&c.push(c[0]);var d=c[1].split("Z")[0].split(":"),a=d[2].split(".");f.setUTCHours(Number(Number(d[0])));f.setUTCMinutes(Number(d[1]));f.setUTCSeconds(Number(a[0]));a[1]&&f.setUTCMilliseconds(Number(a[1]));return f}catch(g){return null}}})(global);
(function(b){b.Appacitive.localStorage=new function(){var e=b.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(f,c){c=c||"";if(!f)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(d){}f=b.Appacitive.getAppPrefix(f);e[f]=c;return!0};this.get=function(f){if(!f)return null;f=b.Appacitive.getAppPrefix(f);f=e.getItem(f);if(!f)return null;if("{"==f[0])try{f=JSON.parse(f)}catch(c){}return f};this.remove=function(f){if(f){f=b.Appacitive.getAppPrefix(f);try{delete e[f]}catch(c){}}}}})(global);
(function(b){b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie=new function(){this.setCookie=function(e,f,c,d){e=b.Appacitive.getAppPrefix(e);var a="";c&&(a=new Date,a.setTime(a.getTime()+6E4*c),a.toGMTString());a=d?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=e+"="+f+a+"; path=/;"+c};this.readCookie=function(e){e=
b.Appacitive.getAppPrefix(e);e+="=";for(var f=document.cookie.split(";"),c=0;c<f.length;c++){for(var d=f[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(e))return d.substring(e.length,d.length)}return null};this.eraseCookie=function(e){e=b.Appacitive.getAppPrefix(e);this.setCookie(e,"",-1,!0)}})})(global);"undefined"==typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{set:e,enumerable:!0,configurable:!0})}}))}catch(defPropException){}
Array.prototype.forEach||(Array.prototype.forEach=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var c=0;c<f;c++)c in this&&b.call(e,this[c],c,this)});"bind"in Function.prototype||(Function.prototype.bind=function(b){var e=this;if(1>=arguments.length)return function(){return e.apply(b,arguments)};var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(b,0===arguments.length?f:f.concat(Array.prototype.slice.call(arguments)))}});
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,e){void 0===e&&(e=0);0>e&&(e+=this.length);0>e&&(e=0);for(var f=this.length;e<f;e++)if(e in this&&this[e]===b)return e;return-1});
"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,e){void 0===e&&(e=this.length-1);0>e&&(e+=this.length);e>this.length-1&&(e=this.length-1);for(e++;0<e--;)if(e in this&&this[e]===b)return e;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,e){for(var f=0,c=this.length;f<c;f++)f in this&&b.call(e,this[f],f,this)});
"map"in Array.prototype||(Array.prototype.map=function(b,e){for(var f=Array(this.length),c=0,d=this.length;c<d;c++)c in this&&(f[c]=b.call(e,this[c],c,this));return f});"filter"in Array.prototype||(Array.prototype.filter=function(b,e){for(var f=[],c,d=0,a=this.length;d<a;d++)d in this&&b.call(e,c=this[d],d,this)&&f.push(c);return f});"every"in Array.prototype||(Array.prototype.every=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&!b.call(e,this[f],f,this))return!1;return!0});
"some"in Array.prototype||(Array.prototype.some=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&b.call(e,this[f],f,this))return!0;return!1});Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(b){function e(b){return 10>b?"0"+b:b}return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON);
var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(a){if(a&&a.send&&"function"==typeof a.send)a.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],b={},d=0,f={},e=0;this.addProcessor=function(a){a&&(a.pre=a.pre||function(){},a.post=a.post||function(){},p(a.pre),q(a.post))};var p=function(a){d+=1;b[d]=a;return d},
q=function(a){e+=1;f[e]=a;return e};this.enqueueRequest=function(a){c.push(a)};this.changeRequestForCors=function(a){var c={m:a.method.toUpperCase()};a.headers.forEach(function(a){c[a.key]=a.value});a.headers=[];a.headers.push({key:"Content-Type",value:"text/plain"});a.method="POST";a.data&&(c.b=a.data);delete a.data;global.Appacitive.config.debug&&(-1==a.url.indexOf("?")?a.url+="?debug=true":a.url+="&debug=true");try{a.data=JSON.stringify(c)}catch(b){}return a};this.notify=function(){if(0!==c.length){var d=
[],l;for(l in f)f.hasOwnProperty(l)&&d.push(f[l]);for(;0<c.length;){var e=c.shift(),n=[];for(l in b)b.hasOwnProperty(l)&&n.push(b[l](e));this.changeRequestForCors(e);a.send(e,d,n)}}};this.onResponse=function(a){console.dir(a)}},e=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(c,b){a()};this.onError=function(c){a()}},f=null,f=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,c=function(a){var c=
new XDomainRequest;c.onload=function(){var b=c.responseText;try{var d=c.contentType;if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=b,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),b=JSON.parse(d)}catch(f){}a.onSuccess(b,this)};c.onerror=c.ontimeout=function(){a.onError({code:"400",message:"Server Error"},c)};c.onprogress=function(){};c.open(a.method,a.url,!0);c.send(a.data);return c},d=function(a){if(!a.url)throw Error("Please specify request url");
a.method||(a.method="GET");a.headers||(a.headers=[]);var b={},d=!0;a.headers.forEach(function(a){"content-type"==a.key.toLowerCase()&&(d=!0,"application/json"==a.value.toLowerCase()||"application/javascript"==a.value.toLowerCase())&&(d=!1)});if(d)b=a.data;else if(a.data&&(b=a.data,"object"==typeof a.data))try{b=JSON.stringify(b)}catch(l){}a.onSuccess&&"function"==typeof a.onSuccess||(a.onSuccess=function(){});a.onError&&"function"==typeof a.onError||(a.onError=function(){});if(-1!=navigator.userAgent.indexOf("MSIE 8")||
-1!=navigator.userAgent.indexOf("MSIE 9"))return a.data=b,new c(a);var h=new f;h.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var b=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase())b=c,global.Appacitive.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),c=JSON.parse(b)}catch(d){}a.onSuccess(c,
this)}else a.onError({code:this.status,message:this.statusText},this)};h.open(a.method,a.url,!0);for(var e=0;e<a.headers.length;e+=1)h.setRequestHeader(a.headers[e].key,a.headers[e].value);global.Appacitive.runtime.isBrowser||h.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");h.send(b);return h},a=function(){var a=new e;a.isOnline=function(){return!0};var c=function(c,b,f){new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d,e){if(d){try{d=JSON.parse(d)}catch(m){}var r=
d;if(b.length!=f.length)throw Error("Callback length and state length mismatch!");for(var t=0;t<b.length;t+=1)b[t].apply({},[r,f[t]]);a.onResponse(d,c)}else a.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(b){a.onError(c,b)}})};a.send=function(a,b,d){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,b,d)};a.upload=function(a,b,d){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,b,d,!0)};
return a};global.Appacitive.http=new function(){var c=new a,d=new b(c),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;d.addProcessor(a)};this.send=function(a){d.enqueueRequest(a);c.isOnline()&&!1==f&&d.notify()};this.flush=function(a){a?d.notify():c.isOnline()&&d.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,
[c]);else a.onError(c)};c.onError=this.onError;this.onResponse=function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[a]);else c.onSuccess(a)};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new d(this,a)}};(function(a){a.Appacitive&&a.Appacitive.http&&
(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,b){try{a.Appacitive.Session.isSessionValid(c)?c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(b))}catch(d){}}}),a.Appacitive.http.addProcessor({pre:function(a){return(new Date).getTime()},post:function(a,c){var b=(new Date).getTime()-
c;a._timeTakenInMilliseconds=b}}))})(global)})();
(function(b){String.format=function(b,f){if(1>=arguments.length)return b;for(var c=arguments.length-2,d=0;d<=c;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var f=RegExp("^"+b),c=this;f.test(c)&&(c=c.slice(1,c.length));f=RegExp(b+"$");f.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(b){"undefined"==typeof b&&(b="");for(var f=
"",c=0;c<b.length;c+=1)-1==" .,;#".indexOf(b[c])&&(f+=b[c]);return f=f.toLowerCase()};String.contains=function(b,f){return-1!=b.indexOf(f)};String.startsWith=function(b,f){return 0==b.indexOf(f)};Array.distinct=function(b){var f=[],c=b.length,d,a,g;for(a=0;a<c;a++){d=void 0;for(g=0;g<f.length;g++)if(b[a].toLowerCase()===f[g].toLowerCase()){d=!0;break}d||f.push(b[a])}return f};Object.isEmpty=function(b){if(!b)return!0;var f=!0;for(keys in b){f=!1;break}return f};b.dateFromWcf=function(b,f){var c=/Date\(([^)]+)\)/.exec(b);
if(2!=c.length){if(!f)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var e=function(b){"object"==typeof b&&(0<b.length&&("string"==typeof b[0]||"number"==typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user=
{userServiceUrl:"user",getCreateUrl:function(b){return String.format("{0}/create?fields={1}",this.userServiceUrl,e(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token=",this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,b)},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,d){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,b,c,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,e(b))},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.deviceServiceUrl,b)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,
c,d){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),a=d?a+"?psize="+d:a+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!=c[b].trim().length&&(a=a+"&"+c[b]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,b,c)},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.articleServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,e(c))},getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,e(c))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,
b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,d,a){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,d,c);if("undefined"!==typeof a&&0<a.length)for(b=0;b<a.length;b+=1)g=g+"&"+a[b];return g},getConnectedArticles:function(b,c,d){var a="",a=String.format("{0}/{1}/{2}/find",
this.connectionServiceUrl,b,c);if(d&&d.length&&0<d.length)for(b=0;b<d.length;b+=1)a=0==b?a+("?"+d[b]):a+("&"+d[b]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push=
{pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,
c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(d,a){var g=a.split("="),
e=g[1];2<g.length&&g.forEach(function(a,b){0!=a&&1!=a&&(e=e+"="+g[a])});g[0].toLowerCase()==b&&(c=[g[0],e])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var f={};this.subscribe=function(c,d){if("string"!=typeof c||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof f[c]&&(f[c]=[]);var a=b();f[c].push({callback:d,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var d=-1,a=null,g;for(g in f)for(var e=0;e<f[g].length;e+=
1)if(f[g][e].id==b){d=e;a=g;break}return-1!=d?(f[a].splice(d,1),!0):!1};this.fire=function(b,d,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;if("undefined"!=typeof f.all)for(var g=0;g<f.all.length;g+=1)f.all[g].callback(d,a);g=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof f[b])for(var e=0;e<f[b].length;e+=1)g(f[b][e].callback,d,a)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
f[b]&&(f[b].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(f)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},f=null,c=null,d=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){b.Appacitive.Session.create(null)};this.create=function(a,d){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var l=new e;l.apikey=c;var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+"application.svc/session";
g.method="put";g.data=l;g.onSuccess=function(c){c&&c.status&&"200"==c.status.code?(f=c.session.sessionkey,b.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(c),b.Appacitive.Session.onSessionCreated()):d&&"function"==typeof d&&d(c)};g.onError=d;b.Appacitive.http.send(g)};b.Appacitive.http.addProcessor({pre:function(g){b.Appacitive.Session.useApiKey?g.headers.push({key:"ak",value:c}):g.headers.push({key:"as",value:f});!0===a&&(1==g.headers.filter(function(a){return"ut"==a.key}).length?g.headers.forEach(function(a){"ut"==
a.key&&(a.value=d)}):g.headers.push({key:"ut",value:d}))}});this.setUserAuthHeader=function(c,g,l){try{c&&(a=!0,d=c,l||(g||(g=60),-1==g&&(g=null),b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,g),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",g?g:-1,g))))}catch(e){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c,g){c&&("function"!=typeof c&&"boolean"==typeof c)&&(g=c,c=function(){});a=!1;c=c||function(){};b.Appacitive.localStorage.remove("Appacitive-User");
b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(d&&!g)try{var l=new b.Appacitive.HttpRequest;l.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(d);d=null;l.method="POST";l.data={};l.onSuccess=function(){"function"==typeof c&&c()};b.Appacitive.http.send(l)}catch(e){}else d=null,"function"==typeof c&&c()};this.isSessionValid=function(a){if(!a)return!0;
if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){f=null;this.useApiKey=!0};this.get=function(){return f};this.setSession=function(a){a&&(f=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(c=a,this.useApiKey=!0)};var g="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a}return g}};b.Appacitive.getAppPrefix=
function(e){return b.Appacitive.Session.environment()+"/"+b.Appacitive.appId+"/"+e};b.Appacitive.initialize=function(e){e=e||{};if(!b.Appacitive.Session.initialized){if(!e.apikey||0==e.apikey.length)throw Error("apikey is mandatory");if(!e.appId||0==e.appId.length)throw Error("appId is mandatory");b.Appacitive.Session.setApiKey(e.apikey);b.Appacitive.Session.environment(e.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.appId=e.appId;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=
e.persistUserToken;e.debug&&(b.Appacitive.config.debug=!0);if(e.userToken)-1==e.expiry?e.expiry=null:e.expiry||(e.expiry=3600),b.Appacitive.Session.setUserAuthHeader(e.userToken,e.expiry),e.user?b.Appacitive.Users.setCurrentUser(e.user):(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e);else if(b.Appacitive.runtime.isBrowser){var f=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(f){var c=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");
c||(c=60);(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e,f,c)}}}}})(global);(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(e){e.headers.push({key:"e",value:b.Appacitive.Session.environment()})}})})(global);
(function(b){var e=b.Appacitive;e.GeoCoord=function(a,b){_validateGeoCoord=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(_validateGeoCoord(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var f=function(){this.toString=function(){}},c=function(a){f.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};c.prototype=new f;c.prototype.constructor=c;var d=function(a){a=a||"";if("object"!=typeof a.value||!a.value.length)throw Error("Specify field value as array");c.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,"string"==typeof this.value[b]?"'"+this.value[b]+"'":"number"==typeof this.value[b]?this.value[b]:this.value[b].toString()));return"("+a.join(" or ")+
")"}};d.prototype=new c;d.prototype.constructor=d;var a=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;c.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};a.prototype=new c;a.prototype.constructor=a;var g=function(a){a=a||"";if(!(a.geoCoord&&a.geoCoord instanceof
e.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};g.prototype=new c;g.prototype.constructor=a;var m=function(a){a=a||"";if(!a.geoCoords||0==a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");c.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0==b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new c;m.prototype.constructor=a;_tagFilter=function(a){f.call(this);a=a||{};if(!a.tags||"object"!=
typeof a.tags||0==a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};_tagFilter.prototype=new f;_tagFilter.prototype.constructor=_tagFilter;_compoundFilter=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var c=0;c<b.length;c+=1){if(!(b[c]instanceof f))throw Error("Invalid filter provided");
this.innerFilters.push(b[c])}this.toString=function(){var a=this.operator,b="(";this.innerFilters.forEach(function(c){b=1==b.length?b+(" "+c.toString()):b+String.format(" {0} {1} ",a,c.toString())});return b+=")"}};_compoundFilter.prototype=new f;_compoundFilter.prototype.constructor=_compoundFilter;var k=function(a){if(!a||0==a.length)throw Error("Specify value");this.value=a;this.getValue=function(){return"string"==typeof this.value?"'"+this.value+"'":"number"==typeof this.value?this.value:"object"==
typeof this.value&&this.value instanceof date?"datetime('"+e.Date.toISOString(this.value)+"')":this.value.toString()}},l=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"date('"+e.Date.toISODate(this.value)+"')":"date('"+this.value+"'')"}},h=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"time('"+e.Date.toISOTime(this.value)+"')":"time('"+this.value+"'')"}},n=function(a){this.value=
a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"datetime('"+e.Date.toISOString(this.value)+"')":"datetime('"+this.value+"'')"}},p=function(b,e,f){f||(f=this);f.type=b;f.name=e;f.equalTo=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"=="})};f.equalToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};f.equalToTime=function(a){return new c({field:this.name,fieldType:this.type,
value:new h(a),operator:"=="})};f.equalToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"=="})};f.greaterThan=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">"})};f.greaterThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};f.greaterThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">"})};f.greaterThanDateTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new n(a),operator:">"})};f.greaterThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">="})};f.greaterThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};f.greaterThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">="})};f.greaterThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),
operator:">="})};f.lessThan=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<"})};f.lessThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};f.lessThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<"})};f.lessThanDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<"})};f.lessThanEqualTo=function(a){return new c({field:this.name,
fieldType:this.type,value:new k(a),operator:"<="})};f.lessThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};f.lessThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<="})};f.lessThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<="})};f.like=function(a){return new c({field:this.name,fieldType:this.type,value:new k("*"+a+"*"),operator:"like"})};
f.startsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a+"*"),operator:"like"})};f.endsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new k("*"+a),operator:"like"})};f.contains=function(a){return new d({field:this.name,fieldType:this.type,value:a,operator:"=="})};f.between=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new k(b),val2:new k(c),operator:"between"})};f.betweenDate=function(b,c){return new a({field:this.name,
fieldType:this.type,val1:new l(b),val2:new l(c),operator:"between"})};f.betweenTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new h(b),val2:new h(c),operator:"between"})};f.betweenDateTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new n(b),val2:new n(c),operator:"between"})};f.withinCircle=function(a,b,c){return new g({field:this.name,fieldType:this.type,geoCoord:a,distance:b,unit:c,operator:"within_circle"})};f.withinPolygon=function(a){return new m({field:this.name,
fieldType:this.type,geoCoords:a,operator:"within_polygon"})}};_propertyExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;p("property",a,this);return this};_aggregateExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=function(a){return b.greaterThanEqualTo(a)};this.lessThan=
function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,c){return b.between(a,c)};return this};_attributeExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};this.contains=function(a){return b.contains(a)};
return this};e.Filter={Property:function(a){return new _propertyExpression(a)},Aggregate:function(a){return new _aggregateExpression(a)},Attribute:function(a){return new _attributeExpression(a)},Or:function(){return new _compoundFilter("or",arguments)},And:function(){return new _compoundFilter("and",arguments)},taggedWithOneOrMore:function(a){return new _tagFilter({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new _tagFilter({tags:a,operator:"tagged_with_all"})}}})(global);
(function(b){b.Appacitive.Queries={};var e=function(b){b=b||{};var a=1,c=20;this.pageNumber=function(){return 1==arguments.length?(a=arguments[0]||1,this):a};this.pageSize=function(){return 1==arguments.length?(c=arguments[0]||20,this):c};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};e.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var f=function(b){b=b||{};var a="__UtcLastUpdatedDate",c=!1;this.orderBy=function(){return 1==arguments.length?(a=
arguments[0]||"__UtcLastUpdatedDate",this):a};this.isAscending=function(){return 1==arguments.length?(c="undefined"==typeof arguments[0]?!1:arguments[0],this):c};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};f.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var c=function(c){var a=c||{},g="",m="",k="",l=a.queryType||"BasicQuery",h=new e(c),n=new f(c),p=a.schema||a.relation,q=a.relation?"connection":"article";this.type=function(){return q};this.entityType=
function(){return p};this.queryType=function(){return l};this.pageQuery=function(){return h};this.pageNumber=function(){return 1==arguments.length?(h.pageNumber(arguments[0]),this):h.pageNumber};this.pageSize=function(){return 1==arguments.length?(h.pageSize(arguments[0]),this):h.pageSize};this.sortQuery=function(){return n};this.orderby=function(){return 1==arguments.length?(n.orderby(arguments[0]),this):n.orderby};this.isAscending=function(){return 1==arguments.length?(n.isAscending(arguments[0]),
this):n.isAscending};this.filter=function(){return 1==arguments.length?(g=arguments[0],this):g};this.freeText=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?m=arguments[0]:"object"==typeof a&&a.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?k=a:"object"==typeof a&&a.length&&(k=a.join(","));return this}return k};this.filter(a.filter||"");this.freeText(a.freeText||"");this.fields(a.fields||
"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(b){for(var c in b)a[c]=b[c];h=new e(a);n=new f(a);return this};this.getQueryString=function(){var a=h.toString()+"&"+n.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");this.fields()&&0<this.fields().trim().length&&
(a+="&fields="+this.fields());return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+q+"/"+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};var r=function(a){var c=[];a||(a=[]);var d="article"==q?"Article":"Connection";a.forEach(function(a){c.push(new b.Appacitive[d](a,
!0))});return c};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(r(b[q+"s"]),b.paginginfo):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};this.count=function(a,c){a=a||function(){};c=c||function(){};var d=h.pageSize,g=h.pageNumber;h.pageSize=1;h.pageNumber=
999999999;var l=this,e=this.toRequest();e.onSuccess=function(b){h.pageSize=d;h.pageNumber=g;b=b||{};var e=b.paginginfo,k=0;if(e)k=e.totalrecords;else if(b.status&&b.status.code&&"200"==b.status.code)k=0;else{b=b.status||{message:"Server error",code:400};"function"==typeof c&&c(b,l);return}"function"==typeof a&&a(k)};e.onError=function(a){h.pageSize=d;h.pageNumber=g;a=a||{message:"Server error",code:400};"function"==typeof c&&c(a,l)};b.Appacitive.http.send(e);return this}};b.Appacitive.Queries.FindAllQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";c.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new c;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedArticlesQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for connected articles query");if(!d.articleId)throw Error("Specify articleId for connected articles query");
d.schema&&delete d.schema;d.queryType="ConnectedArticlesQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.label="";d.label&&("string"==typeof d.label&&0<d.label.length)&&(this.label="&label="+d.label);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.ConnectedArticlesQuery.prototype=
new c;b.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=b.Appacitive.Queries.ConnectedArticlesQuery;b.Appacitive.Queries.GetConnectionsQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!d.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!d.label||0==d.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");d.schema&&delete d.schema;d.queryType="GetConnectionsQuery";c.call(this,
d);this.articleId=d.articleId;this.relation=d.relation;this.label=d.label;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+this.getQueryString()};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;
b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(d,a){d=d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!d.articleBId||"string"!=typeof d.articleBId||0==d.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");d.schema&&delete d.schema;d.queryType=a||"GetConnectionsBetweenArticlesQuery";c.call(this,d);this.articleAId=d.articleAId;
this.articleBId=d.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"==this.queryType&&d.label&&"string"==typeof d.label&&0<d.label.length?"&label="+d.label:"";this.relation=d.relation&&"string"==typeof d.relation&&0<d.relation.length?d.relation+"/":"";this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+
"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,
"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"==typeof a&&a(new b.Appacitive.Connection(d.connection)):(d=d||{},"function"==typeof c&&c(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};return c};b.Appacitive.Queries.InterconnectsQuery=function(d){d=
d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(d.articleBIds&&"object"==typeof d.articleBIds&&0<d.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");d.schema&&delete d.schema;d.queryType="InterconnectsQuery";c.call(this,d);this.articleAId=d.articleAId;this.articleBIds=d.articleBIds;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();
a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new c;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,a){if(!c||0==c.length)throw Error("Specify name of filter query");this.name=c;this.data=
{};this.queryType="GraphFilterQuery";a&&(this.data.placeholders=a);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(b.ids?b.ids:[]):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};
d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}};b.Appacitive.Queries.GraphProjectQuery=function(c,a,e){if(!c||0==c.length)throw Error("Specify name of project query");if(!a||!a.length)throw Error("Specify ids to project");this.name=c;this.data={ids:a};this.queryType="GraphProjectQuery";e&&(this.data.placeholders=e);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";
a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var f=function(a){var b,c;for(c in a)if("status"!==c){b=a[c];break}var d=function(a,b,c){var e=[];a.forEach(function(a){var g=a.__children;delete a.__children;var l=a.__edge;delete a.__edge;a=new Appacitive.Article(a,!0);a.children={};for(var k in g)a.children[k]=[],a.children[k]=d(g[k].values,g[k].parent,a.id);l&&(l.__endpointa={articleid:c,label:b},l.__endpointb={articleid:a.id,
label:l.label},delete l.label,a.connection=new Appacitive.Connection(l));e.push(a)});return e};return d(b.values)};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(f(b)):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}}})(global);
(function(b){b.Appacitive.BaseObject=function(e,f){var c={},d=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var d in a[c])b[c][d]=a[c][d]}else b[c]=a[c]},a={};d(e,a);f&&d(a,c);!c.__id&&a.__id&&(c.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.cid=g;var m="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),k=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=function(){return JSON.parse(JSON.stringify(a))};
this.toJSON=function(){return JSON.parse(JSON.stringify(a))};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};a.__attributes||(a.__attributes={});c.__attributes||(c.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");
a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var h=function(){var b=!1,d=JSON.parse(JSON.stringify(c.__attributes)),e;for(e in a.__attributes)"undefined"==typeof a.__attributes[e]||null===a.__attributes[e]?(d[e]=null,b=!0):a.__attributes[e]!=c.__attributes[e]?(d[e]=a.__attributes[e],b=!0):a.__attributes[e]==c.__attributes[e]&&delete d[e];return b?
d:null};this.getChangedAttributes=h;this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var n=[];a.__tags||(a.__tags=[]);c.__tags||(c.__tags=[]);this.tags=function(){return a.__tags?a.__tags:[]};this.addTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;a.__tags.push(b);
a.__tags=Array.distinct(a.__tags);if(!n||!n.length)return this;b=n.indexOf(b);-1!=b&&n.splice(b,1);return this};this.removeTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;n.push(b);n=Array.distinct(n);if(!a.__tags||!a.__tags.length)return this;b=a.__tags.indexOf(b);-1!=b&&a.__tags.splice(b,1);return this};var p=function(){var b=[];a.__tags.every(function(a){-1==c.__tags.indexOf(a)&&b.push(a)});return b};this.getChangedTags=p;this.getRemovedTags=function(){return _removetags};var q=
function(b){var d=!1,e=JSON.parse(JSON.stringify(c)),g;for(g in a)"undefined"==typeof a[g]||null===a[g]?(e[g]=null,d=!0):a[g]!=c[g]?"__tags"==g||"__attributes"==g?delete e[g]:(e[g]=a[g],d=!0):a[g]==c[g]&&delete e[g];try{m.forEach(function(a){e[a]&&delete e[a]})}catch(l){}b?(a.__tags&&0<a.__tags.length&&(e.__addtags=p(),d=!0),n&&0<n.length&&(e.__removetags=n,d=!0)):a.__tags&&0<a.__tags.length&&(e.__tags=p(),d=!0);(b=h())?(e.__attributes=b,d=!0):delete e.__attributes;return d?e:!1};this.changed=function(){return q()};
this.hasChanged=function(){var a=q(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=q(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&
arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return c};var r="";this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?r=a:"object"==typeof a&&a.length&&(r=a.join(","));return this}return r};this.get=function(b){if(b)return a[b]};this.set=function(b,c){if(!b||"string"!=typeof b||0==b.length)return this;null==c||"undefined"==c?a[b]=null:"string"==typeof c?a[b]=c:"number"==typeof c?a[b]=c+"":"object"==typeof c&&(0<=c.length?a[b]=c:-1!==k.indexOf(b)&&
(a[b]=c));return this};this.unset=function(b){if(!b||"string"!=typeof b||0==b.length||0==b.indexOf("__"))return this;try{delete a[b]}catch(c){}return this};this.has=function(b){return b&&"string"==typeof b&&0!=b.length?a[b]&&"undefined"!=typeof a[b]?!0:!1:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(b,e){b&&(d(b,a),d(b,c));return this};this.save=function(b,c){a.__id?
u.apply(this,arguments):t.apply(this,arguments);return this};var t=function(e,g){e=e||function(){};g=g||function(){};var k=this,f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,r);!a.__schematype||"user"!=a.__schematype.toLowerCase()&&"device"!=a.__schematype.toLowerCase()||(f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl());var h=new b.Appacitive.HttpRequest;h.url=
f;h.method="put";a.__revision&&delete a.__revision;h.data=a;h.onSuccess=function(h){var f=null;h&&(h.article||h.connection||h.user||h.device)&&(f=h.article||h.connection||h.user||h.device);h&&f?(c=f,a.__id=f.__id,d(f,a),k.connectionCollections&&0<k.connectionCollections.length&&k.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})}),"connection"==k.type&&k.parseConnection(),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+".created",k,{object:k}),
"function"==typeof e&&e(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+".createFailed",k,{error:h.status}),"function"==typeof g&&g(h.status,k))};h.onError=function(a){a=l(a);"function"==typeof g&&g(a,k)};b.Appacitive.http.send(h);return this},u=function(e,g){e=e||function(){};g=g||function(){};var h=q(!0),k=this;if(h){var f=new b.Appacitive.HttpRequest,m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||
a.__relationtype,c.__id?c.__id:a.__id,r);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&(m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(c.__id));f.url=m;f.method="post";f.data=h;f.onSuccess=function(h){h&&(h.article||h.connection||h.user||h.device)?(c=h.article||h.connection||h.user||h.device,d(c,a),n=[],b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updated",
k,{object:k}),"function"==typeof e&&e(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updateFailed",k,{object:h.status}),"function"==typeof g&&g(h.status,k))};f.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==typeof g&&g(a,k)};b.Appacitive.http.send(f)}else"function"==typeof e&&e(k);return this};this.fetch=function(e,g){e=e||function(){};g=g||function(){};if(a.__id){var h=
this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,r),f=new b.Appacitive.HttpRequest;f.url=k;f.method="get";f.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,d(c,a),h.___collection&&"article"==h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof e&&e(h)):(b=b||{},b.status=b.status||{},b.status=l(b),"function"==typeof g&&
g(b.status,h))};f.onError=function(a){a=l(a);"function"==typeof g&&g(a,h)};b.Appacitive.http.send(f);return this}"function"==typeof g&&g({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,d,e){if(a.__id){c=c||function(){};d=d||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl,k=k+b.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&
(k=b.Appacitive.config.apiBaseUrl,k+=b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id));e&&!0===e&&(k=-1==k.indexOf("?")?k+"?deleteconnections=true":k+"&deleteconnections=true");e=new b.Appacitive.HttpRequest;e.url=k;e.method="delete";e.onSuccess=function(b){"200"==b.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof c&&c(b)):(b=l(b),"function"==typeof d&&d(b,h))};e.onError=function(a){a=l(a);"function"==typeof d&&d(a,h)};b.Appacitive.http.send(e)}else this.___collection&&
this.___collection.removeByCId(g),"function"==typeof c&&c(this)}};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var e=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),c="",d,a,g,m,k,l,h=0,b=b.replace(/\r\n/g,"\n");a="";for(g=0;g<b.length;g++)m=b.charCodeAt(g),128>m?a+=String.fromCharCode(m):(127<m&&2048>m?a+=String.fromCharCode(m>>6|192):(a+=String.fromCharCode(m>>12|224),a+=String.fromCharCode(m>>6&63|128)),a+=String.fromCharCode(m&63|128));for(b=a;h<b.length;)d=b.charCodeAt(h++),a=b.charCodeAt(h++),
g=b.charCodeAt(h++),m=d>>2,d=(d&3)<<4|a>>4,k=(a&15)<<2|g>>6,l=g&63,isNaN(a)?k=l=64:isNaN(g)&&(l=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return c.toString()}})(global);
(function(b){b.Appacitive.ArticleCollection=function(e){var f=null,c=null,d=[],a={};"string"==typeof e?a.schema=e:a=e;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var f=a.schema,g=this;e=function(d){d.type="article";d.schema?f=d.schema:d.schema=f;c=new b.Appacitive.Queries.FindAllQuery(d);a=d;g.extendOptions=c.extendOptions};this.setFilter=function(d){a.filter=d;a.type="article";c?c.filter(d):(c=new b.Appacitive.Queries.FindAllQuery(a),
g.extendOptions=c.extendOptions);return this};this.setFreeText=function(d){d||0!=d.trim().length||(a.freeText="");a.freeText=d;a.type="article";c?c.freeText(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.setFields=function(d){d||(d="");a.fields=d;a.type="article";c?c.fields(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.reset=function(){f=a=null;d.length=0;c=null};var m=["BasicFilterQuery"];this.query=
function(){if(1==arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==m.indexOf(a.queryType()))throw Error("ArticleCollection only accepts "+m.join(", "));d.length=0;c=a;return this}return c};this.setOptions=e;e(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=f)throw Error("Null article passed or schema type mismatch");
var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!=b?d.splice(b,1):d.push(a);return this};this.getArticleById=function(a){var b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllArticles=function(){return Array.prototype.slice.call(d).map(function(a){return a.getArticle()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getArticle().__id&&
c.getArticle().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var k=function(a,b,c){a.length&&0!==a.length||(a=[]);a.forEach(function(a){a.___collection=g;d.push(a)});"function"==typeof c&&c(b,g)};this.fetch=function(a,b){d.length=0;c.fetch(function(b,c){k(b,c,a)},function(a){"function"==typeof b&&b(a,g)});return this};this.count=function(a,b){this.query.count(a,
b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=f;a=new b.Appacitive.Article(a);a.___collection=g;d.push(a);return a};this.map=
function(){return d.map.apply(this,arguments)};this.forEach=function(){return d.forEach.apply(this,arguments)};this.filter=function(){return d.filter.apply(this,arguments)}};b.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};b.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};b.Appacitive.ArticleCollection.prototype.articles=function(){return this.getAll()};b.Appacitive.ArticleCollection.prototype.length=
function(){return this.articles.length}})(global);
(function(b){b.Appacitive.ConnectionCollection=function(e){var f=null,c=null,d=[],a=[],g={};"string"==typeof e?g.relation=e:g=e;this.collectionType="connection";var m=this;if(!e||!e.relation)throw Error("Must provide relation while initializing ConnectionCollection.");f=e.relation;e=function(a){a.type="connection";a.relation?f=a.relation:a.relation=f;c=new b.Appacitive.Queries.FindAllQuery(a);g=a;return m};this.setFilter=function(a){g.filter=a;g.type="connection";c?c.filter(a):(c=new b.Appacitive.Queries.FindAllQuery(g),
m.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){a||0!=a.trim().length||(g.freeText="");g.freeText=a;g.type="connection";c?c.freeText(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";c?c.fields(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.query=function(){if(1==arguments.length){var b=arguments[0];if(!b||
!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==k.indexOf(b.queryType()))throw Error("ConnectionCollection only accepts "+k.join(", "));a.length=0;d.length=0;c=b;return this}return c};var k=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.reset=function(){f=g=null;a.length=0;d.length=0;c=null};this.setOptions=e;e(g);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,
10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=f)throw Error("Null connection passed or relation type mismatch");var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!==b?d.splice(b,1):d.push(a);return this};this.getConnection=function(a,b,c){b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllConnections=
function(){return Array.prototype.slice.call(d).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getConnection().__id&&c.getConnection().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var l=function(b,e,g){"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&(b=[b]);b.length&&
0!==b.length||(b=[]);b.forEach(function(b){b.___collection=m;if(b.endpointA.article||b.endpointB.article){var c=b.endpointA.article||b.endpointB.article;c.___collection=m;a.push(c)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(e){}d.push(b)});"function"==typeof g&&g(e,m)};this.getConnectedArticle=function(b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(a,b){d.length=0;c.fetch(function(b,
c){l(b,c,a)},function(a){"function"==typeof b&&b(a,m)});return this};this.count=function(a,b){c.count(a,b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewConnection=function(a){a=
a||{};a.__relationtype=f;a=new b.Appacitive.Connection(a);a.___collection=m;d.push(a);return a};this.map=function(){return d.map.apply(this,arguments)};this.forEach=function(a,b){return d.forEach(a,b||this)};this.filter=function(){return d.filter.apply(this,arguments)}}})(global);
(function(b){var e=function(c,d){c=c||function(){};d=d||function(){};var a=new b.Appacitive.HttpRequest;a.method="get";a.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(a){a?c(a):d()}):d({code:"404",message:"fb account not found"})};
a.onError=d;b.Appacitive.http.send(a)};b.Appacitive.Article=function(c,d){c=c||{};"string"==typeof c&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);b.Appacitive.BaseObject.call(this,c,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=e);return this};b.Appacitive.Article.prototype=new b.Appacitive.BaseObject;
b.Appacitive.Article.prototype.constructor=b.Appacitive.Article;b.Appacitive.Article.prototype.getConnections=function(c){if("article"!=this.type)return null;c=c||{};c.articleId=this.get("__id");var d=new b.Appacitive.ConnectionCollection({relation:c.relation});this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.GetConnectionsQuery(c));return d};b.Appacitive.Article.prototype.getConnectedArticles=function(c){c=c||{};"string"==typeof c&&(rName=c,c={relation:rName});c.articleId=this.get("__id");
var d=new b.Appacitive.ConnectionCollection({relation:c.relation});d.connectedArticle=this;this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.ConnectedArticlesQuery(c));return d};b.Appacitive.Article.multiDelete=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if("user"==c.schema.toLowerCase()||"device"==c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(c.ids&&0<c.ids.length){d=
d||function(){};a=a||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);e.method="post";e.data={idlist:c.ids};e.onSuccess=function(b){b&&"200"==b.code?"function"==typeof d&&d():(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else d()};var f=function(c){var d=
[];c.forEach(function(a){d.push(new b.Appacitive.Article(a))});return d};b.Appacitive.Article.multiGet=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if(c.ids&&0<c.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);e.method="get";e.onSuccess=function(b){b&&b.articles?"function"==typeof d&&d(f(b.articles),b.paginginfo):
(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof a&&a(b)};b.Appacitive.http.send(e)}else"function"==typeof d&&d([])};b.Appacitive.Article.get=function(c,d,a){c=c||{};if(!c.schema)throw Error("Specify schema");if(!c.id)throw Error("Specify id to fetch");var e={},e="user"==c.schema.toLowerCase()?new b.Appacitive.User({__id:c.id}):new b.Appacitive.Article({__schematype:c.schema,__id:c.id});
e.fields=c.fields;e.fetch(d,a);return e}})(global);
(function(b){var e=function(a,c,d){var e={label:a.label};a.articleid&&(e.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?e.articleid=a.article.get("__id"):e.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?e.articleid=a.article.__id:e.article=a.article,a.article=new b.Appacitive.Article(a.article));else if(!e.articleid&&!e.article)throw Error("Incorrectly configured endpoints provided to setupConnection");d["endpoint"+
c]=a;return e},f=function(a,c,d){a.article&&"object"==typeof a.article?(d["endpoint"+c]?d["endpoint"+c]&&d["endpoint"+c].article&&d["endpoint"+c].article.getArticle?d["endpoint"+c].article.copy(a.article):d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0):(d["endpoint"+c]={},d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0)),d["endpoint"+c].articleid=a.articleid,d["endpoint"+c].label=a.label,d["endpoint"+c].type=a.type,d["endpoint"+c].article.___collection=d.___collection):
d["endpoint"+c]=a};b.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw Error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);b.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b=
"A",c="B";a.__endpointa.label!=this.get("__endpointb").label||(a.__endpointa.label==a.__endpointb.label||a.__endpointa.articleid!=this.get("__endpointb").articleid&&a.__endpointa.articleid)||(b="B",c="A");f(this.get("__endpointa"),b,this);f(this.get("__endpointb"),c,this);this.endpoints=function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};c?(this.connectedArticle=function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(b=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(b)},this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.prototype.setupConnection=function(a,b){if(!(a&&(a.articleid||a.article)&&a.label&&b&&(b.articleid||b.article)&&b.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",e(a,"A",this));this.set("__endpointb",e(b,"B",this))};b.Appacitive.Connection.get=function(a,c,d){a=a||{};if(!a.relation)throw Error("Specify relation");if(!a.id)throw Error("Specify id to fetch");var e=new b.Appacitive.Connection({__relationtype:a.relation,
__id:a.id});e.fields=a.fields;e.fetch(c,d)};var c=function(a){var c=[];a||(a=[]);a.forEach(function(a){c.push(new b.Appacitive.Connection(a))});return c},d=function(a,d,e){a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"==typeof d&&d(c(a.connections),a.paginginfo):(a=a||{},"function"==typeof e&&e(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof e&&e(a)};b.Appacitive.http.send(a)};b.Appacitive.Connection.multiGet=
function(a,c,e){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var k=new b.Appacitive.HttpRequest;k.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(a.relation,a.ids.join(","),a.fields);k.method="get";return d(k,c,e)}"function"==typeof c&&c([])};b.Appacitive.Connection.multiDelete=function(a,c,d){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");
if(a.ids&&0<a.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);e.method="post";e.data={idlist:a.ids};e.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof d&&d(a||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof d&&d(a||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else c()};b.Appacitive.Connection.getInterconnects=
function(a,b,c){a=new Appacitive.Queries.InterconnectsQuery(a);d(a.toRequest(),request,b,c)};b.Appacitive.Connection.getBetweenArticles=function(a,b,c){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);d(a.toRequest(),b,c)};b.Appacitive.Connection.getBetweenArticlesForRelation=function(a,b,c){(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).fetch(b,c)}})(global);
(function(b){b.Appacitive.Users=new function(){var e=null;this.currentUser=function(){return e};var f=function(a,c,d,e,f){var g=a.get("__id");if(!g||"string"!==typeof g||0==g.length)throw Error("Please specify valid userid");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid oldPassword");if(!d||"string"!==typeof d||0==d.length)throw Error("Please specify valid newPassword");e=e||function(){};f=f||function(){};c==d?"function"==typeof e&&e(a):(c={oldpassword:c,newpassword:d},
d=new b.Appacitive.HttpRequest,d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g),d.method="post",d.data=c,d.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof e?e(a):f(b,a))},d.onError=f,b.Appacitive.http.send(d))},c=function(a,c,d){var e=a.get("__id");e&&"string"===typeof e&&0!=e.length||"function"==typeof c&&c(a.linkedAccounts(),a);c=c||function(){};d=d||function(){};var f=new b.Appacitive.HttpRequest;f.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(e);f.method="get";f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(b=b.identities||[],0<b.length?a.set("__link",b):a.set("__link",null),"function"==typeof c&&c(b,a)):d(b.status,a)};f.onError=d;b.Appacitive.http.send(f)},d=function(a,c,d,e){var f=c.get("__id");f&&"string"===typeof f&&0!=f.length||d&&"function"==typeof d&&d();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");d=d||function(){};e=e||function(){};
var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getCheckinUrl(f,a.lat,a.lng);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d(accounts,c):"function"==typeof e&&e(a,c)};g.onError=e;b.Appacitive.http.send(g)},a=function(a,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);g.method="post";g.data=f;g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else c.set("__link",f),"function"==typeof d&&d(c)},g=function(a,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);g.method=
"post";g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else"function"==typeof d&&d(c)};this.setCurrentUser=function(c,l,h){if(!c)throw Error("Cannot set null object as user");var m=c;if(m instanceof Appacitive.User)if(m.get("__id")&&0!=m.get("__id").length)c=m.toJSON();else throw Error("Specify user __id");else m=new b.Appacitive.User(c,!0);b.Appacitive.localStorage.set("Appacitive-User",c);h||(h=60);e=m;l&&b.Appacitive.Session.setUserAuthHeader(l,
h);e.logout=function(a){b.Appacitive.Users.logout(a)};e.updatePassword=function(a,b,c,d){f(this,a,b,c,d);return this};e.linkFacebookAccount=function(c,d){var f=function(){a(Appacitive.Facebook.accessToken(),e,function(a){b.Appacitive.eventManager.fire("user..article."+a.get("__id")+".updated",a,{object:a});"function"==typeof c&&c(a)},d)};Appacitive.Facebook.getCurrentUserInfo(function(){f()},function(){Appacitive.Facebook.requestLogin(function(){f()},d)});return this};e.unlinkFacebookAccount=function(a,
c){g("facebook",this,function(c){b.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};e.logout=function(a){Appacitive.Users.logout(a)};e.checkin=function(a,b,c){d(a,this,b,c);return this};b.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(a,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return e};b.Appacitive.User=function(a){a=a||{};a.__schematype="user";
b.Appacitive.Article.call(this,a);return this};b.Appacitive.User.prototype=new b.Appacitive.Article("user");b.Appacitive.User.prototype.constructor=b.Appacitive.User;b.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?"object"!=typeof a||0<=a.length?0<=a.length||(a=a[0]):a=[a]:a=[];return a};b.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this;c(this,function(b){"function"==typeof a&&a(b,d)},b);return this};b.Appacitive.User.prototype.linkFacebookAccount=
function(b,c,d){a(b,this,c,d);return this};b.Appacitive.User.prototype.unlinkFacebookAccount=function(a,b){var c=this;g("facebook",this,function(){var b=c.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&c.set("__link",null);"function"==typeof a&&a(c)},b);return this};b.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,d){if(!a)throw Error("Specify userid for user delete");c=c||function(){};d=d||function(){};
(new b.Appacitive.Article({__schematype:"user",__id:a})).del(c,d)};this.deleteCurrentUser=function(a,c){var d=function(){b.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a()};if(null===e)d();else{var f=e.get("__id");this.deleteUser(f,function(){d()},c)}};this.createUser=this.createNewUser=function(a,c,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new b.Appacitive.User(a)).save(c,d)};this.signup=function(a,b,c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(a,c,d,f){c=c||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var g=this,m=new b.Appacitive.HttpRequest;m.method="post";m.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();m.data=a;m.onSuccess=function(b){b&&b.user?(f&&(b.user.__authType=f),g.setCurrentUser(b.user,
b.token,a.expiry),c({user:e,token:b.token})):(b=b||{},d(b.status))};m.onError=d;b.Appacitive.http.send(m)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(a,c,d,f){a=a||function(){};c=c||function(){};var g=this,m=function(){var d=
{accesstoken:b.Appacitive.Facebook.accessToken(),type:"facebook",expiry:864E5,createnew:!0};g.authenticateUser(d,function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:e,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};d?m():Appacitive.Facebook.requestLogin(function(a){m()},c)};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var d=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=this;this.getUserByToken(d,function(b){e.setCurrentUser(b,d);"function"==typeof a&&a(!0)},function(){"function"==typeof a&&a(!1)})}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,
subject:c};c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d():e(a)};c.onError=e;b.Appacitive.http.send(c)};var m=function(a,c,d){c=c||function(){};d=d||function(){};var e=new b.Appacitive.HttpRequest;e.url=a;e.method="get";e.onSuccess=function(a){a&&a.user?"function"==typeof c&&c(new Appacitive.User(a.user)):"function"==typeof d&&
d(a.status)};e.onError=d;b.Appacitive.http.send(e)};this.getUserByToken=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);m(a,c,d)};this.getUserByUsername=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);m(a,c,d)};this.logout=
function(a,c){e=null;b.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(b){b.Appacitive.Email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var f=function(c,d,a){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=c;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.email):(b=b||{},b.status=b.status||{},a(b.status.message||"Server error"))};
b.Appacitive.http.send(e)};this.setupEmail=function(b){b=b||{};e.smtp.username=b.username||e.smtp.username;e.from=b.from||e.from;e.smtp.password=b.password||e.smtp.password;e.smtp.host=b.smtp.host||e.smtp.host;e.smtp.port=b.smtp.port||e.smtp.port;e.smtp.enablessl=b.enableSSL||e.smtp.enablessl;e.replyto=b.replyTo||e.replyto};this.sendTemplatedEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.templateName)throw Error("template name is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1==b.isHtml?!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)};this.sendRawEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.body)throw Error("body is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{content:b.body||"",ishtml:!1==b.isHtml?
!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)}}})(global);
(function(b){var e=function(){var b=require("facebook-node-sdk"),c=null,d=this.FB=null,a=!0;this.initialize=function(c){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!c.appId)throw Error("Please provide appid");if(!c.appSecret)throw Error("Please provide app secret");d=c.appSecret;this.FB=new b({appId:_appId,secret:d});a=!0};this.requestLogin=function(b,d,e){a?(c=accesstoken,FB.setAccessToken(e),Appacitive.Users.loginWithFacebook(b,d,!0)):"function"==typeof d&&
d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,d){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&c?(b=b||function(){},d=d||function(){},this.FB.api("/me",function(a,c){c?"function"==typeof b&&b(c):"function"==typeof d&&d("Access token is invalid")})):d("Either intialize facebook with your appid and appsecret or set accesstoken")};this.accessToken=function(){return 1==arguments.length?(c=arguments[0],this):
c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,b){a=a||function(){};Appacitive.Facebook.accessToken="";"function"==typeof a&&a()}};b.Appacitive.Facebook=b.Appacitive.runtime.isBrowser?new function(){var b=null,c=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);c=!0};this.requestLogin=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
d=d||function(){};a=a||function(){};FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,"function"==typeof d&&d(c.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");d=d||function(){};a=a||function(){};FB.api("/me",function(c){c&&!c.error?(b=FB.getAuthResponse().accessToken,"function"==typeof d&&d(c)):"function"==
typeof a&&a()})};this.accessToken=function(){return 1==arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.Facebook.accessToken="";try{FB.logout(function(a){Appacitive.Users.logout();"function"==typeof b&&b()})}catch(c){"function"==typeof a&&a(c.message)}}}:new e})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify push options");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();d.method="post";d.data=e;d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};
this.getNotification=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify notification id");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};this.getAllNotifications=
function(e,f,c){f=f||function(){};c=c||function(){};e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)}}})(global);
(function(b){b.Appacitive.File=function(e){e=e||{};this.fileId=e.fileId;this.contentType=e.contentType;this.fileData=e.fileData;var f=function(a,c,d){var e=new b.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=c;e.onError=d;b.Appacitive.http.send(e)},c=function(a,c,d,e,f){(new FormData).append("fileToUpload",c);var n=new b.Appacitive.HttpRequest;n.url=a;n.method="PUT";n.data=c;n.headers.push({key:"content-type",value:d});n.onSuccess=e;n.onError=f;n.send()};this.save=function(b,c,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,b,c,e):d(this,b,c,e)};var d=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(h){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==
b.status.code?c(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this},a=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(h){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==b.status.code?c(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(b,that)};d.onError=c;b.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};c=c||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(b){b&&b.status&&"200"==b.status.code?(d.url=b.uri,"function"==typeof a&&a(b.uri)):"function"==typeof c&&"function"==typeof c&&c(b.status,d)};e.onError=c;b.Appacitive.http.send(e);return this}}})(global);
(function(b){b.Appacitive.Date={};b.Appacitive.Date.parseISODate=function(b){try{var f=new Date(b);if(isNaN(f)){var c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,d=!1;if(!c.exec(b))if(c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,c.exec(b))d=!0;else return null;var a=b.split("T"),g=a[0].split("-"),m=a[1].split("Z")[0].split(":"),k=m[2].split("."),l=Number(m[0]),f=new Date;f.setUTCFullYear(Number(g[0]));f.setUTCMonth(Number(g[1])-1);f.setUTCDate(Number(g[2]));
d||(f.setUTCHours(Number(l)),f.setUTCMinutes(Number(m[1])),f.setUTCSeconds(Number(k[0])),k[1]&&f.setUTCMilliseconds(Number(k[1])))}return f}catch(h){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(f){return null}};b.Appacitive.Date.toISODate=function(b){try{return b=b.toISOString().split("T")[0]}catch(f){return null}};b.Appacitive.Date.toISOTime=function(b){try{return b=b.toISOString().split("T")[1],b=b.replace("Z","0000Z")}catch(f){return null}};
b.Appacitive.Date.parseISOTime=function(b){try{var f=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b))return null;var c=b.split("T");1==c.length&&c.push(c[0]);var d=c[1].split("Z")[0].split(":"),a=d[2].split(".");f.setUTCHours(Number(Number(d[0])));f.setUTCMinutes(Number(d[1]));f.setUTCSeconds(Number(a[0]));a[1]&&f.setUTCMilliseconds(Number(a[1]));return f}catch(g){return null}}})(global);
(function(b){b.Appacitive.localStorage=new function(){var e=b.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(f,c){c=c||"";if(!f)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(d){}f=b.Appacitive.getAppPrefix(f);e[f]=c;return!0};this.get=function(f){if(!f)return null;f=b.Appacitive.getAppPrefix(f);f=e.getItem(f);if(!f)return null;if("{"==f[0])try{f=JSON.parse(f)}catch(c){}return f};this.remove=function(f){if(f){f=b.Appacitive.getAppPrefix(f);try{delete e[f]}catch(c){}}}}})(global);
(function(b){b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie=new function(){this.setCookie=function(e,f,c,d){e=b.Appacitive.getAppPrefix(e);var a="";c&&(a=new Date,a.setTime(a.getTime()+6E4*c),a.toGMTString());a=d?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=e+"="+f+a+"; path=/;"+c};this.readCookie=function(e){e=
b.Appacitive.getAppPrefix(e);e+="=";for(var f=document.cookie.split(";"),c=0;c<f.length;c++){for(var d=f[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(e))return d.substring(e.length,d.length)}return null};this.eraseCookie=function(e){e=b.Appacitive.getAppPrefix(e);this.setCookie(e,"",-1,!0)}})})(global);"undefined"==typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(b,e){Object.defineProperty(this,b,{set:e,enumerable:!0,configurable:!0})}}))}catch(defPropException){}
Array.prototype.forEach||(Array.prototype.forEach=function(b,e){var f=this.length>>>0;if("function"!=typeof b)throw new TypeError;for(var c=0;c<f;c++)c in this&&b.call(e,this[c],c,this)});"bind"in Function.prototype||(Function.prototype.bind=function(b){var e=this;if(1>=arguments.length)return function(){return e.apply(b,arguments)};var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(b,0===arguments.length?f:f.concat(Array.prototype.slice.call(arguments)))}});
"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,e){void 0===e&&(e=0);0>e&&(e+=this.length);0>e&&(e=0);for(var f=this.length;e<f;e++)if(e in this&&this[e]===b)return e;return-1});
"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,e){void 0===e&&(e=this.length-1);0>e&&(e+=this.length);e>this.length-1&&(e=this.length-1);for(e++;0<e--;)if(e in this&&this[e]===b)return e;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,e){for(var f=0,c=this.length;f<c;f++)f in this&&b.call(e,this[f],f,this)});
"map"in Array.prototype||(Array.prototype.map=function(b,e){for(var f=Array(this.length),c=0,d=this.length;c<d;c++)c in this&&(f[c]=b.call(e,this[c],c,this));return f});"filter"in Array.prototype||(Array.prototype.filter=function(b,e){for(var f=[],c,d=0,a=this.length;d<a;d++)d in this&&b.call(e,c=this[d],d,this)&&f.push(c);return f});"every"in Array.prototype||(Array.prototype.every=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&!b.call(e,this[f],f,this))return!1;return!0});
"some"in Array.prototype||(Array.prototype.some=function(b,e){for(var f=0,c=this.length;f<c;f++)if(f in this&&b.call(e,this[f],f,this))return!0;return!1});Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(b){function e(b){return 10>b?"0"+b:b}return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON);
var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(a){if(a&&a.send&&"function"==typeof a.send)a.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],b={},d=0,f={},e=0;this.addProcessor=function(a){a&&(a.pre=a.pre||function(){},a.post=a.post||function(){},p(a.pre),q(a.post))};var p=function(a){d+=1;b[d]=a;return d},
q=function(a){e+=1;f[e]=a;return e};this.enqueueRequest=function(a){c.push(a)};this.changeRequestForCors=function(a){var c={m:a.method.toUpperCase()};a.headers.forEach(function(a){c[a.key]=a.value});a.headers=[];a.headers.push({key:"Content-Type",value:"text/plain"});a.method="POST";a.data&&(c.b=a.data);delete a.data;global.Appacitive.config.debug&&(-1==a.url.indexOf("?")?a.url+="?debug=true":a.url+="&debug=true");try{a.data=JSON.stringify(c)}catch(b){}return a};this.notify=function(){if(0!==c.length){var d=
[],l;for(l in f)f.hasOwnProperty(l)&&d.push(f[l]);for(;0<c.length;){var e=c.shift(),n=[];for(l in b)b.hasOwnProperty(l)&&n.push(b[l](e));this.changeRequestForCors(e);a.send(e,d,n)}}};this.onResponse=function(a){console.dir(a)}},e=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(c,b){a()};this.onError=function(c){a()}},f=null,f=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,c=function(a){var c=
new XDomainRequest;c.onload=function(){var b=c.responseText;try{var d=c.contentType;if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=b,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),b=JSON.parse(d)}catch(f){}a.onSuccess(b,this)};c.onerror=c.ontimeout=function(){a.onError({code:"400",message:"Server Error"},c)};c.onprogress=function(){};c.open(a.method,a.url,!0);c.send(a.data);return c},d=function(a){if(!a.url)throw Error("Please specify request url");
a.method||(a.method="GET");a.headers||(a.headers=[]);var b={},d=!0;a.headers.forEach(function(a){"content-type"==a.key.toLowerCase()&&(d=!0,"application/json"==a.value.toLowerCase()||"application/javascript"==a.value.toLowerCase())&&(d=!1)});if(d)b=a.data;else if(a.data&&(b=a.data,"object"==typeof a.data))try{b=JSON.stringify(b)}catch(l){}a.onSuccess&&"function"==typeof a.onSuccess||(a.onSuccess=function(){});a.onError&&"function"==typeof a.onError||(a.onError=function(){});if(-1!=navigator.userAgent.indexOf("MSIE 8")||
-1!=navigator.userAgent.indexOf("MSIE 9"))return a.data=b,new c(a);var h=new f;h.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var b=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase())b=c,global.Appacitive.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),c=JSON.parse(b)}catch(d){}a.onSuccess(c,
this)}else a.onError({code:this.status,message:this.statusText},this)};h.open(a.method,a.url,!0);for(var e=0;e<a.headers.length;e+=1)h.setRequestHeader(a.headers[e].key,a.headers[e].value);global.Appacitive.runtime.isBrowser||h.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");h.send(b);return h},a=function(){var a=new e;a.isOnline=function(){return!0};var c=function(c,b,f){new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d,e){if(d){try{d=JSON.parse(d)}catch(m){}var r=
d;if(b.length!=f.length)throw Error("Callback length and state length mismatch!");for(var t=0;t<b.length;t+=1)b[t].apply({},[r,f[t]]);a.onResponse(d,c)}else a.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(b){a.onError(c,b)}})};a.send=function(a,b,d){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,b,d)};a.upload=function(a,b,d){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,b,d,!0)};
return a};global.Appacitive.http=new function(){var c=new a,d=new b(c),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;d.addProcessor(a)};this.send=function(a){d.enqueueRequest(a);c.isOnline()&&!1==f&&d.notify()};this.flush=function(a){a?d.notify():c.isOnline()&&d.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,
[c]);else a.onError(c)};c.onError=this.onError;this.onResponse=function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[a]);else c.onSuccess(a)};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new d(this,a)}};(function(a){a.Appacitive&&a.Appacitive.http&&
(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,b){try{a.Appacitive.Session.isSessionValid(c)?c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(b))}catch(d){}}}),a.Appacitive.http.addProcessor({pre:function(a){return(new Date).getTime()},post:function(a,c){var b=(new Date).getTime()-
c;a._timeTakenInMilliseconds=b}}))})(global)})();
(function(b){String.format=function(b,f){if(1>=arguments.length)return b;for(var c=arguments.length-2,d=0;d<=c;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var f=RegExp("^"+b),c=this;f.test(c)&&(c=c.slice(1,c.length));f=RegExp(b+"$");f.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(b){"undefined"==typeof b&&(b="");for(var f=
"",c=0;c<b.length;c+=1)-1==" .,;#".indexOf(b[c])&&(f+=b[c]);return f=f.toLowerCase()};String.contains=function(b,f){return-1!=b.indexOf(f)};String.startsWith=function(b,f){return 0==b.indexOf(f)};Array.distinct=function(b){var f=[],c=b.length,d,a,g;for(a=0;a<c;a++){d=void 0;for(g=0;g<f.length;g++)if(b[a].toLowerCase()===f[g].toLowerCase()){d=!0;break}d||f.push(b[a])}return f};Object.isEmpty=function(b){if(!b)return!0;var f=!0;for(keys in b){f=!1;break}return f};b.dateFromWcf=function(b,f){var c=/Date\(([^)]+)\)/.exec(b);
if(2!=c.length){if(!f)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var e=function(b){"object"==typeof b&&(0<b.length&&("string"==typeof b[0]||"number"==typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user=
{userServiceUrl:"user",getCreateUrl:function(b){return String.format("{0}/create?fields={1}",this.userServiceUrl,e(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token=",this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,b)},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,d){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,b,c,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,e(b))},getGetUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getUpdateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.deviceServiceUrl,b)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,
c,d){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),a=d?a+"?psize="+d:a+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!=c[b].trim().length&&(a=a+"&"+c[b]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,b,c)},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.articleServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,e(c))},getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getMultiGetUrl:function(b,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,c,e(d))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,e(c))},getUpdateUrl:function(b,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,
b,c,e(d))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,d,a){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,d,c);if("undefined"!==typeof a&&0<a.length)for(b=0;b<a.length;b+=1)g=g+"&"+a[b];return g},getConnectedArticles:function(b,c,d){var a="",a=String.format("{0}/{1}/{2}/find",
this.connectionServiceUrl,b,c);if(d&&d.length&&0<d.length)for(b=0;b<d.length;b+=1)a=0==b?a+("?"+d[b]):a+("&"+d[b]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push=
{pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,
c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(d,a){var g=a.split("="),
e=g[1];2<g.length&&g.forEach(function(a,b){0!=a&&1!=a&&(e=e+"="+g[a])});g[0].toLowerCase()==b&&(c=[g[0],e])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var f={};this.subscribe=function(c,d){if("string"!=typeof c||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof f[c]&&(f[c]=[]);var a=b();f[c].push({callback:d,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var d=-1,a=null,g;for(g in f)for(var e=0;e<f[g].length;e+=
1)if(f[g][e].id==b){d=e;a=g;break}return-1!=d?(f[a].splice(d,1),!0):!1};this.fire=function(b,d,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;if("undefined"!=typeof f.all)for(var g=0;g<f.all.length;g+=1)f.all[g].callback(d,a);g=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof f[b])for(var e=0;e<f[b].length;e+=1)g(f[b][e].callback,d,a)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
f[b]&&(f[b].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(f)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},f=null,c=null,d=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){b.Appacitive.Session.create(null)};this.create=function(a,d){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var l=new e;l.apikey=c;var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+"application.svc/session";
g.method="put";g.data=l;g.onSuccess=function(c){c&&c.status&&"200"==c.status.code?(f=c.session.sessionkey,b.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(c),b.Appacitive.Session.onSessionCreated()):d&&"function"==typeof d&&d(c)};g.onError=d;b.Appacitive.http.send(g)};b.Appacitive.http.addProcessor({pre:function(g){b.Appacitive.Session.useApiKey?g.headers.push({key:"ak",value:c}):g.headers.push({key:"as",value:f});!0===a&&(1==g.headers.filter(function(a){return"ut"==a.key}).length?g.headers.forEach(function(a){"ut"==
a.key&&(a.value=d)}):g.headers.push({key:"ut",value:d}))}});this.setUserAuthHeader=function(c,g,l){try{c&&(a=!0,d=c,l||(g||(g=60),-1==g&&(g=null),b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,g),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",g?g:-1,g))))}catch(e){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c,g){c&&("function"!=typeof c&&"boolean"==typeof c)&&(g=c,c=function(){});a=!1;c=c||function(){};b.Appacitive.localStorage.remove("Appacitive-User");
b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(d&&!g)try{var l=new b.Appacitive.HttpRequest;l.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(d);d=null;l.method="POST";l.data={};l.onSuccess=function(){"function"==typeof c&&c()};b.Appacitive.http.send(l)}catch(e){}else d=null,"function"==typeof c&&c()};this.isSessionValid=function(a){if(!a)return!0;
if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){f=null;this.useApiKey=!0};this.get=function(){return f};this.setSession=function(a){a&&(f=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(c=a,this.useApiKey=!0)};var g="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a}return g}};b.Appacitive.getAppPrefix=
function(e){return b.Appacitive.Session.environment()+"/"+b.Appacitive.appId+"/"+e};b.Appacitive.initialize=function(e){e=e||{};if(!b.Appacitive.Session.initialized){if(!e.apikey||0==e.apikey.length)throw Error("apikey is mandatory");if(!e.appId||0==e.appId.length)throw Error("appId is mandatory");b.Appacitive.Session.setApiKey(e.apikey);b.Appacitive.Session.environment(e.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.appId=e.appId;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=
e.persistUserToken;e.debug&&(b.Appacitive.config.debug=!0);if(e.userToken)-1==e.expiry?e.expiry=null:e.expiry||(e.expiry=3600),b.Appacitive.Session.setUserAuthHeader(e.userToken,e.expiry),e.user?b.Appacitive.Users.setCurrentUser(e.user):(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e);else if(b.Appacitive.runtime.isBrowser){var f=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(f){var c=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");
c||(c=60);(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e,f,c)}}}}})(global);(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(e){e.headers.push({key:"e",value:b.Appacitive.Session.environment()})}})})(global);
(function(b){var e=b.Appacitive;e.GeoCoord=function(a,b){_validateGeoCoord=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(_validateGeoCoord(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var f=function(){this.toString=function(){}},c=function(a){f.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};c.prototype=new f;c.prototype.constructor=c;var d=function(a){a=a||"";if("object"!=typeof a.value||!a.value.length)throw Error("Specify field value as array");c.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,"string"==typeof this.value[b]?"'"+this.value[b]+"'":"number"==typeof this.value[b]?this.value[b]:this.value[b].toString()));return"("+a.join(" or ")+
")"}};d.prototype=new c;d.prototype.constructor=d;var a=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;c.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};a.prototype=new c;a.prototype.constructor=a;var g=function(a){a=a||"";if(!(a.geoCoord&&a.geoCoord instanceof
e.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};g.prototype=new c;g.prototype.constructor=a;var m=function(a){a=a||"";if(!a.geoCoords||0==a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");c.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0==b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new c;m.prototype.constructor=a;_tagFilter=function(a){f.call(this);a=a||{};if(!a.tags||"object"!=
typeof a.tags||0==a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};_tagFilter.prototype=new f;_tagFilter.prototype.constructor=_tagFilter;_compoundFilter=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var c=0;c<b.length;c+=1){if(!(b[c]instanceof f))throw Error("Invalid filter provided");
this.innerFilters.push(b[c])}this.toString=function(){var a=this.operator,b="(";this.innerFilters.forEach(function(c){b=1==b.length?b+(" "+c.toString()):b+String.format(" {0} {1} ",a,c.toString())});return b+=")"}};_compoundFilter.prototype=new f;_compoundFilter.prototype.constructor=_compoundFilter;var k=function(a){if(!a||0==a.length)throw Error("Specify value");this.value=a;this.getValue=function(){return"string"==typeof this.value?"'"+this.value+"'":"number"==typeof this.value?this.value:"object"==
typeof this.value&&this.value instanceof date?"datetime('"+e.Date.toISOString(this.value)+"')":this.value.toString()}},l=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"date('"+e.Date.toISODate(this.value)+"')":"date('"+this.value+"'')"}},h=function(a){this.value=a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"time('"+e.Date.toISOTime(this.value)+"')":"time('"+this.value+"'')"}},n=function(a){this.value=
a;this.getValue=function(){return"object"==typeof this.value&&this.value instanceof Date?"datetime('"+e.Date.toISOString(this.value)+"')":"datetime('"+this.value+"'')"}},p=function(b,e,f){f||(f=this);f.type=b;f.name=e;f.equalTo=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"=="})};f.equalToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};f.equalToTime=function(a){return new c({field:this.name,fieldType:this.type,
value:new h(a),operator:"=="})};f.equalToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"=="})};f.greaterThan=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">"})};f.greaterThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};f.greaterThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">"})};f.greaterThanDateTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new n(a),operator:">"})};f.greaterThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:">="})};f.greaterThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};f.greaterThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:">="})};f.greaterThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),
operator:">="})};f.lessThan=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a),operator:"<"})};f.lessThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};f.lessThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<"})};f.lessThanDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<"})};f.lessThanEqualTo=function(a){return new c({field:this.name,
fieldType:this.type,value:new k(a),operator:"<="})};f.lessThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};f.lessThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new h(a),operator:"<="})};f.lessThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<="})};f.like=function(a){return new c({field:this.name,fieldType:this.type,value:new k("*"+a+"*"),operator:"like"})};
f.startsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new k(a+"*"),operator:"like"})};f.endsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new k("*"+a),operator:"like"})};f.contains=function(a){return new d({field:this.name,fieldType:this.type,value:a,operator:"=="})};f.between=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new k(b),val2:new k(c),operator:"between"})};f.betweenDate=function(b,c){return new a({field:this.name,
fieldType:this.type,val1:new l(b),val2:new l(c),operator:"between"})};f.betweenTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new h(b),val2:new h(c),operator:"between"})};f.betweenDateTime=function(b,c){return new a({field:this.name,fieldType:this.type,val1:new n(b),val2:new n(c),operator:"between"})};f.withinCircle=function(a,b,c){return new g({field:this.name,fieldType:this.type,geoCoord:a,distance:b,unit:c,operator:"within_circle"})};f.withinPolygon=function(a){return new m({field:this.name,
fieldType:this.type,geoCoords:a,operator:"within_polygon"})}};_propertyExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;p("property",a,this);return this};_aggregateExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=function(a){return b.greaterThanEqualTo(a)};this.lessThan=
function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,c){return b.between(a,c)};return this};_attributeExpression=function(a){if(!a||0==a.length)throw Error("Specify field name");this.field=a;var b=new p("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};this.contains=function(a){return b.contains(a)};
return this};e.Filter={Property:function(a){return new _propertyExpression(a)},Aggregate:function(a){return new _aggregateExpression(a)},Attribute:function(a){return new _attributeExpression(a)},Or:function(){return new _compoundFilter("or",arguments)},And:function(){return new _compoundFilter("and",arguments)},taggedWithOneOrMore:function(a){return new _tagFilter({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new _tagFilter({tags:a,operator:"tagged_with_all"})}}})(global);
(function(b){b.Appacitive.Queries={};var e=function(b){b=b||{};var a=1,c=20;this.pageNumber=function(){return 1==arguments.length?(a=arguments[0]||1,this):a};this.pageSize=function(){return 1==arguments.length?(c=arguments[0]||20,this):c};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};e.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var f=function(b){b=b||{};var a="__UtcLastUpdatedDate",c=!1;this.orderBy=function(){return 1==arguments.length?(a=
arguments[0]||"__UtcLastUpdatedDate",this):a};this.isAscending=function(){return 1==arguments.length?(c="undefined"==typeof arguments[0]?!1:arguments[0],this):c};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};f.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var c=function(c){var a=c||{},g="",m="",k="",l=a.queryType||"BasicQuery",h=new e(c),n=new f(c),p=a.schema||a.relation,q=a.relation?"connection":"article";this.type=function(){return q};this.entityType=
function(){return p};this.queryType=function(){return l};this.pageQuery=function(){return h};this.pageNumber=function(){return 1==arguments.length?(h.pageNumber(arguments[0]),this):h.pageNumber};this.pageSize=function(){return 1==arguments.length?(h.pageSize(arguments[0]),this):h.pageSize};this.sortQuery=function(){return n};this.orderby=function(){return 1==arguments.length?(n.orderby(arguments[0]),this):n.orderby};this.isAscending=function(){return 1==arguments.length?(n.isAscending(arguments[0]),
this):n.isAscending};this.filter=function(){return 1==arguments.length?(g=arguments[0],this):g};this.freeText=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?m=arguments[0]:"object"==typeof a&&a.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?k=a:"object"==typeof a&&a.length&&(k=a.join(","));return this}return k};this.filter(a.filter||"");this.freeText(a.freeText||"");this.fields(a.fields||
"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(b){for(var c in b)a[c]=b[c];h=new e(a);n=new f(a);return this};this.getQueryString=function(){var a=h.toString()+"&"+n.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");this.fields()&&0<this.fields().trim().length&&
(a+="&fields="+this.fields());return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+q+"/"+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};var r=function(a){var c=[];a||(a=[]);var d="article"==q?"Article":"Connection";a.forEach(function(a){c.push(new b.Appacitive[d](a,
!0))});return c};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(r(b[q+"s"]),b.paginginfo):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};this.count=function(a,c){a=a||function(){};c=c||function(){};var d=h.pageSize,g=h.pageNumber;h.pageSize=1;h.pageNumber=
999999999;var l=this,e=this.toRequest();e.onSuccess=function(b){h.pageSize=d;h.pageNumber=g;b=b||{};var e=b.paginginfo,k=0;if(e)k=e.totalrecords;else if(b.status&&b.status.code&&"200"==b.status.code)k=0;else{b=b.status||{message:"Server error",code:400};"function"==typeof c&&c(b,l);return}"function"==typeof a&&a(k)};e.onError=function(a){h.pageSize=d;h.pageNumber=g;a=a||{message:"Server error",code:400};"function"==typeof c&&c(a,l)};b.Appacitive.http.send(e);return this}};b.Appacitive.Queries.FindAllQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";c.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new c;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedArticlesQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for connected articles query");if(!d.articleId)throw Error("Specify articleId for connected articles query");
d.schema&&delete d.schema;d.queryType="ConnectedArticlesQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.label="";d.label&&("string"==typeof d.label&&0<d.label.length)&&(this.label="&label="+d.label);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.ConnectedArticlesQuery.prototype=
new c;b.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=b.Appacitive.Queries.ConnectedArticlesQuery;b.Appacitive.Queries.GetConnectionsQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!d.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!d.label||0==d.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");d.schema&&delete d.schema;d.queryType="GetConnectionsQuery";c.call(this,
d);this.articleId=d.articleId;this.relation=d.relation;this.label=d.label;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+this.getQueryString()};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;
b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(d,a){d=d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!d.articleBId||"string"!=typeof d.articleBId||0==d.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");d.schema&&delete d.schema;d.queryType=a||"GetConnectionsBetweenArticlesQuery";c.call(this,d);this.articleAId=d.articleAId;
this.articleBId=d.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"==this.queryType&&d.label&&"string"==typeof d.label&&0<d.label.length?"&label="+d.label:"";this.relation=d.relation&&"string"==typeof d.relation&&0<d.relation.length?d.relation+"/":"";this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+
"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;b.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new b.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,
"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"==typeof a&&a(new b.Appacitive.Connection(d.connection)):(d=d||{},"function"==typeof c&&c(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this};return c};b.Appacitive.Queries.InterconnectsQuery=function(d){d=
d||{};if(!d.articleAId||"string"!=typeof d.articleAId||0==d.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(d.articleBIds&&"object"==typeof d.articleBIds&&0<d.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");d.schema&&delete d.schema;d.queryType="InterconnectsQuery";c.call(this,d);this.articleAId=d.articleAId;this.articleBIds=d.articleBIds;this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();
a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new c;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,a){if(!c||0==c.length)throw Error("Specify name of filter query");this.name=c;this.data=
{};this.queryType="GraphFilterQuery";a&&(this.data.placeholders=a);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(b.ids?b.ids:[]):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};
d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}};b.Appacitive.Queries.GraphProjectQuery=function(c,a,e){if(!c||0==c.length)throw Error("Specify name of project query");if(!a||!a.length)throw Error("Specify ids to project");this.name=c;this.data={ids:a};this.queryType="GraphProjectQuery";e&&(this.data.placeholders=e);this.toRequest=function(){var a=new b.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";
a.data=this.data;return a};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var f=function(a){var b,c;for(c in a)if("status"!==c){b=a[c];break}var d=function(a,b,c){var e=[];a.forEach(function(a){var g=a.__children;delete a.__children;var l=a.__edge;delete a.__edge;a=new Appacitive.Article(a,!0);a.children={};for(var k in g)a.children[k]=[],a.children[k]=d(g[k].values,g[k].parent,a.id);l&&(l.__endpointa={articleid:c,label:b},l.__endpointb={articleid:a.id,
label:l.label},delete l.label,a.connection=new Appacitive.Connection(l));e.push(a)});return e};return d(b.values)};this.fetch=function(a,c){var d=this.toRequest();d.onSuccess=function(b){b&&b.status&&"200"==b.status.code?"function"==typeof a&&a(f(b)):(b=b||{},"function"==typeof c&&c(b.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};b.Appacitive.http.send(d);return this}}})(global);
(function(b){b.Appacitive.BaseObject=function(e,f){var c={},d=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var d in a[c])b[c][d]=a[c][d]}else b[c]=a[c]},a={};d(e,a);f&&d(a,c);!c.__id&&a.__id&&(c.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.cid=g;var m="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),k=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=function(){return JSON.parse(JSON.stringify(a))};
this.toJSON=function(){return JSON.parse(JSON.stringify(a))};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};a.__attributes||(a.__attributes={});c.__attributes||(c.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");
a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var h=function(){var b=!1,d=JSON.parse(JSON.stringify(c.__attributes)),e;for(e in a.__attributes)"undefined"==typeof a.__attributes[e]||null===a.__attributes[e]?(d[e]=null,b=!0):a.__attributes[e]!=c.__attributes[e]?(d[e]=a.__attributes[e],b=!0):a.__attributes[e]==c.__attributes[e]&&delete d[e];return b?
d:null};this.getChangedAttributes=h;this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var n=[];a.__tags||(a.__tags=[]);c.__tags||(c.__tags=[]);this.tags=function(){return a.__tags?a.__tags:[]};this.addTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;a.__tags.push(b);
a.__tags=Array.distinct(a.__tags);if(!n||!n.length)return this;b=n.indexOf(b);-1!=b&&n.splice(b,1);return this};this.removeTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;n.push(b);n=Array.distinct(n);if(!a.__tags||!a.__tags.length)return this;b=a.__tags.indexOf(b);-1!=b&&a.__tags.splice(b,1);return this};var p=function(){var b=[];a.__tags.every(function(a){-1==c.__tags.indexOf(a)&&b.push(a)});return b};this.getChangedTags=p;this.getRemovedTags=function(){return _removetags};var q=
function(b){var d=!1,e=JSON.parse(JSON.stringify(c)),g;for(g in a)"undefined"==typeof a[g]||null===a[g]?(e[g]=null,d=!0):a[g]!=c[g]?"__tags"==g||"__attributes"==g?delete e[g]:(e[g]=a[g],d=!0):a[g]==c[g]&&delete e[g];try{m.forEach(function(a){e[a]&&delete e[a]})}catch(l){}b?(a.__tags&&0<a.__tags.length&&(e.__addtags=p(),d=!0),n&&0<n.length&&(e.__removetags=n,d=!0)):a.__tags&&0<a.__tags.length&&(e.__tags=p(),d=!0);(b=h())?(e.__attributes=b,d=!0):delete e.__attributes;return d?e:!1};this.changed=function(){return q()};
this.hasChanged=function(){var a=q(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=q(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&
arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return c};var r="";this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?r=a:"object"==typeof a&&a.length&&(r=a.join(","));return this}return r};this.get=function(b){if(b)return a[b]};this.set=function(b,c){if(!b||"string"!=typeof b||0==b.length)return this;null==c||"undefined"==c?a[b]=null:"string"==typeof c?a[b]=c:"number"==typeof c?a[b]=c+"":"object"==typeof c&&(0<=c.length?a[b]=c:-1!==k.indexOf(b)&&
(a[b]=c));return this};this.unset=function(b){if(!b||"string"!=typeof b||0==b.length||0==b.indexOf("__"))return this;try{delete a[b]}catch(c){}return this};this.has=function(b){return b&&"string"==typeof b&&0!=b.length?a[b]&&"undefined"!=typeof a[b]?!0:!1:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(b,e){b&&(d(b,a),d(b,c));return this};this.save=function(b,c){a.__id?
u.apply(this,arguments):t.apply(this,arguments);return this};var t=function(e,g){e=e||function(){};g=g||function(){};var k=this,f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,r);!a.__schematype||"user"!=a.__schematype.toLowerCase()&&"device"!=a.__schematype.toLowerCase()||(f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl());var h=new b.Appacitive.HttpRequest;h.url=
f;h.method="put";a.__revision&&delete a.__revision;h.data=a;h.onSuccess=function(h){var f=null;h&&(h.article||h.connection||h.user||h.device)&&(f=h.article||h.connection||h.user||h.device);h&&f?(c=f,a.__id=f.__id,d(f,a),k.connectionCollections&&0<k.connectionCollections.length&&k.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})}),"connection"==k.type&&k.parseConnection(),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+".created",k,{object:k}),
"function"==typeof e&&e(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+".createFailed",k,{error:h.status}),"function"==typeof g&&g(h.status,k))};h.onError=function(a){a=l(a);"function"==typeof g&&g(a,k)};b.Appacitive.http.send(h);return this},u=function(e,g){e=e||function(){};g=g||function(){};var h=q(!0),k=this;if(h){var f=new b.Appacitive.HttpRequest,m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||
a.__relationtype,c.__id?c.__id:a.__id,r);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&(m=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(c.__id));f.url=m;f.method="post";f.data=h;f.onSuccess=function(h){h&&(h.article||h.connection||h.user||h.device)?(c=h.article||h.connection||h.user||h.device,d(c,a),n=[],b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updated",
k,{object:k}),"function"==typeof e&&e(k)):(h=h||{},h.status=h.status||{},h.status=l(h.status),b.Appacitive.eventManager.fire((k.schema||k.relation)+"."+k.type+"."+a.__id+".updateFailed",k,{object:h.status}),"function"==typeof g&&g(h.status,k))};f.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==typeof g&&g(a,k)};b.Appacitive.http.send(f)}else"function"==typeof e&&e(k);return this};this.fetch=function(e,g){e=e||function(){};g=g||function(){};if(a.__id){var h=
this,k=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,r),f=new b.Appacitive.HttpRequest;f.url=k;f.method="get";f.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,d(c,a),h.___collection&&"article"==h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof e&&e(h)):(b=b||{},b.status=b.status||{},b.status=l(b),"function"==typeof g&&
g(b.status,h))};f.onError=function(a){a=l(a);"function"==typeof g&&g(a,h)};b.Appacitive.http.send(f);return this}"function"==typeof g&&g({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,d,e){if(a.__id){c=c||function(){};d=d||function(){};var h=this,k=b.Appacitive.config.apiBaseUrl,k=k+b.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);a&&(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))&&
(k=b.Appacitive.config.apiBaseUrl,k+=b.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id));e&&!0===e&&(k=-1==k.indexOf("?")?k+"?deleteconnections=true":k+"&deleteconnections=true");e=new b.Appacitive.HttpRequest;e.url=k;e.method="delete";e.onSuccess=function(b){"200"==b.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof c&&c(b)):(b=l(b),"function"==typeof d&&d(b,h))};e.onError=function(a){a=l(a);"function"==typeof d&&d(a,h)};b.Appacitive.http.send(e)}else this.___collection&&
this.___collection.removeByCId(g),"function"==typeof c&&c(this)}};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var e=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),c="",d,a,g,m,k,l,h=0,b=b.replace(/\r\n/g,"\n");a="";for(g=0;g<b.length;g++)m=b.charCodeAt(g),128>m?a+=String.fromCharCode(m):(127<m&&2048>m?a+=String.fromCharCode(m>>6|192):(a+=String.fromCharCode(m>>12|224),a+=String.fromCharCode(m>>6&63|128)),a+=String.fromCharCode(m&63|128));for(b=a;h<b.length;)d=b.charCodeAt(h++),a=b.charCodeAt(h++),
g=b.charCodeAt(h++),m=d>>2,d=(d&3)<<4|a>>4,k=(a&15)<<2|g>>6,l=g&63,isNaN(a)?k=l=64:isNaN(g)&&(l=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return c.toString()}})(global);
(function(b){b.Appacitive.ArticleCollection=function(e){var f=null,c=null,d=[],a={};"string"==typeof e?a.schema=e:a=e;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var f=a.schema,g=this;e=function(d){d.type="article";d.schema?f=d.schema:d.schema=f;c=new b.Appacitive.Queries.FindAllQuery(d);a=d;g.extendOptions=c.extendOptions};this.setFilter=function(d){a.filter=d;a.type="article";c?c.filter(d):(c=new b.Appacitive.Queries.FindAllQuery(a),
g.extendOptions=c.extendOptions);return this};this.setFreeText=function(d){d||0!=d.trim().length||(a.freeText="");a.freeText=d;a.type="article";c?c.freeText(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.setFields=function(d){d||(d="");a.fields=d;a.type="article";c?c.fields(d):(c=new b.Appacitive.Queries.FindAllQuery(a),g.extendOptions=c.extendOptions);return this};this.reset=function(){f=a=null;d.length=0;c=null};var m=["BasicFilterQuery"];this.query=
function(){if(1==arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==m.indexOf(a.queryType()))throw Error("ArticleCollection only accepts "+m.join(", "));d.length=0;c=a;return this}return c};this.setOptions=e;e(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=f)throw Error("Null article passed or schema type mismatch");
var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!=b?d.splice(b,1):d.push(a);return this};this.getArticleById=function(a){var b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllArticles=function(){return Array.prototype.slice.call(d).map(function(a){return a.getArticle()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getArticle().__id&&
c.getArticle().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var k=function(a,b,c){a.length&&0!==a.length||(a=[]);a.forEach(function(a){a.___collection=g;d.push(a)});"function"==typeof c&&c(b,g)};this.fetch=function(a,b){d.length=0;c.fetch(function(b,c){k(b,c,a)},function(a){"function"==typeof b&&b(a,g)});return this};this.count=function(a,b){this.query.count(a,
b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=f;a=new b.Appacitive.Article(a);a.___collection=g;d.push(a);return a};this.map=
function(){return d.map.apply(this,arguments)};this.forEach=function(){return d.forEach.apply(this,arguments)};this.filter=function(){return d.filter.apply(this,arguments)}};b.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};b.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};b.Appacitive.ArticleCollection.prototype.articles=function(){return this.getAll()};b.Appacitive.ArticleCollection.prototype.length=
function(){return this.articles.length}})(global);
(function(b){b.Appacitive.ConnectionCollection=function(e){var f=null,c=null,d=[],a=[],g={};"string"==typeof e?g.relation=e:g=e;this.collectionType="connection";var m=this;if(!e||!e.relation)throw Error("Must provide relation while initializing ConnectionCollection.");f=e.relation;e=function(a){a.type="connection";a.relation?f=a.relation:a.relation=f;c=new b.Appacitive.Queries.FindAllQuery(a);g=a;return m};this.setFilter=function(a){g.filter=a;g.type="connection";c?c.filter(a):(c=new b.Appacitive.Queries.FindAllQuery(g),
m.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){a||0!=a.trim().length||(g.freeText="");g.freeText=a;g.type="connection";c?c.freeText(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";c?c.fields(a):(c=new b.Appacitive.Queries.FindAllQuery(g),m.extendOptions=c.extendOptions);return this};this.query=function(){if(1==arguments.length){var b=arguments[0];if(!b||
!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==k.indexOf(b.queryType()))throw Error("ConnectionCollection only accepts "+k.join(", "));a.length=0;d.length=0;c=b;return this}return c};var k=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.reset=function(){f=g=null;a.length=0;d.length=0;c=null};this.setOptions=e;e(g);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,
10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=f)throw Error("Null connection passed or relation type mismatch");var b=null;d.forEach(function(c,d){c.get("__id")==a.get("__id")&&(b=d)});null!==b?d.splice(b,1):d.push(a);return this};this.getConnection=function(a,b,c){b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllConnections=
function(){return Array.prototype.slice.call(d).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.getConnection().__id&&c.getConnection().__id==a&&(b=d)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,d){c.cid&&c.cid==a&&(b=d)});null!==b&&d.splice(b,1);return this};var l=function(b,e,g){"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&(b=[b]);b.length&&
0!==b.length||(b=[]);b.forEach(function(b){b.___collection=m;if(b.endpointA.article||b.endpointB.article){var c=b.endpointA.article||b.endpointB.article;c.___collection=m;a.push(c)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(e){}d.push(b)});"function"==typeof g&&g(e,m)};this.getConnectedArticle=function(b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(a,b){d.length=0;c.fetch(function(b,
c){l(b,c,a)},function(a){"function"==typeof b&&b(a,m)});return this};this.count=function(a,b){c.count(a,b);return this};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b);return this};this.createNewConnection=function(a){a=
a||{};a.__relationtype=f;a=new b.Appacitive.Connection(a);a.___collection=m;d.push(a);return a};this.map=function(){return d.map.apply(this,arguments)};this.forEach=function(a,b){return d.forEach(a,b||this)};this.filter=function(){return d.filter.apply(this,arguments)}}})(global);
(function(b){var e=function(c,d){c=c||function(){};d=d||function(){};var a=new b.Appacitive.HttpRequest;a.method="get";a.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(a){a?c(a):d()}):d({code:"404",message:"fb account not found"})};
a.onError=d;b.Appacitive.http.send(a)};b.Appacitive.Article=function(c,d){c=c||{};"string"==typeof c&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);b.Appacitive.BaseObject.call(this,c,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=e);return this};b.Appacitive.Article.prototype=new b.Appacitive.BaseObject;
b.Appacitive.Article.prototype.constructor=b.Appacitive.Article;b.Appacitive.Article.prototype.getConnections=function(c){if("article"!=this.type)return null;c=c||{};c.articleId=this.get("__id");var d=new b.Appacitive.ConnectionCollection({relation:c.relation});this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.GetConnectionsQuery(c));return d};b.Appacitive.Article.prototype.getConnectedArticles=function(c){c=c||{};"string"==typeof c&&(rName=c,c={relation:rName});c.articleId=this.get("__id");
var d=new b.Appacitive.ConnectionCollection({relation:c.relation});d.connectedArticle=this;this.connectionCollections.push(d);d.query(new b.Appacitive.Queries.ConnectedArticlesQuery(c));return d};b.Appacitive.Article.multiDelete=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if("user"==c.schema.toLowerCase()||"device"==c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(c.ids&&0<c.ids.length){d=
d||function(){};a=a||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);e.method="post";e.data={idlist:c.ids};e.onSuccess=function(b){b&&"200"==b.code?"function"==typeof d&&d():(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else d()};var f=function(c){var d=
[];c.forEach(function(a){d.push(new b.Appacitive.Article(a))});return d};b.Appacitive.Article.multiGet=function(c,d,a){c=c||{};if(!c.schema||"string"!=typeof c.schema||0==c.schema.length)throw Error("Specify valid schema");if(c.ids&&0<c.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);e.method="get";e.onSuccess=function(b){b&&b.articles?"function"==typeof d&&d(f(b.articles),b.paginginfo):
(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof a&&a(b)};b.Appacitive.http.send(e)}else"function"==typeof d&&d([])};b.Appacitive.Article.get=function(c,d,a){c=c||{};if(!c.schema)throw Error("Specify schema");if(!c.id)throw Error("Specify id to fetch");var e={},e="user"==c.schema.toLowerCase()?new b.Appacitive.User({__id:c.id}):new b.Appacitive.Article({__schematype:c.schema,__id:c.id});
e.fields=c.fields;e.fetch(d,a);return e}})(global);
(function(b){var e=function(a,c,d){var e={label:a.label};a.articleid&&(e.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?e.articleid=a.article.get("__id"):e.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?e.articleid=a.article.__id:e.article=a.article,a.article=new b.Appacitive.Article(a.article));else if(!e.articleid&&!e.article)throw Error("Incorrectly configured endpoints provided to setupConnection");d["endpoint"+
c]=a;return e},f=function(a,c,d){a.article&&"object"==typeof a.article?(d["endpoint"+c]?d["endpoint"+c]&&d["endpoint"+c].article&&d["endpoint"+c].article.getArticle?d["endpoint"+c].article.copy(a.article):d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0):(d["endpoint"+c]={},d["endpoint"+c].article=new b.Appacitive.Article(a.article,!0)),d["endpoint"+c].articleid=a.articleid,d["endpoint"+c].label=a.label,d["endpoint"+c].type=a.type,d["endpoint"+c].article.___collection=d.___collection):
d["endpoint"+c]=a};b.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw Error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);b.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b=
"A",c="B";a.__endpointa.label!=this.get("__endpointb").label||(a.__endpointa.label==a.__endpointb.label||a.__endpointa.articleid!=this.get("__endpointb").articleid&&a.__endpointa.articleid)||(b="B",c="A");f(this.get("__endpointa"),b,this);f(this.get("__endpointb"),c,this);this.endpoints=function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};c?(this.connectedArticle=function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(b=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(b)},this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.prototype.setupConnection=function(a,b){if(!(a&&(a.articleid||a.article)&&a.label&&b&&(b.articleid||b.article)&&b.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",e(a,"A",this));this.set("__endpointb",e(b,"B",this))};b.Appacitive.Connection.get=function(a,c,d){a=a||{};if(!a.relation)throw Error("Specify relation");if(!a.id)throw Error("Specify id to fetch");var e=new b.Appacitive.Connection({__relationtype:a.relation,
__id:a.id});e.fields=a.fields;e.fetch(c,d)};var c=function(a){var c=[];a||(a=[]);a.forEach(function(a){c.push(new b.Appacitive.Connection(a))});return c},d=function(a,d,e){a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"==typeof d&&d(c(a.connections),a.paginginfo):(a=a||{},"function"==typeof e&&e(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof e&&e(a)};b.Appacitive.http.send(a)};b.Appacitive.Connection.multiGet=
function(a,c,e){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var k=new b.Appacitive.HttpRequest;k.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(a.relation,a.ids.join(","),a.fields);k.method="get";return d(k,c,e)}"function"==typeof c&&c([])};b.Appacitive.Connection.multiDelete=function(a,c,d){a=a||{};if(!a.relation||"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");
if(a.ids&&0<a.ids.length){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);e.method="post";e.data={idlist:a.ids};e.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof d&&d(a||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof d&&d(a||{message:"Server error",code:400})};b.Appacitive.http.send(e)}else c()};b.Appacitive.Connection.getInterconnects=
function(a,b,c){a=new Appacitive.Queries.InterconnectsQuery(a);d(a.toRequest(),request,b,c)};b.Appacitive.Connection.getBetweenArticles=function(a,b,c){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);d(a.toRequest(),b,c)};b.Appacitive.Connection.getBetweenArticlesForRelation=function(a,b,c){(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).fetch(b,c)}})(global);
(function(b){b.Appacitive.Users=new function(){var e=null;this.currentUser=function(){return e};var f=function(a,c,d,e,f){var g=a.get("__id");if(!g||"string"!==typeof g||0==g.length)throw Error("Please specify valid userid");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid oldPassword");if(!d||"string"!==typeof d||0==d.length)throw Error("Please specify valid newPassword");e=e||function(){};f=f||function(){};c==d?"function"==typeof e&&e(a):(c={oldpassword:c,newpassword:d},
d=new b.Appacitive.HttpRequest,d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g),d.method="post",d.data=c,d.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof e?e(a):f(b,a))},d.onError=f,b.Appacitive.http.send(d))},c=function(a,c,d){var e=a.get("__id");e&&"string"===typeof e&&0!=e.length||"function"==typeof c&&c(a.linkedAccounts(),a);c=c||function(){};d=d||function(){};var f=new b.Appacitive.HttpRequest;f.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(e);f.method="get";f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(b=b.identities||[],0<b.length?a.set("__link",b):a.set("__link",null),"function"==typeof c&&c(b,a)):d(b.status,a)};f.onError=d;b.Appacitive.http.send(f)},d=function(a,c,d,e){var f=c.get("__id");f&&"string"===typeof f&&0!=f.length||d&&"function"==typeof d&&d();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");d=d||function(){};e=e||function(){};
var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getCheckinUrl(f,a.lat,a.lng);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d(accounts,c):"function"==typeof e&&e(a,c)};g.onError=e;b.Appacitive.http.send(g)},a=function(a,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);g.method="post";g.data=f;g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else c.set("__link",f),"function"==typeof d&&d(c)},g=function(a,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var g=new b.Appacitive.HttpRequest;g.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);g.method=
"post";g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof d&&d(c)):e(a,c)};g.onError=e;b.Appacitive.http.send(g)}else"function"==typeof d&&d(c)};this.setCurrentUser=function(c,l,h){if(!c)throw Error("Cannot set null object as user");var m=c;if(m instanceof Appacitive.User)if(m.get("__id")&&0!=m.get("__id").length)c=m.toJSON();else throw Error("Specify user __id");else m=new b.Appacitive.User(c,!0);b.Appacitive.localStorage.set("Appacitive-User",c);h||(h=60);e=m;l&&b.Appacitive.Session.setUserAuthHeader(l,
h);e.logout=function(a){b.Appacitive.Users.logout(a)};e.updatePassword=function(a,b,c,d){f(this,a,b,c,d);return this};e.linkFacebookAccount=function(c,d){var f=function(){a(Appacitive.Facebook.accessToken(),e,function(a){b.Appacitive.eventManager.fire("user..article."+a.get("__id")+".updated",a,{object:a});"function"==typeof c&&c(a)},d)};Appacitive.Facebook.getCurrentUserInfo(function(){f()},function(){Appacitive.Facebook.requestLogin(function(){f()},d)});return this};e.unlinkFacebookAccount=function(a,
c){g("facebook",this,function(c){b.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};e.logout=function(a){Appacitive.Users.logout(a)};e.checkin=function(a,b,c){d(a,this,b,c);return this};b.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(a,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return e};b.Appacitive.User=function(a){a=a||{};a.__schematype="user";
b.Appacitive.Article.call(this,a);return this};b.Appacitive.User.prototype=new b.Appacitive.Article("user");b.Appacitive.User.prototype.constructor=b.Appacitive.User;b.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?"object"!=typeof a||0<=a.length?0<=a.length||(a=a[0]):a=[a]:a=[];return a};b.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this;c(this,function(b){"function"==typeof a&&a(b,d)},b);return this};b.Appacitive.User.prototype.linkFacebookAccount=
function(b,c,d){a(b,this,c,d);return this};b.Appacitive.User.prototype.unlinkFacebookAccount=function(a,b){var c=this;g("facebook",this,function(){var b=c.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&c.set("__link",null);"function"==typeof a&&a(c)},b);return this};b.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,d){if(!a)throw Error("Specify userid for user delete");c=c||function(){};d=d||function(){};
(new b.Appacitive.Article({__schematype:"user",__id:a})).del(c,d)};this.deleteCurrentUser=function(a,c){var d=function(){b.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a()};if(null===e)d();else{var f=e.get("__id");this.deleteUser(f,function(){d()},c)}};this.createUser=this.createNewUser=function(a,c,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new b.Appacitive.User(a)).save(c,d)};this.signup=function(a,b,c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(a,c,d,f){c=c||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var g=this,m=new b.Appacitive.HttpRequest;m.method="post";m.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();m.data=a;m.onSuccess=function(b){b&&b.user?(f&&(b.user.__authType=f),g.setCurrentUser(b.user,
b.token,a.expiry),c({user:e,token:b.token})):(b=b||{},d(b.status))};m.onError=d;b.Appacitive.http.send(m)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(a,c,d,f){a=a||function(){};c=c||function(){};var g=this,m=function(){var d=
{accesstoken:b.Appacitive.Facebook.accessToken(),type:"facebook",expiry:864E5,createnew:!0};g.authenticateUser(d,function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:e,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};d?m():Appacitive.Facebook.requestLogin(function(a){m()},c)};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var d=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=this;this.getUserByToken(d,function(b){e.setCurrentUser(b,d);"function"==typeof a&&a(!0)},function(){"function"==typeof a&&a(!1)})}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,
subject:c};c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code?"function"==typeof d&&d():e(a)};c.onError=e;b.Appacitive.http.send(c)};var m=function(a,c,d){c=c||function(){};d=d||function(){};var e=new b.Appacitive.HttpRequest;e.url=a;e.method="get";e.onSuccess=function(a){a&&a.user?"function"==typeof c&&c(new Appacitive.User(a.user)):"function"==typeof d&&
d(a.status)};e.onError=d;b.Appacitive.http.send(e)};this.getUserByToken=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);m(a,c,d)};this.getUserByUsername=function(a,c,d){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");a=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);m(a,c,d)};this.logout=
function(a,c){e=null;b.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(b){b.Appacitive.Email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var f=function(c,d,a){var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=c;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.email):(b=b||{},b.status=b.status||{},a(b.status.message||"Server error"))};
b.Appacitive.http.send(e)};this.setupEmail=function(b){b=b||{};e.smtp.username=b.username||e.smtp.username;e.from=b.from||e.from;e.smtp.password=b.password||e.smtp.password;e.smtp.host=b.smtp.host||e.smtp.host;e.smtp.port=b.smtp.port||e.smtp.port;e.smtp.enablessl=b.enableSSL||e.smtp.enablessl;e.replyto=b.replyTo||e.replyto};this.sendTemplatedEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.templateName)throw Error("template name is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1==b.isHtml?!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)};this.sendRawEmail=function(b,d,a){d=d||function(){};a=a||function(){};if(!b||!b.to||!b.to.length||0==b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0==b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.body)throw Error("body is mandatory to send an email");var g={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,body:{content:b.body||"",ishtml:!1==b.isHtml?
!1:!0}};if(b.useConfig){g.smtp=e.smtp;if(!b.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=b.from||e.from;g.replyto=b.replyTo||e.replyto}f(g,d,a)}}})(global);
(function(b){var e=function(){var b=require("facebook-node-sdk"),c=null,d=this.FB=null,a=!0;this.initialize=function(c){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!c.appId)throw Error("Please provide appid");if(!c.appSecret)throw Error("Please provide app secret");d=c.appSecret;this.FB=new b({appId:_appId,secret:d});a=!0};this.requestLogin=function(b,d,e){a?(c=accesstoken,FB.setAccessToken(e),Appacitive.Users.loginWithFacebook(b,d,!0)):"function"==typeof d&&
d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,d){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&c?(b=b||function(){},d=d||function(){},this.FB.api("/me",function(a,c){c?"function"==typeof b&&b(c):"function"==typeof d&&d("Access token is invalid")})):d("Either intialize facebook with your appid and appsecret or set accesstoken")};this.accessToken=function(){return 1==arguments.length?(c=arguments[0],this):
c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,b){a=a||function(){};Appacitive.Facebook.accessToken="";"function"==typeof a&&a()}};b.Appacitive.Facebook=b.Appacitive.runtime.isBrowser?new function(){var b=null,c=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);c=!0};this.requestLogin=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
d=d||function(){};a=a||function(){};FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,"function"==typeof d&&d(c.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(d,a){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");d=d||function(){};a=a||function(){};FB.api("/me",function(c){c&&!c.error?(b=FB.getAuthResponse().accessToken,"function"==typeof d&&d(c)):"function"==
typeof a&&a()})};this.accessToken=function(){return 1==arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.Facebook.accessToken="";try{FB.logout(function(a){Appacitive.Users.logout();"function"==typeof b&&b()})}catch(c){"function"==typeof a&&a(c.message)}}}:new e})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify push options");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();d.method="post";d.data=e;d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};
this.getNotification=function(e,f,c){f=f||function(){};c=c||function(){};if(!e)throw Error("Please specify notification id");var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)};this.getAllNotifications=
function(e,f,c){f=f||function(){};c=c||function(){};e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(e);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};b.Appacitive.http.send(d)}}})(global);
(function(b){b.Appacitive.File=function(e){e=e||{};this.fileId=e.fileId;this.contentType=e.contentType;this.fileData=e.fileData;var f=function(a,c,d){var e=new b.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=c;e.onError=d;b.Appacitive.http.send(e)},c=function(a,c,d,e,f){(new FormData).append("fileToUpload",c);var n=new b.Appacitive.HttpRequest;n.url=a;n.method="PUT";n.data=c;n.headers.push({key:"content-type",value:d});n.onSuccess=e;n.onError=f;n.send()};this.save=function(b,c,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,b,c,e):d(this,b,c,e)};var d=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(h){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==
b.status.code?c(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this},a=function(a,d,e,l){if(!a.fileData)throw Error("Please specify filedata");if(l||"string"==typeof l)a.contentType=l;else{a.contentType&&"string"===typeof l&&0!=a.contentType.length||(a.contentType="text/plain");try{a.contentType=file.type}catch(h){}}l=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);d=d||function(){};e=e||function(){};f(l,function(b){b&&b.status&&"200"==b.status.code?c(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){d(b,a)},e)},e):"function"==typeof e&&e(b.status,a)},e);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(b,that)};d.onError=c;b.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};c=c||function(){};var e=new b.Appacitive.HttpRequest;e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(b){b&&b.status&&"200"==b.status.code?(d.url=b.uri,"function"==typeof a&&a(b.uri)):"function"==typeof c&&"function"==typeof c&&c(b.status,d)};e.onError=c;b.Appacitive.http.send(e);return this}}})(global);
(function(b){b.Appacitive.Date={};b.Appacitive.Date.parseISODate=function(b){try{var f=new Date(b);if(isNaN(f)){var c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,d=!1;if(!c.exec(b))if(c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,c.exec(b))d=!0;else return null;var a=b.split("T"),g=a[0].split("-"),m=a[1].split("Z")[0].split(":"),k=m[2].split("."),l=Number(m[0]),f=new Date;f.setUTCFullYear(Number(g[0]));f.setUTCMonth(Number(g[1])-1);f.setUTCDate(Number(g[2]));
d||(f.setUTCHours(Number(l)),f.setUTCMinutes(Number(m[1])),f.setUTCSeconds(Number(k[0])),k[1]&&f.setUTCMilliseconds(Number(k[1])))}return f}catch(h){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(f){return null}};b.Appacitive.Date.toISODate=function(b){try{return b=b.toISOString().split("T")[0]}catch(f){return null}};b.Appacitive.Date.toISOTime=function(b){try{return b=b.toISOString().split("T")[1],b=b.replace("Z","0000Z")}catch(f){return null}};
b.Appacitive.Date.parseISOTime=function(b){try{var f=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b))return null;var c=b.split("T");1==c.length&&c.push(c[0]);var d=c[1].split("Z")[0].split(":"),a=d[2].split(".");f.setUTCHours(Number(Number(d[0])));f.setUTCMinutes(Number(d[1]));f.setUTCSeconds(Number(a[0]));a[1]&&f.setUTCMilliseconds(Number(a[1]));return f}catch(g){return null}}})(global);
(function(b){b.Appacitive.localStorage=new function(){var e=b.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(f,c){c=c||"";if(!f)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(d){}f=b.Appacitive.getAppPrefix(f);e[f]=c;return!0};this.get=function(f){if(!f)return null;f=b.Appacitive.getAppPrefix(f);f=e.getItem(f);if(!f)return null;if("{"==f[0])try{f=JSON.parse(f)}catch(c){}return f};this.remove=function(f){if(f){f=b.Appacitive.getAppPrefix(f);try{delete e[f]}catch(c){}}}}})(global);
(function(b){b.Appacitive.runtime.isBrowser&&(b.Appacitive.Cookie=new function(){this.setCookie=function(e,f,c,d){e=b.Appacitive.getAppPrefix(e);var a="";c&&(a=new Date,a.setTime(a.getTime()+6E4*c),a.toGMTString());a=d?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=e+"="+f+a+"; path=/;"+c};this.readCookie=function(e){e=
b.Appacitive.getAppPrefix(e);e+="=";for(var f=document.cookie.split(";"),c=0;c<f.length;c++){for(var d=f[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(e))return d.substring(e.length,d.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}})})(global);"undefined"==typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
