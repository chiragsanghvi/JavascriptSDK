"bind"in Function.prototype||(Function.prototype.bind=function(b){var c=this;if(1>=arguments.length)return function(){return c.apply(b,arguments)};var e=Array.prototype.slice.call(arguments,1);return function(){return c.apply(b,0===arguments.length?e:e.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,c){void 0===c&&(c=0);0>c&&(c+=this.length);0>c&&(c=0);for(var e=this.length;c<e;c++)if(c in this&&this[c]===b)return c;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,c){void 0===c&&(c=this.length-1);0>c&&(c+=this.length);c>this.length-1&&(c=this.length-1);for(c++;0<c--;)if(c in this&&this[c]===b)return c;return-1});
"forEach"in Array.prototype||(Array.prototype.forEach=function(b,c){for(var e=0,f=this.length;e<f;e++)e in this&&b.call(c,this[e],e,this)});"map"in Array.prototype||(Array.prototype.map=function(b,c){for(var e=Array(this.length),f=0,g=this.length;f<g;f++)f in this&&(e[f]=b.call(c,this[f],f,this));return e});"filter"in Array.prototype||(Array.prototype.filter=function(b,c){for(var e=[],f,g=0,h=this.length;g<h;g++)g in this&&b.call(c,f=this[g],g,this)&&e.push(f);return e});
"every"in Array.prototype||(Array.prototype.every=function(b,c){for(var e=0,f=this.length;e<f;e++)if(e in this&&!b.call(c,this[e],e,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=function(b,c){for(var e=0,f=this.length;e<f;e++)if(e in this&&b.call(c,this[e],e,this))return!0;return!1});"find"in Array.prototype||(Array.prototype.find=function(b,c){var e=this.length;if(0!==e)for(var f=0,g;f<e&&f in this;f++)if(g=this[f],b.call(c,g,f,this))return g});
"each"in Array.prototype||(Array.prototype.each=function(b,c){for(var e=0;e<this.length;e++)b.apply(c,[this[e]])});"difference"in Array.prototype||(Array.prototype.difference=function(b){return this.filter(function(c){return 0>b.indexOf(c)})});"without"in Array.prototype||(Array.prototype.without=function(){return this.difference(Array.prototype.slice.call(arguments,0))});
"function"!==typeof Array.prototype.reduce&&(Array.prototype.reduce=function(b){if(null===this||"undefined"===typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!==typeof b)throw new TypeError(b+" is not a function");var c=Object(this),e=c.length>>>0,f=0,g;if(2<=arguments.length)g=arguments[1];else{for(;f<e&&!f in c;)f++;if(f>=e)throw new TypeError("Reduce of empty array with no initial value");g=c[f++]}for(;f<e;f++)f in c&&(g=b(g,c[f],f,c));return g});
var _lookupIterator=function(b,c){return null==b?_.identity:_.isFunction(b)?c?function(){return b.apply(c,arguments)}:b:function(e){return e[b]}};Array.prototype.pluck=function(b){var c=[];this.each(function(e){c.push(e[b])});return c};Array.prototype.sortBy=function(b,c){b=_lookupIterator(b,c);return this.map(function(e,f){return{value:e,criteria:b.call(c,e,f,this)}},this).sort(function(e,b){var g=e.criteria,c=b.criteria;return g<c?-1:g>c?1:0}).pluck("value")};
Date.prototype.toISOString||function(){function b(b){b=String(b);1===b.length&&(b="0"+b);return b}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();
String.addSlashes=function(b){if(!b)return b;b=b.replace(/\\/g,"\\\\");b=b.replace(/\'/g,"\\'");b=b.replace(/\"/g,'\\"');return b=b.replace(/\0/g,"\\0")};String.stripSlashes=function(b){if(!b)return b;b=b.replace(/\\'/g,"'");b=b.replace(/\\"/g,'"');b=b.replace(/\\0/g,"\x00");return b=b.replace(/\\\\/g,"\\")};if("undefined"===typeof console||null===console)console={log:function(){},dir:function(){}};
for(var _type=function(b){if(null===b||"undefined"===typeof b||"undefined"===b)return"null";if(b&&(1===b.nodeType||9===b.nodeType))return"element";var c=Object.prototype.toString.call(b).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===c){if(isNaN(b))return"nan";if(!isFinite(b))return"infinity"}return c},types="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),generateMethod=function(b){_type["is"+b]=function(c){return _type(c)===b.toLowerCase()}},
i=0;i<types.length;i++)generateMethod(types[i]);_type.isNullOrUndefined=function(b){return"null"==_type(b)||"undefined"==_type(b)};_type.isNumeric=function(b){return!isNaN(parseFloat(b))&&isFinite(b)};_type.isDate=function(b){return b instanceof Date};var _clone=function(b){return _type.isObject(b)?_type.isArray(b)?b.slice():_extend({},b):b};Array.prototype.removeAll=function(b){for(var c=null,e=0;e<this.length;e++)for(;this[e]===b;)c=this.splice(e,1)[0];return c};
Array.prototype.compare=function(b){if(!b||this.length!=b.length)return!1;for(var c=0,e=this.length;c<e;c++)if(this[c]instanceof Array&&b[c]instanceof Array){if(!this[c].compare(b[c]))return!1}else if(this[c]!=b[c])return!1;return!0};
Array.prototype.equals=function(b,c){if(!b)return!1;1==arguments.length&&(c=!1);if(this.length!=b.length)return!1;for(var e=0;e<this.length;e++)if(this[e]instanceof Array&&b[e]instanceof Array){if(!this[e].equals(b[e],c))return!1}else{if(c&&!_type.isEqual(this[e],b[e]))return!1;if(!c)return this.sort().equals(b.sort(),!0)}return!0};
var eq=function(b,c,e,f){var g=Object.prototype.toString;if(b===c)return 0!==b||1/b==1/c;if(null==b||null==c)return b===c;var h=g.call(b);if(h!=g.call(c))return!1;switch(h){case "[object String]":return b==String(c);case "[object Number]":return b!=+b?c!=+c:0==b?1/b==1/c:b==+c;case "[object Date]":case "[object Boolean]":return+b==+c}if("object"!=typeof b||"object"!=typeof c)return!1;if(b instanceof global.Appacitive.GeoCoord&&c instanceof global.Appacitive.GeoCoord)return b.toString()==c.toString();
for(g=e.length;g--;)if(e[g]==b)return f[g]==c;var g=b.constructor,d=c.constructor;if(g!==d&&!(_types.isFunction(g)&&g instanceof g&&_types.isFunction(d)&&d instanceof d)&&"constructor"in b&&"constructor"in c)return!1;e.push(b);f.push(c);g=0;d=!0;if("[object Array]"==h){if(g=b.length,d=g==c.length)for(;g--&&(d=eq(b[g],c[g],e,f)););}else{for(var l in b)if(Object.prototype.hasOwnProperty.call(b,l)&&(g++,!(d=Object.prototype.hasOwnProperty.call(c,l)&&eq(b[l],c[l],e,f))))break;if(d){for(l in c)if(Object.prototype.hasOwnProperty.call(c,
l)&&!g--)break;d=!g}}e.pop();f.pop();return d};_type.isEqual=function(b,c){return eq(b,c,[],[])};var global={};
(function(){global="undefined"===typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(d){if(d&&d.send&&_type.isFunction(d.send))d.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var b=[],e={},g=0,c={},f=0;this.addProcessor=function(d){d&&(d.pre=d.pre||function(){},d.post=d.post||function(){},q(d.pre),h(d.post))};var q=function(d){g+=1;e[g]=d;return g},
h=function(d){f+=1;c[f]=d;return f};this.enqueueRequest=function(d){b.push(d)};this.changeRequestForCors=function(d){var b={m:d.method.toUpperCase()};d.headers.forEach(function(d){b[d.key]=d.value});d.prevHeaders=d.headers;d.headers=[];d.headers.push({key:"Content-Type",value:"text/plain; charset=utf-8"});d.method="POST";d.data&&(b.b=d.data);delete d.data;global.Appacitive.config.debug&&(-1===d.url.indexOf("?")?d.url+="?debug=true":d.url+="&debug=true");global.Appacitive.config.metadata&&(-1===d.url.indexOf("?")?
d.url+="?metadata=true":d.url+="&metadata=true");try{d.data=JSON.stringify(b)}catch(e){}return d};this.notify=function(){if(0!==b.length){var g=[],f;for(f in c)c.hasOwnProperty(f)&&g.push(c[f]);for(;0<b.length;){var p=b.shift(),q=[];for(f in e)e.hasOwnProperty(f)&&q.push(e[f](p));this.changeRequestForCors(p);d.send(p,g,q)}}};this.onResponse=function(d){console.dir(d)}},c=function(){var d=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=d;this.onResponse=function(b,e){d()};
this.onError=function(b){d()}},e=null,e=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest,f=function(d){var b=global.Appacitive.Promise.buildPromise({success:d.onSuccess,error:d.onError}),e=new XDomainRequest;e.onload=function(){var d=e.responseText;try{var g=e.contentType;if("application/json"==g.toLowerCase()||"application/javascript"==g.toLowerCase()||"application/json; charset=utf-8"==g.toLowerCase()||"application/json; charset=utf-8;"==
g.toLowerCase())g=d,global.Appacitive.runtime.isBrowser||"{"!=g[0]&&(g=g.substr(1,g.length-1)),d=JSON.parse(g)}catch(c){}b.fulfill(d,this)};e.onerror=e.ontimeout=function(){b.reject(e)};e.onprogress=function(){};-1===d.url.indexOf("?")?d.url+="?ua=ie":d.url+="&ua=ie";e.open(d.method,d.url,!0);e.send(d.data);return b},g=function(d){if(!d.url)throw Error("Please specify request url");d.method||(d.method="GET");d.headers||(d.headers=[]);var b={};d.onSuccess&&_type.isFunction(d.onSuccess)||(d.onSuccess=
function(){});d.onError&&_type.isFunction(d.onError)||(d.onError=function(){});var g=global.Appacitive.Promise.buildPromise({success:d.onSuccess,error:d.onError}),c=!0;d.headers.forEach(function(d){"content-type"==d.key.toLowerCase()&&(c=!0,"application/json"==d.value.toLowerCase()||"application/javascript"==d.value.toLowerCase()||"application/json; charset=utf-8"==d.value.toLowerCase()||"application/json; charset=utf-8;"==d.value.toLowerCase())&&(c=!1)});if(c)b=d.data;else if(d.data&&(b=d.data,_type.isObject(d.data)))try{b=
JSON.stringify(b)}catch(h){}if(!global.navigator||-1==global.navigator.userAgent.indexOf("MSIE 8")&&-1==global.navigator.userAgent.indexOf("MSIE 9")){var r=new e;r.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var d=this.responseText;try{var b=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase()||"application/json; charset=utf-8"==
b.toLowerCase()||"application/json; charset=utf-8;"==b.toLowerCase())b=d,global.Appacitive.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),d=JSON.parse(b)}catch(e){}g.fulfill(d,this)}else g.reject(this)};r.open(d.method,d.url,!0);for(var q=0;q<d.headers.length;q+=1)r.setRequestHeader(d.headers[q].key,d.headers[q].value);global.Appacitive.runtime.isBrowser||r.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");r.send(b);return g}d.data=b;return new f(d)},h=function(){var d=new c;d.isOnline=
function(){return!0};var b=function(b,e,c){new g({method:b.method,url:b.url,headers:b.headers,data:b.data,onSuccess:function(g,f){if(g){try{g=JSON.parse(g)}catch(l){}var h=g;if(e.length!=c.length)throw Error("Callback length and state length mismatch!");for(var v=0;v<e.length;v+=1)e[v].apply({},[h,c[v]]);if(200<=g.code&&300>=g.code||g.status&&200<=g.status.code&&300>=g.status.code)d.onResponse(b,g);else g=g||{},g=g.status||g,g.message=g.message||"Bad Request",g.code=g.code||"400",d.onError(b,{responseText:JSON.stringify(g)})}else d.onError(b,
{responseText:JSON.stringify({code:"400",message:"Invalid request"})})},onError:function(e){var g={};g.message=e.responseText||"Bad Request";g.code=e.status||"400";d.onError(b,{responseText:JSON.stringify(g)})}})};d.send=function(d,e,g){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");_type.isFunction(d.beforeSend)&&d.beforeSend(d);b(d,e,g)};return d};global.Appacitive.http=new function(){var d=new h,e=new b(d),g=!1;this.pause=function(){g=!0};this.unpause=function(){g=
!1};this.addProcessor=function(d){var b=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!d)throw b;if(!d.pre&&!d.post)throw b;e.addProcessor(d)};this.send=function(b){b.promise=global.Appacitive.Promise.is(b.promise)?b.promise:new global.Appacitive.Promise.buildPromise({error:b.onError});e.enqueueRequest(b);d.isOnline()&&!1===g&&e.notify();return b.promise};this.flush=function(b){b?e.notify():d.isOnline()&&e.notify()};this.onError=function(d,b){var e;
if(b&&b.responseText)try{e=JSON.parse(b.responseText)}catch(g){}else b={responseText:""};e=e||{code:b.status,message:b.responseText,referenceid:b.headers.TransactionId};global.Appacitive.logs.logRequest(d,e,e,"error");d.promise.reject(e,d.entity)};d.onError=this.onError;this.onResponse=function(d,b){if(d.onSuccess)if(d.context)d.onSuccess.apply(d.context,[b]);else d.onSuccess(b);global.Appacitive.logs.logRequest(d,b,b?b.status:null,"successful")};d.onResponse=this.onResponse};global.Appacitive.HttpRequest=
function(d){d=d||{};this.url=d.url||"";this.data=d.data||{};this.headers=d.headers||[];this.method=d.method||"GET";this.onSuccess=d.onSuccess||function(){};this.onError=d.onError||function(){};this.send=function(d){return new g(this,d)}};(function(d){d.Appacitive&&d.Appacitive.http&&(d.Appacitive.http.addProcessor({pre:function(d){return d},post:function(b,e){try{var g=d.Appacitive.Session.isSessionValid(b);g.status?b&&(b.status&&b.status.code&&("19036"==b.status.code||"421"==b.status.code)||b.code&&
("19036"==b.code||"421"==b.code))?d.Appacitive.Users.logout():d.Appacitive.Session.incrementExpiry():g.isSession&&(null!==d.Appacitive.Session.get()&&d.Appacitive.Session.resetSession(),d.Appacitive.http.send(e))}catch(c){}}}),d.Appacitive.http.addProcessor({pre:function(d){return{start:(new Date).getTime(),request:d}},post:function(d,b){b.request.timeTakenInMilliseconds=(new Date).getTime()-b.start}}))})(global)})(this);
(function(b){b.Appacitive.logs={};var c=function(b,c){setTimeout(function(){try{b.call({},c)}catch(g){}},0)};b.Appacitive.logs.logRequest=function(e,f,g,h){f=f||{};g=g||{};var d={};try{d=JSON.parse(e.data),_type.isObject(d)||(d={})}catch(l){}var k={status:h,referenceId:g.referenceid,date:(new Date).toISOString(),method:d.m,url:decodeURIComponent(e.url),responseTime:e.timeTakenInMilliseconds,headers:{},request:null,response:f,description:e.description};e.headers&&e.headers.forEach(function(d){k.headers[d.key]=
d.value});e.prevHeaders&&e.prevHeaders.forEach(function(d){k.headers[d.key]=d.value});"GET"!==k.method&&(k.request=d.b);"error"==h&&(b.Appacitive.runtime.isBrowser&&console.dir(k),_type.isFunction(b.Appacitive.logs.apiErrorLog)&&c(b.Appacitive.logs.apiErrorLog,k));_type.isFunction(b.Appacitive.logs.apiLog)&&c(b.Appacitive.logs.apiLog,k)};b.Appacitive.logs.logException=function(e){_type.isFunction(b.Appacitive.logs.exceptionLog)&&c(b.Appacitive.logs.exceptionLog,e)}})(global);
(function(b){String.format=function(b,e){if(1>=arguments.length)return b;for(var f=arguments.length-2,g=0;g<=f;g++)b=b.replace(RegExp("\\{"+g+"\\}","gi"),arguments[g+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var e=RegExp("^"+b),f=this;e.test(f)&&(f=f.slice(1,f.length));e=RegExp(b+"$");e.test(f)&&(f=f.slice(0,-1));return f};String.toSearchString=function(b){"undefined"===typeof b&&(b="");for(var e=
"",f=0;f<b.length;f+=1)-1===" .,;#".indexOf(b[f])&&(e+=b[f]);return e=e.toLowerCase()};String.contains=function(b,e){return-1!==b.indexOf(e)};String.startsWith=function(b,e){return 0===b.indexOf(e)};Array.distinct=function(b){var e=[],f=b.length,g,h,d;for(h=0;h<f;h++){g=void 0;for(d=0;d<e.length;d++)if(b[h].toLowerCase()===e[d].toLowerCase()){g=!0;break}g||e.push(b[h])}return e};Object.isEmpty=function(b){if(!b)return!0;var e=!0,f;for(f in b){e=!1;break}return e};b.dateFromWcf=function(b,e){var f=
/Date\(([^)]+)\)/.exec(b);if(2!=f.length){if(!e)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(f[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var c=function(b){"object"===typeof b&&(0<b.length&&("string"===typeof b[0]||"number"===typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.application={applicationServiceUrl:"application",getSessionCreateUrl:function(){return String.format("{0}/session",
this.applicationServiceUrl)}};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(b,f){return String.format("{0}/create?fields={1}",this.userServiceUrl,c(f))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,f,g){return String.format("{0}/{1}?fields={2}",b,f,c(g))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token={1}",
this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",this.userServiceUrl,b)},getUpdateUrl:function(b,f,g){return g?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,b,c(f),g):String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,c(f))},getDeleteUrl:function(b,c,g){return!0===g?String.format("{0}/{1}?deleteconnections=true",this.userServiceUrl,c):String.format("{0}/{1}",this.userServiceUrl,c)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",
this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",
this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,g){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,b,c,g)},getResetPasswordUrl:function(b){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,b)},getValidateResetPasswordUrl:function(b){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,b)}};this.device={deviceServiceUrl:"device",
getCreateUrl:function(b,f){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,c(f))},getGetUrl:function(b,f,g){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,f,c(g))},getUpdateUrl:function(b,f,g){return g?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,b,c(f),g):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,c(f))},getDeleteUrl:function(b,c,g){return!0===g?String.format("{0}/{1}?deleteconnections=true",this.deviceServiceUrl,c):String.format("{0}/{1}",
this.deviceServiceUrl,c)}};this.object={objectServiceUrl:"object",getSearchAllUrl:function(b,c,g){var h="",h=String.format("{0}/search/{1}/all",this.objectServiceUrl,b),h=g?h+"?psize="+g:h+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!==c[b].trim().length&&(h=h+"&"+c[b]);return h},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.objectServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",
this.objectServiceUrl,b,c)},getMultiGetUrl:function(b,f,g){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.objectServiceUrl,b,f,c(g))},getCreateUrl:function(b,f){return String.format("{0}/{1}?fields={2}",this.objectServiceUrl,b,c(f))},getGetUrl:function(b,f,g){return String.format("{0}/{1}/{2}?fields={3}",this.objectServiceUrl,b,f,c(g))},getUpdateUrl:function(b,f,g,h){return h?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.objectServiceUrl,b,f,c(g),h):String.format("{0}/{1}/{2}?fields={3}",
this.objectServiceUrl,b,f,c(g))},getDeleteUrl:function(b,c,g){return!0===g?String.format("{0}/{1}/{2}?deleteconnections=true",this.objectServiceUrl,b,c):String.format("{0}/{1}/{2}",this.objectServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.objectServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,f,g){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,f,c(g))},getMultiGetUrl:function(b,f,g){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.connectionServiceUrl,b,f,c(g))},getCreateUrl:function(b,f){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,c(f))},getUpdateUrl:function(b,f,g,h){return h?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,b,f,c(g),h):String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,f,c(g))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,g,h){var d="",d=String.format("{0}/{1}/find/all?label={2}&objectid={3}",this.connectionServiceUrl,b,g,c);if("undefined"!==typeof h&&0<h.length)for(b=0;b<h.length;b+=1)d=d+"&"+h[b];return d},getConnectedArticles:function(b,c,g){var h="",h=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,b,c);if(g&&g.length&&0<g.length)for(b=0;b<g.length;b+=1)h=0===b?h+("?"+g[b]):h+("&"+g[b]);return h},getInterconnectsUrl:function(){return String.format("{0}/interconnects",
this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,
b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b,c){return c&&0<c.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",this.fileServiceUrl,escape(b),escape(c)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""===location.search||-1===location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(g,h){var d=h.split("="),l=d[1];2<d.length&&d.forEach(function(b,g){0!==b&&1!==b&&(l=l+"="+
d[b])});d[0].toLowerCase()===b&&(c=[d[0],l])}),c):location.search.split("?")[1].split("=")}};this.usergroup={usergroupServiceUrl:"usergroup",getUpdateUrl:function(b){return String.format("{0}/{1}/members",this.usergroupServiceUrl,b)}}}})(global);
(function(b){var c;c=b.Appacitive.runtime.isNode?process.nextTick:setTimeout;var e=function(){if(!(this instanceof e))return new e;this.calls=[]};e.prototype.isResolved=function(){return 1===this.state?!0:!1};e.prototype.isRejected=function(){return 2===this.state?!0:!1};e.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};e.prototype.done=function(){var c,g,h=this.state,d=this.value;if(!h)return this;for(;c=this.calls.shift();)if(g=c[0],"function"===typeof c[h]){try{d=
c[h].apply(g,this.value)}catch(l){b.Appacitive.logs.logException({name:l.name,message:l.message,stack:l.stack});if(0==g.calls.length)throw l;g.reject(l)}d instanceof e||e.is(d)?d.then(function(b){g.fulfill(b)},function(b){g.reject(b)}):1===h?g.fulfill(d):g.reject(d)}else 1===h?g.fulfill(d):g.reject(d)};e.prototype.fulfill=function(){if(this.state)return this;this.state=1;this.value=arguments;this.done();return this};e.prototype.resolve=e.prototype.fulfill;e.prototype.reject=function(){if(this.state)return this;
this.state=2;this.reason=this.value=arguments;this.done();return this};e.prototype.then=function(b,g){var h=this,d=new e;this.calls[this.calls.length]=[d,b,g];this.state&&c(function(){h.done()});return d};e.when=function(b){var g=[],h=[],d,l=0,k=new e;if(!b)return k.fulfill(g),k;var p=function(){l+=1;l==d&&(k.state||(0<h.length?k.reject(h,g?g:[]):k.fulfill(g?g:[])))},m=function(d){var l=b[d];l instanceof e||l&&"function"===typeof l.then?c(function(){l.then(function(b){g[d]=b;p()},function(b){h[d]=
b;p()})}):c(function(){try{g[d]=l.call()}catch(b){h[d]=b}p()})};Array.isArray(b)||(b=[b]);d=b.length;for(var r=0;r<d;r+=1)m(r);return k};e.is=function(b){return b instanceof e?!0:!1};e.buildPromise=function(b){var g=new e;_type.isObject(b)&&g.then(b.success,b.error);return g};e._continueUntil=function(b,g){return _type.isFunction(b)&&b()?g().then(function(){return e._continueUntil(b,g)}):(new e).fulfill()};b.Appacitive.Promise=e})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var e={};this.subscribe=function(f,g){if("string"!=typeof f||"function"!=typeof g)throw Error("Incorrect subscription call");"undefined"==typeof e[f]&&(e[f]=[]);var h=b();e[f].push({callback:g,id:h});return h};this.unsubscribe=function(b){if(!b)return!1;var g=-1,c=null,d;for(d in e)for(var l=0;l<e[d].length;l+=
1)if(e[d][l].id==b){g=l;c=d;break}return-1!=g?(e[c].splice(g,1),!0):!1};this.fire=function(b,g,c){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof c||null===c)c={};c.eventName=b;if("undefined"!=typeof e.all)for(var d=0;d<e.all.length;d+=1)e.all[d].callback(g,c);d=function(b,d,g){setTimeout(function(){b(d,g)},0)};if("undefined"!=typeof e[b])for(var l=0;l<e[b].length;l+=1)d(e[b][l].callback,g,c)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
e[b]&&(e[b].length=0);return this};this.clearAndSubscribe=function(b,g){this.clearSubscriptions(b);this.subscribe(b,g)};this.dump=function(){console.dir(e)}}})(global);
(function(b){var c={},e=Array.prototype.forEach,f=Object.prototype.hasOwnProperty,g=Array.prototype.slice,h=0,d=function(){return{keys:Object.keys,uniqueId:function(b){var d=++h+"";return b?b+d:d},has:function(b,d){return f.call(b,d)},each:function(b,d,g){if(null!=b)if(e&&b.forEach===e)b.forEach(d,g);else if(b.length===+b.length)for(var f=0,l=b.length;f<l&&d.call(g,b[f],f,b)!==c;f++);else for(f in b)if(this.has(b,f)&&d.call(g,b[f],f,b)===c)break},once:function(b){var d=!1,g;return function(){if(d)return g;
d=!0;g=b.apply(this,arguments);b=null;return g}}}}(),l;l={on:function(b,d,g){if(!p(this,"on",b,[d,g])||!d)return this;this._events||(this._events={});(this._events[b]||(this._events[b]=[])).push({callback:d,context:g,ctx:g||this});return this},once:function(b,g,c){if(!p(this,"once",b,[g,c])||!g)return this;var e=this,f=d.once(function(){e.off(b,f);g.apply(this,arguments)});f._callback=g;return this.on(b,f,c)},off:function(b,g,c){var e,f,l,h,k,m,y,B;if(!this._events||!p(this,"off",b,[g,c]))return this;
if(!b&&!g&&!c)return this._events={},this;h=b?[b]:d.keys(this._events);k=0;for(m=h.length;k<m;k++)if(b=h[k],l=this._events[b]){this._events[b]=e=[];if(g||c)for(y=0,B=l.length;y<B;y++)f=l[y],(g&&g!==f.callback&&g!==f.callback._callback||c&&c!==f.context)&&e.push(f);e.length||delete this._events[b]}return this},trigger:function(b){if(!this._events)return this;var d=g.call(arguments,1);if(!p(this,"trigger",b,d))return this;var c=this._events[b],e=this._events.all;c&&m(c,d);e&&m(e,arguments);return this},
stopListening:function(b,d,g){var c=this._listeners;if(!c)return this;var e=!d&&!g;"object"===typeof d&&(g=this);b&&((c={})[b._listenerId]=b);for(var f in c)c[f].off(d,g,this),e&&delete this._listeners[f];return this}};var k=/\s+/,p=function(b,d,g,c){if(!g)return!0;if("object"===typeof g){for(var e in g)b[d].apply(b,[e,g[e]].concat(c));return!1}if(k.test(g)){g=g.split(k);e=0;for(var f=g.length;e<f;e++)b[d].apply(b,[g[e]].concat(c));return!1}return!0},m=function(b,d){var g,c=-1,e=b.length,f=d[0],l=
d[1],p=d[2];switch(d.length){case 0:for(;++c<e;)(g=b[c]).callback.call(g.ctx);break;case 1:for(;++c<e;)(g=b[c]).callback.call(g.ctx,f);break;case 2:for(;++c<e;)(g=b[c]).callback.call(g.ctx,f,l);break;case 3:for(;++c<e;)(g=b[c]).callback.call(g.ctx,f,l,p);break;default:for(;++c<e;)(g=b[c]).callback.apply(g.ctx,d)}};d.each({listenTo:"on",listenToOnce:"once"},function(b,g){l[g]=function(g,c,e){var f=this._listeners||(this._listeners={}),l=g._listenerId||(g._listenerId=d.uniqueId("l"));f[l]=g;"object"===
typeof c&&(e=this);g[b](c,e,this);return this}});l.bind=l.on;l.unbind=l.off;l.mixin=function(b){d.each("on once off trigger stopListening listenTo listenToOnce bind unbind".split(" "),function(d){b[d]=this[d]},this);return b};b.Appacitive.Events=l})(global);
(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/v1.0/",metadata:!0};!b.navigator||-1==b.navigator.userAgent.indexOf("MSIE 8")&&-1==b.navigator.userAgent.indexOf("MSIE 9")||(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/v1.0/")})(global);
(function(b){var c=function(c){var f;if(!c||!_type.isObject(c))throw Error("Please specify request options");this.promise=b.Appacitive.Promise.buildPromise(c.options);var g=this.request=new b.Appacitive.HttpRequest;f=b.Appacitive.storage.urlFactory[c.type];var h=c.op.replace("get","").replace("Url","")+" "+c.type;f=b.Appacitive.config.apiBaseUrl+f[c.op].apply(f,c.args||[]);g.url=f;g.description=h;g.method=c.method||"get";g.data=c.data||{};g.onSuccess=c.onSuccess;g.onError=c.onError;g.promise=this.promise;
g.options=c.options;c.entity&&(g.entity=c.entity);return this};c.prototype.send=function(){return b.Appacitive.http.send(this.request)};b.Appacitive._Request=c})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var c=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},e=null,f=null,g=null,h=!1,d;this.useApiKey=!0;this.useMasterKey=!1;this.onSessionCreated=function(){};this.recreate=function(d){return b.Appacitive.Session.create(d)};this.create=function(d){if(!this.initialized)throw Error("Intialize Appacitive SDK");var g=new c;g.apikey=f;var l=new b.Appacitive._Request({method:"PUT",type:"application",
op:"getSessionCreateUrl",options:d,data:g,onSuccess:function(d){e=d.session.sessionkey;b.Appacitive.Session.useApiKey=!1;l.promise.fulfill(d);b.Appacitive.Session.onSessionCreated()}});return l.send()};b.Appacitive.http.addProcessor({pre:function(c){c.options=c.options||{};if(b.Appacitive.Session.useApiKey){var l=f;(c.options.useMasterKey||b.Appacitive.useMasterKey&&!c.options.useMasterKey)&&_type.isString(d)&&0<d.length?l=d:_type.isString(c.options.apikey)&&(l=c.options.apikey);c.headers.push({key:"ak",
value:l})}else c.headers.push({key:"as",value:e});if(!0===h){var m=-1,l=c.headers.filter(function(b,d){return"ut"==b.key?(m=d,!0):!1});if(c.options.ignoreUserToken)-1!=m&&c.headers.splice(m,1);else{var r=g;_type.isString(c.options.userToken)&&0<c.options.userToken.length&&(r=c.options.userToken);1==l.length?c.headers.forEach(function(b){"ut"==b.key&&(b.value=r)}):c.headers.push({key:"ut",value:r})}}}});this.setUserAuthHeader=function(d,c,e){try{d&&(h=!0,g=d,e||(c||(c=-1),-1==c&&(c=null),b.Appacitive.localStorage.set("Appacitive-UserToken",
d),b.Appacitive.localStorage.set("Appacitive-UserTokenExpiry",c),b.Appacitive.localStorage.set("Appacitive-UserTokenDate",(new Date).getTime())))}catch(f){}};this.incrementExpiry=function(){try{b.Appacitive.runtime.isBrowser&&h&&b.Appacitive.localStorage.set("Appacitive-UserTokenDate",(new Date).getTime())}catch(d){}};this.removeUserAuthHeader=function(d,c){var e=b.Appacitive.Promise.buildPromise(c);d||b.Appacitive.User.trigger("logout",{});b.Appacitive.localStorage.remove("Appacitive-User");if(g&&
d)try{var f=new b.Appacitive.HttpRequest(c);f.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(g);f.method="POST";f.data={};f.type="user";f.options=c;f.description="InvalidateToken user";f.onSuccess=f.onError=function(){h=!1;g=null;b.Appacitive.User.trigger("logout",{});b.Appacitive.localStorage.remove("Appacitive-UserToken");b.Appacitive.localStorage.remove("Appacitive-UserTokenExpiry");b.Appacitive.localStorage.remove("Appacitive-UserTokenDate");e.fulfill()};
b.Appacitive.http.send(f);return e}catch(l){}else return h=!1,g=null,b.Appacitive.localStorage.remove("Appacitive-UserToken"),b.Appacitive.localStorage.remove("Appacitive-UserTokenExpiry"),b.Appacitive.localStorage.remove("Appacitive-UserTokenDate"),e.fulfill()};this.isSessionValid=function(b){if(b.status){if(b.status.code&&("420"==b.status.code||"19027"==b.status.code||"19002"==b.status.code))return{status:!1,isSession:"19027"==b.status.code||"420"==b.status.code?!0:!1}}else if(b.code&&("420"==b.code||
"19027"==b.code||"19002"==b.code))return{status:!1,isSession:"19027"==b.code||"420"==b.code?!0:!1};return{status:!0}};this.resetSession=function(){e=null;this.useApiKey=!0};this.get=function(){return e};this.setSession=function(b){b&&(e=b,this.useApiKey=!1)};this.setApiKey=function(b){b&&(f=b,this.useApiKey=!0)};this.setMasterKey=function(b){d=b};this.reset=function(){this.removeUserAuthHeader();g=f=e=null;h=!1;d=null;this.useMasterKey=this.useApiKey=this.initialized=!1};var l="sandbox";this.environment=
function(){if(1==arguments.length){var b=arguments[0];"sandbox"!=b&&"live"!=b&&(b="sandbox");l=b}return l}};b.Appacitive.getAppPrefix=function(c){return b.Appacitive.Session.environment()+"/"+b.Appacitive.appId+"/"+c};b.Appacitive.initialize=function(c){c=c||{};if(!b.Appacitive.Session.initialized){c.masterKey&&0<c.masterKey.length&&b.Appacitive.Session.setMasterKey(c.masterKey);if(!c.apikey||0===c.apikey.length)if(c.masterKey)c.apikey=c.masterKey;else throw Error("apikey is mandatory");if(!c.appId||
0===c.appId.length)throw Error("appId is mandatory");b.Appacitive.Session.setApiKey(c.apikey);b.Appacitive.Session.environment(c.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.appId=c.appId;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=c.persistUserToken;c.debug&&(b.Appacitive.config.debug=!0);_type.isFunction(c.apiLog)&&(b.Appacitive.logs.apiLog=c.apiLog);_type.isFunction(c.apiErrorLog)&&(b.Appacitive.logs.apiErrorLog=c.apiErrorLog);_type.isFunction(c.exceptionLog)&&
(b.Appacitive.logs.exceptionLog=c.exceptionLog);if(c.userToken)if(-1==c.expiry?c.expiry=null:c.expiry||(c.expiry=3600),b.Appacitive.Session.setUserAuthHeader(c.userToken,c.expiry),c.user)b.Appacitive.Users.setCurrentUser(c.user);else{var e=b.Appacitive.localStorage.get("Appacitive-User");e&&b.Appacitive.Users.setCurrentUser(e)}else if(b.Appacitive.runtime.isBrowser&&(c=b.Appacitive.localStorage.get("Appacitive-UserToken"))){var f=b.Appacitive.localStorage.get("Appacitive-UserTokenExpiry"),e=b.Appacitive.localStorage.get("Appacitive-UserTokenDate");
f||(f=-1);e&&0<f&&new Date(e+1E3*f)<new Date||(-1==f&&(f=null),(e=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(e,c,f))}}};b.Appacitive.reset=function(){b.Appacitive.Session.reset()}})(global);(function(b){b.Appacitive&&b.Appacitive.http&&(b.Appacitive.http.addProcessor({pre:function(c){var e=b.Appacitive.Session.environment();c.options=c.options||{};_type.isString(c.options.env)&&(e=c.options.env);c.headers.push({key:"e",value:e})}}),b.Appacitive.Events.mixin(b.Appacitive))})(global);
(function(b){var c=b.Appacitive;c.GeoCoord=function(b,d){var g=function(b,d){if(isNaN(b)||isNaN(d))throw Error("Invalid Latitiude or longitiude provided");if(-90>b||90<b)throw Error("Latitude "+b+" should be in range of  -90.0 to 90.");if(-180>d||180<d)throw Error("Latitude "+d+" should be in range of  -180.0 to 180.");},e=function(b){if("string"!==typeof b||0==b.length)return!1;b=b.split(",");if(2!==b.length)return!1;try{return new c.GeoCoord(b[0],b[1])}catch(d){return!1}};if(_type.isString(b)&&
!d&&(e=e(b)))return e;b&&d?(g(b,d),this.lat=b,this.lng=d):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",b,d)};this.toString=function(){return this.getValue()}};var e=function(){this.toString=function(){};this.Or=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new p(m.or,b)};this.And=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new p(m.and,
b)}},f=function(b){e.call(this);b=b||{};this.fieldType=b.fieldType;this.field=b.field||"";this.value=b.value;this.operator=b.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue())}};f.prototype=new e;f.prototype.constructor=f;var g=function(b){b=b||"";
if(!_type.isArray(b.value)||!b.value.length)throw Error("Specify field value as array");f.call(this,b);this.toString=function(){for(var b=[],d=0;d<this.value.length;d+=1)b.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,_type.isString(this.value[d])?"'"+this.value[d]+"'":_type.isNumber(this.value[d])?this.value[d]:this.value[d].toString()));return"("+b.join(" or ")+")"}};g.prototype=new f;g.prototype.constructor=g;var h=function(b){b=b||"";if(!b.val1)throw Error("Specify field value1 ");
if(!b.val2)throw Error("Specify field value2 ");this.val1=b.val1;this.val2=b.val2;f.call(this,b);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};h.prototype=new f;h.prototype.constructor=h;var d=function(b){b=b||"";if(!(b.geoCoord&&b.geoCoord instanceof c.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");f.call(this,
b);this.value=b.geoCoord;this.unit=b.unit||"mi";this.distance=b.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};d.prototype=new f;d.prototype.constructor=h;var l=function(b){b=b||"";if(!b.geoCoords||0===b.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");if(3>b.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");
f.call(this,b);this.value=b.geoCoords;var d=function(b){var d="";b.forEach(function(b){d=0===d.length?b.toString():d+(" | "+b.toString())});return d};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,d(this.value))}};l.prototype=new f;l.prototype.constructor=h;var k=function(b){e.call(this);b=b||{};if(!b.tags||!_type.isArray(b.tags)||0===b.tags.length)throw Error("Specify valid tags");this.tags=b.tags;this.operator=b.operator;
this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};k.prototype=new e;k.prototype.constructor=k;var p=function(b,d){if(!d||!d.length||2>d.length)throw Error("Provide valid or atleast 2 filters");this.operator=b;this.innerFilters=[];for(var g=0;g<d.length;g+=1){if(!(d[g]instanceof e))throw Error("Invalid filter provided");this.innerFilters.push(d[g])}this.toString=function(){var b=this.operator,d="(";this.innerFilters.forEach(function(g){d=1===d.length?d+
(" "+g.toString()):d+String.format(" {0} {1} ",b,g.toString())});return d+=")"}};p.prototype=new e;p.prototype.constructor=p;var m={isEqualTo:"==",isGreaterThan:">",isGreaterThanEqualTo:">=",isLessThan:"<",isLessThanEqualTo:"<=",like:"like",match:"match",between:"between",withinCircle:"within_circle",withinPolygon:"within_polygon",or:"or",and:"and",taggedWithAll:"tagged_with_all",taggedWithOneOrMore:"tagged_with_one_or_more"},r=function(b,d){if(null===b||void 0===b||0===b.length)throw Error("Specify value");
this.value=b;this.type=d?d:typeof this.value;if("number"===this.type&&!_type.isNumeric(this.value))throw Error("Value should be numeric for filter expression");this.getValue=function(){return"string"===this.type?"'"+this.value+"'":"number"===this.type||_type.isBoolean(this.value)?this.value:"object"===this.type&&this.value instanceof date?"datetime('"+c.Date.toISOString(this.value)+"')":this.value.toString()}},q=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"date('"+
c.Date.toISODate(this.value)+"')":"date('"+this.value+"')"}},u=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"time('"+c.Date.toISOTime(this.value)+"')":"time('"+this.value+"')"}},t=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"datetime('"+c.Date.toISOString(this.value)+"')":"datetime('"+this.value+"')"}},v=function(b,c,e){e||(e=this);e.type=b;e.name=c;e.equalTo=function(b){return new f({field:this.name,fieldType:this.type,
value:new r(b),operator:m.isEqualTo})};e.equalToNumber=function(b){return new f({field:this.name,fieldType:this.type,value:new r(b,"number"),operator:m.isEqualTo})};e.equalToDate=function(b){return new f({field:this.name,fieldType:this.type,value:new q(b),operator:m.isEqualTo})};e.equalToTime=function(b){return new f({field:this.name,fieldType:this.type,value:new u(b),operator:m.isEqualTo})};e.equalToDateTime=function(b){return new f({field:this.name,fieldType:this.type,value:new t(b),operator:m.isEqualTo})};
e.greaterThan=function(b){return new f({field:this.name,fieldType:this.type,value:new r(b,"number"),operator:m.isGreaterThan})};e.greaterThanDate=function(b){return new f({field:this.name,fieldType:this.type,value:new q(b),operator:m.isGreaterThan})};e.greaterThanTime=function(b){return new f({field:this.name,fieldType:this.type,value:new u(b),operator:m.isGreaterThan})};e.greaterThanDateTime=function(b){return new f({field:this.name,fieldType:this.type,value:new t(b),operator:m.isGreaterThan})};
e.greaterThanEqualTo=function(b){return new f({field:this.name,fieldType:this.type,value:new r(b,"number"),operator:m.isGreaterThanEqualTo})};e.greaterThanEqualToDate=function(b){return new f({field:this.name,fieldType:this.type,value:new q(b),operator:m.isGreaterThanEqualTo})};e.greaterThanEqualToTime=function(b){return new f({field:this.name,fieldType:this.type,value:new u(b),operator:m.isGreaterThanEqualTo})};e.greaterThanEqualToDateTime=function(b){return new f({field:this.name,fieldType:this.type,
value:new t(b),operator:m.isGreaterThanEqualTo})};e.lessThan=function(b){return new f({field:this.name,fieldType:this.type,value:new r(b,"number"),operator:m.isLessThan})};e.lessThanDate=function(b){return new f({field:this.name,fieldType:this.type,value:new q(b),operator:m.isLessThan})};e.lessThanTime=function(b){return new f({field:this.name,fieldType:this.type,value:new u(b),operator:m.isLessThan})};e.lessThanDateTime=function(b){return new f({field:this.name,fieldType:this.type,value:new t(b),
operator:m.isLessThan})};e.lessThanEqualTo=function(b){return new f({field:this.name,fieldType:this.type,value:new r(b,"number"),operator:m.isLessThanEqualTo})};e.lessThanEqualToDate=function(b){return new f({field:this.name,fieldType:this.type,value:new q(b),operator:m.isLessThanEqualTo})};e.lessThanEqualToTime=function(b){return new f({field:this.name,fieldType:this.type,value:new u(b),operator:m.isLessThanEqualTo})};e.lessThanEqualToDateTime=function(b){return new f({field:this.name,fieldType:this.type,
value:new t(b),operator:m.isLessThanEqualTo})};e.like=function(b){return new f({field:this.name,fieldType:this.type,value:new r("*"+b+"*"),operator:m.like})};e.match=function(b){return new f({field:this.name,fieldType:this.type,value:new r("*"+b+"*"),operator:m.match})};e.startsWith=function(b){return new f({field:this.name,fieldType:this.type,value:new r(b+"*"),operator:m.like})};e.endsWith=function(b){return new f({field:this.name,fieldType:this.type,value:new r("*"+b),operator:m.like})};e.contains=
function(b){return new g({field:this.name,fieldType:this.type,value:b,operator:m.isEqualTo})};e.between=function(b,d){return new h({field:this.name,fieldType:this.type,val1:new r(b,"number"),val2:new r(d,"number"),operator:m.between})};e.betweenDate=function(b,d){return new h({field:this.name,fieldType:this.type,val1:new q(b),val2:new q(d),operator:m.between})};e.betweenTime=function(b,d){return new h({field:this.name,fieldType:this.type,val1:new u(b),val2:new u(d),operator:m.between})};e.betweenDateTime=
function(b,d){return new h({field:this.name,fieldType:this.type,val1:new t(b),val2:new t(d),operator:m.between})};e.withinCircle=function(b,g,c){return new d({field:this.name,fieldType:this.type,geoCoord:b,distance:g,unit:c,operator:m.withinCircle})};e.withinPolygon=function(b){return new l({field:this.name,fieldType:this.type,geoCoords:b,operator:m.withinPolygon})}},z=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;v("property",b,this);return this},w=function(b){if(!b||
0===b.length)throw Error("Specify field name");this.field=b;var d=new v("aggregate",b);this.equalTo=function(b){return d.equalTo(b)};this.greaterThan=function(b){return d.greaterThan(b)};this.greaterThanEqualTo=function(b){return d.greaterThanEqualTo(b)};this.lessThan=function(b){return d.lessThan(b)};this.lessThanEqualTo=function(b){return d.lessThanEqualTo(b)};this.between=function(b,g){return d.between(b,g)};return this},n=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=
b;var d=new v("attribute",b);this.like=function(b){return d.like(b)};this.like=function(b){return d.match(b)};this.startWith=function(b){return d.startsWith(b)};this.endsWith=function(b){return d.endsWith(b)};this.equalTo=function(b){return d.equalTo(b)};this.contains=function(b){return d.contains(b)};return this};c.Filter={Property:function(b){return new z(b)},Aggregate:function(b){return new w(b)},Attribute:function(b){return new n(b)},Or:function(){return new p(m.or,arguments)},And:function(){return new p(m.and,
arguments)},taggedWithOneOrMore:function(b){return new k({tags:b,operator:m.taggedWithOneOrMore})},taggedWithAll:function(b){return new k({tags:b,operator:m.taggedWithAll})}}})(global);
(function(b){b.Appacitive.Queries={};var c=function(b){b=b||{};var c=1,d=20;this.pageNumber=function(){return 1==arguments.length?(c=arguments[0]||1,this):c};this.pageSize=function(){return 1==arguments.length?(d=arguments[0]||20,this):d};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};c.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var e=function(b){b=b||{};var c=null,d=!1;this.orderBy=function(){return 1===arguments.length&&_type.isString(arguments[0])?
(c=arguments[0],this):c};this.isAscending=function(){return 1===arguments.length?(d=void 0===arguments[0]||null==arguments[0]?!1:arguments[0],this):d};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};e.prototype.toString=function(){return this.orderBy()&&0<this.orderBy().length?"orderBy="+this.orderBy()+"&isAsc="+this.isAscending():""};var f=function(g){var f=g||{},d="",l="",k="",p=f.queryType||"BasicQuery",m=new c(g),r=new e(g),q=f.type||f.relation,u=f.relation?"connection":"object",t=this;
f.entity&&(this.entity=f.entity);this.type=function(){return u};this.entityType=function(){return q};this.queryType=function(){return p};this.pageQuery=function(){return m};this.pageNumber=function(){return 1===arguments.length?(m.pageNumber(arguments[0]),this):m.pageNumber()};this.pageSize=function(){return 1===arguments.length?(m.pageSize(arguments[0]),this):m.pageSize()};this.sortQuery=function(){return r};this.orderBy=function(){return 1===arguments.length?(r.orderBy(arguments[0]),this):r.orderBy()};
this.isAscending=function(){return 1===arguments.length?(r.isAscending(arguments[0]),this):r.isAscending()};this.filter=function(){return 1===arguments.length?(d=arguments[0],this):d};this.freeText=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?l=arguments[0]:_type.isArray(b)&&b.length&&(l=arguments[0].join(" "));return this}return l};this.fields=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?k=b:_type.isArray(b)&&b.length&&(k=b.join(","));return this}return k};
this.filter(f.filter||"");this.freeText(f.freeText||"");this.fields(f.fields||"");this.setFilter=function(b){this.filter(b)};this.setFreeText=function(b){this.freeText(b)};this.setFields=function(b){this.fields(b)};this.extendOptions=function(b){for(var d in b)f[d]=b[d];m=new c(f);r=new e(f);return this};this.getQueryString=function(){var b=m.toString(),d=r.toString();d&&(b+="&"+d);this.filter()&&(d=encodeURIComponent(this.filter().toString()),0<d.trim().length&&(b+="&query="+d));this.freeText()&&
0<this.freeText().trim().length&&(b+="&freetext="+encodeURIComponent(this.freeText())+"&language=en");this.fields()&&0<this.fields().trim().length&&(b+="&fields="+this.fields());return b};this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+u+"/"+q+"/find/all?"+this.getQueryString(),description:"FindAll "+q+" "+u+"s"}};this.toRequest=function(d){var c=new b.Appacitive.HttpRequest,g=this.toUrl();c.url=g.url;c.options=d;c.description=g.description;c.method="get";return c};this.getOptions=
function(){var b={},d;for(d in this)this.hasOwnProperty(d)&&!_type.isFunction(this[d])&&(b[d]=this[d]);return b};this._setPaging=function(b){b&&(m.pageNumber(b.pagenumber),m.pageSize(b.pagesize),this.results=this.results||[],this.results.isLastPage=!1,this.results.total=b.totalrecords,this.results.pageNumber=b.pagenumber,this.results.pageSize=b.pagesize,b.pagenumber*b.pagesize>=b.totalrecords&&(this.results.isLastPage=!0))};this.fetch=function(d){var c=b.Appacitive.Promise.buildPromise(d);d=this.toRequest(d);
d.onSuccess=function(d){var g;(g=d[u+"s"])||(g=[]);g=b.Appacitive["object"===u?"Object":"Connection"]._parseResult(g,f.entity,d.__meta);t.results=g;t._setPaging(d.paginginfo);c.fulfill(t.results,d.paginginfo)};d.promise=c;d.entity=this;return b.Appacitive.http.send(d)};this.collection=function(d,c){c=c||{};_type.isObject(d)&&(c=d,d=null);d||(d=this.results?this.results:[]);var g=f.entity;!g&&(0<d.length&&d[0]instanceof b.Appacitive.BaseObject)&&(g="object"==d[0].type?"Object":"Connection",g=b.Appacitive[g]._getClass(d[0].className));
g||(g="object"===u?"Object":"Connection",g=b.Appacitive[g]._getClass(this[g]));return new Appacitive.Collection(d,_extend(c,{model:g,query:this}))};this.fetchNext=function(b){var d=this.pageNumber();this.pageNumber(++d);return this.fetch(b)};this.fetchPrev=function(b){var d=this.pageNumber(),d=d-1;0>=d&&(d=1);this.pageNumber(d);return this.fetch(b)};this.count=function(d){var g=b.Appacitive.Promise.buildPromise(d);d=this.toRequest(d);d.onSuccess=function(b){b=b||{};b=b.paginginfo;var d=0,d=b?b.totalrecords:
0;g.fulfill(d)};d.promise=g;d.entity=this;return b.Appacitive.http.send(d)}};b.Appacitive.Query=f;b.Appacitive.Queries.FindAllQuery=function(b){b=b||{};if(!b.type&&!b.relation)throw Error("Specify either type or relation for basic filter query");b.queryType="FindAllQuery";f.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new f;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedObjectsQuery=function(c){c=c||
{};if(!c.relation)throw Error("Specify relation for connected objects query");if(!c.objectId)throw Error("Specify objectId for connected objects query");if(!c.type)throw Error("Specify type of object id for connected objects query");var e=c.type;delete c.type;c.queryType="ConnectedObjectsQuery";f.call(this,c);this.objectId=c.objectId;this.relation=c.relation;this.type=e;c.object instanceof b.Appacitive.Object&&(this.object=c.object);this.returnEdge=!0;void 0===c.returnEdge||(null===c.returnEdge||
c.returnEdge||this.prev)||(this.returnEdge=!1);this.label="";var d=this;_type.isString(c.label)&&0<c.label.length&&(this.label="&label="+c.label);this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.type+"/"+this.objectId+"/find?"+this.getQueryString()+this.label+"&returnEdge="+this.returnEdge,description:"GetConnectedObjects for relation "+this.relation+" of type "+this.type+" for object "+this.objectId}};var l=function(c,g,e,f){var l=[];c.forEach(function(d){var c=
d.__edge;delete d.__edge;var h=b.Appacitive.Object._create(_extend({__meta:e},d),!0);c&&(c.__endpointa=g,c.__endpointb={objectid:d.__id,label:c.__label,type:d.__type},delete c.label,h.connection=b.Appacitive.Connection._create(_extend({__meta:f},c),!0));l.push(h)});d.object&&(d.object.children[d.relation]=l);return l};this.fetch=function(f){var p=b.Appacitive.Promise.buildPromise(f);f=this.toRequest(f);f.onSuccess=function(b){d.results=l(b.nodes?b.nodes:[],{objectid:c.objectId,type:e,label:b.parent},
b.__nodemeta,b.__edgemeta);d._setPaging(b.paginginfo);p.fulfill(d.results,b.paginginfo)};f.promise=p;f.entity=this;return b.Appacitive.http.send(f)};return this};b.Appacitive.Queries.ConnectedObjectsQuery.prototype=new f;b.Appacitive.Queries.ConnectedObjectsQuery.prototype.constructor=b.Appacitive.Queries.ConnectedObjectsQuery;b.Appacitive.Queries.GetConnectionsQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!c.objectId)throw Error("Specify objectId for GetConnectionsQuery query");
if(!c.label||0===c.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");c.type&&delete c.type;c.queryType="GetConnectionsQuery";f.call(this,c);this.objectId=c.objectId;this.relation=c.relation;this.label=c.label;this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?"+this.getQueryString()+"&objectid="+this.objectId+"&label="+this.label,description:"FindAllConnections for relation "+this.relation+" from object id "+this.objectId}};
return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new f;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery=function(c,e){c=c||{};delete c.entity;if(!c.objectAId||!_type.isString(c.objectAId)||0===c.objectAId.length)throw Error("Specify valid objectAId for GetConnectionsBetweenObjectsQuery query");if(!c.objectBId||!_type.isString(c.objectBId)||0===c.objectBId.length)throw Error("Specify objectBId for GetConnectionsBetweenObjectsQuery query");
c.type&&delete c.type;c.queryType=e||"GetConnectionsBetweenObjectsQuery";f.call(this,c);this.objectAId=c.objectAId;this.objectBId=c.objectBId;this.label="GetConnectionsBetweenObjectsForRelationQuery"===this.queryType()&&c.label&&_type.isString(c.label)&&0<c.label.length?"&label="+c.label:"";this.relation=c.relation&&_type.isString(c.relation)&&0<c.relation.length?c.relation+"/":"";this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.objectAId+"/"+
this.objectBId+"?"+this.getQueryString()+this.label,description:"FindConnectionBetween for relation "+this.relation+" between object ids "+this.objectAId+" and "+this.objectBId}};return this};b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery.prototype=new f;b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery;b.Appacitive.Queries.GetConnectionsBetweenObjectsForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenObjectsForRelationQuery query");
var e=new b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery(c,"GetConnectionsBetweenObjectsForRelationQuery");e.fetch=function(d){var f=b.Appacitive.Promise.buildPromise(d);d=this.toRequest(d);d.onSuccess=function(d){e.results=d.connection?[b.Appacitive.Connection._create(_extend({__meta:d.__meta},d.connection),!0,c.entity)]:null;f.fulfill(e.results?e.results[0]:null)};d.promise=f;d.entity=this;return b.Appacitive.http.send(d)};return e};b.Appacitive.Queries.InterconnectsQuery=function(c){c=
c||{};delete c.entity;if(!c.objectAId||!_type.isString(c.objectAId)||0===c.objectAId.length)throw Error("Specify valid objectAId for InterconnectsQuery query");if(!(c.objectBIds&&_type.isArray(c.objectBIds)&&0<c.objectBIds.length))throw Error("Specify list of objectBIds for InterconnectsQuery query");c.type&&delete c.type;c.queryType="InterconnectsQuery";f.call(this,c);this.objectAId=c.objectAId;this.objectBIds=c.objectBIds;this.toRequest=function(c){var d=new b.Appacitive.HttpRequest,g=this.toUrl();
d.url=g.url;d.options=c;d.description=g.description;d.method="post";d.data={object1id:this.objectAId,object2ids:this.objectBIds};return d};this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString(),description:"GetInterConnections between objects"}};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new f;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphQuery=
function(c,e){if(!c||0===c.length)throw Error("Specify name of filter query");this.name=c;this.data={};this.queryType="GraphFilterQuery";if(e){this.data.placeholders=e;for(var d in this.data.placeholders)this.data.placeholders[d]=this.data.placeholders[d]}this.toRequest=function(d){var c=new b.Appacitive.HttpRequest,g=this.toUrl();c.url=g.url;c.options=d;c.description=g.description;c.method="post";c.data=this.data;return c};this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"search/"+
this.name+"/filter",description:"Filter Query with name "+this.name}};this.fetch=function(d){var c=b.Appacitive.Promise.buildPromise(d);d=this.toRequest(d);d.onSuccess=function(b){c.fulfill(b.ids?b.ids:[])};d.promise=c;d.entity=this;return b.Appacitive.http.send(d)}};b.Appacitive.Queries.GraphAPI=function(c,e,d){if(!c||0===c.length)throw Error("Specify name of project query");if(!e||!e.length)throw Error("Specify ids to project");this.name=c;this.data={ids:e};this.queryType="GraphProjectQuery";var f=
this;if(d){this.data.placeholders=d;for(var k in this.data.placeholders)this.data.placeholders[k]=this.data.placeholders[k]}this.toRequest=function(d){var c=new b.Appacitive.HttpRequest,g=this.toUrl();c.url=g.url;c.description=g.description;c.method="post";c.data=this.data;c.options=d;return c};this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project",description:"Project Query with name "+this.name}};var p=function(d){var c,g;for(g in d)if("status"!==g){c=d[g];
break}var e=function(d,c,g,f,l){var p=[];d.forEach(function(d){var h=d.__children;delete d.__children;var m=d.__edge;delete d.__edge;d=b.Appacitive.Object._create(_extend({__meta:f},d),!0);d.children={};for(var q in h)d.children[q]=[],d.children[q]=e(h[q].values,h[q].parent,d.id,h[q].__nodemeta,h[q].__edgemeta);m&&(m.__endpointa={objectid:g,label:c},m.__endpointb={objectid:d.id,label:m.__label},delete m.__label,d.connection=b.Appacitive.Connection._create(_extend({__meta:l},m),!0));p.push(d)});return p};
return e(c.values,null,null,c.__nodemeta)};this.collection=function(d,c){c=c||{};_type.isObject(d)&&(c=d,d=null);d||(d=this.results?ths.results:[]);var g;0<d.length&&d[0]instanceof b.Appacitive.BaseObject&&(g=b.Appacitive.Object._getClass(d[0].className));return new Appacitive.Collection(d,_extend(c,{model:g,query:this}))};this.fetch=function(d){var c=b.Appacitive.Promise.buildPromise(d);d=this.toRequest(d);d.onSuccess=function(b){f.results=p(b);c.fulfill(f.results)};d.promise=c;d.entity=this;return b.Appacitive.http.send(d)}}})(global);
var ArrayProto=Array.prototype,ObjectProto=Object.prototype,each=function(b,c,e){if(null!=b)if(ArrayProto.forEach&&b.forEach===ArrayProto.forEach)b.forEach(c,e);else if(b.length===+b.length)for(var f=0,g=b.length;f<g&&c.call(e,b[f],f,b)!=={};f++);else for(f in b)if(ObjectProto.hasOwnProperty.call(b,f)&&c.call(e,b[f],f,b)==={})break},_extend=function(b){each(ArrayProto.slice.call(arguments,1),function(c){if(c)for(var e in c)b[e]=c[e]});return b},extend=function(b,c){var e=this,f;f=_type.isObject(b)&&
b.hasOwnProperty("constructor")?b.constructor:function(){return e.apply(this,arguments)};_extend(f,e,c);var g=function(){this.constructor=f};g.prototype=e.prototype;f.prototype=new g;b&&_extend(f.prototype,b);f.__super__=e.prototype;return f};(function(b){b.Appacitive._extend=function(b,e,f){return extend.apply(b,[e,f])}})(global);
(function(b){var c=b.Appacitive,e=["__link","__endpointa","__endpointb"],f={__utcdatecreated:"datetime",__utclastupdateddate:"datetime"},g=function(b){return _type.isString(b)||_type.isNumber(b)||_type.isBoolean(b)||_type.isDate(b)||b instanceof c.GeoCoord},h=function(b){b=b||{};var d={},c;for(c in b.__meta)b.__meta[c].forEach(function(b){d[b]=c});return d},d={integer:function(b){if(b){var d=parseInt(b);if(!isNaN(d))return d}return b},decimal:function(b){if(b){var d=parseFloat(b);if(!isNaN(d))return d}return b},
"boolean":function(b){return _type.isBoolean(b)?b:void 0!==b&&null!==b&&("true"===b.toString().toLowerCase()||!0===b||0<b)?!0:!1},date:function(d){if(_type.isDate(d))return d;if(d){var c=b.Appacitive.Date.parseISODate(d);if(c)return c}return d},datetime:function(d){if(_type.isDate(d))return d;if(d){var c=b.Appacitive.Date.parseISODate(d);if(c)return c}return d},time:function(d){if(_type.isDate(d))return d;if(d){var c=b.Appacitive.Date.parseISOTime(d);if(c)return c}return d},string:function(b){return b?
b.toString():b},geocode:function(d){if(d instanceof c.GeoCoord)return d;if(!_type.isString(d)||0==d.trim().length)return!1;d=d.split(",");return 2!==d.length?!1:new b.Appacitive.GeoCoord(d[0],d[1])}};d["long"]=d.integer;d.geography=d.geocode;d.text=d.string;d.bool=d["boolean"];b.Appacitive.cast=d;var l=function(d){return _type.isNullOrUndefined(d)?null:_type.isString(d)||_type.isNumber(d)||_type.isBoolean(d)?d+"":_type.isDate(d)?b.Appacitive.Date.toISOString(d):_type.isObject(d)?d instanceof c.GeoCoord?
d.toString():d.toJSON?d.toJSON():d:d};b.Appacitive._encode=function(b){var d={},c;for(c in b){var g=b[c];_type.isArray(g)?(d[c]=[],g.forEach(function(b){(b=l(b))&&d[c].push(b)})):d[c]=l(b[c])}return d};b.Appacitive._decode=function(b){var c={},g=_extend({},f,h(b));delete b.__meta;for(var e in b)_type.isArray(b[e])?(c[e]=[],b[e].forEach(function(b){b=g[e]?d[g[e]](b):b;c[e].push(b)})):_type.isString(b[e])?c[e]=g[e]?d[g[e]](b[e]):b[e]:c[e]=b[e];return c};var k=function(f,l){var h={};l=l||{};f=f||{};
this.meta={};f.__meta=_extend(this.meta,f.__meta);l&&l.parse&&(f=this.parse(f));_type.isObject(this.defaults)&&!l.setSnapShot&&(f=_extend({},this.defaults,f));l&&l.collection&&(this.collection=l.collection);f=c._decode(f);var k=this,u=function(b,d){b.__meta=_extend(k.meta,b.__meta);k.meta=b.__meta;var e=c._decode(b),f;for(f in e)f==k.idAttribute&&(k.id=e[f]),t[f]&&delete t[f],v[f]&&delete v[f],z[f]&&delete z[f],g(e[f])?d[f]=e[f]:_type.isObject(e[f])?d[f]=_extend({},d[f],e[f]):_type.isArray(e[f])?
(d[f]=[],e[f].forEach(function(b){if(g(b)||"__link"==f)d[f].push(b);else throw Error("Multivalued property cannot add object or array as property of object");})):d[f]=e[f]};this.base=b.Appacitive.Object.prototype;this.cid=parseInt(1E8*Math.random(),10);this.idAttribute="__id";var t={},v={},z={},w={};u(f,w);var n=w;l.setSnapShot&&u(n,h);!h[this.idAttribute]&&w[this.idAttribute]&&(h[this.idAttribute]=w[this.idAttribute]);this.id=h[this.idAttribute];w.__type?(w.__type=w.__type.toLowerCase(),this.entityType=
"type",this.type="object",this.className=w.__type):w.__relationtype&&(w.__relationtype=w.__relationtype.toLowerCase(),this.entityType="relation",this.type="connection",this.className=w.__relationtype);n.__attributes||(n.__attributes={});h.__attributes||(h.__attributes={});var x=[];n.__tags||(n.__tags=[]);h.__tags||(h.__tags=[]);this.attributes=n;var y="",B="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __type __relationtype __typeid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link __acls __meta".split(" "),
G=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";return b};this.toJSON=this.getObject=function(){return c._encode(_extend({__meta:this.meta},n))};this.properties=function(){var b=_extend({},this.attributes);delete b.__attributes;delete b.__tags;return b};this.attr=function(){if(0===arguments.length)return n.__attributes||(n.__attributes={}),n.__attributes;if(1===arguments.length)return n.__attributes||(n.__attributes={}),n.__attributes[arguments[0]];if(2===arguments.length){if(!_type.isString(arguments[1])&&
null!==arguments[1])throw Error("only string values can be stored in attributes.");n.__attributes||(n.__attributes={});n.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");A("__attributes");return n.__attributes};var E=function(){if(n.__attributes){if(!h.__attributes)return n.__attributes;var b=!1,d=JSON.parse(JSON.stringify(h.__attributes)),c;for(c in n.__attributes)null==n.__attributes[c]||void 0==n.__attributes[c]?
(d[c]=null,b=!0):n.__attributes[c]!=h.__attributes[c]?(d[c]=n.__attributes[c],b=!0):n.__attributes[c]==h.__attributes[c]&&delete d[c];return b?d:void 0}};this.getChangedAttributes=E;this.aggregate=function(){var b={},d;for(d in n){if(!n.hasOwnProperty(d))return;"$"==d[0]&&(b[d.substring(1)]=n[d])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};this.tags=function(){return n.__tags?
n.__tags:[]};this.addTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;n.__tags||(n.__tags=[]);n.__tags.push(b);n.__tags=Array.distinct(n.__tags);if(!x||!x.length)return A("__tags"),this;b=x.indexOf(b);-1!=b&&x.splice(b,1);A("__tags");return this};this.removeTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;x.push(b);x=Array.distinct(x);if(!n.__tags||!n.__tags.length)return A("__tags"),this;b=n.__tags.indexOf(b);-1!=b&&n.__tags.splice(b,1);A("__tags");return this};var F=
function(){if(n.__tags){if(!h.__tags)return n.__tags;var b=[];n.__tags.forEach(function(d){-1==h.__tags.indexOf(d)&&b.push(d)});return 0<b.length?b:void 0}};this.getChangedTags=F;this.getRemovedTags=function(){return _removetags};var H=function(b,d,c,e){if(!b||!_type.isString(b)||0===b.length||0==b.trim().indexOf("__")||0===b.trim().indexOf("$")||void 0==d||null==d)return this;b=b.toLowerCase();try{var f=function(d){if(!g(d))throw Error("Multivalued property cannot have values of property as an object");
if(n[b]&&_type.isArray(n[b]))if("additems"==c)n[b].push(d);else if("adduniqueitems"==c){var e=-1;n[b].find(function(b,c){return _type.isEqual(b,d)?(e=c,!0):!1});-1==e&&n[b].push(d)}else"removeitems"==c&&n[b].removeAll(d);else"removeitems"!=c&&(n[b]=[d]);v[b]||(v[b]={additems:[],adduniqueitems:[],removeitems:[]});v[b][c].push(d)};_type.isArray(d)?d.forEach(function(b){f(b)}):f(d);A(b,e)}catch(l){throw Error("Unable to add item to "+b);}return k};this.add=function(b,d,c){return H.apply(this,[b,d,"additems",
c])};this.addUnique=function(b,d,c){return H.apply(this,[b,d,"adduniqueitems",c])};this.remove=function(b,d,c){return H.apply(this,[b,d,"removeitems",c])};var C=function(b,d,c,g){var e=void 0;_type.isEqual(c,d)||("__tags"==b?(b=F())&&0<b.length&&(e=b):"__attributes"==b?(b=E(),Object.isEmpty(b)||(e=b)):_type.isArray(c)?v[b]&&!z[b]?e=g?v[b]:c:c.equals(d)||(e=c):e=t[b]&&!z[b]?g?{incrementby:t[b].value}:c:c);return e},D=function(b){var d=!1,e=_extend({},h),g;for(g in e)"$"==g[0]&&delete e[g];for(var f in n)g=
C(f,e[f],n[f],b),void 0==g?delete e[f]:(d=!0,e[f]=g);try{B.forEach(function(b){e[b]&&delete e[b]})}catch(l){}b&&(e=c._encode(e));f=F();b?(f&&0<f.length&&(e.__addtags=f,d=!0),x&&0<x.length&&(e.__removetags=x,d=!0)):f&&0<f.length&&(e.__tags=f,d=!0);(b=E())&&!Object.isEmpty(b)?(e.__attributes=b,d=!0):delete e.__attributes;"object"==k.type&&k._aclFactory&&(b=k._aclFactory.getChanged())&&(e.__acls=b);return d&&!Object.isEmpty(e)?e:!1};this.changed=function(){return this.isNew()?this.toJSON():D()};this.hasChanged=
function(){return this.isNew()?!0:0===arguments.length?Object.isEmpty(D(!0))?!1:!0:1==arguments.length&&_type.isString(arguments[0])&&0<arguments[0].length?void 0==C(arguments[0])?!1:!0:!1};this.changedAttributes=function(){if(this.isNew())return this.toJSON();if(0===arguments.length)return D();if(1==arguments.length&&_type.isArray(arguments[0])&&arguments[0].length){var b={};arguments[0].forEach(function(d){d=C(d);void 0!=d&&b.push(d)});return b}return!1};this.previous=function(){return this.isNew()?
null:1==arguments.length&&_type.isString(arguments[0])&&arguments[0].length?h[arguments[0]]:null};this.previousAttributes=function(){return this.isNew()?null:_extend({},h)};this.fields=function(){if(1==arguments.length){var b=arguments[0];_type.isString(b)?y=b:_type.isArray(b)&&(y=b.join(","));return this}return y};this.get=function(b,c){if(b){if(c&&d[c.toLowerCase()]){if(d[c.toLowerCase()])return d[c.toLowerCase()](n[b]);throw Error('Invalid cast-type "'+c+'"" provided for get "'+b+'"');}return n[b]}};
this.tryGet=function(b,d,c){b=this.get(b,c);return void 0!==b?b:d};var A=function(b,d){if(d&&!d.silent){var c=C(b,h[b],n[b]);if(void 0!=c[b]||-1!=B.indexOf(b))k.trigger("change:"+b,k,c[b]||n[b],{}),d.ignoreChange||k.trigger("change",k,d)}},J=function(b){b&&!b.silent&&k.trigger("destroy",k,k.collection,b)},L=function(b,d,c){if(!b||!_type.isString(b)||0===b.length||0===b.trim().indexOf("$"))return this;b=b.toLowerCase();try{if(_type.isNullOrUndefined(d))n[b]=null;else if(g(d))n[b]=d;else if(_type.isObject(d))if(-1!==
e.indexOf(b))n[b]=d;else throw Error("Property cannot have value as an object");else _type.isArray(d)&&(n[b]=[],d.forEach(function(d){if(g(d))n[b].push(d);else throw Error("Multivalued property cannot have values of property as an object");}));delete t[b];delete v[b];delete z[b];_type.isEqual(n[b],h[b])||(z[b]=!0);b==k.idAttribute&&(k.id=d);return this}catch(f){throw Error("Unable to set "+b);}};this.set=function(b,d,c){var e,g;if(null==b)return this;null==b||"object"===typeof b?(g=b,c=d):(g={})[b]=
d;c||(c={});if(!this._validate(g,c))return!1;this.idAttribute in g&&(this.id=g[this.idAttribute]);var f=!1;for(e in g)d=g[e],L.apply(this,[e,d,_extend({},c,{ignoreChange:!0})]);if(c&&!c.silent)for(e in g)if(C(e,h[e],n[e])||-1!=B.indexOf(e))f=!0,k.trigger("change:"+b,k,n[b],{});f&&this.trigger("change",this,c);return this};this.unset=function(b,d){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();delete n[b];A(b,d);return this};this._validate=function(b,d){if(!d.validate||
!this.validate||!_type.isFunction(this.validate))return!0;b=_extend({},this.attributes,b);var c=this.validationError=this.validate(b,d)||null;if(!c)return!0;this.trigger("invalid",this,c,_extend(d,{validationError:c}));return!1};this.isValid=function(b){return this._validate({},_extend(b||{},{validate:!0}))};this.has=function(b){return b&&_type.isString(b)&&0!==b.length?n[b]&&!_type.isUndefined(n[b])?!0:!1:!1};this.isNew=function(){return this.id&&this.id.length?!1:!0};this.clone=function(){return"object"==
this.type?b.Appacitive.Object._create(_extend({__meta:this.meta},this.toJSON())):new b.Appacitive.connection._create(_extend({__meta:this.meta},this.toJSON()))};this.copy=function(b,d){b&&(u(b,n),d&&u(b,h));return this};this.mergeWithPrevious=function(){u(n,h);k._aclFactory&&k._aclFactory.merge();x=[];t={};v={};z={};return this};var I=function(){u(h,n);k._aclFactory&&k._aclFactory.merge();x=[];t={};v={};z={}};this.rollback=function(){n=w={};I();return this};var K=function(b,d,c,e){if(!b||!_type.isString(b)||
0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();if(_type.isObject(n[b])||_type.isArray(n[b]))throw Error("Cannot increment/decrement array/object");try{_type.isObject(d)?(e=d,d=c):d=!d||isNaN(Number(d))?c:Number(d)*c,n[b]=isNaN(Number(n[b]))?d:Number(n[b])+d,k.isNew()||(t[b]={value:(t[b]?t[b].value:0)+d})}catch(g){throw Error("Cannot perform increment/decrement operation");}A(b,e);return k};this.increment=function(b,d,c){return K(b,d,1,c)};this.decrement=function(b,d,c){return K(b,
d,-1,c)};this._save=function(){return this.id?M.apply(this,arguments):N.apply(this,arguments)};var N=function(d){d=d||{};var e=k.type;!n.__type||"user"!=n.__type.toLowerCase()&&"device"!=n.__type.toLowerCase()||(e=n.__type.toLowerCase());var g=k.toJSON();delete g.__meta;for(var f in g)"$"==f[0]&&delete g[f];g.__revision&&delete g.__revision;"object"==e&&k._aclFactory&&(f=k._aclFactory.getChanged())&&(g.__acls=f);g.__tags&&0==g.__tags.length&&delete g.__tags;Object.isEmpty(g.__attributes)&&delete g.__attributes;
var l=new b.Appacitive._Request({method:"PUT",type:e,op:"getCreateUrl",args:[this.className,y],data:g,options:d,entity:k,onSuccess:function(g){var f=null;g&&g[e]?(f=g[e],h=c._decode(_extend({__meta:_extend(k.meta,g.__meta)},f)),k.id=n[k.idAttribute]=f[k.idAttribute],I(),"connection"==k.type&&k.parseConnection(),k.trigger("change:__id",k,k.id,{}),b.Appacitive.eventManager.fire(k.entityType+"."+e+".created",k,{object:k}),k.created=!0,d.silent||k.trigger("sync",k,g[e],d),l.promise.fulfill(k)):(d.silent||
k.trigger("error",k,g.status,d),b.Appacitive.eventManager.fire(k.entityType+"."+e+".createFailed",k,{error:g.status}),l.promise.reject(g.status,k))}});return l.send()},M=function(d,e){b.Appacitive.Promise.is(e)||(e=b.Appacitive.Promise.buildPromise(d));var g=D(!0);d=d||{};if(Object.isEmpty(g))e.fulfill(k);else{var f=k.type,l=[k.className,k.id,y];n&&(n.__type&&("user"==n.__type.toLowerCase()||"device"==n.__type.toLowerCase()))&&(f=n.__type.toLowerCase(),l.splice(0,1));var m=new b.Appacitive._Request({method:"POST",
type:f,op:"getUpdateUrl",args:l,data:g,options:d,entity:k,onSuccess:function(e){e&&e[f]?(h=c._decode(_extend({__meta:_extend(k.meta,e.__meta)},e[f])),I(),delete k.created,d.silent||k.trigger("sync",k,e[f],d),b.Appacitive.eventManager.fire(k.entityType+"."+f+"."+k.id+".updated",k,{object:k}),m.promise.fulfill(k)):(e=e||{},e.status=e.status||{},e.status=G(e.status),d.silent||k.trigger("error",k,e.status,d),b.Appacitive.eventManager.fire(k.entityType+"."+f+"."+k.id+".updateFailed",k,{object:e.status}),
m.promise.reject(e.status,k))}});return m.send()}return e},O=function(d){if(!k.id)throw Error("Please specify id for get operation");d=d||[];var e=this.type;n&&(n.__type&&("user"==n.__type.toLowerCase()||"device"==n.__type.toLowerCase()))&&(e=n.__type.toLowerCase());var g=new b.Appacitive._Request({method:"GET",type:e,op:"getGetUrl",args:[this.className,k.id,y],options:d,entity:k,onSuccess:function(f){f&&f[e]?(h=c._decode(_extend({__meta:_extend(k.meta,f.__meta)},f[e])),u(h,n),k._aclFactory&&k._aclFactory._rollback(),
f.connection&&(k.endpoints||k.endpointA&&k.endpointB||k.setupConnection(n.__endpointa,n.__endpointb)),d.silent||k.trigger("sync",k,f[e],d),b.Appacitive.eventManager.fire(k.entityType+"."+e+"."+k.id+".updated",k,{object:k}),g.promise.fulfill(k)):(f=f||{},f.status=f.status||{},f.status=G(f.status),g.promise.reject(f.status,k))}});return g.send()};this._fetch=function(b){return O.apply(this,[b])};this.del=this._destroy=function(d){d=d||{};var c=d.deleteConnections;_type.isBoolean(d)&&(c=d,d={});d.wait||
J(d);if(!k.id)return(new b.Appacitive.Promise.buildPromise(d)).fulfill();var e=this.type;!n.__type||"user"!=n.__type.toLowerCase()&&"device"!=n.__type.toLowerCase()||(e=n.__type.toLowerCase());var g=new b.Appacitive._Request({method:"DELETE",type:e,op:"getDeleteUrl",args:[this.className,k.id,c],options:d,entity:this,onSuccess:function(b){b&&b.status?(n={},h={},d.wait&&J(d),g.promise.fulfill(b.status)):(b=b||{},b.status=b.status||{},b.status=G(b.status),g.promise.reject(b.status,k))}});return g.send()};
"object"==this.type&&(this._destroyWithConnections=function(b){return this.destroy(_extend({deleteConnections:!0},b))})};k.prototype.save=function(){return this._save.apply(this,arguments)};k.prototype.fetch=function(){return this._fetch.apply(this,arguments)};k.prototype.destroy=function(){return this._destroy.apply(this,arguments)};k.prototype.destroyWithConnections=function(){return this._destroyWithConnections.apply(this,arguments)};b.Appacitive.BaseObject=k;b.Appacitive.BaseObject._saveAll=function(d,
e,g){var f=[],l=[];if(!_type.isArray(d))throw Error("Provide an array of objects for Object.saveAll");d.forEach(function(d){d instanceof b.Appacitive.BaseObject||!_type.isObject(d)||(d=new b.Appacitive[g](d));f.find(function(b){return b.id==d.id})||(f.push(d),l.push(d.save()))});return c.Promise.when(l)};b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())};b.Appacitive.BaseObject.prototype.parse=function(b,d){return b};b.Appacitive.Events.mixin(b.Appacitive.BaseObject.prototype)})(global);
(function(b){var c=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c(),f="",g,h,d,l,k,p,m=0,b=b.replace(/\r\n/g,"\n");h="";for(d=0;d<b.length;d++)l=b.charCodeAt(d),128>l?h+=String.fromCharCode(l):(127<l&&2048>l?h+=String.fromCharCode(l>>6|192):(h+=String.fromCharCode(l>>12|224),h+=String.fromCharCode(l>>6&63|128)),h+=String.fromCharCode(l&63|128));for(b=h;m<b.length;)g=b.charCodeAt(m++),h=b.charCodeAt(m++),
d=b.charCodeAt(m++),l=g>>2,g=(g&3)<<4|h>>4,k=(h&15)<<2|d>>6,p=d&63,isNaN(h)?k=p=64:isNaN(d)&&(p=64),f=f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);return f.toString()}})(global);
(function(b){var c=["allow","deny"],e=["create","read","update","delete","manageaccess"],f=function(b){var c=[];b.forEach(function(b){_type.isString(b)&&-1!=e.indexOf(b.toLowerCase())&&c.push(b.toLowerCase())});return c};b.Appacitive._Acl=function(g,h){var d=g||[];_type.isArray(d)||(d=[]);var l={};h&&(l=JSON.parse(JSON.stringify(d)));this.acls=d=JSON.parse(JSON.stringify(d));var k=[],p=function(e,g,l,h){if(!l)throw Error("Specify valid user or usergroup");l instanceof b.Appacitive.Object&&("user"==
l.typeName&&!l.isNew())&&(l=l.id);var m=d.filter(function(b){return b.sid==l&&b.type==g});m&&0!=m.length?m=m[0]:(m={sid:l,type:g,deny:[],allow:[]},d.push(m));m.allow||(m.allow=[]);m.deny||(m.deny=[]);h=f(h);var p=k.filter(function(b){return b.sid==l&&b.type==g});p&&0!=p.length?p=p[0]:(p={sid:l,type:g},k.push(p));h.forEach(function(b){for(var d=0;d<c.length;d+=1){var g=m[c[d]].indexOf(b);if(-1!=g){m[c[d]].splice(g,1);break}}"inherit"!=e&&m[e].push(b);p[b]=e});return this},m=function(b,d,c,e){if(!c)throw Error("Please provide valid id or name for setting acls");
if(!e)throw Error("Please provide valid access permissions for setting acls");_type.isArray(e)||(e=[e]);_type.isArray(c)?c.forEach(function(c){p(b,d,c,e)}):p(b,d,c,e);return this},r=function(){d.allowUser=function(b,d){return m.apply(this,["allow","user",b,d])};d.allowGroup=function(b,d){return m.apply(this,["allow","usergroup",b,d])};d.denyUser=function(b,d){return m.apply(this,["deny","user",b,d])};d.denyGroup=function(b,d){return m.apply(this,["deny","usergroup",b,d])};d.resetUser=function(b,d){return m.apply(this,
["inherit","user",b,d])};d.resetGroup=function(b,d){return m.apply(this,["inherit","usergroup",b,d])};d.allowAnonymous=function(b){return m.apply(this,["allow","usergroup",["anonymous"],b])};d.denyAnonymous=function(b){return m.apply(this,["deny","usergroup",["anonymous"],b])};d.resetAnonymous=function(b){return m.apply(this,["inherit","usergroup",["anonymous"],b])};d.allowLoggedIn=function(b){return m.apply(this,["allow","usergroup",["anonymous"],b])};d.denyLoggedIn=function(b){return m.apply(this,
["deny","usergroup",["anonymous"],b])};d.resetLoggedIn=function(b){return m.apply(this,["inherit","usergroup",["anonymous"],b])}};this._rollback=function(){k=[];d=JSON.parse(JSON.stringify(l));r();return this};this.toJSON=this.getChanged=function(){var b=[];k.forEach(function(d){var g={sid:d.sid,type:d.type,allow:[],deny:[],inherit:[]};e.forEach(function(b){d[b]&&g[d[b]].push(b)});c.forEach(function(b){0==g[b].length&&delete g[b]});0==g.inherit.length&&delete g.inherit;b.push(g)});return 0==b.length?
null:b};this.merge=function(){k=[];return this};r();return this};b.Appacitive.Group=new function(){var c=function(c,d,e,g){if(!d||!_type.isString(d)||0===d.length)throw Error("Please specify valid groupname");_type.isArray(e)||(e=[e]);var f={};f[c]=[];e.forEach(function(d){d&&(d instanceof b.Appacitive.Object&&"user"==d.typeName&&!d.isNew()?f[c].push(d.id):f[c].push(d))});if(0==f[c].length)throw Error("Please specify valid members as second argument");var m=new b.Appacitive._Request({method:"POST",
type:"usergroup",op:"getUpdateUrl",args:[d],data:f,entity:this,options:g,onSuccess:function(b){m.promise.fulfill(b)}});return m.send()};this.addMembers=function(b,d,e){return c("add",b,d)};this.removeMembers=function(b,d,e){return c("remove",b,d)}}})(global);
(function(b){b.Appacitive.Object=function(c,e){c=c||{};e=e||{};this.className&&(c.__type=this.className);_type.isString(c)&&(c={__type:c});if(!c.__type)throw Error("Cannot set object without __type");_type.isBoolean(e)&&(e={setSnapShot:!0});b.Appacitive.BaseObject.call(this,c,e);this.type="object";this.getObject=this.getObject;this.children={};this.toJSON=function(b){if(b){var c=function(b){var d=[];b.forEach(function(b){var e=b.getObject();if(b.children&&!Object.isEmpty(b.children)){e.children={};
for(var g in b.children)e.children[g]=c(b.children[g])}b.connection&&(e.__connection=b.connection.toJSON());d.push(e)});return d};return c([this])[0]}return this.getObject()};this.typeName=c.__type;this._aclFactory=new Appacitive._Acl(e.__acls,e.setSnapShot);this.acls=this._aclFactory.acls;_type.isFunction(this.initialize)&&this.initialize.apply(this,[c]);return this};b.Appacitive.Object.prototype=new b.Appacitive.BaseObject;b.Appacitive.Object.prototype.constructor=b.Appacitive.Object;b.Appacitive.Object.extend=
function(e,f,d){_type.isObject(e)&&(d=f,f=e,e=f.typeName);if(!_type.isString(e)||0==e.length)throw Error("Appacitive.Object.extend's first argument should be the type-name.");var l=null;f=f||{};f.className=e;l=b.Appacitive._extend(b.Appacitive.Object,f,d);delete l.extend;l.className=e;l.type=e;return c[e]=l};var c={},e=function(e){if(!_type.isString(e))throw"_getClass requires a string argument.";var f=c[e];f||(f=b.Appacitive.Object.extend(e),c[e]=f);return f};b.Appacitive.Object._getClass=e;b.Appacitive.Object._create=
function(b,c,d){return(new (this.className?this:d?d:e(b.__type))(b)).copy(b,c)};var f=function(c,e,d){var f=[];c.forEach(function(c){c=b.Appacitive.Object._create(_extend(c,{__meta:d}),!0,e);f.push(c)});return f};b.Appacitive.Object._parseResult=f;b.Appacitive.Object.multiDelete=function(c,e){c=c||{};e=e||{};var d=[];this.className&&(c.type=this.className);_type.isArray(c)&&0<c.length&&(c[0]instanceof b.Appacitive.Object?(d=c,c={type:d[0].className,ids:d.map(function(b){return b.id}).filter(function(b){return b})}):
c={type:this.className,ids:c});if(!c.type||!_type.isString(c.type)||0===c.type.length)throw Error("Specify valid type");if("user"===c.type.toLowerCase()||"device"===c.type.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var f=new b.Appacitive._Request({method:"POST",data:{idlist:c.ids},type:"object",op:"getMultiDeleteUrl",args:[c.type],options:e,onSuccess:function(b){e&&!e.silent&&d.forEach(function(b){b.trigger("destroy",
b,b.collection,e)});f.promise.fulfill()}});return f.send()};b.Appacitive.Object.multiGet=function(c,e){c=c||{};_type.isArray(c)&&0<c.length&&(c[0]instanceof b.Appacitive.Object?(models=c,c={ids:models.map(function(b){return b.id}).filter(function(b){return b})}):c={ids:c});this.className&&(c.type=this.className,c.entity=this);if(!c.type||!_type.isString(c.type)||0===c.type.length)throw Error("Specify valid type");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var d=new b.Appacitive._Request({method:"GET",
type:"object",op:"getMultiGetUrl",args:[c.type,c.ids.join(","),c.fields],options:e,onSuccess:function(b){d.promise.fulfill(f(b.objects,c.entity,b.__meta))}});return d.send()};b.Appacitive.Object.get=function(c,e){c=c||{};_type.isString(c)&&this.className&&(c={id:c});this.className&&(c.type=this.className,c.entity=this);if(!c.type)throw Error("Specify type");if(!c.id)throw Error("Specify id to fetch");var d=b.Appacitive.Object._create({__type:c.type,__id:c.id});d.fields=c.fields;return d.fetch(c,e)};
b.Appacitive.Object.prototype.getConnections=function(c){if(this.isNew())throw Error("Cannot fetch connections for new object");c.objectId=this.get("__id");return new b.Appacitive.Queries.GetConnectionsQuery(c)};b.Appacitive.Object.prototype.getConnectedObjects=function(c){if(this.isNew())throw Error("Cannot fetch connections for new object");c=c||{};_type.isString(c)&&(c={relation:c});c.type=this.get("__type");c.objectId=this.get("__id");c.object=this;return new b.Appacitive.Queries.ConnectedObjectsQuery(c)};
b.Appacitive.Object.prototype.fetchConnectedObjects=b.Appacitive.Object.prototype.getConnectedObjects;b.Appacitive.Object.findAll=b.Appacitive.Object.findAllQuery=function(c){c=c||{};this.className&&(c.type=this.className,c.entity=this);return new b.Appacitive.Queries.FindAllQuery(c)};b.Appacitive.Object.saveAll=function(c,e){return b.Appacitive.BaseObject._saveAll(c,e,"Object")}})(global);
(function(b){var c=function(d,c,e){var f={label:d.label};d.objectid&&(f.objectid=d.objectid);if(d.object)d.object instanceof b.Appacitive.Object?d.object.id?f.objectid=d.object.id:f.object=d.object.getObject():_type.isObject(d.object)&&(d.object.__id?f.objectid=d.object.__id:f.object=d.object,d.object=b.Appacitive.Object._create(d.object));else if(!f.objectid&&!f.object)throw Error("Incorrectly configured endpoints provided to parseConnection");f.toJSON=function(){var b=_extend({},this);if(b.object&&
(b.object=d.object.toJSON(),d.object._aclFactory)){var c=d.object._aclFactory.toJSON();c&&(b.object.__acls=c)}delete b.toJSON;return b};e["endpoint"+c]=d;return f},e=function(d,c,e){d.object&&_type.isObject(d.object)?(e["endpoint"+c]?e["endpoint"+c]&&e["endpoint"+c].object&&e["endpoint"+c].object instanceof b.Appacitive.Object?e["endpoint"+c].object.copy(d.object,!0):e["endpoint"+c].object=b.Appacitive.Object._create(d.object,!0):(e["endpoint"+c]={},e["endpoint"+c].object=b.Appacitive.Object._create(d.object,
!0)),e["endpoint"+c]._aclFactory&&e["endpoint"+c]._aclFactory.merge(),e["endpoint"+c].objectid=d.object.__id,e["endpoint"+c].label=d.label,e["endpoint"+c].type=d.type):e["endpoint"+c]=d};b.Appacitive.Connection=function(d,c){d=d||{};c=c||{};this.className&&(d.__relationtype=this.className);_type.isString(d)&&(d={__relationtype:d});if(!d.__relationtype&&!d.relation)throw Error("Cannot set connection without relation");d.relation&&(d.__relationtype=d.relation,delete d.relation);_type.isBoolean(c)&&
(c={setSnapShot:!0});d.endpoints&&2===d.endpoints.length&&(d.__endpointa=d.endpoints[0],d.__endpointb=d.endpoints[1],delete d.endpoints);b.Appacitive.BaseObject.call(this,d,c);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b="A",c="B";d.__endpointa.label.toLowerCase()!==this.get("__endpointb").label.toLowerCase()||(d.__endpointa.label.toLowerCase()==d.__endpointb.label.toLowerCase()||d.__endpointa.objectid!=this.get("__endpointb").objectid&&d.__endpointa.objectid)||
(b="B",c="A");e(this.get("__endpointa"),b,this);e(this.get("__endpointb"),c,this);this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b};return this};c.setSnapShot?this.parseConnection(d):d.__endpointa&&
d.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));this.relationName=d.__relationtype;_type.isFunction(this.initialize)&&this.initialize.apply(this,[d]);return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=b.Appacitive.Connection;b.Appacitive.Connection.extend=function(d,c,e){_type.isObject(d)&&(e=c,c=d,d=c.relationName);if(!_type.isString(d))throw Error("Appacitive.Connection.extend's first argument should be the relationName.");
var g=null;c=c||{};c.className=d;g=b.Appacitive._extend(b.Appacitive.Connection,c,e);delete g.extend;g.className=d;g.relation=d;return f[d]=g};var f={},g=function(d){if(!_type.isString(d))throw"_getClass requires a string argument.";var c=f[d];c||(c=b.Appacitive.Connection.extend(d),f[d]=c);return c};b.Appacitive.Connection._getClass=g;b.Appacitive.Connection._create=function(b,c,e){return(new (this.className?this:e?e:g(b.__relationtype))(b)).copy(b,c)};var h=function(d,c,e){var f=[];d||(d=[]);d.forEach(function(d){f.push(b.Appacitive.Connection._create(_extend(d,
{__meta:e}),!0,c))});return f};b.Appacitive.Connection._parseResult=h;b.Appacitive.Connection.prototype.setupConnection=function(b,e){if(!(b&&(b.objectid||b.object)&&b.label&&e&&(e.objectid||e.object)&&e.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",c(b,"A",this),{silent:!0});this.set("__endpointb",c(e,"B",this),{silent:!0});this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;
if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b}};b.Appacitive.Connection.prototype.get=b.Appacitive.Connection.get=function(d,c){d=d||{};_type.isString(d)&&this.className&&(d={id:d});this.className&&(d.relation=this.className,d.entity=this);if(!d.relation)throw Error("Specify relation");if(!d.id)throw Error("Specify id to fetch");var e=b.Appacitive.Connection._create({__relationtype:d.relation,
__id:d.id});e.fields=d.fields;return e.fetch(c)};b.Appacitive.Connection.multiGet=function(d,c){d=d||{};_type.isArray(d)&&0<d.length&&(d[0]instanceof b.Appacitive.Connection?(models=d,d={ids:models.map(function(b){return b.id}).filter(function(b){return b})}):d={ids:d});this.className&&(d.relation=this.className,d.entity=this);if(!d.relation||!_type.isString(d.relation)||0===d.relation.length)throw Error("Specify valid relation");if(!d.ids||0===d.ids.length)throw Error("Specify ids to delete");var e=
new b.Appacitive._Request({method:"GET",type:"connection",op:"getMultiGetUrl",args:[d.relation,d.ids.join(","),d.fields],options:c,onSuccess:function(b){e.promise.fulfill(h(b.connections,d.entity,b.__meta))}});return e.send()};b.Appacitive.Connection.multiDelete=function(d,c){d=d||{};c=c||{};var e=[];this.className&&(d.relation=this.className);_type.isArray(d)&&0<d.length&&(d[0]instanceof b.Appacitive.Connection?(e=d,d={relation:e[0].className,ids:e.map(function(b){return b.id}).filter(function(b){return b})}):
d={relation:this.className,ids:d});if(!d.relation||!_type.isString(d.relation)||0===d.relation.length)throw Error("Specify valid relation");if(!d.ids||0===d.ids.length)throw Error("Specify ids to delete");var f=new b.Appacitive._Request({method:"POST",data:{idlist:d.ids},type:"connection",op:"getMultiDeleteUrl",args:[d.relation],options:c,onSuccess:function(b){c&&!c.silent&&e.forEach(function(b){b.trigger("destroy",b,b.collection,c)});f.promise.fulfill()}});return f.send()};b.Appacitive.Connection.findAll=
b.Appacitive.Connection.findAllQuery=function(d){d=d||{};this.className&&(d.relation=this.className,d.entity=this);return new b.Appacitive.Queries.FindAllQuery(d)};b.Appacitive.Connection.interconnectsQuery=b.Appacitive.Connection.getInterconnects=function(d){return new b.Appacitive.Queries.InterconnectsQuery(d)};b.Appacitive.Connection.betweenObjectsQuery=b.Appacitive.Connection.getBetweenObjects=function(d){return new b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery(d)};b.Appacitive.Connection.betweenObjectsForRelationQuery=
b.Appacitive.Connection.getBetweenObjectsForRelation=function(d){d=d||{};this.className&&(d.relation=this.className,d.entity=this);return new b.Appacitive.Queries.GetConnectionsBetweenObjectsForRelationQuery(d)};b.Appacitive.Connection.saveAll=function(d,c){return b.Appacitive.BaseObject._saveAll(d,c,"Connection")}})(global);
(function(b){var c=function(d,c){d=d||{};d.__type="user";b.Appacitive.Object.call(this,d,c);return this},e=null;c.currentUser=c.current=function(){return e};var f=function(d,c,e){var f=this.get("__id");if(!f||!_type.isString(f)||0===f.length)throw Error("Please specify valid userid");if(!d||!_type.isString(d)||0===d.length)throw Error("Please specify valid oldPassword");if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid newPassword");var g=this,h=new b.Appacitive._Request({method:"POST",
type:"user",op:"getUpdatePasswordUrl",args:[f],options:e,data:{oldpassword:d,newpassword:c},entity:this,onSuccess:function(b){h.promise.fulfill(g)}});return h.send()},g=function(d,c){var e=this.get("__id");if(!this.get("__id"))return this.set("__link",d),b.Appacitive.Promise.buildPromise(c).fulfill(this);var f=this,g=new b.Appacitive._Request({method:"POST",type:"user",op:"getLinkAccountUrl",args:[e],options:c,data:d,entity:this,onSuccess:function(b){b=f.get("__link");_type.isArray(b)||(b=b?[b]:[]);
b.push(d);f.copy({__link:b},!0);g.promise.fulfill(f)}});return g.send()};c.setCurrentUser=function(d,c,g){if(!d)throw Error("Cannot set null object as user");var h=d;if(h instanceof b.Appacitive.User)if(h.get("__id")&&0!==h.get("__id").length)d=h.toJSON();else throw Error("Specify user __id");else h=new b.Appacitive.User(d,!0);b.Appacitive.localStorage.set("Appacitive-User",d);g||(g=864E5);e=h;c&&b.Appacitive.Session.setUserAuthHeader(c,g);e.logout=function(d){return b.Appacitive.Users.logout(d)};
e.updatePassword=function(b,d,c){return f.apply(this,[b,d,c])};e.logout=function(d){return b.Appacitive.Users.logout(d)};b.Appacitive.eventManager.clearAndSubscribe("type.user."+h.get("__id")+".updated",function(d,c){b.Appacitive.localStorage.set("Appacitive-User",c.object.getObject())});return e};c.prototype.linkedAccounts=function(){var b=this.get("__link");b?_type.isArray(b)||(b=[b]):b=[];return b};c.prototype.getAllLinkedAccounts=function(d){var c=this.get("__id");if(!c||!_type.isString(c)||0===
c.length)return b.Appacitive.Promise.buildPromise(d).fulfill(this.linkedAccounts(),this);var e=this,f=new b.Appacitive._Request({method:"GET",type:"user",op:"getGetAllLinkedAccountsUrl",args:[c],options:d,entity:this,onSuccess:function(){var b=a.identities||[];0<b.length?e.set("__link",b):e.set("__link",null);f.promise.fulfill(b,e)}});return f.send()};c.prototype.checkin=function(d,c){var e=this.get("__id");e&&_type.isString(e)&&0!==e.length||onSuccess&&_type.isFunction(onSuccess)&&onSuccess();if(!(d&&
d instanceof b.Appacitive.GeoCoord))throw Error("Invalid coordinates provided");var f=this,g=new b.Appacitive._Request({method:"POST",type:"user",op:"getCheckinUrl",args:[e,d.lat,d.lngerId],options:c,entity:this,onSuccess:function(){g.promise.fulfill(f)}});return g.send()};c.prototype.linkFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return g.apply(this,[{authtype:"facebook",accesstoken:b,name:"facebook"},c])};c.prototype.linkTwitter=function(b,c){if(!_type.isObject(b)||
!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var e={authtype:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret};b.consumerKey&&b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=b.consumerKey);return g.apply(this,[e,c])};c.prototype.unlink=function(d,c){if(!_.isString(d))throw Error("Specify aouth account type for unlinking");var e=this.get("__id");if(!this.get("__id"))return this.set("__link",null),promise.fulfill(this),
promise;var f=this,g=new b.Appacitive._Request({method:"POST",type:"user",op:"getDelinkAccountUrl",args:[e,d],options:c,entity:this,onSuccess:function(b){(b=f.get("__link"))?_type.isArray(b)||(b=[b]):b=[];if(0<=b.length){var c=null;b.forEach(function(b,e){b.name==d.toLowerCase()&&(c=e)});null!=c&&b.splice(c,1);f.copy({__link:b},!0)}else f.copy({__link:[]},!0);g.promise.fulfill(f)}});return g.send()};c.prototype.clone=function(){return new b.Appacitive.User(this.getObject())};b.Appacitive.User=b.Appacitive.Object.extend("user",
c.prototype);delete b.Appacitive.User._create;delete b.Appacitive.User._parseResult;delete b.Appacitive.User.multiDelete;c.deleteUser=function(d,c){if(!d)throw Error("Specify userid for user delete");return(new b.Appacitive.Object({__type:"user",__id:d})).destroyWithConnections(c)};c.deleteCurrentUser=function(d){var c=b.Appacitive.Promise.buildPromise(d);if(null===e)return b.Appacitive.Session.removeUserAuthHeader(),c.fulfill(),c;d=e.get("__id");this.deleteUser(d).then(function(){e=null;b.Appacitive.Session.removeUserAuthHeader();
c.fulfill()},function(){c.reject.apply(c,arguments)});return c};c.createNewUser=function(d,c){d=d||{};d.__type="user";if(!d.username||!d.password||!d.firstname||0===d.username.length||0===d.password.length||0===d.firstname.length)throw Error("username, password and firstname are mandatory");return(new b.Appacitive.User(d)).save(c)};c.createUser=c.createNewUser;c.signup=function(d,c){var e=this,f=b.Appacitive.Promise.buildPromise(c);this.createUser(d).then(function(){e.login(d.username,d.password).then(function(){f.fulfill.apply(f,
arguments)},function(b){f.reject.apply(f,arguments)})},function(){f.reject.apply(f,arguments)});return f};c.authenticateUser=function(d,c,f){d.expiry||(d.expiry=864E5);var g=this,h=new b.Appacitive._Request({method:"POST",type:"user",op:"getAuthenticateUserUrl",options:c,data:d,onSuccess:function(c){c&&c.user?(f&&(c.user.__authType=f),_extend(c.user,{__meta:c.__meta}),g.setCurrentUser(c.user,c.token,d.expiry),b.Appacitive.User.trigger("login",e,e,c.token),h.promise.fulfill({user:e,token:c.token})):
h.promise.reject(c.status)}});return h.send()};c.login=function(b,c,e){if(!b||!c||0==b.length||0==c.length)throw Error("Please specify username and password");return this.authenticateUser({username:b,password:c,expiry:864E5},e,"BASIC")};c.loginWithFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");c=c||{};var e=!0;!1==c.create&&(e=!1);return this.authenticateUser({accesstoken:b,type:"facebook",expiry:864E5,createnew:e},c,"FB")};c.loginWithTwitter=function(b,
c){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var e=!0;!1==c.create&&(e=!1);e={type:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret,expiry:864E5,createnew:e};b.consumerKey&&b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=b.consumerKey);return this.authenticateUser(e,c,"TWITTER")};c.validateCurrentUser=function(c,e){var f=b.Appacitive.Promise.buildPromise({success:e});e&&_type.isBoolean(e)&&
(c=e,e=function(){});var g=b.Appacitive.localStorage.get("Appacitive-UserToken");if(!g)return f.fulfill(!1),f;if(c)f.fulfill(!0);else try{var h=this;this.getUserByToken(g).then(function(b){h.setCurrentUser(b,g);f.fulfill(!0)},function(){f.fulfill(!1)})}catch(r){f.fulfill(!1)}return f};var h=function(c,e,f){f=f||{};var g=new b.Appacitive._Request({method:"GET",type:"user",op:c,options:f,args:e,onSuccess:function(c){c&&c.user?g.promise.fulfill(new b.Appacitive.User(_extend(c.user,{__meta:c.__meta}),
_extend(f,{setSnapShot:!0}))):g.promise.reject(c.status)}});return g.send()};c.getUserByToken=function(c,e){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid token");b.Appacitive.Session.setUserAuthHeader(c,0,!0);return h("getUserByTokenUrl",[c],e)};c.getUserByUsername=function(b,c){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");return h("getUserByUsernameUrl",[b],c)};c.logout=function(c,f){e=null;return b.Appacitive.Session.removeUserAuthHeader(c,
f)};c.sendResetPasswordEmail=function(c,e,f){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid username");if(!e||!_type.isString(e)||0===e.length)throw Error("Plase specify subject for email");var g=new b.Appacitive._Request({method:"POST",type:"user",op:"getSendResetPasswordEmailUrl",options:f,data:{username:c,subject:e},onSuccess:function(){g.promise.fulfill()}});return g.send()};c.resetPassword=function(c,e,f){if(!c)throw Error("Please specify token");if(!e||0===e.length)throw Error("Please specify password");
var g=new b.Appacitive._Request({method:"POST",type:"user",op:"getResetPasswordUrl",options:f,data:{newpassword:e},args:[c],onSuccess:function(){g.promise.fulfill()}});return g.send()};c.validateResetPasswordToken=function(c,e){if(!c)throw Error("Please specify token");e=e||{};var f=new b.Appacitive._Request({method:"POST",type:"user",op:"getValidateResetPasswordUrl",options:e,data:{},args:[c],onSuccess:function(c){f.promise.fulfill(new b.Appacitive.User(_extend(c.user,{__meta:c.__meta}),_extend(e,
{setSnapShot:!0})))}});return f.send()};b.Appacitive.Users=b.Appacitive.User;b.Appacitive.Events.mixin(b.Appacitive.User)})(global);
(function(b){b.Appacitive.Collection=function(b,e){e||(e={});e.model&&(this.model=e.model);if(!this.model)throw Error("Please specify model for collection");void 0!==e.comparator&&(this.comparator=e.comparator);e.query?this.query(e.query):this.query(new Appacitive.Query(this.model));this._reset();this.initialize.apply(this,arguments);b&&this.reset(b,{silent:!0})};b.Appacitive.Events.mixin(b.Appacitive.Collection.prototype);_extend(b.Appacitive.Collection.prototype,{models:[],initialize:function(){},
_query:null,toJSON:function(b){return this.models.map(function(e){return e.toJSON(b)})},add:function(b,e){e=e||{};var f,g,h,d,l,k={},p={},m=[],r=e.sort,q;b=_type.isArray(b)?b.slice():[b];f=0;for(g=b.length;f<g;f++){b[f]=this._prepareModel(b[f]);h=b[f];if(!h)throw Error("Can't add an invalid model to a collection");d=h.cid;if(k[d]||this._byCid[d])throw Error("Duplicate cid: can't add the same model to a collection twice");(l=h.id)&&((q=p[l])||(q=this._byId[l]))?(q.copy(h.toJSON(),e.setSnapShot),q.children=
h.children):(p[l]=h,k[d]=h,m.push(h),this._addReference(h,e))}this.models.splice.apply(this.models,[null!=e.at?e.at:this.models.length,0].concat(m));r&&this.comparator&&this.sort({silent:!0});this.length=this.models.length;if(e.silent)return this;f=0;for(g=m.length;f<g;f++)h=m[f],e.index=f,h.trigger("add",h,this,e);return this},remove:function(b,e){var f,g,h,d;e=e||{};b=_type.isArray(b)?b.slice():[b];f=0;for(g=b.length;f<g;f++)if(d=this.getByCid(b[f])||this.get(b[f]))delete this._byId[d.id],delete this._byCid[d.cid],
h=this.models.indexOf(d),this.models.splice(h,1),this.length--,e.silent||(e.index=h,d.trigger("remove",d,this,e)),this._removeReference(d);return this},push:function(b,e){return this.add(b,_extend({at:this.length},e))},pop:function(b){var e=this.at(this.length-1);this.remove(e,b);return e},unshift:function(b,e){return this.add(b,_extend({at:0},e))},shift:function(b){var e=this.at(0);this.remove(e,b);return e},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(c){return c&&
this._byId[c instanceof b.Appacitive.BaseObject?c.id:c]},query:function(c){if(c){if(c instanceof b.Appacitive.Query||c instanceof b.Appacitive.Queries.GraphAPI)return this._query=c,this;throw Error("Cannot bind this query");}return this._query},getByCid:function(b){return b&&this._byCid[b.cid||b]},at:function(b){return this.models[b]},where:function(b,e){return Object.isEmpty(b)?e?void 0:[]:this.models[e?"find":"filter"](function(e){for(var g in b)if(b[g]!==e.get(g))return!1;return!0})},findWhere:function(b){return this.where(b,
!0)},sort:function(b){b=b||{};if(!this.comparator)throw Error("Cannot sort a set without a comparator");1===this.comparator.length?this.models=this.models.sortBy(this.comparator):this.models.sort(this.comparator.bind(this.models));b.silent||this.trigger("reset",this,b);return this},pluck:function(b){return this.models.map(function(e){return e.get(b)})},first:function(){return 0<this.length?this.models[0]:null},last:function(){return 0<this.length?this.models[this.length-1]:null},reset:function(b,
e){e||(e={});for(var f=0,g=this.models.length;f<g;f++)this._removeReference(this.models[f],e);this._reset();this.add(b,_extend({silent:!0},e));e.silent||this.trigger("reset",this,e);return this},fetch:function(c){c=_clone(c)||{};var e=this,f=this.query()||new b.Appacitive.Query(this.model),g=b.Appacitive.Promise.buildPromise(c);f.fetch(c).then(function(b){c.add?e.add(b,_extend({setSnapShot:!0},c)):e.reset(b,c);g.fulfill(e)},function(){g.reject.apply(g,arguments)});return g},mutiGet:function(c){c=
_clone(c)||{};var e=this,f=b.Appacitive.Promise.buildPromise(c),g=c.ids||[];if(0==g.length)return f.fulfill(e);g={ids:g,fields:c.fields};g[this.model.type||this.model.relation]=this.model.className;b.Appacitive.Object.multiGet(g).then(function(b){c.add?e.add(b,c):e.reset(b,c);f.fulfill(e)},function(){f.reject.apply(f,arguments)});return f},saveAll:function(b){return this.model.saveAll(_extend(b))},create:function(b,e){var f=this;e=e?_clone(e):{};if(!(b=this._prepareModel(b,e)))return!1;e.wait||this.add(b,
e);var g=e.success;e.success=function(){e.wait&&f.add(b,_extend({setSnapShot:!0},e));g&&g(b,f)};b.save(e);return b},_reset:function(b){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(c){c instanceof b.Appacitive.BaseObject||(c=new this.model(c));c.collection||(c.collection=this);return c},_addReference:function(b){this._byId[b.cid]=b;null!=b.id&&(this._byId[b.id]=b);b.collection||(b.collection=this);b.on("all",this._onModelEvent,this)},_removeReference:function(b){this===
b.collection&&delete b.collection;b.off("all",this._onModelEvent,this)},_onModelEvent:function(b,e,f,g){if("add"!==b&&"remove"!==b||f===this)"destroy"===b&&this.remove(e,g),e&&"change:__id"===b&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments)}});b.Appacitive.Collection.extend=function(c,e){c&&c.query&&(c._query=c.query,delete c.query);var f=b.Appacitive._extend(this,c,e);f.extend=this.extend;return f};"forEach each map find filter every some indexOf lastIndexOf isEmpty difference without reduce".split(" ").each(function(c){b.Appacitive.Collection.prototype[c]=
function(){var b=Array.prototype.slice.call(arguments);return Array.prototype[c].apply(this.models,b)}})})(global);
(function(b){var c=function(){var c=null,f=this.FB=null,g=!1;this.initialize=function(b){if(!Facebook)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!b.appId)throw Error("Please provide appid");if(!b.appSecret)throw Error("Please provide app secret");f=b.appSecret;this.FB=new (require("facebook-node-sdk"))({appId:_appId,secret:f});g=!0};this.requestLogin=function(b){b&&(c=b);return(new Appacitive.Promise).fulfill()};this.getCurrentUserInfo=function(){if(!g)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
var b=new Appacitive.Promise;this.FB&&c?this.FB.api("/me",function(c,e){e?b.fulfill(e):b.reject("Access token is invalid")}):b.reject("Either intialize facebook with your appid and appsecret or set accesstoken");return b};this.accessToken=function(){return 1===arguments.length?(c=arguments[0],this):c};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){b.Appacitive.Facebook.accessToken="";return(new Appacitive.Promise).fulfill()}};b.Appacitive.Facebook=
b.Appacitive.runtime.isBrowser?new function(){var c=null,f=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);f=!0};this.requestLogin=function(b){b=b||{};if(!f)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var h=new Appacitive.Promise;FB.login(function(b){b&&"connected"===b.status&&b.authResponse?(c=b.authResponse.accessToken,h.fulfill(b.authResponse)):
h.reject()},b);return h};this.getCurrentUserInfo=function(){if(!f)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var b=new Appacitive.Promise;FB.api("/me",function(f){f&&!f.error?(c=FB.getAuthResponse().accessToken,b.fulfill(f)):b.reject()});return b};this.accessToken=function(){return 1===arguments.length?(c=arguments[0],this):c};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){c=null;var f=new Appacitive.Promise;
try{FB.logout(function(){b.Appacitive.Users.logout();f.fulfill()})}catch(h){f.reject(h.message)}return f}}:new c})(global);
(function(b){b.Appacitive.Email=new function(){var c={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return c};var e=function(c,e){var h=new b.Appacitive._Request({method:"POST",type:"email",op:"getSendEmailUrl",options:e,data:c,entity:c,onSuccess:function(b){h.promise.fulfill(b.email)}});return h.send()};this.setupEmail=function(b){b=b||{};c.smtp.username=b.username||c.smtp.username;c.from=b.from||c.from;c.smtp.password=
b.password||c.smtp.password;c.smtp.host=b.smtp.host||c.smtp.host;c.smtp.port=b.smtp.port||c.smtp.port;c.smtp.enablessl=b.enableSSL||c.smtp.enablessl;c.replyto=b.replyTo||c.replyto};this.sendTemplatedEmail=function(b,g){if(!b||!b.to||!b.to.length||0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&c.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");
if(!b.templateName)throw Error("template name is mandatory to send an email");var h={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){h.smtp=c.smtp;if(!b.from&&!c.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");h.from=b.from||c.from;h.replyto=b.replyTo||c.replyto}return e(h,g)};this.sendRawEmail=function(b,g){if(!b||!b.to||!b.to.length||
0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&c.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.body)throw Error("body is mandatory to send an email");var h={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{content:b.body||"",ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){h.smtp=
c.smtp;if(!b.from&&!c.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");h.from=b.from||c.from;h.replyto=b.replyTo||c.replyto}return e(h,g)}}})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(c,e){if(!c)throw Error("Please specify push options");var f=new b.Appacitive._Request({method:"POST",type:"push",op:"getPushUrl",options:e,data:c,entity:c,onSuccess:function(b){f.promise.fulfill(b.id)}});return f.send()};this.getNotification=function(c,e){if(!c)throw Error("Please specify notification id");var f=new b.Appacitive._Request({method:"GET",type:"push",op:"getGetNotificationUrl",args:[c],options:e,onSuccess:function(b){f.promise.fulfill(b.pushnotification)}});
return f.send()};this.getAllNotifications=function(c,e){c?(c.pnum=c.pnum||1,c.psize=c.psize||20):c={pnum:1,psize:20};var f=new b.Appacitive._Request({method:"GET",type:"push",op:"getGetAllNotificationsUrl",args:[c],options:e,onSuccess:function(b){f.promise.fulfill(b.pushnotifications,b.paginginfo)}});return f.send()}}})(global);
(function(b){b.Appacitive.File=function(c){c=c||{};this.fileId=c.fileId;this.contentType=c.contentType;this.fileData=c.fileData;var e=this,f=function(c,d,f,g,h){var q=new b.Appacitive.HttpRequest;q.url=c;q.method="GET";q.description=g;q.onSuccess=d;q.promise=f;q.entity=e;q.options=h;b.Appacitive.http.send(q)},g=function(c,d,f,g,h){var q=new b.Appacitive.HttpRequest;q.url=c;q.method="PUT";q.log=!1;q.description="Upload file";q.data=d;q.headers.push({key:"Content-Type",value:f});q.send().then(g,function(b){h.reject(b,
e)})};this.save=function(b,c){"number"!==typeof b&&(c=b,b=-1);return this.fileId&&_type.isString(this.fileId)&&0<this.fileId.length?d(b,c):h(b,c)};var h=function(c,d){if(!e.fileData)throw Error("Please specify filedata");if(!e.contentType)try{e.contentType=e.fileData.type}catch(h){}e.contentType&&_type.isString(e.contentType)&&0!==e.contentType.length||(e.contentType="text/plain");var m=b.Appacitive.Promise.buildPromise(d),r=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(e.contentType,
e.fileId?e.fileId:"");f(r,function(b){g(b.url,e.fileData,e.contentType,function(){e.fileId=b.id;e.getDownloadUrl(c,d).then(function(b){return m.fulfill(b,e)},function(b){return m.reject(b)})},m)},m," Get upload url for file ",d);return m},d=function(c,d){if(!e.fileData)throw Error("Please specify filedata");if(!e.contentType)try{e.contentType=e.fileData.type}catch(h){}e.contentType&&_type.isString(e.contentType)&&0!==e.contentType.length||(e.contentType="text/plain");var m=b.Appacitive.Promise.buildPromise(d),
r=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(e.fileId,e.contentType);f(r,function(b){g(b.url,e.fileData,e.contentType,function(){e.getDownloadUrl(c,d).then(function(b){m.fulfill(b,e)},function(b){m.reject(b)})},m)},m," Get update url for file "+e.fileId,d);return m};this.destroy=function(c){if(!this.fileId)throw Error("Please specify fileId to delete");var d=b.Appacitive.Promise.buildPromise(c),f=new b.Appacitive.HttpRequest;f.url=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);f.method="DELETE";f.description="Delete file with id "+this.fileId;f.onSuccess=function(b){d.fulfill()};f.promise=d;f.entity=e;f.options=c;return b.Appacitive.http.send(f)};this.getDownloadUrl=function(c,d){if(!this.fileId)throw Error("Please specify fileId to download");"number"!==typeof c&&(d=c,c=-1);var g=b.Appacitive.Promise.buildPromise(d),h=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,
c);f(h,function(b){e.url=b.uri;g.fulfill(b.uri)},g," Get download url for file "+this.fileId,d);return g};this.getUploadUrl=function(c){e.contentType&&_type.isString(e.contentType)&&0!==e.contentType.length||(e.contentType="text/plain");var d=b.Appacitive.Promise.buildPromise(c),g=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");f(g,function(b){e.url=b.url;d.fulfill(b.url,e)},d," Get upload url for file "+this.fileId,c);
return d}}})(global);
(function(b){b.Appacitive.Date={};var c=function(b){return 10>b?"0"+b:b};b.Appacitive.Date.parseISODate=function(b){try{if(!/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(b))return new Date(b);var c=b.split("T"),g=c[0].split("-"),h=c[1].split("Z")[0].split(":"),d=h[2].split("."),l=Number(h[0]),k=new Date;k.setUTCFullYear(Number(g[0]));k.setUTCMonth(Number(g[1])-1);k.setUTCDate(Number(g[2]));k.setUTCHours(Number(l));k.setUTCMinutes(Number(h[1]));k.setUTCSeconds(Number(d[0]));
d[1]&&k.setUTCMilliseconds(Number(d[1].substring(0,3)));return k}catch(p){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(c){return null}};b.Appacitive.Date.toISODate=function(b){if(b instanceof Date)return String.format("{0}-{1}-{2}",b.getFullYear(),c(b.getMonth()+1),c(b.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};b.Appacitive.Date.toISOTime=function(b){var f=function(b){return 10>b?b+"000000":
100>b?b+"00000":1E3>b?b+"0000":1E4>b?b+"000":1E5>b?b+"00":1E6>b?b+"0":b};if(b instanceof Date)return String.format("{0}:{1}:{2}.{3}",c(b.getHours()),c(b.getMinutes()),c(b.getSeconds()),f(b.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};b.Appacitive.Date.parseISOTime=function(b){try{var c=new Date,g=b.split("T");1===g.length&&g.push(g[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(g[1]))return null;var h=g[1].split("Z")[0].split(":"),
d=h[2].split("."),l=Number(h[0]);1<g.length?(c.setUTCHours(Number(l)),c.setUTCMinutes(Number(h[1])),c.setUTCSeconds(Number(d[0])),d[1]&&c.setUTCMilliseconds(Number(d[1].substring(0,3)))):(c.setHours(Number(l)),c.setMinutes(Number(h[1])),c.setSeconds(Number(d[0])),d[1]&&c.setMilliseconds(Number(d[1].substring(0,3))));return c}catch(k){return null}}})(global);
(function(b){b.Appacitive.localStorage=new (b.Appacitive.runtime.isBrowser?function(){var c=b.Appacitive.runtime.isBrowser?window.localStorage:{getItem:function(){return null}},e=function(){try{return c.setItem("test","1"),c.removeItem("test"),!0}catch(b){return!1}};this.set=function(f,g){g=g||"";if(!f)return!1;if(_type.isObject(g)||_type.isArray(g))try{g=JSON.stringify(g)}catch(h){}e()?(f=b.Appacitive.getAppPrefix(f),c[f]=g):b.Appacitive.Cookie.setCookie(f,g);return this};this.get=function(f){if(!f)return null;
e()?(f=b.Appacitive.getAppPrefix(f),f=c.getItem(f)):f=b.Appacitive.Cookie.readCookie(f);if(!f)return null;if("{"===f[0])try{f=JSON.parse(f)}catch(g){}return f};this.remove=function(f){if(f)if(e()){f=b.Appacitive.getAppPrefix(f);try{delete c[f]}catch(g){}}else b.Appacitive.Cookie.eraseCookie(f)}}:function(){var c=[];this.set=function(e,f){f=f||"";if(!e||_type.isString(e))return!1;e=b.Appacitive.getAppPrefix(e);c[e]=f;return this};this.get=function(e){if(!e||_type.isString(e))return null;e=b.Appacitive.getAppPrefix(e);
return(e=c[e])?e:null};this.remove=function(e){if(e&&!_type.isString(e)){e=b.Appacitive.getAppPrefix(e);try{delete c[e]}catch(f){}}}})})(global);
(function(b){b.Appacitive.Cookie=new (b.Appacitive.runtime.isBrowser?function(){this.setCookie=function(c,e,f,g){c=b.Appacitive.getAppPrefix(c);var h="";f&&(h=new Date,h.setTime(h.getTime()+6E4*f),h.toGMTString());h=g?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";f="domain="+window.location.hostname;"localhost"==window.location.hostname&&(f="");document.cookie=c+"="+e+h+"; path=/;"+f};this.readCookie=function(c){c=
b.Appacitive.getAppPrefix(c);c+="=";for(var e=document.cookie.split(";"),f=0;f<e.length;f++){for(var g=e[f];" "==g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(c))return g.substring(c.length,g.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}}:function(){this.setCookie=function(c,e){b.Appacitive.localStorage.set("cookie/"+c,e)};this.readCookie=function(c){return b.Appacitive.localStorage.get("cookie/"+c)};this.eraseCookie=function(c){b.Appacitive.localStorage.remove("cookie/"+
c)}})})(global);"undefined"===typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
