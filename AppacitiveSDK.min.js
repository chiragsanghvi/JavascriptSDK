"bind"in Function.prototype||(Function.prototype.bind=function(b){var f=this;if(1>=arguments.length)return function(){return f.apply(b,arguments)};var e=Array.prototype.slice.call(arguments,1);return function(){return f.apply(b,0===arguments.length?e:e.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,f){void 0===f&&(f=0);0>f&&(f+=this.length);0>f&&(f=0);for(var e=this.length;f<e;f++)if(f in this&&this[f]===b)return f;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,f){void 0===f&&(f=this.length-1);0>f&&(f+=this.length);f>this.length-1&&(f=this.length-1);for(f++;0<f--;)if(f in this&&this[f]===b)return f;return-1});
"forEach"in Array.prototype||(Array.prototype.forEach=function(b,f){for(var e=0,c=this.length;e<c;e++)e in this&&b.call(f,this[e],e,this)});"map"in Array.prototype||(Array.prototype.map=function(b,f){for(var e=Array(this.length),c=0,g=this.length;c<g;c++)c in this&&(e[c]=b.call(f,this[c],c,this));return e});"filter"in Array.prototype||(Array.prototype.filter=function(b,f){for(var e=[],c,g=0,k=this.length;g<k;g++)g in this&&b.call(f,c=this[g],g,this)&&e.push(c);return e});
"every"in Array.prototype||(Array.prototype.every=function(b,f){for(var e=0,c=this.length;e<c;e++)if(e in this&&!b.call(f,this[e],e,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=function(b,f){for(var e=0,c=this.length;e<c;e++)if(e in this&&b.call(f,this[e],e,this))return!0;return!1});
Date.prototype.toISOString||function(){function b(b){b=String(b);1===b.length&&(b="0"+b);return b}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();
String.addSlashes=function(b){if(!b)return b;b=b.replace(/\\/g,"\\\\");b=b.replace(/\'/g,"\\'");b=b.replace(/\"/g,'\\"');return b=b.replace(/\0/g,"\\0")};String.stripSlashes=function(b){if(!b)return b;b=b.replace(/\\'/g,"'");b=b.replace(/\\"/g,'"');b=b.replace(/\\0/g,"\x00");return b=b.replace(/\\\\/g,"\\")};if("undefined"===typeof console||null===console)console={log:function(){},dir:function(){}};
for(var _type=function(b){if(null===b||"undefined"===typeof b||"undefined"===b)return"null";if(b&&(1===b.nodeType||9===b.nodeType))return"element";var f=Object.prototype.toString.call(b).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===f){if(isNaN(b))return"nan";if(!isFinite(b))return"infinity"}return f},types="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),generateMethod=function(b){_type["is"+b]=function(f){return _type(f)===b.toLowerCase()}},
i=0;i<types.length;i++)generateMethod(types[i]);_type.isNullOrUndefined=function(b){return"null"==_type(b)||"undefined"==_type(b)};_type.isNumeric=function(b){return!isNaN(parseFloat(b))&&isFinite(b)};Array.prototype.removeAll=function(b){for(var f=null,e=0;e<this.length;e++)for(;this[e]===b;)f=this.splice(e,1)[0];return f};
Array.prototype.compare=function(b){if(!b||this.length!=b.length)return!1;for(var f=0,e=this.length;f<e;f++)if(this[f]instanceof Array&&b[f]instanceof Array){if(!this[f].compare(b[f]))return!1}else if(this[f]!=b[f])return!1;return!0};
Array.prototype.equals=function(b,f){if(!b)return!1;1==arguments.length&&(f=!1);if(this.length!=b.length)return!1;for(var e=0;e<this.length;e++)if(this[e]instanceof Array&&b[e]instanceof Array){if(!this[e].equals(b[e],f))return!1}else{if(f&&this[e]!=b[e])return!1;if(!f)return this.sort().equals(b.sort(),!0)}return!0};var global={};
(function(){global="undefined"===typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(c){if(c&&c.send&&_type.isFunction(c.send))c.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var b=[],e={},k=0,g={},f=0;this.addProcessor=function(c){c&&(c.pre=c.pre||function(){},c.post=c.post||function(){},r(c.pre),t(c.post))};var r=function(c){k+=1;e[k]=c;return k},
t=function(c){f+=1;g[f]=c;return f};this.enqueueRequest=function(c){b.push(c)};this.changeRequestForCors=function(c){var b={m:c.method.toUpperCase()};c.headers.forEach(function(c){b[c.key]=c.value});c.prevHeaders=c.headers;c.headers=[];c.headers.push({key:"Content-Type",value:"text/plain"});c.method="POST";c.data&&(b.b=c.data);delete c.data;global.Appacitive.config.debug&&(-1===c.url.indexOf("?")?c.url+="?debug=true":c.url+="&debug=true");try{c.data=JSON.stringify(b)}catch(e){}return c};this.notify=
function(){if(0!==b.length){var k=[],f;for(f in g)g.hasOwnProperty(f)&&k.push(g[f]);for(;0<b.length;){var n=b.shift(),q=[];for(f in e)e.hasOwnProperty(f)&&q.push(e[f](n));this.changeRequestForCors(n);c.send(n,k,q)}}};this.onResponse=function(c){console.dir(c)}},f=function(){var c=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=c;this.onResponse=function(b,e){c()};this.onError=function(b){c()}},e=null,e=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest,
c=function(c){var b=global.Appacitive.Promise.buildPromise({success:c.onSuccess,error:c.onError}),e=new XDomainRequest;e.onload=function(){var c=e.responseText;try{var l=e.contentType;if("application/json"==l.toLowerCase()||"application/javascript"==l.toLowerCase()||"application/json; charset=utf-8"==l.toLowerCase()||"application/json; charset=utf-8;"==l.toLowerCase())l=c,global.Appacitive.runtime.isBrowser||"{"!=l[0]&&(l=l.substr(1,l.length-1)),c=JSON.parse(l)}catch(k){}b.fulfill(c,this)};e.onerror=
e.ontimeout=function(){b.reject(e)};e.onprogress=function(){};-1===c.url.indexOf("?")?c.url+="?ua=ie":c.url+="&ua=ie";e.open(c.method,c.url,!0);e.send(c.data);return b},g=function(b){if(!b.url)throw Error("Please specify request url");b.method||(b.method="GET");b.headers||(b.headers=[]);var k={};b.onSuccess&&_type.isFunction(b.onSuccess)||(b.onSuccess=function(){});b.onError&&_type.isFunction(b.onError)||(b.onError=function(){});var g=global.Appacitive.Promise.buildPromise({success:b.onSuccess,error:b.onError}),
f=!0;b.headers.forEach(function(c){"content-type"==c.key.toLowerCase()&&(f=!0,"application/json"==c.value.toLowerCase()||"application/javascript"==c.value.toLowerCase()||"application/json; charset=utf-8"==c.value.toLowerCase()||"application/json; charset=utf-8;"==c.value.toLowerCase())&&(f=!1)});if(f)k=b.data;else if(b.data&&(k=b.data,_type.isObject(b.data)))try{k=JSON.stringify(k)}catch(h){}if(!global.navigator||-1==global.navigator.userAgent.indexOf("MSIE 8")&&-1==global.navigator.userAgent.indexOf("MSIE 9")){var q=
new e;q.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var b=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase()||"application/json; charset=utf-8"==b.toLowerCase()||"application/json; charset=utf-8;"==b.toLowerCase())b=c,global.Appacitive.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),c=JSON.parse(b)}catch(e){}g.fulfill(c,
this)}else g.reject(this)};q.open(b.method,b.url,!0);for(var r=0;r<b.headers.length;r+=1)q.setRequestHeader(b.headers[r].key,b.headers[r].value);global.Appacitive.runtime.isBrowser||q.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");q.send(k);return g}b.data=k;return new c(b)},k=function(){var c=new f;c.isOnline=function(){return!0};var b=function(b,e,k){new g({method:b.method,url:b.url,headers:b.headers,data:b.data,onSuccess:function(g,f){if(g){try{g=JSON.parse(g)}catch(p){}var u=g;if(e.length!=
k.length)throw Error("Callback length and state length mismatch!");for(var v=0;v<e.length;v+=1)e[v].apply({},[u,k[v]]);if("200"<=g.code&&"300">=g.code||g.status&&"200"<=g.status.code&&"300">=g.status.code)c.onResponse(b,g);else g=g||{},g=g.status||g,g.message=g.message||"Bad Request",g.code=g.code||"400",c.onError(b,{responseText:JSON.stringify(g)})}else c.onError(b,{responseText:JSON.stringify({code:"400",message:"Invalid request"})})},onError:function(e){var g={};g.message=e.responseText||"Bad Request";
g.code=e.status||"400";c.onError(b,{responseText:JSON.stringify(g)})}})};c.send=function(c,e,g){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");_type.isFunction(c.beforeSend)&&c.beforeSend(c);b(c,e,g)};return c};global.Appacitive.http=new function(){var c=new k,e=new b(c),g=!1;this.pause=function(){g=!0};this.unpause=function(){g=!1};this.addProcessor=function(c){var b=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!c)throw b;
if(!c.pre&&!c.post)throw b;e.addProcessor(c)};this.send=function(b){b.promise=global.Appacitive.Promise.is(b.promise)?b.promise:new global.Appacitive.Promise.buildPromise({error:b.onError});e.enqueueRequest(b);c.isOnline()&&!1===g&&e.notify();return b.promise};this.flush=function(b){b?e.notify():c.isOnline()&&e.notify()};this.onError=function(c,b){var e;if(b&&b.responseText)try{var g=JSON.parse(b.responseText);g&&(e={code:g.code,message:g.message})}catch(k){}e=e||{code:b.status,message:b.responseText};
global.Appacitive.logs.logRequest(c,e,e,"error");c.promise.reject(e,c.entity)};c.onError=this.onError;this.onResponse=function(c,b){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[b]);else c.onSuccess(b);global.Appacitive.logs.logRequest(c,b,b?b.status:null,"successful")};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(c){c=c||{};this.url=c.url||"";this.data=c.data||{};this.headers=c.headers||[];this.method=c.method||"GET";this.onSuccess=c.onSuccess||function(){};this.onError=
c.onError||function(){};this.send=function(c){return new g(this,c)}};(function(c){c.Appacitive&&c.Appacitive.http&&(c.Appacitive.http.addProcessor({pre:function(c){return c},post:function(b,e){try{var g=c.Appacitive.Session.isSessionValid(b);g.status?b&&(b.status&&b.status.code&&"19036"==b.status.code||b.code&&"19036"==b.code)?c.Appacitive.Users.logout():c.Appacitive.Session.incrementExpiry():g.isSession&&(null!==c.Appacitive.Session.get()&&c.Appacitive.Session.resetSession(),c.Appacitive.http.send(e))}catch(k){}}}),
c.Appacitive.http.addProcessor({pre:function(c){return{start:(new Date).getTime(),request:c}},post:function(c,b){b.request.timeTakenInMilliseconds=(new Date).getTime()-b.start}}))})(global)})(this);
(function(b){b.Appacitive.logs=[];b.Appacitive.logs.errors=[];b.Appacitive.logs.exceptions=[];b.Appacitive.logs.logRequest=function(e,c,g,k){if(b.Appacitive.log){c=c||{};g=g||{};var l=JSON.parse(e.data),f={status:k,referenceId:g.referenceid,date:(new Date).toISOString(),method:l.m,url:e.url,responseTime:e.timeTakenInMilliseconds,headers:{},request:null,response:c};e.headers&&e.headers.forEach(function(c){f.headers[c.key]=c.value});e.prevHeaders&&e.prevHeaders.forEach(function(c){f.headers[c.key]=
c.value});"GET"!==f.method&&(f.request=l.b);"error"==k&&(console.dir(f),this.errors.push(f));this.push(f)}};var f=function(b,c){var g=[];b.forEach(function(b){b.method==c&&g.push(b)});return g};b.Appacitive.logs.getPutLogs=function(){return f(this,"PUT")};b.Appacitive.logs.getGetLogs=function(){return f(this,"GET")};b.Appacitive.logs.getPostLogs=function(){return f(this,"POST")};b.Appacitive.logs.getDeleteLogs=function(){return f(this,"DELETE")}})(global);
(function(b){String.format=function(b,e){if(1>=arguments.length)return b;for(var c=arguments.length-2,g=0;g<=c;g++)b=b.replace(RegExp("\\{"+g+"\\}","gi"),arguments[g+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var e=RegExp("^"+b),c=this;e.test(c)&&(c=c.slice(1,c.length));e=RegExp(b+"$");e.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(b){"undefined"===typeof b&&(b="");for(var e=
"",c=0;c<b.length;c+=1)-1===" .,;#".indexOf(b[c])&&(e+=b[c]);return e=e.toLowerCase()};String.contains=function(b,e){return-1!==b.indexOf(e)};String.startsWith=function(b,e){return 0===b.indexOf(e)};Array.distinct=function(b){var e=[],c=b.length,g,k,l;for(k=0;k<c;k++){g=void 0;for(l=0;l<e.length;l++)if(b[k].toLowerCase()===e[l].toLowerCase()){g=!0;break}g||e.push(b[k])}return e};Object.isEmpty=function(b){if(!b)return!0;var e=!0,c;for(c in b){e=!1;break}return e};b.dateFromWcf=function(b,e){var c=
/Date\(([^)]+)\)/.exec(b);if(2!=c.length){if(!e)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var f=function(b){"object"===typeof b&&(0<b.length&&("string"===typeof b[0]||"number"===typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.application={applicationServiceUrl:"application",getSessionCreateUrl:function(){return String.format("{0}/session",
this.applicationServiceUrl)}};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(b,c){return String.format("{0}/create?fields={1}",this.userServiceUrl,f(c))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c,g){return String.format("{0}/{1}?fields={2}",b,c,f(g))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token={1}",
this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",this.userServiceUrl,b)},getUpdateUrl:function(b,c,g){return g?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,b,f(c),g):String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,f(c))},getDeleteUrl:function(b,c,g){return!0===g?String.format("{0}/{1}?deleteconnections=true",this.userServiceUrl,c):String.format("{0}/{1}",this.userServiceUrl,c)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",
this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",
this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,g){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,b,c,g)},getResetPasswordUrl:function(b){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,b)},getValidateResetPasswordUrl:function(b){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,b)}};this.device={deviceServiceUrl:"device",
getCreateUrl:function(b,c){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,f(c))},getGetUrl:function(b,c,g){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,c,f(g))},getUpdateUrl:function(b,c,g){return g?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,b,f(c),g):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,f(c))},getDeleteUrl:function(b,c,g){return!0===g?String.format("{0}/{1}?deleteconnections=true",this.deviceServiceUrl,c):String.format("{0}/{1}",
this.deviceServiceUrl,c)}};this.object={objectServiceUrl:"object",getSearchAllUrl:function(b,c,g){var k="",k=String.format("{0}/search/{1}/all",this.objectServiceUrl,b),k=g?k+"?psize="+g:k+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!==c[b].trim().length&&(k=k+"&"+c[b]);return k},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.objectServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",
this.objectServiceUrl,b,c)},getMultiGetUrl:function(b,c,g){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.objectServiceUrl,b,c,f(g))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.objectServiceUrl,b,f(c))},getGetUrl:function(b,c,g){return String.format("{0}/{1}/{2}?fields={3}",this.objectServiceUrl,b,c,f(g))},getUpdateUrl:function(b,c,g,k){return k?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.objectServiceUrl,b,c,f(g),k):String.format("{0}/{1}/{2}?fields={3}",
this.objectServiceUrl,b,c,f(g))},getDeleteUrl:function(b,c,g){return!0===g?String.format("{0}/{1}/{2}?deleteconnections=true",this.objectServiceUrl,b,c):String.format("{0}/{1}/{2}",this.objectServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.objectServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,g){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,f(g))},getMultiGetUrl:function(b,c,g){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.connectionServiceUrl,b,c,f(g))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,f(c))},getUpdateUrl:function(b,c,g,k){return k?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,b,c,f(g),k):String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,f(g))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,g,k){var l="",l=String.format("{0}/{1}/find/all?label={2}&objectid={3}",this.connectionServiceUrl,b,g,c);if("undefined"!==typeof k&&0<k.length)for(b=0;b<k.length;b+=1)l=l+"&"+k[b];return l},getConnectedArticles:function(b,c,g){var k="",k=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,b,c);if(g&&g.length&&0<g.length)for(b=0;b<g.length;b+=1)k=0===b?k+("?"+g[b]):k+("&"+g[b]);return k},getInterconnectsUrl:function(){return String.format("{0}/interconnects",
this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,
b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b,c){return c&&0<c.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",this.fileServiceUrl,escape(b),escape(c)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""===location.search||-1===location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(g,k){var l=k.split("="),f=l[1];2<l.length&&l.forEach(function(b,c){0!==b&&1!==b&&(f=f+"="+
l[b])});l[0].toLowerCase()===b&&(c=[l[0],f])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(b){var f;f=b.Appacitive.runtime.isNode?process.nextTick:setTimeout;var e=function(){if(!(this instanceof e))return new e;this.calls=[]};e.prototype.isResolved=function(){return 1===this.state?!0:!1};e.prototype.isRejected=function(){return 2===this.state?!0:!1};e.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};e.prototype.done=function(){var c,g,k=this.state,l=this.value;if(!k)return this;for(;c=this.calls.shift();)if(g=c[0],"function"===typeof c[k]){try{l=
c[k].apply(g,this.value)}catch(f){b.Appacitive.log&&(b.Appacitive.logs.exceptions.push(f),console.log(JSON.stringify({name:f.name,message:f.message,stack:f.stack},null,2)));if(0==g.calls.length)throw f;g.reject(f)}l instanceof e||e.is(l)?l.then(function(b){g.fulfill(b)},function(b){g.reject(b)}):1===k?g.fulfill(l):g.reject(l)}else 1===k?g.fulfill(l):g.reject(l)};e.prototype.fulfill=function(){if(this.state)return this;this.state=1;this.value=arguments;this.done();return this};e.prototype.resolve=
e.prototype.fulfill;e.prototype.reject=function(){if(this.state)return this;this.state=2;this.reason=this.value=arguments;this.done();return this};e.prototype.then=function(b,g){var k=this,l=new e;this.calls[this.calls.length]=[l,b,g];this.state&&f(function(){k.done()});return l};e.when=function(b){var g=[],k=[],l,p=0,m=new e;if(!b)return m.fulfill(g),m;var n=function(){p+=1;p==l&&(m.state||(0<k.length?m.reject(k,g):m.fulfill(g)))},h=function(l){var h=b[l];h instanceof e||h&&"function"===typeof h.then?
f(function(){h.then(function(b){g[l]=b;n()},function(b){k[l]=b;n()})}):f(function(){try{g[l]=h.call()}catch(b){k[l]=b}n()})};Array.isArray(b)||(b=[b]);l=b.length;for(var q=0;q<l;q+=1)h(q);return m};e.is=function(b){return b instanceof e?!0:!1};e.buildPromise=function(b){var g=new e;_type.isObject(b)&&g.then(b.success,b.error);return g};b.Appacitive.Promise=e})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var e={};this.subscribe=function(c,g){if("string"!=typeof c||"function"!=typeof g)throw Error("Incorrect subscription call");"undefined"==typeof e[c]&&(e[c]=[]);var k=b();e[c].push({callback:g,id:k});return k};this.unsubscribe=function(b){if(!b)return!1;var g=-1,k=null,l;for(l in e)for(var f=0;f<e[l].length;f+=
1)if(e[l][f].id==b){g=f;k=l;break}return-1!=g?(e[k].splice(g,1),!0):!1};this.fire=function(b,g,k){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof k||null===k)k={};k.eventName=b;if("undefined"!=typeof e.all)for(var l=0;l<e.all.length;l+=1)e.all[l].callback(g,k);l=function(b,c,g){setTimeout(function(){b(c,g)},0)};if("undefined"!=typeof e[b])for(var f=0;f<e[b].length;f+=1)l(e[b][f].callback,g,k)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
e[b]&&(e[b].length=0);return this};this.clearAndSubscribe=function(b,g){this.clearSubscriptions(b);this.subscribe(b,g)};this.dump=function(){console.dir(e)}}})(global);(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/v1.0/"};"undefined"!=typeof XDomainRequest&&(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/v1.0/")})(global);
(function(b){var f=function(e){if(!e||!_type.isObject(e))throw Error("Please specify request options");this.promise=b.Appacitive.Promise.buildPromise(e.callbacks);var c=this.request=new b.Appacitive.HttpRequest,g;g=b.Appacitive.storage.urlFactory[e.type];g=b.Appacitive.config.apiBaseUrl+g[e.op].apply(g,e.args||[]);c.url=g;c.method=e.method||"get";c.data=e.data||{};c.onSuccess=e.onSuccess;c.onError=e.onError;c.promise=this.promise;e.entity&&(c.entity=e.entity);return this};f.prototype.send=function(){return b.Appacitive.http.send(this.request)};
b.Appacitive._Request=f})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var f=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},e=null,c=null,g=null,k=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(c){return b.Appacitive.Session.create(c)};this.create=function(g){if(!this.initialized)throw Error("Intialize Appacitive SDK");var k=new f;k.apikey=c;var l=new b.Appacitive._Request({method:"PUT",type:"application",op:"getSessionCreateUrl",
callbacks:g,data:k,onSuccess:function(c){e=c.session.sessionkey;b.Appacitive.Session.useApiKey=!1;l.promise.fulfill(c);b.Appacitive.Session.onSessionCreated()}});return l.send()};b.Appacitive.http.addProcessor({pre:function(l){b.Appacitive.Session.useApiKey?l.headers.push({key:"ak",value:c}):l.headers.push({key:"as",value:e});!0===k&&(1==l.headers.filter(function(b){return"ut"==b.key}).length?l.headers.forEach(function(b){"ut"==b.key&&(b.value=g)}):l.headers.push({key:"ut",value:g}))}});this.setUserAuthHeader=
function(c,e,l){try{c&&(k=!0,g=c,l||(e||(e=60),-1==e&&(e=null),b.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,e),b.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",e?e:-1,e)))}catch(f){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c){b.Appacitive.localStorage.remove("Appacitive-User");if(g&&c)try{var e=new b.Appacitive.Promise,l=new b.Appacitive.HttpRequest;l.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(g);
l.method="POST";l.data={};l.onSuccess=l.onError=function(){k=!1;g=null;b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken");b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry");e.fulfill()};b.Appacitive.http.send(l);return e}catch(f){}else return k=!1,g=null,b.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),b.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"),b.Appacitive.Promise().fulfill()};this.isSessionValid=function(b){if(!b)return!0;if(b.status){if(b.status.code&&
("19027"==b.status.code||"19002"==b.status.code))return{status:!1,isSession:"19027"==b.status.code?!0:!1}}else if(b.code&&("19027"==b.code||"19002"==b.code))return{status:!1,isSession:"19027"==b.code?!0:!1};return{status:!0}};this.resetSession=function(){e=null;this.useApiKey=!0};this.get=function(){return e};this.setSession=function(b){b&&(e=b,this.useApiKey=!1)};this.setApiKey=function(b){b&&(c=b,this.useApiKey=!0)};var l="sandbox";this.environment=function(){if(1==arguments.length){var b=arguments[0];
"sandbox"!=b&&"live"!=b&&(b="sandbox");l=b}return l}};b.Appacitive.getAppPrefix=function(f){return b.Appacitive.Session.environment()+"/"+b.Appacitive.appId+"/"+f};b.Appacitive.initialize=function(f){f=f||{};if(!b.Appacitive.Session.initialized){if(!f.apikey||0===f.apikey.length)throw Error("apikey is mandatory");if(!f.appId||0===f.appId.length)throw Error("appId is mandatory");b.Appacitive.Session.setApiKey(f.apikey);b.Appacitive.Session.environment(f.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.appId=
f.appId;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=f.persistUserToken;f.debug&&(b.Appacitive.config.debug=!0);f.log&&(b.Appacitive.log=[]);if(f.userToken)-1==f.expiry?f.expiry=null:f.expiry||(f.expiry=3600),b.Appacitive.Session.setUserAuthHeader(f.userToken,f.expiry),f.user?b.Appacitive.Users.setCurrentUser(f.user):(f=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(f);else if(b.Appacitive.runtime.isBrowser){var e=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(e){var c=b.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");c||(c=60);(f=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(f,e,c)}}}}})(global);(function(b){b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(f){f.headers.push({key:"e",value:b.Appacitive.Session.environment()})}})})(global);
(function(b){var f=b.Appacitive;f.GeoCoord=function(b,c){var g=function(b,c){if(isNaN(b)||isNaN(c))throw Error("Invalid Latitiude or longitiude provided");if(-90>b||90<b)throw Error("Latitude "+b+" should be in range of  -90.0 to 90.");if(-180>c||180<c)throw Error("Latitude "+c+" should be in range of  -180.0 to 180.");},k=function(b){if("string"!==typeof b||0==b.length)return!1;b=b.split(",");if(2!==b.length)return!1;try{return new f.GeoCoord(b[0],b[1])}catch(c){return!1}};if(_type.isString(b)&&
!c&&(k=k(b)))return k;b&&c?(g(b,c),this.lat=b,this.lng=c):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",b,c)};this.toString=function(){return this.getValue()}};var e=function(){this.toString=function(){};this.Or=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new n(h.or,b)};this.And=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new n(h.and,
b)}},c=function(b){e.call(this);b=b||{};this.fieldType=b.fieldType;this.field=b.field||"";this.value=b.value;this.operator=b.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue())}};c.prototype=new e;c.prototype.constructor=c;var g=function(b){b=b||"";
if(!_type.isArray(b.value)||!b.value.length)throw Error("Specify field value as array");c.call(this,b);this.toString=function(){for(var b=[],c=0;c<this.value.length;c+=1)b.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,_type.isString(this.value[c])?"'"+this.value[c]+"'":_type.isNumber(this.value[c])?this.value[c]:this.value[c].toString()));return"("+b.join(" or ")+")"}};g.prototype=new c;g.prototype.constructor=g;var k=function(b){b=b||"";if(!b.val1)throw Error("Specify field value1 ");
if(!b.val2)throw Error("Specify field value2 ");this.val1=b.val1;this.val2=b.val2;c.call(this,b);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};k.prototype=new c;k.prototype.constructor=k;var l=function(b){b=b||"";if(!(b.geoCoord&&b.geoCoord instanceof f.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,
b);this.value=b.geoCoord;this.unit=b.unit||"mi";this.distance=b.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};l.prototype=new c;l.prototype.constructor=k;var p=function(b){b=b||"";if(!b.geoCoords||0===b.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");if(3>b.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");
c.call(this,b);this.value=b.geoCoords;var g=function(b){var c="";b.forEach(function(b){c=0===c.length?b.toString():c+(" | "+b.toString())});return c};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,g(this.value))}};p.prototype=new c;p.prototype.constructor=k;var m=function(b){e.call(this);b=b||{};if(!b.tags||_type.isArray(b.tags)||0===b.tags.length)throw Error("Specify valid tags");this.tags=b.tags;this.operator=b.operator;
this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};m.prototype=new e;m.prototype.constructor=m;var n=function(b,c){if(!c||!c.length||2>c.length)throw Error("Provide valid or atleast 2 filters");this.operator=b;this.innerFilters=[];for(var g=0;g<c.length;g+=1){if(!(c[g]instanceof e))throw Error("Invalid filter provided");this.innerFilters.push(c[g])}this.toString=function(){var b=this.operator,c="(";this.innerFilters.forEach(function(g){c=1===c.length?c+
(" "+g.toString()):c+String.format(" {0} {1} ",b,g.toString())});return c+=")"}};n.prototype=new e;n.prototype.constructor=n;var h={isEqualTo:"==",isGreaterThan:">",isGreaterThanEqualTo:">=",isLessThan:"<",isLessThanEqualTo:"<=",like:"like",match:"match",between:"between",withinCircle:"within_circle",withinPolygon:"within_polygon",or:"or",and:"and",taggedWithAll:"tagged_with_all",taggedWithOneOrMore:"tagged_with_one_or_more"},q=function(b,c){if(null===b||void 0===b||0===b.length)throw Error("Specify value");
this.value=b;this.type=c?c:typeof this.value;if("number"===this.type&&!_type.isNumeric(this.value))throw Error("Value should be numeric for filter expression");this.getValue=function(){return"string"===this.type?"'"+this.value+"'":"number"===this.type||_type.isBoolean(this.value)?this.value:"object"===this.type&&this.value instanceof date?"datetime('"+f.Date.toISOString(this.value)+"')":this.value.toString()}},r=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"date('"+
f.Date.toISODate(this.value)+"')":"date('"+this.value+"')"}},t=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"time('"+f.Date.toISOTime(this.value)+"')":"time('"+this.value+"')"}},u=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"datetime('"+f.Date.toISOString(this.value)+"')":"datetime('"+this.value+"')"}},v=function(b,e,f){f||(f=this);f.type=b;f.name=e;f.equalTo=function(b){return new c({field:this.name,fieldType:this.type,
value:new q(b),operator:h.isEqualTo})};f.equalToNumber=function(b){return new c({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:h.isEqualTo})};f.equalToDate=function(b){return new c({field:this.name,fieldType:this.type,value:new r(b),operator:h.isEqualTo})};f.equalToTime=function(b){return new c({field:this.name,fieldType:this.type,value:new t(b),operator:h.isEqualTo})};f.equalToDateTime=function(b){return new c({field:this.name,fieldType:this.type,value:new u(b),operator:h.isEqualTo})};
f.greaterThan=function(b){return new c({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:h.isGreaterThan})};f.greaterThanDate=function(b){return new c({field:this.name,fieldType:this.type,value:new r(b),operator:h.isGreaterThan})};f.greaterThanTime=function(b){return new c({field:this.name,fieldType:this.type,value:new t(b),operator:h.isGreaterThan})};f.greaterThanDateTime=function(b){return new c({field:this.name,fieldType:this.type,value:new u(b),operator:h.isGreaterThan})};
f.greaterThanEqualTo=function(b){return new c({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:h.isGreaterThanEqualTo})};f.greaterThanEqualToDate=function(b){return new c({field:this.name,fieldType:this.type,value:new r(b),operator:h.isGreaterThanEqualTo})};f.greaterThanEqualToTime=function(b){return new c({field:this.name,fieldType:this.type,value:new t(b),operator:h.isGreaterThanEqualTo})};f.greaterThanEqualToDateTime=function(b){return new c({field:this.name,fieldType:this.type,
value:new u(b),operator:h.isGreaterThanEqualTo})};f.lessThan=function(b){return new c({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:h.isLessThan})};f.lessThanDate=function(b){return new c({field:this.name,fieldType:this.type,value:new r(b),operator:h.isLessThan})};f.lessThanTime=function(b){return new c({field:this.name,fieldType:this.type,value:new t(b),operator:h.isLessThan})};f.lessThanDateTime=function(b){return new c({field:this.name,fieldType:this.type,value:new u(b),
operator:h.isLessThan})};f.lessThanEqualTo=function(b){return new c({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:h.isLessThanEqualTo})};f.lessThanEqualToDate=function(b){return new c({field:this.name,fieldType:this.type,value:new r(b),operator:h.isLessThanEqualTo})};f.lessThanEqualToTime=function(b){return new c({field:this.name,fieldType:this.type,value:new t(b),operator:h.isLessThanEqualTo})};f.lessThanEqualToDateTime=function(b){return new c({field:this.name,fieldType:this.type,
value:new u(b),operator:h.isLessThanEqualTo})};f.like=function(b){return new c({field:this.name,fieldType:this.type,value:new q("*"+b+"*"),operator:h.like})};f.match=function(b){return new c({field:this.name,fieldType:this.type,value:new q("*"+b+"*"),operator:h.match})};f.startsWith=function(b){return new c({field:this.name,fieldType:this.type,value:new q(b+"*"),operator:h.like})};f.endsWith=function(b){return new c({field:this.name,fieldType:this.type,value:new q("*"+b),operator:h.like})};f.contains=
function(b){return new g({field:this.name,fieldType:this.type,value:b,operator:h.isEqualTo})};f.between=function(b,c){return new k({field:this.name,fieldType:this.type,val1:new q(b,"number"),val2:new q(c,"number"),operator:h.between})};f.betweenDate=function(b,c){return new k({field:this.name,fieldType:this.type,val1:new r(b),val2:new r(c),operator:h.between})};f.betweenTime=function(b,c){return new k({field:this.name,fieldType:this.type,val1:new t(b),val2:new t(c),operator:h.between})};f.betweenDateTime=
function(b,c){return new k({field:this.name,fieldType:this.type,val1:new u(b),val2:new u(c),operator:h.between})};f.withinCircle=function(b,c,g){return new l({field:this.name,fieldType:this.type,geoCoord:b,distance:c,unit:g,operator:h.withinCircle})};f.withinPolygon=function(b){return new p({field:this.name,fieldType:this.type,geoCoords:b,operator:h.withinPolygon})}},y=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;v("property",b,this);return this},x=function(b){if(!b||
0===b.length)throw Error("Specify field name");this.field=b;var c=new v("aggregate",b);this.equalTo=function(b){return c.equalTo(b)};this.greaterThan=function(b){return c.greaterThan(b)};this.greaterThanEqualTo=function(b){return c.greaterThanEqualTo(b)};this.lessThan=function(b){return c.lessThan(b)};this.lessThanEqualTo=function(b){return c.lessThanEqualTo(b)};this.between=function(b,g){return c.between(b,g)};return this},w=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=
b;var c=new v("attribute",b);this.like=function(b){return c.like(b)};this.like=function(b){return c.match(b)};this.startWith=function(b){return c.startsWith(b)};this.endsWith=function(b){return c.endsWith(b)};this.equalTo=function(b){return c.equalTo(b)};this.contains=function(b){return c.contains(b)};return this};f.Filter={Property:function(b){return new y(b)},Aggregate:function(b){return new x(b)},Attribute:function(b){return new w(b)},Or:function(){return new n(h.or,arguments)},And:function(){return new n(h.and,
arguments)},taggedWithOneOrMore:function(b){return new m({tags:b,operator:h.taggedWithOneOrMore})},taggedWithAll:function(b){return new m({tags:b,operator:h.taggedWithAll})}}})(global);
(function(b){b.Appacitive.Queries={};var f=function(b){b=b||{};var c=1,e=20;this.pageNumber=function(){return 1==arguments.length?(c=arguments[0]||1,this):c};this.pageSize=function(){return 1==arguments.length?(e=arguments[0]||20,this):e};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};f.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var e=function(b){b=b||{};var c=null,e=!1;this.orderBy=function(){return 1===arguments.length&&_type.isString(arguments[0])?
(c=arguments[0],this):c};this.isAscending=function(){return 1===arguments.length?(e=void 0===arguments[0]||null==arguments[0]?!1:arguments[0],this):e};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};e.prototype.toString=function(){return this.orderBy()&&0<this.orderBy().length?"orderBy="+this.orderBy()+"&isAsc="+this.isAscending():""};var c=function(c){var k=c||{},l="",p="",m="",n=k.queryType||"BasicQuery",h=new f(c),q=new e(c),r=k.type||k.relation,t=k.relation?"connection":"object",u=this;
k.entity&&(this.entity=k.entity);this.type=function(){return t};this.entityType=function(){return r};this.queryType=function(){return n};this.pageQuery=function(){return h};this.pageNumber=function(){return 1===arguments.length?(h.pageNumber(arguments[0]),this):h.pageNumber()};this.pageSize=function(){return 1===arguments.length?(h.pageSize(arguments[0]),this):h.pageSize()};this.sortQuery=function(){return q};this.orderBy=function(){return 1===arguments.length?(q.orderBy(arguments[0]),this):q.orderBy()};
this.isAscending=function(){return 1===arguments.length?(q.isAscending(arguments[0]),this):q.isAscending()};this.filter=function(){return 1===arguments.length?(l=arguments[0],this):l};this.freeText=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?p=arguments[0]:_type.isArray(b)&&b.length&&(p=arguments[0].join(" "));return this}return p};this.fields=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?m=b:_type.isArray(b)&&b.length&&(m=b.join(","));return this}return m};
this.filter(k.filter||"");this.freeText(k.freeText||"");this.fields(k.fields||"");this.setFilter=function(b){this.filter(b)};this.setFreeText=function(b){this.freeText(b)};this.setFields=function(b){this.fields(b)};this.extendOptions=function(b){for(var c in b)k[c]=b[c];h=new f(k);q=new e(k);return this};this.getQueryString=function(){var b=h.toString(),c=q.toString();c&&(b+="&"+c);this.filter()&&(c=encodeURIComponent(this.filter().toString()),0<c.trim().length&&(b+="&query="+c));this.freeText()&&
0<this.freeText().trim().length&&(b+="&freetext="+encodeURIComponent(this.freeText())+"&language=en");this.fields()&&0<this.fields().trim().length&&(b+="&fields="+this.fields());return b};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+t+"/"+r+"/find/all?"+this.getQueryString()};this.toRequest=function(){var c=new b.Appacitive.HttpRequest;c.url=this.toUrl();c.method="get";return c};this.getOptions=function(){var b={},c;for(c in this)this.hasOwnProperty(c)&&!_type.isFunction(this[c])&&
(b[c]=this[c]);return b};this._setPaging=function(b){b&&(h.pageNumber(b.pagenumber),h.pageSize(b.pagesize),this.results=this.results||[],this.results.isLastPage=!1,this.results.total=b.totalrecords,this.results.pageNumber=b.pagenumber,this.results.pageSize=b.pagesize,b.pagenumber*b.pagesize>=b.totalrecords&&(this.results.isLastPage=!0))};this.fetch=function(c){var g=b.Appacitive.Promise.buildPromise(c);c=this.toRequest();c.onSuccess=function(c){var e;(e=c[t+"s"])||(e=[]);e=b.Appacitive["object"===
t?"Object":"Connection"]._parseResult(e,k.entity);u.results=e;u._setPaging(c.paginginfo);g.fulfill(u.results,c.paginginfo)};c.promise=g;c.entity=this;return b.Appacitive.http.send(c)};this.fetchNext=function(b){var c=this.pageNumber();this.pageNumber(++c);return this.fetch(b)};this.fetchPrev=function(b){var c=this.pageNumber(),c=c-1;0>=c&&(c=1);this.pageNumber(c);return this.fetch(b)};this.count=function(c){var g=b.Appacitive.Promise.buildPromise(c);c=this.toRequest();c.onSuccess=function(b){b=b||
{};b=b.paginginfo;var c=0,c=b?b.totalrecords:0;g.fulfill(c)};c.promise=g;c.entity=this;return b.Appacitive.http.send(c)}};b.Appacitive.Queries.FindAllQuery=function(b){b=b||{};if(!b.type&&!b.relation||b.type&&b.relation)throw Error("Specify either type or relation for basic filter query");b.queryType="BasicFilterQuery";c.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new c;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedObjectsQuery=
function(g){g=g||{};if(!g.relation)throw Error("Specify relation for connected objects query");if(!g.objectId)throw Error("Specify objectId for connected objects query");if(!g.type)throw Error("Specify type of object id for connected objects query");var e=g.type;delete g.type;g.queryType="ConnectedObjectsQuery";c.call(this,g);this.objectId=g.objectId;this.relation=g.relation;this.type=e;g.object instanceof b.Appacitive.Object&&(this.object=g.object);this.returnEdge=!0;void 0===g.returnEdge||(null===
g.returnEdge||g.returnEdge||this.prev)||(this.returnEdge=!1);this.label="";var l=this;_type.isString(g.label)&&0<g.label.length&&(this.label="&label="+g.label);this.toRequest=function(){var c=new b.Appacitive.HttpRequest;c.url=this.toUrl();c.method="get";return c};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.type+"/"+this.objectId+"/find?"+this.getQueryString()+this.label+"&returnEdge="+this.returnEdge};var f=function(c,g){var e=[];c.forEach(function(c){var k=
c.__edge;delete c.__edge;var l=b.Appacitive.Object._create(c,!0);k&&(k.__endpointa=g,k.__endpointb={objectid:c.__id,label:k.__label,type:c.__type},delete k.label,l.connection=b.Appacitive.Connection._create(k,!0));e.push(l)});l.object&&(l.object.children[l.relation]=e);return e};this.fetch=function(c){var n=b.Appacitive.Promise.buildPromise(c);c=this.toRequest();c.onSuccess=function(b){l.results=f(b.nodes?b.nodes:[],{objectid:g.objectId,type:e,label:b.parent});l._setPaging(b.paginginfo);n.fulfill(l.results,
b.paginginfo)};c.promise=n;c.entity=this;return b.Appacitive.http.send(c)};return this};b.Appacitive.Queries.ConnectedObjectsQuery.prototype=new c;b.Appacitive.Queries.ConnectedObjectsQuery.prototype.constructor=b.Appacitive.Queries.ConnectedObjectsQuery;b.Appacitive.Queries.GetConnectionsQuery=function(g){g=g||{};if(!g.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!g.objectId)throw Error("Specify objectId for GetConnectionsQuery query");if(!g.label||0===g.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");
g.type&&delete g.type;g.queryType="GetConnectionsQuery";c.call(this,g);this.objectId=g.objectId;this.relation=g.relation;this.label=g.label;this.toRequest=function(){var c=new b.Appacitive.HttpRequest;c.url=this.toUrl();c.method="get";return c};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?"+this.getQueryString()+"&objectid="+this.objectId+"&label="+this.label};return this};b.Appacitive.Queries.GetConnectionsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=
b.Appacitive.Queries.GetConnectionsQuery;b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery=function(g,e){g=g||{};delete g.entity;if(!g.objectAId||!_type.isString(g.objectAId)||0===g.objectAId.length)throw Error("Specify valid objectAId for GetConnectionsBetweenObjectsQuery query");if(!g.objectBId||!_type.isString(g.objectBId)||0===g.objectBId.length)throw Error("Specify objectBId for GetConnectionsBetweenObjectsQuery query");g.type&&delete g.type;g.queryType=e||"GetConnectionsBetweenObjectsQuery";
c.call(this,g);this.objectAId=g.objectAId;this.objectBId=g.objectBId;this.label="GetConnectionsBetweenObjectsForRelationQuery"===this.queryType()&&g.label&&_type.isString(g.label)&&0<g.label.length?"&label="+g.label:"";this.relation=g.relation&&_type.isString(g.relation)&&0<g.relation.length?g.relation+"/":"";this.toRequest=function(){var c=new b.Appacitive.HttpRequest;c.url=this.toUrl();c.method="get";return c};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+
"find/"+this.objectAId+"/"+this.objectBId+"?"+this.getQueryString()+this.label};return this};b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery.prototype=new c;b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery;b.Appacitive.Queries.GetConnectionsBetweenObjectsForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenObjectsForRelationQuery query");var e=new b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery(c,
"GetConnectionsBetweenObjectsForRelationQuery");e.fetch=function(e){var k=b.Appacitive.Promise.buildPromise(e);e=this.toRequest();e.onSuccess=function(e){k.fulfill(e.connection?b.Appacitive.Connection._create(e.connection,!0,c.entity):null)};e.promise=k;e.entity=this;return b.Appacitive.http.send(e)};return e};b.Appacitive.Queries.InterconnectsQuery=function(e){e=e||{};delete e.entity;if(!e.objectAId||!_type.isString(e.objectAId)||0===e.objectAId.length)throw Error("Specify valid objectAId for InterconnectsQuery query");
if(!(e.objectBIds&&_type.isArray(e.objectBIds)&&0<e.objectBIds.length))throw Error("Specify list of objectBIds for InterconnectsQuery query");e.type&&delete e.type;e.queryType="InterconnectsQuery";c.call(this,e);this.objectAId=e.objectAId;this.objectBIds=e.objectBIds;this.toRequest=function(){var c=new b.Appacitive.HttpRequest;c.url=this.toUrl();c.method="post";c.data={object1id:this.objectAId,object2ids:this.objectBIds};return c};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+
this.getQueryString()};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new c;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,e){if(!c||0===c.length)throw Error("Specify name of filter query");this.name=c;this.data={};this.queryType="GraphFilterQuery";if(e){this.data.placeholders=e;for(var l in this.data.placeholders)this.data.placeholders[l]=this.data.placeholders[l]}this.toRequest=
function(){var c=new b.Appacitive.HttpRequest;c.url=this.toUrl();c.method="post";c.data=this.data;return c};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(c){var e=b.Appacitive.Promise.buildPromise(c);c=this.toRequest();c.onSuccess=function(b){e.fulfill(b.ids?b.ids:[])};c.promise=e;c.entity=this;return b.Appacitive.http.send(c)}};b.Appacitive.Queries.GraphProjectQuery=function(c,e,l){if(!c||0===c.length)throw Error("Specify name of project query");
if(!e||!e.length)throw Error("Specify ids to project");this.name=c;this.data={ids:e};this.queryType="GraphProjectQuery";if(l){this.data.placeholders=l;for(var f in this.data.placeholders)this.data.placeholders[f]=this.data.placeholders[f]}this.toRequest=function(){var c=new b.Appacitive.HttpRequest;c.url=this.toUrl();c.method="post";c.data=this.data;return c};this.toUrl=function(){return b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var m=function(c){var e,g;for(g in c)if("status"!==
g){e=c[g];break}var k=function(c,e,g){var l=[];c.forEach(function(c){var f=c.__children;delete c.__children;var h=c.__edge;delete c.__edge;c=b.Appacitive.Object._create(c,!0);c.children={};for(var p in f)c.children[p]=[],c.children[p]=k(f[p].values,f[p].parent,c.id);h&&(h.__endpointa={objectid:g,label:e},h.__endpointb={objectid:c.id(),label:h.__label},delete h.__label,c.connection=b.Appacitive.Connection._create(h,!0));l.push(c)});return l};return k(e.values)};this.fetch=function(c){var e=b.Appacitive.Promise.buildPromise(c);
c=this.toRequest();c.onSuccess=function(b){e.fulfill(m(b))};c.promise=e;c.entity=this;return b.Appacitive.http.send(c)}}})(global);
var ArrayProto=Array.prototype,ObjectProto=Object.prototype,each=function(b,f,e){if(null!=b)if(ArrayProto.forEach&&b.forEach===ArrayProto.forEach)b.forEach(f,e);else if(b.length===+b.length)for(var c=0,g=b.length;c<g&&f.call(e,b[c],c,b)!=={};c++);else for(c in b)if(ObjectProto.hasOwnProperty.call(b,c)&&f.call(e,b[c],c,b)==={})break},_extend=function(b){each(ArrayProto.slice.call(arguments,1),function(f){if(f)for(var e in f)b[e]=f[e]});return b},extend=function(b,f){var e=this,c;c=_type.isObject(b)&&
b.hasOwnProperty("constructor")?b.constructor:function(){return e.apply(this,arguments)};_extend(c,e,f);var g=function(){this.constructor=c};g.prototype=e.prototype;c.prototype=new g;b&&_extend(c.prototype,b);c.__super__=e.prototype;return c};(function(b){b.Appacitive._extend=function(b,e,c){return extend.apply(b,[e,c])}})(global);
(function(b){b.Appacitive.BaseObject=function(f,e){var c={},g={},k={},l={},p=function(c,e){for(var f in c)if(g[f]&&delete g[f],k[f]&&delete k[f],l[f]&&delete l[f],_type.isString(c[f]))e[f]=c[f];else if(c[f]instanceof Date)e[f]=b.Appacitive.Date.toISOString(c[f]);else if(_type.isObject(c[f]))if(c[f]instanceof b.Appacitive.GeoCoord)e[f]=c[f].toString();else{e[f]||(e[f]={});for(var h in c[f])e[f][h]=c[f][h]}else if(_type.isArray(c[f])){if(e[f]=[],c[f].forEach(function(c){if(_type.isString(c))e[f].push(c);
else if(_type.isNumber(c)||_type.isBoolean(c))e[f].push(value+"");else if(c instanceof Date)e[f].push(b.Appacitive.Date.toISOString(c));else if("__link"==f)e[f].push(c);else throw Error("Multivalued property cannot have values of property as an object");}),"__tags"!==f||"__link"!==f)e[f].push=function(c){var e=this.length;if(_type.isString(c))this[e]=c;else if(_type.isNumber(c)||_type.isBoolean(c))this[e]=c+"";else if(c instanceof Date)this[e]=b.Appacitive.Date.toISOString(c);else throw Error("Multivalued property cannot have values of property as an object");
return this}}else e[f]=c[f]},m=this,n={};p(f,n);var h=n;e&&p(h,c);!c.__id&&n.__id&&(c.__id=n.__id);n.__type?(n.__type=n.__type.toLowerCase(),this.entityType="type",this.type="object",this.className=n.__type):n.__relationtype&&(n.__relationtype=n.__relationtype.toLowerCase(),this.entityType="relation",this.type="connection",this.className=n.__relationtype);this.cid=parseInt(1E6*Math.random(),10);h.__attributes||(h.__attributes={});c.__attributes||(c.__attributes={});var q=[];h.__tags||(h.__tags=[]);
c.__tags||(c.__tags=[]);var r="",t="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __type __relationtype __typeid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link __acls".split(" "),u=["__link","__endpointa","__endpointb"],v=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";return b};this.attributes=this.toJSON=this.getObject=function(){return JSON.parse(JSON.stringify(h))};this.properties=function(){var b=this.attributes();
delete b.__attributes;delete b.__tags;return b};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};this.attr=function(){if(0===arguments.length)h.__attributes||(h.__attributes={});else{if(1===arguments.length)return h.__attributes||(h.__attributes={}),h.__attributes[arguments[0]];if(2===arguments.length){if(!_type.isString(arguments[1])&&null!==arguments[1])throw Error("only string values can be stored in attributes.");h.__attributes||(h.__attributes=
{});h.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return h.__attributes};var y=function(){if(!h.__attributes)return null;if(!c.__attributes)return h.__attributes;var b=!1,e=JSON.parse(JSON.stringify(c.__attributes)),f;for(f in h.__attributes)null==h.__attributes[f]||void 0==h.__attributes[f]?(e[f]=null,b=!0):h.__attributes[f]!=c.__attributes[f]?(e[f]=h.__attributes[f],b=!0):h.__attributes[f]==c.__attributes[f]&&
delete e[f];return b?e:null};this.getChangedAttributes=y;this.aggregate=function(){var b={},c;for(c in h){if(!h.hasOwnProperty(c))return;"$"==c[0]&&(b[c.substring(1)]=h[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};this.tags=function(){return h.__tags?h.__tags:[]};this.addTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;h.__tags||(h.__tags=[]);h.__tags.push(b);
h.__tags=Array.distinct(h.__tags);if(!q||!q.length)return this;b=q.indexOf(b);-1!=b&&q.splice(b,1);return this};this.removeTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;q.push(b);q=Array.distinct(q);if(!h.__tags||!h.__tags.length)return this;b=h.__tags.indexOf(b);-1!=b&&h.__tags.splice(b,1);return this};var x=function(){if(!h.__tags)return[];if(!c.__tags)return h.__tags;var b=[];h.__tags.forEach(function(e){-1==c.__tags.indexOf(e)&&b.push(e)});return 0<b.length?b:null};this.getChangedTags=
x;this.getRemovedTags=function(){return _removetags};var w=function(b,c,e){if(!b||!_type.isString(b)||0===b.length||0==b.trim().indexOf("__")||0===b.trim().indexOf("$")||void 0==c||null==c)return this;b=b.toLowerCase();try{var f=function(c){if(!_type.isString(c))if(_type.isNumber(c)||_type.isBoolean(c))c+="";else throw Error("Multivalued property cannot have values of property as an object");if(h[b]&&_type.isArray(h[b])){var f=h[b].indexOf(c);"additems"==e?h[b].push(c):-1==f&&"adduniqueitems"==e?
h[b].push(c):"removeitems"==e&&h[b].removeAll(c)}else"removeitems"!=e&&(h[b]=[c]);k[b]||(k[b]={additems:[],adduniqueitems:[],removeitems:[]});k[b][e].push(c)};_type.isArray(c)?c.forEach(function(b){f(b)}):f(c);return m}catch(g){throw Error("Unable to add item to "+b);}};this.add=function(b,c){return w.apply(this,[b,c,"additems"])};this.addUnique=function(b,c){return w.apply(this,[b,c,"adduniqueitems"])};this.remove=function(b,c){return w.apply(this,[b,c,"removeitems"])};var z=function(b){var e=!1,
f=JSON.parse(JSON.stringify(c)),p;for(p in f)"$"==p[0]&&delete f[p];for(var n in h)null==h[n]||void 0==h[n]?(f[n]=null,e=!0):h[n]!=c[n]?"__tags"==n||"__attributes"==n?delete f[n]:_type.isArray(h[n])?k[n]&&!l[n]?(f[n]=k[n],e=!0):h[n].equals(c[n])?delete f[n]:(f[n]=h[n],e=!0):(f[n]=g[n]&&!l[n]?{incrementby:g[n].value}:h[n],e=!0):h[n]==c[n]&&delete f[n];try{t.forEach(function(b){f[b]&&delete f[b]})}catch(r){}p=x();b?(p&&(f.__addtags=p,e=!0),q&&0<q.length&&(f.__removetags=q,e=!0)):p&&(f.__addtags=p,e=
!0);(b=y())?(f.__attributes=b,e=!0):delete f.__attributes;"object"==m.type&&(b=m._aclFactory.getChanged())&&(f.__acls=b);return e&&!Object.isEmpty(f)?f:!1};this.changed=function(){return this.isNew()?this.toJSON():z()};this.hasChanged=function(){if(this.isNew())return!0;var b=z(!0);return 0===arguments.length?Object.isEmpty(b)?!1:!0:1==arguments.length&&_type.isString(arguments[0])&&0<arguments[0].length&&b&&b[arguments[0]]?!0:!1};this.changedAttributes=function(){if(this.isNew())return this.toJSON();
var b=z(!0);if(0===arguments.length)return b;if(1==arguments.length&&_type.isArray(arguments[0])&&arguments[0].length){var c={};arguments[0].forEach(function(e){b[e]&&c.push(b[e])});return c}return!1};this.previous=function(){return this.isNew()?null:1==arguments.length&&_type.isString(arguments[0])&&arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return this.isNew()?null:c};this.fields=function(){if(1==arguments.length){var b=arguments[0];_type.isString(b)?r=b:_type.isArray(b)&&
(r=b.join(","));return this}return r};var A={integer:function(b){if(b){var c=parseInt(b);if(!isNaN(c))return c}return b},decimal:function(b){if(b){var c=parseFloat(b);if(!isNaN(c))return c}return b},"boolean":function(b){return void 0!==b&&null!==b&&("true"===b.toString().toLowerCase()||!0===b||0<b)?!0:!1},date:function(c){if(c){var e=b.Appacitive.Date.parseISODate(c);if(e)return e}return c},datetime:function(c){if(c){var e=b.Appacitive.Date.parseISODate(c);if(e)return e}return c},time:function(c){if(c){var e=
b.Appacitive.Date.parseISOTime(c);if(e)return e}return c},string:function(b){return b?b.toString():b},geocode:function(c){if(!_type.isString(c)||0==c.trim().length)return!1;c=c.split(",");return 2!==c.length?!1:new b.Appacitive.GeoCoord(c[0],c[1])}};this.get=function(b,c){if(b){if(c&&A[c.toLowerCase()]){if(A[c.toLowerCase()])return A[c.toLowerCase()](h[b]);throw Error('Invalid cast-type "'+c+'"" provided for get "'+b+'"');}return h[b]}};this.tryGet=function(b,c,e){b=this.get(b,e);return void 0!==
b?b:c};this.set=function(e,f,p){if(!e||!_type.isString(e)||0===e.length||0===e.trim().indexOf("$"))return this;e=e.toLowerCase();try{if(void 0==f||null==f)h[e]=null;else if(_type.isString(f))h[e]=f;else if(_type.isNumber(f)||_type.isBoolean(f))h[e]=f+"";else if(f instanceof Date)h[e]="date"==p?b.Appacitive.Date.toISODate(f):"time"==p?b.Appacitive.Date.toISOTime(f):b.Appacitive.Date.toISOString(f);else if(_type.isObject(f))if(-1!==u.indexOf(e))h[e]=f;else if(f instanceof b.Appacitive.GeoCoord)h[e]=
f.toString();else throw Error("Property cannot have value as an object");else _type.isArray(f)&&(h[e]=[],f.forEach(function(b){if(_type.isString(b))h[e].push(b);else if(_type.isNumber(b)||_type.isBoolean(b))h[e].push(b+"");else{if(f instanceof Date)throw Error("Multivalued property cannot have values of property as date");throw Error("Multivalued property cannot have values of property as an object");}}),"tags"!==e||"__link"!==e)&&(h[e].push=function(b){var c=this.length;if(_type.isString(b))this[c]=
b;else if(_type.isNumber(b)||_type.isBoolean(b))this[c]=b+"";else throw Error("Multivalued property cannot have values of property as an object");return this});delete g[e];delete k[e];delete l[e];h[e]!==c[e]&&(_type.isArray(h[e])&&!h[e].equals(c[e])||_type.isString(h[e])||_type.isObject(h[e]))&&(l[e]=!0);return this}catch(m){throw Error("Unable to set "+e);}};this.unset=function(b){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;try{delete h[b]}catch(c){}return this};this.has=
function(b){return b&&_type.isString(b)&&0!==b.length?h[b]&&!_type.isUndefined(h[b])?!0:!1:!1};this.isNew=function(){return h.__id&&h.__id.length?!1:!0};this.clone=function(){return"object"==this.type?b.Appacitive.Object._create(this.toJSON()):new b.Appacitive.connection._create(this.toJSON())};this.copy=function(b,e){b&&(p(b,h),e&&p(b,c));return this};this.mergeWithPrevious=function(){p(h,c);q=[];g={};k={};l={};return this};var B=function(){p(c,h);q=[];g={};k={};l={}};this.rollback=function(){h=
n={};B();return this};var C=function(b,c,e){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();if(_type.isObject(h[b])||_type.isArray(h[b]))throw Error("Cannot increment/decrement array/object");try{return c=!c||isNaN(Number(c))?e:Number(c)*e,h[b]=isNaN(Number(h[b]))?c:Number(h[b])+c,m.isNew()||(g[b]={value:(g[b]?g[b].value:0)+c}),m}catch(f){throw Error("Cannot perform increment/decrement operation");}};this.increment=function(b,c){return C(b,c,1)};this.decrement=
function(b,c){return C(b,c,-1)};this.save=function(){return h.__id?E.apply(this,arguments):D.apply(this,arguments)};var D=function(e){var f=m.type;!h.__type||"user"!=h.__type.toLowerCase()&&"device"!=h.__type.toLowerCase()||(f=h.__type.toLowerCase());for(var g in h)"$"==g[0]&&delete h[g];h.__revision&&delete h.__revision;"object"==f&&(g=m._aclFactory.getChanged())&&(h.__acls=g);var k=new b.Appacitive._Request({method:"PUT",type:f,op:"getCreateUrl",args:[this.className,r],data:h,callbacks:e,entity:m,
onSuccess:function(e){var g=null;e&&(e.object||e.connection||e.user||e.device)&&(g=e.object||e.connection||e.user||e.device);e&&g?(c=g,h.__id=g.__id,B(),"connection"==m.type&&m.parseConnection(),b.Appacitive.eventManager.fire(m.entityType+"."+f+".created",m,{object:m}),m.created=!0,k.promise.fulfill(m)):(b.Appacitive.eventManager.fire(m.entityType+"."+f+".createFailed",m,{error:e.status}),k.promise.reject(e.status,m))}});return k.send()},E=function(e,f){b.Appacitive.Promise.is(f)||(f=b.Appacitive.Promise.buildPromise(e));
(function(e){var g=z(!0),k;for(k in g)"$"==k[0]&&delete g[k];if(Object.isEmpty(g))f.fulfill(m);else{k=r;var l=new b.Appacitive.HttpRequest,p=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[m.type].getUpdateUrl(h.__type||h.__relationtype,c.__id?c.__id:h.__id,k,e),n=m.type;h&&(h.__type&&("user"==h.__type.toLowerCase()||"device"==h.__type.toLowerCase()))&&(n=h.__type.toLowerCase(),p=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory[h.__type.toLowerCase()].getUpdateUrl(c.__id,
k,e));l.url=p;l.method="post";l.data=g;l.onSuccess=function(e){e&&e[n]?(c=e[n],B(),delete m.created,b.Appacitive.eventManager.fire(m.entityType+"."+n+"."+h.__id+".updated",m,{object:m}),f.fulfill(m)):(b.Appacitive.eventManager.fire(m.entityType+"."+n+"."+h.__id+".updateFailed",m,{object:e.status}),f.reject(e.status,m))};l.onError=function(b){b=v(b);f.reject(b,m)};b.Appacitive.http.send(l)}})();return f},F=function(e){if(!h.__id)throw Error("Please specify id for get operation");var f=this.type;h&&
(h.__type&&("user"==h.__type.toLowerCase()||"device"==h.__type.toLowerCase()))&&(f=h.__type.toLowerCase());var g=new b.Appacitive._Request({method:"GET",type:f,op:"getGetUrl",args:[this.className,h.__id,r],callbacks:e,entity:m,onSuccess:function(b){b&&b[f]?(c=b[f],p(c,h),b.connection&&(m.endpoints||m.endpointA&&m.endpointB||m.setupConnection(h.__endpointa,h.__endpointb)),g.promise.fulfill(m)):(b=b||{},b.status=b.status||{},b.status=v(b.status),g.promise.reject(b.status,m))}});return g.send()};this.fetch=
function(b){return F.apply(this,[b])};this.del=this.destroy=function(c,e){_type.isBoolean(c)?(e=c,c=null):_type.isBoolean(e)||(e=!1);if(!h.__id)return(new b.Appacitive.Promise.buildPromise(c)).fulfill();var f=this.type;!h.__type||"user"!=h.__type.toLowerCase()&&"device"!=h.__type.toLowerCase()||(f=h.__type.toLowerCase());var g=new b.Appacitive._Request({method:"DELETE",type:f,op:"getDeleteUrl",args:[this.className,h.__id,e],callbacks:c,entity:this,onSuccess:function(b){g.promise.fulfill(b)}});return g.send()}};
b.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(b){var f=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f(),c="",g,k,l,p,m,n,h=0,b=b.replace(/\r\n/g,"\n");k="";for(l=0;l<b.length;l++)p=b.charCodeAt(l),128>p?k+=String.fromCharCode(p):(127<p&&2048>p?k+=String.fromCharCode(p>>6|192):(k+=String.fromCharCode(p>>12|224),k+=String.fromCharCode(p>>6&63|128)),k+=String.fromCharCode(p&63|128));for(b=k;h<b.length;)g=b.charCodeAt(h++),k=b.charCodeAt(h++),
l=b.charCodeAt(h++),p=g>>2,g=(g&3)<<4|k>>4,m=(k&15)<<2|l>>6,n=l&63,isNaN(k)?m=n=64:isNaN(l)&&(n=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n);return c.toString()}})(global);
(function(b){var f=["allow","deny"],e=["create","read","update","delete","manageaccess"],c=function(b){var c=[];b.forEach(function(b){_type.isString(b)&&-1!=e.indexOf(b.toLowerCase())&&c.push(b.toLowerCase())});return c};b.Appacitive._Acl=function(b,k){var l=b||[];_type.isArray(l)||(l=[]);var p={};k&&(p=JSON.parse(JSON.stringify(l)));this.acls=l=JSON.parse(JSON.stringify(l));var m=[],n=function(b,e,g,k){if(!g)throw Error("Specify valid user or usergroup");var h=l.filter(function(b){return b.sid==
g&&b.type==e});h&&0!=h.length?h=h[0]:(h={sid:g,type:e,deny:[],allow:[]},l.push(h));h.allow||(h.allow=[]);h.deny||(h.deny=[]);k=c(k);var p=m.filter(function(b){return b.sid==g&&b.type==e});p&&0!=p.length?p=p[0]:(p={sid:g,type:e},m.push(p));k.forEach(function(c){for(var e=0;e<f.length;e+=1){var g=h[f[e]].indexOf(c);if(-1!=g){h[f[e]].splice(g,1);break}}"inherit"!=b&&h[b].push(c);p[c]=b});return this},h=function(b,c,e,f){if(!e)throw Error("Please provide valid id or name for setting acls");if(!f)throw Error("Please provide valid access permissions for setting acls");
_type.isArray(f)||(f=[f]);_type.isArray(e)?e.forEach(function(e){n(b,c,e,f)}):n(b,c,e,f);return this},q=function(){l.allowUser=function(b,c){return h.apply(this,["allow","user",b,c])};l.allowGroup=function(b,c){return h.apply(this,["allow","usergroup",b,c])};l.denyUser=function(b,c){return h.apply(this,["deny","user",b,c])};l.denyGroup=function(b,c){return h.apply(this,["deny","usergroup",b,c])};l.resetUser=function(b,c){return h.apply(this,["inherit","user",b,c])};l.resetGroup=function(b,c){return h.apply(this,
["inherit","usergroup",b,c])};l.allowAnonymous=function(b){return h.apply(this,["allow","usergroup",["anonymous"],b])};l.denyAnonymous=function(b){return h.apply(this,["deny","usergroup",["anonymous"],b])};l.resetAnonymous=function(b){return h.apply(this,["inherit","usergroup",["anonymous"],b])};l.allowLoggedIn=function(b){return h.apply(this,["allow","usergroup",["anonymous"],b])};l.denyLoggedIn=function(b){return h.apply(this,["deny","usergroup",["anonymous"],b])};l.resetLoggedIn=function(b){return h.apply(this,
["inherit","usergroup",["anonymous"],b])}};this._rollback=function(){m=[];l=JSON.parse(JSON.stringify(p));q()};this.getChanged=function(){var b=[];m.forEach(function(c){var g={sid:c.sid,type:c.type,allow:[],deny:[],inherit:[]};e.forEach(function(b){c[b]&&g[c[b]].push(b)});f.forEach(function(b){0==g[b].length&&delete g[b]});0==g.inherit.length&&delete g.inherit;b.push(g)});return 0==b.length?null:b};q();return this}})(global);
(function(b){b.Appacitive.Object=function(c,e){c=c||{};this.className&&(c.__type=this.className);_type.isString(c)&&(c={__type:c});if(!c.__type)throw Error("Cannot set object without __type");b.Appacitive.BaseObject.call(this,c,e);this.type="object";this.getObject=this.getObject;this.children={};this.toJSON=function(b){if(b){var c=function(b){var e=[];b.forEach(function(b){var f=b.getObject();if(b.children&&!Object.isEmpty(b.children)){f.children={};for(var g in b.children)f.children[g]=c(b.children[g])}b.connection&&
(f.__connection=b.connection.toJSON());e.push(f)});return e};return c([this])[0]}return this.getObject()};this.typeName=c.__type;this._aclFactory=new Appacitive._Acl(c.__acls,e);this.acls=this._aclFactory.acls;return this};b.Appacitive.Object.prototype=new b.Appacitive.BaseObject;b.Appacitive.Object.prototype.constructor=b.Appacitive.Object;b.Appacitive.Object.extend=function(c,e,k){if(!_type.isString(c))throw Error("Appacitive.Object.extend's first argument should be the type-name.");var l=null;
e=e||{};e.className=c;l=b.Appacitive._extend(b.Appacitive.Object,e,k);delete l.extend;l.className=c;return f[c]=l};var f={};b.Appacitive.Object._create=function(c,e,k){if(this.className)k=this;else if(!k){k=c.__type;if(!_type.isString(k))throw"_getClass requires a string argument.";var l=f[k];l||(l=b.Appacitive.Object.extend(k),f[k]=l);k=l}return!0==e?(new k(c)).copy(c,e):(new k(c)).copy(c)};var e=function(c,e){var f=[];c.forEach(function(c){c=b.Appacitive.Object._create(c,!0,e);f.push(c)});return f};
b.Appacitive.Object._parseResult=e;b.Appacitive.Object.multiDelete=function(c,e){c=c||{};this.className&&(c.type=this.className);if(!c.type||!_type.isString(c.type)||0===c.type.length)throw Error("Specify valid type");if("user"===c.type.toLowerCase()||"device"===c.type.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var f=new b.Appacitive._Request({method:"POST",data:{idlist:c.ids},type:"object",op:"getMultiDeleteUrl",
args:[c.type],callbacks:e,onSuccess:function(b){f.promise.fulfill()}});return f.send()};b.Appacitive.Object.multiGet=function(c,f){c=c||{};this.className&&(c.relation=this.className,c.entity=this);if(!c.type||!_type.isString(c.type)||0===c.type.length)throw Error("Specify valid type");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var k=new b.Appacitive._Request({method:"GET",type:"object",op:"getMultiGetUrl",args:[c.type,c.ids.join(","),c.fields],callbacks:f,onSuccess:function(b){k.promise.fulfill(e(b.objects,
c.entity))}});return k.send()};b.Appacitive.Object.get=function(c,e){c=c||{};this.className&&(c.relation=this.className,c.entity=this);if(!c.type)throw Error("Specify type");if(!c.id)throw Error("Specify id to fetch");var f=b.Appacitive.Object._create({__type:c.type,__id:c.id});f.fields=c.fields;return f.fetch(e)};b.Appacitive.Object.prototype.getConnections=function(c){if(this.isNew())throw Error("Cannot fetch connections for new object");c.objectId=this.get("__id");return new b.Appacitive.Queries.GetConnectionsQuery(c)};
b.Appacitive.Object.prototype.getConnectedObjects=function(c){if(this.isNew())throw Error("Cannot fetch connections for new object");c=c||{};_type.isString(c)&&(c={relation:c});c.type=this.get("__type");c.objectId=this.get("__id");c.object=this;return new b.Appacitive.Queries.ConnectedObjectsQuery(c)};b.Appacitive.Object.prototype.fetchConnectedObjects=b.Appacitive.Object.prototype.getConnectedObjects;b.Appacitive.Object.findAll=b.Appacitive.Object.findAllQuery=function(c){c=c||{};this.className&&
(c.type=this.className,c.entity=this);return new b.Appacitive.Queries.FindAllQuery(c)}})(global);
(function(b){var f=function(c,e,f){var g={label:c.label};c.objectid&&(g.objectid=c.objectid);if(c.object)c.object instanceof b.Appacitive.Object?c.object.id()?g.objectid=c.object.id():g.object=c.object.getObject():_type.isObject(c.object)&&(c.object.__id?g.objectid=c.object.__id:g.object=c.object,c.object=b.Appacitive.Object._create(c.object));else if(!g.objectid&&!g.object)throw Error("Incorrectly configured endpoints provided to parseConnection");f["endpoint"+e]=c;return g},e=function(c,e,f){c.object&&
_type.isObject(c.object)?(f["endpoint"+e]?f["endpoint"+e]&&f["endpoint"+e].object&&f["endpoint"+e].object instanceof b.Appacitive.Object?f["endpoint"+e].object.copy(c.object,!0):f["endpoint"+e].object=b.Appacitive.Object._create(c.object,!0):(f["endpoint"+e]={},f["endpoint"+e].object=b.Appacitive.Object._create(c.object,!0)),f["endpoint"+e].objectid=c.object.__id,f["endpoint"+e].label=c.label,f["endpoint"+e].type=c.type):f["endpoint"+e]=c};b.Appacitive.Connection=function(c,f){c=c||{};this.className&&
(c.__relationtype=this.className);_type.isString(c)&&(c={__relationtype:c});if(!c.__relationtype&&!c.relation)throw Error("Cannot set connection without relation");c.relation&&(c.__relationtype=c.relation,delete c.relation);c.endpoints&&2===c.endpoints.length&&(c.__endpointa=c.endpoints[0],c.__endpointb=c.endpoints[1],delete c.endpoints);b.Appacitive.BaseObject.call(this,c,f);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b="A",f="B";c.__endpointa.label.toLowerCase()!==
this.get("__endpointb").label.toLowerCase()||(c.__endpointa.label.toLowerCase()==c.__endpointb.label.toLowerCase()||c.__endpointa.objectid!=this.get("__endpointb").objectid&&c.__endpointa.objectid)||(b="B",f="A");e(this.get("__endpointa"),b,this);e(this.get("__endpointb"),f,this);this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;
throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b};return this};f?this.parseConnection(c):c.__endpointa&&c.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));this.relationName=c.__relationtype;return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=b.Appacitive.Connection;b.Appacitive.Connection.extend=function(e,f,g){if(!_type.isString(e))throw Error("Appacitive.Connection.extend's first argument should be the relation-name.");
var m=null;f=f||{};f.className=e;m=b.Appacitive._extend(b.Appacitive.Connection,f,g);delete m.extend;m.className=e;return c[e]=m};var c={};b.Appacitive.Connection._create=function(e,f,g){if(this.className)g=this;else if(!g){g=e.__relationtype;if(!_type.isString(g))throw"_getClass requires a string argument.";var m=c[g];m||(m=b.Appacitive.Connection.extend(g),c[g]=m);g=m}return!0==f?(new g(e)).copy(e,f):(new g(e)).copy(e)};var g=function(c,e){var f=[];c||(c=[]);c.forEach(function(c){f.push(b.Appacitive.Connection._create(c,
!0,e))});return f};b.Appacitive.Connection._parseResult=g;b.Appacitive.Connection.prototype.setupConnection=function(b,c){if(!(b&&(b.objectid||b.object)&&b.label&&c&&(c.objectid||c.object)&&c.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",f(b,"A",this));this.set("__endpointb",f(c,"B",this));this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;
if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b}};b.Appacitive.Connection.prototype.get=b.Appacitive.Connection.get=function(c,e){c=c||{};this.className&&(c.relation=this.className);if(!c.relation)throw Error("Specify relation");if(!c.id)throw Error("Specify id to fetch");var f=b.Appacitive.Connection._create({__relationtype:c.relation,__id:c.id});f.fields=
c.fields;return f.fetch(e)};b.Appacitive.Connection.multiGet=function(c,e){c=c||{};this.className&&(c.relation=this.className,c.entity=this);if(!c.relation||!_type.isString(c.relation)||0===c.relation.length)throw Error("Specify valid relation");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var f=new b.Appacitive._Request({method:"GET",type:"connection",op:"getMultiGetUrl",args:[c.relation,c.ids.join(","),c.fields],callbacks:e,onSuccess:function(b){f.promise.fulfill(g(b.connections,
c.entity))}});return f.send()};b.Appacitive.Connection.multiDelete=function(c,e){c=c||{};this.className&&(c.relation=this.className);if(!c.relation||!_type.isString(c.relation)||0===c.relation.length)throw Error("Specify valid relation");if(!c.ids||0===c.ids.length)throw Error("Specify ids to get");var f=new b.Appacitive._Request({method:"POST",data:{idlist:c.ids},type:"connection",op:"getMultiDeleteUrl",args:[c.relation],callbacks:e,onSuccess:function(b){f.promise.fulfill()}});return f.send()};b.Appacitive.Connection.findAll=
b.Appacitive.Connection.findAllQuery=function(c){c=c||{};this.className&&(c.relation=this.className,c.entity=this);return new b.Appacitive.Queries.FindAllQuery(c)};b.Appacitive.Connection.interconnectsQuery=b.Appacitive.Connection.getInterconnects=function(c){return new b.Appacitive.Queries.InterconnectsQuery(c)};b.Appacitive.Connection.betweenObjectsQuery=b.Appacitive.Connection.getBetweenObjects=function(c){return new b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery(c)};b.Appacitive.Connection.betweenObjectsForRelationQuery=
b.Appacitive.Connection.getBetweenObjectsForRelation=function(c){c=c||{};this.className&&(c.relation=this.className,c.entity=this);return new b.Appacitive.Queries.GetConnectionsBetweenObjectsForRelationQuery(c)}})(global);
(function(b){b.Appacitive.Users=new function(){var f=null;this.currentUser=this.current=function(){return f};var e=function(c,e,f){var g=this.get("__id");if(!g||!_type.isString(g)||0===g.length)throw Error("Please specify valid userid");if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid oldPassword");if(!e||!_type.isString(e)||0===e.length)throw Error("Please specify valid newPassword");var h=new b.Appacitive._Request({method:"POST",type:"user",op:"getUpdatePasswordUrl",args:[g],
callbacks:f,data:{oldpassword:c,newpassword:e},entity:this,onSuccess:function(b){h.promise.fulfill(that)}});return h.send()},c=function(c,e){var f=this.get("__id");if(!this.get("__id"))return this.set("__link",c),b.Appacitive.Promise.buildPromise(e).fulfill(this);var g=this,h=new b.Appacitive._Request({method:"POST",type:"user",op:"getLinkAccountUrl",args:[f],callbacks:e,data:c,entity:this,onSuccess:function(b){b=g.get("__link");_type.isArray(b)||(b=b?[b]:[]);b.push(c);g.copy({__link:b},!0);h.promise.fulfill(g)}});
return h.send()};this.setCurrentUser=function(c,g,k){if(!c)throw Error("Cannot set null object as user");var n=c;if(n instanceof b.Appacitive.User)if(n.get("__id")&&0!==n.get("__id").length)c=n.toJSON();else throw Error("Specify user __id");else n=new b.Appacitive.User(c,!0);b.Appacitive.localStorage.set("Appacitive-User",c);k||(k=60);f=n;g&&b.Appacitive.Session.setUserAuthHeader(g,k);f.logout=function(c){return b.Appacitive.Users.logout(c)};f.updatePassword=function(b,c,f){return e.apply(this,[b,
c,f])};f.logout=function(c){return b.Appacitive.Users.logout(c)};b.Appacitive.eventManager.clearAndSubscribe("type.user."+n.get("__id")+".updated",function(c,e){b.Appacitive.localStorage.set("Appacitive-User",e.object.getObject())});return f};var g=function(c,e){c=c||{};c.__type="user";b.Appacitive.Object.call(this,c,e);return this};g.prototype.linkedAccounts=function(){var b=this.get("__link");b?_type.isArray(b)||(b=[b]):b=[];return b};g.prototype.getAllLinkedAccounts=function(c){var e=this.get("__id");
if(!e||!_type.isString(e)||0===e.length)return b.Appacitive.Promise.buildPromise(c).fulfill(this.linkedAccounts(),this);var f=this,g=new b.Appacitive._Request({method:"GET",type:"user",op:"getGetAllLinkedAccountsUrl",args:[e],callbacks:c,entity:this,onSuccess:function(){var b=a.identities||[];0<b.length?f.set("__link",b):f.set("__link",null);g.promise.fulfill(b,f)}});return g.send()};g.prototype.checkin=function(c,e){var f=this.get("__id");f&&_type.isString(f)&&0!==f.length||onSuccess&&_type.isFunction(onSuccess)&&
onSuccess();if(!(c&&c instanceof b.Appacitive.GeoCoord))throw Error("Invalid coordinates provided");var g=this,h=new b.Appacitive._Request({method:"POST",type:"user",op:"getCheckinUrl",args:[f,c.lat,c.lngerId],callbacks:e,entity:this,onSuccess:function(){h.promise.fulfill(g)}});return h.send()};g.prototype.linkFacebook=function(b,e){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return c.apply(this,[{authtype:"facebook",accesstoken:b,name:"facebook"},e])};g.prototype.linkTwitter=
function(b,e){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var f={authtype:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret};b.consumerKey&&b.consumerSecret&&(f.consumersecret=b.consumerSecret,f.consumerkey=b.consumerKey);return c.apply(this,[f,e])};g.prototype.unlink=function(c,e){if(!_.isString(c))throw Error("Specify aouth account type for unlinking");var f=this.get("__id");if(!this.get("__id"))return this.set("__link",
null),promise.fulfill(this),promise;var g=this,h=new b.Appacitive._Request({method:"POST",type:"user",op:"getDelinkAccountUrl",args:[f,c],callbacks:e,entity:this,onSuccess:function(b){(b=g.get("__link"))?_type.isArray(b)||(b=[b]):b=[];if(0<=b.length){var e=null;b.forEach(function(b,f){b.name==c.toLowerCase()&&(e=f)});null!=e&&b.splice(e,1);g.copy({__link:b},!0)}else g.copy({__link:[]},!0);h.promise.fulfill(g)}});return h.send()};g.prototype.clone=function(){return new b.Appacitive.User(this.getObject())};
b.Appacitive.User=b.Appacitive.Object.extend("user",g.prototype);delete b.Appacitive.User._create;delete b.Appacitive.User._parseResult;delete b.Appacitive.User.multiDelete;this.deleteUser=function(c,e){if(!c)throw Error("Specify userid for user delete");return(new b.Appacitive.Object({__type:"user",__id:c})).del(!0,e)};this.deleteCurrentUser=function(c){var e=b.Appacitive.Promise.buildPromise(c);if(null===f)return b.Appacitive.Session.removeUserAuthHeader(),e.fulfill(),e;c=f.get("__id");this.deleteUser(c).then(function(){f=
null;b.Appacitive.Session.removeUserAuthHeader();e.fulfill()},function(){e.reject(arguments)});return e};this.createUser=this.createNewUser=function(c,e){c=c||{};c.__type="user";if(!c.username||!c.password||!c.firstname||0===c.username.length||0===c.password.length||0===c.firstname.length)throw Error("username, password and firstname are mandatory");return(new b.Appacitive.User(c)).save(e)};this.signup=function(c,e){var f=this,g=b.Appacitive.Promise.buildPromise(e);this.createUser(c).then(function(){f.login(c.username,
c.password).then(function(){g.fulfill.apply(g,arguments)},function(b){g.reject.apply(g,arguments)})},function(){g.reject(arguments)});return g};this.authenticateUser=function(c,e,g){c.expiry||(c.expiry=864E5);var k=this,h=new b.Appacitive._Request({method:"POST",type:"user",op:"getAuthenticateUserUrl",callbacks:e,data:c,onSuccess:function(b){b&&b.user?(g&&(b.user.__authType=g),k.setCurrentUser(b.user,b.token,c.expiry),h.promise.fulfill({user:f,token:b.token})):h.promise.reject(b.status)}});return h.send()};
this.login=function(b,c,e){if(!b||!c||0==b.length||0==c.length)throw Error("Please specify username and password");return this.authenticateUser({username:b,password:c,expiry:864E5},e,"BASIC")};this.loginWithFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return this.authenticateUser({accesstoken:b,type:"facebook",expiry:864E5,createnew:!0},c,"FB")};this.loginWithTwitter=function(b,c){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");
var e={type:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret,expiry:864E5,createnew:!0};b.consumerKey&&b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=b.consumerKey);return this.authenticateUser(e,c,"TWITTER")};this.validateCurrentUser=function(c,e){var f=b.Appacitive.Promise.buildPromise({success:e});e&&_type.isBoolean(e)&&(c=e,e=function(){});var g=b.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(!g)return f.fulfill(!1),f;if(c)f.fulfill(!0);else try{var h=
this;this.getUserByToken(g).then(function(b){h.setCurrentUser(b,g);f.fulfill(!0)},function(){f.fulfill(!1)})}catch(k){f.fulfill(!1)}return f};var k=function(c,e,f){var g=new b.Appacitive._Request({method:"GET",type:"user",op:c,callbacks:f,args:e,onSuccess:function(c){c&&c.user?g.promise.fulfill(new b.Appacitive.User(c.user)):g.promise.reject(c.status)}});return g.send()};this.getUserByToken=function(c,e){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid token");b.Appacitive.Session.setUserAuthHeader(c,
0,!0);return k("getUserByTokenUrl",[c],e)};this.getUserByUsername=function(b,c){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");return k("getUserByUsernameUrl",[b],c)};this.logout=function(c){f=null;return b.Appacitive.Session.removeUserAuthHeader(c)};this.sendResetPasswordEmail=function(c,e,f){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid username");if(!e||!_type.isString(e)||0===e.length)throw Error("Plase specify subject for email");
var g=new b.Appacitive._Request({method:"POST",type:"user",op:"getSendResetPasswordEmailUrl",callbacks:f,data:{username:c,subject:e},onSuccess:function(){g.promise.fulfill()}});return g.send()};this.resetPassword=function(c,e,f){if(!c)throw Error("Please specify token");if(!e||0===e.length)throw Error("Please specify password");var g=new b.Appacitive._Request({method:"POST",type:"user",op:"getResetPasswordUrl",callbacks:f,data:{newpassword:e},args:[c],onSuccess:function(){g.promise.fulfill()}});return g.send()};
this.validateResetPasswordToken=function(c,e){if(!c)throw Error("Please specify token");var f=new b.Appacitive._Request({method:"POST",type:"user",op:"getValidateResetPasswordUrl",callbacks:e,data:{},args:[c],onSuccess:function(b){f.promise.fulfill(b.user)}});return f.send()}}})(global);
(function(b){var f=function(){var e=null,c=this.FB=null,f=!1;this.initialize=function(b){if(!Facebook)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!b.appId)throw Error("Please provide appid");if(!b.appSecret)throw Error("Please provide app secret");c=b.appSecret;this.FB=new (require("facebook-node-sdk"))({appId:_appId,secret:c});f=!0};this.requestLogin=function(b){b&&(e=b);return(new Appacitive.Promise).fulfill()};this.getCurrentUserInfo=function(){if(!f)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
var b=new Appacitive.Promise;this.FB&&e?this.FB.api("/me",function(c,e){e?b.fulfill(e):b.reject("Access token is invalid")}):b.reject("Either intialize facebook with your appid and appsecret or set accesstoken");return b};this.accessToken=function(){return 1===arguments.length?(e=arguments[0],this):e};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){b.Appacitive.Facebook.accessToken="";return(new Appacitive.Promise).fulfill()}};b.Appacitive.Facebook=
b.Appacitive.runtime.isBrowser?new function(){var e=null,c=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);c=!0};this.requestLogin=function(b){b=b||{};if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var f=new Appacitive.Promise;FB.login(function(b){b&&"connected"===b.status&&b.authResponse?(e=b.authResponse.accessToken,f.fulfill(b.authResponse)):
f.reject()},b);return f};this.getCurrentUserInfo=function(){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var b=new Appacitive.Promise;FB.api("/me",function(c){c&&!c.error?(e=FB.getAuthResponse().accessToken,b.fulfill(c)):b.reject()});return b};this.accessToken=function(){return 1===arguments.length?(e=arguments[0],this):e};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){e=null;var c=new Appacitive.Promise;
try{FB.logout(function(){b.Appacitive.Users.logout();c.fulfill()})}catch(f){c.reject(f.message)}return c}}:new f})(global);
(function(b){b.Appacitive.Email=new function(){var f={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return f};var e=function(c,e){var f=new b.Appacitive._Request({method:"POST",type:"email",op:"getSendEmailUrl",callbacks:e,data:c,entity:c,onSuccess:function(b){f.promise.fulfill(b.email)}});return f.send()};this.setupEmail=function(b){b=b||{};f.smtp.username=b.username||f.smtp.username;f.from=b.from||f.from;f.smtp.password=
b.password||f.smtp.password;f.smtp.host=b.smtp.host||f.smtp.host;f.smtp.port=b.smtp.port||f.smtp.port;f.smtp.enablessl=b.enableSSL||f.smtp.enablessl;f.replyto=b.replyTo||f.replyto};this.sendTemplatedEmail=function(b,g){if(!b||!b.to||!b.to.length||0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");
if(!b.templateName)throw Error("template name is mandatory to send an email");var k={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){k.smtp=f.smtp;if(!b.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");k.from=b.from||f.from;k.replyto=b.replyTo||f.replyto}return e(k,g)};this.sendRawEmail=function(b,g){if(!b||!b.to||!b.to.length||
0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.body)throw Error("body is mandatory to send an email");var k={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{content:b.body||"",ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){k.smtp=
f.smtp;if(!b.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");k.from=b.from||f.from;k.replyto=b.replyTo||f.replyto}return e(k,g)}}})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(f,e){if(!f)throw Error("Please specify push options");var c=new b.Appacitive._Request({method:"POST",type:"push",op:"getPushUrl",callbacks:e,data:f,entity:f,onSuccess:function(b){c.promise.fulfill(b.id)}});return c.send()};this.getNotification=function(f,e){if(!f)throw Error("Please specify notification id");var c=new b.Appacitive._Request({method:"GET",type:"push",op:"getGetNotificationUrl",args:[f],callbacks:e,onSuccess:function(b){c.promise.fulfill(b.pushnotification)}});
return c.send()};this.getAllNotifications=function(f,e){f?(f.pnum=f.pnum||1,f.psize=f.psize||20):f={pnum:1,psize:20};var c=new b.Appacitive._Request({method:"GET",type:"push",op:"getGetAllNotificationsUrl",args:[f],callbacks:e,onSuccess:function(b){c.promise.fulfill(b.pushnotifications,b.paginginfo)}});return c.send()}}})(global);
(function(b){b.Appacitive.File=function(f){f=f||{};this.fileId=f.fileId;this.contentType=f.contentType;this.fileData=f.fileData;var e=this,c=function(c,f,g){var h=new b.Appacitive.HttpRequest;h.url=c;h.method="GET";h.onSuccess=f;h.promise=g;h.entity=e;b.Appacitive.http.send(h)},g=function(c,f,g,h,k){(new FormData).append("fileToUpload",f);var l=new b.Appacitive.HttpRequest;l.url=c;l.method="PUT";l.data=f;l.headers.push({key:"content-type",value:g});l.send().then(h,function(){k.reject(d,e)})};this.save=
function(b){return this.fileId&&_type.isString(this.fileId)&&0<this.fileId.length?l(b):k(b)};var k=function(f){if(!e.fileData)throw Error("Please specify filedata");if(!e.contentType)try{e.contentType=e.fileData.type}catch(k){}e.contentType&&_type.isString(e.contentType)&&0!==e.contentType.length||(e.contentType="text/plain");var l=b.Appacitive.Promise.buildPromise(f);f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(e.contentType,e.fileId?e.fileId:"");c(f,function(b){g(b.url,
e.fileData,e.contentType,function(){e.fileId=b.id;e.getDownloadUrl().then(function(b){return l.fulfill(b,e)},function(b){return l.reject(b)})},l)},l);return l},l=function(f){if(!e.fileData)throw Error("Please specify filedata");if(!e.contentType)try{e.contentType=e.fileData.type}catch(k){}e.contentType&&_type.isString(e.contentType)&&0!==e.contentType.length||(e.contentType="text/plain");var l=b.Appacitive.Promise.buildPromise(f);f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUpdateUrl(e.fileId,
e.contentType);c(f,function(b){g(b.url,e.fileData,e.contentType,function(){e.getDownloadUrl().then(function(b){l.fulfill(b,e)},function(b){l.reject(b)})},l)},l);return l};this.deleteFile=function(c){if(!this.fileId)throw Error("Please specify fileId to delete");var f=b.Appacitive.Promise.buildPromise(c);c=new b.Appacitive.HttpRequest;c.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);c.method="DELETE";c.onSuccess=function(b){f.fulfill()};c.promise=
f;c.entity=e;return b.Appacitive.http.send(c)};this.getDownloadUrl=function(f,g){if(!this.fileId)throw Error("Please specify fileId to download");"number"!==typeof f&&(g=f,f=-1);var k=b.Appacitive.Promise.buildPromise(g),h=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,f);c(h,function(b){e.url=b.uri;k.fulfill(b.uri)},k);return k};this.getUploadUrl=function(f){e.contentType&&_type.isString(e.contentType)&&0!==e.contentType.length||(e.contentType="text/plain");
var g=b.Appacitive.Promise.buildPromise(f);f=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");c(f,function(b){e.url=b.url;g.fulfill(b.url,e)},g);return g}}})(global);
(function(b){b.Appacitive.Date={};var f=function(b){return 10>b?"0"+b:b};b.Appacitive.Date.parseISODate=function(b){try{if(!/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(b))return new Date(b);var c=b.split("T"),f=c[0].split("-"),k=c[1].split("Z")[0].split(":"),l=k[2].split("."),p=Number(k[0]),m=new Date;m.setUTCFullYear(Number(f[0]));m.setUTCMonth(Number(f[1])-1);m.setUTCDate(Number(f[2]));m.setUTCHours(Number(p));m.setUTCMinutes(Number(k[1]));
m.setUTCSeconds(Number(l[0]));l[1]&&m.setUTCMilliseconds(Number(l[1].substring(0,3)));return m}catch(n){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(c){return null}};b.Appacitive.Date.toISODate=function(b){if(b instanceof Date)return String.format("{0}-{1}-{2}",b.getFullYear(),f(b.getMonth()+1),f(b.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};b.Appacitive.Date.toISOTime=function(b){var c=
function(b){return 10>b?b+"000000":100>b?b+"00000":1E3>b?b+"0000":1E4>b?b+"000":1E5>b?b+"00":1E6>b?b+"0":b};if(b instanceof Date)return String.format("{0}:{1}:{2}.{3}",f(b.getHours()),f(b.getMinutes()),f(b.getSeconds()),c(b.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};b.Appacitive.Date.parseISOTime=function(b){try{var c=new Date,f=b.split("T");1===f.length&&f.push(f[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(f[1]))return null;
var k=f[1].split("Z")[0].split(":"),l=k[2].split("."),p=Number(k[0]);1<f.length?(c.setUTCHours(Number(p)),c.setUTCMinutes(Number(k[1])),c.setUTCSeconds(Number(l[0])),l[1]&&c.setUTCMilliseconds(Number(l[1].substring(0,3)))):(c.setHours(Number(p)),c.setMinutes(Number(k[1])),c.setSeconds(Number(l[0])),l[1]&&c.setMilliseconds(Number(l[1].substring(0,3))));return c}catch(m){return null}}})(global);
(function(b){b.Appacitive.localStorage=new (b.Appacitive.runtime.isBrowser?function(){var f=b.Appacitive.runtime.isBrowser?window.localStorage:{getItem:function(){return null}};this.set=function(e,c){c=c||"";if(!e)return!1;if(_type.isObject(c)||_type.isArray(c))try{c=JSON.stringify(c)}catch(g){}e=b.Appacitive.getAppPrefix(e);f[e]=c;return this};this.get=function(e){if(!e)return null;e=b.Appacitive.getAppPrefix(e);e=f.getItem(e);if(!e)return null;if("{"===e[0])try{e=JSON.parse(e)}catch(c){}return e};
this.remove=function(e){if(e){e=b.Appacitive.getAppPrefix(e);try{delete f[e]}catch(c){}}}}:function(){var f=[];this.set=function(e,c){c=c||"";if(!e||_type.isString(e))return!1;e=b.Appacitive.getAppPrefix(e);f[e]=c;return this};this.get=function(e){if(!e||_type.isString(e))return null;e=b.Appacitive.getAppPrefix(e);return(e=f[e])?e:null};this.remove=function(e){if(e&&!_type.isString(e)){e=b.Appacitive.getAppPrefix(e);try{delete f[e]}catch(c){}}}})})(global);
(function(b){b.Appacitive.Cookie=new (b.Appacitive.runtime.isBrowser?function(){this.setCookie=function(f,e,c,g){f=b.Appacitive.getAppPrefix(f);var k="";c&&(k=new Date,k.setTime(k.getTime()+6E4*c),k.toGMTString());k=g?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=f+"="+e+k+"; path=/;"+c};this.readCookie=function(f){f=
b.Appacitive.getAppPrefix(f);f+="=";for(var e=document.cookie.split(";"),c=0;c<e.length;c++){for(var g=e[c];" "==g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(f))return g.substring(f.length,g.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}}:function(){this.setCookie=function(f,e){b.Appacitive.localStorage.set("cookie/"+f,e)};this.readCookie=function(f){return b.Appacitive.localStorage.get("cookie/"+f)};this.eraseCookie=function(f){b.Appacitive.localStorage.remove("cookie/"+
f)}})})(global);"undefined"===typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
