try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(c,g){Object.defineProperty(this,c,{get:g,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(c,g){Object.defineProperty(this,c,{set:g,enumerable:!0,configurable:!0})}}))}catch(defPropException){}var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var c=function(a){if(!a||!a.send||"function"!=typeof a.send)throw Error("No applicable httpTransport class found");a.onResponse=this.onResponse;var b=[],d={},e=0,c={},g=0;this.addProcessor=function(a){if(a){a.pre=a.pre||function(){};a.post=a.post||function(){};var b=a.pre;e+=1;d[e]=b;a=a.post;g+=1;c[g]=a}};this.enqueueRequest=
function(a){b.push(a)};this.notify=function(){if(0!==b.length){var e=[],m;for(m in c)c.hasOwnProperty(m)&&e.push(c[m]);for(;0<b.length;){var g=b.shift(),l=[];for(m in d)d.hasOwnProperty(m)&&l.push(d[m](g));a.send(g,e,l)}}};this.onResponse=function(a){console.dir(a)}},g=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(){a()};this.onError=function(){a()}},d=null,d=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,
e=function(a,b){if("undefined"!==typeof XDomainRequest)throw Error("Appacitive doesn't support versions of IE6, IE7, IE8, IE9 due to crossdomain calls");if(!a.url)throw Error("Please specify request url");a.method||(a.method="GET");a.headers||(a.headers=[]);var e={};if(b)e=a.data;else try{a.data&&(e=a.data),e=JSON.stringify(e)}catch(c){}if(!a.onSuccess||"function"!=typeof a.onSuccess)a.onSuccess=function(){};if(!a.onError||"function"!=typeof a.onError)a.onError=function(){};var g=new d;g.onreadystatechange=
function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var b=this.responseText;try{var d=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==d.toLowerCase()||"application/javascript"==d.toLowerCase())d=b,global.Appacitive.runtime.isBrowser||"{"!=d[0]&&(d=d.substr(1,d.length-1)),b=JSON.parse(d)}catch(e){}a.onSuccess(b,this)}else a.onError({code:this.status,message:this.statusText},this)};g.open(a.method,a.url,!0);for(var l=
0;l<a.headers.length;l+=1)g.setRequestHeader(a.headers[l].key,a.headers[l].value);global.Appacitive.runtime.isBrowser||g.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");g.send(e);return g},b=function(){var a=new g;a.isOnline=function(){return!0};var b=function(b,d,c,h){h||b.headers.push({key:"content-type",value:"application/json"});new e({method:b.method,url:b.url,headers:b.headers,data:b.data,onSuccess:function(e){try{e=JSON.parse(e)}catch(h){}var g=e;if(d.length!=c.length)throw Error("Callback length and state length mismatch!");
for(var l=0;l<d.length;l+=1)d[l].apply({},[g,c[l]]);a.onResponse(e,b)},onError:function(d){a.onError(b,d)}})};a.send=function(a,f,d){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);b(a,f,d)};a.upload=function(a,f,d){"function"==typeof a.beforeSend&&a.beforeSend(a);b(a,f,d,!0)};return a};global.Appacitive.http=new function(){var a=new b,d=new c(a),e=!1;this.pause=function(){e=!0};this.unpause=function(){e=!1};this.addProcessor=
function(a){var b=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw b;if(!a.pre&&!a.post)throw b;d.addProcessor(a)};this.send=function(b){d.enqueueRequest(b);a.isOnline()&&!1==e&&d.notify()};this.flush=function(b){b?d.notify():a.isOnline()&&d.notify()};this.onError=function(a,b){if(a.onError)if(a.context)a.onError.apply(a.context,[b]);else a.onError(b)};a.onError=this.onError;this.onResponse=function(a,b){if(b.onSuccess)if(b.context)b.onSuccess.apply(b.context,
[a]);else b.onSuccess(a)};a.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new e(this,a)}};var a=global;a.Appacitive&&a.Appacitive.http&&(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(b,d){try{a.Appacitive.Session.isSessionValid(b)?b&&(b.status&&
b.status.code&&"8036"==b.status.code||b.code&&"8036"==b.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():(null!=a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(d))}catch(e){}}}),a.Appacitive.http.addProcessor({pre:function(){return(new Date).getTime()},post:function(a,b){var d=(new Date).getTime()-b;a._timeTakenInMilliseconds=d}}))})();
(function(c){String.format=function(c,d){if(1>=arguments.length)return c;for(var e=arguments.length-2,b=0;b<=e;b++)c=c.replace(RegExp("\\{"+b+"\\}","gi"),arguments[b+1]);return c};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(c){var d=RegExp("^"+c),e=this;d.test(e)&&(e=e.slice(1,e.length));d=RegExp(c+"$");d.test(e)&&(e=e.slice(0,-1));return e};String.toSearchString=function(c){"undefined"==typeof c&&(c="");for(var d=
"",e=0;e<c.length;e+=1)-1==" .,;#".indexOf(c[e])&&(d+=c[e]);return d=d.toLowerCase()};String.contains=function(c,d){return-1!=c.indexOf(d)};String.startsWith=function(c,d){return 0==c.indexOf(d)};Array.distinct=function(c){var d=[],e=c.length,b,a,f;for(a=0;a<e;a++){b=void 0;for(f=0;f<d.length;f++)if(c[a].toLowerCase()===d[f].toLowerCase()){b=!0;break}b||d.push(c[a])}return d};c.dateFromWcf=function(c,d){var e=/Date\(([^)]+)\)/.exec(c);if(2!=e.length){if(!d)return s;throw Error(s+" is not .net json date.");
}return new Date(parseFloat(e[1]))};c.Appacitive.storage=c.Appacitive.storage||{};c.Appacitive.storage.urlFactory=new function(){c.Appacitive.bag=c.Appacitive.bag||{};var g=function(d){if("object"==typeof d&&0<d.length&&("string"==typeof d[0]||"number"==typeof d[0]))d=d.join(",");d||(d="");return d};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(d){return String.format("{0}/create?fields={1}",
this.userServiceUrl,g(d))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,d,g(c))},getUserByTokenUrl:function(d){return string.format("{0}/me?useridtype=token&token=",this.userServiceUrl,d)},getUserByUsernameUrl:function(d){return string.format("{0}/{1}?useridtype=username",this.userServiceUrl,d)},getUpdateUrl:function(d,c){return String.format("{0}/{1}?fields={2}",
this.userServiceUrl,d,g(c))},getDeleteUrl:function(d){return String.format("{0}/{1}",this.userServiceUrl,d)},getGetAllLinkedAccountsUrl:function(d){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,d)},getValidateTokenUrl:function(d){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,d)},getInvalidateTokenUrl:function(d){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,d)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",
this.userServiceUrl)},getUpdatePasswordUrl:function(d){return String.format("{0}/{1}/changepassword",this.userServiceUrl,d)},getLinkAccountUrl:function(d){return String.format("{0}/{1}/link",this.userServiceUrl,d)},getDelinkAccountUrl:function(d,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,d,c)},getCheckinUrl:function(d,c,b){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,d,c,b)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(d){return String.format("{0}/register?fields={1}",
this.deviceServiceUrl,g(d))},getGetUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,d,g(c))},getUpdateUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,d,g(c))},getDeleteUrl:function(d){return String.format("{0}/{1}",this.deviceServiceUrl,d)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(d,c,b){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,d),a=b?a+"?psize="+b:a+"?psize=10";if("undefined"!==
typeof c&&0<c.length)for(d=0;d<c.length;d+=1)0!=c[d].trim().length&&(a=a+"&"+c[d]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(d,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,d,c)},getMultiGetUrl:function(d,c,b){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.articleServiceUrl,d,c,g(b))},getCreateUrl:function(d,c){return String.format("{0}/{1}?fields={2}",
this.articleServiceUrl,d,g(c))},getGetUrl:function(d,c,b){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,d,c,g(b))},getUpdateUrl:function(d,c,b){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,d,c,g(b))},getDeleteUrl:function(c,e){return String.format("{0}/{1}/{2}",this.articleServiceUrl,c,e)},getMultiDeleteUrl:function(c){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,c)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(c,
e,b){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,c,e,g(b))},getMultiGetUrl:function(c,e,b){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,c,e,g(b))},getCreateUrl:function(c,e){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,c,g(e))},getUpdateUrl:function(c,e,b){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,c,e,g(b))},getDeleteUrl:function(c,e){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,
c,e)},getMultiDeleteUrl:function(c){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,c)},getSearchByArticleUrl:function(c,e,b,a){var f="",f=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,c,b,e);if("undefined"!==typeof a&&0<a.length)for(c=0;c<a.length;c+=1)f=f+"&"+a[c];return f},getConnectedArticles:function(c,e,b){var a="",a=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,c,e);if(b&&b.length&&0<b.length)for(c=0;c<b.length;c+=1)a=0==
c?a+("?"+b[c]):a+("&"+b[c]);return a},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(c,e){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,c,e)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(c){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,c)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},
getGetNotificationUrl:function(c){return String.format("{0}/notification/{1}",this.pushServiceUrl,c)},getGetAllNotificationsUrl:function(c){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,c.psize,c.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(c){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(c))},getUpdateUrl:function(c,e){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,c,
escape(e))},getDownloadUrl:function(c,e){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,c,e)},getDeleteUrl:function(c){return String.format("{0}/delete/{1}",this.fileServiceUrl,c)}};this.query={params:function(c){var e=[];return""==location.search||-1==location.search.indexOf("?")?e:c?(c=c.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(b,a){var f=a.split("="),h=f[1];2<f.length&&f.forEach(function(a){0==a||1==a||(h=h+"="+f[a])});f[0].toLowerCase()==
c&&(e=[f[0],h])}),e):location.search.split("?")[1].split("=")}}}})(global);
(function(c){c.Appacitive.eventManager=new function(){var c={};this.subscribe=function(d,e){if("string"!=typeof d||"function"!=typeof e)throw Error("Incorrect subscription call");"undefined"==typeof c[d]&&(c[d]=[]);var b;b=function(){return Math.floor(65536*Math.random()).toString(16)};b=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();c[d].push({callback:e,id:b});return b};this.unsubscribe=function(d){if(!d)return!1;var e=-1,b=null,a;for(a in c)for(var f=0;f<c[a].length;f+=1)if(c[a][f].id==d){e=f;
b=a;break}return-1!=e?(c[b].splice(e,1),!0):!1};this.fire=function(d,e,b){if("string"!=typeof d)throw Error("Incorrect fire call");if("undefined"==typeof b||null===b)b={};b.eventName=d;if("undefined"!=typeof c.all)for(var a=0;a<c.all.length;a+=1)c.all[a].callback(e,b);a=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof c[d])for(var f=0;f<c[d].length;f+=1)a(c[d][f].callback,e,b)};this.clearSubscriptions=function(d){if("string"!=typeof d)throw Error("Event Name must be string in EventManager.clearSubscriptions");
c[d]&&(c[d].length=0);return this};this.clearAndSubscribe=function(c,e){this.clearSubscriptions(c);this.subscribe(c,e)};this.dump=function(){console.dir(c)}}})(global);(function(c){c.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"}})(global);
(function(c){c.Appacitive.Session=new function(){this.initialized=!1;var g=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},d=null,e=null,b=null,a=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){c.Appacitive.Session.create(null)};this.create=function(a,b){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var f=new g;f.apikey=e;var k=new c.Appacitive.HttpRequest;k.url=c.Appacitive.config.apiBaseUrl+"application.svc/session";
k.method="put";k.data=f;k.onSuccess=function(f){f&&f.status&&"200"==f.status.code?(d=f.session.sessionkey,c.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(f),c.Appacitive.Session.onSessionCreated()):b&&"function"==typeof b&&b(f)};k.onError=b;c.Appacitive.http.send(k)};c.Appacitive.http.addProcessor({pre:function(f){c.Appacitive.Session.useApiKey?f.headers.push({key:"appacitive-apikey",value:e}):f.headers.push({key:"appacitive-session",value:d});!0===a&&(1==f.headers.filter(function(a){return"appacitive-user-auth"==
a.key}).length?f.headers.forEach(function(a){"appacitive-user-auth"==a.key&&(a.value=b)}):f.headers.push({key:"appacitive-user-auth",value:b}))}});this.setUserAuthHeader=function(f,e,d){try{f&&(a=!0,b=f,d||(e||(e=60),-1==e&&(e=null),c.Appacitive.runtime.isBrowser&&(c.Appacitive.Cookie.setCookie("Appacitive-UserToken",f,e),c.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",e?e:-1,e))))}catch(g){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(f,e){f&&("function"!=typeof f&&
"boolean"==typeof f)&&(e=f,f=function(){});a=!1;f=f||function(){};c.Appacitive.localStorage.remove("Appacitive-User");c.Appacitive.runtime.isBrowser&&(c.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),c.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(b&&!e)try{var d=new c.Appacitive.HttpRequest;d.url=c.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(b);b=null;d.method="POST";d.data={};d.onSuccess=function(){"function"==typeof f&&f()};c.Appacitive.http.send(d)}catch(g){}else b=
null,"function"==typeof f&&f()};this.isSessionValid=function(a){if(!a)return!0;if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){d=null;this.useApiKey=!0};this.get=function(){return d};this.setSession=function(a){a&&(d=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(e=a,this.useApiKey=!0)};var f="sandbox";this.__defineGetter__("environment",function(){return f});
this.__defineSetter__("environment",function(a){"sandbox"!=a&&"live"!=a&&(a="sandbox");f=a})};c.Appacitive.initialize=function(g){if(!c.Appacitive.Session.initialized){if(!g.apikey||0==g.apikey.length)throw Error("apikey is mandatory");c.Appacitive.Session.setApiKey(g.apikey);c.Appacitive.Session.environment=g.env||"sandbox";c.Appacitive.useApiKey=!0;c.Appacitive.Session.initialized=!0;if(g.userToken)-1==g.expiry?g.expiry=null:g.expiry||(g.expiry=3600),c.Appacitive.Session.setUserAuthHeader(g.userToken,
g.expiry),g.user?c.Appacitive.Users.setCurrentUser(g.user):(g=c.Appacitive.localStorage.get("Appacitive-User"))&&c.Appacitive.Users.setCurrentUser(g);else if(c.Appacitive.runtime.isBrowser){var d=c.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(d){var e=c.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");e||(e=60);(g=c.Appacitive.localStorage.get("Appacitive-User"))&&c.Appacitive.Users.setCurrentUser(g,d,e)}}}}})(global);
(function(c){c.Appacitive&&c.Appacitive.http&&c.Appacitive.http.addProcessor({pre:function(g){g.headers.push({key:"appacitive-environment",value:c.Appacitive.Session.environment})}})})(global);
(function(c){c.Appacitive.Queries={};var g=function(b){b=b||{};var a=1,c=200;this.__defineGetter__("pageNumber",function(){return a});this.__defineSetter__("pageNumber",function(b){a=b||1});this.__defineGetter__("pageSize",function(){return c});this.__defineSetter__("pageSize",function(a){c=a||200});this.pageNumber=b.pageNumber;this.pageSize=b.pageSize};g.prototype.toString=function(){return"psize="+this.pageSize+"&pnum="+this.pageNumber};var d=function(b){b=b||{};var a="__UtcLastUpdatedDate",c=!1;
this.__defineGetter__("orderBy",function(){return a});this.__defineSetter__("orderBy",function(b){a=b||"__UtcLastUpdatedDate"});this.__defineGetter__("isAscending",function(){return c});this.__defineSetter__("isAscending",function(a){c="undefined"==typeof a?!1:a});this.orderBy=b.orderBy;this.isAscending=b.isAscending};d.prototype.toString=function(){return"orderBy="+this.orderBy+"&isAsc="+this.isAscending};var e=function(b){var a=b||{},f="",e="",j="",m=b.queryType,k=new g(b),l=new d(b),n=b.schema||
b.relation,p=b.schema?"article":"connection";this.__defineGetter__("type",function(){return p});this.__defineGetter__("entityType",function(){return n});this.__defineGetter__("queryType",function(){return m});this.__defineGetter__("pageQuery",function(){return k});this.__defineGetter__("sortQuery",function(){return l});this.__defineGetter__("filter",function(){return f});this.__defineSetter__("filter",function(a){f=a});this.__defineGetter__("freeText",function(){return e});this.__defineSetter__("freeText",
function(a){"string"==typeof a?e=a:"object"==typeof a&&a.length&&(e=a.join(" "))});this.__defineGetter__("fields",function(){return j});this.__defineSetter__("fields",function(a){"string"==typeof a?j=a:"object"==typeof a&&a.length&&(j=a.join(","))});this.filter=a.filter||"";this.freeText=a.freeText||"";this.fields=a.fields||"";this.setFilter=function(a){this.filter=a};this.setFreeText=function(a){this.freeText=a};this.setFields=function(a){this.fields=a};this.extendOptions=function(b){for(var c in b)a[c]=
b[c];k=new g(a);l=new d(a)};this.getQueryString=function(){var a=this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(a+="&query="+this.filter);this.freeText&&0<this.freeText.trim().length&&(a+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(a+="&fields="+this.fields);return a};this.toUrl=function(){return c.Appacitive.config.apiBaseUrl+n+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new c.Appacitive.HttpRequest;
a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};this.fetch=function(a,b){var f=this.toRequest();f.onSuccess=function(f){if(f&&f.status&&"200"==f.status.code){if("function"==typeof a){var e=f[p+"s"],d=[];e||(e=[]);var h="article"==p?"Article":"Connection";e.forEach(function(a){d.push(new c.Appacitive[h](a))});a(d,f.paginginfo)}}else f=f||{},"function"==typeof b&&b(f.status||
{message:"Server error",code:400})};f.onError=function(a){a=a||{};"function"==typeof b&&b(a.status||{message:"Server error",code:400})};c.Appacitive.http.send(f);return this}};c.Appacitive.Queries.BasicFilterQuery=function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";b=new e(b);b.toRequest=function(){var a=new c.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};b.toUrl=
function(){return c.Appacitive.config.apiBaseUrl+this.type+".svc/"+this.entityType+"/find/all?"+this.getQueryString()};return b};c.Appacitive.Queries.ConnectedArticlesQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for connected articles query");if(!b.articleId)throw Error("Specify articleId for connected articles query");b.schema&&delete b.schema;b.queryType="ConnectedArticlesQuery";var a=new e(b);a.articleId=b.articleId;a.relation=b.relation;a.label="";b.label&&("string"==
typeof b.label&&0<b.label.length)&&(a.label="&label="+b.label);a.toRequest=function(){var a=new c.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};a.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return a};c.Appacitive.Queries.GetConnectionsQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!b.articleId)throw Error("Specify articleId for GetConnectionsQuery query");
if(!b.label||0==b.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");b.schema&&delete b.schema;b.queryType="GetConnectionsQuery";var a=new e(b);a.articleId=b.articleId;a.relation=b.relation;a.label=b.label;a.toRequest=function(){var a=new c.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};a.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"connection/"+a.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+a.getQueryString()};return a};
c.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(b,a){b=b||{};if(!b.articleAId||"string"!=typeof b.articleAId||0==b.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!b.articleBId||"string"!=typeof b.articleBId||0==b.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");b.schema&&delete b.schema;b.queryType=a||"GetConnectionsBetweenArticlesQuery";var f=new e(b);f.articleAId=b.articleAId;
f.articleBId=b.articleBId;f.label="GetConnectionsBetweenArticlesForRelationQuery"==f.queryType&&b.label&&"string"==typeof b.label&&0<b.label.length?"&label="+b.label:"";f.relation=b.relation&&"string"==typeof b.relation&&0<b.relation.length?b.relation+"/":"";f.toRequest=function(){var a=new c.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};f.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+"?"+this.getQueryString()+
this.label};return f};c.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");b=new c.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(b,"GetConnectionsBetweenArticlesForRelationQuery");b.fetch=function(a,b){this.toUrl();var e=this.toRequest();e.onSuccess=function(e){e&&e.status&&"200"==e.status.code?"function"==typeof a&&a(new c.Appacitive.Connection(e.connection)):
(e=e||{},"function"==typeof b&&b(e.status||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof b&&b(a.status||{message:"Server error",code:400})};c.Appacitive.http.send(e);return this};return b};c.Appacitive.Queries.InterconnectsQuery=function(b){b=b||{};if(!b.articleAId||"string"!=typeof b.articleAId||0==b.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!b.articleBIds||"object"!=typeof b.articleBIds||!(0<b.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");
b.schema&&delete b.schema;b.queryType="InterconnectsQuery";var a=new e(b);a.articleAId=b.articleAId;a.articleBIds=b.articleBIds;a.toRequest=function(){var a=new c.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};a.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return a};c.Appacitive.Queries.GraphQuery=function(b){b=b||{};if(!b.graphQuery)throw Error("graphQuery object is mandatory");
this.toRequest=function(){var a=new c.Appacitive.HttpRequest;a.url=c.Appacitive.config.apiBaseUrl;a.url+=c.Appacitive.storage.urlFactory.article.getProjectionQueryUrl();a.method="post";a.data=b.graphQuery;return a}}})(global);
(function(c){c.Appacitive.BaseObject=function(g,d){var e={},b=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var f in a[c])b[c][f]=a[c][f]}else b[c]=a[c]},a={};b(g,a);d&&b(a,e);!e.__id&&a.__id&&(e.__id=a.__id);a.__schematype?(a.__schematype=a.__schematype.toLowerCase(),this.schema=this.entityType=a.__schematype,this.type="user"==a.__schematype||"device"==a.__schematype?a.__schematype:"article"):a.__relationtype&&(a.__relationtype=
a.__relationtype.toLowerCase(),this.relation=this.entityType=a.__relationtype,this.type="connection");var f=parseInt(1E6*Math.random(),10);this.__defineGetter__("cid",function(){return f});var h="__revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),j=["__link","__endpointa","__endpointb"],m=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=
function(){return JSON.parse(JSON.stringify(a))};this.toJSON=function(){return a};this.__defineGetter__("id",function(){return this.get("__id")});this.__defineSetter__("id",function(a){this.set("__id",a)});a.__attributes||(a.__attributes={});e.__attributes||(e.__attributes={});this.attributes=function(){if(0===arguments.length)a.__attributes||(a.__attributes={});else{if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==
typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return a.__attributes};var k=function(){var b=!1,c=JSON.parse(JSON.stringify(e.__attributes)),f;for(f in a.__attributes)"undefined"==typeof a.__attributes[f]||null===a.__attributes[f]?(c[f]=null,b=!0):a.__attributes[f]!=
e.__attributes[f]?(c[f]=a.__attributes[f],b=!0):a.__attributes[f]==e.__attributes[f]&&delete c[f];return!b?null:c};this.getChangedAttributes=k;this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var l=[];a.__tags||(a.__tags=[]);e.__tags||(e.__tags=[]);this.__defineGetter__("tags",
function(){return!a.__tags?[]:a.__tags});this.addTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;a.__tags.push(b);a.__tags=Array.distinct(a.__tags);if(!l||!l.length)return this;b=l.indexOf(b);-1!=b&&l.splice(b,1);return this};this.removeTag=function(b){if(!b||"string"!=typeof b||!b.length)return this;l.push(b);l=Array.distinct(l);if(!a.__tags||!a.__tags.length)return this;b=a.__tags.indexOf(b);-1!=b&&a.__tags.splice(b,1);return this};var n=function(){var b=[];a.__tags.every(function(a){-1==
e.__tags.indexOf(a)&&b.push(a)});return b};this.getChangedTags=n;this.getRemovedTags=function(){return _removetags};var p=function(b){var c=!1,f=JSON.parse(JSON.stringify(e)),d;for(d in a)"undefined"==typeof a[d]||null===a[d]?(f[d]=null,c=!0):a[d]!=e[d]?"__tags"==d||"__attributes"==d?delete f[d]:(f[d]=a[d],c=!0):a[d]==e[d]&&delete f[d];try{h.forEach(function(a){f[a]&&delete f[a]})}catch(m){}b?(a.__tags&&0<a.__tags.length&&(f.__addtags=n(),c=!0),l&&0<l.length&&(f.__removetags=l,c=!0)):a.__tags&&0<
a.__tags.length&&(f.__tags=n(),c=!0);(b=k())?(f.__attributes=b,c=!0):delete f.__attributes;return c?f:!1};this.__defineGetter__("changed",function(){return p()});this.hasChanged=function(){var a=p(!0);return 0===arguments.length?a?!0:!1:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=p(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};
arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&arguments[0].length?e[arguments[0]]:null};this.previousAttributes=function(){return e};var q="";this.__defineGetter__("fields",function(){return q});this.__defineSetter__("fields",function(a){"string"==typeof a?q=a:"object"==typeof a&&a.length&&(q=a.join(","))});this.get=function(b){if(b)return a[b]};this.set=function(b,c){if(!b||"string"!=typeof b||
0==b.length)return this;null==c||"undefined"==c?a[b]=null:"string"==typeof c?a[b]=c:"number"==typeof c?a[b]=c+"":"object"==typeof c&&(0<=c.length?a[b]=c:-1!==j.indexOf(b)&&(a[b]=c));return this};this.unset=function(b){if(!b||"string"!=typeof b||0==b.length||0==b.indexOf("__"))return this;try{delete a[b]}catch(c){}return this};this.has=function(b){return!b||"string"!=typeof b||0==b.length?!1:a[b]&&"undefined"!=typeof a[b]?!0:!1};this.isNew=function(){return a.__id&&a.__id.length?!1:!0};this.clone=
function(){return"article"==this.type?new Appacitive.Article(a):new Appacitive.connection(a)};this.copy=function(c){c&&b(c,a);return this};this.save=function(b,c){a.__id?t.apply(this,arguments):r.apply(this,arguments);return this};var r=function(f,d){f=f||function(){};d=d||function(){};var h=this,j=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype,q);if(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))j=
c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl();var g=new c.Appacitive.HttpRequest;g.url=j;g.method="put";a.__revision&&delete a.__revision;g.data=a;g.onSuccess=function(j){var g=null;if(j&&(j.article||j.connection||j.user||j.device))g=j.article||j.connection||j.user||j.device;j&&g?(e=g,a.__id=g.__id,b(g,a),h.connectionCollections&&0<h.connectionCollections.length&&h.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})}),
"connection"==h.type&&h.parseConnection(),c.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".created",h,{object:h}),"function"==typeof f&&f(h)):(j=j||{},j.status=j.status||{},j.status=m(j.status),c.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".createFailed",h,{error:j.status}),"function"==typeof d&&d(j.status,h))};g.onError=function(a){a=m(a);"function"==typeof d&&d(a,h)};c.Appacitive.http.send(g);return this},t=function(f,d){f=f||function(){};d=d||function(){};
var h=p(!0),j=this;if(h){var g=new c.Appacitive.HttpRequest,k=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||a.__relationtype,e.__id?e.__id:a.__id,q);if(a&&a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))k=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(e.__id);g.url=k;g.method="post";g.data=h;g.onSuccess=function(h){h&&(h.article||h.connection||
h.user||h.device)?(e=h.article||h.connection||h.user||h.device,b(e,a),l=[],c.Appacitive.eventManager.fire((j.schema||j.relation)+"."+j.type+"."+a.__id+".updated",j,{object:j}),"function"==typeof f&&f(j)):(h=h||{},h.status=h.status||{},h.status=m(h.status),c.Appacitive.eventManager.fire((j.schema||j.relation)+"."+j.type+"."+a.__id+".updateFailed",j,{object:h.status}),"function"==typeof d&&d(h.status,j))};g.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==
typeof d&&d(a,j)};c.Appacitive.http.send(g)}else"function"==typeof f&&f(j);return this};this.fetch=function(f,d){f=f||function(){};d=d||function(){};if(a.__id){var h=this,j=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id,q),g=new c.Appacitive.HttpRequest;g.url=j;g.method="get";g.onSuccess=function(c){c&&(c.article||c.connection||c.user||c.device)?(e=c.article||c.connection||c.user||c.device,b(e,a),h.___collection&&"article"==
h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof f&&f(h)):(c=c||{},c.status=c.status||{},c.status=m(c),"function"==typeof d&&d(c.status,h))};g.onError=function(a){a=m(a);"function"==typeof d&&d(a,h)};c.Appacitive.http.send(g);return this}"function"==typeof d&&d({code:"400",message:"Please specify id for get operation"},this)};this.del=function(b,d,e){if(!a.__id&&this.___collection)this.___collection.removeByCId(f),"function"==typeof b&&b(this);else{b=b||function(){};
d=d||function(){};var h=this,j=c.Appacitive.config.apiBaseUrl,j=j+c.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||a.__relationtype,a.__id);if(a&&a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))j=c.Appacitive.config.apiBaseUrl,j+=c.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id);e&&!0===e&&(j=-1==j.indexOf("?")?j+"?deleteconnections=true":j+"&deleteconnections=true");e=new c.Appacitive.HttpRequest;
e.url=j;e.method="delete";e.onSuccess=function(c){"200"==c.code?(h.___collection&&h.___collection.removeById(a.__id),"function"==typeof b&&b(c)):(c=m(c),"function"==typeof d&&d(c,h))};e.onError=function(a){a=m(a);"function"==typeof d&&d(a,h)};c.Appacitive.http.send(e)}}};c.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(c){var g=function(){return Math.floor(65536*Math.random()).toString(16)};c.Appacitive.GUID=function(){var c=g()+g()+"-"+g()+"-"+g()+"-"+g()+"-"+g()+g()+g(),e="",b,a,f,h,j,m,k=0,c=c.replace(/\r\n/g,"\n");a="";for(f=0;f<c.length;f++)h=c.charCodeAt(f),128>h?a+=String.fromCharCode(h):(127<h&&2048>h?a+=String.fromCharCode(h>>6|192):(a+=String.fromCharCode(h>>12|224),a+=String.fromCharCode(h>>6&63|128)),a+=String.fromCharCode(h&63|128));for(c=a;k<c.length;)b=c.charCodeAt(k++),a=c.charCodeAt(k++),
f=c.charCodeAt(k++),h=b>>2,b=(b&3)<<4|a>>4,j=(a&15)<<2|f>>6,m=f&63,isNaN(a)?j=m=64:isNaN(f)&&(m=64),e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m);return e.toString()}})(global);
(function(c){c.Appacitive.ArticleCollection=function(g){var d=null,e=null,b=[],a={};"string"==typeof g?a.schema=g:a=g;this.collectionType="article";if(!a||!a.schema)throw Error("Must provide schema while initializing ArticleCollection.");var d=a.schema,f=this;g=function(b){b.type="article";b.schema?d=b.schema:b.schema=d;e=new c.Appacitive.Queries.BasicFilterQuery(b);a=b;f.extendOptions=e.extendOptions};this.setFilter=function(b){a.filter=b;a.type="article";e?e.filter=b:(e=new c.Appacitive.Queries.BasicFilterQuery(a),
f.extendOptions=e.extendOptions);return this};this.setFreeText=function(b){!b&&0==b.trim().length&&(a.freeText="");a.freeText=b;a.type="article";e?e.freeText=b:(e=new c.Appacitive.Queries.BasicFilterQuery(a),f.extendOptions=e.extendOptions);return this};this.setFields=function(b){b||(a.fields="");a.fields=b;a.type="article";e?e.fields=b:(e=new c.Appacitive.Queries.BasicFilterQuery(a),f.extendOptions=e.extendOptions);return this};this.reset=function(){d=a=null;b.length=0;e=null};this.__defineGetter__("query",
function(){return e});this.getQuery=function(){return e};var h=["BasicFilterQuery"];this.__defineSetter__("query",function(a){if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==h.indexOf(a.queryType))throw Error("ArticleCollection only accepts "+h.join(", "));b.length=0;e=a});this.setQuery=function(a){this.query=a;return this};this.setOptions=g;g(a);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=b.length?
null:b.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__schematype")!=d)throw Error("Null article passed or schema type mismatch");var c=null;b.forEach(function(b,f){b.get("__id")==a.get("__id")&&(c=f)});null!=c?b.splice(c,1):b.push(a);return this};this.getArticleById=function(a){var c=b.filter(function(b){return b.get("__id")==a});return 1==c.length?c[0]:null};this.getAll=function(){return Array.prototype.slice.call(b)};this.getAllArticles=function(){return Array.prototype.slice.call(b).map(function(a){return a.getArticle()})};
this.removeById=function(a){if(!a)return!1;var c=null;b.forEach(function(b,f){b.getArticle().__id&&b.getArticle().__id==a&&(c=f)});null!==c&&b.splice(c,1);return this};this.removeByCId=function(a){if(!a)return!1;var c=null;b.forEach(function(b,f){b.cid&&b.cid==a&&(c=f)});null!==c&&b.splice(c,1);return this};this.fetch=function(a,d){a=a||function(){};d=d||function(){};b.length=0;var h=e.toRequest();h.onSuccess=function(e){a:{var h=a;e=e||{};var g=e.articles;if(!g)if(e.status&&e.status.code&&"200"==
e.status.code)g=[];else{h=e.status||{message:"Server error",code:400};"function"==typeof d&&d(h,f);break a}if(!g.length||0===g.length)g=[];g.forEach(function(a){a=new c.Appacitive.Article(a,!0);a.___collection=f;b.push(a)});h(e.paginginfo||{},f)}};h.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof d&&d(a,f)};c.Appacitive.http.send(h);return this};this.fetchByPageNumber=function(a,b,c){e.getOptions().pageQuery.pageNumber=c;this.fetch(a,b);return this};this.fetchNextPage=
function(a,b){e.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var c=e.getOptions().pageQuery;c.pageNumber-=1;0===c.pageNumber&&(c.pageNumber=1);this.fetch(a,b);return this};this.createNewArticle=function(a){a=a||{};a.__schematype=d;a=new c.Appacitive.Article(a);a.___collection=f;b.push(a);return a};this.map=function(){return b.map.apply(this,arguments)};this.forEach=function(){return b.forEach.apply(this,arguments)};this.filter=function(){return b.filter.apply(this,
arguments)}};c.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};c.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};c.Appacitive.ArticleCollection.prototype.__defineGetter__("articles",function(){return this.getAll()});c.Appacitive.ArticleCollection.prototype.__defineGetter__("length",function(){return this.articles.length})})(global);
(function(c){c.Appacitive.ConnectionCollection=function(g){var d=null,e=null,b=[],a=[],f={};"string"==typeof g?f.relation=g:f=g;this.collectionType="connection";var h=this;if(!g||!g.relation)throw Error("Must provide relation while initializing ConnectionCollection.");d=g.relation;g=function(a){a.type="connection";a.relation?d=a.relation:a.relation=d;e=new c.Appacitive.Queries.BasicFilterQuery(a);f=a;return h};this.setFilter=function(a){f.filter=a;f.type="connection";e?e.filter=a:(e=new c.Appacitive.Queries.BasicFilterQuery(f),
h.extendOptions=e.extendOptions);return this};this.setFreeText=function(a){!a&&0==a.trim().length&&(f.freeText="");f.freeText=a;f.type="connection";e?e.freeText=a:(e=new c.Appacitive.Queries.BasicFilterQuery(f),h.extendOptions=e.extendOptions);return this};this.setFields=function(a){a||(f.fields="");f.fields=a;f.type="connection";e?e.fields=a:(e=new c.Appacitive.Queries.BasicFilterQuery(f),h.extendOptions=e.extendOptions);return this};this.__defineGetter__("query",function(){return e});this.getQuery=
function(){return e};var j=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.__defineSetter__("query",function(c){if(!c||!c.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==j.indexOf(c.queryType))throw Error("ConnectionCollection only accepts "+j.join(", "));a.length=0;b.length=0;e=c});this.setQuery=function(a){this.query=a;return this};this.reset=function(){d=f=null;a.length=0;b.length=
0;e=null};this.setOptions=g;g(f);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=b.length?null:b.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=d)throw Error("Null connection passed or relation type mismatch");var c=null;b.forEach(function(b,f){b.get("__id")==a.get("__id")&&(c=f)});null!==c?b.splice(c,1):b.push(a);return this};this.getConnection=function(a){var c=b.filter(function(b){return b.get("__id")==a});return 1==
c.length?c[0]:null};this.getAll=function(){return Array.prototype.slice.call(b)};this.getAllConnections=function(){return Array.prototype.slice.call(b).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var c=null;b.forEach(function(b,f){b.getConnection().__id&&b.getConnection().__id==a&&(c=f)});null!==c&&b.splice(c,1);return this};this.removeByCId=function(a){if(!a)return!1;var c=null;b.forEach(function(b,f){b.cid&&b.cid==a&&(c=f)});null!==c&&b.splice(c,1);return this};
this.getConnectedArticle=function(b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(f,d){f=f||function(){};d=d||function(){};b.length=0;var g=e.toRequest();g.onSuccess=function(g){a:{var j=f;g=g||{};var l=g.connections;"GetConnectionsBetweenArticlesForRelationQuery"==e.queryType&&g.connection&&(l=[g.connection]);if(!l)if(g.status&&g.status.code&&"200"==g.status.code)l=[];else{j=g.status||{message:"Server error",
code:400};"function"==typeof d&&d(j,h);break a}if(!l.length||0===l.length)l=[];l.forEach(function(f){f=new c.Appacitive.Connection(f,!0);f.___collection=h;if(f.endpointA.article||f.endpointB.article){var d=f.endpointA.article||f.endpointB.article;d.___collection=h;a.push(d)}try{f.___collection.connectedArticle||delete f.connectedArticle}catch(e){}b.push(f)});j(g.paginginfo||{},h)}};g.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof d&&d(a)};c.Appacitive.http.send(g);return this};
this.fetchByPageNumber=function(a,b,c){e.getOptions().pageQuery.pageNumber=c;this.fetch(a,b);return this};this.fetchNextPage=function(a,b){e.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var c=e.getOptions().pageQuery;c.pageNumber-=1;0===c.pageNumber&&(c.pageNumber=1);this.fetch(a,b);return this};this.createNewConnection=function(a){a=a||{};a.__relationtype=d;a=new c.Appacitive.Connection(a);a.___collection=h;b.push(a);return a};this.map=function(){return b.map.apply(this,
arguments)};this.forEach=function(a,c){return b.forEach(a,c||this)};this.filter=function(){return b.filter.apply(this,arguments)}}})(global);
(function(c){var g=function(d,e){d=d||function(){};e=e||function(){};var b=new c.Appacitive.HttpRequest;b.method="get";b.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));b.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(a){a?d(a):e()}):e({code:"404",message:"fb account not found"})};
b.onError=e;c.Appacitive.http.send(b)};c.Appacitive.Article=function(d,e){d=d||{};"string"==typeof d&&(d={__schematype:d});if(!d.__schematype&&!d.schema)throw Error("Cannot set article without __schematype");d.schema&&(d.__schematype=d.schema,delete d.schema);c.Appacitive.BaseObject.call(this,d,e);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=g);return this};c.Appacitive.Article.prototype=new c.Appacitive.BaseObject;
c.Appacitive.Article.prototype.constructor=c.Appacitive.Article;c.Appacitive.Article.prototype.getConnections=function(d){if("article"!=this.type)return null;d=d||{};d.articleId=this.get("__id");var e=new c.Appacitive.ConnectionCollection({relation:d.relation});this.connectionCollections.push(e);e.query=new c.Appacitive.Queries.GetConnectionsQuery(d);return e};c.Appacitive.Article.prototype.getConnectedArticles=function(d){d=d||{};"string"==typeof d&&(rName=d,d={relation:rName});d.articleId=this.get("__id");
var e=new c.Appacitive.ConnectionCollection({relation:d.relation});e.connectedArticle=this;this.connectionCollections.push(e);e.query=new c.Appacitive.Queries.ConnectedArticlesQuery(d);return e};c.Appacitive.Article.multiDelete=function(d,e,b){d=d||{};if(!d.schema||"string"!=typeof d.schema||0==d.schema.length)throw Error("Specify valid schema");if("user"==d.schema.toLowerCase()||"device"==d.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(d.ids&&0<d.ids.length){e=
e||function(){};b=b||function(){};var a=new c.Appacitive.HttpRequest;a.url=c.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(d.schema);a.method="post";a.data={idlist:d.ids};a.onSuccess=function(a){a&&"200"==a.code?"function"==typeof e&&e():(a=a||{},"function"==typeof b&&b(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{};"function"==typeof b&&b(a.status||{message:"Server error",code:400})};c.Appacitive.http.send(a)}else e()};c.Appacitive.Article.multiGet=
function(d,e,b){d=d||{};if(!d.schema||"string"!=typeof d.schema||0==d.schema.length)throw Error("Specify valid schema");if(d.ids&&0<d.ids.length){var a=new c.Appacitive.HttpRequest;a.url=c.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(d.schema,d.ids.join(","),d.fields);a.method="get";a.onSuccess=function(a){if(a&&a.articles){if("function"==typeof e){var d=[];a.articles.forEach(function(a){d.push(new c.Appacitive.Article(a))});e(d,a.paginginfo)}}else a=a||{},"function"==
typeof b&&b(a.status||{message:"Server error",code:400})};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof b&&b(a)};c.Appacitive.http.send(a)}else"function"==typeof e&&e([])};c.Appacitive.Article.get=function(d,e,b){d=d||{};if(!d.schema)throw Error("Specify schema");if(!d.id)throw Error("Specify id to fetch");var a={},a="user"==d.schema.toLowerCase()?new c.Appacitive.User({__id:d.id}):new c.Appacitive.Article({__schematype:d.schema,__id:d.id});a.fields=d.fields;a.fetch(e,
b);return a}})(global);
(function(c){var g=function(b,a,f){var d={label:b.label};b.articleid&&(d.articleid=b.articleid);if(b.article)"function"==typeof b.article.getArticle?b.article.get("__id")?d.articleid=b.article.get("__id"):d.article=b.article.getArticle():"object"==typeof b.article&&b.article.__schematype&&(b.article.__id?d.articleid=b.article.__id:d.article=b.article,b.article=new c.Appacitive.Article(b.article));else if(!d.articleid&&!d.article)throw Error("Incorrectly configured endpoints provided to setupConnection");f["endpoint"+
a]=b;return d},d=function(b,a,f){b.article&&"object"==typeof b.article?(f["endpoint"+a]?f["endpoint"+a]&&f["endpoint"+a].article&&f["endpoint"+a].article.getArticle?f["endpoint"+a].article.copy(b.article):f["endpoint"+a].article=new c.Appacitive.Article(b.article):(f["endpoint"+a]={},f["endpoint"+a].article=new c.Appacitive.Article(b.article)),f["endpoint"+a].articleid=b.articleid,f["endpoint"+a].label=b.label,f["endpoint"+a].type=b.type,f["endpoint"+a].article.___collection=f.___collection):f["endpoint"+
a]=b};c.Appacitive.Connection=function(b,a){b=b||{};"string"==typeof b&&(b={__relationtype:b});if(!b.__relationtype&&!b.relation)throw new error("Cannot set connection without relation");b.relation&&(b.__relationtype=b.relation,delete b.relation);b.endpoints&&2==b.endpoints.length&&(b.__endpointa=b.endpoints[0],b.__endpointb=b.endpoints[1],delete b.endpoints);c.Appacitive.BaseObject.call(this,b);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var a="A",c="B";
if(b.__endpointa.label==this.get("__endpointb").label&&b.__endpointa.label!=b.__endpointb.label&&(b.__endpointa.articleid==this.get("__endpointb").articleid||!b.__endpointa.articleid))a="B",c="A";d(this.get("__endpointa"),a,this);d(this.get("__endpointb"),c,this);this.__defineGetter__("endpoints",function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a});return this};a?(this.__defineGetter__("connectedArticle",function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(b=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(b)}),this.parseConnection(b)):b.__endpointa&&b.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};c.Appacitive.Connection.prototype=new c.Appacitive.BaseObject;c.Appacitive.Connection.prototype.constructor=
c.Appacitive.Connection;c.Appacitive.Connection.prototype.setupConnection=function(b,a){if(!b||!b.articleid&&!b.article||!b.label||!a||!a.articleid&&!a.article||!a.label)throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",g(b,"A",this));this.set("__endpointb",g(a,"B",this))};c.Appacitive.Connection.get=function(b,a,f,d){options=options||{};if(!options.relation)throw Error("Specify relation");if(!options.id)throw Error("Specify id to fetch");b=new c.Appacitive.Connection({__relationtype:options.relation,
__id:options.id});b.fields=options.fields;b.fetch(f,d)};var e=function(b,a,f){b.onSuccess=function(b){if(b&&b.status&&"200"==b.status.code){if("function"==typeof a){var d=b.connections,e=[];d||(d=[]);d.forEach(function(a){e.push(new c.Appacitive.Connection(a))});a(e,b.paginginfo)}}else b=b||{},"function"==typeof f&&f(b.status||{message:"Server error",code:400})};b.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof f&&f(a)};c.Appacitive.http.send(b)};c.Appacitive.Connection.multiGet=
function(b,a,f,d){options=options||{};if(!options.relation||"string"!=typeof options.relation||0==options.relation.length)throw Error("Specify valid relation");if(options.ids&&0<options.ids.length)return b=new c.Appacitive.HttpRequest,b.url=c.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(options.relation,options.ids.join(","),options.fields),b.method="get",e(b,f,d);"function"==typeof f&&f([])};c.Appacitive.Connection.multiDelete=function(b,a,f){b=b||{};if(!b.relation||
"string"!=typeof b.relation||0==b.relation.length)throw Error("Specify valid relation");if(b.ids&&0<b.ids.length){var d=new c.Appacitive.HttpRequest;d.url=c.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(b.relation);d.method="post";d.data={idlist:b.ids};d.onSuccess=function(b){b&&"200"==b.code?"function"==typeof a&&a():(b=b||{},"function"==typeof f&&f(b||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"==typeof f&&f(a||{message:"Server error",
code:400})};c.Appacitive.http.send(d)}else a()};c.Appacitive.Connection.getInterconnects=function(b,a,c){b=new Appacitive.Queries.InterconnectsQuery(b);e(b.toRequest(),request,a,c)};c.Appacitive.Connection.getBetweenArticles=function(b,a,c){b=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(b);e(b.toRequest(),a,c)};c.Appacitive.Connection.getBetweenArticlesForRelation=function(b,a,f){b=(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(b)).toRequest();b.onSuccess=function(b){b&&
b.status&&"200"==b.status.code?"function"==typeof a&&(b=b.connection?new c.Appacitive.Connection(b.connection):null,"function"==typeof a&&a(b)):(b=b||{},"function"==typeof f&&f(b.status||{message:"Server error",code:400}))};b.onError=function(a){a=a||{};"function"==typeof f&&f(a.status||{message:"Server error",code:400})};c.Appacitive.http.send(b)}})(global);
(function(c){c.Appacitive.Users=new function(){var g=null;this.__defineGetter__("currentUser",function(){return g});var d=function(a,b,d,e){d=d||function(){};e=e||function(){};var g={authtype:"facebook",accesstoken:a,name:"facebook"};a=b.get("__id");if(b.get("__id")){var k=new c.Appacitive.HttpRequest;k.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);k.method="post";k.data=g;k.onSuccess=function(a){a&&"200"==a.code?(b.set("__link",g),"function"==typeof d&&
d(b)):e(a,b)};k.onError=e;c.Appacitive.http.send(k)}else b.set("__link",g),"function"==typeof d&&d(b)},e=function(a,b,d,e){d=d||function(){};e=e||function(){};var g=b.get("__id");if(b.get("__id")){var k=new c.Appacitive.HttpRequest;k.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getLinkAccountUrl(g,a);k.method="post";k.onSuccess=function(a){a&&"200"==a.code?(b.set("__link",null),"function"==typeof d&&d(b)):e(a,b)};k.onError=e;c.Appacitive.http.send(k)}else"function"==typeof d&&
d(b)};this.setCurrentUser=function(a,b,h){if(!a||"object"!=typeof a||0<=a.length)throw Error("Cannot set null object as user");var j=a;a.getArticle||(j=new c.Appacitive.User(a,!0));if(!j.get("__id")||0==j.get("__id").length)throw Error("Specify user __id");c.Appacitive.localStorage.set("Appacitive-User",a);h||(h=60);g=j;b&&c.Appacitive.Session.setUserAuthHeader(b,h);g.logout=function(a){c.Appacitive.Users.logout(a)};g.updatePassword=function(a,b,d,f){var e=this,g=d,h=f;d=e.get("__id");if(!d||"string"!==
typeof d||0==d.length)throw Error("Please specify valid userid");if(!a||"string"!==typeof a||0==a.length)throw Error("Please specify valid oldPassword");if(!b||"string"!==typeof b||0==b.length)throw Error("Please specify valid newPassword");g=g||function(){};h=h||function(){};a==b?"function"==typeof g&&g(e):(a={oldpassword:a,newpassword:b},b=new c.Appacitive.HttpRequest,b.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(d),b.method="post",b.data=a,b.onSuccess=
function(a){a&&"200"==a.code&&("function"==typeof g?g(e):h(a,e))},b.onError=h,c.Appacitive.http.send(b));return this};g.linkFacebookAccount=function(a,b){var f=function(){d(Appacitive.Facebook.accessToken,g,function(b){c.Appacitive.eventManager.fire("user..article."+b.get("__id")+".updated",b,{object:b});"function"==typeof a&&a(b)},b)};Appacitive.Facebook.getCurrentUserInfo(function(){f()},function(){Appacitive.Facebook.requestLogin(function(){f()},b)});return this};g.unlinkFacebookAccount=function(a,
b){e("facebook",this,function(b){c.Appacitive.eventManager.fire("user.article."+b.get("__id")+".updated",b,{object:b});"function"==typeof a&&a(b)},b);return this};g.logout=function(a){Appacitive.Users.logout(a)};g.checkin=function(a,b,d){var f=this,e=b,g=d;b=f.get("__id");(!b||"string"!==typeof b||0==b.length)&&e&&"function"==typeof e&&e();if(!a||!a.lat||!a.lng)throw Error("Invalid coordinates provides");e=e||function(){};g=g||function(){};d=new c.Appacitive.HttpRequest;d.url=c.Appacitive.config.apiBaseUrl+
c.Appacitive.storage.urlFactory.user.getCheckinUrl(b,a.lat,a.lng);d.method="post";d.onSuccess=function(a){a&&"200"==a.code?"function"==typeof e&&e(accounts,f):"function"==typeof g&&g(a,f)};d.onError=g;c.Appacitive.http.send(d);return this};c.Appacitive.eventManager.clearAndSubscribe("user.article."+j.get("__id")+".updated",function(a,b){c.Appacitive.localStorage.set("Appacitive-User",b.object.getArticle())});return g};c.Appacitive.User=function(a){a=a||{};a.__schematype="user";c.Appacitive.Article.call(this,
a);return this};c.Appacitive.User.prototype=new c.Appacitive.Article("user");c.Appacitive.User.prototype.constructor=c.Appacitive.User;c.Appacitive.User.prototype.__defineGetter__("linkedAccounts",function(){var a=this.get("__link");a?"object"==typeof a&&!(0<=a.length)?a=[a]:0<=a.length||(a=a[0]):a=[];return a});c.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this,e=this,g=function(b){"function"==typeof a&&a(b,d)},k=b,l=e.get("__id");(!l||"string"!==typeof l||
0==l.length)&&"function"==typeof g&&g(e.linkedAccounts,e);var g=g||function(){},k=k||function(){},n=new c.Appacitive.HttpRequest;n.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(l);n.method="get";n.onSuccess=function(a){a&&a.status&&"200"==a.status.code?(a=a.identities||[],0<a.length?e.set("__link",a):e.set("__link",null),"function"==typeof g&&g(a,e)):k(a.status,e)};n.onError=k;c.Appacitive.http.send(n);return this};c.Appacitive.User.prototype.linkFacebookAccount=
function(a,b,c){d(a,this,b,c);return this};c.Appacitive.User.prototype.unlinkFacebookAccount=function(a,b){var c=this;e("facebook",this,function(){var b=c.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&c.set("__link",null);"function"==typeof a&&a(c)},b);return this};c.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,b,d){if(!a)throw Error("Specify userid for user delete");(new c.Appacitive.Article({__schematype:"user",
__id:a})).del(b||function(){},d||function(){})};this.deleteCurrentUser=function(a,b){a=a||function(){};if(null===g)throw Error("Current user is not yet set for delete operation");var d=g.get("__id");this.deleteUser(d,function(b){c.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a(b)},b)};this.createUser=this.createNewUser=function(a,b,d){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new c.Appacitive.User(a)).save(b,d)};this.signup=function(a,b,c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(a,b,d,e){b=b||function(){};d=d||function(){};a.expiry||(a.expiry=864E5);var g=this,k=new c.Appacitive.HttpRequest;k.method="post";k.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();k.data=a;k.onSuccess=function(c){c&&c.user?(e&&(c.user.__authType=e),g.setCurrentUser(c.user,
c.token,a.expiry),b({user:g.currentUser,token:c.token})):(c=c||{},d(c.status))};k.onError=d;c.Appacitive.http.send(k)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(a,b,d,e){a=a||function(){};b=b||function(){};var g=this,k=function(){g.authenticateUser({accesstoken:c.Appacitive.Facebook.accessToken,
type:"facebook",expiry:864E5,createnew:e},function(c){c.user?(c.user.__authType="FB","function"==typeof a&&a({user:g.currentUser,token:c.token})):(c=c||{},"function"==typeof b&&b(c.status))},b,"FB")};d?k():FB?Appacitive.Facebook.requestLogin(function(){k()},b):"function"==typeof b&&b()};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,b){a&&("function"!=typeof a&&"boolean"==typeof a)&&(b=a,a=function(){});var d=c.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!d)return"function"==typeof a&&a(!1),!1;if(b)return"function"==typeof a&&a(!0),!0;try{var e=new c.Appacitive.HttpRequest;e.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getValidateTokenUrl(d);e.method="POST";e.data={};e.onSuccess=function(b){"function"==typeof a&&a(b.result)};c.Appacitive.http.send(e)}catch(g){a(!1)}};this.sendResetPasswordEmail=function(a,b,d,e){d=d||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");
if(b&&"string"==typeof b&&0==b.length)throw Error("Plase specify subject for email");a={username:a,subject:b};b=new c.Appacitive.HttpRequest;b.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();b.method="post";b.data=a;b.onSuccess=function(a){a&&"200"==a.code&&("function"==typeof d?d():e(a))};b.onError=e;c.Appacitive.http.send(b)};var b=function(a,b,d){b=b||function(){};d=d||function(){};var e=new c.Appacitive.HttpRequest;e.url=a;e.method="get";
e.onSuccess=function(a){a&&a.user&&("function"==typeof b?b(new Appacitive.User(a.user)):"function"==typeof d&&d(a.status))};e.onError=d;c.Appacitive.http.send(e)};this.getUserByToken=function(a,d,e){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid token");a=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getUserByTokenUrl(a);b(a,d,e)};this.getUserByUsername=function(a,d,e){if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");
a=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(a);b(a,d,e)};this.logout=function(a,b){g=null;c.Appacitive.Session.removeUserAuthHeader(a||function(){},b)}}})(global);
(function(c){c.Appacitive.Email=new function(){var g={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return g};var d=function(d,b,a){var f=new c.Appacitive.HttpRequest;f.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.email.getSendEmailUrl();f.method="post";f.data=d;f.onSuccess=function(c){c&&c.status&&"200"==c.status.code?b(c.email):(c=c||{},c.status=c.status||{},a(c.status.message||"Server error"))};
c.Appacitive.http.send(f)};this.setupEmail=function(c){c=c||{};g.smtp.username=c.username||g.smtp.username;g.from=c.from||g.from;g.smtp.password=c.password||g.smtp.password;g.smtp.host=c.smtp.host||g.smtp.host;g.smtp.port=c.smtp.port||g.smtp.port;g.smtp.enablessl=c.enableSSL||g.smtp.enablessl;g.replyto=c.replyTo||g.replyto};this.sendTemplatedEmail=function(c,b,a){b=b||function(){};a=a||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!c.templateName)throw Error("template name is mandatory to send an email");var f={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{templatename:c.templateName||"",data:c.data||{},ishtml:!1==c.isHtml?!1:!0}};if(c.useConfig){f.smtp=g.smtp;if(!c.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
f.from=c.from||g.from;f.replyto=c.replyTo||g.replyto}d(f,b,a)};this.sendRawEmail=function(c,b,a){b=b||function(){};a=a||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.body)throw Error("body is mandatory to send an email");var f={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{content:c.body||"",ishtml:!1==c.isHtml?
!1:!0}};if(c.useConfig){f.smtp=g.smtp;if(!c.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");f.from=c.from||g.from;f.replyto=c.replyTo||g.replyto}d(f,b,a)}}})(global);
(function(c){var g=function(){var c=require("facebook-node-sdk"),e=null,b=this.FB=null,a=!0;this.initialize=function(e){if(!c)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!e.appId)throw Error("Please provide appid");if(!e.appSecret)throw Error("Please provide app secret");b=e.appSecret;this.FB=new c({appId:_appId,secret:b});a=!0};this.requestLogin=function(b,c,d){a?(e=accesstoken,FB.setAccessToken(d),Appacitive.Users.loginWithFacebook(b,c,!0)):"function"==typeof c&&
c("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,c){if(!a)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&e?(b=b||function(){},c=c||function(){},this.FB.api("/me",function(a,d){d?"function"==typeof b&&b(d):"function"==typeof c&&c("Access token is invalid")})):c("Either intialize facebook with your appid and appsecret or set accesstoken")};this.__defineGetter__("accessToken",function(){return e});this.__defineSetter__("accessToken",
function(a){console.log(a);e=a;this.FB&&this.FB.setAccessToken(a)});this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a){a=a||function(){};Appacitive.facebook.accessToken="";"function"==typeof a&&a()}};c.Appacitive.Facebook=c.Appacitive.runtime.isBrowser?new function(){var c=null,e=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);
e=!0};this.requestLogin=function(b,a){if(!e)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");b=b||function(){};a=a||function(){};FB.login(function(e){e&&"connected"===e.status&&e.authResponse?(c=e.authResponse.accessToken,"function"==typeof b&&b(e.authResponse)):"function"==typeof a&&a()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(b,a){if(!e)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");b=b||function(){};
a=a||function(){};FB.api("/me",function(e){e&&!e.error?(c=FB.getAuthResponse().accessToken,"function"==typeof b&&b(e)):"function"==typeof a&&a()})};this.__defineGetter__("accessToken",function(){return c});this.__defineSetter__("accessToken",function(b){c=b});this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.facebook.accessToken="";try{FB.logout(function(){Appacitive.Users.logout();"function"==
typeof b&&b()})}catch(c){"function"==typeof a&&a(c.message)}}}:new g})(global);
(function(c){c.Appacitive.Push=new function(){this.send=function(g,d,e){d=d||function(){};e=e||function(){};if(!g)throw Error("Please specify push options");var b=new c.Appacitive.HttpRequest;b.url=c.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();b.method="post";b.data=g;b.onSuccess=function(a){a&&a.status&&"200"==a.status.code?d(a.id):(a=a||{},a.status=a.status||{},e(a.status.message||"Server error"))};b.onError=function(a){e(a||"Server error")};c.Appacitive.http.send(b)};
this.getNotification=function(g,d,e){d=d||function(){};e=e||function(){};if(!g)throw Error("Please specify notification id");var b=new c.Appacitive.HttpRequest;b.url=c.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(g);b.method="get";b.onSuccess=function(a){a&&a.status&&"200"==a.status.code?d(a.pushnotification):(a=a||{},a.status=a.status||{},e(a.status.message||"Server error"))};b.onError=function(a){e(a||"Server error")};c.Appacitive.http.send(b)};this.getAllNotifications=
function(g,d,e){d=d||function(){};e=e||function(){};g?(g.pnum=g.pnum||1,g.psize=g.psize||20):g={pnum:1,psize:20};var b=new c.Appacitive.HttpRequest;b.url=c.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(g);b.method="get";b.onSuccess=function(a){a&&a.status&&"200"==a.status.code?d(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},e(a.status.message||"Server error"))};b.onError=function(a){e(a||"Server error")};c.Appacitive.http.send(b)}}})(global);
(function(c){c.Appacitive.File=function(g){g=g||{};this.fileId=g.fileId;this.contentType=g.contentType;this.fileData=g.fileData;var d=function(a,b,d){var e=new c.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=b;e.onError=d;c.Appacitive.http.send(e)},e=function(a,b,d,e,g){(new FormData).append("fileToUpload",b);var l=new c.Appacitive.HttpRequest;l.url=a;l.method="PUT";l.data=b;l.headers.push({key:"content-type",value:d});l.onSuccess=e;l.onError=g;l.send(!0)};this.save=function(c,d,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?a(this,c,d,e):b(this,c,d,e)};var b=function(a,b,g,m){if(!a.fileData)throw Error("Please specify filedata");if(m||"string"==typeof m)a.contentType=m;else{if(!a.contentType||"string"!==typeof m||0==a.contentType.length)a.contentType="text/plain";try{a.contentType=file.type}catch(k){}}m=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);b=b||function(){};g=g||function(){};d(m,function(c){c&&c.status&&"200"==
c.status.code?e(c.url,a.fileData,a.contentType,function(){a.fileId=c.id;a.getDownloadUrl(function(c){b(c,a)},g)},g):"function"==typeof g&&g(c.status,a)},g);return this},a=function(a,b,g,m){if(!a.fileData)throw Error("Please specify filedata");if(m||"string"==typeof m)a.contentType=m;else{if(!a.contentType||"string"!==typeof m||0==a.contentType.length)a.contentType="text/plain";try{a.contentType=file.type}catch(k){}}m=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);b=b||function(){};g=g||function(){};d(m,function(c){c&&c.status&&"200"==c.status.code?e(c.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(c){b(c,a)},g)},g):"function"==typeof g&&g(c.status,a)},g);return this};this.deleteFile=function(a,b){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};b=b||function(){};var d=new c.Appacitive.HttpRequest;d.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(c){c&&"200"==c.code?"function"==typeof a&&a():"function"==typeof b&&"function"==typeof b&&b(c,that)};d.onError=b;c.Appacitive.http.send(d);return this};this.getDownloadUrl=function(a,b){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;a=a||function(){};b=b||function(){};var e=new c.Appacitive.HttpRequest;e.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(c){c&&c.status&&"200"==c.status.code?(d.url=c.uri,"function"==typeof a&&a(c.uri)):"function"==typeof b&&"function"==typeof b&&b(c.status,d)};e.onError=b;c.Appacitive.http.send(e);return this}}})(global);
(function(c){c.Appacitive.Date={};c.Appacitive.Date.parseISODate=function(c){try{var d=new Date(c);if(isNaN(d)){var e=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,b=!1;if(!e.exec(c))if(e=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,e.exec(c))b=!0;else return null;var a=c.split("T"),f=a[0].split("-"),h=a[1].split("Z")[0].split(":"),j=h[2].split("."),m=Number(h[0]),d=new Date;d.setUTCFullYear(Number(f[0]));d.setUTCMonth(Number(f[1])-1);d.setUTCDate(Number(f[2]));
b||(d.setUTCHours(Number(m)),d.setUTCMinutes(Number(h[1])),d.setUTCSeconds(Number(j[0])),j[1]&&d.setUTCMilliseconds(Number(j[1])))}return d}catch(k){return null}};c.Appacitive.Date.toISOString=function(c){try{return c=c.toISOString(),c=c.replace("Z","0000Z")}catch(d){return null}};c.Appacitive.Date.toISODate=function(c){try{return c=c.toISOString()[0]}catch(d){return null}};c.Appacitive.Date.toISOTime=function(c){try{return c=c.toISOString().split("T")[1],c=c.replace("Z","0000Z")}catch(d){return null}};
c.Appacitive.Date.parseISOTime=function(c){try{var d=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(c))return null;var e=c.split("T");1==e.length&&e.push(e[0]);var b=e[1].split("Z")[0].split(":"),a=b[2].split(".");d.setUTCHours(Number(Number(b[0])));d.setUTCMinutes(Number(b[1]));d.setUTCSeconds(Number(a[0]));a[1]&&d.setUTCMilliseconds(Number(a[1]));return d}catch(f){return null}}})(global);
(function(c){c.Appacitive.localStorage=new function(){var g=c.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(c,e){e=e||"";if(!c)return!1;if("object"==typeof e)try{e=JSON.stringify(e)}catch(b){}g[c]=e;return!0};this.get=function(c){if(!c)return null;c=g.getItem(c);if(!c)return null;if("{"==c[0])try{c=JSON.parse(c)}catch(e){}return c};this.remove=function(c){if(c)try{delete g[c]}catch(e){}}}})(global);
(function(c){c.Appacitive.runtime.isBrowser&&(c.Appacitive.Cookie=new function(){this.setCookie=function(c,d,e,b){if(e){var a=new Date;a.setTime(a.getTime()+6E4*e);a="; expires="+a.toGMTString()}b||(a="");document.cookie=c+"="+d+a+"; path=/;"+("domain="+window.location.hostname)};this.readCookie=function(c){c+="=";for(var d=document.cookie.split(";"),e=0;e<d.length;e++){for(var b=d[e];" "==b.charAt(0);)b=b.substring(1,b.length);if(0==b.indexOf(c))return b.substring(c.length,b.length)}return null};
this.eraseCookie=function(c){this.setCookie(c,"",-1,!0)}})})(global);"undefined"!=typeof module&&!global.Appacitive.runtime.isBrowser&&(module.exports=global.Appacitive);