"bind"in Function.prototype||(Function.prototype.bind=function(a){var g=this;if(1>=arguments.length)return function(){return g.apply(a,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return g.apply(a,0===arguments.length?c:c.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
"indexOf"in Array.prototype||(Array.prototype.indexOf=function(a,g){void 0===g&&(g=0);0>g&&(g+=this.length);0>g&&(g=0);for(var c=this.length;g<c;g++)if(g in this&&this[g]===a)return g;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(a,g){void 0===g&&(g=this.length-1);0>g&&(g+=this.length);g>this.length-1&&(g=this.length-1);for(g++;0<g--;)if(g in this&&this[g]===a)return g;return-1});
"forEach"in Array.prototype||(Array.prototype.forEach=function(a,g){for(var c=0,f=this.length;c<f;c++)c in this&&a.call(g,this[c],c,this)});"map"in Array.prototype||(Array.prototype.map=function(a,g){for(var c=Array(this.length),f=0,b=this.length;f<b;f++)f in this&&(c[f]=a.call(g,this[f],f,this));return c});"filter"in Array.prototype||(Array.prototype.filter=function(a,g){for(var c=[],f,b=0,e=this.length;b<e;b++)b in this&&a.call(g,f=this[b],b,this)&&c.push(f);return c});
"every"in Array.prototype||(Array.prototype.every=function(a,g){for(var c=0,f=this.length;c<f;c++)if(c in this&&!a.call(g,this[c],c,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=function(a,g){for(var c=0,f=this.length;c<f;c++)if(c in this&&a.call(g,this[c],c,this))return!0;return!1});
Date.prototype.toISOString||function(){function a(a){a=String(a);1===a.length&&(a="0"+a);return a}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();
String.addSlashes=function(a){if(!a)return a;a=a.replace(/\\/g,"\\\\");a=a.replace(/\'/g,"\\'");a=a.replace(/\"/g,'\\"');return a=a.replace(/\0/g,"\\0")};String.stripSlashes=function(a){if(!a)return a;a=a.replace(/\\'/g,"'");a=a.replace(/\\"/g,'"');a=a.replace(/\\0/g,"\x00");return a=a.replace(/\\\\/g,"\\")};
for(var _type=function(a){if(null===a)return"null";if(a&&(1===a.nodeType||9===a.nodeType))return"element";var g=Object.prototype.toString.call(a).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===g){if(isNaN(a))return"nan";if(!isFinite(a))return"infinity"}return g},types="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),generateMethod=function(a){_type["is"+a]=function(g){return _type(g)===a.toLowerCase()}},i=0;i<types.length;i++)generateMethod(types[i]);
_type.isNullOrUndefined=function(a){return"null"==_type(a)||"undefined"==_type(a)};var global={};
(function(){global="undefined"===typeof window?this:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var a=function(a){if(a&&a.send&&_type.isFunction(a.send))a.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],b={},e=0,f={},g=0;this.addProcessor=function(a){a&&(a.pre=a.pre||function(){},a.post=a.post||function(){},q(a.pre),r(a.post))};var q=function(a){e+=1;b[e]=a;return e},
r=function(a){g+=1;f[g]=a;return g};this.enqueueRequest=function(a){c.push(a)};this.changeRequestForCors=function(a){var c={m:a.method.toUpperCase()};a.headers.forEach(function(a){c[a.key]=a.value});a.headers=[];a.headers.push({key:"Content-Type",value:"text/plain"});a.method="POST";a.data&&(c.b=a.data);delete a.data;global.Appacitive.config.debug&&(-1===a.url.indexOf("?")?a.url+="?debug=true":a.url+="&debug=true");try{a.data=JSON.stringify(c)}catch(h){}return a};this.notify=function(){if(0!==c.length){var e=
[],g;for(g in f)f.hasOwnProperty(g)&&e.push(f[g]);for(;0<c.length;){var n=c.shift(),p=[];for(g in b)b.hasOwnProperty(g)&&p.push(b[g](n));this.changeRequestForCors(n);a.send(n,e,p)}}};this.onResponse=function(a){console.dir(a)}},g=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(c,e){a()};this.onError=function(c){a()}},c=null,c=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest,
f=function(a){var c=global.Appacitive.Promise.buildPromise({success:a.onSuccess,error:a.onError}),e=new XDomainRequest;e.onload=function(){var a=e.responseText;try{var b=e.contentType;if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase()||"application/json; charset=utf-8"==b.toLowerCase()||"application/json; charset=utf-8;"==b.toLowerCase())b=a,global.Appacitive.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),a=JSON.parse(b)}catch(h){}c.fulfill(a,this)};e.onerror=
e.ontimeout=function(){c.reject(e)};e.onprogress=function(){};-1===a.url.indexOf("?")?a.url+="?ua=ie":a.url+="&ua=ie";e.open(a.method,a.url,!0);e.send(a.data);return c},b=function(a){if(!a.url)throw Error("Please specify request url");a.method||(a.method="GET");a.headers||(a.headers=[]);var e={},b=global.Appacitive.Promise.buildPromise({success:a.onSuccess,error:a.onError}),g=!0;a.headers.forEach(function(a){"content-type"==a.key.toLowerCase()&&(g=!0,"application/json"==a.value.toLowerCase()||"application/javascript"==
a.value.toLowerCase()||"application/json; charset=utf-8"==a.value.toLowerCase()||"application/json; charset=utf-8;"==a.value.toLowerCase())&&(g=!1)});if(g)e=a.data;else if(a.data&&(e=a.data,_type.isObject(a.data)))try{e=JSON.stringify(e)}catch(l){}a.onSuccess&&_type.isFunction(a.onSuccess)||(a.onSuccess=function(){});a.onError&&_type.isFunction(a.onError)||(a.onError=function(){});if(!global.navigator||-1==global.navigator.userAgent.indexOf("MSIE 8")&&-1==global.navigator.userAgent.indexOf("MSIE 9")){var p=
new c;p.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var a=this.responseText;try{var c=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==c.toLowerCase()||"application/javascript"==c.toLowerCase()||"application/json; charset=utf-8"==c.toLowerCase()||"application/json; charset=utf-8;"==c.toLowerCase())c=a,global.Appacitive.runtime.isBrowser||"{"!=c[0]&&(c=c.substr(1,c.length-1)),a=JSON.parse(c)}catch(e){}b.fulfill(a,
this)}else b.reject(this)};p.open(a.method,a.url,!0);for(var q=0;q<a.headers.length;q+=1)p.setRequestHeader(a.headers[q].key,a.headers[q].value);global.Appacitive.runtime.isBrowser||p.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");p.send(e);return b}a.data=e;return new f(a)},e=function(){var a=new g;a.isOnline=function(){return!0};var c=function(c,e,f){new b({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(b,g){if(b){try{b=JSON.parse(b)}catch(k){}var u=b;if(e.length!=
f.length)throw Error("Callback length and state length mismatch!");for(var t=0;t<e.length;t+=1)e[t].apply({},[u,f[t]]);if("200"<=b.code&&"300">=b.code||b.status&&"200"<=b.status.code&&"300">=b.status.code)a.onResponse(c,b);else b=b||{},b=b.status||b,b.message=b.message||"Bad Request",b.code=b.code||"400",a.onError(c,{responseText:JSON.stringify(b)})}else a.onError(c,{responseText:JSON.stringify({code:"400",message:"Invalid request"})})},onError:function(b){a.onError(c,b)}})};a.send=function(a,b,e){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");
_type.isFunction(a.beforeSend)&&a.beforeSend(a);c(a,b,e)};return a};global.Appacitive.http=new function(){var c=new e,b=new a(c),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;b.addProcessor(a)};this.send=function(a){a.promise=global.Appacitive.Promise.is(a.promise)?a.promise:new global.Appacitive.Promise.buildPromise({error:a.onError});
b.enqueueRequest(a);c.isOnline()&&!1===f&&b.notify();return a.promise};this.flush=function(a){a?b.notify():c.isOnline()&&b.notify()};this.onError=function(a,c){var b;if(c&&c.responseText)try{var e=JSON.parse(c.responseText);e&&(b={code:e.code,error:e.message})}catch(h){}b=b||{code:c.status,message:c.responseText};a.promise.reject(b,a.entity)};c.onError=this.onError;this.onResponse=function(a,c){if(a.onSuccess)if(a.context)a.onSuccess.apply(a.context,[c]);else a.onSuccess(c)};c.onResponse=this.onResponse};
global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new b(this,a)}};(function(a){a.Appacitive&&a.Appacitive.http&&(a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(c,b){try{var e=a.Appacitive.Session.isSessionValid(c);e.status?c&&(c.status&&c.status.code&&"19036"==c.status.code||
c.code&&"19036"==c.code)?a.Appacitive.Users.logout(function(){},!0):a.Appacitive.Session.incrementExpiry():e.isSession&&(null!==a.Appacitive.Session.get()&&a.Appacitive.Session.resetSession(),a.Appacitive.http.send(b))}catch(f){}}}),a.Appacitive.http.addProcessor({pre:function(a){return(new Date).getTime()},post:function(a,c){var b=(new Date).getTime()-c;a._timeTakenInMilliseconds=b}}))})(global)})();
(function(a){String.format=function(a,c){if(1>=arguments.length)return a;for(var f=arguments.length-2,b=0;b<=f;b++)a=a.replace(RegExp("\\{"+b+"\\}","gi"),arguments[b+1]);return a};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(a){var c=RegExp("^"+a),f=this;c.test(f)&&(f=f.slice(1,f.length));c=RegExp(a+"$");c.test(f)&&(f=f.slice(0,-1));return f};String.toSearchString=function(a){"undefined"===typeof a&&(a="");for(var c=
"",f=0;f<a.length;f+=1)-1===" .,;#".indexOf(a[f])&&(c+=a[f]);return c=c.toLowerCase()};String.contains=function(a,c){return-1!==a.indexOf(c)};String.startsWith=function(a,c){return 0===a.indexOf(c)};Array.distinct=function(a){var c=[],f=a.length,b,e,h;for(e=0;e<f;e++){b=void 0;for(h=0;h<c.length;h++)if(a[e].toLowerCase()===c[h].toLowerCase()){b=!0;break}b||c.push(a[e])}return c};Object.isEmpty=function(a){if(!a)return!0;var c=!0,f;for(f in a){c=!1;break}return c};a.dateFromWcf=function(a,c){var f=
/Date\(([^)]+)\)/.exec(a);if(2!=f.length){if(!c)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(f[1]))};a.Appacitive.storage=a.Appacitive.storage||{};a.Appacitive.storage.urlFactory=new function(){a.Appacitive.bag=a.Appacitive.bag||{};var g=function(a){"object"===typeof a&&(0<a.length&&("string"===typeof a[0]||"number"===typeof a[0]))&&(a=a.join(","));a||(a="");return a};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};
this.user={userServiceUrl:"user",getCreateUrl:function(a){return String.format("{0}/create?fields={1}",this.userServiceUrl,g(a))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(a,f){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,a,g(f))},getUserByTokenUrl:function(a){return String.format("{0}/me?useridtype=token&token={1}",this.userServiceUrl,a)},getUserByUsernameUrl:function(a){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,a)},getUpdateUrl:function(a,f,b){return b?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,a,g(f),b):String.format("{0}/{1}?fields={2}",this.userServiceUrl,a,g(f))},getDeleteUrl:function(a){return String.format("{0}/{1}",this.userServiceUrl,a)},getGetAllLinkedAccountsUrl:function(a){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,a)},getValidateTokenUrl:function(a){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,a)},getInvalidateTokenUrl:function(a){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,a)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(a){return String.format("{0}/{1}/changepassword",this.userServiceUrl,a)},getLinkAccountUrl:function(a){return String.format("{0}/{1}/link",this.userServiceUrl,a)},getDelinkAccountUrl:function(a,f){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,a,f)},getCheckinUrl:function(a,f,b){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,a,f,b)},getResetPasswordUrl:function(a){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,a)},getValidateResetPasswordUrl:function(a){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,a)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(a){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,g(a))},getGetUrl:function(a,f){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,a,g(f))},
getUpdateUrl:function(a,f,b){return b?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,a,g(f),b):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,a,g(f))},getDeleteUrl:function(a){return String.format("{0}/{1}",this.deviceServiceUrl,a)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(a,f,b){var e="",e=String.format("{0}/search/{1}/all",this.articleServiceUrl,a),e=b?e+"?psize="+b:e+"?psize=10";if("undefined"!==typeof f&&0<f.length)for(a=0;a<f.length;a+=
1)0!==f[a].trim().length&&(e=e+"&"+f[a]);return e},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(a,f){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,a,f)},getMultiGetUrl:function(a,f,b){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.articleServiceUrl,a,f,g(b))},getCreateUrl:function(a,f){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,a,g(f))},getGetUrl:function(a,
f,b){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,a,f,g(b))},getUpdateUrl:function(a,f,b,e){return e?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.articleServiceUrl,a,f,g(b),e):String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,a,f,g(b))},getDeleteUrl:function(a,f){return String.format("{0}/{1}/{2}",this.articleServiceUrl,a,f)},getMultiDeleteUrl:function(a){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,a)}};this.connection={connectionServiceUrl:"connection",
getGetUrl:function(a,f,b){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,a,f,g(b))},getMultiGetUrl:function(a,f,b){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,a,f,g(b))},getCreateUrl:function(a,f){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,a,g(f))},getUpdateUrl:function(a,f,b,e){return e?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,a,f,g(b),e):String.format("{0}/{1}/{2}?fields={3}",
this.connectionServiceUrl,a,f,g(b))},getDeleteUrl:function(a,f){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,a,f)},getMultiDeleteUrl:function(a){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,a)},getSearchByArticleUrl:function(a,f,b,e){var h="",h=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,a,b,f);if("undefined"!==typeof e&&0<e.length)for(a=0;a<e.length;a+=1)h=h+"&"+e[a];return h},getConnectedArticles:function(a,f,b){var e=
"",e=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,a,f);if(b&&b.length&&0<b.length)for(a=0;a<b.length;a+=1)e=0===a?e+("?"+b[a]):e+("&"+b[a]);return e},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(a,f){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,a,f)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(a){return String.format("{0}/list/{1}/contents",
this.cannedListServiceUrl,a)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(a){return String.format("{0}/notification/{1}",this.pushServiceUrl,a)},getGetAllNotificationsUrl:function(a){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,a.psize,a.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(a,f){return f&&0<f.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",
this.fileServiceUrl,escape(a),escape(f)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(a))},getUpdateUrl:function(a,f){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,a,escape(f))},getDownloadUrl:function(a,f){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,a,f)},getDeleteUrl:function(a){return String.format("{0}/delete/{1}",this.fileServiceUrl,a)}};this.query={params:function(a){var f=[];return""===
location.search||-1===location.search.indexOf("?")?f:a?(a=a.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(b,e){var h=e.split("="),k=h[1];2<h.length&&h.forEach(function(a,b){0!==a&&1!==a&&(k=k+"="+h[a])});h[0].toLowerCase()===a&&(f=[h[0],k])}),f):location.search.split("?")[1].split("=")}}}})(global);
(function(a){var g;g=a.Appacitive.runtime.isNode?process.nextTick:setTimeout;var c=function(){if(!(this instanceof c))return new c;this.calls=[]};c.prototype.isResolved=function(){return 1===this.state?!0:!1};c.prototype.isRejected=function(){return 2===this.state?!0:!1};c.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};c.prototype.done=function(){var a,b,e=this.state,h=this.value;if(e)for(;a=this.calls.shift();)if(b=a[0],"function"===typeof a[e]){try{h=a[e].apply(b,
this.value)}catch(k){b.reject(k)}h instanceof c||c.is(h)?h.then(function(a){b.fulfill(a)},function(a){b.reject(a)}):1===e?b.fulfill(h):b.reject(h)}else 1===e?b.fulfill(h):b.reject(h)};c.prototype.fulfill=function(){if(!this.state)return this.state=1,this.value=arguments,this.done(),this};c.prototype.resolve=c.prototype.fulfill;c.prototype.reject=function(){if(!this.state)return this.state=2,this.reason=this.value=arguments,this.done(),this};c.prototype.then=function(a,b){var e=this,h=new c;this.calls[this.calls.length]=
[h,a,b];this.state&&g(function(){e.done()});return h};c.when=function(a){var b=[],e=[],h,k=0,m=new c;if(!a)return m.fulfill(b),m;var n=function(){k+=1;k==h&&(m.state||(0<e.length?m.reject(e,b):m.fulfill(b)))},l=function(h){var k=a[h];k instanceof c||k&&"function"===typeof k.then?k.then(function(a){b[h]=a;n()},function(a){e[h]=a;n()}):g(function(){try{b[h]=k.call()}catch(a){e[h]=a}n()})};Array.isArray(a)||(a=[a]);h=a.length;for(var p=0;p<h;p+=1)l(p);return m};c.is=function(a){return a instanceof c?
!0:!1};c.buildPromise=function(a){var b=new c;_type.isObject(a)&&b.then(a.success,a.error);return b};a.Appacitive.Promise=c})(global);
(function(a){a.Appacitive.eventManager=new function(){function a(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var c={};this.subscribe=function(f,b){if("string"!=typeof f||"function"!=typeof b)throw Error("Incorrect subscription call");"undefined"==typeof c[f]&&(c[f]=[]);var e=a();c[f].push({callback:b,id:e});return e};this.unsubscribe=function(a){if(!a)return!1;var b=-1,e=null,h;for(h in c)for(var k=0;k<c[h].length;k+=
1)if(c[h][k].id==a){b=k;e=h;break}return-1!=b?(c[e].splice(b,1),!0):!1};this.fire=function(a,b,e){if("string"!=typeof a)throw Error("Incorrect fire call");if("undefined"==typeof e||null===e)e={};e.eventName=a;if("undefined"!=typeof c.all)for(var h=0;h<c.all.length;h+=1)c.all[h].callback(b,e);h=function(a,b,e){setTimeout(function(){a(b,e)},0)};if("undefined"!=typeof c[a])for(var k=0;k<c[a].length;k+=1)h(c[a][k].callback,b,e)};this.clearSubscriptions=function(a){if("string"!=typeof a)throw Error("Event Name must be string in EventManager.clearSubscriptions");
c[a]&&(c[a].length=0);return this};this.clearAndSubscribe=function(a,b){this.clearSubscriptions(a);this.subscribe(a,b)};this.dump=function(){console.dir(c)}}})(global);(function(a){a.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(a.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(a){a.Appacitive.Session=new function(){this.initialized=!1;var g=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},c=null,f=null,b=null,e=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(b){return a.Appacitive.Session.create(b)};this.create=function(b){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var e=a.Appacitive.Promise.buildPromise(b);b=new g;b.apikey=f;var h=new a.Appacitive.HttpRequest;h.url=a.Appacitive.config.apiBaseUrl+
"application.svc/session";h.method="put";h.data=b;h.onSuccess=function(b){c=b.session.sessionkey;a.Appacitive.Session.useApiKey=!1;e.fulfill(b);a.Appacitive.Session.onSessionCreated()};h.promise=e;return a.Appacitive.http.send(h)};a.Appacitive.http.addProcessor({pre:function(h){a.Appacitive.Session.useApiKey?h.headers.push({key:"ak",value:f}):h.headers.push({key:"as",value:c});!0===e&&(1==h.headers.filter(function(a){return"ut"==a.key}).length?h.headers.forEach(function(a){"ut"==a.key&&(a.value=b)}):
h.headers.push({key:"ut",value:b}))}});this.setUserAuthHeader=function(c,h,f){try{c&&(e=!0,b=c,f||(h||(h=60),-1==h&&(h=null),a.Appacitive.Cookie.setCookie("Appacitive-UserToken",c,h),a.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",h?h:-1,h)))}catch(g){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(c,h){c&&_type.isBoolean(c)&&(h=c,c=function(){});var f=a.Appacitive.Promise.buildPromise({success:c,error:c});e=!1;c=c||function(){};a.Appacitive.localStorage.remove("Appacitive-User");
a.Appacitive.Cookie.eraseCookie("Appacitive-UserToken");a.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry");if(b&&!h)try{var g=new a.Appacitive.HttpRequest;g.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(b);b=null;g.method="POST";g.data={};g.onSuccess=function(){f.fulfill()};g.promise=f;return a.Appacitive.http.send(g)}catch(p){}else b=null,f.fulfill();return f};this.isSessionValid=function(a){if(!a)return!0;if(a.status){if(a.status.code&&
("19027"==a.status.code||"19002"==a.status.code))return{status:!1,isSession:"19027"==a.status.code?!0:!1}}else if(a.code&&("19027"==a.code||"19002"==a.code))return{status:!1,isSession:"19027"==a.code?!0:!1};return{status:!0}};this.resetSession=function(){c=null;this.useApiKey=!0};this.get=function(){return c};this.setSession=function(a){a&&(c=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(f=a,this.useApiKey=!0)};var h="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];
"sandbox"!=a&&"live"!=a&&(a="sandbox");h=a}return h}};a.Appacitive.getAppPrefix=function(g){return a.Appacitive.Session.environment()+"/"+a.Appacitive.appId+"/"+g};a.Appacitive.initialize=function(g){g=g||{};if(!a.Appacitive.Session.initialized){if(!g.apikey||0===g.apikey.length)throw Error("apikey is mandatory");if(!g.appId||0===g.appId.length)throw Error("appId is mandatory");a.Appacitive.Session.setApiKey(g.apikey);a.Appacitive.Session.environment(g.env||"sandbox");a.Appacitive.useApiKey=!0;a.Appacitive.appId=
g.appId;a.Appacitive.Session.initialized=!0;a.Appacitive.Session.persistUserToken=g.persistUserToken;g.debug&&(a.Appacitive.config.debug=!0);if(g.userToken)-1==g.expiry?g.expiry=null:g.expiry||(g.expiry=3600),a.Appacitive.Session.setUserAuthHeader(g.userToken,g.expiry),g.user?a.Appacitive.Users.setCurrentUser(g.user):(g=a.Appacitive.localStorage.get("Appacitive-User"))&&a.Appacitive.Users.setCurrentUser(g);else if(a.Appacitive.runtime.isBrowser){var c=a.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(c){var f=a.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");f||(f=60);(g=a.Appacitive.localStorage.get("Appacitive-User"))&&a.Appacitive.Users.setCurrentUser(g,c,f)}}}}})(global);(function(a){a.Appacitive&&a.Appacitive.http&&a.Appacitive.http.addProcessor({pre:function(g){g.headers.push({key:"e",value:a.Appacitive.Session.environment()})}})})(global);
(function(a){var g=a.Appacitive;g.GeoCoord=function(a,b){var e=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(e(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var c=function(){this.toString=function(){}},f=function(a){c.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};f.prototype=new c;f.prototype.constructor=f;var b=function(a){a=a||"";if(!_type.isArray(a.value)||!a.value.length)throw Error("Specify field value as array");f.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,_type.isString(this.value[b])?"'"+this.value[b]+"'":_type.isNumber(this.value[b])?this.value[b]:this.value[b].toString()));return"("+a.join(" or ")+
")"}};b.prototype=new f;b.prototype.constructor=b;var e=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;f.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};e.prototype=new f;e.prototype.constructor=e;var h=function(a){a=a||"";if(!(a.geoCoord&&a.geoCoord instanceof
g.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");f.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};h.prototype=new f;h.prototype.constructor=e;var k=function(a){a=a||"";if(!a.geoCoords||0===a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");f.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0===b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};k.prototype=new f;k.prototype.constructor=e;var m=function(a){c.call(this);a=a||{};if(!a.tags||_type.isArray(a.tags)||
0===a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};m.prototype=new c;m.prototype.constructor=m;var n=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var e=0;e<b.length;e+=1){if(!(b[e]instanceof c))throw Error("Invalid filter provided");this.innerFilters.push(b[e])}this.toString=
function(){var a=this.operator,b="(";this.innerFilters.forEach(function(e){b=1===b.length?b+(" "+e.toString()):b+String.format(" {0} {1} ",a,e.toString())});return b+=")"}};n.prototype=new c;n.prototype.constructor=n;var l=function(a,b){if(null===a||void 0===a||0===a.length)throw Error("Specify value");this.value=a;this.type=b?b:typeof this.value;this.getValue=function(){return"string"===this.type?"'"+String.addSlashes(this.value)+"'":"number"===this.type||_type.isBoolean(this.value)?this.value:"object"===
this.type&&this.value instanceof date?"datetime('"+g.Date.toISOString(this.value)+"')":this.value.toString()}},p=function(a){this.value=a;this.getValue=function(){return this.value instanceof Date?"date('"+g.Date.toISODate(this.value)+"')":"date('"+this.value+"')"}},q=function(a){this.value=a;this.getValue=function(){return this.value instanceof Date?"time('"+g.Date.toISOTime(this.value)+"')":"time('"+this.value+"')"}},r=function(a){this.value=a;this.getValue=function(){return this.value instanceof
Date?"datetime('"+g.Date.toISOString(this.value)+"')":"datetime('"+this.value+"')"}},u=function(a,c,g){g||(g=this);g.type=a;g.name=c;g.equalTo=function(a){return new f({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};g.equalToNumber=function(a){return new f({field:this.name,fieldType:this.type,value:new l(a,"number"),operator:"=="})};g.equalToDate=function(a){return new f({field:this.name,fieldType:this.type,value:new p(a),operator:"=="})};g.equalToTime=function(a){return new f({field:this.name,
fieldType:this.type,value:new q(a),operator:"=="})};g.equalToDateTime=function(a){return new f({field:this.name,fieldType:this.type,value:new r(a),operator:"=="})};g.greaterThan=function(a){return new f({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};g.greaterThanDate=function(a){return new f({field:this.name,fieldType:this.type,value:new p(a),operator:">"})};g.greaterThanTime=function(a){return new f({field:this.name,fieldType:this.type,value:new q(a),operator:">"})};g.greaterThanDateTime=
function(a){return new f({field:this.name,fieldType:this.type,value:new r(a),operator:">"})};g.greaterThanEqualTo=function(a){return new f({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};g.greaterThanEqualToDate=function(a){return new f({field:this.name,fieldType:this.type,value:new p(a),operator:">="})};g.greaterThanEqualToTime=function(a){return new f({field:this.name,fieldType:this.type,value:new q(a),operator:">="})};g.greaterThanEqualToDateTime=function(a){return new f({field:this.name,
fieldType:this.type,value:new r(a),operator:">="})};g.lessThan=function(a){return new f({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};g.lessThanDate=function(a){return new f({field:this.name,fieldType:this.type,value:new p(a),operator:"<"})};g.lessThanTime=function(a){return new f({field:this.name,fieldType:this.type,value:new q(a),operator:"<"})};g.lessThanDateTime=function(a){return new f({field:this.name,fieldType:this.type,value:new r(a),operator:"<"})};g.lessThanEqualTo=
function(a){return new f({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};g.lessThanEqualToDate=function(a){return new f({field:this.name,fieldType:this.type,value:new p(a),operator:"<="})};g.lessThanEqualToTime=function(a){return new f({field:this.name,fieldType:this.type,value:new q(a),operator:"<="})};g.lessThanEqualToDateTime=function(a){return new f({field:this.name,fieldType:this.type,value:new r(a),operator:"<="})};g.like=function(a){return new f({field:this.name,fieldType:this.type,
value:new l("*"+a+"*"),operator:"like"})};g.startsWith=function(a){return new f({field:this.name,fieldType:this.type,value:new l(a+"*"),operator:"like"})};g.endsWith=function(a){return new f({field:this.name,fieldType:this.type,value:new l("*"+a),operator:"like"})};g.contains=function(a){return new b({field:this.name,fieldType:this.type,value:a,operator:"=="})};g.between=function(a,b){return new e({field:this.name,fieldType:this.type,val1:new l(a),val2:new l(b),operator:"between"})};g.betweenDate=
function(a,b){return new e({field:this.name,fieldType:this.type,val1:new p(a),val2:new p(b),operator:"between"})};g.betweenTime=function(a,b){return new e({field:this.name,fieldType:this.type,val1:new q(a),val2:new q(b),operator:"between"})};g.betweenDateTime=function(a,b){return new e({field:this.name,fieldType:this.type,val1:new r(a),val2:new r(b),operator:"between"})};g.withinCircle=function(a,b,e){return new h({field:this.name,fieldType:this.type,geoCoord:a,distance:b,unit:e,operator:"within_circle"})};
g.withinPolygon=function(a){return new k({field:this.name,fieldType:this.type,geoCoords:a,operator:"within_polygon"})}},t=function(a){if(!a||0===a.length)throw Error("Specify field name");this.field=a;u("property",a,this);return this},v=function(a){if(!a||0===a.length)throw Error("Specify field name");this.field=a;var b=new u("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=function(a){return b.greaterThanEqualTo(a)};
this.lessThan=function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,e){return b.between(a,e)};return this},w=function(a){if(!a||0===a.length)throw Error("Specify field name");this.field=a;var b=new u("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};this.contains=function(a){return b.contains(a)};
return this};g.Filter={Property:function(a){return new t(a)},Aggregate:function(a){return new v(a)},Attribute:function(a){return new w(a)},Or:function(){return new n("or",arguments)},And:function(){return new n("and",arguments)},taggedWithOneOrMore:function(a){return new m({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new m({tags:a,operator:"tagged_with_all"})}}})(global);
(function(a){a.Appacitive.Queries={};var g=function(a){a=a||{};var e=1,c=20;this.pageNumber=function(){return 1==arguments.length?(e=arguments[0]||1,this):e};this.pageSize=function(){return 1==arguments.length?(c=arguments[0]||20,this):c};this.pageNumber(a.pageNumber);this.pageSize(a.pageSize)};g.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var c=function(a){a=a||{};var e="__UtcLastUpdatedDate",c=!1;this.orderBy=function(){return 1===arguments.length?(e=
arguments[0]||"__UtcLastUpdatedDate",this):e};this.isAscending=function(){return 1===arguments.length?(c=_type.isUndefined(arguments[0])?!1:arguments[0],this):c};this.orderBy(a.orderBy);this.isAscending(a.isAscending)};c.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var f=function(b){var e=b||{},h="",f="",m="",n=e.queryType||"BasicQuery",l=new g(b),p=new c(b),q=e.schema||e.relation,r=e.relation?"connection":"article",u=this;this.type=function(){return r};
this.entityType=function(){return q};this.queryType=function(){return n};this.pageQuery=function(){return l};this.pageNumber=function(){return 1===arguments.length?(l.pageNumber(arguments[0]),this):l.pageNumber()};this.pageSize=function(){return 1===arguments.length?(l.pageSize(arguments[0]),this):l.pageSize()};this.sortQuery=function(){return p};this.orderBy=function(){return 1===arguments.length?(p.orderBy(arguments[0]),this):p.orderBy()};this.isAscending=function(){return 1===arguments.length?
(p.isAscending(arguments[0]),this):p.isAscending()};this.filter=function(){return 1===arguments.length?(h=arguments[0],this):h};this.freeText=function(){if(1===arguments.length){var a=arguments[0];_type.isString(a)?f=arguments[0]:_type.isArray(a)&&a.length&&(f=arguments[0].join(" "));return this}return f};this.fields=function(){if(1===arguments.length){var a=arguments[0];_type.isString(a)?m=a:_type.isArray(a)&&a.length&&(m=a.join(","));return this}return m};this.filter(e.filter||"");this.freeText(e.freeText||
"");this.fields(e.fields||"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(a){for(var b in a)e[b]=a[b];l=new g(e);p=new c(e);return this};this.getQueryString=function(){var a=l.toString()+"&"+p.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");
this.fields()&&0<this.fields().trim().length&&(a+="&fields="+this.fields());return a};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+r+"/"+q+"/find/all?"+this.getQueryString()};this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&!_type.isFunction(this[b])&&(a[b]=this[b]);return a};this._setPaging=function(a){a&&(l.pageNumber(a.pagenumber),l.pageSize(a.pagesize),
this.results=this.results||[],this.results.isLastPage=!0,this.results.total=a.totalrecords,this.results.pageNumber=a.pagenumber,this.results.pageSize=a.pagesize,a.pagenumber*a.pagesize<=a.totalrecords&&(this.results.isLastPage=!0))};var t=function(b){var e=[];b||(b=[]);var c="article"===r?"Article":"Connection";q&&"user"==q.toLowerCase()&&(c="User");b.forEach(function(b){e.push(new a.Appacitive[c](b,!0))});return e};this.fetch=function(b){var e=a.Appacitive.Promise.buildPromise(b);b=this.toRequest();
b.onSuccess=function(a){u.results=t(a[r+"s"]);u._setPaging(a.paginginfo);e.fulfill(u.results,a.paginginfo)};b.promise=e;b.entity=this;return a.Appacitive.http.send(b)};this.fetchNext=function(a){var b=this.pageNumber();this.pageNumber(++b);return this.fetch(a)};this.fetchPrev=function(a){var b=this.pageNumber(),b=b-1;0>=b&&(b=1);this.pageNumber(b);return this.fetch(a)};this.count=function(b){var e=a.Appacitive.Promise.buildPromise(b);b=this.toRequest();b.onSuccess=function(a){a=a||{};a=a.paginginfo;
var b=0,b=a?a.totalrecords:0;e.fulfill(b)};b.promise=e;b.entity=this;return a.Appacitive.http.send(b)}};a.Appacitive.Queries.FindAllQuery=function(a){a=a||{};if(!a.schema&&!a.relation||a.schema&&a.relation)throw Error("Specify either schema or relation for basic filter query");a.queryType="BasicFilterQuery";f.call(this,a);return this};a.Appacitive.Queries.FindAllQuery.prototype=new f;a.Appacitive.Queries.FindAllQuery.prototype.constructor=a.Appacitive.Queries.FindAllQuery;a.Appacitive.Queries.ConnectedArticlesQuery=
function(b){b=b||{};if(!b.relation)throw Error("Specify relation for connected articles query");if(!b.articleId)throw Error("Specify articleId for connected articles query");if(!b.schema)throw Error("Specify schema of article id for connected articles query");var e=b.schema;delete b.schema;b.queryType="ConnectedArticlesQuery";f.call(this,b);this.articleId=b.articleId;this.relation=b.relation;this.schema=e;b.article instanceof a.Appacitive.Article&&(this.article=b.article);this.returnEdge=!0;void 0===
b.returnEdge||(null===b.returnEdge||b.returnEdge||this.prev)||(this.returnEdge=!1);this.label="";var c=this;_type.isString(b.label)&&0<b.label.length&&(this.label="&label="+b.label);this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.schema+"/"+this.articleId+"/find?"+this.getQueryString()+this.label+"&returnEdge="+this.returnEdge};var g=function(b,
e){var f=[];b.forEach(function(b){var c=null;if(b.__edge){c=b.__edge;delete b.__edge;c.__endpointa=e;c.__endpointb={articleid:b.__id,label:c.__label,type:b.__schematype};delete c.label;var h=new a.Appacitive.Connection(c,!0),c=new a.Appacitive.Article(b,!0);c.connection=h}else c=new a.Appacitive.Article(b,!0);f.push(c)});c.article&&(c.article.children[c.relation]=f);return f};this.fetch=function(f){var n=a.Appacitive.Promise.buildPromise(f);f=this.toRequest();f.onSuccess=function(a){var f=g;c.prev&&
(f=prevParseNodes);c.results=f(a.nodes?a.nodes:[],{articleid:b.articleId,type:e,label:a.parent});c._setPaging(a.paginginfo);n.fulfill(c.results,a.paginginfo)};f.promise=n;f.entity=this;return a.Appacitive.http.send(f)};return this};a.Appacitive.Queries.ConnectedArticlesQuery.prototype=new f;a.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=a.Appacitive.Queries.ConnectedArticlesQuery;a.Appacitive.Queries.GetConnectionsQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsQuery query");
if(!b.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!b.label||0===b.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");b.schema&&delete b.schema;b.queryType="GetConnectionsQuery";f.call(this,b);this.articleId=b.articleId;this.relation=b.relation;this.label=b.label;this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"connection/"+
this.relation+"/find/all?"+this.getQueryString()+"&articleid="+this.articleId+"&label="+this.label};return this};a.Appacitive.Queries.GetConnectionsQuery.prototype=new f;a.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=a.Appacitive.Queries.GetConnectionsQuery;a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(b,e){b=b||{};if(!b.articleAId||!_type.isString(b.articleAId)||0===b.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");
if(!b.articleBId||!_type.isString(b.articleBId)||0===b.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");b.schema&&delete b.schema;b.queryType=e||"GetConnectionsBetweenArticlesQuery";f.call(this,b);this.articleAId=b.articleAId;this.articleBId=b.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"===this.queryType()&&b.label&&_type.isString(b.label)&&0<b.label.length?"&label="+b.label:"";this.relation=b.relation&&_type.isString(b.relation)&&
0<b.relation.length?b.relation+"/":"";this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+"?"+this.getQueryString()+this.label};return this};a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new f;a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;
a.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");b=new a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(b,"GetConnectionsBetweenArticlesForRelationQuery");b.fetch=function(b){var c=a.Appacitive.Promise.buildPromise(b);b=this.toRequest();b.onSuccess=function(b){c.fulfill(b.connection?new a.Appacitive.Connection(b.connection,!0):null)};b.promise=c;b.entity=
this;return a.Appacitive.http.send(b)};return b};a.Appacitive.Queries.InterconnectsQuery=function(b){b=b||{};if(!b.articleAId||!_type.isString(b.articleAId)||0===b.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(b.articleBIds&&_type.isArray(b.articleBIds)&&0<b.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");b.schema&&delete b.schema;b.queryType="InterconnectsQuery";f.call(this,b);this.articleAId=b.articleAId;this.articleBIds=
b.articleBIds;this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="post";b.data={article1id:this.articleAId,article2ids:this.articleBIds};return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};a.Appacitive.Queries.InterconnectsQuery.prototype=new f;a.Appacitive.Queries.InterconnectsQuery.prototype.constructor=a.Appacitive.Queries.InterconnectsQuery;a.Appacitive.Queries.GraphFilterQuery=
function(b,e){if(!b||0===b.length)throw Error("Specify name of filter query");this.name=b;this.data={};this.queryType="GraphFilterQuery";if(e){this.data.placeholders=e;for(var c in this.data.placeholders)this.data.placeholders[c]=String.addSlashes(this.data.placeholders[c])}this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="post";b.data=this.data;return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(b){var e=
a.Appacitive.Promise.buildPromise(b);b=this.toRequest();b.onSuccess=function(a){e.fulfill(a.ids?a.ids:[])};b.promise=e;b.entity=this;return a.Appacitive.http.send(b)}};a.Appacitive.Queries.GraphProjectQuery=function(b,e,c){if(!b||0===b.length)throw Error("Specify name of project query");if(!e||!e.length)throw Error("Specify ids to project");this.name=b;this.data={ids:e};this.queryType="GraphProjectQuery";if(c){this.data.placeholders=c;for(var f in this.data.placeholders)this.data.placeholders[f]=
String.addSlashes(this.data.placeholders[f])}this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="post";b.data=this.data;return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var g=function(b){var e,c;for(c in b)if("status"!==c){e=b[c];break}var h=function(b,e,c){var f=[];b.forEach(function(b){var g=b.__children;delete b.__children;var k=b.__edge;delete b.__edge;b=new a.Appacitive.Article(b,!0);b.children={};for(var m in g)b.children[m]=
[],b.children[m]=h(g[m].values,g[m].parent,b.id);k&&(k.__endpointa={articleid:c,label:e},k.__endpointb={articleid:b.id(),label:k.__label},delete k.__label,b.connection=new a.Appacitive.Connection(k,!0));f.push(b)});return f};return h(e.values)};this.fetch=function(b){var e=a.Appacitive.Promise.buildPromise(b);b=this.toRequest();b.onSuccess=function(a){e.fulfill(g(a))};b.promise=e;b.entity=this;return a.Appacitive.http.send(b)}}})(global);
(function(a){a.Appacitive.BaseObject=function(g,c){var f={},b=function(a,b){for(var e in a)if(_type.isString(a[e]))b[e]=a[e];else if(_type.isObject("object"==a[e])){b[e]=0<=a[e].length?[]:{};for(var c in a[e])b[e][c]=a[e][c]}else b[e]=a[e]},e=this,h={};b(g,h);c&&b(h,f);!f.__id&&h.__id&&(f.__id=h.__id);h.__schematype?(h.__schematype=h.__schematype.toLowerCase(),this.schema=this.entityType=h.__schematype,this.type="user"==h.__schematype||"device"==h.__schematype?h.__schematype:"article"):h.__relationtype&&
(h.__relationtype=h.__relationtype.toLowerCase(),this.relation=this.entityType=h.__relationtype,this.type="connection");this.cid=parseInt(1E6*Math.random(),10);var k="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),m=["__link","__endpointa","__endpointb"],n=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.attributes=
this.toJSON=this.getObject=function(){return JSON.parse(JSON.stringify(h))};this.properties=function(){var a=this.attributes();delete a.__attributes;delete a.__tags;return a};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};h.__attributes||(h.__attributes={});f.__attributes||(f.__attributes={});this.attr=function(){if(0===arguments.length)h.__attributes||(h.__attributes={});else{if(1===arguments.length)return h.__attributes||(h.__attributes={}),
h.__attributes[arguments[0]];if(2===arguments.length){if(!_type.isString(arguments[1])&&null!==arguments[1])throw Error("only string values can be stored in attributes.");h.__attributes||(h.__attributes={});h.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return h.__attributes};var l=function(){if(!f.__attributes)return null;var a=!1,b=JSON.parse(JSON.stringify(f.__attributes)),e;for(e in h.__attributes)_type.isNullOrUndefined(h.__attributes[e])?
(b[e]=null,a=!0):h.__attributes[e]!=f.__attributes[e]?(b[e]=h.__attributes[e],a=!0):h.__attributes[e]==f.__attributes[e]&&delete b[e];return a?b:null};this.getChangedAttributes=l;this.aggregate=function(){var a={},b;for(b in h){if(!h.hasOwnProperty(b))return;"$"==b[0]&&(a[b.substring(1)]=h[b])}if(0===arguments.length)return a;if(1==arguments.length)return a[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var p=[];h.__tags||(h.__tags=
[]);f.__tags||(f.__tags=[]);this.tags=function(){return h.__tags?h.__tags:[]};this.addTag=function(a){if(!a||!_type.isString(a)||!a.length)return this;h.__tags||(h.__tags=[]);h.__tags.push(a);h.__tags=Array.distinct(h.__tags);if(!p||!p.length)return this;a=p.indexOf(a);-1!=a&&p.splice(a,1);return this};this.removeTag=function(a){if(!a||!_type.isString(a)||!a.length)return this;p.push(a);p=Array.distinct(p);if(!h.__tags||!h.__tags.length)return this;a=h.__tags.indexOf(a);-1!=a&&h.__tags.splice(a,1);
return this};var q=function(){if(!h.__tags)return[];if(!f.__tags)return h.__tags;var a=[];h.__tags.forEach(function(b){-1==f.__tags.indexOf(b)&&a.push(b)});return a};this.getChangedTags=q;this.getRemovedTags=function(){return _removetags};var r=function(a){var b=!1,e=JSON.parse(JSON.stringify(f)),c;for(c in h)_type.isNullOrUndefined(h[c])?(e[c]=null,b=!0):h[c]!=f[c]?"__tags"==c||"__attributes"==c?delete e[c]:(e[c]=h[c],b=!0):h[c]==f[c]&&delete e[c];try{k.forEach(function(a){e[a]&&delete e[a]})}catch(g){}a?
(h.__tags&&0<h.__tags.length&&(e.__addtags=q(),b=!0),p&&0<p.length&&(e.__removetags=p,b=!0)):h.__tags&&0<h.__tags.length&&(e.__tags=q(),b=!0);(a=l())?(e.__attributes=a,b=!0):delete e.__attributes;for(var m in e)"$"==m[0]&&delete e[m];return b&&!Object.isEmpty(e)?e:!1};this.changed=function(){return r()};this.hasChanged=function(){var a=r(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&_type.isString(arguments[0])&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=
function(){var a=r(!0);if(0===arguments.length)return a;if(1==arguments.length&&_type.isArray(arguments[0])&&arguments[0].length){var b={};arguments[0].forEach(function(e){a[e]&&b.push(a[e])});return b}return!1};this.previous=function(){return 1==arguments.length&&_type.isString(arguments[0])&&arguments[0].length?f[arguments[0]]:null};this.previousAttributes=function(){return f};var u="";this.fields=function(){if(1==arguments.length){var a=arguments[0];_type.isString(a)?u=a:_type.isArray(a)&&(u=a.join(","));
return this}return u};var t={integer:function(a){if(a){var b=parseInt(a);if(!isNaN(b))return b}return a},decimal:function(a){if(a){var b=parseFloat(a);if(!isNaN(b))return b}return a},"boolean":function(a){return void 0!==a&&null!==a&&("true"===a.toString().toLowerCase()||!0===a||0<a)?!0:!1},date:function(b){if(b){var e=a.Appacitive.Date.parseISODate(b);if(e)return e}return b},datetime:function(b){if(b){var e=a.Appacitive.Date.parseISODate(b);if(e)return e}return b},time:function(b){if(b){var e=a.Appacitive.Date.parseISOTime(b);
if(e)return e}return b},string:function(a){return a?a.toSting():a}};this.get=function(a,b){if(a){if(b&&t[b.toLowerCase()]){if(t[b.toLowerCase()])return t[b.toLowerCase()](h[a]);throw Error('Invalid cast-type "'+b+'"" provided for get "'+a+'"');}return h[a]}};this.tryGet=function(a,b,e){a=this.get(a,e);return void 0!==a?a:b};this.set=function(b,e){if(!b||!_type.isString(b)||0===b.length||0===b.trim().indexOf("$"))return this;_type.isNullOrUndefined(e)?h[b]=null:_type.isString(e)?h[b]=e:_type.isNumber(e)||
_type.isBoolean(e)?h[b]=e+"":_type.isObject(e)&&(e instanceof Date?h[b]=a.Appacitive.Date.toISOString(e):0<=e.length?h[b]=e:-1!==m.indexOf(b)&&(h[b]=e));return this};this.unset=function(a){if(!a||!_type.isString(a)||0===a.length||0===a.indexOf("__"))return this;try{delete h[a]}catch(b){}return this};this.has=function(a){return a&&_type.isString(a)&&0!==a.length?h[a]&&!_type.isUndefined(h[a])?!0:!1:!1};this.isNew=function(){return h.__id&&h.__id.length?!1:!0};this.clone=function(){return"article"==
this.type?new a.Appacitive.Article(this.toJSON()):new a.Appacitive.connection(h)};this.copy=function(a,e){a&&(b(a,h),e&&b(a,f));return this};var v=[],w=function(a,b,c){if(!a||!_type.isString(a)||0===a.length||0===a.indexOf("__"))return this;b=!b||isNaN(parseInt(b))?c:parseInt(b)*c;v.push({key:a.toLowerCase(),amount:b});return e};this.increment=function(a,b){return w(a,b,1)};this.decrement=function(a,b){return w(a,b,-1)};this.save=function(){return h.__id?x.apply(this,arguments):z.apply(this,arguments)};
var z=function(c){var g=a.Appacitive.Promise.buildPromise(c);c=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[this.type].getCreateUrl(h.__schematype||h.__relationtype,u);!h.__schematype||"user"!=h.__schematype.toLowerCase()&&"device"!=h.__schematype.toLowerCase()||(c=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[h.__schematype.toLowerCase()].getCreateUrl());for(var k in h)"$"==k[0]&&delete h[k];h.__revision&&delete h.__revision;k=new a.Appacitive.HttpRequest;k.url=
c;k.method="put";k.data=h;k.onSuccess=function(c){var k=null;c&&(c.article||c.connection||c.user||c.device)&&(k=c.article||c.connection||c.user||c.device);c&&k?(f=k,h.__id=k.__id,b(k,h),"connection"==e.type&&e.parseConnection(),a.Appacitive.eventManager.fire((e.schema||e.relation)+"."+e.type+".created",e,{object:e}),e.created=!0,g.fulfill(e)):(a.Appacitive.eventManager.fire((e.schema||e.relation)+"."+e.type+".createFailed",e,{error:c.status}),g.reject(c.status,e))};k.promise=g;k.entity=this;return a.Appacitive.http.send(k)},
x=function(c,g){a.Appacitive.Promise.is(g)||(g=a.Appacitive.Promise.buildPromise(c));var k=function(k){var m=r(!0),l;for(l in m)"$"==l[0]&&delete m[l];if(Object.isEmpty(m))g.fulfill(e);else{l=u;var q=new a.Appacitive.HttpRequest,y=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[e.type].getUpdateUrl(h.__schematype||h.__relationtype,f.__id?f.__id:h.__id,l,k),t=e.type;h&&(h.__schematype&&("user"==h.__schematype.toLowerCase()||"device"==h.__schematype.toLowerCase()))&&(t=h.__schematype.toLowerCase(),
y=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[h.__schematype.toLowerCase()].getUpdateUrl(f.__id,l,k));q.url=y;q.method="post";q.data=m;q.onSuccess=function(k){k&&k[t]?(v.length=0,f=k[e.type],b(f,h),p=[],delete e.created,a.Appacitive.eventManager.fire((e.schema||e.relation)+"."+t+"."+h.__id+".updated",e,{object:e}),g.fulfill(e)):"14008"==k.status.code&&0<v.length?x(c,g):(a.Appacitive.eventManager.fire((e.schema||e.relation)+"."+t+"."+h.__id+".updateFailed",e,{object:k.status}),g.reject(k.status,
e))};q.onError=function(a){a=n(a);"14008"==a.code&&0<v.length?x(c,g):g.reject(a,e)};a.Appacitive.http.send(q)}};if(0<v.length){var m=["__revision"];v.forEach(function(a){m.push(a.key)});a.Appacitive.Article.get({schema:this.get("__schematype"),id:this.id(),fields:m}).then(function(a){a=a.toJSON();v.forEach(function(b){var c=t.integer(a[b.key]);c||(c=0);e.set(b.key,c+b.amount)});k(a.__revision)},function(a){g.reject(a)})}else k();return g},A=function(c){if(!h.__id)throw Error("Please specify id for get operation");
var g=new a.Appacitive.Promise.buildPromise(c);c=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[e.type].getGetUrl(h.__schematype||h.__relationtype,h.__id,u);var k=new a.Appacitive.HttpRequest;k.url=c;k.method="get";k.onSuccess=function(a){a&&a[e.type]?(f=a[e.type],b(f,h),a.connection&&(e.endpoints||e.endpointA&&e.endpointB||e.setupConnection(h.__endpointa,h.__endpointb)),g.fulfill(e)):(a=a||{},a.status=a.status||{},a.status=n(a.status),g.reject(a.status,e))};k.entity=this;k.promise=
g;return a.Appacitive.http.send(k)};this.fetch=function(a){return A(a)};this.del=this.destroy=function(b,e){_type.isBoolean(b)?(e=b,b=null):_type.isBoolean(e)||(e=!1);var c=new a.Appacitive.Promise.buildPromise(b);if(!h.__id)return c.fulfill(),c;var f=a.Appacitive.config.apiBaseUrl,f=f+a.Appacitive.storage.urlFactory[this.type].getDeleteUrl(h.__schematype||h.__relationtype,h.__id);h&&(h.__schematype&&("user"==h.__schematype.toLowerCase()||"device"==h.__schematype.toLowerCase()))&&(f=a.Appacitive.config.apiBaseUrl,
f+=a.Appacitive.storage.urlFactory[h.__schematype.toLowerCase()].getDeleteUrl(h.__id));e&&!0===e&&(f=-1==f.indexOf("?")?f+"?deleteconnections=true":f+"&deleteconnections=true");var g=new a.Appacitive.HttpRequest;g.url=f;g.method="delete";g.onSuccess=function(a){c.fulfill(a)};g.promise=c;g.entity=this;return a.Appacitive.http.send(g)}};a.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(a){var g=function(){return Math.floor(65536*Math.random()).toString(16)};a.Appacitive.GUID=function(){var a=g()+g()+"-"+g()+"-"+g()+"-"+g()+"-"+g()+g()+g(),f="",b,e,h,k,m,n,l=0,a=a.replace(/\r\n/g,"\n");e="";for(h=0;h<a.length;h++)k=a.charCodeAt(h),128>k?e+=String.fromCharCode(k):(127<k&&2048>k?e+=String.fromCharCode(k>>6|192):(e+=String.fromCharCode(k>>12|224),e+=String.fromCharCode(k>>6&63|128)),e+=String.fromCharCode(k&63|128));for(a=e;l<a.length;)b=a.charCodeAt(l++),e=a.charCodeAt(l++),
h=a.charCodeAt(l++),k=b>>2,b=(b&3)<<4|e>>4,m=(e&15)<<2|h>>6,n=h&63,isNaN(e)?m=n=64:isNaN(h)&&(n=64),f=f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n);return f.toString()}})(global);
(function(a){a.Appacitive.Article=function(c,f){c=c||{};_type.isString(c)&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);a.Appacitive.BaseObject.call(this,c,f);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;this.children={};this.toJSON=function(a){if(a){var e=function(a){var b=[];a.forEach(function(a){var c=a.getObject();if(a.children&&!Object.isEmpty(a.children)){c.children=
{};for(var f in a.children)c.children[f]=e(a.children[f])}a.connection&&(c.__connection=a.connection.toJSON());b.push(c)});return b};return e([this])[0]}return this.getObject()};return this};a.Appacitive.Article.prototype=new a.Appacitive.BaseObject;a.Appacitive.Article.prototype.constructor=a.Appacitive.Article;var g=function(c){var f=[];c.forEach(function(b){f.push(new a.Appacitive.Article(b,!0))});return f};a.Appacitive._parseArticles=g;a.Appacitive.Article.multiDelete=function(c,f){c=c||{};if(!c.schema||
!_type.isString(c.schema)||0===c.schema.length)throw Error("Specify valid schema");if("user"===c.schema.toLowerCase()||"device"===c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var b=a.Appacitive.Promise.buildPromise(f),e=new a.Appacitive.HttpRequest;e.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);e.method="post";e.data={idlist:c.ids};e.onSuccess=
function(a){b.fulfill()};e.promise=b;return a.Appacitive.http.send(e)};a.Appacitive.Article.multiGet=function(c,f){c=c||{};if(!c.schema||!_type.isString(c.schema)||0===c.schema.length)throw Error("Specify valid schema");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var b=a.Appacitive.Promise.buildPromise(f),e=new a.Appacitive.HttpRequest;e.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);e.method="get";
e.onSuccess=function(a){b.fulfill(g(a.articles))};e.promise=b;return a.Appacitive.http.send(e)};a.Appacitive.Article.get=function(c,f){c=c||{};if(!c.schema)throw Error("Specify schema");if(!c.id)throw Error("Specify id to fetch");var b={},b="user"===c.schema.toLowerCase()?new a.Appacitive.User({__id:c.id}):new a.Appacitive.Article({__schematype:c.schema,__id:c.id});b.fields=c.fields;return b.fetch(f)};a.Appacitive.Article.prototype.getConnections=function(c){if(this.isNew())throw Error("Cannot fetch connections for new article");
c.articleId=this.get("__id");return new a.Appacitive.Queries.GetConnectionsQuery(c)};a.Appacitive.Article.prototype.getConnectedArticles=function(c){if(this.isNew())throw Error("Cannot fetch connections for new article");c=c||{};_type.isString(c)&&(c={relation:c});c.schema=this.entityType;c.articleId=this.get("__id");c.article=this;return new a.Appacitive.Queries.ConnectedArticlesQuery(c)};a.Appacitive.Article.prototype.fetchConnectedArticles=a.Appacitive.Article.prototype.getConnectedArticles;a.Appacitive.Article.findAll=
function(c){return new a.Appacitive.Queries.FindAllQuery(c)}})(global);
(function(a){var g=function(b,e,c){var f={label:b.label};b.articleid&&(f.articleid=b.articleid);if(b.article)_type.isFunction(b.article.getArticle)?b.article.get("__id")?f.articleid=b.article.get("__id"):f.article=b.article.getArticle():_type.isObject(b.article)&&(b.article.__id?f.articleid=b.article.__id:f.article=b.article,b.article=new a.Appacitive.Article(b.article));else if(!f.articleid&&!f.article)throw Error("Incorrectly configured endpoints provided to setupConnection");c["endpoint"+e]=b;
return f},c=function(b,e,c){b.article&&_type.isObject(b.article)?(c["endpoint"+e]?c["endpoint"+e]&&c["endpoint"+e].article&&c["endpoint"+e].article instanceof a.Appacitive.Article?c["endpoint"+e].article.copy(b.article,!0):c["endpoint"+e].article=new a.Appacitive.Article(b.article,!0):(c["endpoint"+e]={},c["endpoint"+e].article=new a.Appacitive.Article(b.article,!0)),c["endpoint"+e].articleid=b.article.__id,c["endpoint"+e].label=b.label,c["endpoint"+e].type=b.type):c["endpoint"+e]=b};a.Appacitive.Connection=
function(b,e){b=b||{};_type.isString(b)&&(b={__relationtype:b});if(!b.__relationtype&&!b.relation)throw Error("Cannot set connection without relation");b.relation&&(b.__relationtype=b.relation,delete b.relation);b.endpoints&&2===b.endpoints.length&&(b.__endpointa=b.endpoints[0],b.__endpointb=b.endpoints[1],delete b.endpoints);a.Appacitive.BaseObject.call(this,b,e);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var a="A",e="B";b.__endpointa.label.toLowerCase()!==
this.get("__endpointb").label.toLowerCase()||(b.__endpointa.label.toLowerCase()==b.__endpointb.label.toLowerCase()||b.__endpointa.articleid!=this.get("__endpointb").articleid&&b.__endpointa.articleid)||(a="B",e="A");c(this.get("__endpointa"),a,this);c(this.get("__endpointb"),e,this);this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;
throw Error("Invalid label provided");}var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};e?this.parseConnection(b):b.__endpointa&&b.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};a.Appacitive.Connection.prototype=new a.Appacitive.BaseObject;a.Appacitive.Connection.prototype.constructor=a.Appacitive.Connection;a.Appacitive.Connection.prototype.setupConnection=function(a,e){if(!(a&&(a.articleid||a.article)&&a.label&&e&&(e.articleid||
e.article)&&e.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",g(a,"A",this));this.set("__endpointb",g(e,"B",this));this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var a=[];a.push(this.endpointA);a.push(this.endpointB);
return a}};a.Appacitive.Connection.get=function(b,e){b=b||{};if(!b.relation)throw Error("Specify relation");if(!b.id)throw Error("Specify id to fetch");var c=new a.Appacitive.Connection({__relationtype:b.relation,__id:b.id});c.fields=b.fields;return c.fetch(e)};var f=function(b){var e=[];b||(b=[]);b.forEach(function(b){e.push(new a.Appacitive.Connection(b,!0))});return e};a.Appacitive.Connection._parseConnections=f;a.Appacitive.Connection.multiGet=function(b,e){b=b||{};if(!b.relation||!_type.isString(b.relation)||
0===b.relation.length)throw Error("Specify valid relation");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var c=a.Appacitive.Promise.buildPromise(e),g=new a.Appacitive.HttpRequest;g.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.connection.getMultiGetUrl(b.relation,b.ids.join(","),b.fields);g.method="get";g.onSuccess=function(a){c.fulfill(f(a.connections))};g.promise=c;return a.Appacitive.http.send(g)};a.Appacitive.Connection.multiDelete=function(b,e){b=b||{};
var c=a.Appacitive.Promise.buildPromise(e);if(!b.relation||!_type.isString(b.relation)||0===b.relation.length)throw Error("Specify valid relation");if(!b.ids||0===b.ids.length)throw Error("Specify ids to get");var f=new a.Appacitive.HttpRequest;f.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(b.relation);f.method="post";f.data={idlist:b.ids};f.onSuccess=function(a){c.fulfill()};f.promise=c;return a.Appacitive.http.send(f)};a.Appacitive.Connection.findAll=
function(b){return new a.Appacitive.Queries.FindAllQuery(b)};a.Appacitive.Connection.getInterconnects=function(b){return new a.Appacitive.Queries.InterconnectsQuery(b)};a.Appacitive.Connection.getBetweenArticles=function(b){return new a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(b)};a.Appacitive.Connection.getBetweenArticlesForRelation=function(b){return new a.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(b)}})(global);
(function(a){a.Appacitive.Users=new function(){var g=null;this.currentUser=this.current=function(){return g};var c=function(b,c,f){var g=this.get("__id");if(!g||!_type.isString(g)||0===g.length)throw Error("Please specify valid userid");if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid oldPassword");if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid newPassword");var n=a.Appacitive.Promise.buildPromise(f);b={oldpassword:b,newpassword:c};c=new a.Appacitive.HttpRequest;
c.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g);c.method="post";c.data=b;var l=this;c.onSuccess=function(a){n.fulfill(l)};c.promise=n;c.entity=this;return a.Appacitive.http.send(c)},f=function(b,c){var f=this.get("__id"),g=a.Appacitive.Promise.buildPromise(c);if(!this.get("__id"))return this.set("__link",b),g.fulfill(this),g;var n=this,l=new a.Appacitive.HttpRequest;l.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f);
l.method="post";l.data=b;l.onSuccess=function(a){a=n.get("__link");_type.isArray(a)||(a=a?[a]:[]);a.push(b);n.set("__link",a);g.fulfill(n)};l.promise=g;l.entity=this;return a.Appacitive.http.send(l)};this.setCurrentUser=function(b,f,k){if(!b)throw Error("Cannot set null object as user");var m=b;if(m instanceof a.Appacitive.User)if(m.get("__id")&&0!==m.get("__id").length)b=m.toJSON();else throw Error("Specify user __id");else m=new a.Appacitive.User(b,!0);a.Appacitive.localStorage.set("Appacitive-User",
b);k||(k=60);g=m;f&&a.Appacitive.Session.setUserAuthHeader(f,k);g.logout=function(b){return a.Appacitive.Users.logout(b)};g.updatePassword=function(a,b,e){return c.apply(this,[a,b,e])};g.logout=function(b){return a.Appacitive.Users.logout(b)};a.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(b,e){a.Appacitive.localStorage.set("Appacitive-User",e.object.getArticle())});return g};a.Appacitive.User=function(b){b=b||{};b.__schematype="user";a.Appacitive.Article.call(this,
b);return this};a.Appacitive.User.prototype=new a.Appacitive.Article("user");a.Appacitive.User.prototype.constructor=a.Appacitive.User;a.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?_type.isArray(a)||(a=[a]):a=[];return a};a.Appacitive.User.prototype.getAllLinkedAccounts=function(b){var c=this.get("__id"),f=a.Appacitive.Promise.buildPromise(b);if(!c||!_type.isString(c)||0===c.length)return f.fulfill(this.linkedAccounts(),this),f;var g=this;b=new a.Appacitive.HttpRequest;
b.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(c);b.method="get";b.onSuccess=function(a){a=a.identities||[];0<a.length?g.set("__link",a):g.set("__link",null);f.fulfill(a,g)};b.promise=f;b.entity=this;return a.Appacitive.http.send(b)};a.Appacitive.User.prototype.checkin=function(b,c){var f=this.get("__id");f&&_type.isString(f)&&0!==f.length||onSuccess&&_type.isFunction(onSuccess)&&onSuccess();if(!(b&&b instanceof a.Appacitive.GeoCoord))throw Error("Invalid coordinates provided");
var g=a.Appacitive.Promise.buildPromise(c),n=this,l=new a.Appacitive.HttpRequest;l.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getCheckinUrl(f,b.lat,b.lng);l.method="post";l.onSuccess=function(a){g.fulfill(accounts,n)};l.promise=g;l.entity=this;return a.Appacitive.http.send(l)};a.Appacitive.User.prototype.linkFacebook=function(a,b){if(!a||!_type.isString(a))throw Error("Please provide accessToken");return f.apply(this,[{authtype:"facebook",accesstoken:a,name:"facebook"},
b])};a.Appacitive.User.prototype.linkTwitter=function(a,b){if(!_type.isObject(a)||!a.oAuthToken||!a.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var c={authtype:"twitter",oauthtoken:a.oAuthToken,oauthtokensecret:a.oAuthTokenSecret};a.consumerKey&&a.consumerSecret&&(c.consumersecret=a.consumerSecret,c.consumerkey=a.consumerKey);return f.apply(this,[c,b])};a.Appacitive.User.prototype.unlink=function(b,c){if(!_.isString(b))throw Error("Specify aouth account type for unlinking");
var f=this.get("__id"),g=a.Appacitive.Promise.buildPromise(c);if(!this.get("__id"))return this.set("__link",null),g.fulfill(this),g;var n=this,l=new a.Appacitive.HttpRequest;l.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,b);l.method="post";l.onSuccess=function(a){(a=n.get("__link"))?_type.isArray(a)||(a=[a]):a=[];if(0<=a.length){var c=null;a.forEach(function(a,f){a.name==b.toLowerCase()&&(c=f)});null!=c&&a.splice(c,1);n.set("__link",a)}else n.set("__link",
null);g.fulfill(n)};l.promise=g;l.entity=this;return a.Appacitive.http.send(l)};a.Appacitive.User.prototype.clone=function(){return new a.Appacitive.User(this.getObject())};this.deleteUser=function(b,c){if(!b)throw Error("Specify userid for user delete");return(new a.Appacitive.Article({__schematype:"user",__id:b})).del(c)};this.deleteCurrentUser=function(b){var c=a.Appacitive.Promise.buildPromise(b);if(null===g)return a.Appacitive.Session.removeUserAuthHeader(),c.fulfill(),c;b=g.get("__id");this.deleteUser(b).then(function(){a.Appacitive.Session.removeUserAuthHeader();
c.fulfill()},function(){c.reject(arguments)});return c};this.createUser=this.createNewUser=function(b,c){b=b||{};b.__schematype="user";if(!b.username||!b.password||!b.firstname||0===b.username.length||0===b.password.length||0===b.firstname.length)throw Error("username, password and firstname are mandatory");return(new a.Appacitive.User(b)).save(c)};this.signup=function(b,c){var f=this,g=a.Appacitive.Promise.buildPromise(c);this.createUser(b).then(function(){f.login(b.username,b.password).then(function(){g.fulfill.apply(g,
arguments)},function(a){g.reject.apply(g,arguments)})},function(){g.reject(arguments)});return g};this.authenticateUser=function(b,c,f){var m=a.Appacitive.Promise.buildPromise(c);b.expiry||(b.expiry=864E5);var n=this;c=new a.Appacitive.HttpRequest;c.method="post";c.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();c.data=b;c.onSuccess=function(a){a&&a.user?(f&&(a.user.__authType=f),n.setCurrentUser(a.user,a.token,b.expiry),m.fulfill({user:g,token:a.token})):
m.reject(a.status)};c.promise=m;return a.Appacitive.http.send(c)};this.login=function(a,b,c){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");return this.authenticateUser({username:a,password:b,expiry:864E5},c,"BASIC")};this.loginWithFacebook=function(a,b){if(!a||!_type.isString(a))throw Error("Please provide accessToken");return that.authenticateUser({accesstoken:a,type:"facebook",expiry:864E5,createnew:!0},b,"FB")};this.loginWithTwitter=function(a,b){if(!_type.isObject(a)||
!a.oAuthToken||!a.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var c={type:"twitter",oauthtoken:a.oAuthToken,oauthtokensecret:a.oAuthTokenSecret,expiry:864E5,createnew:!0};a.consumerKey&&a.consumerSecret&&(c.consumersecret=a.consumerSecret,c.consumerkey=a.consumerKey);return that.authenticateUser(c,b,"TWITTER")};this.validateCurrentUser=function(b,c){var f=a.Appacitive.Promise.buildPromise({success:c});c&&_type.isBoolean(c)&&(b=c,c=function(){});var g=a.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!g)return f.fulfill(!1),f;if(b)f.fulfill(!0);else try{var n=this;this.getUserByToken(g).then(function(a){n.setCurrentUser(a,g);f.fulfill(!0)},function(){f.fulfill(!1)})}catch(l){f.fulfill(!1)}return f};var b=function(b,c){var f=a.Appacitive.Promise.buildPromise(c),g=new a.Appacitive.HttpRequest;g.url=b;g.method="get";g.onSuccess=function(b){b&&b.user?f.fulfill(new a.Appacitive.User(b.user)):f.reject(b.status)};g.promise=f;return a.Appacitive.http.send(g)};this.getUserByToken=function(c,f){if(!c||
!_type.isString(c)||0===c.length)throw Error("Please specify valid token");var g=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getUserByTokenUrl(c);a.Appacitive.Session.setUserAuthHeader(c,0,!0);return b(g,f)};this.getUserByUsername=function(c,f){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid username");var g=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(c);return b(g,f)};this.logout=function(b,c){g=null;return a.Appacitive.Session.removeUserAuthHeader(b||
function(){},c)};this.sendResetPasswordEmail=function(b,c,f){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");if(!c||!_type.isString(c)||0===c.length)throw Error("Plase specify subject for email");var g=a.Appacitive.Promise.buildPromise(f);b={username:b,subject:c};c=new a.Appacitive.HttpRequest;c.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=b;c.onSuccess=function(){g.fulfill()};c.promise=
g;return a.Appacitive.http.send(c)};this.resetPassword=function(b,c,f){if(!b)throw Error("Please specify token");if(!c||0===c.length)throw Error("Please specify password");var g=a.Appacitive.Promise.buildPromise(f);f=new a.Appacitive.HttpRequest;f.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getResetPasswordUrl(b);f.method="post";f.data={newpassword:c};f.onSuccess=function(a){g.fulfill()};f.promise=g;return a.Appacitive.http.send(f)};this.validateResetPasswordToken=function(b,
c){if(!b)throw Error("Please specify token");var f=a.Appacitive.Promise.buildPromise(c),g=new a.Appacitive.HttpRequest;g.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getValidateResetPasswordUrl(b);g.method="post";g.data={};g.onSuccess=function(a){f.fulfill(a.user)};g.promise=f;return a.Appacitive.http.send(g)}}})(global);
(function(a){var g=function(){var c=null,f=this.FB=null,b=!1;this.initialize=function(a){if(!Facebook)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!a.appId)throw Error("Please provide appid");if(!a.appSecret)throw Error("Please provide app secret");f=a.appSecret;this.FB=new (require("facebook-node-sdk"))({appId:_appId,secret:f});b=!0};this.requestLogin=function(a){a&&(c=a);return(new Appacitive.Promise).fulfill()};this.getCurrentUserInfo=function(){if(!b)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
var a=new Appacitive.Promise;this.FB&&c?this.FB.api("/me",function(b,c){c?a.fulfill(c):a.reject("Access token is invalid")}):a.reject("Either intialize facebook with your appid and appsecret or set accesstoken");return a};this.accessToken=function(){return 1===arguments.length?(c=arguments[0],this):c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(){a.Appacitive.Facebook.accessToken="";return(new Appacitive.Promise).fulfill()}};a.Appacitive.Facebook=
a.Appacitive.runtime.isBrowser?new function(){var c=null,f=!0;this.initialize=function(a){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!a.appId)throw Error("Please provide appid");FB.init(a);f=!0};this.requestLogin=function(a){a=a||{};if(!f)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var e=new Appacitive.Promise;FB.login(function(a){a&&"connected"===a.status&&a.authResponse?(c=a.authResponse.accessToken,e.fulfill(a.authResponse)):
e.reject()},a);return e};this.getCurrentUserInfo=function(){if(!f)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var a=new Appacitive.Promise;FB.api("/me",function(f){f&&!f.error?(c=FB.getAuthResponse().accessToken,a.fulfill(f)):a.reject()});return a};this.accessToken=function(){return 1===arguments.length?(c=arguments[0],this):c};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(){c=null;var b=new Appacitive.Promise;
try{FB.logout(function(){a.Appacitive.Users.logout();b.fulfill()})}catch(f){b.reject(f.message)}return b}}:new g})(global);
(function(a){a.Appacitive.Email=new function(){var g={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return g};var c=function(c,b){var e=a.Appacitive.Promise.buildPromise(b),g=new a.Appacitive.HttpRequest;g.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.email.getSendEmailUrl();g.method="post";g.data=c;g.onSuccess=function(a){e.fulfill(a.email)};g.promise=e;g.entity=c;return a.Appacitive.http.send(g)};
this.setupEmail=function(a){a=a||{};g.smtp.username=a.username||g.smtp.username;g.from=a.from||g.from;g.smtp.password=a.password||g.smtp.password;g.smtp.host=a.smtp.host||g.smtp.host;g.smtp.port=a.smtp.port||g.smtp.port;g.smtp.enablessl=a.enableSSL||g.smtp.enablessl;g.replyto=a.replyTo||g.replyto};this.sendTemplatedEmail=function(a,b){if(!a||!a.to||!a.to.length||0===a.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!a.subject||0===a.subject.trim().length)throw Error("Subject is mandatory to send an email");
if(!a.from&&g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!a.templateName)throw Error("template name is mandatory to send an email");var e={to:a.to||[],cc:a.cc||[],bcc:a.bcc||[],subject:a.subject,from:a.from,body:{templatename:a.templateName||"",data:a.data||{},ishtml:!1===a.isHtml?!1:!0}};if(a.useConfig){e.smtp=g.smtp;if(!a.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");e.from=
a.from||g.from;e.replyto=a.replyTo||g.replyto}return c(e,b)};this.sendRawEmail=function(a,b){if(!a||!a.to||!a.to.length||0===a.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!a.subject||0===a.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!a.from&&g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!a.body)throw Error("body is mandatory to send an email");var e={to:a.to||
[],cc:a.cc||[],bcc:a.bcc||[],subject:a.subject,from:a.from,body:{content:a.body||"",ishtml:!1===a.isHtml?!1:!0}};if(a.useConfig){e.smtp=g.smtp;if(!a.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");e.from=a.from||g.from;e.replyto=a.replyTo||g.replyto}return c(e,b)}}})(global);
(function(a){a.Appacitive.Push=new function(){this.send=function(g,c){if(!g)throw Error("Please specify push options");var f=a.Appacitive.Promise.buildPromise(c),b=new a.Appacitive.HttpRequest;b.url=a.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();b.method="post";b.data=g;b.onSuccess=function(a){f.fulfill(a.id)};b.promise=f;b.entity=g;return a.Appacitive.http.send(b)};this.getNotification=function(g,c){var f=a.Appacitive.Promise.buildPromise(c);if(!g)throw Error("Please specify notification id");
var b=new a.Appacitive.HttpRequest;b.url=a.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(g);b.method="get";b.onSuccess=function(a){f.fulfill(a.pushnotification)};b.promise=f;return a.Appacitive.http.send(b)};this.getAllNotifications=function(g,c){g?(g.pnum=g.pnum||1,g.psize=g.psize||20):g={pnum:1,psize:20};var f=a.Appacitive.Promise.buildPromise(c),b=new a.Appacitive.HttpRequest;b.url=a.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(g);
b.method="get";b.onSuccess=function(a){f.fulfill(a.pushnotifications,a.paginginfo)};b.promise=f;return a.Appacitive.http.send(b)}}})(global);
(function(a){a.Appacitive.File=function(g){g=g||{};this.fileId=g.fileId;this.contentType=g.contentType;this.fileData=g.fileData;var c=this,f=function(b,f,e){var g=new a.Appacitive.HttpRequest;g.url=b;g.method="GET";g.onSuccess=f;g.promise=e;g.entity=c;a.Appacitive.http.send(g)},b=function(b,f,e,g,h){(new FormData).append("fileToUpload",f);var q=new a.Appacitive.HttpRequest;q.url=b;q.method="PUT";q.data=f;q.headers.push({key:"content-type",value:e});q.onSuccess=g;q.send().then(g,function(){h.reject(d,
c)})};this.save=function(a){return this.fileId&&_type.isString(this.fileId)&&0<this.fileId.length?h(a):e(a)};var e=function(e){if(!c.fileData)throw Error("Please specify filedata");c.contentType&&_type.isString(c.contentType)&&0!==c.contentType.length||(c.contentType="text/plain");try{c.contentType=file.type}catch(g){}var h=a.Appacitive.Promise.buildPromise(e);e=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getUploadUrl(c.contentType,c.fileId?c.fileId:"");f(e,function(a){b(a.url,
c.fileData,c.contentType,function(){c.fileId=a.id;c.getDownloadUrl(function(a){return h.fulfill(a,c)},function(a){return h.reject(a)})},h)},h);return h},h=function(e){if(!c.fileData)throw Error("Please specify filedata");c.contentType&&_type.isString(c.contentType)&&0!==c.contentType.length||(c.contentType="text/plain");try{c.contentType=file.type}catch(g){}var h=a.Appacitive.Promise.buildPromise(e);e=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getUpdateUrl(c.fileId,c.contentType);
f(e,function(a){b(a.url,c.fileData,c.contentType,function(){c.getDownloadUrl().then(function(a){h.fulfill(a,c)},function(a){h.reject(a)})},h)},h);return h};this.deleteFile=function(b){if(!this.fileId)throw Error("Please specify fileId to delete");var e=a.Appacitive.Promise.buildPromise(b);b=new a.Appacitive.HttpRequest;b.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);b.method="DELETE";b.onSuccess=function(a){e.fulfill()};b.promise=e;b.entity=c;return a.Appacitive.http.send(b)};
this.getDownloadUrl=function(b){if(!this.fileId)throw Error("Please specify fileId to download");var e=a.Appacitive.Promise.buildPromise(b);b=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);f(b,function(a){c.url=a.uri;e.fulfill(a.uri)},e);return e};this.getUploadUrl=function(b){c.contentType&&_type.isString(c.contentType)&&0!==c.contentType.length||(c.contentType="text/plain");var e=a.Appacitive.Promise.buildPromise(b);b=a.Appacitive.config.apiBaseUrl+
a.Appacitive.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");f(b,function(a){c.url=a.url;e.fulfill(a.url,c)},e);return e}}})(global);
(function(a){a.Appacitive.Date={};var g=function(a){return 10>a?"0"+a:a};a.Appacitive.Date.parseISODate=function(a){try{if(!/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(a))return new Date(a);var f=a.split("T"),b=f[0].split("-"),e=f[1].split("Z")[0].split(":"),g=e[2].split("."),k=Number(e[0]),m=new Date;m.setUTCFullYear(Number(b[0]));m.setUTCMonth(Number(b[1])-1);m.setUTCDate(Number(b[2]));m.setUTCHours(Number(k));m.setUTCMinutes(Number(e[1]));
m.setUTCSeconds(Number(g[0]));g[1]&&m.setUTCMilliseconds(Number(g[1].substring(0,3)));return m}catch(n){return null}};a.Appacitive.Date.toISOString=function(a){try{return a=a.toISOString(),a=a.replace("Z","0000Z")}catch(f){return null}};a.Appacitive.Date.toISODate=function(a){if(a instanceof Date)return String.format("{0}-{1}-{2}",a.getFullYear(),g(a.getMonth()+1),g(a.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};a.Appacitive.Date.toISOTime=function(a){var f=
function(a){return 10>a?a+"000000":100>a?a+"00000":1E3>a?a+"0000":1E4>a?a+"000":1E5>a?a+"00":1E6>a?a+"0":a};if(a instanceof Date)return String.format("{0}:{1}:{2}.{3}",g(a.getHours()),g(a.getMinutes()),g(a.getSeconds()),f(a.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};a.Appacitive.Date.parseISOTime=function(a){try{var f=new Date,b=a.split("T");1===b.length&&b.push(b[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(b[1]))return null;
var e=b[1].split("Z")[0].split(":"),g=e[2].split("."),k=Number(e[0]);1<b.length?(f.setUTCHours(Number(k)),f.setUTCMinutes(Number(e[1])),f.setUTCSeconds(Number(g[0])),g[1]&&f.setUTCMilliseconds(Number(g[1].substring(0,3)))):(f.setHours(Number(k)),f.setMinutes(Number(e[1])),f.setSeconds(Number(g[0])),g[1]&&f.setMilliseconds(Number(g[1].substring(0,3))));return f}catch(m){return null}}})(global);
(function(a){a.Appacitive.localStorage=new (a.Appacitive.runtime.isBrowser?function(){var g=a.Appacitive.runtime.isBrowser?window.localStorage:{getItem:function(){return null}};this.set=function(c,f){f=f||"";if(!c)return!1;if(_type.isObject(f)||_type.isArray(f))try{f=JSON.stringify(f)}catch(b){}c=a.Appacitive.getAppPrefix(c);g[c]=f;return!0};this.get=function(c){if(!c)return null;c=a.Appacitive.getAppPrefix(c);c=g.getItem(c);if(!c)return null;if("{"===c[0])try{c=JSON.parse(c)}catch(f){}return c};
this.remove=function(c){if(c){c=a.Appacitive.getAppPrefix(c);try{delete g[c]}catch(f){}}}}:function(){var g=[];this.set=function(c,f){f=f||"";if(!c||_type.isString(c))return!1;c=a.Appacitive.getAppPrefix(c);g[c]=f;return!0};this.get=function(c){if(!c||_type.isString(c))return null;c=a.Appacitive.getAppPrefix(c);return(c=g[c])?c:null};this.remove=function(c){if(c&&!_type.isString(c)){c=a.Appacitive.getAppPrefix(c);try{delete g[c]}catch(f){}}}})})(global);
(function(a){a.Appacitive.Cookie=new (a.Appacitive.runtime.isBrowser?function(){this.setCookie=function(g,c,f,b){g=a.Appacitive.getAppPrefix(g);var e="";f&&(e=new Date,e.setTime(e.getTime()+6E4*f),e.toGMTString());e=b?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":a.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";f="domain="+window.location.hostname;"localhost"==window.location.hostname&&(f="");document.cookie=g+"="+c+e+"; path=/;"+f};this.readCookie=function(g){g=
a.Appacitive.getAppPrefix(g);g+="=";for(var c=document.cookie.split(";"),f=0;f<c.length;f++){for(var b=c[f];" "==b.charAt(0);)b=b.substring(1,b.length);if(0===b.indexOf(g))return b.substring(g.length,b.length)}return null};this.eraseCookie=function(a){this.setCookie(a,"",-1,!0)}}:function(){this.setCookie=function(g,c){a.Appacitive.localStorage.set("cookie/"+g,c)};this.readCookie=function(g){return a.Appacitive.localStorage.get("cookie/"+g)};this.eraseCookie=function(g){a.Appacitive.localStorage.remove("cookie/"+
g)}})})(global);"undefined"===typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
