/*
 * AppacitiveSDK.js vappacitive-js-sdk-v1.0.7 - Javascript SDK to integrate applications using Appacitive
 * Copyright (c) 2015 Appacitive Software Pvt Ltd
 * MIT license  : http://www.apache.org/licenses/LICENSE-2.0.html
 * Project      : https://github.com/chiragsanghvi/JavascriptSDK
 * Contact      : support@appacitive.com | csanghvi@appacitive.com
 * Build time 	: Tue Dec 29 18:50:50 PST 2015
 */
var global={};
(function(){global.Appacitive={runtime:{}};"undefined"!==typeof process&&process.versions&&process.versions.node?global.Appacitive.runtime.isNode=!0:"undefined"!==typeof window&&(global=window,global.Appacitive={runtime:{isBrowser:!0}});var m=global.Appacitive;m.initialize=function(c){c=c||{};var g=new m.Promise;if(m.Session.initialized)return g.fulfill(m);c.masterKey&&0<c.masterKey.length&&m.Session.setMasterKey(c.masterKey);if(!c.apikey||0===c.apikey.length)if(c.masterKey)c.apikey=c.masterKey;else throw Error("apikey is mandatory");
if(!c.appId||0===c.appId.length)throw Error("appId is mandatory");m.Session.setApiKey(c.apikey);m.Session.environment(c.env||"sandbox");m.useApiKey=!0;m.appId=c.appId;m.Session.persistUserToken=c.persistUserToken;c.debug&&(m.config.debug=!0);m.utils._type.isFunction(c.apiLog)&&(m.logs.apiLog=c.apiLog);m.utils._type.isFunction(c.apiErrorLog)&&(m.logs.apiErrorLog=c.apiErrorLog);m.utils._type.isFunction(c.exceptionLog)&&(m.logs.exceptionLog=c.exceptionLog);if(c.userToken)-1==c.expiry?c.expiry=null:c.expiry||
(c.expiry=845E4),m.Session.setUserAuthHeader(c.userToken,c.expiry),c.user&&m.Users.setCurrentUser(c.user);else if(m.runtime.isBrowser){var h=m.LocalStorage.multiGet("Appacitive-UserToken","Appacitive-UserTokenExpiry","Appacitive-UserTokenDate","Appacitive-User");c=h["Appacitive-UserToken"];var b=h["Appacitive-UserTokenExpiry"],f=h["Appacitive-User"],h=h["Appacitive-User"];if(c){b||(b=-1);if(f&&0<b&&new Date(f+1E3*b)<new Date)return;-1==b&&(b=null);h&&m.Users.setCurrentUser(h,c,b)}}m.Session.initialized=
!0;g.fulfill(m.User.current());return g}})(this);
(function(m){var c=m.Appacitive,g=function(b){var f=c.Promise.buildPromise({success:b.onSuccess,error:b.onError}),l=new XDomainRequest;l.onload=function(){var b=l.responseText,n=l.contentType||"";if("application/json"==n.toLowerCase()||"application/javascript"==n.toLowerCase()||"application/json; charset=utf-8"==n.toLowerCase()||"application/json; charset=utf-8;"==n.toLowerCase())try{n=b,c.runtime.isBrowser||"{"!=n[0]&&(n=n.substr(1,n.length-1)),b=JSON.parse(n)}catch(e){return f.reject(l,new c.Error(c.Error.InvalidJson,
"Error while parsing received json "+b))}f.fulfill(b,this)};l.onerror=l.ontimeout=function(){l.responseData="IE's XDomainRequest does not supply error info.";l.status=c.Error.XDomainRequest;f.reject(l,new c.Error(c.Error.XDomainRequest,l.responseData,"Unknown"))};l.onprogress=function(){};-1===b.url.indexOf("?")?b.url+="?ua=ie":b.url+="&ua=ie";l.open(b.method,b.url,b.sync?!1:!0);l.send(b.data);return f},h=c.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest;
c._Http=function(b){if(!b.url)throw Error("Please specify request url");b.method||(b.method="GET");b.headers||(b.headers=[]);var f={};b.onSuccess&&"function"==typeof b.onSuccess||(b.onSuccess=function(){});b.onError&&"function"==typeof b.onError||(b.onError=function(){});var l=c.Promise.buildPromise({success:b.onSuccess,error:b.onError}),d=!0;b.headers.forEach(function(e){"content-type"==e.key.toLowerCase()&&(d=!0,"application/json"==e.value.toLowerCase()||"application/javascript"==e.value.toLowerCase()||
"application/json; charset=utf-8"==e.value.toLowerCase()||"application/json; charset=utf-8;"==e.value.toLowerCase())&&(d=!1)});if(d)f=b.data;else if(b.data&&(f=b.data,"object"==typeof b.data))try{f=JSON.stringify(f)}catch(n){}var e=b.url.split("/")[2]||"";if(m.navigator&&_type.isObject(m.navigator.userAgent)&&_type.isFunction(m.navigator.userAgent.indexOf)&&-1!=m.navigator.userAgent.indexOf("MSIE 9")&&m.location&&m.location.host&&e!==m.location.host.toLowerCase())return b.data=f,new g(b);var k=new h;
k.onreadystatechange=function(){if(4==k.readyState)if(200<=k.status&&300>k.status||304==k.status){var e=k.responseText,b=k.getResponseHeader("content-type")||k.getResponseHeader("Content-Type")||"";if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase()||"application/json; charset=utf-8"==b.toLowerCase()||"application/json; charset=utf-8;"==b.toLowerCase())try{b=e,c.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),e=JSON.parse(b)}catch(d){return l.reject(k,new c.Error(c.Error.InvalidJson,
"Error while parsing received json "+e))}l.fulfill(e,k)}else l.reject(k,new c.Error(c.Error.ConnectionFailed,k.responseText,"Unknown"))};k.open(b.method,b.url,b.sync?!1:!0);for(e=0;e<b.headers.length;e+=1)k.setRequestHeader(b.headers[e].key,b.headers[e].value);c.runtime.isBrowser||k.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");k.send(f);return l}})(global);
(function(m){var c=m.Appacitive,g=function(b){if(b&&b.send&&"function"==typeof b.send)b.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var l=[],d={},n=0,e={},k=0;this.addProcessor=function(e){e&&(e.pre=e.pre||function(){},e.post=e.post||function(){},p(e.pre),h(e.post))};var p=function(e){n+=1;d[n]=e;return n},h=function(b){k+=1;e[k]=b;return k};this.enqueueRequest=function(e){l.push(e)};this.changeRequestForCors=function(e){var k={m:e.method.toUpperCase()};
e.headers.forEach(function(e){k[e.key]=e.value});e.prevHeaders=e.headers;e.headers=[];e.headers.push({key:"Content-Type",value:"text/plain; charset=utf-8"});e.method="POST";e.data&&(k.b=e.data);delete e.data;c.config.debug&&(-1===e.url.indexOf("?")?e.url+="?debug=true":e.url+="&debug=true");c.config.metadata&&(-1===e.url.indexOf("?")?e.url+="?metadata=true":e.url+="&metadata=true");try{e.data=JSON.stringify(k)}catch(b){}return e};this.notify=function(){if(0!==l.length){var k=[],c;for(c in e)e.hasOwnProperty(c)&&
k.push(e[c]);for(;0<l.length;){var p=l.shift(),n=[];for(c in d)d.hasOwnProperty(c)&&n.push(d[c](p));this.changeRequestForCors(p);b.send(p,k,n)}}};this.onResponse=function(e){console.dir(e)}},h=function(){var b=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=b;this.onResponse=function(c,d){b()};this.onError=function(c){b()}},b=function(){var b=new h;b.isOnline=function(){return!0};var l=function(d,l,e){d.options=d.options||{};new c._Http({method:d.method,url:d.url,headers:d.headers,
data:d.data,sync:d.options.sync,onSuccess:function(k,c){if(k){try{k=JSON.parse(k)}catch(h){}var q=k;if(l.length!=e.length)throw Error("Callback length and state length mismatch!");for(var g=0;g<l.length;g+=1)l[g].apply({},[q,e[g]]);if(200<=k.code&&300>=k.code||k.status&&200<=k.status.code&&300>=k.status.code)b.onResponse(d,k);else k=k||{},k=k.status||k,k.message=k.message||"Bad Request",k.code=k.code||"400",b.onError(d,{responseText:k})}else b.onError(d,{responseText:{code:"400",message:"Invalid request"}})},
onError:function(e,p){var l={};p?l=c.Error.toJSON(p):(l.message=e.responseData||e.responseText||"Bad Request",l.code=e.status||"400");b.onError(d,{responseText:l})}})};b.send=function(b,f,e){if(!c.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof b.beforeSend&&b.beforeSend(b);l(b,f,e)};return b};c.http=new function(){var f=new b,l=new g(f),d=!1;this.pause=function(){d=!0};this.unpause=function(){d=!1};this.addProcessor=function(b){var e=Error('Must provide a processor object with either a "pre" function or a "post" function.');
if(!b)throw e;if(!b.pre&&!b.post)throw e;l.addProcessor(b)};this.send=function(b){b.promise=c.Promise.is(b.promise)?b.promise:new c.Promise.buildPromise({error:b.onError});l.enqueueRequest(b);f.isOnline()&&!1===d&&l.notify();return b.promise};this.flush=function(b){b?l.notify():f.isOnline()&&l.notify()};this.onError=function(b,e){var k=e.responseText;c.logs.logRequest(b,k,k,"error");b.entity&&b.entity._triggerError&&b.entity._triggerError(b.options,new c.Error(k));b.promise.reject(new c.Error(k),
b.entity)};f.onError=this.onError;this.onResponse=function(b,e){if(b.onSuccess)if(b.context)b.onSuccess.apply(b.context,[e]);else b.onSuccess(e);c.logs.logRequest(b,e,e?e.status:null,"successful")};f.onResponse=this.onResponse};c.HttpRequest=function(b){b=b||{};this.url=b.url||"";this.data=b.data||{};this.headers=b.headers||[];this.method=b.method||"GET";this.onSuccess=b.onSuccess||function(){};this.onError=b.onError||function(){};this.send=function(b){return new c._Http(this,b)}};(function(b){var c=
b.Appacitive;c&&c.http&&(c.http.addProcessor({pre:function(b){return b},post:function(b,f){try{var e=c.Session.isSessionValid(b);e.status?b&&(b.status&&b.status.code&&("19036"==b.status.code||"421"==b.status.code)||b.code&&("19036"==b.code||"421"==b.code))?c.Users.logout():c.Session.incrementExpiry():e.isSession&&(null!==c.Session.get()&&c.Session.resetSession(),c.http.send(f))}catch(k){}}}),c.http.addProcessor({pre:function(b){return{start:(new Date).getTime(),request:b}},post:function(b,c){c.request.timeTakenInMilliseconds=
(new Date).getTime()-c.start}}))})(m)})(global);var _type=function(m){if(null===m)return"null";if("undefined"===typeof m||"undefined"===m)return"undefined";if(m&&(1===m.nodeType||9===m.nodeType))return"element";var c=Object.prototype.toString.call(m).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===c){if(isNaN(m))return"nan";if(!isFinite(m))return"infinity"}return c};
(function(m){"bind"in Function.prototype||(Function.prototype.bind=function(b){var d=this;if(1>=arguments.length)return function(){return d.apply(b,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return d.apply(b,0===arguments.length?c:c.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,d){void 0===
d&&(d=0);0>d&&(d+=this.length);0>d&&(d=0);for(var c=this.length;d<c;d++)if(d in this&&this[d]===b)return d;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,d){void 0===d&&(d=this.length-1);0>d&&(d+=this.length);d>this.length-1&&(d=this.length-1);for(d++;0<d--;)if(d in this&&this[d]===b)return d;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,d){for(var c=0,e=this.length;c<e;c++)c in this&&b.call(d,this[c],c,this)});"map"in Array.prototype||
(Array.prototype.map=function(b,d){for(var c=Array(this.length),e=0,k=this.length;e<k;e++)e in this&&(c[e]=b.call(d,this[e],e,this));return c});"filter"in Array.prototype||(Array.prototype.filter=function(b,d){for(var c=[],e,k=0,p=this.length;k<p;k++)k in this&&b.call(d,e=this[k],k,this)&&c.push(e);return c});"every"in Array.prototype||(Array.prototype.every=function(b,d){for(var c=0,e=this.length;c<e;c++)if(c in this&&!b.call(d,this[c],c,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=
function(b,d){for(var c=0,e=this.length;c<e;c++)if(c in this&&b.call(d,this[c],c,this))return!0;return!1});"find"in Array.prototype||(Array.prototype.find=function(b,d){var c=this.length;if(0!==c)for(var e=0,k;e<c&&e in this;e++)if(k=this[e],b.call(d,k,e,this))return k});"where"in Array.prototype||(Array.prototype.where=function(b,d){return 0===this.length?void 0:Object.isEmpty(b)?d?void 0:[]:this[d?"find":"filter"](function(d){for(var e in b)if(b[e]!==d[e])return!1;return!0})},Array.prototype.findWhere=
function(b){return this.where(b,!0)});"each"in Array.prototype||(Array.prototype.each=function(b,d){for(var c=0;c<this.length;c++)b.apply(d,[this[c]])});"difference"in Array.prototype||(Array.prototype.difference=function(b){return this.filter(function(d){return 0>b.indexOf(d)})});"without"in Array.prototype||(Array.prototype.without=function(){return this.difference(Array.prototype.slice.call(arguments,0))});"function"!==typeof Array.prototype.reduce&&(Array.prototype.reduce=function(b){if(null===
this||"undefined"===typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!==typeof b)throw new TypeError(b+" is not a function");var d=Object(this),c=d.length>>>0,e=0,k;if(2<=arguments.length)k=arguments[1];else{for(;e<c&&!e in d;)e++;if(e>=c)throw new TypeError("Reduce of empty array with no initial value");k=d[e++]}for(;e<c;e++)e in d&&(k=b(k,d[e],e,d));return k});var c=function(b,d){return null==b?_.identity:_.isFunction(b)?d?function(){return b.apply(d,
arguments)}:b:function(d){return d[b]}};Array.prototype.pluck=function(b){var d=[];this.each(function(c){d.push(c[b])});return d};Array.prototype.sortBy=function(b,d){b=c(b,d);return this.map(function(c,e){return{value:c,criteria:b.call(d,c,e,this)}},this).sort(function(b,e){var k=b.criteria,d=e.criteria;return k<d?-1:k>d?1:0}).pluck("value")};Array.prototype.removeAll=function(b){for(var d=null,c=0;c<this.length;c++)for(;this[c]===b;)d=this.splice(c,1)[0];return d};Array.prototype.compare=function(b){if(!b||
this.length!=b.length)return!1;for(var d=0,c=this.length;d<c;d++)if(this[d]instanceof Array&&b[d]instanceof Array){if(!this[d].compare(b[d]))return!1}else if(this[d]!=b[d])return!1;return!0};Array.prototype.equals=function(b,d){if(!b)return!1;1==arguments.length&&(d=!1);if(this.length!=b.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&b[c]instanceof Array){if(!this[c].equals(b[c],d))return!1}else{if(d&&!_type.isEqual(this[c],b[c]))return!1;if(!d)return this.sort().equals(b.sort(),
!0)}return!0};Date.prototype.toISOString||function(){function b(c){c=String(c);1===c.length&&(c="0"+c);return c}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();String.addSlashes=function(b){if(!b)return b;b=b.replace(/\\/g,"\\\\");b=b.replace(/\'/g,"\\'");b=b.replace(/\"/g,
'\\"');return b=b.replace(/\0/g,"\\0")};String.stripSlashes=function(b){if(!b)return b;b=b.replace(/\\'/g,"'");b=b.replace(/\\"/g,'"');b=b.replace(/\\0/g,"\x00");return b=b.replace(/\\\\/g,"\\")};if("undefined"===typeof console||null===console)console={log:function(){},dir:function(){}};for(var g="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),h=function(b){_type["is"+b]=function(c){return _type(c)===b.toLowerCase()}},b=0;b<g.length;b++)h(g[b]);
_type.isNullOrUndefined=function(b){return"null"==_type(b)||"undefined"==_type(b)};_type.isNumeric=function(b){return!isNaN(parseFloat(b))&&isFinite(b)};_type.isDate=function(b){return b instanceof Date};var f=function(b,c,h,e){var k=Object.prototype.toString;if(b===c)return 0!==b||1/b==1/c;if(null==b||null==c)return b===c;var p=k.call(b);if(p!=k.call(c))return!1;switch(p){case "[object String]":return b==String(c);case "[object Number]":return b!=+b?c!=+c:0==b?1/b==1/c:b==+c;case "[object Date]":case "[object Boolean]":return+b==
+c}if("object"!=typeof b||"object"!=typeof c)return!1;if(b instanceof m.Appacitive.GeoCoord&&c instanceof m.Appacitive.GeoCoord)return b.toString()==c.toString();for(k=h.length;k--;)if(h[k]==b)return e[k]==c;var k=b.constructor,g=c.constructor;if(k!==g&&!(_types.isFunction(k)&&k instanceof k&&_types.isFunction(g)&&g instanceof g)&&"constructor"in b&&"constructor"in c)return!1;h.push(b);e.push(c);k=0;g=!0;if("[object Array]"==p){if(k=b.length,g=k==c.length)for(;k--&&(g=f(b[k],c[k],h,e)););}else{for(var q in b)if(Object.prototype.hasOwnProperty.call(b,
q)&&(k++,!(g=Object.prototype.hasOwnProperty.call(c,q)&&f(b[q],c[q],h,e))))break;if(g){for(q in c)if(Object.prototype.hasOwnProperty.call(c,q)&&!k--)break;g=!k}}h.pop();e.pop();return g};_type.isEqual=function(b,c){return f(b,c,[],[])};m.Appacitive.utils=m.Appacitive.utils||{};m.Appacitive.utils._type=_type})(global);
(function(m){var c=Array.prototype,g=Object.prototype,h=m.Appacitive;h.utils._each=function(b,h,d){if(null!=b)if(c.forEach&&b.forEach===c.forEach)b.forEach(h,d);else if(b.length===+b.length)for(var n=0,e=b.length;n<e&&h.call(d,b[n],n,b)!=={};n++);else for(n in b)if(g.hasOwnProperty.call(b,n)&&h.call(d,b[n],n,b)==={})break};h.utils._extend=function(b){h.utils._each(c.slice.call(arguments,1),function(c){if(c)for(var d in c)b[d]=c[d]});return b};h.utils._reject=function(b,c){return b.filter(function(b){return!c(b)})};
h.utils._deepExtend=function(b){h.utils._each(Array.prototype.slice.call(arguments,1),function(c){for(var d in c)h.utils._type.isArray(c[d])?(h.utils._type.isArray(b[d])||(b[d]=[]),b[d]=h.utils._reject(h.utils._extend(b[d],c[d]),function(b){return h.utils._type.isNull(b)})):!h.utils._type.isObject(c[d])||c[d]instanceof h.Object||c[d]instanceof h.Connection||c[d]instanceof h.GeoCoord?b[d]=c[d]:(h.utils._type.isObject(b[d])||(b[d]={}),b[d]=h.utils._extend(b[d],c[d]))});return b};var b=function(b,c){var d=
this,g;g=h.utils._type.isObject(b)&&b.hasOwnProperty("constructor")?b.constructor:function(){return d.apply(this,arguments)};h.utils._extend(g,d,c);var e=function(){this.constructor=g};e.prototype=d.prototype;g.prototype=new e;b&&h.utils._extend(g.prototype,b);g.__super__=d.prototype;return g};h.utils.classExtend=function(c,h,d){return b.apply(c,[h,d])};h.utils._result=function(b,c,d){c=null==b?void 0:b[c];void 0===c&&(c=d);return h.utils._type.isFunction(c)?c.call(b):c};h.clone=h.utils._clone=function(b){return h.utils._type.isObject(b)?
h.utils._type.isArray(b)?b.slice():h.utils._extend({},b):b}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type;c.logs={};var h=function(b,c){setTimeout(function(){try{b.call({},c)}catch(h){}},0)};c.logs.logRequest=function(b,f,l,d){f=f||{};l=l||{};var n={};try{n=JSON.parse(b.data),g.isObject(n)||(n={})}catch(e){}var k={status:d,referenceId:l.referenceid,date:(new Date).toISOString(),method:n.m,url:decodeURIComponent(b.url),responseTime:b.timeTakenInMilliseconds,headers:{},request:null,response:f,description:b.description};b.headers&&b.headers.forEach(function(b){k.headers[b.key]=
b.value});b.prevHeaders&&b.prevHeaders.forEach(function(b){k.headers[b.key]=b.value});"GET"!==k.method&&(k.request=n.b);"error"==d&&(c.runtime.isBrowser&&console.dir(k),g.isFunction(c.logs.apiErrorLog)&&h(c.logs.apiErrorLog,k));g.isFunction(c.logs.apiLog)&&h(c.logs.apiLog,k)};c.logs.logException=function(b){g.isFunction(c.logs.exceptionLog)&&h(c.logs.exceptionLog,b)}})(global);
(function(m){var c=m.Appacitive;String.format=function(c,h){if(1>=arguments.length)return c;for(var b=arguments.length-2,f=0;f<=b;f++)c=c.replace(new RegExp("\\{"+f+"\\}","gi"),arguments[f+1]);return c};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(c){var h=new RegExp("^"+c),b=this;h.test(b)&&(b=b.slice(1,b.length));h=new RegExp(c+"$");h.test(b)&&(b=b.slice(0,-1));return b};String.toSearchString=function(c){"undefined"===
typeof c&&(c="");for(var h="",b=0;b<c.length;b+=1)-1===" .,;#".indexOf(c[b])&&(h+=c[b]);return h=h.toLowerCase()};String.contains=function(c,h){return-1!==c.indexOf(h)};String.startsWith=function(c,h){return 0===c.indexOf(h)};Array.distinct=function(c){var h=[],b=c.length,f,l,d;for(l=0;l<b;l++){f=void 0;for(d=0;d<h.length;d++)if(c[l].toLowerCase()===h[d].toLowerCase()){f=!0;break}f||h.push(c[l])}return h};Object.isEmpty=function(c){if(!c)return!0;var h=!0,b;for(b in c){h=!1;break}return h};m.dateFromWcf=
function(c,h){var b=/Date\(([^)]+)\)/.exec(c);if(2!=b.length){if(!h)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(b[1]))};c.storage=c.storage||{};c.storage.urlFactory=new function(){c.bag=c.bag||{};var g=function(c){"object"===typeof c&&0<c.length&&("string"===typeof c[0]||"number"===typeof c[0])&&(c=c.join(","));c||(c="");return c};this.application={applicationServiceUrl:"application",getSessionCreateUrl:function(){return String.format("{0}/session",this.applicationServiceUrl)}};
this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(c,b){return String.format("{0}/create?fields={1}",this.userServiceUrl,g(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(c,b,f){return String.format("{0}/{1}?fields={2}",c,b,g(f))},getUserByTokenUrl:function(c){return String.format("{0}/me?useridtype=token&token={1}",
this.userServiceUrl,c)},getUserByUsernameUrl:function(c){return String.format("{0}/{1}?useridtype=username",this.userServiceUrl,c)},getUpdateUrl:function(c,b,f){return f?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,c,g(b),f):String.format("{0}/{1}?fields={2}",this.userServiceUrl,c,g(b))},getDeleteUrl:function(c,b,f){return!0===f?String.format("{0}/{1}?deleteconnections=true",this.userServiceUrl,b):String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(c){return String.format("{0}/{1}/linkedaccounts",
this.userServiceUrl,c)},getValidateTokenUrl:function(c){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,c)},getInvalidateTokenUrl:function(c){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,c)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(c){return String.format("{0}/{1}/changepassword",this.userServiceUrl,c)},getLinkAccountUrl:function(c){return String.format("{0}/{1}/link",
this.userServiceUrl,c)},getDelinkAccountUrl:function(c,b){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,c,b)},getCheckinUrl:function(c,b,f){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,c,b,f)},getResetPasswordUrl:function(c){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,c)},getValidateResetPasswordUrl:function(c){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,c)}};this.device={deviceServiceUrl:"device",
getCreateUrl:function(c,b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,g(b))},getGetUrl:function(c,b,f){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,g(f))},getUpdateUrl:function(c,b,f){return f?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,c,g(b),f):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,c,g(b))},getDeleteUrl:function(c,b,f){return!0===f?String.format("{0}/{1}?deleteconnections=true",this.deviceServiceUrl,b):String.format("{0}/{1}",
this.deviceServiceUrl,b)}};this.object={objectServiceUrl:"object",getSearchAllUrl:function(c,b,f){var g="",g=String.format("{0}/search/{1}/all",this.objectServiceUrl,c),g=f?g+"?psize="+f:g+"?psize=10";if("undefined"!==typeof b&&0<b.length)for(c=0;c<b.length;c+=1)0!==b[c].trim().length&&(g=g+"&"+b[c]);return g},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.objectServiceUrl)},getPropertiesSearchUrl:function(c,b){return String.format("{0}/search/{1}/all?properties={2}",
this.objectServiceUrl,c,b)},getMultiGetUrl:function(c,b,f){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.objectServiceUrl,c,b,g(f))},getCreateUrl:function(c,b){return String.format("{0}/{1}?fields={2}",this.objectServiceUrl,c,g(b))},getGetUrl:function(c,b,f){return String.format("{0}/{1}/{2}?fields={3}",this.objectServiceUrl,c,b,g(f))},getUpdateUrl:function(c,b,f,l){return l?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.objectServiceUrl,c,b,g(f),l):String.format("{0}/{1}/{2}?fields={3}",
this.objectServiceUrl,c,b,g(f))},getDeleteUrl:function(c,b,f){return!0===f?String.format("{0}/{1}/{2}?deleteconnections=true",this.objectServiceUrl,c,b):String.format("{0}/{1}/{2}",this.objectServiceUrl,c,b)},getMultiDeleteUrl:function(c){return String.format("{0}/{1}/bulkdelete",this.objectServiceUrl,c)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(c,b,f){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,c,b,g(f))},getMultiGetUrl:function(c,b,f){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.connectionServiceUrl,c,b,g(f))},getCreateUrl:function(c,b){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,c,g(b))},getUpdateUrl:function(c,b,f,l){return l?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,c,b,g(f),l):String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,c,b,g(f))},getDeleteUrl:function(c,b){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,c,b)},getMultiDeleteUrl:function(c){return String.format("{0}/{1}/bulkdelete",
this.connectionServiceUrl,c)},getSearchByArticleUrl:function(c,b,f,g){var d="",d=String.format("{0}/{1}/find/all?label={2}&objectid={3}",this.connectionServiceUrl,c,f,b);if("undefined"!==typeof g&&0<g.length)for(c=0;c<g.length;c+=1)d=d+"&"+g[c];return d},getConnectedArticles:function(c,b,f){var g="",g=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,c,b);if(f&&f.length&&0<f.length)for(c=0;c<f.length;c+=1)g=0===c?g+("?"+f[c]):g+("&"+f[c]);return g},getInterconnectsUrl:function(){return String.format("{0}/interconnects",
this.connectionServiceUrl)},getPropertiesSearchUrl:function(c,b){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,c,b)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(c){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,c)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(c){return String.format("{0}/notification/{1}",this.pushServiceUrl,
c)},getGetAllNotificationsUrl:function(c){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,c.psize,c.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(c,b){return b&&0<b.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",this.fileServiceUrl,escape(c),escape(b)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(c))},getUpdateUrl:function(c,b){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,c,escape(b))},getDownloadUrl:function(c,b){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,c,b)},getDeleteUrl:function(c){return String.format("{0}/delete/{1}",this.fileServiceUrl,c)}};this.query={params:function(c){var b=[];return""===location.search||-1===location.search.indexOf("?")?b:c?(c=c.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(f,g){var d=g.split("="),n=d[1];2<d.length&&d.forEach(function(b,c){0!==b&&1!==b&&(n=n+"="+
d[b])});d[0].toLowerCase()===c&&(b=[d[0],n])}),b):location.search.split("?")[1].split("=")}};this.usergroup={usergroupServiceUrl:"usergroup",getUpdateUrl:function(c){return String.format("{0}/{1}/members",this.usergroupServiceUrl,c)}};this.ping={pingServiceUrl:"ping",getPingUrl:function(){return String.format("{0}/",this.pingServiceUrl)}};this.multi={multiServiceUrl:"multi",getBatchUrl:function(){return String.format("{0}/",this.multiServiceUrl)}}}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h;h=c.runtime.isNode?process.nextTick:setTimeout;var b=function(){if(!(this instanceof b))return new b;this.calls=[]};b.prototype.isResolved=function(){return 1===this.state?!0:!1};b.prototype.isRejected=function(){return 2===this.state?!0:!1};b.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};b.prototype.done=function(){var f,g,d=this.state,h=this.value;if(!d)return this;for(;f=this.calls.shift();)if(g=f[0],"function"===
typeof f[d]){try{h=2===d?f[d].call(g,this.value):f[d].apply(g,this.value)}catch(e){c.logs.logException({name:e.name,message:e.message,stack:e.stack});if(0==g.calls.length)throw e;g.reject(e)}h instanceof b||h&&"function"===typeof h.then?h.then(function(b){g.fulfill(b)},function(b){g.reject(b)}):1===d?g.fulfill(h):g.reject(h)}else 1===d?g.fulfill(h):g.reject(h)};b.prototype.fulfill=function(b){if(this.state)return this;this.state=1;this.reason=this.value=[].slice.call(arguments);this.done();return this};
b.prototype.resolve=b.prototype.fulfill;b.prototype.reject=function(b){if(this.state)return this;this.state=2;this.reason=this.value=b;this.done();return this};b.prototype.then=function(c,g){var d=this,n=new b;this.calls[this.calls.length]=[n,c,g];this.state&&h(function(){d.done()});return n};b.when=function(c){var l=[],d=[],n,e=0,k=new b;if(!c||g.isArray(c)&&0==c.length)return k.fulfill(l),k;var p=function(){e+=1;e==n&&(k.state||(0<d.length?k.reject(d,l?l:[]):k.fulfill(l?l:[])))},t=function(e){var k=
c[e];k instanceof b||k&&"function"===typeof k.then?h(function(){k.then(function(b){l[e]=b;p()},function(b){d[e]=b;p()})}):h(function(){try{l[e]=k.call()}catch(b){d[e]=b}p()})};g.isArray(c)||(c=[c]);n=c.length;for(var q=0;q<n;q+=1)t(q);return k};b.is=function(c){return c instanceof b?!0:!1};b.buildPromise=function(c){var h=new b;g.isObject(c)&&h.then(c.success,c.error);return h};b._continueUntil=function(c,h){return g.isFunction(c)&&c()?h().then(function(){return b._continueUntil(c,h)}):(new b).fulfill()};
c.Promise=b})(global);
(function(m){m.Appacitive.eventManager=new function(){function c(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var g={};this.subscribe=function(h,b){if("string"!=typeof h||"function"!=typeof b)throw Error("Incorrect subscription call");"undefined"==typeof g[h]&&(g[h]=[]);var f=c();g[h].push({callback:b,id:f});return f};this.unsubscribe=function(c){if(!c)return!1;var b=-1,f=null,l;for(l in g)for(var d=0;d<g[l].length;d+=
1)if(g[l][d].id==c){b=d;f=l;break}return-1!=b?(g[f].splice(b,1),!0):!1};this.fire=function(c,b,f){if("string"!=typeof c)throw Error("Incorrect fire call");if("undefined"==typeof f||null===f)f={};f.eventName=c;if("undefined"!=typeof g.all)for(var l=0;l<g.all.length;l+=1)g.all[l].callback(b,f);l=function(b,e,c){setTimeout(function(){b(e,c)},0)};if("undefined"!=typeof g[c])for(var d=0;d<g[c].length;d+=1)l(g[c][d].callback,b,f)};this.clearSubscriptions=function(c){if("string"!=typeof c)throw Error("Event Name must be string in EventManager.clearSubscriptions");
g[c]&&(g[c].length=0);return this};this.clearAndSubscribe=function(c,b){this.clearSubscriptions(c);this.subscribe(c,b)};this.dump=function(){console.dir(g)}}})(global);
(function(m){var c={},g=Array.prototype.forEach,h=Object.prototype.hasOwnProperty,b=Array.prototype.slice,f=0,l=function(){return{keys:Object.keys,uniqueId:function(b){var e=++f+"";return b?b+e:e},has:function(b,e){return h.call(b,e)},each:function(b,e,k){if(null!=b)if(g&&b.forEach===g)b.forEach(e,k);else if(b.length===+b.length)for(var d=0,f=b.length;d<f&&e.call(k,b[d],d,b)!==c;d++);else for(d in b)if(this.has(b,d)&&e.call(k,b[d],d,b)===c)break},once:function(b){var e=!1,c;return function(){if(e)return c;
e=!0;c=b.apply(this,arguments);b=null;return c}}}}(),d;d={on:function(b,c,k){if(!e(this,"on",b,[c,k])||!c)return this;this._events||(this._events={});(this._events[b]||(this._events[b]=[])).push({callback:c,context:k,ctx:k||this});return this},once:function(b,c,k){if(!e(this,"once",b,[c,k])||!c)return this;var d=this,g=l.once(function(){d.off(b,g);c.apply(this,arguments)});g._callback=c;return this.on(b,g,k)},off:function(b,c,k){var d,g,f,h,n,m,v,w;if(!this._events||!e(this,"off",b,[c,k]))return this;
if(!b&&!c&&!k)return this._events={},this;h=b?[b]:l.keys(this._events);n=0;for(m=h.length;n<m;n++)if(b=h[n],f=this._events[b]){this._events[b]=d=[];if(c||k)for(v=0,w=f.length;v<w;v++)g=f[v],(c&&c!==g.callback&&c!==g.callback._callback||k&&k!==g.context)&&d.push(g);d.length||delete this._events[b]}return this},trigger:function(c){if(!this._events)return this;var d=b.call(arguments,1);if(!e(this,"trigger",c,d))return this;var g=this._events[c],f=this._events.all;g&&k(g,d);f&&k(f,arguments);return this},
stopListening:function(b,c,e){var k=this._listeners;if(!k)return this;var d=!c&&!e;"object"===typeof c&&(e=this);b&&((k={})[b._listenerId]=b);for(var g in k)k[g].off(c,e,this),d&&delete this._listeners[g];return this}};var n=/\s+/,e=function(b,c,e,k){if(!e)return!0;if("object"===typeof e){for(var d in e)b[c].apply(b,[d,e[d]].concat(k));return!1}if(n.test(e)){e=e.split(n);d=0;for(var g=e.length;d<g;d++)b[c].apply(b,[e[d]].concat(k));return!1}return!0},k=function(b,e){var c,k=-1,d=b.length,g=e[0],f=
e[1],h=e[2];switch(e.length){case 0:for(;++k<d;)(c=b[k]).callback.call(c.ctx);break;case 1:for(;++k<d;)(c=b[k]).callback.call(c.ctx,g);break;case 2:for(;++k<d;)(c=b[k]).callback.call(c.ctx,g,f);break;case 3:for(;++k<d;)(c=b[k]).callback.call(c.ctx,g,f,h);break;default:for(;++k<d;)(c=b[k]).callback.apply(c.ctx,e)}};l.each({listenTo:"on",listenToOnce:"once"},function(b,e){d[e]=function(e,c,k){var d=this._listeners||(this._listeners={}),g=e._listenerId||(e._listenerId=l.uniqueId("l"));d[g]=e;"object"===
typeof c&&(k=this);e[b](c,k,this);return this}});d.bind=d.on;d.unbind=d.off;d.mixin=function(b){l.each("on once off trigger stopListening listenTo listenToOnce bind unbind".split(" "),function(e){b[e]=this[e]},this);return b};m.Appacitive.Events=d})(global);
(function(m){m.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/v1.0/",metadata:!0};m.navigator&&_type.isObject(m.navigator.userAgent)&&_type.isFunction(m.navigator.userAgent.indexOf)&&(-1!=m.navigator.userAgent.indexOf("MSIE 8")||-1!=m.navigator.userAgent.indexOf("MSIE 9"))&&(m.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/v1.0/")})(global);
(function(m){var c=m.Appacitive,g=c.utils._type;m=function(h){var b;if(!h||!g.isObject(h))throw Error("Please specify request options");this.promise=c.Promise.buildPromise(h.options);var f=this.request=new c.HttpRequest;b=c.storage.urlFactory[h.type];var l=h.op.replace("get","").replace("Url","")+" "+h.type;b=c.config.apiBaseUrl+b[h.op].apply(b,h.args||[]);f.url=b;f.description=l;f.method=h.method||"get";f.data=h.data||{};f.onSuccess=h.onSuccess;f.onError=h.onError;f.promise=this.promise;f.options=
h.options;h.entity&&(f.entity=h.entity);return this};m.prototype.send=function(){return c.http.send(this.request)};c._Request=m})(global);
(function(m){m=m.Appacitive;var c=m.utils._type,g=m.utils._extend;m.Error=function(g,b,f,l){if(c.isString(g)||c.isNumber(g))g={code:g,message:b,referenceId:f,additionalMessages:l};this.code=g.code||"400";this.message=g.message||"Unknown Error";g.referenceId&&(this.referenceId=g.referenceid||g.referenceId);g.additionalmessages&&(this.additionalMessages=g.additionalmessages||additionalMessages)};m.Error.toJSON=function(c){return{code:c.code,message:c.message,referenceId:c.referenceId,additionalmessages:c.additionalMessages}};
g(m.Error,{BadRequest:"400",AccessControl:"401",PaymentRequired:"402",UsageLimitReached:"403",NotFound:"404",Duplicate:"435",MvccFailure:"409",PreconditionFailed:"412",ApiAuthenticationError:"420",IdentityFailures:"421",IncorrectConfiguration:"436",InternalServerError:"500",DataAccessFailure:"512",UnknownCause:100,InvalidParameters:"400",ConnectionFailed:1001,MissingId:"404",InvalidJson:1007,DuplicateUsername:"435",DuplicateValue:"435",XDomainRequest:5E3})})(global);
(function(m){var c=m.Appacitive,g=c.utils._type;c.Session=new function(){this.initialized=!1;var h=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},b=null,f=null,l=null,d=!1,n;this.useApiKey=!0;this.useMasterKey=!1;this.onSessionCreated=function(){};this.recreate=function(b){return c.Session.create(b)};this.create=function(e){if(!this.initialized)throw Error("Initialize Appacitive SDK");var d=new h;d.apikey=f;var g=new c._Request({method:"PUT",type:"application",
op:"getSessionCreateUrl",options:e,data:d,onSuccess:function(e){b=e.session.sessionkey;c.Session.useApiKey=!1;g.promise.fulfill(e);c.Session.onSessionCreated()}});return g.send()};c.http.addProcessor({pre:function(e){e.options=e.options||{};if(c.Session.useApiKey){var p=f;(e.options.useMasterKey||c.useMasterKey&&!e.options.useMasterKey)&&g.isString(n)&&0<n.length?p=n:g.isString(e.options.apikey)&&(p=e.options.apikey);e.headers.push({key:"ak",value:p})}else e.headers.push({key:"as",value:b});p=g.isString(e.options.userToken)&&
0<e.options.userToken.length?e.options.userToken:!1;if(!0===d||p){var t=-1,q=e.headers.filter(function(b,e){return"ut"==b.key?(t=e,!0):!1});if(e.options.ignoreUserToken)-1!=t&&e.headers.splice(t,1);else{var r=p||l;1==q.length?e.headers.forEach(function(b){"ut"==b.key&&(b.value=r)}):e.headers.push({key:"ut",value:r})}}}});this.setUserAuthHeader=function(b,e,g){try{b&&(d=!0,l=b,g||(e||(e=-1),-1==e&&(e=null),c.LocalStorage.set("Appacitive-UserToken",b),c.LocalStorage.set("Appacitive-UserTokenExpiry",
e),c.LocalStorage.set("Appacitive-UserTokenDate",(new Date).getTime())))}catch(f){}};this.incrementExpiry=function(){try{c.runtime.isBrowser&&d&&c.LocalStorage.set("Appacitive-UserTokenDate",(new Date).getTime())}catch(b){}};this.removeUserAuthHeader=function(b,e){var g=c.Promise.buildPromise(e);b||c.User.trigger("logout",{});c.LocalStorage.remove("Appacitive-User");if(l&&b)try{var f=new c.HttpRequest(e);f.url=c.config.apiBaseUrl+c.storage.urlFactory.user.getInvalidateTokenUrl(l);f.method="POST";
f.data={};f.type="user";f.options=e;f.description="InvalidateToken user";f.onSuccess=f.onError=function(){d=!1;l=null;c.User.trigger("logout",{});c.LocalStorage.remove("Appacitive-UserToken");c.LocalStorage.remove("Appacitive-UserTokenExpiry");c.LocalStorage.remove("Appacitive-UserTokenDate");g.fulfill()};c.http.send(f);return g}catch(r){}else return d=!1,l=null,c.LocalStorage.remove("Appacitive-UserToken"),c.LocalStorage.remove("Appacitive-UserTokenExpiry"),c.LocalStorage.remove("Appacitive-UserTokenDate"),
g.fulfill()};this.isSessionValid=function(b){if(b.status){if(b.status.code&&("420"==b.status.code||"19027"==b.status.code||"19002"==b.status.code))return{status:!1,isSession:"19027"==b.status.code||"420"==b.status.code?!0:!1}}else if(b.code&&("420"==b.code||"19027"==b.code||"19002"==b.code))return{status:!1,isSession:"19027"==b.code||"420"==b.code?!0:!1};return{status:!0}};this.resetSession=function(){b=null;this.useApiKey=!0};this.get=function(){return b};this.setSession=function(e){e&&(b=e,this.useApiKey=
!1)};this.setApiKey=function(b){b&&(f=b,this.useApiKey=!0)};this.setMasterKey=function(b){n=b};this.reset=function(){this.removeUserAuthHeader();l=f=b=null;d=!1;n=null;this.useMasterKey=this.useApiKey=this.initialized=!1};var e="sandbox";this.environment=function(){if(1==arguments.length){var b=arguments[0];"sandbox"!=b&&"live"!=b&&(b="sandbox");e=b}return e}};c.getAppPrefix=function(g){return c.Session.environment()+"/"+c.appId+"/"+g};c.ping=function(g){if(!c.Session.initialized)throw Error("Initialize Appacitive SDK");
var b=new c._Request({method:"GET",type:"ping",op:"getPingUrl",options:g,onSuccess:function(c){return b.promise.fulfill(c.status)}});return b.send()};c.reset=function(){c.Session.reset()}})(global);(function(m){var c=m.Appacitive;c&&c.http&&(c.http.addProcessor({pre:function(g){var h=c.Session.environment();g.options=g.options||{};_type.isString(g.options.env)&&(h=g.options.env);g.headers.push({key:"e",value:h})}}),c.Events.mixin(c))})(global);
(function(m){var c=m.Appacitive,g=c.utils._type;c.GeoCoord=function(b,e){var k=function(b,e){if(isNaN(b)||isNaN(e))throw Error("Invalid Latitiude or longitiude provided");if(-90>b||90<b)throw Error("Latitude "+b+" should be in range of  -90.0 to 90.");if(-180>e||180<e)throw Error("Latitude "+e+" should be in range of  -180.0 to 180.");},d=function(b){if("string"!==typeof b||0==b.length)return!1;b=b.split(",");if(2!==b.length)return!1;try{return new c.GeoCoord(b[0],b[1])}catch(e){return!1}};if(g.isString(b)&&
!e&&(d=d(b)))return d;b&&e?(k(b,e),this.lat=b,this.lng=e):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",b,e)};this.toString=function(){return this.getValue()}};var h=function(){this.toString=function(){};this.Or=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new t(q.or,b)};this.And=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new t(q.and,
b)}},b=function(b){h.call(this);b=b||{};this.fieldType=b.fieldType;this.field=b.field||"";this.value=b.value;this.operator=b.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue())}};b.prototype=new h;b.prototype.constructor=b;var f=function(e){e=e||"";
if(!g.isArray(e.value)||!e.value.length)throw Error("Specify field value as array");b.call(this,e);var k=function(b){return g.isString(b)?"'"+b+"'":g.isNumber(b)?b:g.isDate(b)?"datetime('"+c.Date.toISOString(b)+"')":"'"+b.toString()+"'"};this.toString=function(){for(var b=[],e=0;e<this.value.length;e+=1)b.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,k(this.value[e])));return"("+b.join(" or ")+")"}};f.prototype=new b;f.prototype.constructor=f;var l=
function(e){e=e||"";if(!g.isArray(e.value)||!e.value.length)throw Error("Specify field value as array");b.call(this,e);var c=function(b){return g.isString(b)?"'"+b+"'":g.isNumber(b)?b:b.toString()};this.toString=function(){for(var b=[],e=0;e<this.value.length;e+=1)b.push(c(this.value[e]));return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b.join(","))}};l.prototype=new b;l.prototype.constructor=l;var d=function(e){b.call(this,e||"");this.toString=function(){return String.format("{0}{1} {2}",
this.getFieldType(),this.field.toLowerCase(),this.operator)}};d.prototype=new b;d.prototype.constructor=d;var n=function(e){e=e||"";if(!e.val1)throw Error("Specify field value1 ");if(!e.val2)throw Error("Specify field value2 ");this.val1=e.val1;this.val2=e.val2;b.call(this,e);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};n.prototype=new b;n.prototype.constructor=
n;var e=function(e){e=e||"";if(!(e.geoCoord&&e.geoCoord instanceof c.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");b.call(this,e);this.value=e.geoCoord;this.unit=e.unit||"mi";this.distance=e.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};e.prototype=new b;e.prototype.constructor=n;var k=function(e){e=e||"";if(!e.geoCoords||
0===e.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");if(3>e.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");b.call(this,e);this.value=e.geoCoords;var c=function(b){var e="";b.forEach(function(b){e=0===e.length?b.toString():e+(" | "+b.toString())});return e};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,c(this.value))}};
k.prototype=new b;k.prototype.constructor=n;var p=function(b){h.call(this);b=b||{};if(!b.tags||!g.isArray(b.tags)||0===b.tags.length)throw Error("Specify valid tags");this.tags=b.tags;this.operator=b.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};p.prototype=new h;p.prototype.constructor=p;var t=function(b,e){if(!e||!e.length||2>e.length)throw Error("Provide valid or atleast 2 filters");this.operator=b;this.innerFilters=[];for(var c=0;c<e.length;c+=
1){if(!(e[c]instanceof h))throw Error("Invalid filter provided");this.innerFilters.push(e[c])}this.toString=function(){var b=this.operator,e="(";this.innerFilters.forEach(function(c){e=1===e.length?e+(" "+c.toString()):e+String.format(" {0} {1} ",b,c.toString())});return e+=")"}};t.prototype=new h;t.prototype.constructor=t;var q={isEqualTo:"==",notEqualTo:"<>",isGreaterThan:">",isGreaterThanEqualTo:">=",isLessThan:"<",isLessThanEqualTo:"<=",like:"like",match:"match",between:"between",withinCircle:"within_circle",
withinPolygon:"within_polygon",or:"or",and:"and",taggedWithAll:"tagged_with_all",taggedWithOneOrMore:"tagged_with_one_or_more",isNull:"is null",containedIn:"in",isNotNull:"is not null",notIn:"not in"},r=function(b,e){if(null===b||void 0===b||0===b.length)throw Error("Specify value");this.value=b;this.type=e?e:typeof this.value;if("number"===this.type&&!g.isNumeric(this.value))throw Error("Value should be numeric for filter expression");this.getValue=function(){return"number"===this.type||g.isBoolean(this.value)||
g.isNumber(this.value)?this.value:"object"===this.type&&g.isDate(this.value)?"datetime('"+c.Date.toISOString(this.value)+"')":"object"==this.type&&this.value instanceof c.GeoCoord?this.value.toString():"'"+this.value.toString()+"'"}},u=function(c,g,p){p||(p=this);p.type=c;p.name=g;p.equalTo=function(e){return new b({field:this.name,fieldType:this.type,value:new r(e),operator:q.isEqualTo})};p.notEqualTo=function(e){return new b({field:this.name,fieldType:this.type,value:new r(e),operator:q.notEqualTo})};
p.greaterThan=function(e){return new b({field:this.name,fieldType:this.type,value:new r(e),operator:q.isGreaterThan})};p.greaterThanEqualTo=function(e){return new b({field:this.name,fieldType:this.type,value:new r(e),operator:q.isGreaterThanEqualTo})};p.lessThan=function(e){return new b({field:this.name,fieldType:this.type,value:new r(e),operator:q.isLessThan})};p.lessThanEqualTo=function(e){return new b({field:this.name,fieldType:this.type,value:new r(e),operator:q.isLessThanEqualTo})};p.like=function(e){return new b({field:this.name,
fieldType:this.type,value:new r("*"+e+"*"),operator:q.like})};p.match=function(e){return new b({field:this.name,fieldType:this.type,value:new r("*"+e+"*"),operator:q.match})};p.startsWith=function(e){return new b({field:this.name,fieldType:this.type,value:new r(e+"*"),operator:q.like})};p.endsWith=function(e){return new b({field:this.name,fieldType:this.type,value:new r("*"+e),operator:q.like})};p.contains=function(b){return new f({field:this.name,fieldType:this.type,value:b,operator:q.isEqualTo})};
p.containedIn=function(b){return new l({field:this.name,fieldType:this.type,value:b,operator:q.containedIn})};p.isNull=function(){return new d({field:this.name,fieldType:this.type,operator:q.isNull})};p.notIn=function(b){return new l({field:this.name,fieldType:this.type,value:b,operator:q.notIn})};p.isNotNull=function(){return new d({field:this.name,fieldType:this.type,operator:q.isNotNull})};p.between=function(b,e){return new n({field:this.name,fieldType:this.type,val1:new r(b),val2:new r(e),operator:q.between})};
p.withinCircle=function(b,c,k){return new e({field:this.name,fieldType:this.type,geoCoord:b,distance:c,unit:k,operator:q.withinCircle})};p.withinPolygon=function(b){return new k({field:this.name,fieldType:this.type,geoCoords:b,operator:q.withinPolygon})}},x=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;u("property",b,this);return this},y=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;var e=new u("aggregate",b);this.equalTo=function(b){return e.equalTo(b)};
this.notEqualTo=function(b){return e.notEqualTo(b)};this.greaterThan=function(b){return e.greaterThan(b)};this.greaterThanEqualTo=function(b){return e.greaterThanEqualTo(b)};this.lessThan=function(b){return e.lessThan(b)};this.lessThanEqualTo=function(b){return e.lessThanEqualTo(b)};this.between=function(b,c){return e.between(b,c)};this.contains=function(b){return e.contains(b)};return this},z=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;var e=new u("attribute",b);
this.like=function(b){return e.like(b)};this.match=function(b){return e.match(b)};this.startsWith=function(b){return e.startsWith(b)};this.endsWith=function(b){return e.endsWith(b)};this.equalTo=function(b){return e.equalTo(b)};this.notEqualTo=function(b){return e.notEqualTo(b)};this.contains=function(b){return e.contains(b)};this.containedIn=function(b){return e.containedIn(b)};this.notIn=function(b){return e.notIn(b)};this.isNull=function(){return e.isNull()};this.isNotNull=function(){return e.isNull()};
return this};c.Filter={Property:function(b){return new x(b)},Aggregate:function(b){return new y(b)},Attribute:function(b){return new z(b)},Or:function(){return new t(q.or,arguments)},And:function(){return new t(q.and,arguments)},taggedWithOneOrMore:function(b){return new p({tags:b,operator:q.taggedWithOneOrMore})},taggedWithAll:function(b){return new p({tags:b,operator:q.taggedWithAll})}}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.utils._extend;c.Queries={};var b=function(b){b=b||{};this._pageNumber=1;this._pageSize=null;this.isPageDefault=!0;this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};b.prototype.pageNumber=function(){return 1!=arguments.length||g.isNullOrUndefined(arguments[0])?this._pageNumber:(this._pageNumber=arguments[0]||1,this.isPageDefault=!1,this)};b.prototype.pageSize=function(){return 1!=arguments.length||g.isNullOrUndefined(arguments[0])?this._pageSize:
(this._pageSize=arguments[0],this.isPageDefault=!1,this)};b.prototype.resetPaging=function(){this._pageSize=null;this._pageNumber=1;this.isPageDefault=!0;return this};b.prototype.pageString=function(){return"pnum="+this._pageNumber+(this._pageSize?"&psize="+this._pageSize:"")};var f=function(b){b=b||{};this._isAscending=!1;this._order=[];this.isSortSet=!1;g.isNullOrUndefined(b.isAscending)||this.isAscending(b.isAscending);this.orderBy(b.orderBy);b.ascending&&this.ascending(b.ascending);b.descending&&
this.descending(b.descending)};f.prototype.orderBy=function(){return 1===arguments.length&&g.isString(arguments[0])?(this._order=[{orderBy:arguments[0],isAscending:this._isAscending}],this.isSortSet=!0,this):this._order[0]?this._order[0].orderBy:null};f.prototype.isAscending=function(){if(1===arguments.length){var b=void 0===arguments[0]||null==arguments[0]?!1:arguments[0];this._order.forEach(function(c){c.isAscending=b});this._isAscending=b;this.isSortSet=!0;return this}return 0<this._order.length?
order[0].isAscending:this._isAscending};f.prototype.resetSorting=function(){this._order=[];this.isSortSet=this._isAscending=!1;return this};f.prototype._setSorting=function(b,c){if(arguments.length){var e=this;b.forEach(function(b){Array.isArray(b)&&(b=b.join());b.replace(/\s/g,"").split(",").forEach(function(b){var k=e._order.findWhere({orderBy:b.toLowerCase()});k?k.isAscending=c:e._order.push({orderBy:b.toLowerCase(),isAscending:c})})});this.isSortSet=!0}return this};f.prototype.ascending=function(){return this._setSorting(Array.prototype.slice.call(arguments),
!0)};f.prototype.descending=function(){return this._setSorting(Array.prototype.slice.call(arguments),!1)};f.prototype.sortString=function(){return this._order&&0<this._order.length?"orderBy="+this._order.map(function(b){return b.orderBy+" "+(b.isAscending?"asc":"desc")}).join(","):""};m=function(){};m.prototype._setPaging=function(b){b&&(this.pageNumber(b.pagenumber),this.pageSize(b.pagesize),this.results=this.results||[],this.results.isLastPage=!1,this.results.total=b.totalrecords,this.results.pageNumber=
b.pagenumber,this.results.pageSize=b.pagesize,b.pagenumber*b.pagesize>=b.totalrecords&&(this.results.isLastPage=!0))};m.prototype.fields=function(){if(1===arguments.length){var b=arguments[0];g.isString(b)?this._fields=[b]:g.isArray(b)&&b.length&&(this._fields=b);return this}return this._fields};m.prototype._parse=function(b,g,e){b||(b=[]);var k="object"===this.type()?"Object":"Connection";return c[k]._parseResult(b,e.entity,g)};m.prototype.collection=function(b,f){f=f||{};g.isObject(b)&&(f=b,b=null);
b||(b=this.results?this.results:[]);var e=options.entity;!e&&0<b.length&&b[0]instanceof c.BaseObject&&(e="object"==b[0].type?"Object":"Connection",e=c[e]._getClass(b[0].className));e||(e="object"===_etype?"Object":"Connection",e=c[e]._getClass(this[e]));return new c.Collection(b,h(f,{model:e,query:this}))};m.prototype.fetchNext=function(b){var c=this.pageNumber();if(!c||0>=c)c=1;this.pageNumber(++c);return this.fetch(b)};m.prototype.fetchPrev=function(b){var c=this.pageNumber();--c;if(!c||0>=c)c=
1;this.pageNumber(c);return this.fetch(b)};m.prototype.count=function(b){var g=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){b=b||{};b=b.paginginfo;var c=0,c=b?b.totalrecords:0;g.fulfill(c)};b.promise=g;b.entity=this;return c.http.send(b)};var l=function(d){var h=d||{};b.call(this,d);f.call(this,d);var e="",k="",p=h.queryType||"BasicQuery",t=h.type||h.relation,q=h.relation?"connection":"object",r=this;this._fields=[];h.entity&&(this.entity=h.entity);this.type=function(){return q};
this.entityType=function(){return t};this.queryType=function(){return p};this.filter=function(){return 1===arguments.length?(e=arguments[0],this):e};this.freeText=function(){if(1===arguments.length){var b=arguments[0];g.isString(b)?k=arguments[0]:g.isArray(b)&&b.length&&(k=arguments[0].join(" "));return this}return k};this.filter(h.filter||"");this.freeText(h.freeText||"");this.fields(h.fields||[]);this.setFilter=function(b){this.filter(b)};this.setFreeText=function(b){this.freeText(b)};this.setFields=
function(b){this.fields(b)};this.extendOptions=function(e){for(var c in e)h[c]=e[c];b.call(this,h);f.call(this,h);return this};this.getQueryString=function(){var b=this.pageString(),e=this.sortString();e&&(b+="&"+e);this.filter()&&(e=encodeURIComponent(this.filter().toString()),0<e.trim().length&&(b+="&query="+e));this.freeText()&&0<this.freeText().trim().length&&(b+="&freetext="+encodeURIComponent(this.freeText())+"&language=en");this._fields&&0<this._fields.length&&(b+="&fields="+this._fields.join(","));
return b};this.toUrl=function(){return{url:c.config.apiBaseUrl+q+"/"+t+"/find/all?"+this.getQueryString(),description:"FindAll "+t+" "+q+"s"}};this.toRequest=function(b){var e=new c.HttpRequest,k=this.toUrl();e.url=k.url;e.options=b;e.description=k.description;e.method="get";return e};this.getOptions=function(){var b={},e;for(e in this)this.hasOwnProperty(e)&&!g.isFunction(this[e])&&(b[e]=this[e]);return b};this.fetch=function(b){var e=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){r.results=
r._parse(b[q+"s"],b.__meta,h);r._setPaging(b.paginginfo);e.fulfill(r.results,b.paginginfo)};b.promise=e;b.entity=this;return c.http.send(b)};this.fetch=function(b){var e=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){r.results=r._parse(b[q+"s"],b.__meta,h);r._setPaging(b.paginginfo);e.fulfill(r.results,b.paginginfo)};b.promise=e;b.entity=this;return c.http.send(b)}};h(l.prototype,m.prototype,f.prototype,b.prototype);c.Queries.FindAllQuery=function(b){b=b||{};if(!b.type&&!b.relation)throw Error("Specify either type or relation for basic filter query");
b.queryType="FindAllQuery";l.call(this,b);return this};c.Queries.FindAllQuery.prototype=new l;c.Queries.FindAllQuery.prototype.constructor=c.Queries.FindAllQuery;c.Query=c.Queries.FindAllQuery;c.Queries.ConnectedObjectsQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for connected objects query");if(!b.objectId)throw Error("Specify objectId for connected objects query");if(!b.type)throw Error("Specify type of object id for connected objects query");var f=b.type;delete b.type;
b.queryType="ConnectedObjectsQuery";l.call(this,b);this.objectId=b.objectId;this.relation=b.relation;this.type=f;b.object instanceof c.Object&&(this.object=b.object);this.returnEdge=!0;void 0===b.returnEdge||null===b.returnEdge||b.returnEdge||(this.returnEdge=!1);this.label="";var e=this;g.isString(b.label)&&0<b.label.length&&(this.label="&label="+b.label);this.toUrl=function(){return{url:c.config.apiBaseUrl+"connection/"+this.relation+"/"+this.type+"/"+this.objectId+"/find?"+this.getQueryString()+
this.label+"&returnEdge="+this.returnEdge,description:"GetConnectedObjects for relation "+this.relation+" of type "+this.type+" for object "+this.objectId}};var k=function(b,k,d,g){var f=[];b.forEach(function(b){var e=b.__edge;delete b.__edge;var p=c.Object._create(h({__meta:d},b),!0);e&&(e.__endpointa=k,e.__endpointb={objectid:b.__id,label:e.__label,type:b.__type},delete e.label,p.connection=c.Connection._create(h({__meta:g},e),!0));f.push(p)});e.object&&(e.object.children[e.relation]=f);return f};
this.fetch=function(p){var g=c.Promise.buildPromise(p);p=this.toRequest(p);p.onSuccess=function(c){e.results=k(c.nodes?c.nodes:[],{objectid:b.objectId,type:f,label:c.parent},c.__nodemeta,c.__edgemeta);e._setPaging(c.paginginfo);g.fulfill(e.results,c.paginginfo)};p.promise=g;p.entity=this;return c.http.send(p)};return this};c.Queries.ConnectedObjectsQuery.prototype=new l;c.Queries.ConnectedObjectsQuery.prototype.constructor=c.Queries.ConnectedObjectsQuery;c.Queries.GetConnectionsQuery=function(b){b=
b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!b.objectId)throw Error("Specify objectId for GetConnectionsQuery query");if(!b.label||0===b.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");b.type&&delete b.type;b.queryType="GetConnectionsQuery";l.call(this,b);this.objectId=b.objectId;this.relation=b.relation;this.label=b.label;this.toUrl=function(){return{url:c.config.apiBaseUrl+"connection/"+this.relation+"/find/all?"+this.getQueryString()+
"&objectid="+this.objectId+"&label="+this.label,description:"FindAllConnections for relation "+this.relation+" from object id "+this.objectId}};return this};c.Queries.GetConnectionsQuery.prototype=new l;c.Queries.GetConnectionsQuery.prototype.constructor=c.Queries.GetConnectionsQuery;c.Queries.GetConnectionsBetweenObjectsQuery=function(b,f){b=b||{};delete b.entity;if(!b.objectAId||!g.isString(b.objectAId)||0===b.objectAId.length)throw Error("Specify valid objectAId for GetConnectionsBetweenObjectsQuery query");
if(!b.objectBId||!g.isString(b.objectBId)||0===b.objectBId.length)throw Error("Specify objectBId for GetConnectionsBetweenObjectsQuery query");b.type&&delete b.type;b.queryType=f||"GetConnectionsBetweenObjectsQuery";l.call(this,b);this.objectAId=b.objectAId;this.objectBId=b.objectBId;this.label="GetConnectionsBetweenObjectsForRelationQuery"===this.queryType()&&b.label&&g.isString(b.label)&&0<b.label.length?"&label="+b.label:"";this.relation=b.relation&&g.isString(b.relation)&&0<b.relation.length?
b.relation+"/":"";this.toUrl=function(){return{url:c.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.objectAId+"/"+this.objectBId+"?"+this.getQueryString()+this.label,description:"FindConnectionBetween for relation "+this.relation+" between object ids "+this.objectAId+" and "+this.objectBId}};return this};c.Queries.GetConnectionsBetweenObjectsQuery.prototype=new l;c.Queries.GetConnectionsBetweenObjectsQuery.prototype.constructor=c.Queries.GetConnectionsBetweenObjectsQuery;c.Queries.GetConnectionsBetweenObjectsForRelationQuery=
function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsBetweenObjectsForRelationQuery query");var g=new c.Queries.GetConnectionsBetweenObjectsQuery(b,"GetConnectionsBetweenObjectsForRelationQuery");g.fetch=function(e){var k=c.Promise.buildPromise(e);e=this.toRequest(e);e.onSuccess=function(e){g.results=e.connection?[c.Connection._create(h({__meta:e.__meta},e.connection),!0,b.entity)]:null;k.fulfill(g.results?g.results[0]:null)};e.promise=k;e.entity=this;return c.http.send(e)};
return g};c.Queries.InterconnectsQuery=function(b){b=b||{};delete b.entity;if(!b.objectAId||!g.isString(b.objectAId)||0===b.objectAId.length)throw Error("Specify valid objectAId for InterconnectsQuery query");if(!(b.objectBIds&&g.isArray(b.objectBIds)&&0<b.objectBIds.length))throw Error("Specify list of objectBIds for InterconnectsQuery query");b.type&&delete b.type;b.queryType="InterconnectsQuery";l.call(this,b);this.objectAId=b.objectAId;this.objectBIds=b.objectBIds;this.toRequest=function(b){var e=
new c.HttpRequest,k=this.toUrl();e.url=k.url;e.options=b;e.description=k.description;e.method="post";e.data={object1id:this.objectAId,object2ids:this.objectBIds};return e};this.toUrl=function(){return{url:c.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString(),description:"GetInterConnections between objects"}};return this};c.Queries.InterconnectsQuery.prototype=new l;c.Queries.InterconnectsQuery.prototype.constructor=c.Queries.InterconnectsQuery;c.Queries.GraphQuery=function(d,h,e){g.isObject(d)&&
(e=d,e.returnObjects=d.returnObjects||e.returnObjects,h=e.placeholders||{},d=e.name);if(!d||0===d.length)throw Error("Specify name of filter query");e=e||{};this.placeholders=h||{};this.returnObjects=e.returnObjects;b.call(this,e);f.call(this,e);this.name=d;this.queryType="GraphQuery";this.fields(e.fields||[]);var k=this;this.type=function(){return"object"};this.toRequest=function(b){var e=new c.HttpRequest,k=this.toUrl();e.url=k.url;e.options=b;e.description=k.description;e.method="post";this.data=
{};if(this.placeholders){this.data.placeholders=this.placeholders;for(var d in this.data.placeholders)this.data.placeholders[d]=this.data.placeholders[d]}e.data=this.data;return e};this.getQueryString=function(){var b=[];this.isPageDefault||b.push(this.pageString());this.isSortSet&&b.push(this.sortString());this._fields&&0<this._fields.length&&b.push("fields="+this._fields.join(","));return b.join("&")};this.toUrl=function(){return{url:c.config.apiBaseUrl+"search/"+this.name+"/"+(this.returnObjects?
"graphquery":"filter")+"?"+this.getQueryString(),description:"Filter Query with name "+this.name}};this.fetch=function(b){var d=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){var c;k.returnObjects?(k.results=k._parse(b.objects,b.__meta,e),c=k.results):this.results=c=b.ids?b.ids:[];b.paginginfo&&k._setPaging(b.paginginfo);d.fulfill(c,b.paginginfo)};b.promise=d;b.entity=this;return c.http.send(b)}};h(c.Queries.GraphQuery.prototype,m.prototype,f.prototype,b.prototype);c.Queries.GraphAPI=
function(b,f,e){if(!b||0===b.length)throw Error("Specify name of project query");if(!f||!f.length)throw Error("Specify ids to project");this.name=b;this.data={ids:f};this.queryType="GraphApi";var k=this;if(e){this.data.placeholders=e;for(var p in this.data.placeholders)this.data.placeholders[p]=this.data.placeholders[p]}this.toRequest=function(b){var e=new c.HttpRequest,k=this.toUrl();e.url=k.url;e.description=k.description;e.method="post";e.data=this.data;e.options=b;return e};this.toUrl=function(){return{url:c.config.apiBaseUrl+
"search/"+this.name+"/project",description:"Project Query with name "+this.name}};var t=function(b){var e,k;for(k in b)if("status"!==k){e=b[k];break}var d=function(b,e,k,g,p){var f=[];b.forEach(function(b){var q=b.__children;delete b.__children;var r=b.__edge;delete b.__edge;b=c.Object._create(h({__meta:g},b),!0);b.children={};for(var t in q)b.children[t]=[],b.children[t]=d(q[t].values,q[t].parent,b.id,q[t].__nodemeta,q[t].__edgemeta);r&&(r.__endpointa={objectid:k,label:e},r.__endpointb={objectid:b.id,
label:r.__label},delete r.__label,b.connection=c.Connection._create(h({__meta:p},r),!0));f.push(b)});return f};return d(e.values,null,null,e.__nodemeta)};this.collection=function(b,e){e=e||{};g.isObject(b)&&(e=b,b=null);b||(b=this.results?ths.results:[]);var k;0<b.length&&b[0]instanceof c.BaseObject&&(k=c.Object._getClass(b[0].className));return new c.Collection(b,h(e,{model:k,query:this}))};this.fetch=function(b){var e=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){k.results=
t(b);e.fulfill(k.results)};b.promise=e;b.entity=this;return c.http.send(b)}}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.utils._extend,b={__utcdatecreated:"datetime",__utclastupdateddate:"datetime"},f=function(b){return g.isString(b)||g.isNumber(b)||g.isBoolean(b)},l=function(b){return b instanceof c.GeoCoord},d=function(b){b=b||{};var e={},c;for(c in b.__meta)b.__meta[c].forEach(function(b){e[b]=c});return e},n={integer:function(b){if(b){var e=parseInt(b);if(!isNaN(e))return e}return b},decimal:function(b){if(b){var e=parseFloat(b);if(!isNaN(e))return e}return b},
"boolean":function(b){return g.isBoolean(b)?b:void 0!==b&&null!==b&&("true"===b.toString().toLowerCase()||!0===b||0<b)?!0:!1},date:function(b){if(g.isDate(b))return b;if(b){var e=c.Date.parseISODate(b);if(e)return e}return b},datetime:function(b){if(g.isDate(b))return b;if(b){var e=c.Date.parseISODate(b);if(e)return e}return b},time:function(b){if(g.isDate(b))return b;if(b){var e=c.Date.parseISOTime(b);if(e)return e}return b},string:function(b){return b?b.toString():b},geocode:function(b){if(l(b))return b;
if(!g.isString(b)||0==b.trim().length)return!1;b=b.split(",");return 2!==b.length?!1:new c.GeoCoord(b[0],b[1])}};n["long"]=n.integer;n.geography=n.geocode;n.text=n.string;n.bool=n["boolean"];c.utils._cast=n;c.utils._cast.isString=f;c.utils._cast.isGeocode=l;var e=function(b){return g.isNullOrUndefined(b)?null:f(b)?b+"":g.isDate(b)?c.Date.toISOString(b):g.isObject(b)?l(b)?b.toString():b.getObject?b.getObject():b:b};c.utils._encode=function(b){var c={},d;for(d in b){var f=b[d];g.isArray(f)?(c[d]=[],
f.forEach(function(b){(b=e(b))&&c[d].push(b)})):c[d]=e(b[d])}return c};c.utils._decode=function(e){var c={},f=h({},b,d(e));delete e.__meta;for(var q in e)g.isArray(e[q])?(c[q]=[],e[q].forEach(function(b){b=f[q]?n[f[q]](b):b;c[q].push(b)})):g.isString(e[q])?c[q]=f[q]?n[f[q]](e[q]):e[q]:c[q]=e[q];return c}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.utils._extend,b=c.utils._deepExtend,f=c.utils._cast,l=["__link","__endpointa","__endpointb"],d="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __type __relationtype __typeid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link __acls __meta".split(" "),n=function(b){return f.isString(b)||g.isDate(b)||f.isGeocode(b)};m=function(e,k){this._snapshot={};k=k||{};e=e||{};this.objectOptions=b({},e);this.meta=
{};this.objectOptions.__meta=h(this.meta,this.objectOptions.__meta);k&&k.parse&&(this.objectOptions=this.parse(this.objectOptions));this.defaults=c.utils._result(this,"defaults");g.isObject(this.defaults)&&!k.setSnapShot&&(this.objectOptions=b({},this._defaults,this.objectOptions));k&&k.collection&&(this.collection=k.collection);this.objectOptions=c.utils._decode(e);"object"==this.type&&(this._destroyWithConnections=function(b){return this.destroy(h({deleteConnections:!0},b))});this.base=c.Object.prototype;
this.cid=parseInt(1E8*Math.random(),10);this.idAttribute="__id";this._atomicProps={};this._multivaluedProps={};this._setOps={};var d={};this._copy(this.objectOptions,d);k.setSnapShot&&this._copy(d,this._snapshot);!this._snapshot[this.idAttribute]&&d[this.idAttribute]&&(this._snapshot[this.idAttribute]=d[this.idAttribute]);this.id=this._snapshot[this.idAttribute];d.__type?(d.__type=d.__type.toLowerCase(),this.entityType="type",this.type="object",this.className=d.__type):d.__relationtype&&(d.__relationtype=
d.__relationtype.toLowerCase(),this.entityType="relation",this.type="connection",this.className=d.__relationtype);d.__attributes||(d.__attributes={});this._snapshot.__attributes||(this._snapshot.__attributes={});this._removeTags=[];d.__tags||(d.__tags=[]);this._snapshot.__tags||(this._snapshot.__tags=[]);this.attributes=this._object=d;this._fields="";this._mergePrivateFields(this.attributes)};h(m.prototype,{_copy:function(e,k){e.__meta=h(this.meta,e.__meta);this.meta=e.__meta;this._mergePrivateFields(e);
var d=c.utils._decode(e),f;for(f in d)f==this.idAttribute&&(this.id=d[f]),this._atomicProps[f]&&delete this._atomicProps[f],this._multivaluedProps[f]&&delete this._multivaluedProps[f],this._setOps[f]&&delete this._setOps[f],n(d[f])?k[f]=d[f]:g.isObject(d[f])?k[f]=b({},k[f],d[f]):g.isArray(d[f])?(k[f]=[],d[f].forEach(function(b){if(n(b)||"__link"==f)k[f].push(b);else throw Error("Multivalued property cannot add object or array as property of object");})):k[f]=d[f]},_mergePrivateFields:function(b,k){var d=
{id:"id",__id:"id",__utclastupdateddate:"lastUpdatedAt",__utcdatecreated:"createdAt",__createdby:"createdBy",__updatedby:"lastUpdatedBy"},f=this;"id __id __utclastupdateddate __utcdatecreated __createdby __updatedby".split(" ").forEach(function(h){b[h]&&("__utcdatecreated"!==h&&"__utclastupdateddate"!==h||g.isDate(b[h])?f[d[h]]=b[h]:f[d[h]]=c.Date.parseISODate(b[h]),k&&delete b[h])})},_getOutpuStatus:function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";return b},getObject:function(){var e=
c.utils._encode(b({__meta:this.meta},this._object));"connection"==this.type&&(e.__endpointa=this._object.__endpointa.toJSON(),e.__endpointb=this._object.__endpointb.toJSON());this.hasOwnProperty("id")&&(e.__id=this.id);return e},toJSON:function(e){if(e&&"object"==this.type){var c=function(b){var e=[];b.forEach(function(b){var d=b.toJSON();if(b.children&&!Object.isEmpty(b.children)){d.children={};for(var f in b.children)g.isArray(b.children[f])?d[f]=c(b.children[f]):d[f]=c([b.children[f]])[0],d.children[f]=
d[f]}b.connection&&(d.__connection=b.connection.toJSON());e.push(d)});return e};return c([this])[0]}e=b({__meta:this.meta},this._object);"connection"==this.type&&(this._object.__endpointa=this._object.__endpointa.toJSON(),this._object.__endpointb=this._object.__endpointb.toJSON());this.hasOwnProperty("id")&&this.id&&(e.__id=this.id);return e},properties:function(){var e=b({},this.attributes);delete e.__attributes;delete e.__tags;return e},attr:function(){if(0===arguments.length)return this._object.__attributes||
(this._object.__attributes={}),this._object.__attributes;if(1===arguments.length)return this._object.__attributes||(this._object.__attributes={}),this._object.__attributes[arguments[0]];if(2===arguments.length){if(!g.isString(arguments[1])&&null!==arguments[1])throw Error("only string values can be stored in attributes.");this._object.__attributes||(this._object.__attributes={});this._object.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");
this.triggerChangeEvent("__attributes");return this._object.__attributes},getChangedAttributes:function(){if(this._object.__attributes){if(!this._snapshot.__attributes)return this._object.__attributes;var b=!1,c=JSON.parse(JSON.stringify(this._snapshot.__attributes)),d;for(d in this._object.__attributes)null==this._object.__attributes[d]||void 0==this._object.__attributes[d]?(c[d]=null,b=!0):this._object.__attributes[d]!=this._snapshot.__attributes[d]?(c[d]=object.__attributes[d],b=!0):this._object.__attributes[d]==
this._snapshot.__attributes[d]&&delete c[d];return b?c:void 0}},aggregate:function(){var b={},c;for(c in this._object){if(!this._object.hasOwnProperty(c))return;"$"==c[0]&&(b[c.substring(1)]=this._object[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");},tags:function(){return this._object.__tags?this._object.__tags:[]},addTag:function(b){if(!b||!g.isString(b)||!b.length)return this;
this._object.__tags||(this._object.__tags=[]);this._object.__tags.push(b);this._object.__tags=Array.distinct(this._object.__tags);if(!_removeTags||!_removeTags.length)return this.triggerChangeEvent("__tags"),this;b=_removeTags.indexOf(b);-1!=b&&_removeTags.splice(b,1);this.triggerChangeEvent("__tags");return this},removeTag:function(b){if(!b||!g.isString(b)||!b.length)return this;this._removeTags.push(b);this._removeTags=Array.distinct(this._removeTags);if(!this._object.__tags||!this._object.__tags.length)return this.triggerChangeEvent("__tags"),
this;b=this._object.__tags.indexOf(b);-1!=b&&this._object.__tags.splice(b,1);this.triggerChangeEvent("__tags");return this},getChangedTags:function(){if(this._object.__tags){if(!this._snapshot.__tags)return this._object.__tags;var b=[],c=this;this._object.__tags.forEach(function(d){-1==c._snapshot.__tags.indexOf(d)&&b.push(d)});return 0<b.length?b:void 0}},getRemovedTags:function(){return this._removetags},_setMutliItems:function(b,c,d,f){if(!b||!g.isString(b)||0===b.length||0==b.trim().indexOf("__")||
0===b.trim().indexOf("$")||void 0==c||null==c)return this;b=b.toLowerCase();var h=this;try{var r=function(c){if(!n(c))throw Error("Multivalued property cannot have values of property as an object");if(h._object[b]&&g.isArray(h._object[b]))if("additems"==d)h._object[b].push(c);else if("adduniqueitems"==d){var k=-1;h._object[b].find(function(b,e){return g.isEqual(b,c)?(k=e,!0):!1});-1==k&&h._object[b].push(c)}else"removeitems"==d&&h._object[b].removeAll(c);else h._object[b]="removeitems"==d?[]:[c];
h._multivaluedProps[b]||(h._multivaluedProps[b]={additems:[],adduniqueitems:[],removeitems:[]});h._multivaluedProps[b][d].push(c)};g.isArray(c)?c.forEach(function(b){r(b)}):r(c);this.triggerChangeEvent(b,f)}catch(l){throw Error("Unable to add item to "+b);}return this},add:function(b,c,d){return this._setMutliItems(b,c,"additems",d)},addUnique:function(b,c,d){return this._setMutliItems(b,c,"adduniqueitems",d)},remove:function(b,c,d){return this._setMutliItems(b,c,"removeitems",d)},_hasChanged:function(b,
c,d,f){var h=void 0;g.isEqual(d,c)||("__tags"==b?(b=this.getChangedTags())&&0<b.length&&(h=b):"__attributes"==b?(b=this._getChangedAttributes(),Object.isEmpty(b)||(h=b)):g.isArray(d)?this._multivaluedProps[b]&&!this._setOps[b]?h=f?this._multivaluedProps[b]:d:d.equals(c)||(h=d):h=this._atomicProps[b]&&!this._setOps[b]?f?{incrementby:this._atomicProps[b].value}:d:d);return h},_getChanged:function(e){var k=!1,f=b({},this._snapshot),g;for(g in f)"$"==g[0]&&delete f[g];for(var h in this._object)g=this._hasChanged(h,
f[h],this._object[h],e),void 0===g?delete f[h]:(k=!0,f[h]=g);try{d.forEach(function(b){f[b]&&delete f[b]})}catch(r){}e&&(f=c.utils._encode(f));h=this.getChangedTags();e?(h&&0<h.length&&(f.__addtags=h,k=!0),this._removeTags&&0<this._removeTags.length&&(f.__removetags=this._removeTags,k=!0)):h&&0<h.length&&(f.__tags=h,k=!0);(e=this.getChangedAttributes())&&!Object.isEmpty(e)?(f.__attributes=e,k=!0):delete f.__attributes;"object"==this.type&&this._aclFactory&&(e=this._aclFactory.getChanged())&&(k=!0,
f.__acls=e);return k&&!Object.isEmpty(f)?f:!1},changed:function(){return this.isNew()?this.toJSON():this._getChanged()},hasChanged:function(){return this.isNew()?!0:0===arguments.length?Object.isEmpty(this._getChanged(!0))?!1:!0:1==arguments.length&&g.isString(arguments[0])&&0<arguments[0].length?void 0==this._hasChanged(arguments[0],this._snapshot[arguments[0]],this._object[arguments[0]])?!1:!0:!1},changedAttributes:function(){if(this.isNew())return this.toJSON();if(0===arguments.length)return this._getChanged();
if(1==arguments.length&&g.isArray(arguments[0])&&arguments[0].length){var b={},c=this;arguments[0].forEach(function(d){d=c._hasChanged(d,c._snapshot[d],c._object[d]);void 0!=d&&b.push(d)});return b}return!1},previous:function(){return this.isNew()?null:1==arguments.length&&g.isString(arguments[0])&&arguments[0].length?this._snapshot[arguments[0]]:null},previousAttributes:function(){return this.isNew()?null:h({},this._snapshot)},fields:function(){if(1==arguments.length){var b=arguments[0];g.isString(b)?
this._fields=b:g.isArray(b)&&(this._fields=b.join(","));return this}return this._fields},get:function(b,c){if(b){if(c&&f[c.toLowerCase()]){if(f[c.toLowerCase()])return f[c.toLowerCase()](this._object[b]);throw Error('Invalid cast-type "'+c+'"" provided for get "'+b+'"');}return this._object[b]}},tryGet:function(b,c,d){b=this.get(b,d);return void 0!==b?b:c},triggerChangeEvent:function(b,c){if(c&&!c.silent){var f=this._hasChanged(b,this._snapshot[b],this._object[b]);if(void 0!=f[b]||-1!=d.indexOf(b))this.trigger("change:"+
b,this,f[b]||this._object[b],{}),c.ignoreChange||this.trigger("change",this,c)}},triggerDestroy:function(b){b&&!b.silent&&this.trigger("destroy",this,this.collection,b)},_triggerError:function(b,c){b.silent||this.trigger("error",this,c,b)},_set:function(b,c,d){if(!b||!g.isString(b)||0===b.length||0===b.trim().indexOf("$"))return this;var f=this;b=b.toLowerCase();try{if(g.isNullOrUndefined(c))this._object[b]=null;else if(n(c))this._object[b]=c;else if(g.isObject(c))if(-1!==l.indexOf(b))this._object[b]=
c;else throw Error("Property cannot have value as an object");else g.isArray(c)&&(this._object[b]=[],c.forEach(function(c){if(n(c))f._object[b].push(c);else throw Error("Multivalued property cannot have values of property as an object");}));delete this._atomicProps[b];delete this._multivaluedProps[b];delete this._setOps[b];g.isEqual(this._object[b],this._snapshot[b])||(this._setOps[b]=!0);b==this.idAttribute&&(this.id=c);return this}catch(h){throw Error("Unable to set "+b);}},set:function(b,c,f){var g,
l;if(null==b)return this;null==b||"object"===typeof b?(l=b,f=c):(l={})[b]=c;f||(f={});if(!this._validate(l,f))return!1;this.idAttribute in l&&(this.id=l[this.idAttribute]);this._mergePrivateFields(l);var r=!1;for(g in l)c=l[g],this._set(g,c,h({},f,{ignoreChange:!0}));if(f&&!f.silent)for(g in l)if(void 0!=this._hasChanged(g,this._snapshot[g],this._object[g])||-1!=d.indexOf(g))r=!0,this.trigger("change:"+b,this,this._object[b],{});r&&this.trigger("change",this,f);return this},unset:function(b,c){if(!b||
!g.isString(b)||0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();delete this._object[b];this.triggerChangeEvent(b,c);return this},_validate:function(b,c){if(!c.validate||!this.validate||!g.isFunction(this.validate))return!0;b=h({},this.attributes,b);var d=this.validationError=this.validate(b,c)||null;if(!d)return!0;this.trigger("invalid",this,d,h(c,{validationError:d}));return!1},isValid:function(b){return this._validate({},h(b||{},{validate:!0}))},has:function(b){return b&&g.isString(b)&&
0!==b.length?this._object[b]&&!g.isUndefined(this._object[b])?!0:!1:!1},isNew:function(){return!(!g.isNullOrUndefined(this.id)||this.has(this.idAttribute))},clone:function(){return"object"==this.type?c.Object._create(b({__meta:this.meta},this.getObject())):c.Connection._create(b({__meta:this.meta},this.getObject()))},copy:function(b,c){b&&(this._copy(b,this._object),c&&this._copy(b,this._snapshot));return this},mergeWithPrevious:function(){this._copy(this._object,this._snapshot);this._aclFactory&&
this._aclFactory.merge();this._mergePrivateFields(this._snapshot);this._removeTags=[];this._atomicProps={};this._multivaluedProps={};this._setOps={};return this},_merge:function(){this._copy(this._snapshot,this._object);this._aclFactory&&this._aclFactory.merge();this._mergePrivateFields(this._object);this._removeTags=[];this._atomicProps={};this._multivaluedProps={};this._setOps={}},rollback:function(){this._object=this.raw={};this._merge();return this},_atomic:function(b,c,d,f){if(!b||!g.isString(b)||
0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();if(g.isObject(this._object[b])||g.isArray(this._object[b]))throw Error("Cannot increment/decrement array/object");try{g.isObject(c)?(f=c,c=d):c=!c||isNaN(Number(c))?d:Number(c)*d,this._object[b]=isNaN(Number(this._object[b]))?c:Number(this._object[b])+c,this.isNew()||(this._atomicProps[b]={value:(this._atomicProps[b]?this._atomicProps[b].value:0)+c})}catch(h){throw Error("Cannot perform increment/decrement operation");}this.triggerChangeEvent(b,
f);return this},increment:function(b,c,d){return this._atomic(b,c,1,d)},decrement:function(b,c,d){return this._atomic(b,c,-1,d)},_findUnsavedChanges:function(){var b={object:null,isNested:!1};if(this.id)b.object=this._getChanged(!0);else{var c=this.getObject();delete c.__meta;for(var d in c)"$"==d[0]&&delete c[d];c.__revision&&delete c.__revision;"object"==this.type&&this._aclFactory&&(d=this._aclFactory.getChanged())&&(c.__acls=d);c.__tags&&0==c.__tags.length&&delete c.__tags;Object.isEmpty(c.__attributes)&&
delete c.__attributes;"connection"==this.type&&(c.__endpointa.objectid&&delete c.__endpointa.object,c.__endpointb.objectid&&delete c.__endpointb.object);b.object=c}return b},getType:function(){var b=this.type;!this._object.__type||"user"!=this._object.__type.toLowerCase()&&"device"!=this._object.__type.toLowerCase()||(b=this._object.__type.toLowerCase());return b},_parseOutput:function(b,d){var f=this.getType(),g;b=b||{};if(d&&d[f]){b&&b.parse&&(d[f]=this.parse(d[f]));var l=this.isNew(),r=!1;"connection"==
this.type&&this._object.__endpointa&&d[f].__endpointa.label!=this._object.__endpointa.label&&(r=d[f].__endpointa,d[f].__endpointa=d[f].__endpointb,d[f].__endpointb=r,r=!0);this._snapshot=c.utils._decode(h({__meta:h(this.meta,d.__meta)},d[f]));this.id=this._object[this.idAttribute]=d[f][this.idAttribute];this._merge();l?("connection"==this.type&&(b._batch||(r?(this._object.__endpointa.object&&d.__bmeta&&(this._object.__endpointa.object.__meta=d.__bmeta),this._object.__endpointb.object&&d.__ameta&&
(this._object.__endpointb.object.__meta=d.__ameta)):(this._object.__endpointa.object&&d.__ameta&&(this._object.__endpointa.object.__meta=d.__ameta),this._object.__endpointb.object&&d.__bmeta&&(this._object.__endpointb.object.__meta=d.__bmeta))),this.parseConnection(b._batch)),this.trigger("change:__id",this,this.id,{}),c.eventManager.fire(this.entityType+"."+f+".created",this,{object:this}),this.created=!0):c.eventManager.fire(this.entityType+"."+f+"."+this.id+".updated",this,{object:this});b.silent||
this.trigger("sync",this,d[f],b)}else d=d||{},d.status=d.status||{},g=this._getOutpuStatus(d.status),this._triggerError(b,new c.Error(g)),this.isNew()?c.eventManager.fire(this.entityType+"."+f+".createFailed",this,{error:g}):c.eventManager.fire(this.entityType+"."+f+"."+this.id+".updateFailed",this,{object:g});return g},_save:function(){return this.id?this._update(arguments):this._create(arguments)},_create:function(b){b=b||{};var d=this.getType(),f=this._findUnsavedChanges(),g=this,h=new c._Request({method:"PUT",
type:d,op:"getCreateUrl",args:[this.className,this._fields],data:f.object,options:b,entity:g,onSuccess:function(c){(c=g._parseOutput(b,c))?h.promise.reject(c,g):h.promise.fulfill(g)}});return h.send()},_update:function(b,d){c.Promise.is(d)||(d=c.Promise.buildPromise(b));var f=this._findUnsavedChanges(),g=this;b=b||{};if(Object.isEmpty(f.object))d.fulfill(this);else{var h=this.type,l=[this.className,this.id,this._fields];this._object&&this._object.__type&&("user"==this._object.__type.toLowerCase()||
"device"==this._object.__type.toLowerCase())&&(h=this._object.__type.toLowerCase(),l.splice(0,1));var n=new c._Request({method:"POST",type:h,op:"getUpdateUrl",args:l,data:f.object,options:b,entity:this,onSuccess:function(c){(c=g._parseOutput(b,c))?n.promise.reject(c,g):n.promise.fulfill(g)}});return n.send()}return d},_fetch:function(b){if(!this.id)throw Error("Please specify id for get operation");b=b||{};var d=this.getType(),f=this,g=new c._Request({method:"GET",type:d,op:"getGetUrl",args:[this.className,
this.id,this._fields],options:b,entity:f,onSuccess:function(l){l&&l[d]?(b&&b.parse&&(l[d]=f.parse(l[d])),f._snapshot=c.utils._decode(h({__meta:h(f.meta,l.__meta)},l[d])),f._copy(f._snapshot,f._object),f._mergePrivateFields(f._object),f._aclFactory&&f._aclFactory._rollback(),l.connection&&(f.endpoints||f.endpointA&&f.endpointB||f.setupConnection(f._object.__endpointa,f._object.__endpointb)),b.silent||f.trigger("sync",f,l[d],b),c.eventManager.fire(f.entityType+"."+d+"."+f.id+".fetched",f,{object:f}),
g.promise.fulfill(f)):(l=l||{},l.status=l.status||{},l.status=_getOutpuStatus(l.status),f._triggerError(b,new c.Error(l.status)),g.promise.reject(l.status,f))}});return g.send()},_destroy:function(b){b=b||{};var d=b.deleteConnections,f=this;g.isBoolean(b)&&(d=b,b={});b.wait||this.triggerDestroy(b);if(!this.id)return(new c.Promise.buildPromise(b)).fulfill();var h=this.getType(),l=new c._Request({method:"DELETE",type:h,op:"getDeleteUrl",args:[this.className,this.id,d],options:b,entity:this,onSuccess:function(d){d&&
d.status?(f._object={},f._snapshot={},b.wait&&f.triggerDestroy(b),l.promise.fulfill(d.status)):(d=d||{},d.status=d.status||{},d.status=f._getOutpuStatus(d.status),f._triggerError(b,new c.Error(d.status)),l.promise.reject(d.status,f))}});return l.send()},save:function(){return this._save.apply(this,arguments)},fetch:function(){return this._fetch.apply(this,arguments)},destroy:function(){return this._destroy.apply(this,arguments)},destroyWithConnections:function(){return this._destroyWithConnections.apply(this,
arguments)},toString:function(){return JSON.stringify(this.getObject())},parse:function(b,c){return b},escape:function(b){return _.escape(this.get(b))}});c.BaseObject=m;c.BaseObject._saveAll=function(b,d,f){var h=new c.Batch;d=d||{};if(!g.isArray(b))throw Error("Provide an array of objects for Object.saveAll");b.forEach(function(b){b instanceof c.BaseObject||!g.isObject(b)||(b=new c[this.className||f](b));h.add(b)});return h.execute(d)};m.prototype.del=m.prototype._destroy;c.Events.mixin(c.BaseObject.prototype)})(global);
(function(m){var c=function(){return Math.floor(65536*Math.random()).toString(16)};m.Appacitive.GUID=function(){var g=c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c(),h="",b,f,l,d,n,e,k=0,g=g.replace(/\r\n/g,"\n");f="";for(l=0;l<g.length;l++)d=g.charCodeAt(l),128>d?f+=String.fromCharCode(d):(127<d&&2048>d?f+=String.fromCharCode(d>>6|192):(f+=String.fromCharCode(d>>12|224),f+=String.fromCharCode(d>>6&63|128)),f+=String.fromCharCode(d&63|128));for(g=f;k<g.length;)b=g.charCodeAt(k++),f=g.charCodeAt(k++),
l=g.charCodeAt(k++),d=b>>2,b=(b&3)<<4|f>>4,n=(f&15)<<2|l>>6,e=l&63,isNaN(f)?n=e=64:isNaN(l)&&(e=64),h=h+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e);return h.toString()}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=["allow","deny"],b=["create","read","update","delete","manageaccess"],f=function(c){var d=[];c.forEach(function(c){g.isString(c)&&-1!=b.indexOf(c.toLowerCase())&&d.push(c.toLowerCase())});return d};c._Acl=function(l,d){var n=l||[];g.isArray(n)||(n=[]);var e={};d&&(e=JSON.parse(JSON.stringify(n)));this.acls=n=JSON.parse(JSON.stringify(n));var k=[],p=function(b,e,d,g){if(!d)throw Error("Specify valid user or usergroup");d instanceof c.Object&&"user"==
d.typeName&&!d.isNew()&&(d=d.id);var l=n.filter(function(b){return b.sid==d&&b.type==e});l&&0!=l.length?l=l[0]:(l={sid:d,type:e,deny:[],allow:[]},n.push(l));l.allow||(l.allow=[]);l.deny||(l.deny=[]);g=f(g);var p=k.filter(function(b){return b.sid==d&&b.type==e});p&&0!=p.length?p=p[0]:(p={sid:d,type:e},k.push(p));g.forEach(function(c){for(var e=0;e<h.length;e+=1){var d=l[h[e]].indexOf(c);if(-1!=d){l[h[e]].splice(d,1);break}}"dontcare"!=b&&l[b].push(c);p[c]=b});return this},t=function(b,c,e,d){if(!e)throw Error("Please provide valid id or name for setting acls");
if(!d)throw Error("Please provide valid access permissions for setting acls");g.isArray(d)||(d=[d]);g.isArray(e)?e.forEach(function(e){p(b,c,e,d)}):p(b,c,e,d);return this},q=function(){n.allowUser=function(b,c){return t.apply(this,["allow","user",b,c])};n.allowGroup=function(b,c){return t.apply(this,["allow","usergroup",b,c])};n.denyUser=function(b,c){return t.apply(this,["deny","user",b,c])};n.denyGroup=function(b,c){return t.apply(this,["deny","usergroup",b,c])};n.resetUser=function(b,c){return t.apply(this,
["dontcare","user",b,c])};n.resetGroup=function(b,c){return t.apply(this,["dontcare","usergroup",b,c])};n.allowAnonymous=function(b){return t.apply(this,["allow","usergroup",["anonymous"],b])};n.denyAnonymous=function(b){return t.apply(this,["deny","usergroup",["anonymous"],b])};n.resetAnonymous=function(b){return t.apply(this,["dontcare","usergroup",["anonymous"],b])};n.allowLoggedIn=function(b){return t.apply(this,["allow","usergroup",["anonymous"],b])};n.denyLoggedIn=function(b){return t.apply(this,
["deny","usergroup",["anonymous"],b])};n.resetLoggedIn=function(b){return t.apply(this,["dontcare","usergroup",["anonymous"],b])}};this._rollback=function(){k=[];n=JSON.parse(JSON.stringify(e));q();return this};this.toJSON=this.getChanged=function(){var c=[];k.forEach(function(e){var d={sid:e.sid,type:e.type,allow:[],deny:[],dontcare:[]};b.forEach(function(b){e[b]&&d[e[b]].push(b)});h.forEach(function(b){0==d[b].length&&delete d[b]});0==d.dontcare.length&&delete d.dontcare;c.push(d)});return 0==c.length?
null:c};this.merge=function(){k=[];return this};q();return this};c.Group=new function(){var b=function(b,f,e,k){if(!f||!g.isString(f)||0===f.length)throw Error("Please specify valid groupname");g.isArray(e)||(e=[e]);var h={};h[b]=[];e.forEach(function(e){e&&(e instanceof c.Object&&"user"==e.typeName&&!e.isNew()?h[b].push(e.id):g.isString(e)&&h[b].push(e))});if(0==h[b].length)throw Error("Please specify valid members as second argument");var l=new c._Request({method:"POST",type:"usergroup",op:"getUpdateUrl",
args:[f],data:h,entity:this,options:k,onSuccess:function(b){l.promise.fulfill(b)}});return l.send()};this.addMembers=function(c,f,e){return b("add",c,f)};this.removeMembers=function(c,f,e){return b("remove",c,f)}}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.utils._extend;c.Object=function(b,f){b=b||{};f=f||{};this.className&&(b.__type=this.className);g.isString(b)&&(b={__type:b});if(!b.__type)throw Error("Cannot set object without __type");g.isBoolean(f)&&(f={setSnapShot:!0});c.BaseObject.call(this,b,f);this.type="object";this.getObject=this.getObject;this.children={};this.typeName=b.__type;this._aclFactory=new c._Acl(f.__acls,f.setSnapShot);this.acls=this._aclFactory.acls;g.isFunction(this.initialize)&&
this.initialize.apply(this,[b]);return this};c.Object.prototype=new c.BaseObject;c.Object.prototype.constructor=c.Object;c.Object.extend=function(d,f,e){g.isObject(d)&&(e=f,f=d,d=f.typeName);if(!g.isString(d)||0==d.length)throw Error("Appacitive.Object.extend's first argument should be the type-name.");var k=null;f=f||{};f.className=d;k=c.utils.classExtend(c.Object,f,e);delete k.extend;k.className=d;k.type=d;return b[d]=k};var b={},f=function(d){if(!g.isString(d))throw"_getClass requires a string argument.";
var f=b[d];f||(f=c.Object.extend(d),b[d]=f);return f};c.Object._getClass=f;c.Object._create=function(b,c,e){return(new (this.className?this:e?e:f(b.__type))(b)).copy(b,c)};var l=function(b,f,e){var g=[];b.forEach(function(b){b=c.Object._create(h(b,{__meta:e}),!0,f);g.push(b)});return g};c.Object._parseResult=l;c.Object.multiDelete=function(b,f){b=b||{};f=f||{};var e=[];this.className&&(b.type=this.className);g.isArray(b)&&0<b.length&&(b[0]instanceof c.Object?(e=b,b={type:e[0].className,ids:e.map(function(b){return b.id}).filter(function(b){return b})}):
b={type:this.className,ids:b});if(!b.type||!g.isString(b.type)||0===b.type.length)throw Error("Specify valid type");if("user"===b.type.toLowerCase()||"device"===b.type.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var k=new c._Request({method:"POST",data:{idlist:b.ids},type:"object",op:"getMultiDeleteUrl",args:[b.type],options:f,onSuccess:function(b){f&&!f.silent&&e.forEach(function(b){b.trigger("destroy",
b,b.collection,f)});k.promise.fulfill()}});return k.send()};c.Object.multiGet=function(b,f){b=b||{};f=f||{};g.isArray(b)&&0<b.length&&(b=b[0]instanceof c.Object?{ids:b.map(function(b){return b.id}).filter(function(b){return b})}:{ids:b});this.className&&(b.type=this.className,b.entity=this);if(!b.type||!g.isString(b.type)||0===b.type.length)throw Error("Specify valid type");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var e=new c._Request({method:"GET",type:"object",op:"getMultiGetUrl",
args:[b.type,b.ids.join(","),b.fields],options:f,onSuccess:function(c){e.promise.fulfill(l(c.objects,b.entity,c.__meta))}});return e.send()};c.Object.get=function(b,f){b=b||{};g.isString(b)&&this.className&&(b={id:b});this.className&&(b.type=this.className,b.entity=this);if(!b.type)throw Error("Specify type");if(!b.id)throw Error("Specify id to fetch");var e=c.Object._create({__type:b.type,__id:b.id});e.fields=b.fields;return e.fetch(f)};c.Object.prototype.getConnections=function(b){if(this.isNew())throw Error("Cannot fetch connections for new object");
b.objectId=this.get("__id");return new c.Queries.GetConnectionsQuery(b)};c.Object.prototype.getConnectedObjects=function(b){if(this.isNew())throw Error("Cannot fetch connections for new object");b=b||{};g.isString(b)&&(b={relation:b});b.type=this.get("__type");b.objectId=this.get("__id");b.object=this;return new c.Queries.ConnectedObjectsQuery(b)};c.Object.prototype.fetchConnectedObjects=c.Object.prototype.getConnectedObjects;c.Object.findAll=c.Object.findAllQuery=function(b){b=b||{};this.className&&
(b.type=this.className,b.entity=this);return new c.Queries.FindAllQuery(b)};c.Object.saveAll=function(b,f){return c.BaseObject._saveAll(b,f,"Object")}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.utils._extend,b=function(b,f,d){var l={label:b.label};b.objectid&&(l.objectid=b.objectid);if(b.object)b.object instanceof c.Object?b.object.id&&(b.objectid=l.objectid=b.object.id):g.isObject(b.object)&&(b.object.__id&&(b.objectid=l.objectid=b.object.__id),b.object=c.Object._create(b.object)),l.object=b.object.getObject();else if(!l.objectid&&!l.object)throw Error("Incorrectly configured endpoints provided to parseConnection");l.toJSON=function(){var c=
h({},this);if(c.object&&(c.object=b.object.toJSON(),b.object._aclFactory)){var f=b.object._aclFactory.toJSON();f&&(c.object.__acls=f)}delete c.toJSON;return c};d["endpoint"+f]=b;return l},f=function(b,f,d,l){b.object&&g.isObject(b.object)?(l||(d["endpoint"+f]?d["endpoint"+f]&&d["endpoint"+f].object&&d["endpoint"+f].object instanceof c.Object?d["endpoint"+f].object.copy(b.object,!0):d["endpoint"+f].object=c.Object._create(b.object,!0):(d["endpoint"+f]={},d["endpoint"+f].object=c.Object._create(b.object,
!0)),d["endpoint"+f]._aclFactory&&d["endpoint"+f]._aclFactory.merge(),l=d["endpoint"+f].object,l.trigger("change:__id",l,l.id,{})),d["endpoint"+f].objectid=b.objectid||b.object.__id,d["endpoint"+f].label=b.label,d["endpoint"+f].type=b.type):d["endpoint"+f]=b;b.toJSON=function(){var b=h({},this);if(b.object&&(b.object=d["endpoint"+f].object.toJSON(),d["endpoint"+f].object._aclFactory)){var c=d["endpoint"+f].object._aclFactory.toJSON();c&&(b.object.__acls=c)}delete b.toJSON;return b}};c.Connection=
function(b,d){b=b||{};d=d||{};this.className&&(b.__relationtype=this.className);g.isString(b)&&(b={__relationtype:b});if(!b.__relationtype&&!b.relation)throw Error("Cannot set connection without relation");b.relation&&(b.__relationtype=b.relation,delete b.relation);g.isBoolean(d)&&(d={setSnapShot:!0});b.endpoints&&2===b.endpoints.length&&(b.__endpointa=b.endpoints[0],b.__endpointb=b.endpoints[1],delete b.endpoints);c.BaseObject.call(this,b,d);this.type="connection";this.getConnection=this.getObject;
this.parseConnection=function(c){var d="A",k="B";b.__endpointa.label.toLowerCase()!==this.get("__endpointb").label.toLowerCase()||b.__endpointa.label.toLowerCase()==b.__endpointb.label.toLowerCase()||b.__endpointa.objectid!=this.get("__endpointb").objectid&&b.__endpointa.objectid||(d="B",k="A");f(this.get("__endpointa"),d,this,c);f(this.get("__endpointb"),k,this,c);this.endpoints=function(){if(1===arguments.length&&g.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;
if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b};return this};d.setSnapShot?this.parseConnection(b):b.__endpointa&&b.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));this.relationName=b.__relationtype;g.isFunction(this.initialize)&&this.initialize.apply(this,[b]);return this};c.Connection.prototype=new c.BaseObject;c.Connection.prototype.constructor=
c.Connection;c.Connection.extend=function(b,f,d){g.isObject(b)&&(d=f,f=b,b=f.relationName);if(!g.isString(b))throw Error("Appacitive.Connection.extend's first argument should be the relationName.");var h=null;f=f||{};f.className=b;h=c.utils.classExtend(c.Connection,f,d);delete h.extend;h.className=b;h.relation=b;return l[b]=h};var l={},d=function(b){if(!g.isString(b))throw"_getClass requires a string argument.";var f=l[b];f||(f=c.Connection.extend(b),l[b]=f);return f};c.Connection._getClass=d;c.Connection._create=
function(b,c,f){return(new (this.className?this:f?f:d(b.__relationtype))(b)).copy(b,c)};var n=function(b,f,d){var g=[];b||(b=[]);b.forEach(function(b){g.push(c.Connection._create(h(b,{__meta:d}),!0,f))});return g};c.Connection._parseResult=n;c.Connection.prototype.setupConnection=function(c,f){if(!(c&&(c.objectid||c.object)&&c.label&&f&&(f.objectid||f.object)&&f.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",b(c,"A",this),{silent:!0});this.set("__endpointb",
b(f,"B",this),{silent:!0});this.endpoints=function(){if(1===arguments.length&&g.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b}};c.Connection.get=function(b,f){b=b||{};g.isString(b)&&this.className&&(b={id:b});this.className&&(b.relation=this.className,
b.entity=this);if(!b.relation)throw Error("Specify relation");if(!b.id)throw Error("Specify id to fetch");var d=c.Connection._create({__relationtype:b.relation,__id:b.id});d.fields=b.fields;return d.fetch(f)};c.Connection.multiGet=function(b,f){b=b||{};f=f||{};g.isArray(b)&&0<b.length&&(b=b[0]instanceof c.Connection?{ids:b.map(function(b){return b.id}).filter(function(b){return b})}:{ids:b});this.className&&(b.relation=this.className,b.entity=this);if(!b.relation||!g.isString(b.relation)||0===b.relation.length)throw Error("Specify valid relation");
if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var d=new c._Request({method:"GET",type:"connection",op:"getMultiGetUrl",args:[b.relation,b.ids.join(","),b.fields],options:f,onSuccess:function(c){d.promise.fulfill(n(c.connections,b.entity,c.__meta))}});return d.send()};c.Connection.multiDelete=function(b,f){b=b||{};f=f||{};var d=[];this.className&&(b.relation=this.className);g.isArray(b)&&0<b.length&&(b[0]instanceof c.Connection?(d=b,b={relation:d[0].className,ids:d.map(function(b){return b.id}).filter(function(b){return b})}):
b={relation:this.className,ids:b});if(!b.relation||!g.isString(b.relation)||0===b.relation.length)throw Error("Specify valid relation");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var h=new c._Request({method:"POST",data:{idlist:b.ids},type:"connection",op:"getMultiDeleteUrl",args:[b.relation],options:f,onSuccess:function(b){f&&!f.silent&&d.forEach(function(b){b.trigger("destroy",b,b.collection,f)});h.promise.fulfill()}});return h.send()};c.Connection.findAll=c.Connection.findAllQuery=
function(b){b=b||{};this.className&&(b.relation=this.className,b.entity=this);return new c.Queries.FindAllQuery(b)};c.Connection.interconnectsQuery=c.Connection.getInterconnects=function(b){return new c.Queries.InterconnectsQuery(b)};c.Connection.betweenObjectsQuery=c.Connection.getBetweenObjects=function(b){return new c.Queries.GetConnectionsBetweenObjectsQuery(b)};c.Connection.betweenObjectsForRelationQuery=c.Connection.getBetweenObjectsForRelation=function(b){b=b||{};this.className&&(b.relation=
this.className,b.entity=this);return new c.Queries.GetConnectionsBetweenObjectsForRelationQuery(b)};c.Connection.saveAll=function(b,f){return c.BaseObject._saveAll(b,f,"Connection")}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.utils._extend,b=function(b,f){b=b||{};b.__type="user";c.Object.call(this,b,f);return this},f=null;b.currentUser=b.current=function(){return f};var l=function(b,f,d){var h=this.get("__id");if(!h||!g.isString(h)||0===h.length)throw Error("Please specify valid userid");if(!b||!g.isString(b)||0===b.length)throw Error("Please specify valid oldPassword");if(!f||!g.isString(f)||0===f.length)throw Error("Please specify valid newPassword");var l=this,r=new c._Request({method:"POST",
type:"user",op:"getUpdatePasswordUrl",args:[h],options:d,data:{oldpassword:b,newpassword:f},entity:this,onSuccess:function(b){r.promise.fulfill(l)}});return r.send()},d=function(b,f){var d=this.get("__id");if(!this.get("__id"))return this.set("__link",b),c.Promise.buildPromise(f).fulfill(this);var h=this,l=new c._Request({method:"POST",type:"user",op:"getLinkAccountUrl",args:[d],options:f,data:b,entity:this,onSuccess:function(c){c=h.get("__link");g.isArray(c)||(c=c?[c]:[]);c.push(b);h.copy({__link:c},
!0);l.promise.fulfill(h)}});return l.send()};b.setCurrentUser=function(b,d,g){if(!b)throw Error("Cannot set null object as user");var h=b;if(h instanceof c.User)if(h.get("__id")&&0!==h.get("__id").length)b=h.getObject();else throw Error("Specify user __id");else h=new c.User(b,!0);c.LocalStorage.set("Appacitive-User",b);g||(g=864E5);f=h;d&&c.Session.setUserAuthHeader(d,g);f.logout=function(b){return c.Users.logout(b)};f.updatePassword=function(b,c,e){return l.apply(this,[b,c,e])};f.logout=function(b){return c.Users.logout(b)};
c.eventManager.clearAndSubscribe("type.user."+h.get("__id")+".updated",function(b,e){c.LocalStorage.set("Appacitive-User",e.object.getObject())});return f};b.prototype.linkedAccounts=function(){var b=this.get("__link");b?g.isArray(b)||(b=[b]):b=[];return b};b.prototype.getAllLinkedAccounts=function(b){var f=this.get("__id");if(!f||!g.isString(f)||0===f.length)return c.Promise.buildPromise(b).fulfill(this.linkedAccounts(),this);var d=this,h=new c._Request({method:"GET",type:"user",op:"getGetAllLinkedAccountsUrl",
args:[f],options:b,entity:this,onSuccess:function(){var b=a.identities||[];0<b.length?d.set("__link",b):d.set("__link",null);h.promise.fulfill(b,d)}});return h.send()};b.prototype.checkin=function(b,f){var d=this.get("__id");d&&g.isString(d)&&0!==d.length||onSuccess&&g.isFunction(onSuccess)&&onSuccess();if(!(b&&b instanceof c.GeoCoord))throw Error("Invalid coordinates provided");var h=this,l=new c._Request({method:"POST",type:"user",op:"getCheckinUrl",args:[d,b.lat,b.lngerId],options:f,entity:this,
onSuccess:function(){l.promise.fulfill(h)}});return l.send()};b.prototype.linkFacebook=function(b,c){if(!b||!g.isString(b))throw Error("Please provide accessToken");return d.apply(this,[{authtype:"facebook",accesstoken:b,name:"facebook"},c])};b.prototype.linkTwitter=function(b,c){if(!g.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var f={authtype:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret};b.consumerKey&&
b.consumerSecret&&(f.consumersecret=b.consumerSecret,f.consumerkey=b.consumerKey);return d.apply(this,[f,c])};b.prototype.unlink=function(b,f){if(!_.isString(b))throw Error("Specify aouth account type for unlinking");var d=this.get("__id");if(!this.get("__id"))return this.set("__link",null),promise.fulfill(this),promise;var h=this,l=new c._Request({method:"POST",type:"user",op:"getDelinkAccountUrl",args:[d,b],options:f,entity:this,onSuccess:function(c){(c=h.get("__link"))?g.isArray(c)||(c=[c]):c=
[];if(0<=c.length){var f=null;c.forEach(function(c,d){c.name==b.toLowerCase()&&(f=d)});null!=f&&c.splice(f,1);h.copy({__link:c},!0)}else h.copy({__link:[]},!0);l.promise.fulfill(h)}});return l.send()};b.prototype.clone=function(){return new c.User(this.getObject())};c.User=c.Object.extend("user",b.prototype);delete c.User._create;delete c.User._parseResult;delete c.User.multiDelete;b.deleteUser=function(b,f){if(!b)throw Error("Specify userid for user delete");return(new c.Object({__type:"user",__id:b})).destroyWithConnections(f)};
b.deleteCurrentUser=function(b){var d=c.Promise.buildPromise(b);if(null===f)return c.Session.removeUserAuthHeader(),d.fulfill(),d;b=f.get("__id");this.deleteUser(b).then(function(){f=null;c.Session.removeUserAuthHeader();d.fulfill()},function(){d.reject.apply(d,arguments)});return d};b.createNewUser=function(b,f){b=b||{};b.__type="user";if(!b.username||!b.password||!b.firstname||0===b.username.length||0===b.password.length||0===b.firstname.length)throw Error("username, password and firstname are mandatory");
return(new c.User(b)).save(f)};b.createUser=b.createNewUser;b.signup=function(b,f){var d=this,g=c.Promise.buildPromise(f);this.createUser(b).then(function(){d.login(b.username,b.password).then(function(){g.fulfill.apply(g,arguments)},function(b){g.reject.apply(g,arguments)})},function(){g.reject.apply(g,arguments)});return g};b.authenticateUser=function(b,d,l){d=d||{};b.expiry||(b.expiry=864E5);var n=this,q;g.isString(l)&&g.isObject(d.user)&&(b.user=d.user instanceof m.Appacitive.User?d.user.toJSON():
d.user,delete b.user.__meta,q=d.user);var r=new c._Request({method:"POST",type:"user",op:"getAuthenticateUserUrl",options:d,data:b,onSuccess:function(d){d&&d.user?(l&&(d.user.__authType=l),h(d.user,{__meta:d.__meta}),q instanceof m.Appacitive.User&&(d.user=q.copy(d.user,!0)),n.setCurrentUser(d.user,d.token,b.expiry),c.User.trigger("login",f,f,d.token),r.promise.fulfill({user:f,token:d.token})):r.promise.reject(d.status)}});return r.send()};b.login=function(b,c,f){if(!b||!c||0==b.length||0==c.length)throw Error("Please specify username and password");
return this.authenticateUser({username:b,password:c,expiry:864E5},f,"BASIC")};b.loginWithFacebook=function(b,c){if(!b||!g.isString(b))throw Error("Please provide accessToken");c=c||{};var f=!0;0==c.create&&(f=!1);return this.authenticateUser({accesstoken:b,type:"facebook",expiry:864E5,createnew:f},c,"FB")};b.loginWithTwitter=function(b,c){if(!g.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var f=!0;0==c.create&&(f=!1);f={type:"twitter",
oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret,expiry:864E5,createnew:f};b.consumerKey&&b.consumerSecret&&(f.consumersecret=b.consumerSecret,f.consumerkey=b.consumerKey);return this.authenticateUser(f,c,"TWITTER")};b.validateCurrentUser=function(b,f){var d=c.Promise.buildPromise({success:f});f&&g.isBoolean(f)&&(b=f,f=function(){});var h=this,l=function(c){if(c)if(b)d.fulfill(!0);else try{h.getUserByToken(c).then(function(b){h.setCurrentUser(b,c);d.fulfill(!0)},function(){d.fulfill(!1)})}catch(f){d.fulfill(!1)}else d.fulfill(!1)};
c.runtime.isReactNative?c.LocalStorage.get("Appacitive-UserToken").then(function(b){l(b)}):l(c.LocalStorage.get("Appacitive-UserToken"));return d};var n=function(b,f,d){d=d||{};var g=new c._Request({method:"GET",type:"user",op:b,options:d,args:f,onSuccess:function(b){b&&b.user?g.promise.fulfill(new c.User(h(b.user,{__meta:b.__meta}),h(d,{setSnapShot:!0}))):g.promise.reject(b.status)}});return g.send()};b.getUserByToken=function(b,f){if(!b||!g.isString(b)||0===b.length)throw Error("Please specify valid token");
c.Session.setUserAuthHeader(b,0,!0);return n("getUserByTokenUrl",[b],f)};b.getUserByUsername=function(b,c){if(!b||!g.isString(b)||0===b.length)throw Error("Please specify valid username");return n("getUserByUsernameUrl",[b],c)};b.logout=function(b,d){f=null;return c.Session.removeUserAuthHeader(b,d)};b.sendResetPasswordEmail=function(b,f,d){if(!b||!g.isString(b)||0===b.length)throw Error("Please specify valid username");if(!f||!g.isString(f)||0===f.length)throw Error("Plase specify subject for email");
b={username:b,subject:f};d=d||{};g.isString(d.templateName)&&(b.templatename=d.templateName);g.isString(d.resetLink)&&(b.resetlink=d.resetLink);var h=new c._Request({method:"POST",type:"user",op:"getSendResetPasswordEmailUrl",options:d,data:b,onSuccess:function(){h.promise.fulfill()}});return h.send()};b.resetPassword=function(b,f,d){if(!b)throw Error("Please specify token");if(!f||0===f.length)throw Error("Please specify password");var g=new c._Request({method:"POST",type:"user",op:"getResetPasswordUrl",
options:d,data:{newpassword:f},args:[b],onSuccess:function(){g.promise.fulfill()}});return g.send()};b.validateResetPasswordToken=function(b,f){if(!b)throw Error("Please specify token");f=f||{};var d=new c._Request({method:"POST",type:"user",op:"getValidateResetPasswordUrl",options:f,data:{},args:[b],onSuccess:function(b){d.promise.fulfill(new c.User(h(b.user,{__meta:b.__meta}),h(f,{setSnapShot:!0})))}});return d.send()};c.Users=c.User;c.Events.mixin(c.User)})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.utils._extend;c.Collection=function(b,c){c||(c={});c.model&&(this.model=c.model);if(!this.model)throw Error("Please specify model for collection");void 0!==c.comparator&&(this.comparator=c.comparator);c.query&&this.query(c.query);this._reset();this.initialize.apply(this,arguments);b&&this.reset(b,{silent:!0})};c.Events.mixin(c.Collection.prototype);h(c.Collection.prototype,{models:[],initialize:function(){},_query:null,toJSON:function(b){return this.models.map(function(c){return c.toJSON(b)})},
getObject:function(b){return this.models.map(function(c){return c.getObject(b)})},add:function(b,c){c=c||{};var h,d,n,e,k,m={},t={},q=[],r=c.sort,u;b=g.isArray(b)?b.slice():[b];h=0;for(d=b.length;h<d;h++){b[h]=this._prepareModel(b[h]);n=b[h];if(!n)throw Error("Can't add an invalid model to a collection");e=n.cid;if(m[e]||this._byCid[e])throw Error("Duplicate cid: can't add the same model to a collection twice");(k=n.id)&&((u=t[k])||(u=this._byId[k]))?(u.copy(n.getObject(),c.setSnapShot),u.children=
n.children):(t[k]=n,m[e]=n,q.push(n),this._addReference(n,c))}this.models.splice.apply(this.models,[null!=c.at?c.at:this.models.length,0].concat(q));r&&this.comparator&&this.sort({silent:!0});this.length=this.models.length;if(c.silent)return this;h=0;for(d=q.length;h<d;h++)n=q[h],c.index=h,n.trigger("add",n,this,c);return this},remove:function(b,c){var h,d,n,e;c=c||{};b=g.isArray(b)?b.slice():[b];h=0;for(d=b.length;h<d;h++)if(e=this.getByCid(b[h])||this.get(b[h]))delete this._byId[e.id],delete this._byCid[e.cid],
n=this.models.indexOf(e),this.models.splice(n,1),this.length--,c.silent||(c.index=n,e.trigger("remove",e,this,c)),this._removeReference(e);return this},push:function(b,c){return this.add(b,h({at:this.length},c))},pop:function(b){var c=this.at(this.length-1);this.remove(c,b);return c},unshift:function(b,c){return this.add(b,h({at:0},c))},shift:function(b){var c=this.at(0);this.remove(c,b);return c},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(b){return b&&
this._byId[b instanceof c.BaseObject?b.id:b]},query:function(b){if(b)return this._query=b,this;this._query||(this._query=new c.Query(this.model));return this._query},getByCid:function(b){return b&&this._byCid[b.cid||b]},at:function(b){return this.models[b]},where:function(b,c){return Object.isEmpty(b)?c?void 0:[]:this.models[c?"find":"filter"](function(c){for(var f in b)if(b[f]!==c.get(f))return!1;return!0})},findWhere:function(b){return this.where(b,!0)},sort:function(b){b=b||{};if(!this.comparator)throw Error("Cannot sort a set without a comparator");
1===this.comparator.length?this.models=this.models.sortBy(this.comparator):this.models.sort(this.comparator.bind(this.models));b.silent||this.trigger("reset",this,b);return this},pluck:function(b){return this.models.map(function(c){return c.get(b)})},first:function(){return 0<this.length?this.models[0]:null},last:function(){return 0<this.length?this.models[this.length-1]:null},reset:function(b,c){c||(c={});for(var g=0,d=this.models.length;g<d;g++)this._removeReference(this.models[g],c);this._reset();
this.add(b,h({silent:!0},c));c.silent||this.trigger("reset",this,c);return this},fetch:function(b){b=c.utils._clone(b)||{};var f=this,g=this.query()||new c.Query(this.model),d=c.Promise.buildPromise(b);g.fetch(b).then(function(c){0==b.reset?f.add(c,h({setSnapShot:!0},b)):f.reset(c,b);d.fulfill(f)},function(){d.reject.apply(d,arguments)});return d},fetchNext:function(b){var c=this.query().pageNumber();this.query().pageNumber(++c);return this.fetch(b)},fetchPrev:function(b){var c=this.query().pageNumber();
--c;0>=c&&(c=1);this.query().pageNumber(c);return this.fetch(b)},mutiGet:function(b){b=c.utils._clone(b)||{};var f=this,h=c.Promise.buildPromise(b);b=b||{};g.isArray(b)&&(b[0]instanceof c.Object?(models=b,b={ids:models.map(function(b){return b.id}).filter(function(b){return b})}):b={ids:b});var d=b.ids||[];if(0==d.length)return h.fulfill(f);this.model.multiGet({ids:d,fields:b.fields}).then(function(c){b.add?f.add(c,b):f.reset(c,b);h.fulfill(f)},function(){h.reject.apply(h,arguments)});return h},saveAll:function(b){return this.model.saveAll(this.models,
h({},b))},save:function(b){return this.model.saveAll(this.models,h({},b))},create:function(b,f){var g=this;f=f?c.utils._clone(f):{};if(!(b=this._prepareModel(b,f)))return!1;f.wait||this.add(b,f);var d=f.success;f.success=function(){f.wait&&g.add(b,h({setSnapShot:!0},f));d&&d(b,g)};b.save(f);return b},_reset:function(b){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(b){b instanceof c.BaseObject||(b=new this.model(b));b.collection||(b.collection=this);return b},_addReference:function(b){this._byId[b.cid]=
b;null!=b.id&&(this._byId[b.id]=b);b.collection||(b.collection=this);b.on("all",this._onModelEvent,this)},_removeReference:function(b){this===b.collection&&delete b.collection;b.off("all",this._onModelEvent,this)},_onModelEvent:function(b,c,g,d){if("add"!==b&&"remove"!==b||g===this)"destroy"===b&&this.remove(c,d),c&&"change:__id"===b&&(delete this._byId[c.previous(c.idAttribute)],null!=c.id&&(this._byId[c.id]=c)),this.trigger.apply(this,arguments)}});c.Collection.extend=function(b,f){b&&b.query&&
(b._query=b.query,delete b.query);var g=c.utils.classExtend(this,b,f);g.extend=this.extend;return g};"forEach each map find filter every some indexOf lastIndexOf isEmpty difference without reduce".split(" ").each(function(b){c.Collection.prototype[b]=function(){var c=Array.prototype.slice.call(arguments);return Array.prototype[b].apply(this.models,c)}})})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.utils._extend;c.Batch=function(){this.objects=[];this.connections=[];this.objectDeletions=[];this.edgeDeletions=[]};var b=function(b){-1==this.connections.indexOf(b)&&this.connections.push(b)},f=function(b){-1==this.objects.indexOf(b)&&this.objects.push(b)},l=function(b,d,e){var f;if(g.isString(b)){if(f=b,!g.isString(d)&&0<d.trim().length)throw Error("Specify typename as second argument to Batch.removeObjects");}else if(g.isObject(b)&&b instanceof
c.Object){if(b.isNew())return;f=b.id;e=d;d=b.typeName}else throw Error("Batch.removeObjects accepts only Appacitive.Object or ids with typeName");this.objectDeletions.find(function(b){return f==b.id})||this.objectDeletions.push({type:d,id:f,deleteconnections:e})},d=function(b,d){var e;if(g.isString(b)){if(e=b,!g.isString(d)&&0<d.trim().length)throw Error("Specify relationName as second argument to Batch.removeConnections");}else if(g.isObject(b)&&b instanceof c.Connection){if(b.isNew())return;e=b.id;
d=b.relationName}else throw Error("Batch.removeConnection accepts only Appacitive.Connection or ids with relationName");this.edgeDeletions.find(function(b){return e==b.id})||this.edgeDeletions.push({type:d,id:e})},n=function(d){if(g.isObject(d)){if(d instanceof c.Object)return f.apply(this,[d]);if(d instanceof c.Connection)return b.apply(this,[d])}throw Error("Batch accepts only Appacitive.Object and Appacitive.Connection instances");},e=function(){var b=[];this.objects.forEach(function(c,d){var e=
c._findUnsavedChanges();if(e.object){e.object.__type=c.className;var f=b.find(function(b){return c.id&&c.id==b.object.__id||c.cid==b.name});f&&(f.object=e.object,e=f);delete e.isNested;c.isNew()?e.name=""+c.cid:e.object.__id=c.id;f||b.push(e)}});return b},k=function(){var b=this,c=[];this.connections.forEach(function(d){var e=d._findUnsavedChanges().object;e&&(e.__relationtype=d.className,e.__endpointa&&delete e.__endpointa.object,e.__endpointb&&delete e.__endpointb.object);var f=d.endpointA.object;
g.isObject(f)&&(d.isNew()&&(f.isNew()?e.__endpointa.name=""+d.endpointA.object.cid:e.__endpointa.objectid=d.endpointA.object.id),n.apply(b,[f]));f=d.endpointB.object;g.isObject(f)&&(d.isNew()&&(f.isNew()?e.__endpointb.name=""+d.endpointB.object.cid:e.__endpointb.objectid=d.endpointB.object.id),n.apply(b,[f]));if(e){var f=c.find(function(b){return d.id&&d.id==b.connection.__id||d.cid==b.name}),h={connection:e};f&&(f.connection=e,h=f);d.isNew()?h.name=""+d.cid:h.connection.__id=d.id;f||c.push(h)}});
return c};c.Batch.prototype.add=function(){var b=this;g.isArray(arguments[0])?arguments[0].forEach(function(c){n.apply(b,[c])}):n.apply(this,arguments);return this};c.Batch.prototype.removeObjects=function(){var b=this,c=arguments;g.isArray(c[0])?arguments[0].forEach(function(d){l.apply(b,[d,c[1],c[2]])}):l.apply(this,c);return this};c.Batch.prototype.removeConnections=function(){var b=this,c=arguments;g.isArray(c[0])?arguments[0].forEach(function(e){d.apply(b,[e,c[1],c[2]])}):d.apply(this,c);return this};
c.Batch.prototype.toJSON=function(){var b={nodes:[],edges:[],edgedeletions:[],nodedeletions:[]};b.edges=k.apply(this,[]);b.nodes=e.apply(this,[]);b.nodedeletions=this.objectDeletions;b.edgedeletions=this.edgeDeletions;return b};var p=function(b,c,d){var e=this;b.forEach(function(b){var f=b.object;e.objects.forEach(function(e){if(e.cid==b.name||e.id==f.__id||e.get("__id")==f.__id){var g={__meta:c[e.className]};g[e.getType()]=f;e._parseOutput(d,g)}})})},t=function(b,c,d){var e=this;b.forEach(function(b){var f=
b.connection;e.connections.forEach(function(e){if(e.cid==b.name||e.id==f.__id||e.get("__id")==f.__id){var g={__meta:c[e.className]};g[e.getType()]=f;e._parseOutput(d,g)}})})},q=function(b,d){var e;b&&b.edges&&b.nodes&&0<=b.edges.length&&0<=b.nodes.length?(p.call(this,b.nodes,b.__meta.__type,d),t.call(this,b.edges,b.__meta.__rel,d),d.silent||this.trigger("sync",this,{objects:this.objects,connections:this.connections},d)):(b=b||{},b.status=b.status||{},e=(e=b.status)||{},e.message=e.message||"Server error",
e.code=e.code||"500",this._triggerError(d,new c.Error(e)));return e};c.Batch.prototype._triggerError=function(b,c){b.silent||this.trigger("error",this,c,b)};c.Batch.prototype.execute=function(b){var e=this.toJSON();b=h({_batch:!0},b);if(0==e.nodes.length&&0==e.edges.length&&0==e.edgedeletions.length&&0==e.nodedeletions.length)return b.silent||this.trigger("sync",this,{objects:this.objects,connections:this.connections},b),(new c.Promise).fulfill(this);var d=this,f=new c._Request({method:"PUT",type:"multi",
op:"getBatchUrl",data:e,options:b,entity:this,onSuccess:function(c){(c=q.apply(d,[c,b]))?f.promise.reject(c,d):f.promise.fulfill(d)}});return f.send()};c.Events.mixin(c.Batch.prototype)})(global);
(function(m){var c=m.Appacitive;c.Facebook=new function(){var g=null,h=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);h=!0};this.requestLogin=function(b){b=b||{};if(!h)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var f=c.Promise.buildPromise(b);b.scope||(b.scope="email");FB.login(function(b){b&&"connected"===b.status&&b.authResponse?(g=b.authResponse.accessToken,
f.fulfill(b.authResponse)):f.reject()},b);return f};this.getCurrentUserInfo=function(b){if(!h)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");b=b||{};var f=c.Promise.buildPromise(b);FB.api("/me",function(b){b&&!b.error?(g=FB.getAuthResponse().accessToken,f.fulfill(b)):f.reject()});return f};this.accessToken=function(){return 1===arguments.length?(g=arguments[0],this):g};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=
function(b){g=null;b=b||{};var f=c.Promise.buildPromise(b);try{FB.logout(function(){c.Users.logout();f.fulfill()})}catch(h){f.reject(h.message)}return f}}})(global);
(function(m){var c=m.Appacitive;c.Email=new function(){var g={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return g};var h=function(b,f){var g=new c._Request({method:"POST",type:"email",op:"getSendEmailUrl",options:f,data:b,entity:b,onSuccess:function(b){g.promise.fulfill(b.email)}});return g.send()};this.setupEmail=function(b){b=b||{};g.smtp.username=b.username||g.smtp.username;g.from=b.from||g.from;g.smtp.password=
b.password||g.smtp.password;g.smtp.host=b.smtp.host||g.smtp.host;g.smtp.port=b.smtp.port||g.smtp.port;g.smtp.enablessl=b.enableSSL||g.smtp.enablessl;g.replyto=b.replyTo||g.replyto};this.sendTemplatedEmail=function(b,c){if(!b||!b.to||!b.to.length||0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");
if(!b.templateName)throw Error("template name is mandatory to send an email");var l={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){l.smtp=g.smtp;if(!b.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");l.from=b.from||g.from;l.replyto=b.replyTo||g.replyto}return h(l,c)};this.sendRawEmail=function(b,c){if(!b||!b.to||!b.to.length||
0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.body)throw Error("body is mandatory to send an email");var l={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{content:b.body||"",ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){l.smtp=
g.smtp;if(!b.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");l.from=b.from||g.from;l.replyto=b.replyTo||g.replyto}return h(l,c)}}})(global);
(function(m){var c=m.Appacitive;c.Push=new function(){this.send=function(g,h){if(!g)throw Error("Please specify push options");var b=new c._Request({method:"POST",type:"push",op:"getPushUrl",options:h,data:g,entity:g,onSuccess:function(c){b.promise.fulfill(c.id)}});return b.send()};this.getNotification=function(g,h){if(!g)throw Error("Please specify notification id");var b=new c._Request({method:"GET",type:"push",op:"getGetNotificationUrl",args:[g],options:h,onSuccess:function(c){b.promise.fulfill(c.pushnotification)}});
return b.send()};this.getAllNotifications=function(g,h){g?(g.pnum=g.pnum||1,g.psize=g.psize||20):g={pnum:1,psize:20};var b=new c._Request({method:"GET",type:"push",op:"getGetAllNotificationsUrl",args:[g],options:h,onSuccess:function(c){b.promise.fulfill(c.pushnotifications,c.paginginfo)}});return b.send()}}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type;c.File=function(h){h=h||{};this.fileId=h.fileId;this.contentType=h.contentType;this.fileData=h.fileData;var b=this,f=function(e,d,f,g,h){var l=new c.HttpRequest;l.url=e;l.method="GET";l.description=g;l.onSuccess=d;l.promise=f;l.entity=b;l.options=h;c.http.send(l)},l=function(e,d,f,g,h){var l=new c.HttpRequest;l.url=e;l.method="PUT";l.log=!1;l.description="Upload file";l.data=d;l.headers.push({key:"Content-Type",value:f});l.send().then(g,function(c){h.reject(c,
b)})};this.save=function(b,c){"number"!==typeof b&&(c=b,b=-1);return this.fileId&&g.isString(this.fileId)&&0<this.fileId.length?n(b,c):d(b,c)};var d=function(d,h){if(!b.fileData)throw Error("Please specify filedata");if(!b.contentType)try{b.contentType=b.fileData.type}catch(n){}b.contentType&&g.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var m=c.Promise.buildPromise(h),q=c.config.apiBaseUrl+c.storage.urlFactory.file.getUploadUrl(b.contentType,b.fileId?b.fileId:
"");f(q,function(c){l(c.url,b.fileData,b.contentType,function(){b.fileId=c.id;b.getDownloadUrl(d,h).then(function(c){return m.fulfill(c,b)},function(b){return m.reject(b)})},m)},m," Get upload url for file ",h);return m},n=function(d,h){if(!b.fileData)throw Error("Please specify filedata");if(!b.contentType)try{b.contentType=b.fileData.type}catch(m){}b.contentType&&g.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var n=c.Promise.buildPromise(h),q=c.config.apiBaseUrl+
c.storage.urlFactory.file.getUpdateUrl(b.fileId,b.contentType);f(q,function(c){l(c.url,b.fileData,b.contentType,function(){b.getDownloadUrl(d,h).then(function(c){n.fulfill(c,b)},function(b){n.reject(b)})},n)},n," Get update url for file "+b.fileId,h);return n};this.destroy=function(d){if(!this.fileId)throw Error("Please specify fileId to delete");var f=c.Promise.buildPromise(d),g=new c.HttpRequest;g.url=c.config.apiBaseUrl+c.storage.urlFactory.file.getDeleteUrl(this.fileId);g.method="DELETE";g.description=
"Delete file with id "+this.fileId;g.onSuccess=function(b){f.fulfill()};g.promise=f;g.entity=b;g.options=d;return c.http.send(g)};this.getDownloadUrl=function(d,g){if(!this.fileId)throw Error("Please specify fileId to download");"number"!==typeof d&&(g=d,d=-1);var h=c.Promise.buildPromise(g),l=c.config.apiBaseUrl+c.storage.urlFactory.file.getDownloadUrl(this.fileId,d);f(l,function(c){b.url=c.uri;h.fulfill(c.uri)},h," Get download url for file "+this.fileId,g);return h};this.getUploadUrl=function(d){b.contentType&&
g.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var h=c.Promise.buildPromise(d),l=c.config.apiBaseUrl+c.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");f(l,function(c){b.url=c.url;h.fulfill(c.url,b)},h," Get upload url for file "+this.fileId,d);return h}}})(global);
(function(m){var c=m.Appacitive;c.Date={};var g=function(c){return 10>c?"0"+c:c};c.Date.parse=function(c){var b,f=0,g=[1,4,5,6,7,10,11];if(b=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}|\d{7}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(c)){c=0;for(var d;d=g[c];++c)b[d]=+b[d]||0;b[2]=(+b[2]||1)-1;b[3]=+b[3]||1;"Z"!==b[8]&&void 0!==b[9]?(f=60*b[10]+b[11],"+"===b[9]&&(f=0-f)):"Z"==b[8]&&(b[7]=b[7].toString().substring(0,3));b=Date.UTC(b[1],b[2],b[3],b[4],
b[5]+f,b[6],b[7])}else b=Date.parse?Date.parse(c):NaN;return b};c.Date.parseISODate=function(g){try{return new Date(c.Date.parse(g))}catch(b){return null}};c.Date.toISOString=function(c){try{return c=c.toISOString(),c=c.replace("Z","0000Z")}catch(b){return null}};c.Date.toISODate=function(c){if(c instanceof Date)return String.format("{0}-{1}-{2}",c.getFullYear(),g(c.getMonth()+1),g(c.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};c.Date.toISOTime=function(c){var b=
function(b){return 10>b?b+"000000":100>b?b+"00000":1E3>b?b+"0000":1E4>b?b+"000":1E5>b?b+"00":1E6>b?b+"0":b};if(c instanceof Date)return String.format("{0}:{1}:{2}.{3}",g(c.getHours()),g(c.getMinutes()),g(c.getSeconds()),b(c.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};c.Date.parseISOTime=function(c){try{var b=new Date,f=c.split("T");1===f.length&&f.push(f[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(f[1]))return null;var g=f[1].split("Z")[0].split(":"),
d=g[2].split("."),n=Number(g[0]);1<f.length?(b.setUTCHours(Number(n)),b.setUTCMinutes(Number(g[1])),b.setUTCSeconds(Number(d[0])),d[1]&&b.setUTCMilliseconds(Number(d[1].substring(0,3)))):(b.setHours(Number(n)),b.setMinutes(Number(g[1])),b.setSeconds(Number(d[0])),d[1]&&b.setMilliseconds(Number(d[1].substring(0,3))));return b}catch(e){return null}}})(global);
(function(m){var c=m.Appacitive,g=c.utils._type,h=c.runtime.isBrowser&&"object"==typeof window.localStorage&&g.isFunction(window.localStorage.getItem);c.LocalStorage=new function(){var b=h?window.localStorage:{};this.set=function(f,h){h=h||"";if(!g.isString(f))return this;if(g.isObject(h)||g.isArray(h))try{h=JSON.stringify(h)}catch(d){}var n=c.getAppPrefix(f);b[n]=h;return this};this.get=function(f){if(!g.isString(f))return promise.fulfill(null,f);f=c.getAppPrefix(f);(f=h?b.getItem(f):b[f])||(f=null);
if(f&&"{"===f[0])try{f=JSON.parse(f)}catch(l){}return f};this.multiGet=function(){var b=this,c=Array.prototype.slice.call(arguments);if(1<arguments.length){var d={};c.forEach(function(c){Array.isArray(c)&&(c=c.join());c.replace(/\s/g,"").split(",").forEach(function(c){d[c]=b.get(c)})});return d}throw Error("Appacitive.LocalStorage.multiGet requires atleast one argument");};this.remove=function(f){if(!g.isString(f))return this;f=c.getAppPrefix(f);try{delete b[f]}catch(h){}}}})(global);
(function(m){var c=m.Appacitive;m=c.utils._type;"undefined"!=typeof document&&m.isString(document.cookie)&&(c.Cookie=new function(){this.setCookie=function(g,h,b,f){g=c.getAppPrefix(g);var l="";b&&(l=new Date,l.setTime(l.getTime()+6E4*b),l.toGMTString());l=f?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":c.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";b="domain="+window.location.hostname;"localhost"==window.location.hostname&&(b="");document.cookie=g+"="+h+l+"; path=/;"+
b};this.readCookie=function(g){g=c.getAppPrefix(g);g+="=";for(var h=document.cookie.split(";"),b=0;b<h.length;b++){for(var f=h[b];" "==f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(g))return f.substring(g.length,f.length)}return null};this.eraseCookie=function(c){this.setCookie(c,"",-1,!0)}})})(global);"object"===typeof module&&module.exports&&"function"===typeof require&&(module.exports=global.Appacitive);
