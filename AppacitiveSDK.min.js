try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(d,f){Object.defineProperty(this,d,{get:f,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(d,f){Object.defineProperty(this,d,{set:f,enumerable:!0,configurable:!0})}}))}catch(defPropException){}var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var d=function(a){if(!a||!a.send||"function"!=typeof a.send)throw Error("No applicable httpTransport class found");a.onResponse=this.onResponse;var c=[],b={},e=0,d={},f=0;this.addProcessor=function(a){if(a){a.pre=a.pre||function(){};a.post=a.post||function(){};var c=a.pre;e+=1;b[e]=c;a=a.post;f+=1;d[f]=a}};this.enqueueRequest=
function(a){c.push(a)};this.notify=function(){if(0!==c.length){var e=[],j;for(j in d)d.hasOwnProperty(j)&&e.push(d[j]);for(;0<c.length;){var f=c.shift(),k=[];for(j in b)b.hasOwnProperty(j)&&k.push(b[j](f));a.send(f,e,k)}}};this.onResponse=function(a){console.dir(a)}},f=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(){a()};this.onError=function(){a()}},b=null,b=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,
e=function(a,c){if("undefined"!==typeof XDomainRequest)throw Error("Appacitive doesn't support versions of IE6, IE7, IE8, IE9 due to crossdomain calls");if(!a.url)throw Error("Please specify request url");a.method||(a.method="GET");a.headers||(a.headers=[]);var e={};if(c)e=a.data;else try{a.data&&(e=a.data),e=JSON.stringify(e)}catch(d){}if(!a.onSuccess||"function"!=typeof a.onSuccess)a.onSuccess=function(){};if(!a.onError||"function"!=typeof a.onError)a.onError=function(){};var f=new b;f.onreadystatechange=
function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var b=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase())b=c,global.Appacitive.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),c=JSON.parse(b)}catch(e){}a.onSuccess(c,this)}else a.onError({code:this.status,message:this.statusText},this)};f.open(a.method,a.url,!0);for(var k=
0;k<a.headers.length;k+=1)f.setRequestHeader(a.headers[k].key,a.headers[k].value);global.Appacitive.runtime.isBrowser||f.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");f.send(e);return f},a=function(){var a=new f;a.isOnline=function(){return!0};var c=function(c,b,d,h){h||c.headers.push({key:"content-type",value:"application/json"});new e({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(e){try{e=JSON.parse(e)}catch(h){}var f=e;if(b.length!=d.length)throw Error("Callback length and state length mismatch!");
for(var k=0;k<b.length;k+=1)b[k].apply({},[f,d[k]]);a.onResponse(e,c)},onError:function(b){a.onError(c,b)}})};a.send=function(a,g,b){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,g,b)};a.upload=function(a,g,b){"function"==typeof a.beforeSend&&a.beforeSend(a);c(a,g,b,!0)};return a};global.Appacitive.http=new function(){var c=new a,b=new d(c),e=!1;this.pause=function(){e=!0};this.unpause=function(){e=!1};this.addProcessor=
function(a){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw c;if(!a.pre&&!a.post)throw c;b.addProcessor(a)};this.send=function(a){b.enqueueRequest(a);c.isOnline()&&!1==e&&b.notify()};this.flush=function(a){a?b.notify():c.isOnline()&&b.notify()};this.onError=function(a,c){if(a.onError)if(a.context)a.onError.apply(a.context,[c]);else a.onError(c)};c.onError=this.onError;this.onResponse=function(a,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,
[a]);else c.onSuccess(a)};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(a){a=a||{};this.url=a.url||"";this.data=a.data||{};this.headers=a.headers||[];this.method=a.method||"GET";this.onSuccess=a.onSuccess||function(){};this.onError=a.onError||function(){};this.send=function(a){return new e(this,a)}};var c=global;c.Appacitive&&c.Appacitive.http&&(c.Appacitive.http.addProcessor({pre:function(a){return a},post:function(a,b){try{c.Appacitive.Session.isSessionValid(a)?a&&(a.status&&
a.status.code&&"8036"==a.status.code||a.code&&"8036"==a.code)?c.Appacitive.Users.logout(function(){},!0):c.Appacitive.Session.incrementExpiry():(null!=c.Appacitive.Session.get()&&c.Appacitive.Session.resetSession(),c.Appacitive.http.send(b))}catch(e){}}}),c.Appacitive.http.addProcessor({pre:function(){return(new Date).getTime()},post:function(a,c){var b=(new Date).getTime()-c;a._timeTakenInMilliseconds=b}}))})();
(function(d){String.format=function(d,b){if(1>=arguments.length)return d;for(var e=arguments.length-2,a=0;a<=e;a++)d=d.replace(RegExp("\\{"+a+"\\}","gi"),arguments[a+1]);return d};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(d){var b=RegExp("^"+d),e=this;b.test(e)&&(e=e.slice(1,e.length));b=RegExp(d+"$");b.test(e)&&(e=e.slice(0,-1));return e};String.toSearchString=function(d){"undefined"==typeof d&&(d="");for(var b=
"",e=0;e<d.length;e+=1)-1==" .,;#".indexOf(d[e])&&(b+=d[e]);return b=b.toLowerCase()};String.contains=function(d,b){return-1!=d.indexOf(b)};String.startsWith=function(d,b){return 0==d.indexOf(b)};Array.distinct=function(d){var b=[],e=d.length,a,c,g;for(c=0;c<e;c++){a=void 0;for(g=0;g<b.length;g++)if(d[c].toLowerCase()===b[g].toLowerCase()){a=!0;break}a||b.push(d[c])}return b};d.dateFromWcf=function(d,b){var e=/Date\(([^)]+)\)/.exec(d);if(2!=e.length){if(!b)return s;throw Error(s+" is not .net json date.");
}return new Date(parseFloat(e[1]))};d.Appacitive.storage=d.Appacitive.storage||{};d.Appacitive.storage.urlFactory=new function(){d.Appacitive.bag=d.Appacitive.bag||{};var f=function(b){if("object"==typeof b&&0<b.length&&("string"==typeof b[0]||"number"==typeof b[0]))b=b.join(",");b||(b="");return b};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(b){return String.format("{0}/create?fields={1}",
this.userServiceUrl,f(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,f(e))},getUpdateUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,f(e))},getDeleteUrl:function(b){return String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,
b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",
this.userServiceUrl,b)},getDelinkAccountUrl:function(b,e){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,e)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,f(b))},getGetUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,f(e))},getUpdateUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,f(e))},getDeleteUrl:function(b){return String.format("{0}/{1}",
this.deviceServiceUrl,b)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,e,a){var c="",c=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),c=a?c+"?psize="+a:c+"?psize=10";if("undefined"!==typeof e&&0<e.length)for(b=0;b<e.length;b+=1)0!=e[b].trim().length&&(c=c+"&"+e[b]);return c},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,e){return String.format("{0}/search/{1}/all?properties={2}",
this.articleServiceUrl,b,e)},getMultiGetUrl:function(b,e,a){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.articleServiceUrl,b,e,f(a))},getCreateUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,f(e))},getGetUrl:function(b,e,a){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,e,f(a))},getUpdateUrl:function(b,e,a){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,e,f(a))},getDeleteUrl:function(b,e){return String.format("{0}/{1}/{2}",
this.articleServiceUrl,b,e)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,e,a){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,e,f(a))},getMultiGetUrl:function(b,e,a){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,b,e,f(a))},getCreateUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,
b,f(e))},getUpdateUrl:function(b,e,a){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,e,f(a))},getDeleteUrl:function(b,e){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,e)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,e,a,c){var g="",g=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,a,e);if("undefined"!==typeof c&&0<c.length)for(b=
0;b<c.length;b+=1)g=g+"&"+c[b];return g},getConnectedArticles:function(b,e,a){var c="",c=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,b,e);if(a&&a.length&&0<a.length)for(b=0;b<a.length;b+=1)c=0==b?c+("?"+a[b]):c+("&"+a[b]);return c},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,e){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,e)}};this.cannedList={cannedListServiceUrl:"list",
getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b){return String.format("{0}/uploadurl?contenttype={1}&expires=20",
this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,e){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(e))},getDownloadUrl:function(b,e){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,e)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var e=[];return""==location.search||-1==location.search.indexOf("?")?e:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(a,
c){var g=c.split("="),d=g[1];2<g.length&&g.forEach(function(a){0==a||1==a||(d=d+"="+g[a])});g[0].toLowerCase()==b&&(e=[g[0],d])}),e):location.search.split("?")[1].split("=")}}}})(global);
(function(d){d.Appacitive.eventManager=new function(){var d={};this.subscribe=function(b,e){if("string"!=typeof b||"function"!=typeof e)throw Error("Incorrect subscription call");"undefined"==typeof d[b]&&(d[b]=[]);var a;a=function(){return Math.floor(65536*Math.random()).toString(16)};a=a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();d[b].push({callback:e,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var e=-1,a=null,c;for(c in d)for(var g=0;g<d[c].length;g+=1)if(d[c][g].id==b){e=g;
a=c;break}return-1!=e?(d[a].splice(e,1),!0):!1};this.fire=function(b,e,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;if("undefined"!=typeof d.all)for(var c=0;c<d.all.length;c+=1)d.all[c].callback(e,a);c=function(a,c,b){setTimeout(function(){a(c,b)},0)};if("undefined"!=typeof d[b])for(var g=0;g<d[b].length;g+=1)c(d[b][g].callback,e,a)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
d[b]&&(d[b].length=0);return this};this.clearAndSubscribe=function(b,d){this.clearSubscriptions(b);this.subscribe(b,d)};this.dump=function(){console.dir(d)}}})(global);(function(d){d.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"}})(global);
(function(d){d.Appacitive.Session=new function(){this.initialized=!1;var f=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},b=null,e=null,a=null,c=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){d.Appacitive.Session.create(null)};this.create=function(a,c){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var g=new f;g.apikey=e;var m=new d.Appacitive.HttpRequest;m.url=d.Appacitive.config.apiBaseUrl+"application.svc/session";
m.method="put";m.data=g;m.onSuccess=function(g){g&&g.status&&"200"==g.status.code?(b=g.session.sessionkey,d.Appacitive.Session.useApiKey=!1,a&&"function"==typeof a&&a(g),d.Appacitive.Session.onSessionCreated()):c&&"function"==typeof c&&c(g)};m.onError=c;d.Appacitive.http.send(m)};d.Appacitive.http.addProcessor({pre:function(g){d.Appacitive.Session.useApiKey?g.headers.push({key:"appacitive-apikey",value:e}):g.headers.push({key:"appacitive-session",value:b});!0===c&&(1==g.headers.filter(function(a){return"appacitive-user-auth"==
a.key}).length?g.headers.forEach(function(c){"appacitive-user-auth"==c.key&&(c.value=a)}):g.headers.push({key:"appacitive-user-auth",value:a}))}});this.setUserAuthHeader=function(b,g,e){try{b&&(c=!0,a=b,e||(g||(g=60),-1==g&&(g=null),d.Appacitive.runtime.isBrowser&&(d.Appacitive.Cookie.setCookie("Appacitive-UserToken",b,g),d.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",g?g:-1,g))))}catch(f){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(b,g){b&&("function"!=typeof b&&
"boolean"==typeof b)&&(g=b,b=function(){});c=!1;b=b||function(){};d.Appacitive.localStorage.remove("Appacitive-User");d.Appacitive.runtime.isBrowser&&(d.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),d.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(a&&!g)try{var e=new d.Appacitive.HttpRequest;e.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(a);a=null;e.method="POST";e.data={};e.onSuccess=function(){"function"==typeof b&&b()};d.Appacitive.http.send(e)}catch(f){}else a=
null,"function"==typeof b&&b()};this.isSessionValid=function(a){if(!a)return!0;if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){b=null;this.useApiKey=!0};this.get=function(){return b};this.setSession=function(a){a&&(b=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(e=a,this.useApiKey=!0)};var g="sandbox";this.__defineGetter__("environment",function(){return g});
this.__defineSetter__("environment",function(a){"sandbox"!=a&&"live"!=a&&(a="sandbox");g=a})};d.Appacitive.initialize=function(f){if(!d.Appacitive.Session.initialized){if(!f.apikey||0==f.apikey.length)throw Error("apikey is mandatory");d.Appacitive.Session.setApiKey(f.apikey);d.Appacitive.Session.environment=f.env||"sandbox";d.Appacitive.useApiKey=!0;d.Appacitive.Session.initialized=!0;if(f.userToken)-1==f.expiry?f.expiry=null:f.expiry||(f.expiry=3600),d.Appacitive.Session.setUserAuthHeader(f.userToken,
f.expiry),f.user?d.Appacitive.Users.setCurrentUser(f.user):(f=d.Appacitive.localStorage.get("Appacitive-User"))&&d.Appacitive.Users.setCurrentUser(f);else if(d.Appacitive.runtime.isBrowser){var b=d.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(b){var e=d.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");e||(e=60);(f=d.Appacitive.localStorage.get("Appacitive-User"))&&d.Appacitive.Users.setCurrentUser(f,b,e)}}}}})(global);
(function(d){d.Appacitive&&d.Appacitive.http&&d.Appacitive.http.addProcessor({pre:function(f){f.headers.push({key:"appacitive-environment",value:d.Appacitive.Session.environment})}})})(global);
(function(d){d.Appacitive.Queries={};var f=function(a){a=a||{};var c=1,b=200;this.__defineGetter__("pageNumber",function(){return c});this.__defineSetter__("pageNumber",function(a){c=a||1});this.__defineGetter__("pageSize",function(){return b});this.__defineSetter__("pageSize",function(a){b=a||200});this.pageNumber=a.pageNumber;this.pageSize=a.pageSize};f.prototype.toString=function(){return"psize="+this.pageSize+"&pnum="+this.pageNumber};var b=function(a){a=a||{};var c="__UtcLastUpdatedDate",b=!1;
this.__defineGetter__("orderBy",function(){return c});this.__defineSetter__("orderBy",function(a){c=a||"__UtcLastUpdatedDate"});this.__defineGetter__("isAscending",function(){return b});this.__defineSetter__("isAscending",function(a){b="undefined"==typeof a?!1:a});this.orderBy=a.orderBy;this.isAscending=a.isAscending};b.prototype.toString=function(){return"orderBy="+this.orderBy+"&isAsc="+this.isAscending};var e=function(a){var c=a||{},g="",e="",l="",j=a.queryType,m=new f(a),k=new b(a),p=a.schema||
a.relation,n=a.schema?"article":"connection";this.__defineGetter__("type",function(){return n});this.__defineGetter__("entityType",function(){return p});this.__defineGetter__("queryType",function(){return j});this.__defineGetter__("pageQuery",function(){return m});this.__defineGetter__("sortQuery",function(){return k});this.__defineGetter__("filter",function(){return g});this.__defineSetter__("filter",function(a){g=a});this.__defineGetter__("freeText",function(){return e});this.__defineSetter__("freeText",
function(a){"string"==typeof a?e=a:"object"==typeof a&&a.length&&(e=a.join(" "))});this.__defineGetter__("fields",function(){return l});this.__defineSetter__("fields",function(a){"string"==typeof a?l=a:"object"==typeof a&&a.length&&(l=a.join(","))});this.filter=c.filter||"";this.freeText=c.freeText||"";this.fields=c.fields||"";this.setFilter=function(a){this.filter=a};this.setFreeText=function(a){this.freeText=a};this.setFields=function(a){this.fields=a};this.extendOptions=function(a){for(var g in a)c[g]=
a[g];m=new f(c);k=new b(c)};this.getQueryString=function(){var a=this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(a+="&query="+this.filter);this.freeText&&0<this.freeText.trim().length&&(a+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(a+="&fields="+this.fields);return a};this.toUrl=function(){return d.Appacitive.config.apiBaseUrl+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var a=new d.Appacitive.HttpRequest;
a.url=this.toUrl();a.method="get";return a};this.getOptions=function(){var a={},c;for(c in this)this.hasOwnProperty(c)&&"function"!=typeof this[c]&&(a[c]=this[c]);return a};this.fetch=function(a,c){var b=this.toRequest();b.onSuccess=function(b){if(b&&b.status&&"200"==b.status.code){if("function"==typeof a){var g=b[n+"s"],e=[];g||(g=[]);var j="article"==n?"Article":"Connection";g.forEach(function(a){e.push(new d.Appacitive[j](a))});a(e,b.paginginfo)}}else b=b||{},"function"==typeof c&&c(b.status||
{message:"Server error",code:400})};b.onError=function(a){a=a||{};"function"==typeof c&&c(a.status||{message:"Server error",code:400})};d.Appacitive.http.send(b);return this}};d.Appacitive.Queries.BasicFilterQuery=function(a){a=a||{};if(!a.schema&&!a.relation||a.schema&&a.relation)throw Error("Specify either schema or relation for basic filter query");a.queryType="BasicFilterQuery";a=new e(a);a.toRequest=function(){var a=new d.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};a.toUrl=
function(){return d.Appacitive.config.apiBaseUrl+this.type+".svc/"+this.entityType+"/find/all?"+this.getQueryString()};return a};d.Appacitive.Queries.ConnectedArticlesQuery=function(a){a=a||{};if(!a.relation)throw Error("Specify relation for connected articles query");if(!a.articleId)throw Error("Specify articleId for connected articles query");a.schema&&delete a.schema;a.queryType="ConnectedArticlesQuery";var c=new e(a);c.articleId=a.articleId;c.relation=a.relation;c.label="";a.label&&("string"==
typeof a.label&&0<a.label.length)&&(c.label="&label="+a.label);c.toRequest=function(){var a=new d.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};c.toUrl=function(){return d.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return c};d.Appacitive.Queries.GetConnectionsQuery=function(a){a=a||{};if(!a.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!a.articleId)throw Error("Specify articleId for GetConnectionsQuery query");
if(!a.label||0==a.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");a.schema&&delete a.schema;a.queryType="GetConnectionsQuery";var c=new e(a);c.articleId=a.articleId;c.relation=a.relation;c.label=a.label;c.toRequest=function(){var a=new d.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};c.toUrl=function(){return d.Appacitive.config.apiBaseUrl+"connection/"+c.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+c.getQueryString()};return c};
d.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(a,c){a=a||{};if(!a.articleAId||"string"!=typeof a.articleAId||0==a.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!a.articleBId||"string"!=typeof a.articleBId||0==a.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");a.schema&&delete a.schema;a.queryType=c||"GetConnectionsBetweenArticlesQuery";var b=new e(a);b.articleAId=a.articleAId;
b.articleBId=a.articleBId;b.label="GetConnectionsBetweenArticlesForRelationQuery"==b.queryType&&a.label&&"string"==typeof a.label&&0<a.label.length?"&label="+a.label:"";b.relation=a.relation&&"string"==typeof a.relation&&0<a.relation.length?a.relation+"/":"";b.toRequest=function(){var a=new d.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};b.toUrl=function(){return d.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+"?"+this.getQueryString()+
this.label};return b};d.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(a){a=a||{};if(!a.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");a=new d.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a,"GetConnectionsBetweenArticlesForRelationQuery");a.fetch=function(a,b){this.toUrl();var e=this.toRequest();e.onSuccess=function(e){e&&e.status&&"200"==e.status.code?"function"==typeof a&&a(new d.Appacitive.Connection(e.connection)):
(e=e||{},"function"==typeof b&&b(e.status||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof b&&b(a.status||{message:"Server error",code:400})};d.Appacitive.http.send(e);return this};return a};d.Appacitive.Queries.InterconnectsQuery=function(a){a=a||{};if(!a.articleAId||"string"!=typeof a.articleAId||0==a.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!a.articleBIds||"object"!=typeof a.articleBIds||!(0<a.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");
a.schema&&delete a.schema;a.queryType="InterconnectsQuery";var c=new e(a);c.articleAId=a.articleAId;c.articleBIds=a.articleBIds;c.toRequest=function(){var a=new d.Appacitive.HttpRequest;a.url=this.toUrl();a.method="post";a.data={article1id:this.articleAId,article2ids:this.articleBIds};return a};c.toUrl=function(){return d.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return c};d.Appacitive.Queries.GraphQuery=function(a){a=a||{};if(!a.graphQuery)throw Error("graphQuery object is mandatory");
this.toRequest=function(){var c=new d.Appacitive.HttpRequest;c.url=d.Appacitive.config.apiBaseUrl;c.url+=d.Appacitive.storage.urlFactory.article.getProjectionQueryUrl();c.method="post";c.data=a.graphQuery;return c}}})(global);
(function(d){d.Appacitive.BaseObject=function(f,b){var e={},a=function(a,c){for(var b in a)if("string"==typeof a[b])c[b]=a[b];else if("object"==typeof a[b]){c[b]=0<=a[b].length?[]:{};for(var e in a[b])c[b][e]=a[b][e]}else c[b]=a[b]},c={};a(f,c);b&&a(c,e);!e.__id&&c.__id&&(e.__id=c.__id);c.__schematype?(c.__schematype=c.__schematype.toLowerCase(),this.schema=this.entityType=c.__schematype,this.type="user"==c.__schematype||"device"==c.__schematype?c.__schematype:"article"):c.__relationtype&&(c.__relationtype=
c.__relationtype.toLowerCase(),this.relation=this.entityType=c.__relationtype,this.type="connection");var g=parseInt(1E6*Math.random(),10);this.__defineGetter__("cid",function(){return g});var h="__revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),l=["__link","__endpointa","__endpointb"],j=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};this.getObject=
function(){return JSON.parse(JSON.stringify(c))};this.toJSON=function(){return c};this.__defineGetter__("id",function(){return this.get("__id")});this.__defineSetter__("id",function(a){this.set("__id",a)});c.__attributes||(c.__attributes={});e.__attributes||(e.__attributes={});this.attributes=function(){if(0===arguments.length)c.__attributes||(c.__attributes={});else{if(1==arguments.length)return c.__attributes||(c.__attributes={}),c.__attributes[arguments[0]];if(2==arguments.length){if("string"!==
typeof arguments[1]&&null!=arguments[1])throw Error("only string values can be stored in attributes.");c.__attributes||(c.__attributes={});c.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return c.__attributes};var m=function(){var a=!1,b=JSON.parse(JSON.stringify(e.__attributes)),d;for(d in c.__attributes)"undefined"==typeof c.__attributes[d]||null===c.__attributes[d]?(b[d]=null,a=!0):c.__attributes[d]!=
e.__attributes[d]?(b[d]=c.__attributes[d],a=!0):c.__attributes[d]==e.__attributes[d]&&delete b[d];return!a?null:b};this.getChangedAttributes=m;this.aggregates=function(){var a={},b;for(b in c){if(!c.hasOwnProperty(b))return;"$"==b[0]&&(a[b]=c[b])}if(0===arguments.length)return a;if(1==arguments.length)return a[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var k=[];c.__tags||(c.__tags=[]);e.__tags||(e.__tags=[]);this.__defineGetter__("tags",
function(){return!c.__tags?[]:c.__tags});this.addTag=function(a){if(!a||"string"!=typeof a||!a.length)return this;c.__tags.push(a);c.__tags=Array.distinct(c.__tags);if(!k||!k.length)return this;a=k.indexOf(a);-1!=a&&k.splice(a,1);return this};this.removeTag=function(a){if(!a||"string"!=typeof a||!a.length)return this;k.push(a);k=Array.distinct(k);if(!c.__tags||!c.__tags.length)return this;a=c.__tags.indexOf(a);-1!=a&&c.__tags.splice(a,1);return this};var p=function(){var a=[];c.__tags.every(function(c){-1==
e.__tags.indexOf(c)&&a.push(c)});return a};this.getChangedTags=p;this.getRemovedTags=function(){return _removetags};var n=function(a){var b=!1,d=JSON.parse(JSON.stringify(e)),g;for(g in c)"undefined"==typeof c[g]||null===c[g]?(d[g]=null,b=!0):c[g]!=e[g]?"__tags"==g||"__attributes"==g?delete d[g]:(d[g]=c[g],b=!0):c[g]==e[g]&&delete d[g];try{h.forEach(function(a){d[a]&&delete d[a]})}catch(j){}a?(c.__tags&&0<c.__tags.length&&(d.__addtags=p(),b=!0),k&&0<k.length&&(d.__removetags=k,b=!0)):c.__tags&&0<
c.__tags.length&&(d.__tags=p(),b=!0);(a=m())?(d.__attributes=a,b=!0):delete d.__attributes;return b?d:!1};this.__defineGetter__("changed",function(){return n()});this.hasChanged=function(){var a=n(!0);return 0===arguments.length?a?!0:!1:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?!0:!1};this.changedAttributes=function(){var a=n(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var c={};
arguments[0].forEach(function(b){a[b]&&c.push(a[b])});return c}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&arguments[0].length?e[arguments[0]]:null};this.previousAttributes=function(){return e};var q="";this.__defineGetter__("fields",function(){return q});this.__defineSetter__("fields",function(a){"string"==typeof a?q=a:"object"==typeof a&&a.length&&(q=a.join(","))});this.get=function(a){if(a)return c[a]};this.set=function(a,b){if(!a||"string"!=typeof a||
0==a.length)return this;null==b||"undefined"==b?c[a]=null:"string"==typeof b?c[a]=b:"number"==typeof b?c[a]=b+"":"object"==typeof b&&(0<=b.length?c[a]=b:-1!==l.indexOf(a)&&(c[a]=b));return this};this.unset=function(a){if(!a||"string"!=typeof a||0==a.length||0==a.indexOf("__"))return this;try{delete c[a]}catch(b){}return this};this.has=function(a){return!a||"string"!=typeof a||0==a.length?!1:c[a]&&"undefined"!=typeof c[a]?!0:!1};this.isNew=function(){return c.__id&&c.__id.length?!1:!0};this.clone=
function(){return"article"==this.type?new Appacitive.Article(c):new Appacitive.connection(c)};this.copy=function(b){b&&a(b,c);return this};this.save=function(a,b){c.__id?t.apply(this,arguments):r.apply(this,arguments);return this};var r=function(b,g){b=b||function(){};g=g||function(){};var h=this,f=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[this.type].getCreateUrl(c.__schematype||c.__relationtype,q);if(c.__schematype&&("user"==c.__schematype.toLowerCase()||"device"==c.__schematype.toLowerCase()))f=
d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[c.__schematype.toLowerCase()].getCreateUrl();var l=new d.Appacitive.HttpRequest;l.url=f;l.method="put";c.__revision&&delete c.__revision;l.data=c;l.onSuccess=function(f){var l=null;if(f&&(f.article||f.connection||f.user||f.device))l=f.article||f.connection||f.user||f.device;f&&l?(e=l,c.__id=l.__id,a(l,c),h.connectionCollections&&0<h.connectionCollections.length&&h.connectionCollections.forEach(function(a){a.getQuery().extendOptions({articleId:c.__id})}),
"connection"==h.type&&h.parseConnection(),d.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".created",h,{object:h}),"function"==typeof b&&b(h)):(f=f||{},f.status=f.status||{},f.status=j(f.status),d.Appacitive.eventManager.fire((h.schema||h.relation)+"."+h.type+".createFailed",h,{error:f.status}),"function"==typeof g&&g(f.status,h))};l.onError=function(a){a=j(a);"function"==typeof g&&g(a,h)};d.Appacitive.http.send(l);return this},t=function(b,g){b=b||function(){};g=g||function(){};
var h=n(!0),f=this;if(h){var l=new d.Appacitive.HttpRequest,m=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[this.type].getUpdateUrl(c.__schematype||c.__relationtype,e.__id?e.__id:c.__id,q);if(c&&c.__schematype&&("user"==c.__schematype.toLowerCase()||"device"==c.__schematype.toLowerCase()))m=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[c.__schematype.toLowerCase()].getUpdateUrl(e.__id);l.url=m;l.method="post";l.data=h;l.onSuccess=function(h){h&&(h.article||h.connection||
h.user||h.device)?(e=h.article||h.connection||h.user||h.device,a(e,c),k=[],d.Appacitive.eventManager.fire((f.schema||f.relation)+"."+f.type+"."+c.__id+".updated",f,{object:f}),"function"==typeof b&&b(f)):(h=h||{},h.status=h.status||{},h.status=j(h.status),d.Appacitive.eventManager.fire((f.schema||f.relation)+"."+f.type+"."+c.__id+".updateFailed",f,{object:h.status}),"function"==typeof g&&g(h.status,f))};l.onError=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";"function"==
typeof g&&g(a,f)};d.Appacitive.http.send(l)}else"function"==typeof b&&b(f);return this};this.fetch=function(b,g){b=b||function(){};g=g||function(){};if(c.__id){var h=this,f=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[this.type].getGetUrl(c.__schematype||c.__relationtype,c.__id,q),l=new d.Appacitive.HttpRequest;l.url=f;l.method="get";l.onSuccess=function(d){d&&(d.article||d.connection||d.user||d.device)?(e=d.article||d.connection||d.user||d.device,a(e,c),h.___collection&&"article"==
h.___collection.collectionType&&h.___collection.addToCollection(h),"function"==typeof b&&b(h)):(d=d||{},d.status=d.status||{},d.status=j(d),"function"==typeof g&&g(d.status,h))};l.onError=function(a){a=j(a);"function"==typeof g&&g(a,h)};d.Appacitive.http.send(l);return this}"function"==typeof g&&g({code:"400",message:"Please specify id for get operation"},this)};this.del=function(a,b,e){if(!c.__id&&this.___collection)this.___collection.removeByCId(g),"function"==typeof a&&a(this);else{a=a||function(){};
b=b||function(){};var h=this,f=d.Appacitive.config.apiBaseUrl,f=f+d.Appacitive.storage.urlFactory[this.type].getDeleteUrl(c.__schematype||c.__relationtype,c.__id);if(c&&c.__schematype&&("user"==c.__schematype.toLowerCase()||"device"==c.__schematype.toLowerCase()))f=d.Appacitive.config.apiBaseUrl,f+=d.Appacitive.storage.urlFactory[c.__schematype.toLowerCase()].getDeleteUrl(c.__id);e&&!0===e&&(f=-1==f.indexOf("?")?f+"?deleteconnections=true":f+"&deleteconnections=true");e=new d.Appacitive.HttpRequest;
e.url=f;e.method="delete";e.onSuccess=function(d){"200"==d.code?(h.___collection&&h.___collection.removeById(c.__id),"function"==typeof a&&a(d)):(d=j(d),"function"==typeof b&&b(d,h))};e.onError=function(a){a=j(a);"function"==typeof b&&b(a,h)};d.Appacitive.http.send(e)}}};d.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(d){var f=function(){return Math.floor(65536*Math.random()).toString(16)};d.Appacitive.GUID=function(){var b=f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f(),d="",a,c,g,h,l,j,m=0,b=b.replace(/\r\n/g,"\n");c="";for(g=0;g<b.length;g++)h=b.charCodeAt(g),128>h?c+=String.fromCharCode(h):(127<h&&2048>h?c+=String.fromCharCode(h>>6|192):(c+=String.fromCharCode(h>>12|224),c+=String.fromCharCode(h>>6&63|128)),c+=String.fromCharCode(h&63|128));for(b=c;m<b.length;)a=b.charCodeAt(m++),c=b.charCodeAt(m++),
g=b.charCodeAt(m++),h=a>>2,a=(a&3)<<4|c>>4,l=(c&15)<<2|g>>6,j=g&63,isNaN(c)?l=j=64:isNaN(g)&&(j=64),d=d+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j);return d.toString()}})(global);
(function(d){d.Appacitive.ArticleCollection=function(f){var b=null,e=null,a=[],c={};"string"==typeof f?c.schema=f:c=f;this.collectionType="article";if(!c||!c.schema)throw Error("Must provide schema while initializing ArticleCollection.");var b=c.schema,g=this;f=function(a){a.type="article";a.schema?b=a.schema:a.schema=b;e=new d.Appacitive.Queries.BasicFilterQuery(a);c=a;g.extendOptions=e.extendOptions};this.setFilter=function(a){c.filter=a;c.type="article";e?e.filter=a:(e=new d.Appacitive.Queries.BasicFilterQuery(c),
g.extendOptions=e.extendOptions);return this};this.setFreeText=function(a){!a&&0==a.trim().length&&(c.freeText="");c.freeText=a;c.type="article";e?e.freeText=a:(e=new d.Appacitive.Queries.BasicFilterQuery(c),g.extendOptions=e.extendOptions);return this};this.setFields=function(a){a||(c.fields="");c.fields=a;c.type="article";e?e.fields=a:(e=new d.Appacitive.Queries.BasicFilterQuery(c),g.extendOptions=e.extendOptions);return this};this.reset=function(){b=c=null;a.length=0;e=null};this.__defineGetter__("query",
function(){return e});this.getQuery=function(){return e};var h=["BasicFilterQuery"];this.__defineSetter__("query",function(c){if(!c||!c.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==h.indexOf(c.queryType))throw Error("ArticleCollection only accepts "+h.join(", "));a.length=0;e=c});this.setQuery=function(a){this.query=a;return this};this.setOptions=f;f(c);this.get=function(c){if(c!=parseInt(c,10))return null;c=parseInt(c,10);return"number"!=typeof c||c>=a.length?
null:a.slice(c,c+1)[0]};this.addToCollection=function(c){if(!c||c.get("__schematype")!=b)throw Error("Null article passed or schema type mismatch");var d=null;a.forEach(function(a,b){a.get("__id")==c.get("__id")&&(d=b)});null!=d?a.splice(d,1):a.push(c);return this};this.getArticleById=function(c){var b=a.filter(function(a){return a.get("__id")==c});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(a)};this.getAllArticles=function(){return Array.prototype.slice.call(a).map(function(a){return a.getArticle()})};
this.removeById=function(c){if(!c)return!1;var b=null;a.forEach(function(a,d){a.getArticle().__id&&a.getArticle().__id==c&&(b=d)});null!==b&&a.splice(b,1);return this};this.removeByCId=function(c){if(!c)return!1;var b=null;a.forEach(function(a,d){a.cid&&a.cid==c&&(b=d)});null!==b&&a.splice(b,1);return this};this.fetch=function(c,b){c=c||function(){};b=b||function(){};a.length=0;var h=e.toRequest();h.onSuccess=function(e){a:{var h=c;e=e||{};var f=e.articles;if(!f)if(e.status&&e.status.code&&"200"==
e.status.code)f=[];else{h=e.status||{message:"Server error",code:400};"function"==typeof b&&b(h,g);break a}if(!f.length||0===f.length)f=[];f.forEach(function(c){c=new d.Appacitive.Article(c,!0);c.___collection=g;a.push(c)});h(e.paginginfo||{},g)}};h.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof b&&b(a,g)};d.Appacitive.http.send(h);return this};this.fetchByPageNumber=function(a,c,b){e.getOptions().pageQuery.pageNumber=b;this.fetch(a,c);return this};this.fetchNextPage=
function(a,c){e.getOptions().pageQuery.pageNumber+=1;this.fetch(a,c);return this};this.fetchPreviousPage=function(a,c){var b=e.getOptions().pageQuery;b.pageNumber-=1;0===b.pageNumber&&(b.pageNumber=1);this.fetch(a,c);return this};this.createNewArticle=function(c){c=c||{};c.__schematype=b;c=new d.Appacitive.Article(c);c.___collection=g;a.push(c);return c};this.map=function(){return a.map.apply(this,arguments)};this.forEach=function(){return a.forEach.apply(this,arguments)};this.filter=function(){return a.filter.apply(this,
arguments)}};d.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};d.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};d.Appacitive.ArticleCollection.prototype.__defineGetter__("articles",function(){return this.getAll()});d.Appacitive.ArticleCollection.prototype.__defineGetter__("length",function(){return this.articles.length})})(global);
(function(d){d.Appacitive.ConnectionCollection=function(f){var b=null,e=null,a=[],c=[],g={};"string"==typeof f?g.relation=f:g=f;this.collectionType="connection";var h=this;if(!f||!f.relation)throw Error("Must provide relation while initializing ConnectionCollection.");b=f.relation;f=function(a){a.type="connection";a.relation?b=a.relation:a.relation=b;e=new d.Appacitive.Queries.BasicFilterQuery(a);g=a;return h};this.setFilter=function(a){g.filter=a;g.type="connection";e?e.filter=a:(e=new d.Appacitive.Queries.BasicFilterQuery(g),
h.extendOptions=e.extendOptions);return this};this.setFreeText=function(a){!a&&0==a.trim().length&&(g.freeText="");g.freeText=a;g.type="connection";e?e.freeText=a:(e=new d.Appacitive.Queries.BasicFilterQuery(g),h.extendOptions=e.extendOptions);return this};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";e?e.fields=a:(e=new d.Appacitive.Queries.BasicFilterQuery(g),h.extendOptions=e.extendOptions);return this};this.__defineGetter__("query",function(){return e});this.getQuery=
function(){return e};var l=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.__defineSetter__("query",function(b){if(!b||!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==l.indexOf(b.queryType))throw Error("ConnectionCollection only accepts "+l.join(", "));c.length=0;a.length=0;e=b});this.setQuery=function(a){this.query=a;return this};this.reset=function(){b=g=null;c.length=0;a.length=
0;e=null};this.setOptions=f;f(g);this.get=function(c){if(c!=parseInt(c,10))return null;c=parseInt(c,10);return"number"!=typeof c||c>=a.length?null:a.slice(c,c+1)[0]};this.addToCollection=function(c){if(!c||c.get("__relationtype")!=b)throw Error("Null connection passed or relation type mismatch");var d=null;a.forEach(function(a,b){a.get("__id")==c.get("__id")&&(d=b)});null!==d?a.splice(d,1):a.push(c);return this};this.getConnection=function(c){var b=a.filter(function(a){return a.get("__id")==c});return 1==
b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(a)};this.getAllConnections=function(){return Array.prototype.slice.call(a).map(function(a){return a.getConnection()})};this.removeById=function(c){if(!c)return!1;var b=null;a.forEach(function(a,d){a.getConnection().__id&&a.getConnection().__id==c&&(b=d)});null!==b&&a.splice(b,1);return this};this.removeByCId=function(c){if(!c)return!1;var b=null;a.forEach(function(a,d){a.cid&&a.cid==c&&(b=d)});null!==b&&a.splice(b,1);return this};
this.getConnectedArticle=function(a){if(!c||0===c.length)return null;var b=c.filter(function(c){return c.get("__id")==a});return 0<b.length?b[0]:null};this.fetch=function(b,g){b=b||function(){};g=g||function(){};a.length=0;var f=e.toRequest();f.onSuccess=function(f){a:{var l=b;f=f||{};var k=f.connections;"GetConnectionsBetweenArticlesForRelationQuery"==e.queryType&&f.connection&&(k=[f.connection]);if(!k)if(f.status&&f.status.code&&"200"==f.status.code)k=[];else{l=f.status||{message:"Server error",
code:400};"function"==typeof g&&g(l,h);break a}if(!k.length||0===k.length)k=[];k.forEach(function(b){b=new d.Appacitive.Connection(b,!0);b.___collection=h;if(b.endpointA.article||b.endpointB.article){var g=b.endpointA.article||b.endpointB.article;g.___collection=h;c.push(g)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(e){}a.push(b)});l(f.paginginfo||{},h)}};f.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof g&&g(a)};d.Appacitive.http.send(f);return this};
this.fetchByPageNumber=function(a,c,b){e.getOptions().pageQuery.pageNumber=b;this.fetch(a,c);return this};this.fetchNextPage=function(a,c){e.getOptions().pageQuery.pageNumber+=1;this.fetch(a,c);return this};this.fetchPreviousPage=function(a,c){var b=e.getOptions().pageQuery;b.pageNumber-=1;0===b.pageNumber&&(b.pageNumber=1);this.fetch(a,c);return this};this.createNewConnection=function(c){c=c||{};c.__relationtype=b;c=new d.Appacitive.Connection(c);c.___collection=h;a.push(c);return c};this.map=function(){return a.map.apply(this,
arguments)};this.forEach=function(c,b){return a.forEach(c,b||this)};this.filter=function(){return a.filter.apply(this,arguments)}}})(global);
(function(d){var f=function(b,e){b=b||function(){};e=e||function(){};var a=new d.Appacitive.HttpRequest;a.method="get";a.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var d=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(d=a[0].username));null!==d?FB.api("/"+d,function(a){a?b(a):e()}):e({code:"404",message:"fb account not found"})};
a.onError=e;d.Appacitive.http.send(a)};d.Appacitive.Article=function(b,e){b=b||{};"string"==typeof b&&(b={__schematype:b});if(!b.__schematype&&!b.schema)throw Error("Cannot set article without __schematype");b.schema&&(b.__schematype=b.schema,delete b.schema);d.Appacitive.BaseObject.call(this,b,e);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=f);return this};d.Appacitive.Article.prototype=new d.Appacitive.BaseObject;
d.Appacitive.Article.prototype.constructor=d.Appacitive.Article;d.Appacitive.Article.prototype.getConnections=function(b){if("article"!=this.type)return null;b=b||{};b.articleId=this.get("__id");var e=new d.Appacitive.ConnectionCollection({relation:b.relation});this.connectionCollections.push(e);e.query=new d.Appacitive.Queries.GetConnectionsQuery(b);return e};d.Appacitive.Article.prototype.getConnectedArticles=function(b){b=b||{};"string"==typeof b&&(rName=b,b={relation:rName});b.articleId=this.get("__id");
var e=new d.Appacitive.ConnectionCollection({relation:b.relation});e.connectedArticle=this;this.connectionCollections.push(e);e.query=new d.Appacitive.Queries.ConnectedArticlesQuery(b);return e};d.Appacitive.Article.multiDelete=function(b,e,a){b=b||{};if(!b.schema||"string"!=typeof b.schema||0==b.schema.length)throw Error("Specify valid schema");if("user"==b.schema.toLowerCase()||"device"==b.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(b.ids&&0<b.ids.length){e=
e||function(){};a=a||function(){};var c=new d.Appacitive.HttpRequest;c.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(b.schema);c.method="post";c.data={idlist:b.ids};c.onSuccess=function(c){c&&"200"==c.code?"function"==typeof e&&e():(c=c||{},"function"==typeof a&&a(c.status||{message:"Server error",code:400}))};c.onError=function(c){c=c||{};"function"==typeof a&&a(c.status||{message:"Server error",code:400})};d.Appacitive.http.send(c)}else e()};d.Appacitive.Article.multiGet=
function(b,e,a){b=b||{};if(!b.schema||"string"!=typeof b.schema||0==b.schema.length)throw Error("Specify valid schema");if(b.ids&&0<b.ids.length){var c=new d.Appacitive.HttpRequest;c.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(b.schema,b.ids.join(","),b.fields);c.method="get";c.onSuccess=function(c){if(c&&c.articles){if("function"==typeof e){var b=[];c.articles.forEach(function(a){b.push(new d.Appacitive.Article(a))});e(b,c.paginginfo)}}else c=c||{},"function"==
typeof a&&a(c.status||{message:"Server error",code:400})};c.onError=function(c){c=c||{message:"Server error",code:400};"function"==typeof a&&a(c)};d.Appacitive.http.send(c)}else"function"==typeof e&&e([])};d.Appacitive.Article.get=function(b,e,a){b=b||{};if(!b.schema)throw Error("Specify schema");if(!b.id)throw Error("Specify id to fetch");var c={},c="user"==b.schema.toLowerCase()?new d.Appacitive.User({__id:b.id}):new d.Appacitive.Article({__schematype:b.schema,__id:b.id});c.fields=b.fields;c.fetch(e,
a);return c}})(global);
(function(d){var f=function(a,c,b){var e={label:a.label};a.articleid&&(e.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?e.articleid=a.article.get("__id"):e.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?e.articleid=a.article.__id:e.article=a.article,a.article=new d.Appacitive.Article(a.article));else if(!e.articleid&&!e.article)throw Error("Incorrectly configured endpoints provided to setupConnection");b["endpoint"+
c]=a;return e},b=function(a,c,b){a.article&&"object"==typeof a.article?(b["endpoint"+c]?b["endpoint"+c]&&b["endpoint"+c].article&&b["endpoint"+c].article.getArticle?b["endpoint"+c].article.copy(a.article):b["endpoint"+c].article=new d.Appacitive.Article(a.article):(b["endpoint"+c]={},b["endpoint"+c].article=new d.Appacitive.Article(a.article)),b["endpoint"+c].articleid=a.articleid,b["endpoint"+c].label=a.label,b["endpoint"+c].type=a.type,b["endpoint"+c].article.___collection=b.___collection):b["endpoint"+
c]=a};d.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw new error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);d.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var c="A",d="B";
if(a.__endpointa.label==this.get("__endpointb").label&&a.__endpointa.label!=a.__endpointb.label&&(a.__endpointa.articleid==this.get("__endpointb").articleid||!a.__endpointa.articleid))c="B",d="A";b(this.get("__endpointa"),c,this);b(this.get("__endpointb"),d,this);this.__defineGetter__("endpoints",function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a});return this};c?(this.__defineGetter__("connectedArticle",function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var c=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==a&&(c=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(c)}),this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};d.Appacitive.Connection.prototype=new d.Appacitive.BaseObject;d.Appacitive.Connection.prototype.constructor=
d.Appacitive.Connection;d.Appacitive.Connection.prototype.setupConnection=function(a,c){if(!a||!a.articleid&&!a.article||!a.label||!c||!c.articleid&&!c.article||!c.label)throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",f(a,"A",this));this.set("__endpointb",f(c,"B",this))};d.Appacitive.Connection.get=function(a,c,b,e){options=options||{};if(!options.relation)throw Error("Specify relation");if(!options.id)throw Error("Specify id to fetch");a=new d.Appacitive.Connection({__relationtype:options.relation,
__id:options.id});a.fields=options.fields;a.fetch(b,e)};var e=function(a,c,b){a.onSuccess=function(a){if(a&&a.status&&"200"==a.status.code){if("function"==typeof c){var e=a.connections,f=[];e||(e=[]);e.forEach(function(a){f.push(new d.Appacitive.Connection(a))});c(f,a.paginginfo)}}else a=a||{},"function"==typeof b&&b(a.status||{message:"Server error",code:400})};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof b&&b(a)};d.Appacitive.http.send(a)};d.Appacitive.Connection.multiGet=
function(a,c,b,f){options=options||{};if(!options.relation||"string"!=typeof options.relation||0==options.relation.length)throw Error("Specify valid relation");if(options.ids&&0<options.ids.length)return a=new d.Appacitive.HttpRequest,a.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(options.relation,options.ids.join(","),options.fields),a.method="get",e(a,b,f);"function"==typeof b&&b([])};d.Appacitive.Connection.multiDelete=function(a,c,b){a=a||{};if(!a.relation||
"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var e=new d.Appacitive.HttpRequest;e.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);e.method="post";e.data={idlist:a.ids};e.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof b&&b(a||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"==typeof b&&b(a||{message:"Server error",
code:400})};d.Appacitive.http.send(e)}else c()};d.Appacitive.Connection.getInterconnects=function(a,c,b){a=new Appacitive.Queries.InterconnectsQuery(a);e(a.toRequest(),request,c,b)};d.Appacitive.Connection.getBetweenArticles=function(a,c,b){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);e(a.toRequest(),c,b)};d.Appacitive.Connection.getBetweenArticlesForRelation=function(a,c,b){a=(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).toRequest();a.onSuccess=function(a){a&&
a.status&&"200"==a.status.code?"function"==typeof c&&(a=a.connection?new d.Appacitive.Connection(a.connection):null,"function"==typeof c&&c(a)):(a=a||{},"function"==typeof b&&b(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{};"function"==typeof b&&b(a.status||{message:"Server error",code:400})};d.Appacitive.http.send(a)}})(global);
(function(d){d.Appacitive.Users=new function(){var f=null;this.__defineGetter__("currentUser",function(){return f});var b=function(a,c,b,e){b=b||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:a,name:"facebook"};a=c.get("__id");if(c.get("__id")){var j=new d.Appacitive.HttpRequest;j.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getLinkAccountUrl(a);j.method="post";j.data=f;j.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"==typeof b&&
b(c)):e(a,c)};j.onError=e;d.Appacitive.http.send(j)}else c.set("__link",f),"function"==typeof b&&b(c)},e=function(a,c,b,e){b=b||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var j=new d.Appacitive.HttpRequest;j.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,a);j.method="post";j.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",null),"function"==typeof b&&b(c)):e(a,c)};j.onError=e;d.Appacitive.http.send(j)}else"function"==typeof b&&
b(c)};this.setCurrentUser=function(a,c,g){if(!a||"object"!=typeof a||0<=a.length)throw Error("Cannot set null object as user");var h=a;a.getArticle||(h=new d.Appacitive.User(a,!0));if(!h.get("__id")||0==h.get("__id").length)throw Error("Specify user __id");d.Appacitive.localStorage.set("Appacitive-User",a);g||(g=60);f=h;c&&d.Appacitive.Session.setUserAuthHeader(c,g);f.logout=function(a){d.Appacitive.Users.logout(a)};f.updatePassword=function(a,c,b,e){var g=this,f=b,h=e;b=g.get("__id");if(!b||"string"!==
typeof b||0==b.length)throw Error("Please specify valid userid");if(!a||"string"!==typeof a||0==a.length)throw Error("Please specify valid oldPassword");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid newPassword");f=f||function(){};h=h||function(){};a==c?"function"==typeof f&&f(g):(a={oldpassword:a,newpassword:c},c=new d.Appacitive.HttpRequest,c.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(b),c.method="post",c.data=a,c.onSuccess=
function(a){a&&"200"==a.code&&("function"==typeof f?f(g):h(a,g))},c.onError=h,d.Appacitive.http.send(c));return this};f.linkFacebookAccount=function(a,c){var e=function(){b(Appacitive.Facebook.accessToken,f,function(c){d.Appacitive.eventManager.fire("user..article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c)};Appacitive.Facebook.getCurrentUserInfo(function(){e()},function(){Appacitive.Facebook.requestLogin(function(){e()},c)});return this};f.unlinkFacebookAccount=function(a,
c){e("facebook",this,function(c){d.Appacitive.eventManager.fire("user.article."+c.get("__id")+".updated",c,{object:c});"function"==typeof a&&a(c)},c);return this};f.logout=function(a){Appacitive.Users.logout(a)};d.Appacitive.eventManager.clearAndSubscribe("user.article."+h.get("__id")+".updated",function(a,c){d.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return f};d.Appacitive.User=function(a){a=a||{};a.__schematype="user";d.Appacitive.Article.call(this,a);return this};
d.Appacitive.User.prototype=new d.Appacitive.Article("user");d.Appacitive.User.prototype.constructor=d.Appacitive.User;d.Appacitive.User.prototype.__defineGetter__("linkedAccounts",function(){var a=this.get("__link");a?"object"==typeof a&&!(0<=a.length)?a=[a]:0<=a.length||(a=a[0]):a=[];return a});d.Appacitive.User.prototype.getAllLinkedAccounts=function(a,c){a=a||function(){};var b=this,e=this,f=function(c){"function"==typeof a&&a(c,b)},j=c,m=e.get("__id");(!m||"string"!==typeof m||0==m.length)&&
"function"==typeof f&&f(e.linkedAccounts,e);var f=f||function(){},j=j||function(){},k=new d.Appacitive.HttpRequest;k.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(m);k.method="get";k.onSuccess=function(a){a&&a.status&&"200"==a.status.code?(a=a.identities||[],0<a.length?e.set("__link",a):e.set("__link",null),"function"==typeof f&&f(a,e)):j(a.status,e)};k.onError=j;d.Appacitive.http.send(k);return this};d.Appacitive.User.prototype.linkFacebookAccount=
function(a,c,d){b(a,this,c,d);return this};d.Appacitive.User.prototype.unlinkFacebookAccount=function(a,c){var b=this;e("facebook",this,function(){var c=b.get("__link");c?0<=c.length||(c=[c]):c=[];0<c.length&&"facebook"==c[0].name&&b.set("__link",null);"function"==typeof a&&a(b)},c);return this};d.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(a,c,b){if(!a)throw Error("Specify userid for user delete");(new d.Appacitive.Article({__schematype:"user",
__id:a})).del(c||function(){},b||function(){})};this.deleteCurrentUser=function(a,c){a=a||function(){};if(null===f)throw Error("Current user is not yet set for delete operation");var b=f.get("__id");this.deleteUser(b,function(c){d.Appacitive.Session.removeUserAuthHeader();"function"==typeof a&&a(c)},c)};this.createUser=this.createNewUser=function(a,c,b){a=a||{};a.__schematype="user";if(!a.username||!a.password||!a.firstname||0==a.username.length||0==a.password.length||0==a.firstname.length)throw Error("username, password and firstname are mandatory");
(new d.Appacitive.User(a)).save(c,b)};this.signup=function(a,c,b){var d=this;this.createUser(a,function(){d.login(a.username,a.password,c,b)},function(a){b(a)})};this.authenticateUser=function(a,c,b,e){c=c||function(){};b=b||function(){};a.expiry||(a.expiry=864E5);var f=this,j=new d.Appacitive.HttpRequest;j.method="post";j.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();j.data=a;j.onSuccess=function(d){d&&d.user?(e&&(d.user.__authType=e),f.setCurrentUser(d.user,
d.token,a.expiry),c({user:f.currentUser,token:d.token})):(d=d||{},b(d.status))};j.onError=b;d.Appacitive.http.send(j)};this.login=function(a,c,b,d){if(!a||!c||0==a.length||0==c.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:c,expiry:864E5},b||function(){},d||function(){},"BASIC")};this.loginWithFacebook=function(a,c,b){a=a||function(){};c=c||function(){};var e=this,f=function(){e.authenticateUser({accesstoken:d.Appacitive.Facebook.accessToken,
type:"facebook",expiry:864E5,createnew:!0},function(b){b.user?(b.user.__authType="FB","function"==typeof a&&a({user:e.currentUser,token:b.token})):(b=b||{},"function"==typeof c&&c(b.status))},c,"FB")};b?f():FB?Appacitive.Facebook.requestLogin(function(){f()},c):"function"==typeof c&&c()};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});var b=d.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!b)return"function"==typeof a&&a(!1),!1;if(c)return"function"==typeof a&&a(!0),!0;try{var e=new d.Appacitive.HttpRequest;e.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getValidateTokenUrl(b);e.method="POST";e.data={};e.onSuccess=function(c){"function"==typeof a&&a(c.result)};d.Appacitive.http.send(e)}catch(f){a(!1)}};this.sendResetPasswordEmail=function(a,c,b,e){b=b||function(){};e=e||function(){};if(!a||"string"!=typeof a||0==a.length)throw Error("Please specify valid username");
if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");a={username:a,subject:c};c=new d.Appacitive.HttpRequest;c.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=a;c.onSuccess=function(a){a&&"200"==a.code&&("function"==typeof b?b():e(a))};c.onError=e;d.Appacitive.http.send(c)};this.logout=function(a,c){f=null;d.Appacitive.Session.removeUserAuthHeader(a||function(){},c)}}})(global);
(function(d){d.Appacitive.Email=new function(){var f={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return f};var b=function(b,a,c){var f=new d.Appacitive.HttpRequest;f.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.email.getSendEmailUrl();f.method="post";f.data=b;f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?a(b.email):(b=b||{},b.status=b.status||{},c(b.status.message||"Server error"))};
d.Appacitive.http.send(f)};this.setupEmail=function(b){b=b||{};f.smtp.username=b.username||f.smtp.username;f.from=b.from||f.from;f.smtp.password=b.password||f.smtp.password;f.smtp.host=b.smtp.host||f.smtp.host;f.smtp.port=b.smtp.port||f.smtp.port;f.smtp.enablessl=b.enableSSL||f.smtp.enablessl;f.replyto=b.replyTo||f.replyto};this.sendTemplatedEmail=function(d,a,c){a=a||function(){};c=c||function(){};if(!d||!d.to||!d.to.length||0==d.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!d.subject||0==d.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!d.from&&f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!d.templateName)throw Error("template name is mandatory to send an email");var g={to:d.to||[],cc:d.cc||[],bcc:d.bcc||[],subject:d.subject,body:{templatename:d.templateName||"",data:d.data||{},ishtml:!1==d.isHtml?!1:!0}};if(d.useConfig){g.smtp=f.smtp;if(!d.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=d.from||f.from;g.replyto=d.replyTo||f.replyto}b(g,a,c)};this.sendRawEmail=function(d,a,c){a=a||function(){};c=c||function(){};if(!d||!d.to||!d.to.length||0==d.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!d.subject||0==d.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!d.body)throw Error("body is mandatory to send an email");var g={to:d.to||[],cc:d.cc||[],bcc:d.bcc||[],subject:d.subject,body:{content:d.body||"",ishtml:!1==d.isHtml?
!1:!0}};if(d.useConfig){g.smtp=f.smtp;if(!d.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=d.from||f.from;g.replyto=d.replyTo||f.replyto}b(g,a,c)}}})(global);
(function(d){var f=function(){var b=require("facebook-node-sdk"),d=null,a=this.FB=null,c=!0;this.initialize=function(d){if(!b)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!d.appId)throw Error("Please provide appid");if(!d.appSecret)throw Error("Please provide app secret");a=d.appSecret;this.FB=new b({appId:_appId,secret:a});c=!0};this.requestLogin=function(a,b,f){c?(d=accesstoken,FB.setAccessToken(f),Appacitive.Users.loginWithFacebook(a,b,!0)):"function"==typeof b&&
b("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(a,b){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&d?(a=a||function(){},b=b||function(){},this.FB.api("/me",function(c,d){d?"function"==typeof a&&a(d):"function"==typeof b&&b("Access token is invalid")})):b("Either intialize facebook with your appid and appsecret or set accesstoken")};this.__defineGetter__("accessToken",function(){return d});this.__defineSetter__("accessToken",
function(a){console.log(a);d=a;this.FB&&this.FB.setAccessToken(a)});this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a){a=a||function(){};Appacitive.facebook.accessToken="";"function"==typeof a&&a()}};d.Appacitive.Facebook=d.Appacitive.runtime.isBrowser?new function(){var b=null,d=!0;this.initialize=function(a){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!a.appId)throw Error("Please provide appid");FB.init(a);
d=!0};this.requestLogin=function(a,c){if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");a=a||function(){};c=c||function(){};FB.login(function(d){d&&"connected"===d.status&&d.authResponse?(b=d.authResponse.accessToken,"function"==typeof a&&a(d.authResponse)):"function"==typeof c&&c()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(a,c){if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");a=a||function(){};
c=c||function(){};FB.api("/me",function(d){d&&!d.error?(b=FB.getAuthResponse().accessToken,"function"==typeof a&&a(d)):"function"==typeof c&&c()})};this.__defineGetter__("accessToken",function(){return b});this.__defineSetter__("accessToken",function(a){b=a});this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,c){a=a||function(){};c=c||function(){};Appacitive.facebook.accessToken="";try{FB.logout(function(){Appacitive.Users.logout();"function"==
typeof a&&a()})}catch(b){"function"==typeof c&&c(b.message)}}}:new f})(global);
(function(d){d.Appacitive.Push=new function(){this.send=function(f,b,e){b=b||function(){};e=e||function(){};if(!f)throw Error("Please specify push options");var a=new d.Appacitive.HttpRequest;a.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();a.method="post";a.data=f;a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?b(a.id):(a=a||{},a.status=a.status||{},e(a.status.message||"Server error"))};a.onError=function(a){e(a||"Server error")};d.Appacitive.http.send(a)};
this.getNotification=function(f,b,e){b=b||function(){};e=e||function(){};if(!f)throw Error("Please specify notification id");var a=new d.Appacitive.HttpRequest;a.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(f);a.method="get";a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?b(a.pushnotification):(a=a||{},a.status=a.status||{},e(a.status.message||"Server error"))};a.onError=function(a){e(a||"Server error")};d.Appacitive.http.send(a)};this.getAllNotifications=
function(f,b,e){b=b||function(){};e=e||function(){};f?(f.pnum=f.pnum||1,f.psize=f.psize||20):f={pnum:1,psize:20};var a=new d.Appacitive.HttpRequest;a.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(f);a.method="get";a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?b(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},e(a.status.message||"Server error"))};a.onError=function(a){e(a||"Server error")};d.Appacitive.http.send(a)}}})(global);
(function(d){d.Appacitive.File=function(f){f=f||{};this.fileId=f.fileId;this.contentType=f.contentType;this.fileData=f.fileData;var b=function(a,b,c){var e=new d.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=b;e.onError=c;d.Appacitive.http.send(e)},e=function(a,b,c,e,f){(new FormData).append("fileToUpload",b);var k=new d.Appacitive.HttpRequest;k.url=a;k.method="PUT";k.data=b;k.headers.push({key:"content-type",value:c});k.onSuccess=e;k.onError=f;k.send(!0)};this.save=function(b,d,e){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?c(this,b,d,e):a(this,b,d,e)};var a=function(a,c,f,j){if(!a.fileData)throw Error("Please specify filedata");if(j||"string"==typeof j)a.contentType=j;else{if(!a.contentType||"string"!==typeof j||0==a.contentType.length)a.contentType="text/plain";try{a.contentType=file.type}catch(m){}}j=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);c=c||function(){};f=f||function(){};b(j,function(b){b&&b.status&&"200"==
b.status.code?e(b.url,a.fileData,a.contentType,function(){a.fileId=b.id;a.getDownloadUrl(function(b){c(b,a)},f)},f):"function"==typeof f&&f(b.status,a)},f);return this},c=function(a,c,f,j){if(!a.fileData)throw Error("Please specify filedata");if(j||"string"==typeof j)a.contentType=j;else{if(!a.contentType||"string"!==typeof j||0==a.contentType.length)a.contentType="text/plain";try{a.contentType=file.type}catch(m){}}j=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);c=c||function(){};f=f||function(){};b(j,function(b){b&&b.status&&"200"==b.status.code?e(b.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(b){c(b,a)},f)},f):"function"==typeof f&&f(b.status,a)},f);return this};this.deleteFile=function(a,b){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};b=b||function(){};var c=new d.Appacitive.HttpRequest;c.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
c.method="DELETE";c.onSuccess=function(c){c&&"200"==c.code?"function"==typeof a&&a():"function"==typeof b&&"function"==typeof b&&b(c,that)};c.onError=b;d.Appacitive.http.send(c);return this};this.getDownloadUrl=function(a,b){if(!this.fileId)throw Error("Please specify fileId to download");var c=this;a=a||function(){};b=b||function(){};var e=new d.Appacitive.HttpRequest;e.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(d){d&&d.status&&"200"==d.status.code?(c.url=d.uri,"function"==typeof a&&a(d.uri)):"function"==typeof b&&"function"==typeof b&&b(d.status,c)};e.onError=b;d.Appacitive.http.send(e);return this}}})(global);
(function(d){d.Appacitive.Date={};d.Appacitive.Date.parseISODate=function(d){try{var b=new Date(d);if(isNaN(b)){var e=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,a=!1;if(!e.exec(d))if(e=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,e.exec(d))a=!0;else return null;var c=d.split("T"),g=c[0].split("-"),h=c[1].split("Z")[0].split(":"),l=h[2].split("."),j=Number(h[0]),b=new Date;b.setUTCFullYear(Number(g[0]));b.setUTCMonth(Number(g[1])-1);b.setUTCDate(Number(g[2]));
a||(b.setUTCHours(Number(j)),b.setUTCMinutes(Number(h[1])),b.setUTCSeconds(Number(l[0])),l[1]&&b.setUTCMilliseconds(Number(l[1])))}return b}catch(m){return null}};d.Appacitive.Date.toISOString=function(d){try{return d=d.toISOString(),d=d.replace("Z","0000Z")}catch(b){return null}};d.Appacitive.Date.toISODate=function(d){try{return d=d.toISOString()[0]}catch(b){return null}};d.Appacitive.Date.toISOTime=function(d){try{return d=d.toISOString().split("T")[1],d=d.replace("Z","0000Z")}catch(b){return null}};
d.Appacitive.Date.parseISOTime=function(d){try{var b=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(d))return null;var e=d.split("T");1==e.length&&e.push(e[0]);var a=e[1].split("Z")[0].split(":"),c=a[2].split(".");b.setUTCHours(Number(Number(a[0])));b.setUTCMinutes(Number(a[1]));b.setUTCSeconds(Number(c[0]));c[1]&&b.setUTCMilliseconds(Number(c[1]));return b}catch(g){return null}}})(global);
(function(d){d.Appacitive.localStorage=new function(){var f=d.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(b,d){d=d||"";if(!b)return!1;if("object"==typeof d)try{d=JSON.stringify(d)}catch(a){}f[b]=d;return!0};this.get=function(b){if(!b)return null;b=f.getItem(b);if(!b)return null;if("{"==b[0])try{b=JSON.parse(b)}catch(d){}return b};this.remove=function(b){if(b)try{delete f[b]}catch(d){}}}})(global);
(function(d){d.Appacitive.runtime.isBrowser&&(d.Appacitive.Cookie=new function(){this.setCookie=function(d,b,e,a){if(e){var c=new Date;c.setTime(c.getTime()+6E4*e);c="; expires="+c.toGMTString()}a||(c="");document.cookie=d+"="+b+c+"; path=/;"+("domain="+window.location.hostname)};this.readCookie=function(d){d+="=";for(var b=document.cookie.split(";"),e=0;e<b.length;e++){for(var a=b[e];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(d))return a.substring(d.length,a.length)}return null};
this.eraseCookie=function(d){this.setCookie(d,"",-1,!0)}})})(global);"undefined"!=typeof module&&!global.Appacitive.runtime.isBrowser&&(module.exports=global.Appacitive);