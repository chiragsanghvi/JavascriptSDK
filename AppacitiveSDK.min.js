"bind"in Function.prototype||(Function.prototype.bind=function(b){var d=this;if(1>=arguments.length)return function(){return d.apply(b,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return d.apply(b,0===arguments.length?c:c.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,d){void 0===d&&(d=0);0>d&&(d+=this.length);0>d&&(d=0);for(var c=this.length;d<c;d++)if(d in this&&this[d]===b)return d;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,d){void 0===d&&(d=this.length-1);0>d&&(d+=this.length);d>this.length-1&&(d=this.length-1);for(d++;0<d--;)if(d in this&&this[d]===b)return d;return-1});
"forEach"in Array.prototype||(Array.prototype.forEach=function(b,d){for(var c=0,e=this.length;c<e;c++)c in this&&b.call(d,this[c],c,this)});"map"in Array.prototype||(Array.prototype.map=function(b,d){for(var c=Array(this.length),e=0,f=this.length;e<f;e++)e in this&&(c[e]=b.call(d,this[e],e,this));return c});"filter"in Array.prototype||(Array.prototype.filter=function(b,d){for(var c=[],e,f=0,h=this.length;f<h;f++)f in this&&b.call(d,e=this[f],f,this)&&c.push(e);return c});
"every"in Array.prototype||(Array.prototype.every=function(b,d){for(var c=0,e=this.length;c<e;c++)if(c in this&&!b.call(d,this[c],c,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=function(b,d){for(var c=0,e=this.length;c<e;c++)if(c in this&&b.call(d,this[c],c,this))return!0;return!1});"find"in Array.prototype||(Array.prototype.find=function(b,d){var c=this.length;if(0!==c)for(var e=0,f;e<c&&e in this;e++)if(f=this[e],b.call(d,f,e,this))return f});
"each"in Array.prototype||(Array.prototype.each=function(b,d){for(var c=0;c<this.length;c++)b.apply(d,[this[c]])});var _lookupIterator=function(b,d){return null==b?_.identity:_.isFunction(b)?d?function(){return b.apply(d,arguments)}:b:function(c){return c[b]}};Array.prototype.pluck=function(b){var d=[];this.each(function(c){d.push(c[b])});return d};
Array.prototype.sortBy=function(b,d){b=_lookupIterator(b,d);return this.map(function(c,e){return{value:c,criteria:b.call(d,c,e,this)}},this).sort(function(c,b){var f=c.criteria,d=b.criteria;return f<d?-1:f>d?1:0}).pluck("value")};
Date.prototype.toISOString||function(){function b(b){b=String(b);1===b.length&&(b="0"+b);return b}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();
String.addSlashes=function(b){if(!b)return b;b=b.replace(/\\/g,"\\\\");b=b.replace(/\'/g,"\\'");b=b.replace(/\"/g,'\\"');return b=b.replace(/\0/g,"\\0")};String.stripSlashes=function(b){if(!b)return b;b=b.replace(/\\'/g,"'");b=b.replace(/\\"/g,'"');b=b.replace(/\\0/g,"\x00");return b=b.replace(/\\\\/g,"\\")};if("undefined"===typeof console||null===console)console={log:function(){},dir:function(){}};
for(var _type=function(b){if(null===b||"undefined"===typeof b||"undefined"===b)return"null";if(b&&(1===b.nodeType||9===b.nodeType))return"element";var d=Object.prototype.toString.call(b).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===d){if(isNaN(b))return"nan";if(!isFinite(b))return"infinity"}return d},types="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),generateMethod=function(b){_type["is"+b]=function(d){return _type(d)===b.toLowerCase()}},
i=0;i<types.length;i++)generateMethod(types[i]);_type.isNullOrUndefined=function(b){return"null"==_type(b)||"undefined"==_type(b)};_type.isNumeric=function(b){return!isNaN(parseFloat(b))&&isFinite(b)};var _clone=function(b){return _type.isObject(b)?_type.isArray(b)?b.slice():_extend({},b):b};Array.prototype.removeAll=function(b){for(var d=null,c=0;c<this.length;c++)for(;this[c]===b;)d=this.splice(c,1)[0];return d};
Array.prototype.compare=function(b){if(!b||this.length!=b.length)return!1;for(var d=0,c=this.length;d<c;d++)if(this[d]instanceof Array&&b[d]instanceof Array){if(!this[d].compare(b[d]))return!1}else if(this[d]!=b[d])return!1;return!0};
Array.prototype.equals=function(b,d){if(!b)return!1;1==arguments.length&&(d=!1);if(this.length!=b.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&b[c]instanceof Array){if(!this[c].equals(b[c],d))return!1}else{if(d&&this[c]!=b[c])return!1;if(!d)return this.sort().equals(b.sort(),!0)}return!0};var global={};
(function(){global="undefined"===typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var b=function(c){if(c&&c.send&&_type.isFunction(c.send))c.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var b=[],e={},f=0,d={},h=0;this.addProcessor=function(c){c&&(c.pre=c.pre||function(){},c.post=c.post||function(){},q(c.pre),r(c.post))};var q=function(c){f+=1;e[f]=c;return f},
r=function(c){h+=1;d[h]=c;return h};this.enqueueRequest=function(c){b.push(c)};this.changeRequestForCors=function(c){var b={m:c.method.toUpperCase()};c.headers.forEach(function(c){b[c.key]=c.value});c.prevHeaders=c.headers;c.headers=[];c.headers.push({key:"Content-Type",value:"text/plain; charset=utf-8"});c.method="POST";c.data&&(b.b=c.data);delete c.data;global.Appacitive.config.debug&&(-1===c.url.indexOf("?")?c.url+="?debug=true":c.url+="&debug=true");try{c.data=JSON.stringify(b)}catch(k){}return c};
this.notify=function(){if(0!==b.length){var f=[],h;for(h in d)d.hasOwnProperty(h)&&f.push(d[h]);for(;0<b.length;){var p=b.shift(),n=[];for(h in e)e.hasOwnProperty(h)&&n.push(e[h](p));this.changeRequestForCors(p);c.send(p,f,n)}}};this.onResponse=function(c){console.dir(c)}},d=function(){var c=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=c;this.onResponse=function(b,e){c()};this.onError=function(b){c()}},c=null,c=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest,
e=function(c){var b=global.Appacitive.Promise.buildPromise({success:c.onSuccess,error:c.onError}),e=new XDomainRequest;e.onload=function(){var c=e.responseText;try{var k=e.contentType;if("application/json"==k.toLowerCase()||"application/javascript"==k.toLowerCase()||"application/json; charset=utf-8"==k.toLowerCase()||"application/json; charset=utf-8;"==k.toLowerCase())k=c,global.Appacitive.runtime.isBrowser||"{"!=k[0]&&(k=k.substr(1,k.length-1)),c=JSON.parse(k)}catch(f){}b.fulfill(c,this)};e.onerror=
e.ontimeout=function(){b.reject(e)};e.onprogress=function(){};-1===c.url.indexOf("?")?c.url+="?ua=ie":c.url+="&ua=ie";e.open(c.method,c.url,!0);e.send(c.data);return b},f=function(b){if(!b.url)throw Error("Please specify request url");b.method||(b.method="GET");b.headers||(b.headers=[]);var f={};b.onSuccess&&_type.isFunction(b.onSuccess)||(b.onSuccess=function(){});b.onError&&_type.isFunction(b.onError)||(b.onError=function(){});var d=global.Appacitive.Promise.buildPromise({success:b.onSuccess,error:b.onError}),
h=!0;b.headers.forEach(function(c){"content-type"==c.key.toLowerCase()&&(h=!0,"application/json"==c.value.toLowerCase()||"application/javascript"==c.value.toLowerCase()||"application/json; charset=utf-8"==c.value.toLowerCase()||"application/json; charset=utf-8;"==c.value.toLowerCase())&&(h=!1)});if(h)f=b.data;else if(b.data&&(f=b.data,_type.isObject(b.data)))try{f=JSON.stringify(f)}catch(g){}if(!global.navigator||-1==global.navigator.userAgent.indexOf("MSIE 8")&&-1==global.navigator.userAgent.indexOf("MSIE 9")){var p=
new c;p.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var c=this.responseText;try{var b=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase()||"application/json; charset=utf-8"==b.toLowerCase()||"application/json; charset=utf-8;"==b.toLowerCase())b=c,global.Appacitive.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),c=JSON.parse(b)}catch(e){}d.fulfill(c,
this)}else d.reject(this)};p.open(b.method,b.url,!0);for(var q=0;q<b.headers.length;q+=1)p.setRequestHeader(b.headers[q].key,b.headers[q].value);global.Appacitive.runtime.isBrowser||p.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");p.send(f);return d}b.data=f;return new e(b)},h=function(){var c=new d;c.isOnline=function(){return!0};var b=function(b,e,d){new f({method:b.method,url:b.url,headers:b.headers,data:b.data,onSuccess:function(f,l){if(f){try{f=JSON.parse(f)}catch(h){}var t=f;if(e.length!=
d.length)throw Error("Callback length and state length mismatch!");for(var u=0;u<e.length;u+=1)e[u].apply({},[t,d[u]]);if(200<=f.code&&300>=f.code||f.status&&200<=f.status.code&&300>=f.status.code)c.onResponse(b,f);else f=f||{},f=f.status||f,f.message=f.message||"Bad Request",f.code=f.code||"400",c.onError(b,{responseText:JSON.stringify(f)})}else c.onError(b,{responseText:JSON.stringify({code:"400",message:"Invalid request"})})},onError:function(f){var e={};e.message=f.responseText||"Bad Request";
e.code=f.status||"400";c.onError(b,{responseText:JSON.stringify(e)})}})};c.send=function(c,f,e){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");_type.isFunction(c.beforeSend)&&c.beforeSend(c);b(c,f,e)};return c};global.Appacitive.http=new function(){var c=new h,f=new b(c),e=!1;this.pause=function(){e=!0};this.unpause=function(){e=!1};this.addProcessor=function(c){var b=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!c)throw b;
if(!c.pre&&!c.post)throw b;f.addProcessor(c)};this.send=function(b){b.promise=global.Appacitive.Promise.is(b.promise)?b.promise:new global.Appacitive.Promise.buildPromise({error:b.onError});f.enqueueRequest(b);c.isOnline()&&!1===e&&f.notify();return b.promise};this.flush=function(b){b?f.notify():c.isOnline()&&f.notify()};this.onError=function(c,b){var f;if(b&&b.responseText)try{f=JSON.parse(b.responseText)}catch(e){}else b={responseText:""};f=f||{code:b.status,message:b.responseText,referenceid:b.headers.TransactionId};
global.Appacitive.logs.logRequest(c,f,f,"error");c.promise.reject(f,c.entity)};c.onError=this.onError;this.onResponse=function(c,b){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[b]);else c.onSuccess(b);global.Appacitive.logs.logRequest(c,b,b?b.status:null,"successful")};c.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(c){c=c||{};this.url=c.url||"";this.data=c.data||{};this.headers=c.headers||[];this.method=c.method||"GET";this.onSuccess=c.onSuccess||function(){};this.onError=
c.onError||function(){};this.send=function(c){return new f(this,c)}};(function(c){c.Appacitive&&c.Appacitive.http&&(c.Appacitive.http.addProcessor({pre:function(c){return c},post:function(b,f){try{var e=c.Appacitive.Session.isSessionValid(b);e.status?b&&(b.status&&b.status.code&&("19036"==b.status.code||"421"==b.status.code)||b.code&&("19036"==b.code||"421"==b.code))?c.Appacitive.Users.logout():c.Appacitive.Session.incrementExpiry():e.isSession&&(null!==c.Appacitive.Session.get()&&c.Appacitive.Session.resetSession(),
c.Appacitive.http.send(f))}catch(d){}}}),c.Appacitive.http.addProcessor({pre:function(c){return{start:(new Date).getTime(),request:c}},post:function(c,b){b.request.timeTakenInMilliseconds=(new Date).getTime()-b.start}}))})(global)})(this);
(function(b){b.Appacitive.logs={};var d=function(c,b){setTimeout(function(){try{c.call({},b)}catch(f){}},0)};b.Appacitive.logs.logRequest=function(c,e,f,h){e=e||{};f=f||{};var k={};try{k=JSON.parse(c.data),_type.isObject(k)||(k={})}catch(l){}var m={status:h,referenceId:f.referenceid,date:(new Date).toISOString(),method:k.m,url:decodeURIComponent(c.url),responseTime:c.timeTakenInMilliseconds,headers:{},request:null,response:e,description:c.description};c.headers&&c.headers.forEach(function(c){m.headers[c.key]=
c.value});c.prevHeaders&&c.prevHeaders.forEach(function(c){m.headers[c.key]=c.value});"GET"!==m.method&&(m.request=k.b);"error"==h&&(b.Appacitive.runtime.isBrowser&&console.dir(m),_type.isFunction(b.Appacitive.logs.apiErrorLog)&&d(b.Appacitive.logs.apiErrorLog,m));_type.isFunction(b.Appacitive.logs.apiLog)&&d(b.Appacitive.logs.apiLog,m)};b.Appacitive.logs.logException=function(c){_type.isFunction(b.Appacitive.logs.exceptionLog)&&d(b.Appacitive.logs.exceptionLog,c)}})(global);
(function(b){String.format=function(b,c){if(1>=arguments.length)return b;for(var e=arguments.length-2,f=0;f<=e;f++)b=b.replace(RegExp("\\{"+f+"\\}","gi"),arguments[f+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var c=RegExp("^"+b),e=this;c.test(e)&&(e=e.slice(1,e.length));c=RegExp(b+"$");c.test(e)&&(e=e.slice(0,-1));return e};String.toSearchString=function(b){"undefined"===typeof b&&(b="");for(var c=
"",e=0;e<b.length;e+=1)-1===" .,;#".indexOf(b[e])&&(c+=b[e]);return c=c.toLowerCase()};String.contains=function(b,c){return-1!==b.indexOf(c)};String.startsWith=function(b,c){return 0===b.indexOf(c)};Array.distinct=function(b){var c=[],e=b.length,f,h,k;for(h=0;h<e;h++){f=void 0;for(k=0;k<c.length;k++)if(b[h].toLowerCase()===c[k].toLowerCase()){f=!0;break}f||c.push(b[h])}return c};Object.isEmpty=function(b){if(!b)return!0;var c=!0,e;for(e in b){c=!1;break}return c};b.dateFromWcf=function(b,c){var e=
/Date\(([^)]+)\)/.exec(b);if(2!=e.length){if(!c)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(e[1]))};b.Appacitive.storage=b.Appacitive.storage||{};b.Appacitive.storage.urlFactory=new function(){b.Appacitive.bag=b.Appacitive.bag||{};var d=function(c){"object"===typeof c&&(0<c.length&&("string"===typeof c[0]||"number"===typeof c[0]))&&(c=c.join(","));c||(c="");return c};this.application={applicationServiceUrl:"application",getSessionCreateUrl:function(){return String.format("{0}/session",
this.applicationServiceUrl)}};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(c,b){return String.format("{0}/create?fields={1}",this.userServiceUrl,d(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(c,b,f){return String.format("{0}/{1}?fields={2}",c,b,d(f))},getUserByTokenUrl:function(c){return String.format("{0}/me?useridtype=token&token={1}",
this.userServiceUrl,c)},getUserByUsernameUrl:function(c){return String.format("{0}/{1}?useridtype=username",this.userServiceUrl,c)},getUpdateUrl:function(c,b,f){return f?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,c,d(b),f):String.format("{0}/{1}?fields={2}",this.userServiceUrl,c,d(b))},getDeleteUrl:function(c,b,f){return!0===f?String.format("{0}/{1}?deleteconnections=true",this.userServiceUrl,b):String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(c){return String.format("{0}/{1}/linkedaccounts",
this.userServiceUrl,c)},getValidateTokenUrl:function(c){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,c)},getInvalidateTokenUrl:function(c){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,c)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(c){return String.format("{0}/{1}/changepassword",this.userServiceUrl,c)},getLinkAccountUrl:function(c){return String.format("{0}/{1}/link",
this.userServiceUrl,c)},getDelinkAccountUrl:function(c,b){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,c,b)},getCheckinUrl:function(c,b,f){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,c,b,f)},getResetPasswordUrl:function(c){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,c)},getValidateResetPasswordUrl:function(c){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,c)}};this.device={deviceServiceUrl:"device",
getCreateUrl:function(c,b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,d(b))},getGetUrl:function(c,b,f){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,d(f))},getUpdateUrl:function(c,b,f){return f?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,c,d(b),f):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,c,d(b))},getDeleteUrl:function(c,b,f){return!0===f?String.format("{0}/{1}?deleteconnections=true",this.deviceServiceUrl,b):String.format("{0}/{1}",
this.deviceServiceUrl,b)}};this.object={objectServiceUrl:"object",getSearchAllUrl:function(c,b,f){var d="",d=String.format("{0}/search/{1}/all",this.objectServiceUrl,c),d=f?d+"?psize="+f:d+"?psize=10";if("undefined"!==typeof b&&0<b.length)for(c=0;c<b.length;c+=1)0!==b[c].trim().length&&(d=d+"&"+b[c]);return d},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.objectServiceUrl)},getPropertiesSearchUrl:function(c,b){return String.format("{0}/search/{1}/all?properties={2}",
this.objectServiceUrl,c,b)},getMultiGetUrl:function(c,b,f){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.objectServiceUrl,c,b,d(f))},getCreateUrl:function(c,b){return String.format("{0}/{1}?fields={2}",this.objectServiceUrl,c,d(b))},getGetUrl:function(c,b,f){return String.format("{0}/{1}/{2}?fields={3}",this.objectServiceUrl,c,b,d(f))},getUpdateUrl:function(c,b,f,h){return h?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.objectServiceUrl,c,b,d(f),h):String.format("{0}/{1}/{2}?fields={3}",
this.objectServiceUrl,c,b,d(f))},getDeleteUrl:function(c,b,f){return!0===f?String.format("{0}/{1}/{2}?deleteconnections=true",this.objectServiceUrl,c,b):String.format("{0}/{1}/{2}",this.objectServiceUrl,c,b)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.objectServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,e,f){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,e,d(f))},getMultiGetUrl:function(b,e,f){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.connectionServiceUrl,b,e,d(f))},getCreateUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,d(e))},getUpdateUrl:function(b,e,f,h){return h?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,b,e,d(f),h):String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,e,d(f))},getDeleteUrl:function(b,e){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,e)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,e,f,d){var k="",k=String.format("{0}/{1}/find/all?label={2}&objectid={3}",this.connectionServiceUrl,b,f,e);if("undefined"!==typeof d&&0<d.length)for(b=0;b<d.length;b+=1)k=k+"&"+d[b];return k},getConnectedArticles:function(b,e,f){var d="",d=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,b,e);if(f&&f.length&&0<f.length)for(b=0;b<f.length;b+=1)d=0===b?d+("?"+f[b]):d+("&"+f[b]);return d},getInterconnectsUrl:function(){return String.format("{0}/interconnects",
this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,e){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,e)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,
b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b,e){return e&&0<e.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",this.fileServiceUrl,escape(b),escape(e)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,e){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,b,escape(e))},getDownloadUrl:function(b,e){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,e)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var e=[];return""===location.search||-1===location.search.indexOf("?")?e:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(f,d){var k=d.split("="),l=k[1];2<k.length&&k.forEach(function(b,c){0!==b&&1!==b&&(l=l+"="+
k[b])});k[0].toLowerCase()===b&&(e=[k[0],l])}),e):location.search.split("?")[1].split("=")}}}})(global);
(function(b){var d;d=b.Appacitive.runtime.isNode?process.nextTick:setTimeout;var c=function(){if(!(this instanceof c))return new c;this.calls=[]};c.prototype.isResolved=function(){return 1===this.state?!0:!1};c.prototype.isRejected=function(){return 2===this.state?!0:!1};c.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};c.prototype.done=function(){var e,f,d=this.state,k=this.value;if(!d)return this;for(;e=this.calls.shift();)if(f=e[0],"function"===typeof e[d]){try{k=
e[d].apply(f,this.value)}catch(l){b.Appacitive.logs.logException({name:l.name,message:l.message,stack:l.stack});if(0==f.calls.length)throw l;f.reject(l)}k instanceof c||c.is(k)?k.then(function(b){f.fulfill(b)},function(b){f.reject(b)}):1===d?f.fulfill(k):f.reject(k)}else 1===d?f.fulfill(k):f.reject(k)};c.prototype.fulfill=function(){if(this.state)return this;this.state=1;this.value=arguments;this.done();return this};c.prototype.resolve=c.prototype.fulfill;c.prototype.reject=function(){if(this.state)return this;
this.state=2;this.reason=this.value=arguments;this.done();return this};c.prototype.then=function(b,f){var h=this,k=new c;this.calls[this.calls.length]=[k,b,f];this.state&&d(function(){h.done()});return k};c.when=function(b){var f=[],h=[],k,l=0,m=new c;if(!b)return m.fulfill(f),m;var n=function(){l+=1;l==k&&(m.state||(0<h.length?m.reject(h,f?f:[]):m.fulfill(f?f:[])))},g=function(k){var l=b[k];l instanceof c||l&&"function"===typeof l.then?d(function(){l.then(function(b){f[k]=b;n()},function(b){h[k]=
b;n()})}):d(function(){try{f[k]=l.call()}catch(b){h[k]=b}n()})};Array.isArray(b)||(b=[b]);k=b.length;for(var p=0;p<k;p+=1)g(p);return m};c.is=function(b){return b instanceof c?!0:!1};c.buildPromise=function(b){var f=new c;_type.isObject(b)&&f.then(b.success,b.error);return f};b.Appacitive.Promise=c})(global);
(function(b){b.Appacitive.eventManager=new function(){function b(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var c={};this.subscribe=function(e,f){if("string"!=typeof e||"function"!=typeof f)throw Error("Incorrect subscription call");"undefined"==typeof c[e]&&(c[e]=[]);var h=b();c[e].push({callback:f,id:h});return h};this.unsubscribe=function(b){if(!b)return!1;var f=-1,d=null,k;for(k in c)for(var l=0;l<c[k].length;l+=
1)if(c[k][l].id==b){f=l;d=k;break}return-1!=f?(c[d].splice(f,1),!0):!1};this.fire=function(b,f,d){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof d||null===d)d={};d.eventName=b;if("undefined"!=typeof c.all)for(var k=0;k<c.all.length;k+=1)c.all[k].callback(f,d);k=function(b,c,f){setTimeout(function(){b(c,f)},0)};if("undefined"!=typeof c[b])for(var l=0;l<c[b].length;l+=1)k(c[b][l].callback,f,d)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
c[b]&&(c[b].length=0);return this};this.clearAndSubscribe=function(b,c){this.clearSubscriptions(b);this.subscribe(b,c)};this.dump=function(){console.dir(c)}}})(global);
(function(b){var d={},c=Array.prototype.forEach,e=Object.prototype.hasOwnProperty,f=Array.prototype.slice,h=0,k=function(){return{keys:Object.keys,uniqueId:function(b){var c=++h+"";return b?b+c:c},has:function(b,c){return e.call(b,c)},each:function(b,f,k){if(null!=b)if(c&&b.forEach===c)b.forEach(f,k);else if(b.length===+b.length)for(var e=0,l=b.length;e<l&&f.call(k,b[e],e,b)!==d;e++);else for(e in b)if(this.has(b,e)&&f.call(k,b[e],e,b)===d)break},once:function(b){var c=!1,f;return function(){if(c)return f;
c=!0;f=b.apply(this,arguments);b=null;return f}}}}(),l;l={on:function(b,c,f){if(!n(this,"on",b,[c,f])||!c)return this;this._events||(this._events={});(this._events[b]||(this._events[b]=[])).push({callback:c,context:f,ctx:f||this});return this},once:function(b,c,f){if(!n(this,"once",b,[c,f])||!c)return this;var d=this,e=k.once(function(){d.off(b,e);c.apply(this,arguments)});e._callback=c;return this.on(b,e,f)},off:function(b,c,f){var d,e,l,g,h,m,w,v;if(!this._events||!n(this,"off",b,[c,f]))return this;
if(!b&&!c&&!f)return this._events={},this;g=b?[b]:k.keys(this._events);h=0;for(m=g.length;h<m;h++)if(b=g[h],l=this._events[b]){this._events[b]=d=[];if(c||f)for(w=0,v=l.length;w<v;w++)e=l[w],(c&&c!==e.callback&&c!==e.callback._callback||f&&f!==e.context)&&d.push(e);d.length||delete this._events[b]}return this},trigger:function(b){if(!this._events)return this;var c=f.call(arguments,1);if(!n(this,"trigger",b,c))return this;var d=this._events[b],k=this._events.all;d&&g(d,c);k&&g(k,arguments);return this},
stopListening:function(b,c,f){var d=this._listeners;if(!d)return this;var k=!c&&!f;"object"===typeof c&&(f=this);b&&((d={})[b._listenerId]=b);for(var e in d)d[e].off(c,f,this),k&&delete this._listeners[e];return this}};var m=/\s+/,n=function(b,c,f,d){if(!f)return!0;if("object"===typeof f){for(var k in f)b[c].apply(b,[k,f[k]].concat(d));return!1}if(m.test(f)){f=f.split(m);k=0;for(var e=f.length;k<e;k++)b[c].apply(b,[f[k]].concat(d));return!1}return!0},g=function(b,c){var f,d=-1,k=b.length,e=c[0],l=
c[1],g=c[2];switch(c.length){case 0:for(;++d<k;)(f=b[d]).callback.call(f.ctx);break;case 1:for(;++d<k;)(f=b[d]).callback.call(f.ctx,e);break;case 2:for(;++d<k;)(f=b[d]).callback.call(f.ctx,e,l);break;case 3:for(;++d<k;)(f=b[d]).callback.call(f.ctx,e,l,g);break;default:for(;++d<k;)(f=b[d]).callback.apply(f.ctx,c)}};k.each({listenTo:"on",listenToOnce:"once"},function(b,c){l[c]=function(c,f,d){var e=this._listeners||(this._listeners={}),l=c._listenerId||(c._listenerId=k.uniqueId("l"));e[l]=c;"object"===
typeof f&&(d=this);c[b](f,d,this);return this}});l.bind=l.on;l.unbind=l.off;l.mixin=function(b){k.each("on once off trigger stopListening listenTo listenToOnce bind unbind".split(" "),function(c){b[c]=this[c]},this);return b};b.Appacitive.Events=l})(global);
(function(b){b.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/v1.0/"};!b.navigator||-1==b.navigator.userAgent.indexOf("MSIE 8")&&-1==b.navigator.userAgent.indexOf("MSIE 9")||(b.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/v1.0/")})(global);
(function(b){var d=function(c){var d;if(!c||!_type.isObject(c))throw Error("Please specify request options");this.promise=b.Appacitive.Promise.buildPromise(c.callbacks);var f=this.request=new b.Appacitive.HttpRequest;d=b.Appacitive.storage.urlFactory[c.type];var h=c.op.replace("get","").replace("Url","")+" "+c.type;d=b.Appacitive.config.apiBaseUrl+d[c.op].apply(d,c.args||[]);f.url=d;f.description=h;f.method=c.method||"get";f.data=c.data||{};f.onSuccess=c.onSuccess;f.onError=c.onError;f.promise=this.promise;
f.options=c.callbacks;c.entity&&(f.entity=c.entity);return this};d.prototype.send=function(){return b.Appacitive.http.send(this.request)};b.Appacitive._Request=d})(global);
(function(b){b.Appacitive.Session=new function(){this.initialized=!1;var d=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},c=null,e=null,f=null,h=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(c){return b.Appacitive.Session.create(c)};this.create=function(f){if(!this.initialized)throw Error("Intialize Appacitive SDK");var k=new d;k.apikey=e;var h=new b.Appacitive._Request({method:"PUT",type:"application",op:"getSessionCreateUrl",
callbacks:f,data:k,onSuccess:function(f){c=f.session.sessionkey;b.Appacitive.Session.useApiKey=!1;h.promise.fulfill(f);b.Appacitive.Session.onSessionCreated()}});return h.send()};b.Appacitive.http.addProcessor({pre:function(d){b.Appacitive.Session.useApiKey?d.headers.push({key:"ak",value:e}):d.headers.push({key:"as",value:c});!0===h&&(1==d.headers.filter(function(b){return"ut"==b.key}).length?d.headers.forEach(function(b){"ut"==b.key&&(b.value=f)}):d.headers.push({key:"ut",value:f}))}});this.setUserAuthHeader=
function(c,d,k){try{c&&(h=!0,f=c,k||(d||(d=-1),-1==d&&(d=null),b.Appacitive.localStorage.set("Appacitive-UserToken",c),b.Appacitive.localStorage.set("Appacitive-UserTokenExpiry",d),b.Appacitive.localStorage.set("Appacitive-UserTokenDate",(new Date).getTime())))}catch(e){}};this.incrementExpiry=function(){try{b.Appacitive.runtime.isBrowser&&h&&b.Appacitive.localStorage.set("Appacitive-UserTokenDate",(new Date).getTime())}catch(c){}};this.removeUserAuthHeader=function(c,d){var k=b.Appacitive.Promise.buildPromise(d);
c||b.Appacitive.User.trigger("logout",{});b.Appacitive.localStorage.remove("Appacitive-User");if(f&&c)try{var e=new b.Appacitive.HttpRequest(d);e.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(f);e.method="POST";e.data={};e.type="user";e.options=d;e.description="InvalidateToken user";e.onSuccess=e.onError=function(){h=!1;f=null;b.Appacitive.localStorage.remove("Appacitive-UserToken");b.Appacitive.localStorage.remove("Appacitive-UserTokenExpiry");b.Appacitive.localStorage.remove("Appacitive-UserTokenDate");
k.fulfill()};b.Appacitive.http.send(e);return k}catch(p){}else return h=!1,f=null,b.Appacitive.localStorage.remove("Appacitive-UserToken"),b.Appacitive.localStorage.remove("Appacitive-UserTokenExpiry"),b.Appacitive.localStorage.remove("Appacitive-UserTokenDate"),k.fulfill()};this.isSessionValid=function(b){if(b.status){if(b.status.code&&("420"==b.status.code||"19027"==b.status.code||"19002"==b.status.code))return{status:!1,isSession:"19027"==b.status.code||"420"==b.status.code?!0:!1}}else if(b.code&&
("420"==b.code||"19027"==b.code||"19002"==b.code))return{status:!1,isSession:"19027"==b.code||"420"==b.code?!0:!1};return{status:!0}};this.resetSession=function(){c=null;this.useApiKey=!0};this.get=function(){return c};this.setSession=function(b){b&&(c=b,this.useApiKey=!1)};this.setApiKey=function(b){b&&(e=b,this.useApiKey=!0)};var k="sandbox";this.environment=function(){if(1==arguments.length){var b=arguments[0];"sandbox"!=b&&"live"!=b&&(b="sandbox");k=b}return k}};b.Appacitive.getAppPrefix=function(d){return b.Appacitive.Session.environment()+
"/"+b.Appacitive.appId+"/"+d};b.Appacitive.initialize=function(d){d=d||{};if(!b.Appacitive.Session.initialized){if(!d.apikey||0===d.apikey.length)throw Error("apikey is mandatory");if(!d.appId||0===d.appId.length)throw Error("appId is mandatory");b.Appacitive.Session.setApiKey(d.apikey);b.Appacitive.Session.environment(d.env||"sandbox");b.Appacitive.useApiKey=!0;b.Appacitive.appId=d.appId;b.Appacitive.Session.initialized=!0;b.Appacitive.Session.persistUserToken=d.persistUserToken;d.debug&&(b.Appacitive.config.debug=
!0);_type.isFunction(d.apiLog)&&(b.Appacitive.logs.apiLog=d.apiLog);_type.isFunction(d.apiErrorLog)&&(b.Appacitive.logs.apiErrorLog=d.apiErrorLog);_type.isFunction(d.exceptionLog)&&(b.Appacitive.logs.exceptionLog=d.exceptionLog);if(d.userToken)if(-1==d.expiry?d.expiry=null:d.expiry||(d.expiry=3600),b.Appacitive.Session.setUserAuthHeader(d.userToken,d.expiry),d.user)b.Appacitive.Users.setCurrentUser(d.user);else{var c=b.Appacitive.localStorage.get("Appacitive-User");c&&b.Appacitive.Users.setCurrentUser(c)}else if(b.Appacitive.runtime.isBrowser&&
(d=b.Appacitive.localStorage.get("Appacitive-UserToken"))){var e=b.Appacitive.localStorage.get("Appacitive-UserTokenExpiry"),c=b.Appacitive.localStorage.get("Appacitive-UserTokenDate");e||(e=-1);c&&0<e&&new Date(c+1E3*e)<new Date||(-1==e&&(e=null),(c=b.Appacitive.localStorage.get("Appacitive-User"))&&b.Appacitive.Users.setCurrentUser(c,d,e))}}}})(global);
(function(b){b.Appacitive&&b.Appacitive.http&&(b.Appacitive.http.addProcessor({pre:function(d){d.headers.push({key:"e",value:b.Appacitive.Session.environment()})}}),b.Appacitive.Events.mixin(b.Appacitive))})(global);
(function(b){var d=b.Appacitive;d.GeoCoord=function(b,c){var f=function(b,c){if(isNaN(b)||isNaN(c))throw Error("Invalid Latitiude or longitiude provided");if(-90>b||90<b)throw Error("Latitude "+b+" should be in range of  -90.0 to 90.");if(-180>c||180<c)throw Error("Latitude "+c+" should be in range of  -180.0 to 180.");},k=function(b){if("string"!==typeof b||0==b.length)return!1;b=b.split(",");if(2!==b.length)return!1;try{return new d.GeoCoord(b[0],b[1])}catch(c){return!1}};if(_type.isString(b)&&
!c&&(k=k(b)))return k;b&&c?(f(b,c),this.lat=b,this.lng=c):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",b,c)};this.toString=function(){return this.getValue()}};var c=function(){this.toString=function(){};this.Or=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new n(g.or,b)};this.And=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new n(g.and,
b)}},e=function(b){c.call(this);b=b||{};this.fieldType=b.fieldType;this.field=b.field||"";this.value=b.value;this.operator=b.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue())}};e.prototype=new c;e.prototype.constructor=e;var f=function(b){b=b||"";
if(!_type.isArray(b.value)||!b.value.length)throw Error("Specify field value as array");e.call(this,b);this.toString=function(){for(var b=[],c=0;c<this.value.length;c+=1)b.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,_type.isString(this.value[c])?"'"+this.value[c]+"'":_type.isNumber(this.value[c])?this.value[c]:this.value[c].toString()));return"("+b.join(" or ")+")"}};f.prototype=new e;f.prototype.constructor=f;var h=function(b){b=b||"";if(!b.val1)throw Error("Specify field value1 ");
if(!b.val2)throw Error("Specify field value2 ");this.val1=b.val1;this.val2=b.val2;e.call(this,b);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};h.prototype=new e;h.prototype.constructor=h;var k=function(b){b=b||"";if(!(b.geoCoord&&b.geoCoord instanceof d.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");e.call(this,
b);this.value=b.geoCoord;this.unit=b.unit||"mi";this.distance=b.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};k.prototype=new e;k.prototype.constructor=h;var l=function(b){b=b||"";if(!b.geoCoords||0===b.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");if(3>b.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");
e.call(this,b);this.value=b.geoCoords;var c=function(b){var c="";b.forEach(function(b){c=0===c.length?b.toString():c+(" | "+b.toString())});return c};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,c(this.value))}};l.prototype=new e;l.prototype.constructor=h;var m=function(b){c.call(this);b=b||{};if(!b.tags||!_type.isArray(b.tags)||0===b.tags.length)throw Error("Specify valid tags");this.tags=b.tags;this.operator=b.operator;
this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};m.prototype=new c;m.prototype.constructor=m;var n=function(b,f){if(!f||!f.length||2>f.length)throw Error("Provide valid or atleast 2 filters");this.operator=b;this.innerFilters=[];for(var d=0;d<f.length;d+=1){if(!(f[d]instanceof c))throw Error("Invalid filter provided");this.innerFilters.push(f[d])}this.toString=function(){var b=this.operator,c="(";this.innerFilters.forEach(function(f){c=1===c.length?c+
(" "+f.toString()):c+String.format(" {0} {1} ",b,f.toString())});return c+=")"}};n.prototype=new c;n.prototype.constructor=n;var g={isEqualTo:"==",isGreaterThan:">",isGreaterThanEqualTo:">=",isLessThan:"<",isLessThanEqualTo:"<=",like:"like",match:"match",between:"between",withinCircle:"within_circle",withinPolygon:"within_polygon",or:"or",and:"and",taggedWithAll:"tagged_with_all",taggedWithOneOrMore:"tagged_with_one_or_more"},p=function(b,c){if(null===b||void 0===b||0===b.length)throw Error("Specify value");
this.value=b;this.type=c?c:typeof this.value;if("number"===this.type&&!_type.isNumeric(this.value))throw Error("Value should be numeric for filter expression");this.getValue=function(){return"string"===this.type?"'"+this.value+"'":"number"===this.type||_type.isBoolean(this.value)?this.value:"object"===this.type&&this.value instanceof date?"datetime('"+d.Date.toISOString(this.value)+"')":this.value.toString()}},q=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"date('"+
d.Date.toISODate(this.value)+"')":"date('"+this.value+"')"}},r=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"time('"+d.Date.toISOTime(this.value)+"')":"time('"+this.value+"')"}},t=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"datetime('"+d.Date.toISOString(this.value)+"')":"datetime('"+this.value+"')"}},u=function(b,c,d){d||(d=this);d.type=b;d.name=c;d.equalTo=function(b){return new e({field:this.name,fieldType:this.type,
value:new p(b),operator:g.isEqualTo})};d.equalToNumber=function(b){return new e({field:this.name,fieldType:this.type,value:new p(b,"number"),operator:g.isEqualTo})};d.equalToDate=function(b){return new e({field:this.name,fieldType:this.type,value:new q(b),operator:g.isEqualTo})};d.equalToTime=function(b){return new e({field:this.name,fieldType:this.type,value:new r(b),operator:g.isEqualTo})};d.equalToDateTime=function(b){return new e({field:this.name,fieldType:this.type,value:new t(b),operator:g.isEqualTo})};
d.greaterThan=function(b){return new e({field:this.name,fieldType:this.type,value:new p(b,"number"),operator:g.isGreaterThan})};d.greaterThanDate=function(b){return new e({field:this.name,fieldType:this.type,value:new q(b),operator:g.isGreaterThan})};d.greaterThanTime=function(b){return new e({field:this.name,fieldType:this.type,value:new r(b),operator:g.isGreaterThan})};d.greaterThanDateTime=function(b){return new e({field:this.name,fieldType:this.type,value:new t(b),operator:g.isGreaterThan})};
d.greaterThanEqualTo=function(b){return new e({field:this.name,fieldType:this.type,value:new p(b,"number"),operator:g.isGreaterThanEqualTo})};d.greaterThanEqualToDate=function(b){return new e({field:this.name,fieldType:this.type,value:new q(b),operator:g.isGreaterThanEqualTo})};d.greaterThanEqualToTime=function(b){return new e({field:this.name,fieldType:this.type,value:new r(b),operator:g.isGreaterThanEqualTo})};d.greaterThanEqualToDateTime=function(b){return new e({field:this.name,fieldType:this.type,
value:new t(b),operator:g.isGreaterThanEqualTo})};d.lessThan=function(b){return new e({field:this.name,fieldType:this.type,value:new p(b,"number"),operator:g.isLessThan})};d.lessThanDate=function(b){return new e({field:this.name,fieldType:this.type,value:new q(b),operator:g.isLessThan})};d.lessThanTime=function(b){return new e({field:this.name,fieldType:this.type,value:new r(b),operator:g.isLessThan})};d.lessThanDateTime=function(b){return new e({field:this.name,fieldType:this.type,value:new t(b),
operator:g.isLessThan})};d.lessThanEqualTo=function(b){return new e({field:this.name,fieldType:this.type,value:new p(b,"number"),operator:g.isLessThanEqualTo})};d.lessThanEqualToDate=function(b){return new e({field:this.name,fieldType:this.type,value:new q(b),operator:g.isLessThanEqualTo})};d.lessThanEqualToTime=function(b){return new e({field:this.name,fieldType:this.type,value:new r(b),operator:g.isLessThanEqualTo})};d.lessThanEqualToDateTime=function(b){return new e({field:this.name,fieldType:this.type,
value:new t(b),operator:g.isLessThanEqualTo})};d.like=function(b){return new e({field:this.name,fieldType:this.type,value:new p("*"+b+"*"),operator:g.like})};d.match=function(b){return new e({field:this.name,fieldType:this.type,value:new p("*"+b+"*"),operator:g.match})};d.startsWith=function(b){return new e({field:this.name,fieldType:this.type,value:new p(b+"*"),operator:g.like})};d.endsWith=function(b){return new e({field:this.name,fieldType:this.type,value:new p("*"+b),operator:g.like})};d.contains=
function(b){return new f({field:this.name,fieldType:this.type,value:b,operator:g.isEqualTo})};d.between=function(b,c){return new h({field:this.name,fieldType:this.type,val1:new p(b,"number"),val2:new p(c,"number"),operator:g.between})};d.betweenDate=function(b,c){return new h({field:this.name,fieldType:this.type,val1:new q(b),val2:new q(c),operator:g.between})};d.betweenTime=function(b,c){return new h({field:this.name,fieldType:this.type,val1:new r(b),val2:new r(c),operator:g.between})};d.betweenDateTime=
function(b,c){return new h({field:this.name,fieldType:this.type,val1:new t(b),val2:new t(c),operator:g.between})};d.withinCircle=function(b,c,f){return new k({field:this.name,fieldType:this.type,geoCoord:b,distance:c,unit:f,operator:g.withinCircle})};d.withinPolygon=function(b){return new l({field:this.name,fieldType:this.type,geoCoords:b,operator:g.withinPolygon})}},A=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;u("property",b,this);return this},z=function(b){if(!b||
0===b.length)throw Error("Specify field name");this.field=b;var c=new u("aggregate",b);this.equalTo=function(b){return c.equalTo(b)};this.greaterThan=function(b){return c.greaterThan(b)};this.greaterThanEqualTo=function(b){return c.greaterThanEqualTo(b)};this.lessThan=function(b){return c.lessThan(b)};this.lessThanEqualTo=function(b){return c.lessThanEqualTo(b)};this.between=function(b,f){return c.between(b,f)};return this},x=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=
b;var c=new u("attribute",b);this.like=function(b){return c.like(b)};this.like=function(b){return c.match(b)};this.startWith=function(b){return c.startsWith(b)};this.endsWith=function(b){return c.endsWith(b)};this.equalTo=function(b){return c.equalTo(b)};this.contains=function(b){return c.contains(b)};return this};d.Filter={Property:function(b){return new A(b)},Aggregate:function(b){return new z(b)},Attribute:function(b){return new x(b)},Or:function(){return new n(g.or,arguments)},And:function(){return new n(g.and,
arguments)},taggedWithOneOrMore:function(b){return new m({tags:b,operator:g.taggedWithOneOrMore})},taggedWithAll:function(b){return new m({tags:b,operator:g.taggedWithAll})}}})(global);
(function(b){b.Appacitive.Queries={};var d=function(b){b=b||{};var c=1,d=20;this.pageNumber=function(){return 1==arguments.length?(c=arguments[0]||1,this):c};this.pageSize=function(){return 1==arguments.length?(d=arguments[0]||20,this):d};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};d.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var c=function(b){b=b||{};var c=null,d=!1;this.orderBy=function(){return 1===arguments.length&&_type.isString(arguments[0])?
(c=arguments[0],this):c};this.isAscending=function(){return 1===arguments.length?(d=void 0===arguments[0]||null==arguments[0]?!1:arguments[0],this):d};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};c.prototype.toString=function(){return this.orderBy()&&0<this.orderBy().length?"orderBy="+this.orderBy()+"&isAsc="+this.isAscending():""};var e=function(f){var e=f||{},k="",l="",m="",n=e.queryType||"BasicQuery",g=new d(f),p=new c(f),q=e.type||e.relation,r=e.relation?"connection":"object",t=this;
e.entity&&(this.entity=e.entity);this.type=function(){return r};this.entityType=function(){return q};this.queryType=function(){return n};this.pageQuery=function(){return g};this.pageNumber=function(){return 1===arguments.length?(g.pageNumber(arguments[0]),this):g.pageNumber()};this.pageSize=function(){return 1===arguments.length?(g.pageSize(arguments[0]),this):g.pageSize()};this.sortQuery=function(){return p};this.orderBy=function(){return 1===arguments.length?(p.orderBy(arguments[0]),this):p.orderBy()};
this.isAscending=function(){return 1===arguments.length?(p.isAscending(arguments[0]),this):p.isAscending()};this.filter=function(){return 1===arguments.length?(k=arguments[0],this):k};this.freeText=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?l=arguments[0]:_type.isArray(b)&&b.length&&(l=arguments[0].join(" "));return this}return l};this.fields=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?m=b:_type.isArray(b)&&b.length&&(m=b.join(","));return this}return m};
this.filter(e.filter||"");this.freeText(e.freeText||"");this.fields(e.fields||"");this.setFilter=function(b){this.filter(b)};this.setFreeText=function(b){this.freeText(b)};this.setFields=function(b){this.fields(b)};this.extendOptions=function(b){for(var f in b)e[f]=b[f];g=new d(e);p=new c(e);return this};this.getQueryString=function(){var b=g.toString(),c=p.toString();c&&(b+="&"+c);this.filter()&&(c=encodeURIComponent(this.filter().toString()),0<c.trim().length&&(b+="&query="+c));this.freeText()&&
0<this.freeText().trim().length&&(b+="&freetext="+encodeURIComponent(this.freeText())+"&language=en");this.fields()&&0<this.fields().trim().length&&(b+="&fields="+this.fields());return b};this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+r+"/"+q+"/find/all?"+this.getQueryString(),description:"FindAll "+q+" "+r+"s"}};this.toRequest=function(c){var f=new b.Appacitive.HttpRequest,d=this.toUrl();f.url=d.url;f.options=c;f.description=d.description;f.method="get";return f};this.getOptions=
function(){var b={},c;for(c in this)this.hasOwnProperty(c)&&!_type.isFunction(this[c])&&(b[c]=this[c]);return b};this._setPaging=function(b){b&&(g.pageNumber(b.pagenumber),g.pageSize(b.pagesize),this.results=this.results||[],this.results.isLastPage=!1,this.results.total=b.totalrecords,this.results.pageNumber=b.pagenumber,this.results.pageSize=b.pagesize,b.pagenumber*b.pagesize>=b.totalrecords&&(this.results.isLastPage=!0))};this.fetch=function(c){var f=b.Appacitive.Promise.buildPromise(c);c=this.toRequest(c);
c.onSuccess=function(c){var d;(d=c[r+"s"])||(d=[]);d=b.Appacitive["object"===r?"Object":"Connection"]._parseResult(d,e.entity);t.results=d;t._setPaging(c.paginginfo);f.fulfill(t.results,c.paginginfo)};c.promise=f;c.entity=this;return b.Appacitive.http.send(c)};this.collection=function(c,f){f=f||{};c=c||[];_type.isObject(c)&&(f=c,c=null);c||(c=this.results?this.results:[]);var d=e.entity;!d&&(0<c.length&&c[0]instanceof b.Appacitive.BaseObject)&&(d="object"==c[0].type?"Object":"Connection",d=b.Appacitive[d]._getClass(c[0].className));
d||(d="object"===r?"Object":"Connection",b.Appacitive[d]._getClass(this[d]));return new Appacitive.Collection(c,_extend(f,{model:this.model,query:this}))};this.fetchNext=function(b){var c=this.pageNumber();this.pageNumber(++c);return this.fetch(b)};this.fetchPrev=function(b){var c=this.pageNumber(),c=c-1;0>=c&&(c=1);this.pageNumber(c);return this.fetch(b)};this.count=function(c){var f=b.Appacitive.Promise.buildPromise(c);c=this.toRequest(c);c.onSuccess=function(b){b=b||{};b=b.paginginfo;var c=0,c=
b?b.totalrecords:0;f.fulfill(c)};c.promise=f;c.entity=this;return b.Appacitive.http.send(c)}};b.Appacitive.Query=e;b.Appacitive.Queries.FindAllQuery=function(b){b=b||{};if(!b.type&&!b.relation)throw Error("Specify either type or relation for basic filter query");b.queryType="FindAllQuery";e.call(this,b);return this};b.Appacitive.Queries.FindAllQuery.prototype=new e;b.Appacitive.Queries.FindAllQuery.prototype.constructor=b.Appacitive.Queries.FindAllQuery;b.Appacitive.Queries.ConnectedObjectsQuery=
function(c){c=c||{};if(!c.relation)throw Error("Specify relation for connected objects query");if(!c.objectId)throw Error("Specify objectId for connected objects query");if(!c.type)throw Error("Specify type of object id for connected objects query");var d=c.type;delete c.type;c.queryType="ConnectedObjectsQuery";e.call(this,c);this.objectId=c.objectId;this.relation=c.relation;this.type=d;c.object instanceof b.Appacitive.Object&&(this.object=c.object);this.returnEdge=!0;void 0===c.returnEdge||(null===
c.returnEdge||c.returnEdge||this.prev)||(this.returnEdge=!1);this.label="";var k=this;_type.isString(c.label)&&0<c.label.length&&(this.label="&label="+c.label);this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.type+"/"+this.objectId+"/find?"+this.getQueryString()+this.label+"&returnEdge="+this.returnEdge,description:"GetConnectedObjects for relation "+this.relation+" of type "+this.type+" for object "+this.objectId}};var l=function(c,d){var f=[];
c.forEach(function(c){var e=c.__edge;delete c.__edge;var k=b.Appacitive.Object._create(c,!0);e&&(e.__endpointa=d,e.__endpointb={objectid:c.__id,label:e.__label,type:c.__type},delete e.label,k.connection=b.Appacitive.Connection._create(e,!0));f.push(k)});k.object&&(k.object.children[k.relation]=f);return f};this.fetch=function(e){var n=b.Appacitive.Promise.buildPromise(e);e=this.toRequest(e);e.onSuccess=function(b){k.results=l(b.nodes?b.nodes:[],{objectid:c.objectId,type:d,label:b.parent});k._setPaging(b.paginginfo);
n.fulfill(k.results,b.paginginfo)};e.promise=n;e.entity=this;return b.Appacitive.http.send(e)};return this};b.Appacitive.Queries.ConnectedObjectsQuery.prototype=new e;b.Appacitive.Queries.ConnectedObjectsQuery.prototype.constructor=b.Appacitive.Queries.ConnectedObjectsQuery;b.Appacitive.Queries.GetConnectionsQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!c.objectId)throw Error("Specify objectId for GetConnectionsQuery query");if(!c.label||
0===c.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");c.type&&delete c.type;c.queryType="GetConnectionsQuery";e.call(this,c);this.objectId=c.objectId;this.relation=c.relation;this.label=c.label;this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?"+this.getQueryString()+"&objectid="+this.objectId+"&label="+this.label,description:"FindAllConnections for relation "+this.relation+" from object id "+this.objectId}};return this};
b.Appacitive.Queries.GetConnectionsQuery.prototype=new e;b.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsQuery;b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery=function(c,d){c=c||{};delete c.entity;if(!c.objectAId||!_type.isString(c.objectAId)||0===c.objectAId.length)throw Error("Specify valid objectAId for GetConnectionsBetweenObjectsQuery query");if(!c.objectBId||!_type.isString(c.objectBId)||0===c.objectBId.length)throw Error("Specify objectBId for GetConnectionsBetweenObjectsQuery query");
c.type&&delete c.type;c.queryType=d||"GetConnectionsBetweenObjectsQuery";e.call(this,c);this.objectAId=c.objectAId;this.objectBId=c.objectBId;this.label="GetConnectionsBetweenObjectsForRelationQuery"===this.queryType()&&c.label&&_type.isString(c.label)&&0<c.label.length?"&label="+c.label:"";this.relation=c.relation&&_type.isString(c.relation)&&0<c.relation.length?c.relation+"/":"";this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.objectAId+"/"+
this.objectBId+"?"+this.getQueryString()+this.label,description:"FindConnectionBetween for relation "+this.relation+" between object ids "+this.objectAId+" and "+this.objectBId}};return this};b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery.prototype=new e;b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery.prototype.constructor=b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery;b.Appacitive.Queries.GetConnectionsBetweenObjectsForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenObjectsForRelationQuery query");
var d=new b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery(c,"GetConnectionsBetweenObjectsForRelationQuery");d.fetch=function(e){var l=b.Appacitive.Promise.buildPromise(e);e=this.toRequest(e);e.onSuccess=function(e){d.results=e.connection?[b.Appacitive.Connection._create(e.connection,!0,c.entity)]:null;l.fulfill(d.results?d.results[0]:null)};e.promise=l;e.entity=this;return b.Appacitive.http.send(e)};return d};b.Appacitive.Queries.InterconnectsQuery=function(c){c=c||{};delete c.entity;if(!c.objectAId||
!_type.isString(c.objectAId)||0===c.objectAId.length)throw Error("Specify valid objectAId for InterconnectsQuery query");if(!(c.objectBIds&&_type.isArray(c.objectBIds)&&0<c.objectBIds.length))throw Error("Specify list of objectBIds for InterconnectsQuery query");c.type&&delete c.type;c.queryType="InterconnectsQuery";e.call(this,c);this.objectAId=c.objectAId;this.objectBIds=c.objectBIds;this.toRequest=function(c){var d=new b.Appacitive.HttpRequest,f=this.toUrl();d.url=f.url;d.options=c;d.description=
f.description;d.method="post";d.data={object1id:this.objectAId,object2ids:this.objectBIds};return d};this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString(),description:"GetInterConnections between objects"}};return this};b.Appacitive.Queries.InterconnectsQuery.prototype=new e;b.Appacitive.Queries.InterconnectsQuery.prototype.constructor=b.Appacitive.Queries.InterconnectsQuery;b.Appacitive.Queries.GraphFilterQuery=function(c,d){if(!c||0===
c.length)throw Error("Specify name of filter query");this.name=c;this.data={};this.queryType="GraphFilterQuery";if(d){this.data.placeholders=d;for(var e in this.data.placeholders)this.data.placeholders[e]=this.data.placeholders[e]}this.toRequest=function(c){var d=new b.Appacitive.HttpRequest,f=this.toUrl();d.url=f.url;d.options=c;d.description=f.description;d.method="post";d.data=this.data;return d};this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter",description:"Filter Query with name "+
this.name}};this.fetch=function(c){var d=b.Appacitive.Promise.buildPromise(c);c=this.toRequest(c);c.onSuccess=function(b){d.fulfill(b.ids?b.ids:[])};c.promise=d;c.entity=this;return b.Appacitive.http.send(c)}};b.Appacitive.Queries.GraphProjectQuery=function(c,d,e){if(!c||0===c.length)throw Error("Specify name of project query");if(!d||!d.length)throw Error("Specify ids to project");this.name=c;this.data={ids:d};this.queryType="GraphProjectQuery";var l=this;if(e){this.data.placeholders=e;for(var m in this.data.placeholders)this.data.placeholders[m]=
this.data.placeholders[m]}this.toRequest=function(c){var d=new b.Appacitive.HttpRequest,f=this.toUrl();d.url=f.url;d.description=f.description;d.method="post";d.data=this.data;d.options=c;return d};this.toUrl=function(){return{url:b.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project",description:"Project Query with name "+this.name}};var n=function(c){var d,f;for(f in c)if("status"!==f){d=c[f];break}var e=function(c,d,f){var k=[];c.forEach(function(c){var g=c.__children;delete c.__children;
var l=c.__edge;delete c.__edge;c=b.Appacitive.Object._create(c,!0);c.children={};for(var h in g)c.children[h]=[],c.children[h]=e(g[h].values,g[h].parent,c.id);l&&(l.__endpointa={objectid:f,label:d},l.__endpointb={objectid:c.id(),label:l.__label},delete l.__label,c.connection=b.Appacitive.Connection._create(l,!0));k.push(c)});return k};return e(d.values)};this.collection=function(c,d){d=d||{};c=c||[];_type.isObject(c)&&(d=c,c=null);c||(c=this.results?ths.results:[]);0<c.length&&c[0]instanceof b.Appacitive.BaseObject&&
b.Appacitive.Object._getClass(c[0].className);return new Appacitive.Collection(c,_extend(d,{model:this.model,query:this}))};this.fetch=function(c){var d=b.Appacitive.Promise.buildPromise(c);c=this.toRequest(c);c.onSuccess=function(b){l.results=n(b);d.fulfill(l.results)};c.promise=d;c.entity=this;return b.Appacitive.http.send(c)}}})(global);
var ArrayProto=Array.prototype,ObjectProto=Object.prototype,each=function(b,d,c){if(null!=b)if(ArrayProto.forEach&&b.forEach===ArrayProto.forEach)b.forEach(d,c);else if(b.length===+b.length)for(var e=0,f=b.length;e<f&&d.call(c,b[e],e,b)!=={};e++);else for(e in b)if(ObjectProto.hasOwnProperty.call(b,e)&&d.call(c,b[e],e,b)==={})break},_extend=function(b){each(ArrayProto.slice.call(arguments,1),function(d){if(d)for(var c in d)b[c]=d[c]});return b},extend=function(b,d){var c=this,e;e=_type.isObject(b)&&
b.hasOwnProperty("constructor")?b.constructor:function(){return c.apply(this,arguments)};_extend(e,c,d);var f=function(){this.constructor=e};f.prototype=c.prototype;e.prototype=new f;b&&_extend(e.prototype,b);e.__super__=c.prototype;return e};(function(b){b.Appacitive._extend=function(b,c,e){return extend.apply(b,[c,e])}})(global);
(function(b){b.Appacitive.BaseObject=function(d,c){var e={};(c=c||{})&&c.parse&&(d=this.parse(d));_type.isObject(this.defaults)&&!c.setSnapShot&&(d=_extend({},this.defaults,d));c&&c.collection&&(this.collection=c.collection);var f={},h={},k={},l=function(c,d){for(var e in c)if(f[e]&&delete f[e],h[e]&&delete h[e],k[e]&&delete k[e],_type.isString(c[e]))d[e]=c[e];else if(c[e]instanceof Date)d[e]=b.Appacitive.Date.toISOString(c[e]);else if(_type.isObject(c[e]))if(c[e]instanceof b.Appacitive.GeoCoord)d[e]=
c[e].toString();else{d[e]||(d[e]={});for(var l in c[e])d[e][l]=c[e][l]}else if(_type.isArray(c[e])){if(d[e]=[],c[e].forEach(function(c){if(_type.isString(c))d[e].push(c);else if(_type.isNumber(c)||_type.isBoolean(c))d[e].push(value+"");else if(c instanceof Date)d[e].push(b.Appacitive.Date.toISOString(c));else if("__link"==e)d[e].push(c);else throw Error("Multivalued property cannot have values of property as an object");}),"__tags"!==e||"__link"!==e)d[e].push=function(c){var d=this.length;if(_type.isString(c))this[d]=
c;else if(_type.isNumber(c)||_type.isBoolean(c))this[d]=c+"";else if(c instanceof Date)this[d]=b.Appacitive.Date.toISOString(c);else throw Error("Multivalued property cannot have values of property as an object");return this}}else d[e]=c[e]},m=this,n={};l(d,n);var g=n;c.setSnapShot&&l(g,e);!e.__id&&n.__id&&(e.__id=n.__id);n.__type?(n.__type=n.__type.toLowerCase(),this.entityType="type",this.type="object",this.className=n.__type):n.__relationtype&&(n.__relationtype=n.__relationtype.toLowerCase(),this.entityType=
"relation",this.type="connection",this.className=n.__relationtype);this.cid=parseInt(1E8*Math.random(),10);g.__attributes||(g.__attributes={});e.__attributes||(e.__attributes={});var p=[];g.__tags||(g.__tags=[]);e.__tags||(e.__tags=[]);var q="",r="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __type __relationtype __typeid __relationid __utcdatecreated __utclastupdateddate __tags __authType __authtype __link".split(" "),t=["__link","__endpointa","__endpointb"],u=function(b){b=
b||{};b.message=b.message||"Server error";b.code=b.code||"500";return b};this.toJSON=this.getObject=function(){return JSON.parse(JSON.stringify(g))};this.attributes=g;this.properties=function(){var b=this.attributes();delete b.__attributes;delete b.__tags;return b};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};this.parse=function(b,c){return b};this.attr=function(){if(0===arguments.length)return g.__attributes||(g.__attributes={}),g.__attributes;
if(1===arguments.length)return g.__attributes||(g.__attributes={}),g.__attributes[arguments[0]];if(2===arguments.length){if(!_type.isString(arguments[1])&&null!==arguments[1])throw Error("only string values can be stored in attributes.");g.__attributes||(g.__attributes={});g.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");v("__attributes");return g.__attributes};var A=function(){if(!g.__attributes)return null;
if(!e.__attributes)return g.__attributes;var b=!1,c=JSON.parse(JSON.stringify(e.__attributes)),d;for(d in g.__attributes)null==g.__attributes[d]||void 0==g.__attributes[d]?(c[d]=null,b=!0):g.__attributes[d]!=e.__attributes[d]?(c[d]=g.__attributes[d],b=!0):g.__attributes[d]==e.__attributes[d]&&delete c[d];return b?c:null};this.getChangedAttributes=A;this.aggregate=function(){var b={},c;for(c in g){if(!g.hasOwnProperty(c))return;"$"==c[0]&&(b[c.substring(1)]=g[c])}if(0===arguments.length)return b;if(1==
arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};this.tags=function(){return g.__tags?g.__tags:[]};this.addTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;g.__tags||(g.__tags=[]);g.__tags.push(b);g.__tags=Array.distinct(g.__tags);if(!p||!p.length)return v("__tags"),this;b=p.indexOf(b);-1!=b&&p.splice(b,1);v("__tags");return this};this.removeTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;
p.push(b);p=Array.distinct(p);if(!g.__tags||!g.__tags.length)return v("__tags"),this;b=g.__tags.indexOf(b);-1!=b&&g.__tags.splice(b,1);v("__tags");return this};var z=function(){if(!g.__tags)return[];if(!e.__tags)return g.__tags;var b=[];g.__tags.forEach(function(c){-1==e.__tags.indexOf(c)&&b.push(c)});return 0<b.length?b:null};this.getChangedTags=z;this.getRemovedTags=function(){return _removetags};var x=function(b,c,d,e){if(!b||!_type.isString(b)||0===b.length||0==b.trim().indexOf("__")||0===b.trim().indexOf("$")||
void 0==c||null==c)return this;b=b.toLowerCase();try{var f=function(c){if(!_type.isString(c))if(_type.isNumber(c)||_type.isBoolean(c))c+="";else throw Error("Multivalued property cannot have values of property as an object");if(g[b]&&_type.isArray(g[b])){var e=g[b].indexOf(c);"additems"==d?g[b].push(c):-1==e&&"adduniqueitems"==d?g[b].push(c):"removeitems"==d&&g[b].removeAll(c)}else"removeitems"!=d&&(g[b]=[c]);h[b]||(h[b]={additems:[],adduniqueitems:[],removeitems:[]});h[b][d].push(c)};_type.isArray(c)?
c.forEach(function(b){f(b)}):f(c);v(b,e)}catch(k){throw Error("Unable to add item to "+b);}return m};this.add=function(b,c,d){return x.apply(this,[b,c,"additems",d])};this.addUnique=function(b,c,d){return x.apply(this,[b,c,"adduniqueitems",d])};this.remove=function(b,c,d){return x.apply(this,[b,c,"removeitems",d])};var y=function(b){var c=!1,d=JSON.parse(JSON.stringify(e)),l;for(l in g)null==g[l]||void 0==g[l]?(d[l]=null,c=!0):g[l]!=e[l]?"__tags"==l||"__attributes"==l?delete d[l]:_type.isArray(g[l])?
h[l]&&!k[l]?(d[l]=h[l],c=!0):g[l].equals(e[l])?delete d[l]:(d[l]=g[l],c=!0):(d[l]=f[l]&&!k[l]?{incrementby:f[l].value}:g[l],c=!0):g[l]==e[l]&&delete d[l];try{r.forEach(function(b){d[b]&&delete d[b]})}catch(m){}l=z();b?(l&&(d.__addtags=l,c=!0),p&&0<p.length&&(d.__removetags=p,c=!0)):l&&(d.__tags=l,c=!0);(b=A())?(d.__attributes=b,c=!0):delete d.__attributes;for(var n in d)"$"==n[0]&&delete d[n];return c&&!Object.isEmpty(d)?d:!1};this.changed=function(){return this.isNew()?this.toJSON():y()};this.hasChanged=
function(){if(this.isNew())return!0;var b=y(!0);return 0===arguments.length?Object.isEmpty(b)?!1:!0:1==arguments.length&&_type.isString(arguments[0])&&0<arguments[0].length&&b&&b[arguments[0]]?!0:!1};this.changedAttributes=function(){if(this.isNew())return this.toJSON();var b=y(!0);if(0===arguments.length)return b;if(1==arguments.length&&_type.isArray(arguments[0])&&arguments[0].length){var c={};arguments[0].forEach(function(d){b[d]&&c.push(b[d])});return c}return!1};this.previous=function(){return this.isNew()?
null:1==arguments.length&&_type.isString(arguments[0])&&arguments[0].length?e[arguments[0]]:null};this.previousAttributes=function(){return this.isNew()?null:e};this.fields=function(){if(1==arguments.length){var b=arguments[0];_type.isString(b)?q=b:_type.isArray(b)&&(q=b.join(","));return this}return q};var w={integer:function(b){if(b){var c=parseInt(b);if(!isNaN(c))return c}return b},decimal:function(b){if(b){var c=parseFloat(b);if(!isNaN(c))return c}return b},"boolean":function(b){return void 0!==
b&&null!==b&&("true"===b.toString().toLowerCase()||!0===b||0<b)?!0:!1},date:function(c){if(c){var d=b.Appacitive.Date.parseISODate(c);if(d)return d}return c},datetime:function(c){if(c){var d=b.Appacitive.Date.parseISODate(c);if(d)return d}return c},time:function(c){if(c){var d=b.Appacitive.Date.parseISOTime(c);if(d)return d}return c},string:function(b){return b?b.toString():b},geocode:function(c){if(!_type.isString(c)||0==c.trim().length)return!1;c=c.split(",");return 2!==c.length?!1:new b.Appacitive.GeoCoord(c[0],
c[1])}};this.get=function(b,c){if(b){if(c&&w[c.toLowerCase()]){if(w[c.toLowerCase()])return w[c.toLowerCase()](g[b]);throw Error('Invalid cast-type "'+c+'"" provided for get "'+b+'"');}return g[b]}};this.tryGet=function(b,c,d){b=this.get(b,d);return void 0!==b?b:c};var v=function(b,c){if(c&&!c.silent){var d=y();d[b]&&(m.trigger("change:"+b,m,d[b],{}),m.trigger("change",m,c))}},D=function(b){b&&!b.silent&&m.trigger("destroy",m,m.collection,b)};this.set=function(c,d,l){l=l||{};var m=l.dataType;if(!c||
!_type.isString(c)||0===c.length||0===c.trim().indexOf("$"))return this;c=c.toLowerCase();try{if(void 0==d||null==d)g[c]=null;else if(_type.isString(d))g[c]=d;else if(_type.isNumber(d)||_type.isBoolean(d))g[c]=d+"";else if(d instanceof Date)g[c]="date"==m?b.Appacitive.Date.toISODate(d):"time"==m?b.Appacitive.Date.toISOTime(d):b.Appacitive.Date.toISOString(d);else if(_type.isObject(d))if(-1!==t.indexOf(c))g[c]=d;else if(d instanceof b.Appacitive.GeoCoord)g[c]=d.toString();else throw Error("Property cannot have value as an object");
else _type.isArray(d)&&(g[c]=[],d.forEach(function(b){if(_type.isString(b))g[c].push(b);else if(_type.isNumber(b)||_type.isBoolean(b))g[c].push(b+"");else{if(d instanceof Date)throw Error("Multivalued property cannot have values of property as date");throw Error("Multivalued property cannot have values of property as an object");}}),"tags"!==c||"__link"!==c)&&(g[c].push=function(b){var d=this.length;if(_type.isString(b))this[d]=b;else if(_type.isNumber(b)||_type.isBoolean(b))this[d]=b+"";else throw Error("Multivalued property cannot have values of property as an object");
v(c,l);return this});delete f[c];delete h[c];delete k[c];g[c]!==e[c]&&(_type.isArray(g[c])&&!g[c].equals(e[c])||_type.isString(g[c])||_type.isObject(g[c]))&&(k[c]=!0);v(c,l);return this}catch(n){throw Error("Unable to set "+c);}};this.unset=function(b,c){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();delete g[b];v(b,c);return this};this.has=function(b){return b&&_type.isString(b)&&0!==b.length?g[b]&&!_type.isUndefined(g[b])?!0:!1:!1};this.isNew=function(){return g.__id&&
g.__id.length?!1:!0};this.clone=function(){return"object"==this.type?b.Appacitive.Object._create(this.toJSON()):new b.Appacitive.connection._create(this.toJSON())};this.copy=function(b,c){b&&(l(b,g),c&&l(b,e));return this};this.mergeWithPrevious=function(){l(g,e);p=[];f={};h={};k={};return this};var B=function(){l(e,g);p=[];f={};h={};k={}};this.rollback=function(){g=n={};B();return this};var C=function(b,c,d,e){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();
if(_type.isObject(g[b])||_type.isArray(g[b]))throw Error("Cannot increment/decrement array/object");try{_type.isObject(c)?(e=c,c=d):c=!c||isNaN(Number(c))?d:Number(c)*d,g[b]=isNaN(Number(g[b]))?c:Number(g[b])+c,m.isNew()||(f[b]={value:(f[b]?f[b].value:0)+c})}catch(k){throw Error("Cannot perform increment/decrement operation");}v(b,e);return m};this.increment=function(b,c,d){return C(b,c,1,d)};this.decrement=function(b,c,d){return C(b,c,-1,d)};this.save=function(){return g.__id?E.apply(this,arguments):
F.apply(this,arguments)};var F=function(c){var d=m.type;!g.__type||"user"!=g.__type.toLowerCase()&&"device"!=g.__type.toLowerCase()||(d=g.__type.toLowerCase());for(var f in g)"$"==f[0]&&delete g[f];g.__revision&&delete g.__revision;var k=new b.Appacitive._Request({method:"PUT",type:d,op:"getCreateUrl",args:[this.className,q],data:g,callbacks:c,entity:m,onSuccess:function(f){var l=null;f&&f[d]?(e=l=f[d],g.__id=l.__id,B(),"connection"==m.type&&m.parseConnection(),b.Appacitive.eventManager.fire(m.entityType+
"."+d+".created",m,{object:m}),m.created=!0,m.trigger("sync",m,f[d],c),k.promise.fulfill(m)):(b.Appacitive.eventManager.fire(m.entityType+"."+d+".createFailed",m,{error:f.status}),k.promise.reject(f.status,m))}});return k.send()},E=function(c,d){b.Appacitive.Promise.is(d)||(d=b.Appacitive.Promise.buildPromise(c));var f=y(!0),k;for(k in f)"$"==k[0]&&delete f[k];if(Object.isEmpty(f))d.fulfill(m);else{var l=m.type;k=[m.className,e.__id?e.__id:g.__id,q];g&&(g.__type&&("user"==g.__type.toLowerCase()||
"device"==g.__type.toLowerCase()))&&(l=g.__type.toLowerCase(),k.splice(0,1));var h=new b.Appacitive._Request({method:"POST",type:l,op:"getUpdateUrl",args:k,data:f,callbacks:c,entity:m,onSuccess:function(d){d&&d[l]?(e=d[l],B(),delete m.created,m.trigger("sync",m,d[l],c),b.Appacitive.eventManager.fire(m.entityType+"."+l+"."+g.__id+".updated",m,{object:m}),h.promise.fulfill(m)):(d=d||{},d.status=d.status||{},d.status=u(d.status),b.Appacitive.eventManager.fire(m.entityType+"."+l+"."+g.__id+".updateFailed",
m,{object:d.status}),h.promise.reject(d.status,m))}});return h.send()}return d},G=function(c){if(!g.__id)throw Error("Please specify id for get operation");var d=this.type;g&&(g.__type&&("user"==g.__type.toLowerCase()||"device"==g.__type.toLowerCase()))&&(d=g.__type.toLowerCase());var f=new b.Appacitive._Request({method:"GET",type:d,op:"getGetUrl",args:[this.className,g.__id,q],callbacks:c,entity:m,onSuccess:function(b){b&&b[d]?(e=b[d],l(e,g),b.connection&&(m.endpoints||m.endpointA&&m.endpointB||
m.setupConnection(g.__endpointa,g.__endpointb)),m.trigger("sync",m,b[d],c),f.promise.fulfill(m)):(b=b||{},b.status=b.status||{},b.status=u(b.status),f.promise.reject(b.status,m))}});return f.send()};this.fetch=function(b){return G.apply(this,[b])};this.del=this.destroy=function(c){c=c||{};var d=c.deleteConnections;_type.isBoolean(c)&&(d=c,c={});c.wait||D(c);if(!g.__id)return(new b.Appacitive.Promise.buildPromise(c)).fulfill();var e=this.type;!g.__type||"user"!=g.__type.toLowerCase()&&"device"!=g.__type.toLowerCase()||
(e=g.__type.toLowerCase());var f=new b.Appacitive._Request({method:"DELETE",type:e,op:"getDeleteUrl",args:[this.className,g.__id,d],callbacks:c,entity:this,onSuccess:function(b){f.promise.fulfill(b);b&&b.status?(c.wait&&D(c),f.promise.fulfill(b.status)):(b=b||{},b.status=b.status||{},b.status=u(b.status),f.promise.reject(b.status,m))}});return f.send()};"object"==this.type&&(this.destroyWithConnections=function(b){return this.destroy(_extend({deleteConnections:!0},b))})};b.Appacitive.BaseObject.prototype.toString=
function(){return JSON.stringify(this.getObject())};b.Appacitive.Events.mixin(b.Appacitive.BaseObject.prototype)})(global);
(function(b){var d=function(){return Math.floor(65536*Math.random()).toString(16)};b.Appacitive.GUID=function(){var b=d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d(),e="",f,h,k,l,m,n,g=0,b=b.replace(/\r\n/g,"\n");h="";for(k=0;k<b.length;k++)l=b.charCodeAt(k),128>l?h+=String.fromCharCode(l):(127<l&&2048>l?h+=String.fromCharCode(l>>6|192):(h+=String.fromCharCode(l>>12|224),h+=String.fromCharCode(l>>6&63|128)),h+=String.fromCharCode(l&63|128));for(b=h;g<b.length;)f=b.charCodeAt(g++),h=b.charCodeAt(g++),
k=b.charCodeAt(g++),l=f>>2,f=(f&3)<<4|h>>4,m=(h&15)<<2|k>>6,n=k&63,isNaN(h)?m=n=64:isNaN(k)&&(n=64),e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n);return e.toString()}})(global);
(function(b){b.Appacitive.Object=function(c,d){c=c||{};d=d||{};this.className&&(c.__type=this.className);_type.isString(c)&&(c={__type:c});if(!c.__type)throw Error("Cannot set object without __type");_type.isBoolean(d)&&(d={setSnapShot:!0});b.Appacitive.BaseObject.call(this,c,d);this.type="object";this.getObject=this.getObject;this.children={};this.toJSON=function(b){if(b){var c=function(b){var d=[];b.forEach(function(b){var e=b.getObject();if(b.children&&!Object.isEmpty(b.children)){e.children={};
for(var f in b.children)e.children[f]=c(b.children[f])}b.connection&&(e.__connection=b.connection.toJSON());d.push(e)});return d};return c([this])[0]}return this.getObject()};this.typeName=c.__type;_type.isFunction(this.initialize)&&this.initialize.apply(this,[c]);return this};b.Appacitive.Object.prototype=new b.Appacitive.BaseObject;b.Appacitive.Object.prototype.constructor=b.Appacitive.Object;b.Appacitive.Object.extend=function(c,e,k){if(!_type.isString(c))throw Error("Appacitive.Object.extend's first argument should be the type-name.");
var l=null;e=e||{};e.className=c;l=b.Appacitive._extend(b.Appacitive.Object,e,k);delete l.extend;l.className=c;l.type=c;return d[c]=l};var d={},c=function(c){if(!_type.isString(c))throw"_getClass requires a string argument.";var e=d[c];e||(e=b.Appacitive.Object.extend(c),d[c]=e);return e};b.Appacitive.Object._getClass=c;b.Appacitive.Object._create=function(b,d,e){return(new (this.className?this:e?e:c(b.__type))(b)).copy(b,d)};var e=function(c,d){var e=[];c.forEach(function(c){c=b.Appacitive.Object._create(c,
!0,d);e.push(c)});return e};b.Appacitive.Object._parseResult=e;b.Appacitive.Object.multiDelete=function(c,d){c=c||{};d=d||{};var e=[];this.className&&(c.type=this.className);_type.isArray(c)&&0<c.length&&(e=c,c={type:e[0].className,ids:e.map(function(b){return b.id()}).filter(function(b){return b})});if(!c.type||!_type.isString(c.type)||0===c.type.length)throw Error("Specify valid type");if("user"===c.type.toLowerCase()||"device"===c.type.toLowerCase())throw Error("Cannot delete user and devices using multidelete");
if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var l=new b.Appacitive._Request({method:"POST",data:{idlist:c.ids},type:"object",op:"getMultiDeleteUrl",args:[c.type],callbacks:d,onSuccess:function(b){d&&!d.silent&&e.forEach(function(b){b.trigger("destroy",b,b.collection,d)});l.promise.fulfill()}});return l.send()};b.Appacitive.Object.multiGet=function(c,d){c=c||{};this.className&&(c.relation=this.className,c.entity=this);if(!c.type||!_type.isString(c.type)||0===c.type.length)throw Error("Specify valid type");
if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var k=new b.Appacitive._Request({method:"GET",type:"object",op:"getMultiGetUrl",args:[c.type,c.ids.join(","),c.fields],callbacks:d,onSuccess:function(b){k.promise.fulfill(e(b.objects,c.entity))}});return k.send()};b.Appacitive.Object.get=function(c){c=c||{};this.className&&(c.relation=this.className,c.entity=this);if(!c.type)throw Error("Specify type");if(!c.id)throw Error("Specify id to fetch");var d=b.Appacitive.Object._create({__type:c.type,
__id:c.id});d.fields=c.fields;return d.fetch(c)};b.Appacitive.Object.prototype.getConnections=function(c){if(this.isNew())throw Error("Cannot fetch connections for new object");c.objectId=this.get("__id");return new b.Appacitive.Queries.GetConnectionsQuery(c)};b.Appacitive.Object.prototype.getConnectedObjects=function(c){if(this.isNew())throw Error("Cannot fetch connections for new object");c=c||{};_type.isString(c)&&(c={relation:c});c.type=this.get("__type");c.objectId=this.get("__id");c.object=
this;return new b.Appacitive.Queries.ConnectedObjectsQuery(c)};b.Appacitive.Object.prototype.fetchConnectedObjects=b.Appacitive.Object.prototype.getConnectedObjects;b.Appacitive.Object.findAll=b.Appacitive.Object.findAllQuery=function(c){c=c||{};this.className&&(c.type=this.className,c.entity=this);return new b.Appacitive.Queries.FindAllQuery(c)}})(global);
(function(b){var d=function(c,d,e){var f={label:c.label};c.objectid&&(f.objectid=c.objectid);if(c.object)c.object instanceof b.Appacitive.Object?c.object.id()?f.objectid=c.object.id():f.object=c.object.getObject():_type.isObject(c.object)&&(c.object.__id?f.objectid=c.object.__id:f.object=c.object,c.object=b.Appacitive.Object._create(c.object));else if(!f.objectid&&!f.object)throw Error("Incorrectly configured endpoints provided to parseConnection");e["endpoint"+d]=c;return f},c=function(c,d,e){c.object&&
_type.isObject(c.object)?(e["endpoint"+d]?e["endpoint"+d]&&e["endpoint"+d].object&&e["endpoint"+d].object instanceof b.Appacitive.Object?e["endpoint"+d].object.copy(c.object,!0):e["endpoint"+d].object=b.Appacitive.Object._create(c.object,!0):(e["endpoint"+d]={},e["endpoint"+d].object=b.Appacitive.Object._create(c.object,!0)),e["endpoint"+d].objectid=c.object.__id,e["endpoint"+d].label=c.label,e["endpoint"+d].type=c.type):e["endpoint"+d]=c};b.Appacitive.Connection=function(d,e){d=d||{};e=e||{};this.className&&
(d.__relationtype=this.className);_type.isString(d)&&(d={__relationtype:d});if(!d.__relationtype&&!d.relation)throw Error("Cannot set connection without relation");d.relation&&(d.__relationtype=d.relation,delete d.relation);_type.isBoolean(e)&&(e={setSnapShot:!0});d.endpoints&&2===d.endpoints.length&&(d.__endpointa=d.endpoints[0],d.__endpointb=d.endpoints[1],delete d.endpoints);b.Appacitive.BaseObject.call(this,d,e);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b=
"A",e="B";d.__endpointa.label.toLowerCase()!==this.get("__endpointb").label.toLowerCase()||(d.__endpointa.label.toLowerCase()==d.__endpointb.label.toLowerCase()||d.__endpointa.objectid!=this.get("__endpointb").objectid&&d.__endpointa.objectid)||(b="B",e="A");c(this.get("__endpointa"),b,this);c(this.get("__endpointb"),e,this);this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===
arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b};return this};e.setSnapShot?this.parseConnection(d):d.__endpointa&&d.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));this.relationName=d.__relationtype;_type.isFunction(this.initialize)&&this.initialize.apply(this,[d]);return this};b.Appacitive.Connection.prototype=new b.Appacitive.BaseObject;b.Appacitive.Connection.prototype.constructor=
b.Appacitive.Connection;b.Appacitive.Connection.extend=function(c,d,f){if(!_type.isString(c))throw Error("Appacitive.Connection.extend's first argument should be the relation-name.");var h=null;d=d||{};d.className=c;h=b.Appacitive._extend(b.Appacitive.Connection,d,f);delete h.extend;h.className=c;h.relation=c;return e[c]=h};var e={},f=function(c){if(!_type.isString(c))throw"_getClass requires a string argument.";var d=e[c];d||(d=b.Appacitive.Connection.extend(c),e[c]=d);return d};b.Appacitive.Connection._getClass=
f;b.Appacitive.Connection._create=function(b,c,d){return(new (this.className?this:d?d:f(b.__relationtype))(b)).copy(b,c)};var h=function(c,d){var e=[];c||(c=[]);c.forEach(function(c){e.push(b.Appacitive.Connection._create(c,!0,d))});return e};b.Appacitive.Connection._parseResult=h;b.Appacitive.Connection.prototype.setupConnection=function(b,c){if(!(b&&(b.objectid||b.object)&&b.label&&c&&(c.objectid||c.object)&&c.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",
d(b,"A",this),{silent:!0});this.set("__endpointb",d(c,"B",this),{silent:!0});this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b}};b.Appacitive.Connection.prototype.get=b.Appacitive.Connection.get=
function(c,d){c=c||{};this.className&&(c.relation=this.className);if(!c.relation)throw Error("Specify relation");if(!c.id)throw Error("Specify id to fetch");var e=b.Appacitive.Connection._create({__relationtype:c.relation,__id:c.id});e.fields=c.fields;return e.fetch(d)};b.Appacitive.Connection.multiGet=function(c,d){c=c||{};this.className&&(c.relation=this.className,c.entity=this);if(!c.relation||!_type.isString(c.relation)||0===c.relation.length)throw Error("Specify valid relation");if(!c.ids||0===
c.ids.length)throw Error("Specify ids to delete");var e=new b.Appacitive._Request({method:"GET",type:"connection",op:"getMultiGetUrl",args:[c.relation,c.ids.join(","),c.fields],callbacks:d,onSuccess:function(b){e.promise.fulfill(h(b.connections,c.entity))}});return e.send()};b.Appacitive.Connection.multiDelete=function(c,d){c=c||{};d=d||{};var e=[];this.className&&(c.relation=this.className);_type.isArray(c)&&0<c.length&&(e=c,c={relation:e[0].className,ids:e.map(function(b){return b.id()}).filter(function(b){return b})});
if(!c.relation||!_type.isString(c.relation)||0===c.relation.length)throw Error("Specify valid relation");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var f=new b.Appacitive._Request({method:"POST",data:{idlist:c.ids},type:"connection",op:"getMultiDeleteUrl",args:[c.relation],callbacks:callbacks,onSuccess:function(b){d&&!d.silent&&e.forEach(function(b){b.trigger("destroy",b,b.collection,d)});f.promise.fulfill()}});return f.send()};b.Appacitive.Connection.findAll=b.Appacitive.Connection.findAllQuery=
function(c){c=c||{};this.className&&(c.relation=this.className,c.entity=this);return new b.Appacitive.Queries.FindAllQuery(c)};b.Appacitive.Connection.interconnectsQuery=b.Appacitive.Connection.getInterconnects=function(c){return new b.Appacitive.Queries.InterconnectsQuery(c)};b.Appacitive.Connection.betweenObjectsQuery=b.Appacitive.Connection.getBetweenObjects=function(c){return new b.Appacitive.Queries.GetConnectionsBetweenObjectsQuery(c)};b.Appacitive.Connection.betweenObjectsForRelationQuery=
b.Appacitive.Connection.getBetweenObjectsForRelation=function(c){c=c||{};this.className&&(c.relation=this.className,c.entity=this);return new b.Appacitive.Queries.GetConnectionsBetweenObjectsForRelationQuery(c)}})(global);
(function(b){var d=function(c,d){c=c||{};c.__type="user";b.Appacitive.Object.call(this,c,d);return this},c=null;d.currentUser=d.current=function(){return c};var e=function(c,d,e){var f=this.get("__id");if(!f||!_type.isString(f)||0===f.length)throw Error("Please specify valid userid");if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid oldPassword");if(!d||!_type.isString(d)||0===d.length)throw Error("Please specify valid newPassword");var g=this,h=new b.Appacitive._Request({method:"POST",
type:"user",op:"getUpdatePasswordUrl",args:[f],callbacks:e,data:{oldpassword:c,newpassword:d},entity:this,onSuccess:function(b){h.promise.fulfill(g)}});return h.send()},f=function(c,d){var e=this.get("__id");if(!this.get("__id"))return this.set("__link",c),b.Appacitive.Promise.buildPromise(d).fulfill(this);var f=this,g=new b.Appacitive._Request({method:"POST",type:"user",op:"getLinkAccountUrl",args:[e],callbacks:d,data:c,entity:this,onSuccess:function(b){b=f.get("__link");_type.isArray(b)||(b=b?[b]:
[]);b.push(c);f.copy({__link:b},!0);g.promise.fulfill(f)}});return g.send()};d.setCurrentUser=function(d,f,h){if(!d)throw Error("Cannot set null object as user");var n=d;if(n instanceof b.Appacitive.User)if(n.get("__id")&&0!==n.get("__id").length)d=n.toJSON();else throw Error("Specify user __id");else n=new b.Appacitive.User(d,!0);b.Appacitive.localStorage.set("Appacitive-User",d);h||(h=3600);c=n;f&&b.Appacitive.Session.setUserAuthHeader(f,h);c.logout=function(c){return b.Appacitive.Users.logout(c)};
c.updatePassword=function(b,c,d){return e.apply(this,[b,c,d])};c.logout=function(c){return b.Appacitive.Users.logout(c)};b.Appacitive.eventManager.clearAndSubscribe("type.user."+n.get("__id")+".updated",function(c,d){b.Appacitive.localStorage.set("Appacitive-User",d.object.getObject())});return c};d.prototype.linkedAccounts=function(){var b=this.get("__link");b?_type.isArray(b)||(b=[b]):b=[];return b};d.prototype.getAllLinkedAccounts=function(c){var d=this.get("__id");if(!d||!_type.isString(d)||0===
d.length)return b.Appacitive.Promise.buildPromise(c).fulfill(this.linkedAccounts(),this);var e=this,f=new b.Appacitive._Request({method:"GET",type:"user",op:"getGetAllLinkedAccountsUrl",args:[d],callbacks:c,entity:this,onSuccess:function(){var b=a.identities||[];0<b.length?e.set("__link",b):e.set("__link",null);f.promise.fulfill(b,e)}});return f.send()};d.prototype.checkin=function(c,d){var e=this.get("__id");e&&_type.isString(e)&&0!==e.length||onSuccess&&_type.isFunction(onSuccess)&&onSuccess();
if(!(c&&c instanceof b.Appacitive.GeoCoord))throw Error("Invalid coordinates provided");var f=this,g=new b.Appacitive._Request({method:"POST",type:"user",op:"getCheckinUrl",args:[e,c.lat,c.lngerId],callbacks:d,entity:this,onSuccess:function(){g.promise.fulfill(f)}});return g.send()};d.prototype.linkFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return f.apply(this,[{authtype:"facebook",accesstoken:b,name:"facebook"},c])};d.prototype.linkTwitter=function(b,
c){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var d={authtype:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret};b.consumerKey&&b.consumerSecret&&(d.consumersecret=b.consumerSecret,d.consumerkey=b.consumerKey);return f.apply(this,[d,c])};d.prototype.unlink=function(c,d){if(!_.isString(c))throw Error("Specify aouth account type for unlinking");var e=this.get("__id");if(!this.get("__id"))return this.set("__link",
null),promise.fulfill(this),promise;var f=this,g=new b.Appacitive._Request({method:"POST",type:"user",op:"getDelinkAccountUrl",args:[e,c],callbacks:d,entity:this,onSuccess:function(b){(b=f.get("__link"))?_type.isArray(b)||(b=[b]):b=[];if(0<=b.length){var d=null;b.forEach(function(b,e){b.name==c.toLowerCase()&&(d=e)});null!=d&&b.splice(d,1);f.copy({__link:b},!0)}else f.copy({__link:[]},!0);g.promise.fulfill(f)}});return g.send()};d.prototype.clone=function(){return new b.Appacitive.User(this.getObject())};
b.Appacitive.User=b.Appacitive.Object.extend("user",d.prototype);delete b.Appacitive.User._create;delete b.Appacitive.User._parseResult;delete b.Appacitive.User.multiDelete;d.deleteUser=function(c,d){if(!c)throw Error("Specify userid for user delete");return(new b.Appacitive.Object({__type:"user",__id:c})).del(!0,d)};d.deleteCurrentUser=function(d){var e=b.Appacitive.Promise.buildPromise(d);if(null===c)return b.Appacitive.Session.removeUserAuthHeader(),e.fulfill(),e;d=c.get("__id");this.deleteUser(d).then(function(){c=
null;b.Appacitive.Session.removeUserAuthHeader();e.fulfill()},function(){e.reject(arguments)});return e};d.createNewUser=function(c,d){c=c||{};c.__type="user";if(!c.username||!c.password||!c.firstname||0===c.username.length||0===c.password.length||0===c.firstname.length)throw Error("username, password and firstname are mandatory");return(new b.Appacitive.User(c)).save(d)};d.createUser=d.createNewUser;d.signup=function(c,d){var e=this,f=b.Appacitive.Promise.buildPromise(d);this.createUser(c).then(function(){e.login(c.username,
c.password).then(function(){f.fulfill.apply(f,arguments)},function(b){f.reject.apply(f,arguments)})},function(){f.reject(arguments)});return f};d.authenticateUser=function(d,e,f){d.expiry||(d.expiry=864E5);var h=this,g=new b.Appacitive._Request({method:"POST",type:"user",op:"getAuthenticateUserUrl",callbacks:e,data:d,onSuccess:function(e){e&&e.user?(f&&(e.user.__authType=f),h.setCurrentUser(e.user,e.token,d.expiry),b.Appacitive.User.trigger("login",c,c,e.token),g.promise.fulfill({user:c,token:e.token})):
g.promise.reject(e.status)}});return g.send()};d.login=function(b,c,d){if(!b||!c||0==b.length||0==c.length)throw Error("Please specify username and password");return this.authenticateUser({username:b,password:c,expiry:864E5},d,"BASIC")};d.loginWithFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return this.authenticateUser({accesstoken:b,type:"facebook",expiry:864E5,createnew:!0},c,"FB")};d.loginWithTwitter=function(b,c){if(!_type.isObject(b)||!b.oAuthToken||
!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var d={type:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret,expiry:864E5,createnew:!0};b.consumerKey&&b.consumerSecret&&(d.consumersecret=b.consumerSecret,d.consumerkey=b.consumerKey);return this.authenticateUser(d,c,"TWITTER")};d.validateCurrentUser=function(c,d){var e=b.Appacitive.Promise.buildPromise({success:d});d&&_type.isBoolean(d)&&(c=d,d=function(){});var f=b.Appacitive.localStorage.get("Appacitive-UserToken");
if(!f)return e.fulfill(!1),e;if(c)e.fulfill(!0);else try{var g=this;this.getUserByToken(f).then(function(b){g.setCurrentUser(b,f);e.fulfill(!0)},function(){e.fulfill(!1)})}catch(h){e.fulfill(!1)}return e};var h=function(c,d,e){var f=new b.Appacitive._Request({method:"GET",type:"user",op:c,callbacks:e,args:d,onSuccess:function(c){c&&c.user?f.promise.fulfill(new b.Appacitive.User(c.user)):f.promise.reject(c.status)}});return f.send()};d.getUserByToken=function(c,d){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid token");
b.Appacitive.Session.setUserAuthHeader(c,0,!0);return h("getUserByTokenUrl",[c],d)};d.getUserByUsername=function(b,c){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");return h("getUserByUsernameUrl",[b],c)};d.logout=function(d){c=null;return b.Appacitive.Session.removeUserAuthHeader(d)};d.sendResetPasswordEmail=function(c,d,e){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid username");if(!d||!_type.isString(d)||0===d.length)throw Error("Plase specify subject for email");
var f=new b.Appacitive._Request({method:"POST",type:"user",op:"getSendResetPasswordEmailUrl",callbacks:e,data:{username:c,subject:d},onSuccess:function(){f.promise.fulfill()}});return f.send()};d.resetPassword=function(c,d,e){if(!c)throw Error("Please specify token");if(!d||0===d.length)throw Error("Please specify password");var f=new b.Appacitive._Request({method:"POST",type:"user",op:"getResetPasswordUrl",callbacks:e,data:{newpassword:d},args:[c],onSuccess:function(){f.promise.fulfill()}});return f.send()};
d.validateResetPasswordToken=function(c,d){if(!c)throw Error("Please specify token");var e=new b.Appacitive._Request({method:"POST",type:"user",op:"getValidateResetPasswordUrl",callbacks:d,data:{},args:[c],onSuccess:function(b){e.promise.fulfill(b.user)}});return e.send()};b.Appacitive.Users=b.Appacitive.User;b.Appacitive.Events.mixin(b.Appacitive.User)})(global);
(function(b){b.Appacitive.Collection=function(b,c){c||(c={});c.model&&(this.model=c.model);if(!this.model)throw Error("Please specify model for collection");void 0!==c.comparator&&(this.comparator=c.comparator);c.query?this.query(c.query):this.query(new Appacitive.Query(this.model));this._reset();this.initialize.apply(this,arguments);b&&this.reset(b,{silent:!0})};b.Appacitive.Events.mixin(b.Appacitive.Collection.prototype);_extend(b.Appacitive.Collection.prototype,{models:[],initialize:function(){},
_query:null,toJSON:function(b){return this.models.map(function(c){return c.toJSON(b)})},add:function(b,c){c=c||{};var e,f,h,k,l,m={},n={},g=[],p=c.sort,q;b=_type.isArray(b)?b.slice():[b];e=0;for(f=b.length;e<f;e++){b[e]=this._prepareModel(b[e]);h=b[e];if(!h)throw Error("Can't add an invalid model to a collection");k=h.cid;if(m[k]||this._byCid[k])throw Error("Duplicate cid: can't add the same model to a collection twice");(l=h.id())&&((q=n[l])||(q=this._byId[l]))?(q.copy(h.toJSON(),c.setSnapShot),
q.children=h.children):(n[l]=h,m[k]=h,g.push(h),this._addReference(h,c))}this.models.splice.apply(this.models,[null!=c.at?c.at:this.models.length,0].concat(g));p&&this.comparator&&this.sort({silent:!0});this.length=this.models.length;if(c.silent)return this;e=0;for(f=g.length;e<f;e++)h=g[e],c.index=e,h.trigger("add",h,this,c);return this},remove:function(b,c){var e,f,h,k;c=c||{};b=_type.isArray(b)?b.slice():[b];e=0;for(f=b.length;e<f;e++)if(k=this.getByCid(b[e])||this.get(b[e]))delete this._byId[k.id()],
delete this._byCid[k.cid],h=this.models.indexOf(k),this.models.splice(h,1),this.length--,c.silent||(c.index=h,k.trigger("remove",k,this,c)),this._removeReference(k);return this},push:function(b,c){return this.add(b,_extend({at:this.length},c))},pop:function(b){var c=this.at(this.length-1);this.remove(c,b);return c},unshift:function(b,c){return this.add(b,_extend({at:0},c))},shift:function(b){var c=this.at(0);this.remove(c,b);return c},slice:function(){return Array.prototype.slice.apply(this.models,
arguments)},get:function(d){return d&&this._byId[d instanceof b.Appacitive.BaseObject?d.id():d]},query:function(d){if(d){if(d instanceof b.Appacitive.Query||d instanceof b.Appacitive.Queries.GraphProjectQuery)return this._query=d,this;throw Error("Cannot bind this query");}return this._query},getByCid:function(b){return b&&this._byCid[b.cid||b]},at:function(b){return this.models[b]},where:function(b,c){return Object.isEmpty(b)?c?void 0:[]:this.models[c?"find":"filter"](function(c){for(var f in b)if(b[f]!==
c.get(f))return!1;return!0})},findWhere:function(b){return this.where(b,!0)},sort:function(b){b=b||{};if(!this.comparator)throw Error("Cannot sort a set without a comparator");1===this.comparator.length?this.models=this.models.sortBy(this.comparator):this.models.sort(this.comparator.bind(this.models));b.silent||this.trigger("reset",this,b);return this},pluck:function(b){return this.models.map(function(c){return c.get(b)})},first:function(){return 0<this.length?this.models[0]:null},last:function(){return 0<
this.length?this.models[this.length-1]:null},reset:function(b,c){c||(c={});for(var e=0,f=this.models.length;e<f;e++)this._removeReference(this.models[e],c);this._reset();this.add(b,_extend({silent:!0},c));c.silent||this.trigger("reset",this,c);return this},fetch:function(d){d=_clone(d)||{};var c=this,e=this.query()||new b.Appacitive.Query(this.model),f=b.Appacitive.Promise.buildPromise(d);e.fetch(d).then(function(b){d.add?c.add(b,_extend({setSnapShot:!0},d)):c.reset(b,d);f.fulfill(c)},function(){f.reject.apply(f,
arguments)});return f},mutiGet:function(d){d=_clone(d)||{};var c=this,e=b.Appacitive.Promise.buildPromise(d),f=d.ids||[];if(0==f.length)return e.fulfill(c);f={ids:f,fields:d.fields};f[this.model.type||this.model.relation]=this.model.className;b.Appacitive.Object.multiGet(f).then(function(b){d.add?c.add(b,d):c.reset(b,d);e.fulfill(c)},function(){e.reject.apply(e,arguments)});return e},create:function(b,c){var e=this;c=c?_clone(c):{};if(!(b=this._prepareModel(b,c)))return!1;c.wait||this.add(b,c);var f=
c.success;c.success=function(){c.wait&&e.add(b,_extend({setSnapShot:!0},c));f&&f(b,e)};b.save(c);return b},_reset:function(b){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(d){d instanceof b.Appacitive.BaseObject||(d=new this.model(d));d.collection||(d.collection=this);return d},_addReference:function(b){this._byId[b.cid]=b;null!=b.id()&&(this._byId[b.id()]=b);this._byCid[b.cid]=b;b.on("all",this._onModelEvent,this)},_removeReference:function(b){this===b.collection&&
delete b.collection;b.off("all",this._onModelEvent,this)},_onModelEvent:function(b,c,e,f){if("add"!==b&&"remove"!==b||e===this)"destroy"===b&&this.remove(c,f),c&&"change:__id"===b&&(delete this._byId[c.previous("__id")],this._byId[c.id()]=c),this.trigger.apply(this,arguments)}});b.Appacitive.Collection.extend=function(d,c){d&&d.query&&(d._query=d.query,delete d.query);var e=b.Appacitive._extend(this,d,c);e.extend=this.extend;return e};"forEach each map find filter every some indexOf lastIndexOf isEmpty".split(" ").each(function(d){b.Appacitive.Collection.prototype[d]=
function(){var b=Array.prototype.slice.call(arguments);return Array.prototype[d].apply(this.models,b)}})})(global);
(function(b){var d=function(){var c=null,d=this.FB=null,f=!1;this.initialize=function(b){if(!Facebook)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!b.appId)throw Error("Please provide appid");if(!b.appSecret)throw Error("Please provide app secret");d=b.appSecret;this.FB=new (require("facebook-node-sdk"))({appId:_appId,secret:d});f=!0};this.requestLogin=function(b){b&&(c=b);return(new Appacitive.Promise).fulfill()};this.getCurrentUserInfo=function(){if(!f)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
var b=new Appacitive.Promise;this.FB&&c?this.FB.api("/me",function(c,d){d?b.fulfill(d):b.reject("Access token is invalid")}):b.reject("Either intialize facebook with your appid and appsecret or set accesstoken");return b};this.accessToken=function(){return 1===arguments.length?(c=arguments[0],this):c};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){b.Appacitive.Facebook.accessToken="";return(new Appacitive.Promise).fulfill()}};b.Appacitive.Facebook=
b.Appacitive.runtime.isBrowser?new function(){var c=null,d=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);d=!0};this.requestLogin=function(b){b=b||{};if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var h=new Appacitive.Promise;FB.login(function(b){b&&"connected"===b.status&&b.authResponse?(c=b.authResponse.accessToken,h.fulfill(b.authResponse)):
h.reject()},b);return h};this.getCurrentUserInfo=function(){if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var b=new Appacitive.Promise;FB.api("/me",function(d){d&&!d.error?(c=FB.getAuthResponse().accessToken,b.fulfill(d)):b.reject()});return b};this.accessToken=function(){return 1===arguments.length?(c=arguments[0],this):c};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){c=null;var d=new Appacitive.Promise;
try{FB.logout(function(){b.Appacitive.Users.logout();d.fulfill()})}catch(e){d.reject(e.message)}return d}}:new d})(global);
(function(b){b.Appacitive.Email=new function(){var d={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return d};var c=function(c,d){var h=new b.Appacitive._Request({method:"POST",type:"email",op:"getSendEmailUrl",callbacks:d,data:c,entity:c,onSuccess:function(b){h.promise.fulfill(b.email)}});return h.send()};this.setupEmail=function(b){b=b||{};d.smtp.username=b.username||d.smtp.username;d.from=b.from||d.from;d.smtp.password=
b.password||d.smtp.password;d.smtp.host=b.smtp.host||d.smtp.host;d.smtp.port=b.smtp.port||d.smtp.port;d.smtp.enablessl=b.enableSSL||d.smtp.enablessl;d.replyto=b.replyTo||d.replyto};this.sendTemplatedEmail=function(b,f){if(!b||!b.to||!b.to.length||0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");
if(!b.templateName)throw Error("template name is mandatory to send an email");var h={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){h.smtp=d.smtp;if(!b.from&&!d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");h.from=b.from||d.from;h.replyto=b.replyTo||d.replyto}return c(h,f)};this.sendRawEmail=function(b,f){if(!b||!b.to||!b.to.length||
0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.body)throw Error("body is mandatory to send an email");var h={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{content:b.body||"",ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){h.smtp=
d.smtp;if(!b.from&&!d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");h.from=b.from||d.from;h.replyto=b.replyTo||d.replyto}return c(h,f)}}})(global);
(function(b){b.Appacitive.Push=new function(){this.send=function(d,c){if(!d)throw Error("Please specify push options");var e=new b.Appacitive._Request({method:"POST",type:"push",op:"getPushUrl",callbacks:c,data:d,entity:d,onSuccess:function(b){e.promise.fulfill(b.id)}});return e.send()};this.getNotification=function(d,c){if(!d)throw Error("Please specify notification id");var e=new b.Appacitive._Request({method:"GET",type:"push",op:"getGetNotificationUrl",args:[d],callbacks:c,onSuccess:function(b){e.promise.fulfill(b.pushnotification)}});
return e.send()};this.getAllNotifications=function(d,c){d?(d.pnum=d.pnum||1,d.psize=d.psize||20):d={pnum:1,psize:20};var e=new b.Appacitive._Request({method:"GET",type:"push",op:"getGetAllNotificationsUrl",args:[d],callbacks:c,onSuccess:function(b){e.promise.fulfill(b.pushnotifications,b.paginginfo)}});return e.send()}}})(global);
(function(b){b.Appacitive.File=function(d){d=d||{};this.fileId=d.fileId;this.contentType=d.contentType;this.fileData=d.fileData;var c=this,e=function(d,e,f,g){var k=new b.Appacitive.HttpRequest;k.url=d;k.method="GET";k.description=g;k.onSuccess=e;k.promise=f;k.entity=c;b.Appacitive.http.send(k)},f=function(d,e,f,g,k){var h=new b.Appacitive.HttpRequest;h.url=d;h.method="PUT";h.log=!1;h.description="Upload file";h.data=e;h.headers.push({key:"Content-Type",value:f});h.send().then(g,function(b){k.reject(b,
c)})};this.save=function(b){return this.fileId&&_type.isString(this.fileId)&&0<this.fileId.length?k(b):h(b)};var h=function(d){if(!c.fileData)throw Error("Please specify filedata");if(!c.contentType)try{c.contentType=c.fileData.type}catch(k){}c.contentType&&_type.isString(c.contentType)&&0!==c.contentType.length||(c.contentType="text/plain");var h=b.Appacitive.Promise.buildPromise(d);d=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(c.contentType,c.fileId?c.fileId:
"");e(d,function(b){f(b.url,c.fileData,c.contentType,function(){c.fileId=b.id;c.getDownloadUrl().then(function(b){return h.fulfill(b,c)},function(b){return h.reject(b)})},h)},h," Get upload url for file ");return h},k=function(d){if(!c.fileData)throw Error("Please specify filedata");if(!c.contentType)try{c.contentType=c.fileData.type}catch(k){}c.contentType&&_type.isString(c.contentType)&&0!==c.contentType.length||(c.contentType="text/plain");var h=b.Appacitive.Promise.buildPromise(d);d=b.Appacitive.config.apiBaseUrl+
b.Appacitive.storage.urlFactory.file.getUpdateUrl(c.fileId,c.contentType);e(d,function(b){f(b.url,c.fileData,c.contentType,function(){c.getDownloadUrl().then(function(b){h.fulfill(b,c)},function(b){h.reject(b)})},h)},h," Get update url for file "+c.fileId);return h};this.deleteFile=function(d){if(!this.fileId)throw Error("Please specify fileId to delete");var e=b.Appacitive.Promise.buildPromise(d);d=new b.Appacitive.HttpRequest;d.url=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.description="Delete file with id "+this.fileId;d.onSuccess=function(b){e.fulfill()};d.promise=e;d.entity=c;return b.Appacitive.http.send(d)};this.getDownloadUrl=function(d,f){if(!this.fileId)throw Error("Please specify fileId to download");"number"!==typeof d&&(f=d,d=-1);var h=b.Appacitive.Promise.buildPromise(f),g=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,d);e(g,function(b){c.url=b.uri;h.fulfill(b.uri)},h," Get download url for file "+
this.fileId);return h};this.getUploadUrl=function(d){c.contentType&&_type.isString(c.contentType)&&0!==c.contentType.length||(c.contentType="text/plain");var f=b.Appacitive.Promise.buildPromise(d);d=b.Appacitive.config.apiBaseUrl+b.Appacitive.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");e(d,function(b){c.url=b.url;f.fulfill(b.url,c)},f," Get upload url for file "+this.fileId);return f}}})(global);
(function(b){b.Appacitive.Date={};var d=function(b){return 10>b?"0"+b:b};b.Appacitive.Date.parseISODate=function(b){try{if(!/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(b))return new Date(b);var d=b.split("T"),f=d[0].split("-"),h=d[1].split("Z")[0].split(":"),k=h[2].split("."),l=Number(h[0]),m=new Date;m.setUTCFullYear(Number(f[0]));m.setUTCMonth(Number(f[1])-1);m.setUTCDate(Number(f[2]));m.setUTCHours(Number(l));m.setUTCMinutes(Number(h[1]));
m.setUTCSeconds(Number(k[0]));k[1]&&m.setUTCMilliseconds(Number(k[1].substring(0,3)));return m}catch(n){return null}};b.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(d){return null}};b.Appacitive.Date.toISODate=function(b){if(b instanceof Date)return String.format("{0}-{1}-{2}",b.getFullYear(),d(b.getMonth()+1),d(b.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};b.Appacitive.Date.toISOTime=function(b){var e=
function(b){return 10>b?b+"000000":100>b?b+"00000":1E3>b?b+"0000":1E4>b?b+"000":1E5>b?b+"00":1E6>b?b+"0":b};if(b instanceof Date)return String.format("{0}:{1}:{2}.{3}",d(b.getHours()),d(b.getMinutes()),d(b.getSeconds()),e(b.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};b.Appacitive.Date.parseISOTime=function(b){try{var d=new Date,f=b.split("T");1===f.length&&f.push(f[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(f[1]))return null;
var h=f[1].split("Z")[0].split(":"),k=h[2].split("."),l=Number(h[0]);1<f.length?(d.setUTCHours(Number(l)),d.setUTCMinutes(Number(h[1])),d.setUTCSeconds(Number(k[0])),k[1]&&d.setUTCMilliseconds(Number(k[1].substring(0,3)))):(d.setHours(Number(l)),d.setMinutes(Number(h[1])),d.setSeconds(Number(k[0])),k[1]&&d.setMilliseconds(Number(k[1].substring(0,3))));return d}catch(m){return null}}})(global);
(function(b){b.Appacitive.localStorage=new (b.Appacitive.runtime.isBrowser?function(){var d=b.Appacitive.runtime.isBrowser?window.localStorage:{getItem:function(){return null}},c=function(){try{return d.setItem("test","1"),d.removeItem("test"),!0}catch(b){return!1}};this.set=function(e,f){f=f||"";if(!e)return!1;if(_type.isObject(f)||_type.isArray(f))try{f=JSON.stringify(f)}catch(h){}c()?(e=b.Appacitive.getAppPrefix(e),d[e]=f):b.Appacitive.Cookie.setCookie(e,f);return this};this.get=function(e){if(!e)return null;
c()?(e=b.Appacitive.getAppPrefix(e),e=d.getItem(e)):e=b.Appacitive.Cookie.readCookie(e);if(!e)return null;if("{"===e[0])try{e=JSON.parse(e)}catch(f){}return e};this.remove=function(e){if(e)if(c()){e=b.Appacitive.getAppPrefix(e);try{delete d[e]}catch(f){}}else b.Appacitive.Cookie.eraseCookie(e)}}:function(){var d=[];this.set=function(c,e){e=e||"";if(!c||_type.isString(c))return!1;c=b.Appacitive.getAppPrefix(c);d[c]=e;return this};this.get=function(c){if(!c||_type.isString(c))return null;c=b.Appacitive.getAppPrefix(c);
return(c=d[c])?c:null};this.remove=function(c){if(c&&!_type.isString(c)){c=b.Appacitive.getAppPrefix(c);try{delete d[c]}catch(e){}}}})})(global);
(function(b){b.Appacitive.Cookie=new (b.Appacitive.runtime.isBrowser?function(){this.setCookie=function(d,c,e,f){d=b.Appacitive.getAppPrefix(d);var h="";e&&(h=new Date,h.setTime(h.getTime()+6E4*e),h.toGMTString());h=f?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";e="domain="+window.location.hostname;"localhost"==window.location.hostname&&(e="");document.cookie=d+"="+c+h+"; path=/;"+e};this.readCookie=function(d){d=
b.Appacitive.getAppPrefix(d);d+="=";for(var c=document.cookie.split(";"),e=0;e<c.length;e++){for(var f=c[e];" "==f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(d))return f.substring(d.length,f.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}}:function(){this.setCookie=function(d,c){b.Appacitive.localStorage.set("cookie/"+d,c)};this.readCookie=function(d){return b.Appacitive.localStorage.get("cookie/"+d)};this.eraseCookie=function(d){b.Appacitive.localStorage.remove("cookie/"+
d)}})})(global);"undefined"===typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
