"bind"in Function.prototype||(Function.prototype.bind=function(c){var e=this;if(1>=arguments.length)return function(){return e.apply(c,arguments)};var b=Array.prototype.slice.call(arguments,1);return function(){return e.apply(c,0===arguments.length?b:b.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
"indexOf"in Array.prototype||(Array.prototype.indexOf=function(c,e){void 0===e&&(e=0);0>e&&(e+=this.length);0>e&&(e=0);for(var b=this.length;e<b;e++)if(e in this&&this[e]===c)return e;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(c,e){void 0===e&&(e=this.length-1);0>e&&(e+=this.length);e>this.length-1&&(e=this.length-1);for(e++;0<e--;)if(e in this&&this[e]===c)return e;return-1});
"forEach"in Array.prototype||(Array.prototype.forEach=function(c,e){for(var b=0,f=this.length;b<f;b++)b in this&&c.call(e,this[b],b,this)});"map"in Array.prototype||(Array.prototype.map=function(c,e){for(var b=Array(this.length),f=0,h=this.length;f<h;f++)f in this&&(b[f]=c.call(e,this[f],f,this));return b});"filter"in Array.prototype||(Array.prototype.filter=function(c,e){for(var b=[],f,h=0,l=this.length;h<l;h++)h in this&&c.call(e,f=this[h],h,this)&&b.push(f);return b});
"every"in Array.prototype||(Array.prototype.every=function(c,e){for(var b=0,f=this.length;b<f;b++)if(b in this&&!c.call(e,this[b],b,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=function(c,e){for(var b=0,f=this.length;b<f;b++)if(b in this&&c.call(e,this[b],b,this))return!0;return!1});"find"in Array.prototype||(Array.prototype.find=function(c,e){var b=this.length;if(0!==b)for(var f=0,h;f<b&&f in this;f++)if(h=this[f],c.call(e,h,f,this))return h});
"each"in Array.prototype||(Array.prototype.each=function(c,e){for(var b=0;b<this.length;b++)c.apply(e,[this[b]])});var _lookupIterator=function(c,e){return null==c?_.identity:_.isFunction(c)?e?function(){return c.apply(e,arguments)}:c:function(b){return b[c]}};Array.prototype.pluck=function(c){var e=[];this.each(function(b){e.push(b[c])});return e};
Array.prototype.sortBy=function(c,e){c=_lookupIterator(c,e);return this.map(function(b,f){return{value:b,criteria:c.call(e,b,f,this)}},this).sort(function(b,c){var e=b.criteria,l=c.criteria;return e<l?-1:e>l?1:0}).pluck("value")};
Date.prototype.toISOString||function(){function c(c){c=String(c);1===c.length&&(c="0"+c);return c}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();
String.addSlashes=function(c){if(!c)return c;c=c.replace(/\\/g,"\\\\");c=c.replace(/\'/g,"\\'");c=c.replace(/\"/g,'\\"');return c=c.replace(/\0/g,"\\0")};String.stripSlashes=function(c){if(!c)return c;c=c.replace(/\\'/g,"'");c=c.replace(/\\"/g,'"');c=c.replace(/\\0/g,"\x00");return c=c.replace(/\\\\/g,"\\")};if("undefined"===typeof console||null===console)console={log:function(){},dir:function(){}};
for(var _type=function(c){if(null===c||"undefined"===typeof c||"undefined"===c)return"null";if(c&&(1===c.nodeType||9===c.nodeType))return"element";var e=Object.prototype.toString.call(c).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===e){if(isNaN(c))return"nan";if(!isFinite(c))return"infinity"}return e},types="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),generateMethod=function(c){_type["is"+c]=function(e){return _type(e)===c.toLowerCase()}},
i=0;i<types.length;i++)generateMethod(types[i]);_type.isNullOrUndefined=function(c){return"null"==_type(c)||"undefined"==_type(c)};_type.isNumeric=function(c){return!isNaN(parseFloat(c))&&isFinite(c)};var _clone=function(c){return _type.isObject(c)?_type.isArray(c)?c.slice():_extend({},c):c};Array.prototype.removeAll=function(c){for(var e=null,b=0;b<this.length;b++)for(;this[b]===c;)e=this.splice(b,1)[0];return e};
Array.prototype.compare=function(c){if(!c||this.length!=c.length)return!1;for(var e=0,b=this.length;e<b;e++)if(this[e]instanceof Array&&c[e]instanceof Array){if(!this[e].compare(c[e]))return!1}else if(this[e]!=c[e])return!1;return!0};
Array.prototype.equals=function(c,e){if(!c)return!1;1==arguments.length&&(e=!1);if(this.length!=c.length)return!1;for(var b=0;b<this.length;b++)if(this[b]instanceof Array&&c[b]instanceof Array){if(!this[b].equals(c[b],e))return!1}else{if(e&&this[b]!=c[b])return!1;if(!e)return this.sort().equals(c.sort(),!0)}return!0};var global={};
(function(){global="undefined"===typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var c=function(b){if(b&&b.send&&_type.isFunction(b.send))b.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],e={},f=0,h={},l=0;this.addProcessor=function(b){b&&(b.pre=b.pre||function(){},b.post=b.post||function(){},r(b.pre),t(b.post))};var r=function(b){f+=1;e[f]=b;return f},
t=function(b){l+=1;h[l]=b;return l};this.enqueueRequest=function(b){c.push(b)};this.changeRequestForCors=function(b){var g={m:b.method.toUpperCase()};b.headers.forEach(function(b){g[b.key]=b.value});b.prevHeaders=b.headers;b.headers=[];b.headers.push({key:"Content-Type",value:"text/plain; charset=utf-8"});b.method="POST";b.data&&(g.b=b.data);delete b.data;global.Appacitive.config.debug&&(-1===b.url.indexOf("?")?b.url+="?debug=true":b.url+="&debug=true");try{b.data=JSON.stringify(g)}catch(c){}return b};
this.notify=function(){if(0!==c.length){var f=[],l;for(l in h)h.hasOwnProperty(l)&&f.push(h[l]);for(;0<c.length;){var p=c.shift(),q=[];for(l in e)e.hasOwnProperty(l)&&q.push(e[l](p));this.changeRequestForCors(p);b.send(p,f,q)}}};this.onResponse=function(b){console.dir(b)}},e=function(){var b=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=b;this.onResponse=function(c,f){b()};this.onError=function(c){b()}},b=null,b=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest,
f=function(b){var c=global.Appacitive.Promise.buildPromise({success:b.onSuccess,error:b.onError}),f=new XDomainRequest;f.onload=function(){var b=f.responseText;try{var g=f.contentType;if("application/json"==g.toLowerCase()||"application/javascript"==g.toLowerCase()||"application/json; charset=utf-8"==g.toLowerCase()||"application/json; charset=utf-8;"==g.toLowerCase())g=b,global.Appacitive.runtime.isBrowser||"{"!=g[0]&&(g=g.substr(1,g.length-1)),b=JSON.parse(g)}catch(e){}c.fulfill(b,this)};f.onerror=
f.ontimeout=function(){c.reject(f)};f.onprogress=function(){};-1===b.url.indexOf("?")?b.url+="?ua=ie":b.url+="&ua=ie";f.open(b.method,b.url,!0);f.send(b.data);return c},h=function(g){if(!g.url)throw Error("Please specify request url");g.method||(g.method="GET");g.headers||(g.headers=[]);var c={};g.onSuccess&&_type.isFunction(g.onSuccess)||(g.onSuccess=function(){});g.onError&&_type.isFunction(g.onError)||(g.onError=function(){});var e=global.Appacitive.Promise.buildPromise({success:g.onSuccess,error:g.onError}),
h=!0;g.headers.forEach(function(b){"content-type"==b.key.toLowerCase()&&(h=!0,"application/json"==b.value.toLowerCase()||"application/javascript"==b.value.toLowerCase()||"application/json; charset=utf-8"==b.value.toLowerCase()||"application/json; charset=utf-8;"==b.value.toLowerCase())&&(h=!1)});if(h)c=g.data;else if(g.data&&(c=g.data,_type.isObject(g.data)))try{c=JSON.stringify(c)}catch(k){}if(!global.navigator||-1==global.navigator.userAgent.indexOf("MSIE 8")&&-1==global.navigator.userAgent.indexOf("MSIE 9")){var l=
new b;l.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var b=this.responseText;try{var c=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==c.toLowerCase()||"application/javascript"==c.toLowerCase()||"application/json; charset=utf-8"==c.toLowerCase()||"application/json; charset=utf-8;"==c.toLowerCase())c=b,global.Appacitive.runtime.isBrowser||"{"!=c[0]&&(c=c.substr(1,c.length-1)),b=JSON.parse(c)}catch(g){}e.fulfill(b,
this)}else e.reject(this)};l.open(g.method,g.url,!0);for(var r=0;r<g.headers.length;r+=1)l.setRequestHeader(g.headers[r].key,g.headers[r].value);global.Appacitive.runtime.isBrowser||l.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");l.send(c);return e}g.data=c;return new f(g)},l=function(){var b=new e;b.isOnline=function(){return!0};var c=function(c,f,e){new h({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(h,l){if(h){try{h=JSON.parse(h)}catch(m){}var u=h;if(f.length!=
e.length)throw Error("Callback length and state length mismatch!");for(var v=0;v<f.length;v+=1)f[v].apply({},[u,e[v]]);if("200"<=h.code&&"300">=h.code||h.status&&"200"<=h.status.code&&"300">=h.status.code)b.onResponse(c,h);else h=h||{},h=h.status||h,h.message=h.message||"Bad Request",h.code=h.code||"400",b.onError(c,{responseText:JSON.stringify(h)})}else b.onError(c,{responseText:JSON.stringify({code:"400",message:"Invalid request"})})},onError:function(h){var f={};f.message=h.responseText||"Bad Request";
f.code=h.status||"400";b.onError(c,{responseText:JSON.stringify(f)})}})};b.send=function(b,g,h){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");_type.isFunction(b.beforeSend)&&b.beforeSend(b);c(b,g,h)};return b};global.Appacitive.http=new function(){var b=new l,h=new c(b),f=!1;this.pause=function(){f=!0};this.unpause=function(){f=!1};this.addProcessor=function(b){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!b)throw c;
if(!b.pre&&!b.post)throw c;h.addProcessor(b)};this.send=function(c){c.promise=global.Appacitive.Promise.is(c.promise)?c.promise:new global.Appacitive.Promise.buildPromise({error:c.onError});h.enqueueRequest(c);b.isOnline()&&!1===f&&h.notify();return c.promise};this.flush=function(c){c?h.notify():b.isOnline()&&h.notify()};this.onError=function(b,c){var g;if(c&&c.responseText)try{g=JSON.parse(c.responseText)}catch(h){}else c={responseText:""};g=g||{code:c.status,message:c.responseText,referenceid:c.headers.TransactionId};
global.Appacitive.logs.logRequest(b,g,g,"error");b.promise.reject(g,b.entity)};b.onError=this.onError;this.onResponse=function(b,c){if(b.onSuccess)if(b.context)b.onSuccess.apply(b.context,[c]);else b.onSuccess(c);global.Appacitive.logs.logRequest(b,c,c?c.status:null,"successful")};b.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(b){b=b||{};this.url=b.url||"";this.data=b.data||{};this.headers=b.headers||[];this.method=b.method||"GET";this.onSuccess=b.onSuccess||function(){};this.onError=
b.onError||function(){};this.send=function(b){return new h(this,b)}};(function(b){b.Appacitive&&b.Appacitive.http&&(b.Appacitive.http.addProcessor({pre:function(b){return b},post:function(c,h){try{var f=b.Appacitive.Session.isSessionValid(c);f.status?c&&(c.status&&c.status.code&&("19036"==c.status.code||"421"==c.status.code)||c.code&&("19036"==c.code||"421"==c.code))?b.Appacitive.Users.logout():b.Appacitive.Session.incrementExpiry():f.isSession&&(null!==b.Appacitive.Session.get()&&b.Appacitive.Session.resetSession(),
b.Appacitive.http.send(h))}catch(e){}}}),b.Appacitive.http.addProcessor({pre:function(b){return{start:(new Date).getTime(),request:b}},post:function(b,c){c.request.timeTakenInMilliseconds=(new Date).getTime()-c.start}}))})(global)})(this);
(function(c){c.Appacitive.logs={};var e=function(b,c){setTimeout(function(){try{b.call({},c)}catch(h){}},0)};c.Appacitive.logs.logRequest=function(b,f,h,l){f=f||{};h=h||{};var g={};try{g=JSON.parse(b.data),_type.isObject(g)||(g={})}catch(m){}var n={status:l,referenceId:h.referenceid,date:(new Date).toISOString(),method:g.m,url:decodeURIComponent(b.url),responseTime:b.timeTakenInMilliseconds,headers:{},request:null,response:f,description:b.description};b.headers&&b.headers.forEach(function(b){n.headers[b.key]=
b.value});b.prevHeaders&&b.prevHeaders.forEach(function(b){n.headers[b.key]=b.value});"GET"!==n.method&&(n.request=g.b);"error"==l&&(c.Appacitive.runtime.isBrowser&&console.dir(n),_type.isFunction(c.Appacitive.logs.apiErrorLog)&&e(c.Appacitive.logs.apiErrorLog,n));_type.isFunction(c.Appacitive.logs.apiLog)&&e(c.Appacitive.logs.apiLog,n)};c.Appacitive.logs.logException=function(b){_type.isFunction(c.Appacitive.logs.exceptionLog)&&e(c.Appacitive.logs.exceptionLog,b)}})(global);
(function(c){String.format=function(c,b){if(1>=arguments.length)return c;for(var f=arguments.length-2,h=0;h<=f;h++)c=c.replace(RegExp("\\{"+h+"\\}","gi"),arguments[h+1]);return c};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(c){var b=RegExp("^"+c),f=this;b.test(f)&&(f=f.slice(1,f.length));b=RegExp(c+"$");b.test(f)&&(f=f.slice(0,-1));return f};String.toSearchString=function(c){"undefined"===typeof c&&(c="");for(var b=
"",f=0;f<c.length;f+=1)-1===" .,;#".indexOf(c[f])&&(b+=c[f]);return b=b.toLowerCase()};String.contains=function(c,b){return-1!==c.indexOf(b)};String.startsWith=function(c,b){return 0===c.indexOf(b)};Array.distinct=function(c){var b=[],f=c.length,h,l,g;for(l=0;l<f;l++){h=void 0;for(g=0;g<b.length;g++)if(c[l].toLowerCase()===b[g].toLowerCase()){h=!0;break}h||b.push(c[l])}return b};Object.isEmpty=function(c){if(!c)return!0;var b=!0,f;for(f in c){b=!1;break}return b};c.dateFromWcf=function(c,b){var f=
/Date\(([^)]+)\)/.exec(c);if(2!=f.length){if(!b)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(f[1]))};c.Appacitive.storage=c.Appacitive.storage||{};c.Appacitive.storage.urlFactory=new function(){c.Appacitive.bag=c.Appacitive.bag||{};var e=function(b){"object"===typeof b&&(0<b.length&&("string"===typeof b[0]||"number"===typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.application={applicationServiceUrl:"application",getSessionCreateUrl:function(){return String.format("{0}/session",
this.applicationServiceUrl)}};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(b,c){return String.format("{0}/create?fields={1}",this.userServiceUrl,e(c))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c,h){return String.format("{0}/{1}?fields={2}",b,c,e(h))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token={1}",
this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",this.userServiceUrl,b)},getUpdateUrl:function(b,c,h){return h?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,b,e(c),h):String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,e(c))},getDeleteUrl:function(b,c,h){return!0===h?String.format("{0}/{1}?deleteconnections=true",this.userServiceUrl,c):String.format("{0}/{1}",this.userServiceUrl,c)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",
this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",
this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,h){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,b,c,h)},getResetPasswordUrl:function(b){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,b)},getValidateResetPasswordUrl:function(b){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,b)}};this.device={deviceServiceUrl:"device",
getCreateUrl:function(b,c){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,e(c))},getGetUrl:function(b,c,h){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,c,e(h))},getUpdateUrl:function(b,c,h){return h?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,b,e(c),h):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,e(c))},getDeleteUrl:function(b,c,h){return!0===h?String.format("{0}/{1}?deleteconnections=true",this.deviceServiceUrl,c):String.format("{0}/{1}",
this.deviceServiceUrl,c)}};this.object={objectServiceUrl:"object",getSearchAllUrl:function(b,c,h){var e="",e=String.format("{0}/search/{1}/all",this.objectServiceUrl,b),e=h?e+"?psize="+h:e+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!==c[b].trim().length&&(e=e+"&"+c[b]);return e},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.objectServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",
this.objectServiceUrl,b,c)},getMultiGetUrl:function(b,c,h){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.objectServiceUrl,b,c,e(h))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.objectServiceUrl,b,e(c))},getGetUrl:function(b,c,h){return String.format("{0}/{1}/{2}?fields={3}",this.objectServiceUrl,b,c,e(h))},getUpdateUrl:function(b,c,h,l){return l?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.objectServiceUrl,b,c,e(h),l):String.format("{0}/{1}/{2}?fields={3}",
this.objectServiceUrl,b,c,e(h))},getDeleteUrl:function(b,c,h){return!0===h?String.format("{0}/{1}/{2}?deleteconnections=true",this.objectServiceUrl,b,c):String.format("{0}/{1}/{2}",this.objectServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.objectServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,h){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(h))},getMultiGetUrl:function(b,c,h){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.connectionServiceUrl,b,c,e(h))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,e(c))},getUpdateUrl:function(b,c,h,l){return l?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,b,c,e(h),l):String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,e(h))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,h,e){var g="",g=String.format("{0}/{1}/find/all?label={2}&objectid={3}",this.connectionServiceUrl,b,h,c);if("undefined"!==typeof e&&0<e.length)for(b=0;b<e.length;b+=1)g=g+"&"+e[b];return g},getConnectedArticles:function(b,c,h){var e="",e=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,b,c);if(h&&h.length&&0<h.length)for(b=0;b<h.length;b+=1)e=0===b?e+("?"+h[b]):e+("&"+h[b]);return e},getInterconnectsUrl:function(){return String.format("{0}/interconnects",
this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,
b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b,c){return c&&0<c.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",this.fileServiceUrl,escape(b),escape(c)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""===location.search||-1===location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(h,e){var g=e.split("="),m=g[1];2<g.length&&g.forEach(function(b,c){0!==b&&1!==b&&(m=m+"="+
g[b])});g[0].toLowerCase()===b&&(c=[g[0],m])}),c):location.search.split("?")[1].split("=")}};this.usergroup={usergroupServiceUrl:"usergroup",getUpdateUrl:function(b){return String.format("{0}/{1}/members",this.usergroupServiceUrl,b)}}}})(global);
(function(c){var e;e=c.Appacitive.runtime.isNode?process.nextTick:setTimeout;var b=function(){if(!(this instanceof b))return new b;this.calls=[]};b.prototype.isResolved=function(){return 1===this.state?!0:!1};b.prototype.isRejected=function(){return 2===this.state?!0:!1};b.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};b.prototype.done=function(){var e,h,l=this.state,g=this.value;if(!l)return this;for(;e=this.calls.shift();)if(h=e[0],"function"===typeof e[l]){try{g=
e[l].apply(h,this.value)}catch(m){c.Appacitive.logs.logException({name:m.name,message:m.message,stack:m.stack});if(0==h.calls.length)throw m;h.reject(m)}g instanceof b||b.is(g)?g.then(function(b){h.fulfill(b)},function(b){h.reject(b)}):1===l?h.fulfill(g):h.reject(g)}else 1===l?h.fulfill(g):h.reject(g)};b.prototype.fulfill=function(){if(this.state)return this;this.state=1;this.value=arguments;this.done();return this};b.prototype.resolve=b.prototype.fulfill;b.prototype.reject=function(){if(this.state)return this;
this.state=2;this.reason=this.value=arguments;this.done();return this};b.prototype.then=function(c,h){var l=this,g=new b;this.calls[this.calls.length]=[g,c,h];this.state&&e(function(){l.done()});return g};b.when=function(c){var h=[],l=[],g,m=0,n=new b;if(!c)return n.fulfill(h),n;var p=function(){m+=1;m==g&&(n.state||(0<l.length?n.reject(l,h?h:[]):n.fulfill(h?h:[])))},k=function(g){var k=c[g];k instanceof b||k&&"function"===typeof k.then?e(function(){k.then(function(b){h[g]=b;p()},function(b){l[g]=
b;p()})}):e(function(){try{h[g]=k.call()}catch(b){l[g]=b}p()})};Array.isArray(c)||(c=[c]);g=c.length;for(var q=0;q<g;q+=1)k(q);return n};b.is=function(c){return c instanceof b?!0:!1};b.buildPromise=function(c){var h=new b;_type.isObject(c)&&h.then(c.success,c.error);return h};c.Appacitive.Promise=b})(global);
(function(c){c.Appacitive.eventManager=new function(){function c(){var b=function(){return Math.floor(65536*Math.random()).toString(16)};return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()}var b={};this.subscribe=function(f,h){if("string"!=typeof f||"function"!=typeof h)throw Error("Incorrect subscription call");"undefined"==typeof b[f]&&(b[f]=[]);var l=c();b[f].push({callback:h,id:l});return l};this.unsubscribe=function(c){if(!c)return!1;var h=-1,e=null,g;for(g in b)for(var m=0;m<b[g].length;m+=
1)if(b[g][m].id==c){h=m;e=g;break}return-1!=h?(b[e].splice(h,1),!0):!1};this.fire=function(c,h,e){if("string"!=typeof c)throw Error("Incorrect fire call");if("undefined"==typeof e||null===e)e={};e.eventName=c;if("undefined"!=typeof b.all)for(var g=0;g<b.all.length;g+=1)b.all[g].callback(h,e);g=function(b,c,g){setTimeout(function(){b(c,g)},0)};if("undefined"!=typeof b[c])for(var m=0;m<b[c].length;m+=1)g(b[c][m].callback,h,e)};this.clearSubscriptions=function(c){if("string"!=typeof c)throw Error("Event Name must be string in EventManager.clearSubscriptions");
b[c]&&(b[c].length=0);return this};this.clearAndSubscribe=function(b,c){this.clearSubscriptions(b);this.subscribe(b,c)};this.dump=function(){console.dir(b)}}})(global);
(function(c){var e={},b=Array.prototype.forEach,f=Object.prototype.hasOwnProperty,h=Array.prototype.slice,l=0,g=function(){return{keys:Object.keys,uniqueId:function(b){var c=++l+"";return b?b+c:c},has:function(b,c){return f.call(b,c)},each:function(c,g,h){if(null!=c)if(b&&c.forEach===b)c.forEach(g,h);else if(c.length===+c.length)for(var f=0,k=c.length;f<k&&g.call(h,c[f],f,c)!==e;f++);else for(f in c)if(this.has(c,f)&&g.call(h,c[f],f,c)===e)break},once:function(c){var b=!1,g;return function(){if(b)return g;
b=!0;g=c.apply(this,arguments);c=null;return g}}}}(),m;m={on:function(c,b,g){if(!p(this,"on",c,[b,g])||!b)return this;this._events||(this._events={});(this._events[c]||(this._events[c]=[])).push({callback:b,context:g,ctx:g||this});return this},once:function(c,b,h){if(!p(this,"once",c,[b,h])||!b)return this;var e=this,f=g.once(function(){e.off(c,f);b.apply(this,arguments)});f._callback=b;return this.on(c,f,h)},off:function(c,b,h){var e,f,k,n,m,l,x,w;if(!this._events||!p(this,"off",c,[b,h]))return this;
if(!c&&!b&&!h)return this._events={},this;n=c?[c]:g.keys(this._events);m=0;for(l=n.length;m<l;m++)if(c=n[m],k=this._events[c]){this._events[c]=e=[];if(b||h)for(x=0,w=k.length;x<w;x++)f=k[x],(b&&b!==f.callback&&b!==f.callback._callback||h&&h!==f.context)&&e.push(f);e.length||delete this._events[c]}return this},trigger:function(c){if(!this._events)return this;var b=h.call(arguments,1);if(!p(this,"trigger",c,b))return this;var g=this._events[c],e=this._events.all;g&&k(g,b);e&&k(e,arguments);return this},
stopListening:function(c,b,g){var h=this._listeners;if(!h)return this;var e=!b&&!g;"object"===typeof b&&(g=this);c&&((h={})[c._listenerId]=c);for(var f in h)h[f].off(b,g,this),e&&delete this._listeners[f];return this}};var n=/\s+/,p=function(c,b,g,h){if(!g)return!0;if("object"===typeof g){for(var e in g)c[b].apply(c,[e,g[e]].concat(h));return!1}if(n.test(g)){g=g.split(n);e=0;for(var f=g.length;e<f;e++)c[b].apply(c,[g[e]].concat(h));return!1}return!0},k=function(c,b){var g,h=-1,e=c.length,f=b[0],k=
b[1],n=b[2];switch(b.length){case 0:for(;++h<e;)(g=c[h]).callback.call(g.ctx);break;case 1:for(;++h<e;)(g=c[h]).callback.call(g.ctx,f);break;case 2:for(;++h<e;)(g=c[h]).callback.call(g.ctx,f,k);break;case 3:for(;++h<e;)(g=c[h]).callback.call(g.ctx,f,k,n);break;default:for(;++h<e;)(g=c[h]).callback.apply(g.ctx,b)}};g.each({listenTo:"on",listenToOnce:"once"},function(c,b){m[b]=function(b,h,e){var f=this._listeners||(this._listeners={}),k=b._listenerId||(b._listenerId=g.uniqueId("l"));f[k]=b;"object"===
typeof h&&(e=this);b[c](h,e,this);return this}});m.bind=m.on;m.unbind=m.off;m.mixin=function(c){g.each("on once off trigger stopListening listenTo listenToOnce bind unbind".split(" "),function(b){c[b]=this[b]},this);return c};c.Appacitive.Events=m})(global);
(function(c){c.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/v1.0/"};!c.navigator||-1==c.navigator.userAgent.indexOf("MSIE 8")&&-1==c.navigator.userAgent.indexOf("MSIE 9")||(c.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/v1.0/")})(global);
(function(c){var e=function(b){var e;if(!b||!_type.isObject(b))throw Error("Please specify request options");this.promise=c.Appacitive.Promise.buildPromise(b.options);var h=this.request=new c.Appacitive.HttpRequest;e=c.Appacitive.storage.urlFactory[b.type];var l=b.op.replace("get","").replace("Url","")+" "+b.type;e=c.Appacitive.config.apiBaseUrl+e[b.op].apply(e,b.args||[]);h.url=e;h.description=l;h.method=b.method||"get";h.data=b.data||{};h.onSuccess=b.onSuccess;h.onError=b.onError;h.promise=this.promise;
h.options=b.options;b.entity&&(h.entity=b.entity);return this};e.prototype.send=function(){return c.Appacitive.http.send(this.request)};c.Appacitive._Request=e})(global);
(function(c){c.Appacitive.Session=new function(){this.initialized=!1;var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},b=null,f=null,h=null,l=!1,g;this.useApiKey=!0;this.useMasterKey=!1;this.onSessionCreated=function(){};this.recreate=function(b){return c.Appacitive.Session.create(b)};this.create=function(g){if(!this.initialized)throw Error("Intialize Appacitive SDK");var h=new e;h.apikey=f;var k=new c.Appacitive._Request({method:"PUT",type:"application",
op:"getSessionCreateUrl",options:g,data:h,onSuccess:function(g){b=g.session.sessionkey;c.Appacitive.Session.useApiKey=!1;k.promise.fulfill(g);c.Appacitive.Session.onSessionCreated()}});return k.send()};c.Appacitive.http.addProcessor({pre:function(e){e.options=e.options||{};if(c.Appacitive.Session.useApiKey){var m=f;(e.options.useMasterKey||c.Appacitive.useMasterKey&&!e.options.useMasterKey)&&_type.isString(g)&&0<g.length?m=g:_type.isString(e.options.apikey)&&(m=e.options.apikey);e.headers.push({key:"ak",
value:m})}else e.headers.push({key:"as",value:b});if(!0===l){var k=-1,m=e.headers.filter(function(c,b){return"ut"==c.key?(k=b,!0):!1});if(e.options.ignoreUserToken)-1!=k&&e.headers.splice(k,1);else{var q=h;_type.isString(e.options.userToken)&&0<e.options.userToken.length&&(q=e.options.userToken);1==m.length?e.headers.forEach(function(c){"ut"==c.key&&(c.value=q)}):e.headers.push({key:"ut",value:q})}}}});this.setUserAuthHeader=function(b,g,e){try{b&&(l=!0,h=b,e||(g||(g=-1),-1==g&&(g=null),c.Appacitive.localStorage.set("Appacitive-UserToken",
b),c.Appacitive.localStorage.set("Appacitive-UserTokenExpiry",g),c.Appacitive.localStorage.set("Appacitive-UserTokenDate",(new Date).getTime())))}catch(f){}};this.incrementExpiry=function(){try{c.Appacitive.runtime.isBrowser&&l&&c.Appacitive.localStorage.set("Appacitive-UserTokenDate",(new Date).getTime())}catch(b){}};this.removeUserAuthHeader=function(b,g){var e=c.Appacitive.Promise.buildPromise(g);b||c.Appacitive.User.trigger("logout",{});c.Appacitive.localStorage.remove("Appacitive-User");if(h&&
b)try{var f=new c.Appacitive.HttpRequest(g);f.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(h);f.method="POST";f.data={};f.type="user";f.options=g;f.description="InvalidateToken user";f.onSuccess=f.onError=function(){l=!1;h=null;c.Appacitive.localStorage.remove("Appacitive-UserToken");c.Appacitive.localStorage.remove("Appacitive-UserTokenExpiry");c.Appacitive.localStorage.remove("Appacitive-UserTokenDate");e.fulfill()};c.Appacitive.http.send(f);return e}catch(m){}else return l=
!1,h=null,c.Appacitive.localStorage.remove("Appacitive-UserToken"),c.Appacitive.localStorage.remove("Appacitive-UserTokenExpiry"),c.Appacitive.localStorage.remove("Appacitive-UserTokenDate"),e.fulfill()};this.isSessionValid=function(c){if(c.status){if(c.status.code&&("420"==c.status.code||"19027"==c.status.code||"19002"==c.status.code))return{status:!1,isSession:"19027"==c.status.code||"420"==c.status.code?!0:!1}}else if(c.code&&("420"==c.code||"19027"==c.code||"19002"==c.code))return{status:!1,isSession:"19027"==
c.code||"420"==c.code?!0:!1};return{status:!0}};this.resetSession=function(){b=null;this.useApiKey=!0};this.get=function(){return b};this.setSession=function(c){c&&(b=c,this.useApiKey=!1)};this.setApiKey=function(c){c&&(f=c,this.useApiKey=!0)};this.setMasterKey=function(c){g=c};this.reset=function(){this.removeUserAuthHeader();h=f=b=null;l=!1;g=null;this.useMasterKey=this.useApiKey=this.initialized=!1};var m="sandbox";this.environment=function(){if(1==arguments.length){var c=arguments[0];"sandbox"!=
c&&"live"!=c&&(c="sandbox");m=c}return m}};c.Appacitive.getAppPrefix=function(e){return c.Appacitive.Session.environment()+"/"+c.Appacitive.appId+"/"+e};c.Appacitive.initialize=function(e){e=e||{};if(!c.Appacitive.Session.initialized){e.masterKey&&0<e.masterKey.length&&c.Appacitive.Session.setMasterKey(e.masterKey);if(!e.apikey||0===e.apikey.length)if(_masterKey)e.apikey=_masterKey;else throw Error("apikey is mandatory");if(!e.appId||0===e.appId.length)throw Error("appId is mandatory");c.Appacitive.Session.setApiKey(e.apikey);
c.Appacitive.Session.environment(e.env||"sandbox");c.Appacitive.useApiKey=!0;c.Appacitive.appId=e.appId;c.Appacitive.Session.initialized=!0;c.Appacitive.Session.persistUserToken=e.persistUserToken;e.debug&&(c.Appacitive.config.debug=!0);_type.isFunction(e.apiLog)&&(c.Appacitive.logs.apiLog=e.apiLog);_type.isFunction(e.apiErrorLog)&&(c.Appacitive.logs.apiErrorLog=e.apiErrorLog);_type.isFunction(e.exceptionLog)&&(c.Appacitive.logs.exceptionLog=e.exceptionLog);if(e.userToken)if(-1==e.expiry?e.expiry=
null:e.expiry||(e.expiry=3600),c.Appacitive.Session.setUserAuthHeader(e.userToken,e.expiry),e.user)c.Appacitive.Users.setCurrentUser(e.user);else{var b=c.Appacitive.localStorage.get("Appacitive-User");b&&c.Appacitive.Users.setCurrentUser(b)}else if(c.Appacitive.runtime.isBrowser&&(e=c.Appacitive.localStorage.get("Appacitive-UserToken"))){var f=c.Appacitive.localStorage.get("Appacitive-UserTokenExpiry"),b=c.Appacitive.localStorage.get("Appacitive-UserTokenDate");f||(f=-1);b&&0<f&&new Date(b+1E3*f)<
new Date||(-1==f&&(f=null),(b=c.Appacitive.localStorage.get("Appacitive-User"))&&c.Appacitive.Users.setCurrentUser(b,e,f))}}};c.Appacitive.reset=function(){c.Appacitive.Session.reset()}})(global);(function(c){c.Appacitive&&c.Appacitive.http&&(c.Appacitive.http.addProcessor({pre:function(e){var b=c.Appacitive.Session.environment();e.options=e.options||{};_type.isString(e.options.env)&&(b=e.options.env);e.headers.push({key:"e",value:b})}}),c.Appacitive.Events.mixin(c.Appacitive))})(global);
(function(c){var e=c.Appacitive;e.GeoCoord=function(c,b){var g=function(c,b){if(isNaN(c)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>c||90<c)throw Error("Latitude "+c+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");},h=function(c){if("string"!==typeof c||0==c.length)return!1;c=c.split(",");if(2!==c.length)return!1;try{return new e.GeoCoord(c[0],c[1])}catch(b){return!1}};if(_type.isString(c)&&
!b&&(h=h(c)))return h;c&&b?(g(c,b),this.lat=c,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",c,b)};this.toString=function(){return this.getValue()}};var b=function(){this.toString=function(){};this.Or=function(){var c=Array.prototype.slice.call(arguments,0);c.splice(0,0,this);return new p(k.or,c)};this.And=function(){var c=Array.prototype.slice.call(arguments,0);c.splice(0,0,this);return new p(k.and,
c)}},f=function(c){b.call(this);c=c||{};this.fieldType=c.fieldType;this.field=c.field||"";this.value=c.value;this.operator=c.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue())}};f.prototype=new b;f.prototype.constructor=f;var h=function(c){c=c||"";
if(!_type.isArray(c.value)||!c.value.length)throw Error("Specify field value as array");f.call(this,c);this.toString=function(){for(var c=[],b=0;b<this.value.length;b+=1)c.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,_type.isString(this.value[b])?"'"+this.value[b]+"'":_type.isNumber(this.value[b])?this.value[b]:this.value[b].toString()));return"("+c.join(" or ")+")"}};h.prototype=new f;h.prototype.constructor=h;var l=function(c){c=c||"";if(!c.val1)throw Error("Specify field value1 ");
if(!c.val2)throw Error("Specify field value2 ");this.val1=c.val1;this.val2=c.val2;f.call(this,c);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};l.prototype=new f;l.prototype.constructor=l;var g=function(c){c=c||"";if(!(c.geoCoord&&c.geoCoord instanceof e.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");f.call(this,
c);this.value=c.geoCoord;this.unit=c.unit||"mi";this.distance=c.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};g.prototype=new f;g.prototype.constructor=l;var m=function(c){c=c||"";if(!c.geoCoords||0===c.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");if(3>c.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");
f.call(this,c);this.value=c.geoCoords;var b=function(c){var b="";c.forEach(function(c){b=0===b.length?c.toString():b+(" | "+c.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new f;m.prototype.constructor=l;var n=function(c){b.call(this);c=c||{};if(!c.tags||_type.isArray(c.tags)||0===c.tags.length)throw Error("Specify valid tags");this.tags=c.tags;this.operator=c.operator;
this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};n.prototype=new b;n.prototype.constructor=n;var p=function(c,g){if(!g||!g.length||2>g.length)throw Error("Provide valid or atleast 2 filters");this.operator=c;this.innerFilters=[];for(var h=0;h<g.length;h+=1){if(!(g[h]instanceof b))throw Error("Invalid filter provided");this.innerFilters.push(g[h])}this.toString=function(){var c=this.operator,b="(";this.innerFilters.forEach(function(g){b=1===b.length?b+
(" "+g.toString()):b+String.format(" {0} {1} ",c,g.toString())});return b+=")"}};p.prototype=new b;p.prototype.constructor=p;var k={isEqualTo:"==",isGreaterThan:">",isGreaterThanEqualTo:">=",isLessThan:"<",isLessThanEqualTo:"<=",like:"like",match:"match",between:"between",withinCircle:"within_circle",withinPolygon:"within_polygon",or:"or",and:"and",taggedWithAll:"tagged_with_all",taggedWithOneOrMore:"tagged_with_one_or_more"},q=function(c,b){if(null===c||void 0===c||0===c.length)throw Error("Specify value");
this.value=c;this.type=b?b:typeof this.value;if("number"===this.type&&!_type.isNumeric(this.value))throw Error("Value should be numeric for filter expression");this.getValue=function(){return"string"===this.type?"'"+this.value+"'":"number"===this.type||_type.isBoolean(this.value)?this.value:"object"===this.type&&this.value instanceof date?"datetime('"+e.Date.toISOString(this.value)+"')":this.value.toString()}},r=function(c){this.value=c;this.getValue=function(){return this.value instanceof Date?"date('"+
e.Date.toISODate(this.value)+"')":"date('"+this.value+"')"}},t=function(c){this.value=c;this.getValue=function(){return this.value instanceof Date?"time('"+e.Date.toISOTime(this.value)+"')":"time('"+this.value+"')"}},u=function(c){this.value=c;this.getValue=function(){return this.value instanceof Date?"datetime('"+e.Date.toISOString(this.value)+"')":"datetime('"+this.value+"')"}},v=function(c,b,e){e||(e=this);e.type=c;e.name=b;e.equalTo=function(c){return new f({field:this.name,fieldType:this.type,
value:new q(c),operator:k.isEqualTo})};e.equalToNumber=function(c){return new f({field:this.name,fieldType:this.type,value:new q(c,"number"),operator:k.isEqualTo})};e.equalToDate=function(c){return new f({field:this.name,fieldType:this.type,value:new r(c),operator:k.isEqualTo})};e.equalToTime=function(c){return new f({field:this.name,fieldType:this.type,value:new t(c),operator:k.isEqualTo})};e.equalToDateTime=function(c){return new f({field:this.name,fieldType:this.type,value:new u(c),operator:k.isEqualTo})};
e.greaterThan=function(c){return new f({field:this.name,fieldType:this.type,value:new q(c,"number"),operator:k.isGreaterThan})};e.greaterThanDate=function(c){return new f({field:this.name,fieldType:this.type,value:new r(c),operator:k.isGreaterThan})};e.greaterThanTime=function(c){return new f({field:this.name,fieldType:this.type,value:new t(c),operator:k.isGreaterThan})};e.greaterThanDateTime=function(c){return new f({field:this.name,fieldType:this.type,value:new u(c),operator:k.isGreaterThan})};
e.greaterThanEqualTo=function(c){return new f({field:this.name,fieldType:this.type,value:new q(c,"number"),operator:k.isGreaterThanEqualTo})};e.greaterThanEqualToDate=function(c){return new f({field:this.name,fieldType:this.type,value:new r(c),operator:k.isGreaterThanEqualTo})};e.greaterThanEqualToTime=function(c){return new f({field:this.name,fieldType:this.type,value:new t(c),operator:k.isGreaterThanEqualTo})};e.greaterThanEqualToDateTime=function(c){return new f({field:this.name,fieldType:this.type,
value:new u(c),operator:k.isGreaterThanEqualTo})};e.lessThan=function(c){return new f({field:this.name,fieldType:this.type,value:new q(c,"number"),operator:k.isLessThan})};e.lessThanDate=function(c){return new f({field:this.name,fieldType:this.type,value:new r(c),operator:k.isLessThan})};e.lessThanTime=function(c){return new f({field:this.name,fieldType:this.type,value:new t(c),operator:k.isLessThan})};e.lessThanDateTime=function(c){return new f({field:this.name,fieldType:this.type,value:new u(c),
operator:k.isLessThan})};e.lessThanEqualTo=function(c){return new f({field:this.name,fieldType:this.type,value:new q(c,"number"),operator:k.isLessThanEqualTo})};e.lessThanEqualToDate=function(c){return new f({field:this.name,fieldType:this.type,value:new r(c),operator:k.isLessThanEqualTo})};e.lessThanEqualToTime=function(c){return new f({field:this.name,fieldType:this.type,value:new t(c),operator:k.isLessThanEqualTo})};e.lessThanEqualToDateTime=function(c){return new f({field:this.name,fieldType:this.type,
value:new u(c),operator:k.isLessThanEqualTo})};e.like=function(c){return new f({field:this.name,fieldType:this.type,value:new q("*"+c+"*"),operator:k.like})};e.match=function(c){return new f({field:this.name,fieldType:this.type,value:new q("*"+c+"*"),operator:k.match})};e.startsWith=function(c){return new f({field:this.name,fieldType:this.type,value:new q(c+"*"),operator:k.like})};e.endsWith=function(c){return new f({field:this.name,fieldType:this.type,value:new q("*"+c),operator:k.like})};e.contains=
function(c){return new h({field:this.name,fieldType:this.type,value:c,operator:k.isEqualTo})};e.between=function(c,b){return new l({field:this.name,fieldType:this.type,val1:new q(c,"number"),val2:new q(b,"number"),operator:k.between})};e.betweenDate=function(c,b){return new l({field:this.name,fieldType:this.type,val1:new r(c),val2:new r(b),operator:k.between})};e.betweenTime=function(c,b){return new l({field:this.name,fieldType:this.type,val1:new t(c),val2:new t(b),operator:k.between})};e.betweenDateTime=
function(c,b){return new l({field:this.name,fieldType:this.type,val1:new u(c),val2:new u(b),operator:k.between})};e.withinCircle=function(c,b,e){return new g({field:this.name,fieldType:this.type,geoCoord:c,distance:b,unit:e,operator:k.withinCircle})};e.withinPolygon=function(c){return new m({field:this.name,fieldType:this.type,geoCoords:c,operator:k.withinPolygon})}},B=function(c){if(!c||0===c.length)throw Error("Specify field name");this.field=c;v("property",c,this);return this},A=function(c){if(!c||
0===c.length)throw Error("Specify field name");this.field=c;var b=new v("aggregate",c);this.equalTo=function(c){return b.equalTo(c)};this.greaterThan=function(c){return b.greaterThan(c)};this.greaterThanEqualTo=function(c){return b.greaterThanEqualTo(c)};this.lessThan=function(c){return b.lessThan(c)};this.lessThanEqualTo=function(c){return b.lessThanEqualTo(c)};this.between=function(c,g){return b.between(c,g)};return this},y=function(c){if(!c||0===c.length)throw Error("Specify field name");this.field=
c;var b=new v("attribute",c);this.like=function(c){return b.like(c)};this.like=function(c){return b.match(c)};this.startWith=function(c){return b.startsWith(c)};this.endsWith=function(c){return b.endsWith(c)};this.equalTo=function(c){return b.equalTo(c)};this.contains=function(c){return b.contains(c)};return this};e.Filter={Property:function(c){return new B(c)},Aggregate:function(c){return new A(c)},Attribute:function(c){return new y(c)},Or:function(){return new p(k.or,arguments)},And:function(){return new p(k.and,
arguments)},taggedWithOneOrMore:function(c){return new n({tags:c,operator:k.taggedWithOneOrMore})},taggedWithAll:function(c){return new n({tags:c,operator:k.taggedWithAll})}}})(global);
(function(c){c.Appacitive.Queries={};var e=function(c){c=c||{};var b=1,g=20;this.pageNumber=function(){return 1==arguments.length?(b=arguments[0]||1,this):b};this.pageSize=function(){return 1==arguments.length?(g=arguments[0]||20,this):g};this.pageNumber(c.pageNumber);this.pageSize(c.pageSize)};e.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var b=function(c){c=c||{};var b=null,g=!1;this.orderBy=function(){return 1===arguments.length&&_type.isString(arguments[0])?
(b=arguments[0],this):b};this.isAscending=function(){return 1===arguments.length?(g=void 0===arguments[0]||null==arguments[0]?!1:arguments[0],this):g};this.orderBy(c.orderBy);this.isAscending(c.isAscending)};b.prototype.toString=function(){return this.orderBy()&&0<this.orderBy().length?"orderBy="+this.orderBy()+"&isAsc="+this.isAscending():""};var f=function(h){var f=h||{},g="",m="",n="",p=f.queryType||"BasicQuery",k=new e(h),q=new b(h),r=f.type||f.relation,t=f.relation?"connection":"object",u=this;
f.entity&&(this.entity=f.entity);this.type=function(){return t};this.entityType=function(){return r};this.queryType=function(){return p};this.pageQuery=function(){return k};this.pageNumber=function(){return 1===arguments.length?(k.pageNumber(arguments[0]),this):k.pageNumber()};this.pageSize=function(){return 1===arguments.length?(k.pageSize(arguments[0]),this):k.pageSize()};this.sortQuery=function(){return q};this.orderBy=function(){return 1===arguments.length?(q.orderBy(arguments[0]),this):q.orderBy()};
this.isAscending=function(){return 1===arguments.length?(q.isAscending(arguments[0]),this):q.isAscending()};this.filter=function(){return 1===arguments.length?(g=arguments[0],this):g};this.freeText=function(){if(1===arguments.length){var c=arguments[0];_type.isString(c)?m=arguments[0]:_type.isArray(c)&&c.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1===arguments.length){var c=arguments[0];_type.isString(c)?n=c:_type.isArray(c)&&c.length&&(n=c.join(","));return this}return n};
this.filter(f.filter||"");this.freeText(f.freeText||"");this.fields(f.fields||"");this.setFilter=function(c){this.filter(c)};this.setFreeText=function(c){this.freeText(c)};this.setFields=function(c){this.fields(c)};this.extendOptions=function(c){for(var g in c)f[g]=c[g];k=new e(f);q=new b(f);return this};this.getQueryString=function(){var c=k.toString(),b=q.toString();b&&(c+="&"+b);this.filter()&&(b=encodeURIComponent(this.filter().toString()),0<b.trim().length&&(c+="&query="+b));this.freeText()&&
0<this.freeText().trim().length&&(c+="&freetext="+encodeURIComponent(this.freeText())+"&language=en");this.fields()&&0<this.fields().trim().length&&(c+="&fields="+this.fields());return c};this.toUrl=function(){return{url:c.Appacitive.config.apiBaseUrl+t+"/"+r+"/find/all?"+this.getQueryString(),description:"FindAll "+r+" "+t+"s"}};this.toRequest=function(b){var g=new c.Appacitive.HttpRequest,e=this.toUrl();g.url=e.url;g.options=b;g.description=e.description;g.method="get";return g};this.getOptions=
function(){var c={},b;for(b in this)this.hasOwnProperty(b)&&!_type.isFunction(this[b])&&(c[b]=this[b]);return c};this._setPaging=function(c){c&&(k.pageNumber(c.pagenumber),k.pageSize(c.pagesize),this.results=this.results||[],this.results.isLastPage=!1,this.results.total=c.totalrecords,this.results.pageNumber=c.pagenumber,this.results.pageSize=c.pagesize,c.pagenumber*c.pagesize>=c.totalrecords&&(this.results.isLastPage=!0))};this.fetch=function(b){var g=c.Appacitive.Promise.buildPromise(b);b=this.toRequest(b);
b.onSuccess=function(b){var e;(e=b[t+"s"])||(e=[]);e=c.Appacitive["object"===t?"Object":"Connection"]._parseResult(e,f.entity);u.results=e;u._setPaging(b.paginginfo);g.fulfill(u.results,b.paginginfo)};b.promise=g;b.entity=this;return c.Appacitive.http.send(b)};this.collection=function(b,g){g=g||{};b=b||[];_type.isObject(b)&&(g=b,b=null);b||(b=this.results?this.results:[]);var e=f.entity;!e&&(0<b.length&&b[0]instanceof c.Appacitive.BaseObject)&&(e="object"==b[0].type?"Object":"Connection",e=c.Appacitive[e]._getClass(b[0].className));
e||(e="object"===t?"Object":"Connection",c.Appacitive[e]._getClass(this[e]));return new Appacitive.Collection(b,_extend(g,{model:this.model,query:this}))};this.fetchNext=function(c){var b=this.pageNumber();this.pageNumber(++b);return this.fetch(c)};this.fetchPrev=function(c){var b=this.pageNumber(),b=b-1;0>=b&&(b=1);this.pageNumber(b);return this.fetch(c)};this.count=function(b){var g=c.Appacitive.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(c){c=c||{};c=c.paginginfo;var b=0,b=
c?c.totalrecords:0;g.fulfill(b)};b.promise=g;b.entity=this;return c.Appacitive.http.send(b)}};c.Appacitive.Query=f;c.Appacitive.Queries.FindAllQuery=function(c){c=c||{};if(!c.type&&!c.relation)throw Error("Specify either type or relation for basic filter query");c.queryType="FindAllQuery";f.call(this,c);return this};c.Appacitive.Queries.FindAllQuery.prototype=new f;c.Appacitive.Queries.FindAllQuery.prototype.constructor=c.Appacitive.Queries.FindAllQuery;c.Appacitive.Queries.ConnectedObjectsQuery=
function(b){b=b||{};if(!b.relation)throw Error("Specify relation for connected objects query");if(!b.objectId)throw Error("Specify objectId for connected objects query");if(!b.type)throw Error("Specify type of object id for connected objects query");var e=b.type;delete b.type;b.queryType="ConnectedObjectsQuery";f.call(this,b);this.objectId=b.objectId;this.relation=b.relation;this.type=e;b.object instanceof c.Appacitive.Object&&(this.object=b.object);this.returnEdge=!0;void 0===b.returnEdge||(null===
b.returnEdge||b.returnEdge||this.prev)||(this.returnEdge=!1);this.label="";var g=this;_type.isString(b.label)&&0<b.label.length&&(this.label="&label="+b.label);this.toUrl=function(){return{url:c.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.type+"/"+this.objectId+"/find?"+this.getQueryString()+this.label+"&returnEdge="+this.returnEdge,description:"GetConnectedObjects for relation "+this.relation+" of type "+this.type+" for object "+this.objectId}};var m=function(b,e){var h=[];
b.forEach(function(b){var g=b.__edge;delete b.__edge;var f=c.Appacitive.Object._create(b,!0);g&&(g.__endpointa=e,g.__endpointb={objectid:b.__id,label:g.__label,type:b.__type},delete g.label,f.connection=c.Appacitive.Connection._create(g,!0));h.push(f)});g.object&&(g.object.children[g.relation]=h);return h};this.fetch=function(f){var p=c.Appacitive.Promise.buildPromise(f);f=this.toRequest(f);f.onSuccess=function(c){g.results=m(c.nodes?c.nodes:[],{objectid:b.objectId,type:e,label:c.parent});g._setPaging(c.paginginfo);
p.fulfill(g.results,c.paginginfo)};f.promise=p;f.entity=this;return c.Appacitive.http.send(f)};return this};c.Appacitive.Queries.ConnectedObjectsQuery.prototype=new f;c.Appacitive.Queries.ConnectedObjectsQuery.prototype.constructor=c.Appacitive.Queries.ConnectedObjectsQuery;c.Appacitive.Queries.GetConnectionsQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!b.objectId)throw Error("Specify objectId for GetConnectionsQuery query");if(!b.label||
0===b.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");b.type&&delete b.type;b.queryType="GetConnectionsQuery";f.call(this,b);this.objectId=b.objectId;this.relation=b.relation;this.label=b.label;this.toUrl=function(){return{url:c.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?"+this.getQueryString()+"&objectid="+this.objectId+"&label="+this.label,description:"FindAllConnections for relation "+this.relation+" from object id "+this.objectId}};return this};
c.Appacitive.Queries.GetConnectionsQuery.prototype=new f;c.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=c.Appacitive.Queries.GetConnectionsQuery;c.Appacitive.Queries.GetConnectionsBetweenObjectsQuery=function(b,e){b=b||{};delete b.entity;if(!b.objectAId||!_type.isString(b.objectAId)||0===b.objectAId.length)throw Error("Specify valid objectAId for GetConnectionsBetweenObjectsQuery query");if(!b.objectBId||!_type.isString(b.objectBId)||0===b.objectBId.length)throw Error("Specify objectBId for GetConnectionsBetweenObjectsQuery query");
b.type&&delete b.type;b.queryType=e||"GetConnectionsBetweenObjectsQuery";f.call(this,b);this.objectAId=b.objectAId;this.objectBId=b.objectBId;this.label="GetConnectionsBetweenObjectsForRelationQuery"===this.queryType()&&b.label&&_type.isString(b.label)&&0<b.label.length?"&label="+b.label:"";this.relation=b.relation&&_type.isString(b.relation)&&0<b.relation.length?b.relation+"/":"";this.toUrl=function(){return{url:c.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.objectAId+"/"+
this.objectBId+"?"+this.getQueryString()+this.label,description:"FindConnectionBetween for relation "+this.relation+" between object ids "+this.objectAId+" and "+this.objectBId}};return this};c.Appacitive.Queries.GetConnectionsBetweenObjectsQuery.prototype=new f;c.Appacitive.Queries.GetConnectionsBetweenObjectsQuery.prototype.constructor=c.Appacitive.Queries.GetConnectionsBetweenObjectsQuery;c.Appacitive.Queries.GetConnectionsBetweenObjectsForRelationQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsBetweenObjectsForRelationQuery query");
var e=new c.Appacitive.Queries.GetConnectionsBetweenObjectsQuery(b,"GetConnectionsBetweenObjectsForRelationQuery");e.fetch=function(g){var f=c.Appacitive.Promise.buildPromise(g);g=this.toRequest(g);g.onSuccess=function(g){e.results=g.connection?[c.Appacitive.Connection._create(g.connection,!0,b.entity)]:null;f.fulfill(e.results?e.results[0]:null)};g.promise=f;g.entity=this;return c.Appacitive.http.send(g)};return e};c.Appacitive.Queries.InterconnectsQuery=function(b){b=b||{};delete b.entity;if(!b.objectAId||
!_type.isString(b.objectAId)||0===b.objectAId.length)throw Error("Specify valid objectAId for InterconnectsQuery query");if(!(b.objectBIds&&_type.isArray(b.objectBIds)&&0<b.objectBIds.length))throw Error("Specify list of objectBIds for InterconnectsQuery query");b.type&&delete b.type;b.queryType="InterconnectsQuery";f.call(this,b);this.objectAId=b.objectAId;this.objectBIds=b.objectBIds;this.toRequest=function(b){var g=new c.Appacitive.HttpRequest,e=this.toUrl();g.url=e.url;g.options=b;g.description=
e.description;g.method="post";g.data={object1id:this.objectAId,object2ids:this.objectBIds};return g};this.toUrl=function(){return{url:c.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString(),description:"GetInterConnections between objects"}};return this};c.Appacitive.Queries.InterconnectsQuery.prototype=new f;c.Appacitive.Queries.InterconnectsQuery.prototype.constructor=c.Appacitive.Queries.InterconnectsQuery;c.Appacitive.Queries.GraphFilterQuery=function(b,e){if(!b||0===
b.length)throw Error("Specify name of filter query");this.name=b;this.data={};this.queryType="GraphFilterQuery";if(e){this.data.placeholders=e;for(var g in this.data.placeholders)this.data.placeholders[g]=this.data.placeholders[g]}this.toRequest=function(b){var g=new c.Appacitive.HttpRequest,e=this.toUrl();g.url=e.url;g.options=b;g.description=e.description;g.method="post";g.data=this.data;return g};this.toUrl=function(){return{url:c.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter",description:"Filter Query with name "+
this.name}};this.fetch=function(b){var g=c.Appacitive.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(c){g.fulfill(c.ids?c.ids:[])};b.promise=g;b.entity=this;return c.Appacitive.http.send(b)}};c.Appacitive.Queries.GraphProjectQuery=function(b,e,g){if(!b||0===b.length)throw Error("Specify name of project query");if(!e||!e.length)throw Error("Specify ids to project");this.name=b;this.data={ids:e};this.queryType="GraphProjectQuery";var f=this;if(g){this.data.placeholders=g;for(var n in this.data.placeholders)this.data.placeholders[n]=
this.data.placeholders[n]}this.toRequest=function(b){var g=new c.Appacitive.HttpRequest,e=this.toUrl();g.url=e.url;g.description=e.description;g.method="post";g.data=this.data;g.options=b;return g};this.toUrl=function(){return{url:c.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project",description:"Project Query with name "+this.name}};var p=function(b){var g,e;for(e in b)if("status"!==e){g=b[e];break}var h=function(b,g,e){var f=[];b.forEach(function(b){var k=b.__children;delete b.__children;
var m=b.__edge;delete b.__edge;b=c.Appacitive.Object._create(b,!0);b.children={};for(var l in k)b.children[l]=[],b.children[l]=h(k[l].values,k[l].parent,b.id);m&&(m.__endpointa={objectid:e,label:g},m.__endpointb={objectid:b.id(),label:m.__label},delete m.__label,b.connection=c.Appacitive.Connection._create(m,!0));f.push(b)});return f};return h(g.values)};this.collection=function(b,g){g=g||{};b=b||[];_type.isObject(b)&&(g=b,b=null);b||(b=this.results?ths.results:[]);0<b.length&&b[0]instanceof c.Appacitive.BaseObject&&
c.Appacitive.Object._getClass(b[0].className);return new Appacitive.Collection(b,_extend(g,{model:this.model,query:this}))};this.fetch=function(b){var g=c.Appacitive.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(c){f.results=p(c);g.fulfill(results)};b.promise=g;b.entity=this;return c.Appacitive.http.send(b)}}})(global);
var ArrayProto=Array.prototype,ObjectProto=Object.prototype,each=function(c,e,b){if(null!=c)if(ArrayProto.forEach&&c.forEach===ArrayProto.forEach)c.forEach(e,b);else if(c.length===+c.length)for(var f=0,h=c.length;f<h&&e.call(b,c[f],f,c)!=={};f++);else for(f in c)if(ObjectProto.hasOwnProperty.call(c,f)&&e.call(b,c[f],f,c)==={})break},_extend=function(c){each(ArrayProto.slice.call(arguments,1),function(e){if(e)for(var b in e)c[b]=e[b]});return c},extend=function(c,e){var b=this,f;f=_type.isObject(c)&&
c.hasOwnProperty("constructor")?c.constructor:function(){return b.apply(this,arguments)};_extend(f,b,e);var h=function(){this.constructor=f};h.prototype=b.prototype;f.prototype=new h;c&&_extend(f.prototype,c);f.__super__=b.prototype;return f};(function(c){c.Appacitive._extend=function(c,b,f){return extend.apply(c,[b,f])}})(global);
(function(c){c.Appacitive.BaseObject=function(e,b){var f={};(b=b||{})&&b.parse&&(e=this.parse(e));_type.isObject(this.defaults)&&!b.setSnapShot&&(e=_extend({},this.defaults,e));b&&b.collection&&(this.collection=b.collection);var h={},l={},g={},m=function(b,e){for(var f in b)if(h[f]&&delete h[f],l[f]&&delete l[f],g[f]&&delete g[f],_type.isString(b[f]))e[f]=b[f];else if(b[f]instanceof Date)e[f]=c.Appacitive.Date.toISOString(b[f]);else if(_type.isObject(b[f]))if(b[f]instanceof c.Appacitive.GeoCoord)e[f]=
b[f].toString();else{e[f]||(e[f]={});for(var k in b[f])e[f][k]=b[f][k]}else if(_type.isArray(b[f])){if(e[f]=[],b[f].forEach(function(b){if(_type.isString(b))e[f].push(b);else if(_type.isNumber(b)||_type.isBoolean(b))e[f].push(value+"");else if(b instanceof Date)e[f].push(c.Appacitive.Date.toISOString(b));else if("__link"==f)e[f].push(b);else throw Error("Multivalued property cannot have values of property as an object");}),"__tags"!==f||"__link"!==f)e[f].push=function(b){var g=this.length;if(_type.isString(b))this[g]=
b;else if(_type.isNumber(b)||_type.isBoolean(b))this[g]=b+"";else if(b instanceof Date)this[g]=c.Appacitive.Date.toISOString(b);else throw Error("Multivalued property cannot have values of property as an object");return this}}else e[f]=b[f]},n=this,p={};m(e,p);var k=p;b.setSnapShot&&m(k,f);!f.__id&&p.__id&&(f.__id=p.__id);p.__type?(p.__type=p.__type.toLowerCase(),this.entityType="type",this.type="object",this.className=p.__type):p.__relationtype&&(p.__relationtype=p.__relationtype.toLowerCase(),this.entityType=
"relation",this.type="connection",this.className=p.__relationtype);this.cid=parseInt(1E8*Math.random(),10);k.__attributes||(k.__attributes={});f.__attributes||(f.__attributes={});var q=[];k.__tags||(k.__tags=[]);f.__tags||(f.__tags=[]);var r="",t="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __type __relationtype __typeid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link __acls".split(" "),u=["__link","__endpointa","__endpointb"],v=function(c){c=c||
{};c.message=c.message||"Server error";c.code=c.code||"500";return c};this.attributes=this.toJSON=this.getObject=function(){return JSON.parse(JSON.stringify(k))};this.properties=function(){var c=this.attributes();delete c.__attributes;delete c.__tags;return c};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};this.parse=function(c,b){return c};this.attr=function(){if(0===arguments.length)return k.__attributes||(k.__attributes={}),k.__attributes;
if(1===arguments.length)return k.__attributes||(k.__attributes={}),k.__attributes[arguments[0]];if(2===arguments.length){if(!_type.isString(arguments[1])&&null!==arguments[1])throw Error("only string values can be stored in attributes.");k.__attributes||(k.__attributes={});k.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");w("__attributes");return k.__attributes};var B=function(){if(!k.__attributes)return null;
if(!f.__attributes)return k.__attributes;var c=!1,b=JSON.parse(JSON.stringify(f.__attributes)),g;for(g in k.__attributes)null==k.__attributes[g]||void 0==k.__attributes[g]?(b[g]=null,c=!0):k.__attributes[g]!=f.__attributes[g]?(b[g]=k.__attributes[g],c=!0):k.__attributes[g]==f.__attributes[g]&&delete b[g];return c?b:null};this.getChangedAttributes=B;this.aggregate=function(){var c={},b;for(b in k){if(!k.hasOwnProperty(b))return;"$"==b[0]&&(c[b.substring(1)]=k[b])}if(0===arguments.length)return c;if(1==
arguments.length)return c[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};this.tags=function(){return k.__tags?k.__tags:[]};this.addTag=function(c){if(!c||!_type.isString(c)||!c.length)return this;k.__tags||(k.__tags=[]);k.__tags.push(c);k.__tags=Array.distinct(k.__tags);if(!q||!q.length)return w("__tags"),this;c=q.indexOf(c);-1!=c&&q.splice(c,1);w("__tags");return this};this.removeTag=function(c){if(!c||!_type.isString(c)||!c.length)return this;
q.push(c);q=Array.distinct(q);if(!k.__tags||!k.__tags.length)return w("__tags"),this;c=k.__tags.indexOf(c);-1!=c&&k.__tags.splice(c,1);w("__tags");return this};var A=function(){if(!k.__tags)return[];if(!f.__tags)return k.__tags;var c=[];k.__tags.forEach(function(b){-1==f.__tags.indexOf(b)&&c.push(b)});return 0<c.length?c:null};this.getChangedTags=A;this.getRemovedTags=function(){return _removetags};var y=function(c,b,g,e){if(!c||!_type.isString(c)||0===c.length||0==c.trim().indexOf("__")||0===c.trim().indexOf("$")||
void 0==b||null==b)return this;c=c.toLowerCase();try{var f=function(b){if(!_type.isString(b))if(_type.isNumber(b)||_type.isBoolean(b))b+="";else throw Error("Multivalued property cannot have values of property as an object");if(k[c]&&_type.isArray(k[c])){var e=k[c].indexOf(b);"additems"==g?k[c].push(b):-1==e&&"adduniqueitems"==g?k[c].push(b):"removeitems"==g&&k[c].removeAll(b)}else"removeitems"!=g&&(k[c]=[b]);l[c]||(l[c]={additems:[],adduniqueitems:[],removeitems:[]});l[c][g].push(b)};_type.isArray(b)?
b.forEach(function(c){f(c)}):f(b);w(c,e)}catch(h){throw Error("Unable to add item to "+c);}return n};this.add=function(c,b,g){return y.apply(this,[c,b,"additems",g])};this.addUnique=function(c,b,g){return y.apply(this,[c,b,"adduniqueitems",g])};this.remove=function(c,b,g){return y.apply(this,[c,b,"removeitems",g])};var z=function(c){var b=!1,e=JSON.parse(JSON.stringify(f)),m;for(m in e)"$"==m[0]&&delete e[m];for(var p in k)null==k[p]||void 0==k[p]?(e[p]=null,b=!0):k[p]!=f[p]?"__tags"==p||"__attributes"==
p?delete e[p]:_type.isArray(k[p])?l[p]&&!g[p]?(e[p]=l[p],b=!0):k[p].equals(f[p])?delete e[p]:(e[p]=k[p],b=!0):(e[p]=h[p]&&!g[p]?{incrementby:h[p].value}:k[p],b=!0):k[p]==f[p]&&delete e[p];try{t.forEach(function(c){e[c]&&delete e[c]})}catch(r){}m=A();c?(m&&(e.__addtags=m,b=!0),q&&0<q.length&&(e.__removetags=q,b=!0)):m&&(e.__tags=m,b=!0);(c=B())?(e.__attributes=c,b=!0):delete e.__attributes;"object"==n.type&&n._aclFactory&&(c=n._aclFactory.getChanged())&&(e.__acls=c);return b&&!Object.isEmpty(e)?e:
!1};this.changed=function(){return this.isNew()?this.toJSON():z()};this.hasChanged=function(){if(this.isNew())return!0;var c=z(!0);return 0===arguments.length?Object.isEmpty(c)?!1:!0:1==arguments.length&&_type.isString(arguments[0])&&0<arguments[0].length&&c&&c[arguments[0]]?!0:!1};this.changedAttributes=function(){if(this.isNew())return this.toJSON();var c=z(!0);if(0===arguments.length)return c;if(1==arguments.length&&_type.isArray(arguments[0])&&arguments[0].length){var b={};arguments[0].forEach(function(g){c[g]&&
b.push(c[g])});return b}return!1};this.previous=function(){return this.isNew()?null:1==arguments.length&&_type.isString(arguments[0])&&arguments[0].length?f[arguments[0]]:null};this.previousAttributes=function(){return this.isNew()?null:f};this.fields=function(){if(1==arguments.length){var c=arguments[0];_type.isString(c)?r=c:_type.isArray(c)&&(r=c.join(","));return this}return r};var x={integer:function(c){if(c){var b=parseInt(c);if(!isNaN(b))return b}return c},decimal:function(c){if(c){var b=parseFloat(c);
if(!isNaN(b))return b}return c},"boolean":function(c){return void 0!==c&&null!==c&&("true"===c.toString().toLowerCase()||!0===c||0<c)?!0:!1},date:function(b){if(b){var g=c.Appacitive.Date.parseISODate(b);if(g)return g}return b},datetime:function(b){if(b){var g=c.Appacitive.Date.parseISODate(b);if(g)return g}return b},time:function(b){if(b){var g=c.Appacitive.Date.parseISOTime(b);if(g)return g}return b},string:function(c){return c?c.toString():c},geocode:function(b){if(!_type.isString(b)||0==b.trim().length)return!1;
b=b.split(",");return 2!==b.length?!1:new c.Appacitive.GeoCoord(b[0],b[1])}};this.get=function(c,b){if(c){if(b&&x[b.toLowerCase()]){if(x[b.toLowerCase()])return x[b.toLowerCase()](k[c]);throw Error('Invalid cast-type "'+b+'"" provided for get "'+c+'"');}return k[c]}};this.tryGet=function(c,b,g){c=this.get(c,g);return void 0!==c?c:b};var w=function(c,b){if(b&&!b.silent){var g=z();if(g[c]||-1!=t.indexOf(c))n.trigger("change:"+c,n,g[c]||k[c],{}),n.trigger("change",n,b)}},E=function(c){c&&!c.silent&&
n.trigger("destroy",n,n.collection,c)};this.set=function(b,e,m){m=m||{};if(!b||!_type.isString(b)||0===b.length||0===b.trim().indexOf("$"))return this;b=b.toLowerCase();try{if(void 0==e||null==e)k[b]=null;else if(_type.isString(e))k[b]=e;else if(_type.isNumber(e)||_type.isBoolean(e))k[b]=e+"";else if(e instanceof Date)k[b]="date"==dataType?c.Appacitive.Date.toISODate(e):"time"==dataType?c.Appacitive.Date.toISOTime(e):c.Appacitive.Date.toISOString(e);else if(_type.isObject(e))if(-1!==u.indexOf(b))k[b]=
e;else if(e instanceof c.Appacitive.GeoCoord)k[b]=e.toString();else throw Error("Property cannot have value as an object");else _type.isArray(e)&&(k[b]=[],e.forEach(function(c){if(_type.isString(c))k[b].push(c);else if(_type.isNumber(c)||_type.isBoolean(c))k[b].push(c+"");else{if(e instanceof Date)throw Error("Multivalued property cannot have values of property as date");throw Error("Multivalued property cannot have values of property as an object");}}),"tags"!==b||"__link"!==b)&&(k[b].push=function(c){var g=
this.length;if(_type.isString(c))this[g]=c;else if(_type.isNumber(c)||_type.isBoolean(c))this[g]=c+"";else throw Error("Multivalued property cannot have values of property as an object");w(b,m);return this});delete h[b];delete l[b];delete g[b];k[b]!==f[b]&&(_type.isArray(k[b])&&!k[b].equals(f[b])||_type.isString(k[b])||_type.isObject(k[b]))&&(g[b]=!0);w(b,m);return this}catch(n){throw Error("Unable to set "+b);}};this.unset=function(c,b){if(!c||!_type.isString(c)||0===c.length||0===c.indexOf("__"))return this;
c=c.toLowerCase();delete k[c];w(c,b);return this};this.has=function(c){return c&&_type.isString(c)&&0!==c.length?k[c]&&!_type.isUndefined(k[c])?!0:!1:!1};this.isNew=function(){return k.__id&&k.__id.length?!1:!0};this.clone=function(){return"object"==this.type?c.Appacitive.Object._create(this.toJSON()):new c.Appacitive.connection._create(this.toJSON())};this.copy=function(c,b){c&&(m(c,k),b&&m(c,f));return this};this.mergeWithPrevious=function(){m(k,f);q=[];h={};l={};g={};return this};var C=function(){m(f,
k);q=[];h={};l={};g={}};this.rollback=function(){k=p={};C();return this};var D=function(c,b,g,e){if(!c||!_type.isString(c)||0===c.length||0===c.indexOf("__"))return this;c=c.toLowerCase();if(_type.isObject(k[c])||_type.isArray(k[c]))throw Error("Cannot increment/decrement array/object");try{_type.isObject(b)?(e=b,b=g):b=!b||isNaN(Number(b))?g:Number(b)*g,k[c]=isNaN(Number(k[c]))?b:Number(k[c])+b,n.isNew()||(h[c]={value:(h[c]?h[c].value:0)+b})}catch(f){throw Error("Cannot perform increment/decrement operation");
}w(c,e);return n};this.increment=function(c,b,g){return D(c,b,1,g)};this.decrement=function(c,b,g){return D(c,b,-1,g)};this.save=function(){return k.__id?F.apply(this,arguments):G.apply(this,arguments)};var G=function(b){var g=n.type;!k.__type||"user"!=k.__type.toLowerCase()&&"device"!=k.__type.toLowerCase()||(g=k.__type.toLowerCase());for(var e in k)"$"==e[0]&&delete k[e];k.__revision&&delete k.__revision;"object"==g&&n._aclFactory&&(e=n._aclFactory.getChanged())&&(k.__acls=e);var h=new c.Appacitive._Request({method:"PUT",
type:g,op:"getCreateUrl",args:[this.className,r],data:k,options:b,entity:n,onSuccess:function(e){var m=null;e&&e[g]?(f=m=e[g],k.__id=m.__id,C(),"connection"==n.type?n.parseConnection():n._aclFactory&&n._aclFactory.merge(),c.Appacitive.eventManager.fire(n.entityType+"."+g+".created",n,{object:n}),n.created=!0,n.trigger("sync",n,e[g],b),h.promise.fulfill(n)):(c.Appacitive.eventManager.fire(n.entityType+"."+g+".createFailed",n,{error:e.status}),h.promise.reject(e.status,n))}});return h.send()},F=function(b,
g){c.Appacitive.Promise.is(g)||(g=c.Appacitive.Promise.buildPromise(b));var e=z(!0),h;for(h in e)"$"==h[0]&&delete e[h];if(Object.isEmpty(e))g.fulfill(n);else{var m=n.type;h=[n.className,f.__id?f.__id:k.__id,r];k&&(k.__type&&("user"==k.__type.toLowerCase()||"device"==k.__type.toLowerCase()))&&(m=k.__type.toLowerCase(),h.splice(0,1));var l=new c.Appacitive._Request({method:"POST",type:m,op:"getUpdateUrl",args:h,data:e,options:b,entity:n,onSuccess:function(g){g&&g[m]?(f=g[m],n._aclFactory&&n._aclFactory.merge(),
C(),delete n.created,n.trigger("sync",n,g[m],b),c.Appacitive.eventManager.fire(n.entityType+"."+m+"."+k.__id+".updated",n,{object:n}),l.promise.fulfill(n)):(g=g||{},g.status=g.status||{},g.status=v(g.status),c.Appacitive.eventManager.fire(n.entityType+"."+m+"."+k.__id+".updateFailed",n,{object:g.status}),l.promise.reject(g.status,n))}});return l.send()}return g},H=function(b){if(!k.__id)throw Error("Please specify id for get operation");var g=this.type;k&&(k.__type&&("user"==k.__type.toLowerCase()||
"device"==k.__type.toLowerCase()))&&(g=k.__type.toLowerCase());var e=new c.Appacitive._Request({method:"GET",type:g,op:"getGetUrl",args:[this.className,k.__id,r],options:b,entity:n,onSuccess:function(c){c&&c[g]?(f=c[g],m(f,k),c.connection&&(n.endpoints||n.endpointA&&n.endpointB||n.setupConnection(k.__endpointa,k.__endpointb)),n.trigger("sync",n,c[g],b),e.promise.fulfill(n)):(c=c||{},c.status=c.status||{},c.status=v(c.status),e.promise.reject(c.status,n))}});return e.send()};this.fetch=function(c){return H.apply(this,
[c])};this.del=this.destroy=function(b){b=b||{};var g=b.deleteConnections;_type.isBoolean(b)&&(g=b,b={});b.wait||E(b);if(!k.__id)return(new c.Appacitive.Promise.buildPromise(b)).fulfill();var e=this.type;!k.__type||"user"!=k.__type.toLowerCase()&&"device"!=k.__type.toLowerCase()||(e=k.__type.toLowerCase());var f=new c.Appacitive._Request({method:"DELETE",type:e,op:"getDeleteUrl",args:[this.className,k.__id,g],options:b,entity:this,onSuccess:function(c){f.promise.fulfill(c);c&&c.status?(b.wait&&E(b),
f.promise.fulfill(c.status)):(c=c||{},c.status=c.status||{},c.status=v(c.status),f.promise.reject(c.status,n))}});return f.send()};"object"==this.type&&(this.destroyWithConnections=function(c){return this.destroy(_extend({deleteConnections:!0},c))})};c.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())};c.Appacitive.Events.mixin(c.Appacitive.BaseObject.prototype)})(global);
(function(c){var e=function(){return Math.floor(65536*Math.random()).toString(16)};c.Appacitive.GUID=function(){var c=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),f="",h,l,g,m,n,p,k=0,c=c.replace(/\r\n/g,"\n");l="";for(g=0;g<c.length;g++)m=c.charCodeAt(g),128>m?l+=String.fromCharCode(m):(127<m&&2048>m?l+=String.fromCharCode(m>>6|192):(l+=String.fromCharCode(m>>12|224),l+=String.fromCharCode(m>>6&63|128)),l+=String.fromCharCode(m&63|128));for(c=l;k<c.length;)h=c.charCodeAt(k++),l=c.charCodeAt(k++),
g=c.charCodeAt(k++),m=h>>2,h=(h&3)<<4|l>>4,n=(l&15)<<2|g>>6,p=g&63,isNaN(l)?n=p=64:isNaN(g)&&(p=64),f=f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);return f.toString()}})(global);
(function(c){var e=["allow","deny"],b=["create","read","update","delete","manageaccess"],f=function(c){var e=[];c.forEach(function(c){_type.isString(c)&&-1!=b.indexOf(c.toLowerCase())&&e.push(c.toLowerCase())});return e};c.Appacitive._Acl=function(h,l){var g=h||[];_type.isArray(g)||(g=[]);var m={};l&&(m=JSON.parse(JSON.stringify(g)));this.acls=g=JSON.parse(JSON.stringify(g));var n=[],p=function(b,h,m,k){if(!m)throw Error("Specify valid user or usergroup");m instanceof c.Appacitive.Object&&("user"==
m.typeName&&!m.isNew())&&(m=m.id());var l=g.filter(function(c){return c.sid==m&&c.type==h});l&&0!=l.length?l=l[0]:(l={sid:m,type:h,deny:[],allow:[]},g.push(l));l.allow||(l.allow=[]);l.deny||(l.deny=[]);k=f(k);var p=n.filter(function(c){return c.sid==m&&c.type==h});p&&0!=p.length?p=p[0]:(p={sid:m,type:h},n.push(p));k.forEach(function(c){for(var g=0;g<e.length;g+=1){var f=l[e[g]].indexOf(c);if(-1!=f){l[e[g]].splice(f,1);break}}"inherit"!=b&&l[b].push(c);p[c]=b});return this},k=function(c,b,g,e){if(!g)throw Error("Please provide valid id or name for setting acls");
if(!e)throw Error("Please provide valid access permissions for setting acls");_type.isArray(e)||(e=[e]);_type.isArray(g)?g.forEach(function(g){p(c,b,g,e)}):p(c,b,g,e);return this},q=function(){g.allowUser=function(c,b){return k.apply(this,["allow","user",c,b])};g.allowGroup=function(c,b){return k.apply(this,["allow","usergroup",c,b])};g.denyUser=function(c,b){return k.apply(this,["deny","user",c,b])};g.denyGroup=function(c,b){return k.apply(this,["deny","usergroup",c,b])};g.resetUser=function(c,b){return k.apply(this,
["inherit","user",c,b])};g.resetGroup=function(c,b){return k.apply(this,["inherit","usergroup",c,b])};g.allowAnonymous=function(c){return k.apply(this,["allow","usergroup",["anonymous"],c])};g.denyAnonymous=function(c){return k.apply(this,["deny","usergroup",["anonymous"],c])};g.resetAnonymous=function(c){return k.apply(this,["inherit","usergroup",["anonymous"],c])};g.allowLoggedIn=function(c){return k.apply(this,["allow","usergroup",["anonymous"],c])};g.denyLoggedIn=function(c){return k.apply(this,
["deny","usergroup",["anonymous"],c])};g.resetLoggedIn=function(c){return k.apply(this,["inherit","usergroup",["anonymous"],c])}};this._rollback=function(){n=[];g=JSON.parse(JSON.stringify(m));q();return this};this.getChanged=function(){var c=[];n.forEach(function(g){var f={sid:g.sid,type:g.type,allow:[],deny:[],inherit:[]};b.forEach(function(c){g[c]&&f[g[c]].push(c)});e.forEach(function(c){0==f[c].length&&delete f[c]});0==f.inherit.length&&delete f.inherit;c.push(f)});return 0==c.length?null:c};
this.merge=function(){n=[];return this};q();return this};c.Appacitive.Group=new function(){var b=function(b,g,e,f){if(!g||!_type.isString(g)||0===g.length)throw Error("Please specify valid groupname");_type.isArray(e)||(e=[e]);var h={};h[b]=[];e.forEach(function(g){g&&(g instanceof c.Appacitive.Object&&"user"==g.typeName&&!g.isNew()?h[b].push(g.id()):h[b].push(g))});if(0==h[b].length)throw Error("Please specify valid members as second argument");var k=new c.Appacitive._Request({method:"POST",type:"usergroup",
op:"getUpdateUrl",args:[g],data:h,entity:this,options:f,onSuccess:function(c){k.promise.fulfill(c)}});return k.send()};this.addMembers=function(c,g,e){return b("add",c,g)};this.removeMembers=function(c,g,e){return b("remove",c,g)}}})(global);
(function(c){c.Appacitive.Object=function(b,e){b=b||{};e=e||{};this.className&&(b.__type=this.className);_type.isString(b)&&(b={__type:b});if(!b.__type)throw Error("Cannot set object without __type");_type.isBoolean(e)&&(e={setSnapShot:!0});c.Appacitive.BaseObject.call(this,b,e);this.type="object";this.getObject=this.getObject;this.children={};this.toJSON=function(c){if(c){var b=function(c){var g=[];c.forEach(function(c){var e=c.getObject();if(c.children&&!Object.isEmpty(c.children)){e.children={};
for(var f in c.children)e.children[f]=b(c.children[f])}c.connection&&(e.__connection=c.connection.toJSON());g.push(e)});return g};return b([this])[0]}return this.getObject()};this.typeName=b.__type;this._aclFactory=new Appacitive._Acl(e.__acls,e.setSnapShot);this.acls=this._aclFactory.acls;_type.isFunction(this.initialize)&&this.initialize.apply(this,[b]);return this};c.Appacitive.Object.prototype=new c.Appacitive.BaseObject;c.Appacitive.Object.prototype.constructor=c.Appacitive.Object;c.Appacitive.Object.extend=
function(b,f,g){if(!_type.isString(b))throw Error("Appacitive.Object.extend's first argument should be the type-name.");var m=null;f=f||{};f.className=b;m=c.Appacitive._extend(c.Appacitive.Object,f,g);delete m.extend;m.className=b;m.type=b;return e[b]=m};var e={},b=function(b){if(!_type.isString(b))throw"_getClass requires a string argument.";var f=e[b];f||(f=c.Appacitive.Object.extend(b),e[b]=f);return f};c.Appacitive.Object._getClass=b;c.Appacitive.Object._create=function(c,e,g){return(new (this.className?
this:g?g:b(c.__type))(c)).copy(c,e)};var f=function(b,e){var g=[];b.forEach(function(b){b=c.Appacitive.Object._create(b,!0,e);g.push(b)});return g};c.Appacitive.Object._parseResult=f;c.Appacitive.Object.multiDelete=function(b,e){b=b||{};e=e||{};var g=[];this.className&&(b.type=this.className);_type.isArray(b)&&0<b.length&&(g=b,b={type:g[0].className,ids:g.map(function(c){return c.id()}).filter(function(c){return c})});if(!b.type||!_type.isString(b.type)||0===b.type.length)throw Error("Specify valid type");
if("user"===b.type.toLowerCase()||"device"===b.type.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var f=new c.Appacitive._Request({method:"POST",data:{idlist:b.ids},type:"object",op:"getMultiDeleteUrl",args:[b.type],options:e,onSuccess:function(c){e&&!e.silent&&g.forEach(function(c){c.trigger("destroy",c,c.collection,e)});f.promise.fulfill()}});return f.send()};c.Appacitive.Object.multiGet=function(b,
e){b=b||{};this.className&&(b.relation=this.className,b.entity=this);if(!b.type||!_type.isString(b.type)||0===b.type.length)throw Error("Specify valid type");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var g=new c.Appacitive._Request({method:"GET",type:"object",op:"getMultiGetUrl",args:[b.type,b.ids.join(","),b.fields],options:e,onSuccess:function(c){g.promise.fulfill(f(c.objects,b.entity))}});return g.send()};c.Appacitive.Object.get=function(b,e){b=b||{};this.className&&(b.relation=
this.className,b.entity=this);if(!b.type)throw Error("Specify type");if(!b.id)throw Error("Specify id to fetch");var g=c.Appacitive.Object._create({__type:b.type,__id:b.id});g.fields=b.fields;return g.fetch(b,e)};c.Appacitive.Object.prototype.getConnections=function(b){if(this.isNew())throw Error("Cannot fetch connections for new object");b.objectId=this.get("__id");return new c.Appacitive.Queries.GetConnectionsQuery(b)};c.Appacitive.Object.prototype.getConnectedObjects=function(b){if(this.isNew())throw Error("Cannot fetch connections for new object");
b=b||{};_type.isString(b)&&(b={relation:b});b.type=this.get("__type");b.objectId=this.get("__id");b.object=this;return new c.Appacitive.Queries.ConnectedObjectsQuery(b)};c.Appacitive.Object.prototype.fetchConnectedObjects=c.Appacitive.Object.prototype.getConnectedObjects;c.Appacitive.Object.findAll=c.Appacitive.Object.findAllQuery=function(b){b=b||{};this.className&&(b.type=this.className,b.entity=this);return new c.Appacitive.Queries.FindAllQuery(b)}})(global);
(function(c){var e=function(b,e,f){var h={label:b.label};b.objectid&&(h.objectid=b.objectid);if(b.object)b.object instanceof c.Appacitive.Object?b.object.id()?h.objectid=b.object.id():h.object=b.object.getObject():_type.isObject(b.object)&&(b.object.__id?h.objectid=b.object.__id:h.object=b.object,b.object=c.Appacitive.Object._create(b.object));else if(!h.objectid&&!h.object)throw Error("Incorrectly configured endpoints provided to parseConnection");f["endpoint"+e]=b;return h},b=function(b,e,f){b.object&&
_type.isObject(b.object)?(f["endpoint"+e]?f["endpoint"+e]&&f["endpoint"+e].object&&f["endpoint"+e].object instanceof c.Appacitive.Object?f["endpoint"+e].object.copy(b.object,!0):f["endpoint"+e].object=c.Appacitive.Object._create(b.object,!0):(f["endpoint"+e]={},f["endpoint"+e].object=c.Appacitive.Object._create(b.object,!0)),f["endpoint"+e].objectid=b.object.__id,f["endpoint"+e].label=b.label,f["endpoint"+e].type=b.type):f["endpoint"+e]=b};c.Appacitive.Connection=function(e,f){e=e||{};f=f||{};this.className&&
(e.__relationtype=this.className);_type.isString(e)&&(e={__relationtype:e});if(!e.__relationtype&&!e.relation)throw Error("Cannot set connection without relation");e.relation&&(e.__relationtype=e.relation,delete e.relation);_type.isBoolean(f)&&(f={setSnapShot:!0});e.endpoints&&2===e.endpoints.length&&(e.__endpointa=e.endpoints[0],e.__endpointb=e.endpoints[1],delete e.endpoints);c.Appacitive.BaseObject.call(this,e,f);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var c=
"A",f="B";e.__endpointa.label.toLowerCase()!==this.get("__endpointb").label.toLowerCase()||(e.__endpointa.label.toLowerCase()==e.__endpointb.label.toLowerCase()||e.__endpointa.objectid!=this.get("__endpointb").objectid&&e.__endpointa.objectid)||(c="B",f="A");b(this.get("__endpointa"),c,this);b(this.get("__endpointb"),f,this);this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===
arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var c=[];c.push(this.endpointA);c.push(this.endpointB);return c};return this};f.setSnapShot?this.parseConnection(e):e.__endpointa&&e.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));this.relationName=e.__relationtype;_type.isFunction(this.initialize)&&this.initialize.apply(this,[e]);return this};c.Appacitive.Connection.prototype=new c.Appacitive.BaseObject;c.Appacitive.Connection.prototype.constructor=
c.Appacitive.Connection;c.Appacitive.Connection.extend=function(b,e,h){if(!_type.isString(b))throw Error("Appacitive.Connection.extend's first argument should be the relation-name.");var l=null;e=e||{};e.className=b;l=c.Appacitive._extend(c.Appacitive.Connection,e,h);delete l.extend;l.className=b;l.relation=b;return f[b]=l};var f={},h=function(b){if(!_type.isString(b))throw"_getClass requires a string argument.";var e=f[b];e||(e=c.Appacitive.Connection.extend(b),f[b]=e);return e};c.Appacitive.Connection._getClass=
h;c.Appacitive.Connection._create=function(c,b,e){return(new (this.className?this:e?e:h(c.__relationtype))(c)).copy(c,b)};var l=function(b,e){var f=[];b||(b=[]);b.forEach(function(b){f.push(c.Appacitive.Connection._create(b,!0,e))});return f};c.Appacitive.Connection._parseResult=l;c.Appacitive.Connection.prototype.setupConnection=function(c,b){if(!(c&&(c.objectid||c.object)&&c.label&&b&&(b.objectid||b.object)&&b.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",
e(c,"A",this),{silent:!0});this.set("__endpointb",e(b,"B",this),{silent:!0});this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var c=[];c.push(this.endpointA);c.push(this.endpointB);return c}};c.Appacitive.Connection.prototype.get=c.Appacitive.Connection.get=
function(b,e){b=b||{};this.className&&(b.relation=this.className);if(!b.relation)throw Error("Specify relation");if(!b.id)throw Error("Specify id to fetch");var f=c.Appacitive.Connection._create({__relationtype:b.relation,__id:b.id});f.fields=b.fields;return f.fetch(e)};c.Appacitive.Connection.multiGet=function(b,e){b=b||{};this.className&&(b.relation=this.className,b.entity=this);if(!b.relation||!_type.isString(b.relation)||0===b.relation.length)throw Error("Specify valid relation");if(!b.ids||0===
b.ids.length)throw Error("Specify ids to delete");var f=new c.Appacitive._Request({method:"GET",type:"connection",op:"getMultiGetUrl",args:[b.relation,b.ids.join(","),b.fields],options:e,onSuccess:function(c){f.promise.fulfill(l(c.connections,b.entity))}});return f.send()};c.Appacitive.Connection.multiDelete=function(b,e){b=b||{};e=e||{};var f=[];this.className&&(b.relation=this.className);_type.isArray(b)&&0<b.length&&(f=b,b={relation:f[0].className,ids:f.map(function(b){return b.id()}).filter(function(b){return b})});
if(!b.relation||!_type.isString(b.relation)||0===b.relation.length)throw Error("Specify valid relation");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var h=new c.Appacitive._Request({method:"POST",data:{idlist:b.ids},type:"connection",op:"getMultiDeleteUrl",args:[b.relation],options:e,onSuccess:function(b){e&&!e.silent&&f.forEach(function(b){b.trigger("destroy",b,b.collection,e)});h.promise.fulfill()}});return h.send()};c.Appacitive.Connection.findAll=c.Appacitive.Connection.findAllQuery=
function(b){b=b||{};this.className&&(b.relation=this.className,b.entity=this);return new c.Appacitive.Queries.FindAllQuery(b)};c.Appacitive.Connection.interconnectsQuery=c.Appacitive.Connection.getInterconnects=function(b){return new c.Appacitive.Queries.InterconnectsQuery(b)};c.Appacitive.Connection.betweenObjectsQuery=c.Appacitive.Connection.getBetweenObjects=function(b){return new c.Appacitive.Queries.GetConnectionsBetweenObjectsQuery(b)};c.Appacitive.Connection.betweenObjectsForRelationQuery=
c.Appacitive.Connection.getBetweenObjectsForRelation=function(b){b=b||{};this.className&&(b.relation=this.className,b.entity=this);return new c.Appacitive.Queries.GetConnectionsBetweenObjectsForRelationQuery(b)}})(global);
(function(c){var e=function(b,e){b=b||{};b.__type="user";c.Appacitive.Object.call(this,b,e);return this},b=null;e.currentUser=e.current=function(){return b};var f=function(b,e,f){var h=this.get("__id");if(!h||!_type.isString(h)||0===h.length)throw Error("Please specify valid userid");if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid oldPassword");if(!e||!_type.isString(e)||0===e.length)throw Error("Please specify valid newPassword");var k=new c.Appacitive._Request({method:"POST",
type:"user",op:"getUpdatePasswordUrl",args:[h],options:f,data:{oldpassword:b,newpassword:e},entity:this,onSuccess:function(b){k.promise.fulfill(that)}});return k.send()},h=function(b,e){var f=this.get("__id");if(!this.get("__id"))return this.set("__link",b),c.Appacitive.Promise.buildPromise(e).fulfill(this);var h=this,k=new c.Appacitive._Request({method:"POST",type:"user",op:"getLinkAccountUrl",args:[f],options:e,data:b,entity:this,onSuccess:function(c){c=h.get("__link");_type.isArray(c)||(c=c?[c]:
[]);c.push(b);h.copy({__link:c},!0);k.promise.fulfill(h)}});return k.send()};e.setCurrentUser=function(e,h,l){if(!e)throw Error("Cannot set null object as user");var p=e;if(p instanceof c.Appacitive.User)if(p.get("__id")&&0!==p.get("__id").length)e=p.toJSON();else throw Error("Specify user __id");else p=new c.Appacitive.User(e,!0);c.Appacitive.localStorage.set("Appacitive-User",e);l||(l=3600);b=p;h&&c.Appacitive.Session.setUserAuthHeader(h,l);b.logout=function(b){return c.Appacitive.Users.logout(b)};
b.updatePassword=function(b,c,e){return f.apply(this,[b,c,e])};b.logout=function(b){return c.Appacitive.Users.logout(b)};c.Appacitive.eventManager.clearAndSubscribe("type.user."+p.get("__id")+".updated",function(b,e){c.Appacitive.localStorage.set("Appacitive-User",e.object.getObject())});return b};e.prototype.linkedAccounts=function(){var b=this.get("__link");b?_type.isArray(b)||(b=[b]):b=[];return b};e.prototype.getAllLinkedAccounts=function(b){var e=this.get("__id");if(!e||!_type.isString(e)||0===
e.length)return c.Appacitive.Promise.buildPromise(b).fulfill(this.linkedAccounts(),this);var f=this,h=new c.Appacitive._Request({method:"GET",type:"user",op:"getGetAllLinkedAccountsUrl",args:[e],options:b,entity:this,onSuccess:function(){var b=a.identities||[];0<b.length?f.set("__link",b):f.set("__link",null);h.promise.fulfill(b,f)}});return h.send()};e.prototype.checkin=function(b,e){var f=this.get("__id");f&&_type.isString(f)&&0!==f.length||onSuccess&&_type.isFunction(onSuccess)&&onSuccess();if(!(b&&
b instanceof c.Appacitive.GeoCoord))throw Error("Invalid coordinates provided");var h=this,k=new c.Appacitive._Request({method:"POST",type:"user",op:"getCheckinUrl",args:[f,b.lat,b.lngerId],options:e,entity:this,onSuccess:function(){k.promise.fulfill(h)}});return k.send()};e.prototype.linkFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return h.apply(this,[{authtype:"facebook",accesstoken:b,name:"facebook"},c])};e.prototype.linkTwitter=function(b,c){if(!_type.isObject(b)||
!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var e={authtype:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret};b.consumerKey&&b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=b.consumerKey);return h.apply(this,[e,c])};e.prototype.unlink=function(b,e){if(!_.isString(b))throw Error("Specify aouth account type for unlinking");var f=this.get("__id");if(!this.get("__id"))return this.set("__link",null),promise.fulfill(this),
promise;var h=this,k=new c.Appacitive._Request({method:"POST",type:"user",op:"getDelinkAccountUrl",args:[f,b],options:e,entity:this,onSuccess:function(c){(c=h.get("__link"))?_type.isArray(c)||(c=[c]):c=[];if(0<=c.length){var e=null;c.forEach(function(c,f){c.name==b.toLowerCase()&&(e=f)});null!=e&&c.splice(e,1);h.copy({__link:c},!0)}else h.copy({__link:[]},!0);k.promise.fulfill(h)}});return k.send()};e.prototype.clone=function(){return new c.Appacitive.User(this.getObject())};c.Appacitive.User=c.Appacitive.Object.extend("user",
e.prototype);delete c.Appacitive.User._create;delete c.Appacitive.User._parseResult;delete c.Appacitive.User.multiDelete;e.deleteUser=function(b,e){if(!b)throw Error("Specify userid for user delete");return(new c.Appacitive.Object({__type:"user",__id:b})).destroyWithConnections(e)};e.deleteCurrentUser=function(e){var f=c.Appacitive.Promise.buildPromise(e);if(null===b)return c.Appacitive.Session.removeUserAuthHeader(),f.fulfill(),f;e=b.get("__id");this.deleteUser(e).then(function(){b=null;c.Appacitive.Session.removeUserAuthHeader();
f.fulfill()},function(){f.reject.apply(f,arguments)});return f};e.createNewUser=function(b,e){b=b||{};b.__type="user";if(!b.username||!b.password||!b.firstname||0===b.username.length||0===b.password.length||0===b.firstname.length)throw Error("username, password and firstname are mandatory");return(new c.Appacitive.User(b)).save(e)};e.createUser=e.createNewUser;e.signup=function(b,e){var f=this,h=c.Appacitive.Promise.buildPromise(e);this.createUser(b).then(function(){f.login(b.username,b.password).then(function(){h.fulfill.apply(h,
arguments)},function(b){h.reject.apply(h,arguments)})},function(){h.reject.apply(h,arguments)});return h};e.authenticateUser=function(e,f,h){e.expiry||(e.expiry=864E5);var l=this,k=new c.Appacitive._Request({method:"POST",type:"user",op:"getAuthenticateUserUrl",options:f,data:e,onSuccess:function(f){f&&f.user?(h&&(f.user.__authType=h),l.setCurrentUser(f.user,f.token,e.expiry),c.Appacitive.User.trigger("login",b,b,f.token),k.promise.fulfill({user:b,token:f.token})):k.promise.reject(f.status)}});return k.send()};
e.login=function(b,c,e){if(!b||!c||0==b.length||0==c.length)throw Error("Please specify username and password");return this.authenticateUser({username:b,password:c,expiry:864E5},e,"BASIC")};e.loginWithFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return this.authenticateUser({accesstoken:b,type:"facebook",expiry:864E5,createnew:!0},c,"FB")};e.loginWithTwitter=function(b,c){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");
var e={type:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret,expiry:864E5,createnew:!0};b.consumerKey&&b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=b.consumerKey);return this.authenticateUser(e,c,"TWITTER")};e.validateCurrentUser=function(b,e){var f=c.Appacitive.Promise.buildPromise({success:e});e&&_type.isBoolean(e)&&(b=e,e=function(){});var h=c.Appacitive.localStorage.get("Appacitive-UserToken");if(!h)return f.fulfill(!1),f;if(b)f.fulfill(!0);else try{var k=
this;this.getUserByToken(h).then(function(b){k.setCurrentUser(b,h);f.fulfill(!0)},function(){f.fulfill(!1)})}catch(l){f.fulfill(!1)}return f};var l=function(b,e,f){var h=new c.Appacitive._Request({method:"GET",type:"user",op:b,options:f,args:e,onSuccess:function(b){b&&b.user?h.promise.fulfill(new c.Appacitive.User(b.user)):h.promise.reject(b.status)}});return h.send()};e.getUserByToken=function(b,e){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid token");c.Appacitive.Session.setUserAuthHeader(b,
0,!0);return l("getUserByTokenUrl",[b],e)};e.getUserByUsername=function(b,c){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");return l("getUserByUsernameUrl",[b],c)};e.logout=function(e,f){b=null;return c.Appacitive.Session.removeUserAuthHeader(e,f)};e.sendResetPasswordEmail=function(b,e,f){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");if(!e||!_type.isString(e)||0===e.length)throw Error("Plase specify subject for email");var h=
new c.Appacitive._Request({method:"POST",type:"user",op:"getSendResetPasswordEmailUrl",options:f,data:{username:b,subject:e},onSuccess:function(){h.promise.fulfill()}});return h.send()};e.resetPassword=function(b,e,f){if(!b)throw Error("Please specify token");if(!e||0===e.length)throw Error("Please specify password");var h=new c.Appacitive._Request({method:"POST",type:"user",op:"getResetPasswordUrl",options:f,data:{newpassword:e},args:[b],onSuccess:function(){h.promise.fulfill()}});return h.send()};
e.validateResetPasswordToken=function(b,e){if(!b)throw Error("Please specify token");var f=new c.Appacitive._Request({method:"POST",type:"user",op:"getValidateResetPasswordUrl",options:e,data:{},args:[b],onSuccess:function(b){f.promise.fulfill(b.user)}});return f.send()};c.Appacitive.Users=c.Appacitive.User;c.Appacitive.Events.mixin(c.Appacitive.User)})(global);
(function(c){c.Appacitive.Collection=function(c,b){b||(b={});b.model&&(this.model=b.model);if(!this.model)throw Error("Please specify model for collection");void 0!==b.comparator&&(this.comparator=b.comparator);b.query?this.query(b.query):this.query(new Appacitive.Query(this.model));this._reset();this.initialize.apply(this,arguments);c&&this.reset(c,{silent:!0})};c.Appacitive.Events.mixin(c.Appacitive.Collection.prototype);_extend(c.Appacitive.Collection.prototype,{models:[],initialize:function(){},
_query:null,toJSON:function(c){return this.models.map(function(b){return b.toJSON(c)})},add:function(c,b){b=b||{};var f,h,l,g,m,n={},p={},k=[],q=b.sort,r;c=_type.isArray(c)?c.slice():[c];f=0;for(h=c.length;f<h;f++){c[f]=this._prepareModel(c[f]);l=c[f];if(!l)throw Error("Can't add an invalid model to a collection");g=l.cid;if(n[g]||this._byCid[g])throw Error("Duplicate cid: can't add the same model to a collection twice");(m=l.id())&&((r=p[m])||(r=this._byId[m]))?(r.copy(l.toJSON(),b.setSnapShot),
r.children=l.children):(p[m]=l,n[g]=l,k.push(l),this._addReference(l,b))}this.models.splice.apply(this.models,[null!=b.at?b.at:this.models.length,0].concat(k));q&&this.comparator&&this.sort({silent:!0});this.length=this.models.length;if(b.silent)return this;f=0;for(h=k.length;f<h;f++)l=k[f],b.index=f,l.trigger("add",l,this,b);return this},remove:function(c,b){var f,h,l,g;b=b||{};c=_type.isArray(c)?c.slice():[c];f=0;for(h=c.length;f<h;f++)if(g=this.getByCid(c[f])||this.get(c[f]))delete this._byId[g.id()],
delete this._byCid[g.cid],l=this.models.indexOf(g),this.models.splice(l,1),this.length--,b.silent||(b.index=l,g.trigger("remove",g,this,b)),this._removeReference(g);return this},push:function(c,b){return this.add(c,_extend({at:this.length},b))},pop:function(c){var b=this.at(this.length-1);this.remove(b,c);return b},unshift:function(c,b){return this.add(c,_extend({at:0},b))},shift:function(c){var b=this.at(0);this.remove(b,c);return b},slice:function(){return Array.prototype.slice.apply(this.models,
arguments)},get:function(e){return e&&this._byId[e instanceof c.Appacitive.BaseObject?e.id():e]},query:function(e){if(e){if(e instanceof c.Appacitive.Query||e instanceof c.Appacitive.Queries.GraphProjectQuery)return this._query=e,this;throw Error("Cannot bind this query");}return this._query},getByCid:function(c){return c&&this._byCid[c.cid||c]},at:function(c){return this.models[c]},where:function(c,b){return Object.isEmpty(c)?b?void 0:[]:this.models[b?"find":"filter"](function(b){for(var h in c)if(c[h]!==
b.get(h))return!1;return!0})},findWhere:function(c){return this.where(c,!0)},sort:function(c){c=c||{};if(!this.comparator)throw Error("Cannot sort a set without a comparator");1===this.comparator.length?this.models=this.models.sortBy(this.comparator):this.models.sort(this.comparator.bind(this.models));c.silent||this.trigger("reset",this,c);return this},pluck:function(c){return this.models.map(function(b){return b.get(c)})},first:function(){return 0<this.length?this.models[0]:null},last:function(){return 0<
this.length?this.models[this.length-1]:null},reset:function(c,b){b||(b={});for(var f=0,h=this.models.length;f<h;f++)this._removeReference(this.models[f],b);this._reset();this.add(c,_extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(e){e=_clone(e)||{};var b=this,f=this.query()||new c.Appacitive.Query(this.model),h=c.Appacitive.Promise.buildPromise(e);f.fetch(e).then(function(c){e.add?b.add(c,_extend({setSnapShot:!0},e)):b.reset(c,e);h.fulfill(b)},function(){h.reject.apply(h,
arguments)});return h},mutiGet:function(e){e=_clone(e)||{};var b=this,f=c.Appacitive.Promise.buildPromise(e),h=e.ids||[];if(0==h.length)return f.fulfill(b);h={ids:h,fields:e.fields};h[this.model.type||this.model.relation]=this.model.className;c.Appacitive.Object.multiGet(h).then(function(c){e.add?b.add(c,e):b.reset(c,e);f.fulfill(b)},function(){f.reject.apply(f,arguments)});return f},create:function(c,b){var f=this;b=b?_clone(b):{};if(!(c=this._prepareModel(c,b)))return!1;b.wait||this.add(c,b);var h=
b.success;b.success=function(){b.wait&&f.add(c,_extend({setSnapShot:!0},b));h&&h(c,f)};c.save(b);return c},_reset:function(c){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(e){e instanceof c.Appacitive.BaseObject||(e=new this.model(e));e.collection||(e.collection=this);return e},_addReference:function(c){this._byId[c.cid]=c;null!=c.id()&&(this._byId[c.id()]=c);this._byCid[c.cid]=c;c.on("all",this._onModelEvent,this)},_removeReference:function(c){this===c.collection&&
delete c.collection;c.off("all",this._onModelEvent,this)},_onModelEvent:function(c,b,f,h){if("add"!==c&&"remove"!==c||f===this)"destroy"===c&&this.remove(b,h),b&&"change:__id"===c&&(delete this._byId[b.previous("__id")],this._byId[b.id()]=b),this.trigger.apply(this,arguments)}});c.Appacitive.Collection.extend=function(e,b){e&&e.query&&(e._query=e.query,delete e.query);var f=c.Appacitive._extend(this,e,b);f.extend=this.extend;return f};"forEach each map find filter every some indexOf lastIndexOf isEmpty".split(" ").each(function(e){c.Appacitive.Collection.prototype[e]=
function(){var b=Array.prototype.slice.call(arguments);return Array.prototype[e].apply(this.models,b)}})})(global);
(function(c){var e=function(){var b=null,e=this.FB=null,h=!1;this.initialize=function(b){if(!Facebook)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!b.appId)throw Error("Please provide appid");if(!b.appSecret)throw Error("Please provide app secret");e=b.appSecret;this.FB=new (require("facebook-node-sdk"))({appId:_appId,secret:e});h=!0};this.requestLogin=function(c){c&&(b=c);return(new Appacitive.Promise).fulfill()};this.getCurrentUserInfo=function(){if(!h)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
var c=new Appacitive.Promise;this.FB&&b?this.FB.api("/me",function(b,e){e?c.fulfill(e):c.reject("Access token is invalid")}):c.reject("Either intialize facebook with your appid and appsecret or set accesstoken");return c};this.accessToken=function(){return 1===arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){c.Appacitive.Facebook.accessToken="";return(new Appacitive.Promise).fulfill()}};c.Appacitive.Facebook=
c.Appacitive.runtime.isBrowser?new function(){var b=null,e=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);e=!0};this.requestLogin=function(c){c=c||{};if(!e)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var l=new Appacitive.Promise;FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,l.fulfill(c.authResponse)):
l.reject()},c);return l};this.getCurrentUserInfo=function(){if(!e)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var c=new Appacitive.Promise;FB.api("/me",function(e){e&&!e.error?(b=FB.getAuthResponse().accessToken,c.fulfill(e)):c.reject()});return c};this.accessToken=function(){return 1===arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){b=null;var e=new Appacitive.Promise;
try{FB.logout(function(){c.Appacitive.Users.logout();e.fulfill()})}catch(f){e.reject(f.message)}return e}}:new e})(global);
(function(c){c.Appacitive.Email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var b=function(b,e){var l=new c.Appacitive._Request({method:"POST",type:"email",op:"getSendEmailUrl",options:e,data:b,entity:b,onSuccess:function(b){l.promise.fulfill(b.email)}});return l.send()};this.setupEmail=function(b){b=b||{};e.smtp.username=b.username||e.smtp.username;e.from=b.from||e.from;e.smtp.password=
b.password||e.smtp.password;e.smtp.host=b.smtp.host||e.smtp.host;e.smtp.port=b.smtp.port||e.smtp.port;e.smtp.enablessl=b.enableSSL||e.smtp.enablessl;e.replyto=b.replyTo||e.replyto};this.sendTemplatedEmail=function(c,h){if(!c||!c.to||!c.to.length||0===c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0===c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");
if(!c.templateName)throw Error("template name is mandatory to send an email");var l={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,from:c.from,body:{templatename:c.templateName||"",data:c.data||{},ishtml:!1===c.isHtml?!1:!0}};if(c.useConfig){l.smtp=e.smtp;if(!c.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");l.from=c.from||e.from;l.replyto=c.replyTo||e.replyto}return b(l,h)};this.sendRawEmail=function(c,h){if(!c||!c.to||!c.to.length||
0===c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0===c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!c.body)throw Error("body is mandatory to send an email");var l={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,from:c.from,body:{content:c.body||"",ishtml:!1===c.isHtml?!1:!0}};if(c.useConfig){l.smtp=
e.smtp;if(!c.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");l.from=c.from||e.from;l.replyto=c.replyTo||e.replyto}return b(l,h)}}})(global);
(function(c){c.Appacitive.Push=new function(){this.send=function(e,b){if(!e)throw Error("Please specify push options");var f=new c.Appacitive._Request({method:"POST",type:"push",op:"getPushUrl",options:b,data:e,entity:e,onSuccess:function(b){f.promise.fulfill(b.id)}});return f.send()};this.getNotification=function(e,b){if(!e)throw Error("Please specify notification id");var f=new c.Appacitive._Request({method:"GET",type:"push",op:"getGetNotificationUrl",args:[e],options:b,onSuccess:function(b){f.promise.fulfill(b.pushnotification)}});
return f.send()};this.getAllNotifications=function(e,b){e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var f=new c.Appacitive._Request({method:"GET",type:"push",op:"getGetAllNotificationsUrl",args:[e],options:b,onSuccess:function(b){f.promise.fulfill(b.pushnotifications,b.paginginfo)}});return f.send()}}})(global);
(function(c){c.Appacitive.File=function(e){e=e||{};this.fileId=e.fileId;this.contentType=e.contentType;this.fileData=e.fileData;var b=this,f=function(e,f,g,h,l){var r=new c.Appacitive.HttpRequest;r.url=e;r.method="GET";r.description=h;r.onSuccess=f;r.promise=g;r.entity=b;r.options=l;c.Appacitive.http.send(r)},h=function(e,f,g,h,l){(new FormData).append("fileToUpload",f);var r=new c.Appacitive.HttpRequest;r.url=e;r.method="PUT";r.log=!1;r.description="Upload file";r.data=f;r.headers.push({key:"content-type",
value:g});r.send().then(h,function(){l.reject(d,b)})};this.save=function(b){return this.fileId&&_type.isString(this.fileId)&&0<this.fileId.length?g(b):l(b)};var l=function(e){if(!b.fileData)throw Error("Please specify filedata");if(!b.contentType)try{b.contentType=b.fileData.type}catch(g){}b.contentType&&_type.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var l=c.Appacitive.Promise.buildPromise(e),k=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getUploadUrl(b.contentType,
b.fileId?b.fileId:"");f(k,function(c){h(c.url,b.fileData,b.contentType,function(){b.fileId=c.id;b.getDownloadUrl(e).then(function(c){return l.fulfill(c,b)},function(b){return l.reject(b)})},l)},l," Get upload url for file ",e);return l},g=function(e){if(!b.fileData)throw Error("Please specify filedata");if(!b.contentType)try{b.contentType=b.fileData.type}catch(g){}b.contentType&&_type.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var l=c.Appacitive.Promise.buildPromise(e),
k=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getUpdateUrl(b.fileId,b.contentType);f(k,function(c){h(c.url,b.fileData,b.contentType,function(){b.getDownloadUrl(e).then(function(c){l.fulfill(c,b)},function(b){l.reject(b)})},l)},l," Get update url for file "+b.fileId,e);return l};this.deleteFile=function(e){if(!this.fileId)throw Error("Please specify fileId to delete");var f=c.Appacitive.Promise.buildPromise(e),g=new c.Appacitive.HttpRequest;g.url=c.Appacitive.config.apiBaseUrl+
c.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);g.method="DELETE";g.description="Delete file with id "+this.fileId;g.onSuccess=function(b){f.fulfill()};g.promise=f;g.entity=b;g.options=e;return c.Appacitive.http.send(g)};this.getDownloadUrl=function(e,g){if(!this.fileId)throw Error("Please specify fileId to download");"number"!==typeof e&&(g=e,e=-1);var h=c.Appacitive.Promise.buildPromise(g),k=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,
e);f(k,function(c){b.url=c.uri;h.fulfill(c.uri)},h," Get download url for file "+this.fileId,g);return h};this.getUploadUrl=function(e){b.contentType&&_type.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var g=c.Appacitive.Promise.buildPromise(e),h=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");f(h,function(c){b.url=c.url;g.fulfill(c.url,b)},g," Get upload url for file "+this.fileId,e);
return g}}})(global);
(function(c){c.Appacitive.Date={};var e=function(b){return 10>b?"0"+b:b};c.Appacitive.Date.parseISODate=function(b){try{if(!/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(b))return new Date(b);var c=b.split("T"),e=c[0].split("-"),l=c[1].split("Z")[0].split(":"),g=l[2].split("."),m=Number(l[0]),n=new Date;n.setUTCFullYear(Number(e[0]));n.setUTCMonth(Number(e[1])-1);n.setUTCDate(Number(e[2]));n.setUTCHours(Number(m));n.setUTCMinutes(Number(l[1]));n.setUTCSeconds(Number(g[0]));
g[1]&&n.setUTCMilliseconds(Number(g[1].substring(0,3)));return n}catch(p){return null}};c.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(c){return null}};c.Appacitive.Date.toISODate=function(b){if(b instanceof Date)return String.format("{0}-{1}-{2}",b.getFullYear(),e(b.getMonth()+1),e(b.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};c.Appacitive.Date.toISOTime=function(b){var c=function(b){return 10>b?b+"000000":
100>b?b+"00000":1E3>b?b+"0000":1E4>b?b+"000":1E5>b?b+"00":1E6>b?b+"0":b};if(b instanceof Date)return String.format("{0}:{1}:{2}.{3}",e(b.getHours()),e(b.getMinutes()),e(b.getSeconds()),c(b.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};c.Appacitive.Date.parseISOTime=function(b){try{var c=new Date,e=b.split("T");1===e.length&&e.push(e[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(e[1]))return null;var l=e[1].split("Z")[0].split(":"),
g=l[2].split("."),m=Number(l[0]);1<e.length?(c.setUTCHours(Number(m)),c.setUTCMinutes(Number(l[1])),c.setUTCSeconds(Number(g[0])),g[1]&&c.setUTCMilliseconds(Number(g[1].substring(0,3)))):(c.setHours(Number(m)),c.setMinutes(Number(l[1])),c.setSeconds(Number(g[0])),g[1]&&c.setMilliseconds(Number(g[1].substring(0,3))));return c}catch(n){return null}}})(global);
(function(c){c.Appacitive.localStorage=new (c.Appacitive.runtime.isBrowser?function(){var e=c.Appacitive.runtime.isBrowser?window.localStorage:{getItem:function(){return null}};this.set=function(b,f){f=f||"";if(!b)return!1;if(_type.isObject(f)||_type.isArray(f))try{f=JSON.stringify(f)}catch(h){}b=c.Appacitive.getAppPrefix(b);e[b]=f;return this};this.get=function(b){if(!b)return null;b=c.Appacitive.getAppPrefix(b);b=e.getItem(b);if(!b)return null;if("{"===b[0])try{b=JSON.parse(b)}catch(f){}return b};
this.remove=function(b){if(b){b=c.Appacitive.getAppPrefix(b);try{delete e[b]}catch(f){}}}}:function(){var e=[];this.set=function(b,f){f=f||"";if(!b||_type.isString(b))return!1;b=c.Appacitive.getAppPrefix(b);e[b]=f;return this};this.get=function(b){if(!b||_type.isString(b))return null;b=c.Appacitive.getAppPrefix(b);return(b=e[b])?b:null};this.remove=function(b){if(b&&!_type.isString(b)){b=c.Appacitive.getAppPrefix(b);try{delete e[b]}catch(f){}}}})})(global);
(function(c){c.Appacitive.Cookie=new (c.Appacitive.runtime.isBrowser?function(){this.setCookie=function(e,b,f,h){e=c.Appacitive.getAppPrefix(e);var l="";f&&(l=new Date,l.setTime(l.getTime()+6E4*f),l.toGMTString());l=h?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":c.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";f="domain="+window.location.hostname;"localhost"==window.location.hostname&&(f="");document.cookie=e+"="+b+l+"; path=/;"+f};this.readCookie=function(e){e=
c.Appacitive.getAppPrefix(e);e+="=";for(var b=document.cookie.split(";"),f=0;f<b.length;f++){for(var h=b[f];" "==h.charAt(0);)h=h.substring(1,h.length);if(0===h.indexOf(e))return h.substring(e.length,h.length)}return null};this.eraseCookie=function(c){this.setCookie(c,"",-1,!0)}}:function(){this.setCookie=function(e,b){c.Appacitive.localStorage.set("cookie/"+e,b)};this.readCookie=function(e){return c.Appacitive.localStorage.get("cookie/"+e)};this.eraseCookie=function(e){c.Appacitive.localStorage.remove("cookie/"+
e)}})})(global);"undefined"===typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
