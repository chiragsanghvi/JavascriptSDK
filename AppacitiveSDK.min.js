"bind"in Function.prototype||(Function.prototype.bind=function(a){var f=this;if(1>=arguments.length)return function(){return f.apply(a,arguments)};var g=Array.prototype.slice.call(arguments,1);return function(){return f.apply(a,0===arguments.length?g:g.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
"indexOf"in Array.prototype||(Array.prototype.indexOf=function(a,f){void 0===f&&(f=0);0>f&&(f+=this.length);0>f&&(f=0);for(var g=this.length;f<g;f++)if(f in this&&this[f]===a)return f;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(a,f){void 0===f&&(f=this.length-1);0>f&&(f+=this.length);f>this.length-1&&(f=this.length-1);for(f++;0<f--;)if(f in this&&this[f]===a)return f;return-1});
"forEach"in Array.prototype||(Array.prototype.forEach=function(a,f){for(var g=0,c=this.length;g<c;g++)g in this&&a.call(f,this[g],g,this)});"map"in Array.prototype||(Array.prototype.map=function(a,f){for(var g=Array(this.length),c=0,d=this.length;c<d;c++)c in this&&(g[c]=a.call(f,this[c],c,this));return g});"filter"in Array.prototype||(Array.prototype.filter=function(a,f){for(var g=[],c,d=0,e=this.length;d<e;d++)d in this&&a.call(f,c=this[d],d,this)&&g.push(c);return g});
"every"in Array.prototype||(Array.prototype.every=function(a,f){for(var g=0,c=this.length;g<c;g++)if(g in this&&!a.call(f,this[g],g,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=function(a,f){for(var g=0,c=this.length;g<c;g++)if(g in this&&a.call(f,this[g],g,this))return!0;return!1});
Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(a){function f(a){return 10>a?"0"+a:a}return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON);String.addSlashes=function(a){if(!a)return a;a=a.replace(/\\/g,"\\\\");a=a.replace(/\'/g,"\\'");a=a.replace(/\"/g,'\\"');return a=a.replace(/\0/g,"\\0")};
String.stripSlashes=function(a){if(!a)return a;a=a.replace(/\\'/g,"'");a=a.replace(/\\"/g,'"');a=a.replace(/\\0/g,"\x00");return a=a.replace(/\\\\/g,"\\")};var global={};
(function(){global="undefined"===typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var a=function(b){if(b&&b.send&&"function"==typeof b.send)b.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var c=[],a={},e=0,d={},g=0;this.addProcessor=function(b){b&&(b.pre=b.pre||function(){},b.post=b.post||function(){},f(b.pre),q(b.post))};var f=function(b){e+=1;a[e]=b;return e},
q=function(b){g+=1;d[g]=b;return g};this.enqueueRequest=function(b){c.push(b)};this.changeRequestForCors=function(b){var c={m:b.method.toUpperCase()};b.headers.forEach(function(b){c[b.key]=b.value});b.headers=[];b.headers.push({key:"Content-Type",value:"text/plain"});b.method="POST";b.data&&(c.b=b.data);delete b.data;global.Appacitive.config.debug&&(-1===b.url.indexOf("?")?b.url+="?debug=true":b.url+="&debug=true");try{b.data=JSON.stringify(c)}catch(a){}return b};this.notify=function(){if(0!==c.length){var e=
[],g;for(g in d)d.hasOwnProperty(g)&&e.push(d[g]);for(;0<c.length;){var k=c.shift(),f=[];for(g in a)a.hasOwnProperty(g)&&f.push(a[g](k));this.changeRequestForCors(k);b.send(k,e,f)}}};this.onResponse=function(b){console.dir(b)}},f=function(){var b=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=b;this.onResponse=function(c,a){b()};this.onError=function(c){b()}},g=null,g=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest,
c=function(b){var c=new XDomainRequest;c.onload=function(){var a=c.responseText;try{var e=c.contentType;if("application/json"==e.toLowerCase()||"application/javascript"==e.toLowerCase()||"application/json; charset=utf-8"==e.toLowerCase()||"application/json; charset=utf-8;"==e.toLowerCase())e=a,global.Appacitive.runtime.isBrowser||"{"!=e[0]&&(e=e.substr(1,e.length-1)),a=JSON.parse(e)}catch(d){}b.onSuccess(a,this)};c.onerror=c.ontimeout=function(){b.onError({code:"400",message:"Server Error"},c)};c.onprogress=
function(){};-1===b.url.indexOf("?")?b.url+="?ua=ie":b.url+="&ua=ie";c.open(b.method,b.url,!0);c.send(b.data);return c},d=function(b){if(!b.url)throw Error("Please specify request url");b.method||(b.method="GET");b.headers||(b.headers=[]);var a={},e=!0;b.headers.forEach(function(b){"content-type"==b.key.toLowerCase()&&(e=!0,"application/json"==b.value.toLowerCase()||"application/javascript"==b.value.toLowerCase()||"application/json; charset=utf-8"==b.value.toLowerCase()||"application/json; charset=utf-8;"==
b.value.toLowerCase())&&(e=!1)});if(e)a=b.data;else if(b.data&&(a=b.data,"object"==typeof b.data))try{a=JSON.stringify(a)}catch(d){}b.onSuccess&&"function"==typeof b.onSuccess||(b.onSuccess=function(){});b.onError&&"function"==typeof b.onError||(b.onError=function(){});if(!global.navigator||-1==global.navigator.userAgent.indexOf("MSIE 8")&&-1==global.navigator.userAgent.indexOf("MSIE 9")){var l=new g;l.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==
this.status){var c=this.responseText;try{var a=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==a.toLowerCase()||"application/javascript"==a.toLowerCase()||"application/json; charset=utf-8"==a.toLowerCase()||"application/json; charset=utf-8;"==a.toLowerCase())a=c,global.Appacitive.runtime.isBrowser||"{"!=a[0]&&(a=a.substr(1,a.length-1)),c=JSON.parse(a)}catch(e){}b.onSuccess(c,this)}else b.onError({code:this.status,message:this.statusText},this)};
l.open(b.method,b.url,!0);for(var f=0;f<b.headers.length;f+=1)l.setRequestHeader(b.headers[f].key,b.headers[f].value);global.Appacitive.runtime.isBrowser||l.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");l.send(a);return l}b.data=a;return new c(b)},e=function(){var b=new f;b.isOnline=function(){return!0};var c=function(c,a,e){new d({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(d,g){if(d){try{d=JSON.parse(d)}catch(f){}var m=d;if(a.length!=e.length)throw Error("Callback length and state length mismatch!");
for(var r=0;r<a.length;r+=1)a[r].apply({},[m,e[r]]);b.onResponse(d,c)}else b.onError(c,{code:"400",messgae:"Invalid request"})},onError:function(a){b.onError(c,a)}})};b.send=function(b,a,e){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof b.beforeSend&&b.beforeSend(b);c(b,a,e)};b.upload=function(b,a,e){"function"===typeof b.beforeSend&&b.beforeSend(b);c(b,a,e,!0)};return b};global.Appacitive.http=new function(){var b=new e,c=new a(b),d=!1;this.pause=
function(){d=!0};this.unpause=function(){d=!1};this.addProcessor=function(b){var a=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!b)throw a;if(!b.pre&&!b.post)throw a;c.addProcessor(b)};this.send=function(a){c.enqueueRequest(a);b.isOnline()&&!1===d&&c.notify()};this.flush=function(a){a?c.notify():b.isOnline()&&c.notify()};this.onError=function(b,c){if(b.onError)if(b.context)b.onError.apply(b.context,[c]);else b.onError(c)};b.onError=this.onError;this.onResponse=
function(b,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,[b]);else c.onSuccess(b)};b.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(b){b=b||{};this.url=b.url||"";this.data=b.data||{};this.headers=b.headers||[];this.method=b.method||"GET";this.onSuccess=b.onSuccess||function(){};this.onError=b.onError||function(){};this.send=function(b){return new d(this,b)}};(function(b){b.Appacitive&&b.Appacitive.http&&(b.Appacitive.http.addProcessor({pre:function(b){return b},post:function(c,
a){try{var e=b.Appacitive.Session.isSessionValid(c);e.status?c&&(c.status&&c.status.code&&"19036"==c.status.code||c.code&&"19036"==c.code)?b.Appacitive.Users.logout(function(){},!0):b.Appacitive.Session.incrementExpiry():e.isSession&&(null!==b.Appacitive.Session.get()&&b.Appacitive.Session.resetSession(),b.Appacitive.http.send(a))}catch(d){}}}),b.Appacitive.http.addProcessor({pre:function(b){return(new Date).getTime()},post:function(b,c){var a=(new Date).getTime()-c;b._timeTakenInMilliseconds=a}}))})(global)})();
(function(a){String.format=function(a,g){if(1>=arguments.length)return a;for(var c=arguments.length-2,d=0;d<=c;d++)a=a.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+1]);return a};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(a){var g=RegExp("^"+a),c=this;g.test(c)&&(c=c.slice(1,c.length));g=RegExp(a+"$");g.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(a){"undefined"===typeof a&&(a="");for(var g=
"",c=0;c<a.length;c+=1)-1===" .,;#".indexOf(a[c])&&(g+=a[c]);return g=g.toLowerCase()};String.contains=function(a,g){return-1!==a.indexOf(g)};String.startsWith=function(a,g){return 0===a.indexOf(g)};Array.distinct=function(a){var g=[],c=a.length,d,e,b;for(e=0;e<c;e++){d=void 0;for(b=0;b<g.length;b++)if(a[e].toLowerCase()===g[b].toLowerCase()){d=!0;break}d||g.push(a[e])}return g};Object.isEmpty=function(a){if(!a)return!0;var g=!0,c;for(c in a){g=!1;break}return g};a.dateFromWcf=function(a,g){var c=
/Date\(([^)]+)\)/.exec(a);if(2!=c.length){if(!g)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};a.Appacitive.storage=a.Appacitive.storage||{};a.Appacitive.storage.urlFactory=new function(){a.Appacitive.bag=a.Appacitive.bag||{};var f=function(a){"object"===typeof a&&(0<a.length&&("string"===typeof a[0]||"number"===typeof a[0]))&&(a=a.join(","));a||(a="");return a};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};
this.user={userServiceUrl:"user",getCreateUrl:function(a){return String.format("{0}/create?fields={1}",this.userServiceUrl,f(a))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(a,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,a,f(c))},getUserByTokenUrl:function(a){return String.format("{0}/me?useridtype=token&token={1}",this.userServiceUrl,a)},getUserByUsernameUrl:function(a){return String.format("{0}/{1}?useridtype=username",
this.userServiceUrl,a)},getUpdateUrl:function(a,c,d){return d?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,a,f(c),d):String.format("{0}/{1}?fields={2}",this.userServiceUrl,a,f(c))},getDeleteUrl:function(a){return String.format("{0}/{1}",this.userServiceUrl,a)},getGetAllLinkedAccountsUrl:function(a){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,a)},getValidateTokenUrl:function(a){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,a)},getInvalidateTokenUrl:function(a){return String.format("{0}/invalidate?userToken={1}",
this.userServiceUrl,a)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(a){return String.format("{0}/{1}/changepassword",this.userServiceUrl,a)},getLinkAccountUrl:function(a){return String.format("{0}/{1}/link",this.userServiceUrl,a)},getDelinkAccountUrl:function(a,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,a,c)},getCheckinUrl:function(a,c,d){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",
this.userServiceUrl,a,c,d)},getResetPasswordUrl:function(a){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,a)},getValidateResetPasswordUrl:function(a){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,a)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(a){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,f(a))},getGetUrl:function(a,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,a,f(c))},
getUpdateUrl:function(a,c,d){return d?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,a,f(c),d):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,a,f(c))},getDeleteUrl:function(a){return String.format("{0}/{1}",this.deviceServiceUrl,a)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(a,c,d){var e="",e=String.format("{0}/search/{1}/all",this.articleServiceUrl,a),e=d?e+"?psize="+d:e+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(a=0;a<c.length;a+=
1)0!==c[a].trim().length&&(e=e+"&"+c[a]);return e},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(a,c){return String.format("{0}/search/{1}/all?properties={2}",this.articleServiceUrl,a,c)},getMultiGetUrl:function(a,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.articleServiceUrl,a,c,f(d))},getCreateUrl:function(a,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,a,f(c))},getGetUrl:function(a,
c,d){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,a,c,f(d))},getUpdateUrl:function(a,c,d,e){return e?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.articleServiceUrl,a,c,f(d),e):String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,a,c,f(d))},getDeleteUrl:function(a,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,a,c)},getMultiDeleteUrl:function(a){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,a)}};this.connection={connectionServiceUrl:"connection",
getGetUrl:function(a,c,d){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,a,c,f(d))},getMultiGetUrl:function(a,c,d){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,a,c,f(d))},getCreateUrl:function(a,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,a,f(c))},getUpdateUrl:function(a,c,d,e){return e?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,a,c,f(d),e):String.format("{0}/{1}/{2}?fields={3}",
this.connectionServiceUrl,a,c,f(d))},getDeleteUrl:function(a,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,a,c)},getMultiDeleteUrl:function(a){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,a)},getSearchByArticleUrl:function(a,c,d,e){var b="",b=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,a,d,c);if("undefined"!==typeof e&&0<e.length)for(a=0;a<e.length;a+=1)b=b+"&"+e[a];return b},getConnectedArticles:function(a,c,d){var e=
"",e=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,a,c);if(d&&d.length&&0<d.length)for(a=0;a<d.length;a+=1)e=0===a?e+("?"+d[a]):e+("&"+d[a]);return e},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(a,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,a,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(a){return String.format("{0}/list/{1}/contents",
this.cannedListServiceUrl,a)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(a){return String.format("{0}/notification/{1}",this.pushServiceUrl,a)},getGetAllNotificationsUrl:function(a){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,a.psize,a.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(a,c){return c&&0<c.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",
this.fileServiceUrl,escape(a),escape(c)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(a))},getUpdateUrl:function(a,c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,a,escape(c))},getDownloadUrl:function(a,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,a,c)},getDeleteUrl:function(a){return String.format("{0}/delete/{1}",this.fileServiceUrl,a)}};this.query={params:function(a){var c=[];return""===
location.search||-1===location.search.indexOf("?")?c:a?(a=a.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(d,e){var b=e.split("="),m=b[1];2<b.length&&b.forEach(function(a,c){0!==a&&1!==a&&(m=m+"="+b[a])});b[0].toLowerCase()===a&&(c=[b[0],m])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(a){a.Appacitive.eventManager=new function(){function a(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var g={};this.subscribe=function(c,d){if("string"!=typeof c||"function"!=typeof d)throw Error("Incorrect subscription call");"undefined"==typeof g[c]&&(g[c]=[]);var e=a();g[c].push({callback:d,id:e});return e};this.unsubscribe=function(a){if(!a)return!1;var d=-1,e=null,b;for(b in g)for(var m=0;m<g[b].length;m+=
1)if(g[b][m].id==a){d=m;e=b;break}return-1!=d?(g[e].splice(d,1),!0):!1};this.fire=function(a,d,e){if("string"!=typeof a)throw Error("Incorrect fire call");if("undefined"==typeof e||null===e)e={};e.eventName=a;if("undefined"!=typeof g.all)for(var b=0;b<g.all.length;b+=1)g.all[b].callback(d,e);b=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof g[a])for(var m=0;m<g[a].length;m+=1)b(g[a][m].callback,d,e)};this.clearSubscriptions=function(a){if("string"!=typeof a)throw Error("Event Name must be string in EventManager.clearSubscriptions");
g[a]&&(g[a].length=0);return this};this.clearAndSubscribe=function(a,d){this.clearSubscriptions(a);this.subscribe(a,d)};this.dump=function(){console.dir(g)}}})(global);(function(a){a.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(a.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(a){a.Appacitive.Session=new function(){this.initialized=!1;var f=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},g=null,c=null,d=null,e=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){a.Appacitive.Session.create(null)};this.create=function(b,e){if(!this.initialized)throw Error("Intialize Appacitvie SDK");var d=new f;d.apikey=c;var l=new a.Appacitive.HttpRequest;l.url=a.Appacitive.config.apiBaseUrl+"application.svc/session";
l.method="put";l.data=d;l.onSuccess=function(c){c&&c.status&&"200"==c.status.code?(g=c.session.sessionkey,a.Appacitive.Session.useApiKey=!1,b&&"function"==typeof b&&b(c),a.Appacitive.Session.onSessionCreated()):e&&"function"==typeof e&&e(c)};l.onError=e;a.Appacitive.http.send(l)};a.Appacitive.http.addProcessor({pre:function(b){a.Appacitive.Session.useApiKey?b.headers.push({key:"ak",value:c}):b.headers.push({key:"as",value:g});!0===e&&(1==b.headers.filter(function(a){return"ut"==a.key}).length?b.headers.forEach(function(a){"ut"==
a.key&&(a.value=d)}):b.headers.push({key:"ut",value:d}))}});this.setUserAuthHeader=function(b,c,k){try{b&&(e=!0,d=b,k||(c||(c=60),-1==c&&(c=null),a.Appacitive.Cookie.setCookie("Appacitive-UserToken",b,c),a.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",c?c:-1,c)))}catch(l){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(b,c){b&&("function"!=typeof b&&"boolean"==typeof b)&&(c=b,b=function(){});e=!1;b=b||function(){};a.Appacitive.localStorage.remove("Appacitive-User");
a.Appacitive.Cookie.eraseCookie("Appacitive-UserToken");a.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry");if(d&&!c)try{var k=new a.Appacitive.HttpRequest;k.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(d);d=null;k.method="POST";k.data={};k.onSuccess=function(){"function"==typeof b&&b()};a.Appacitive.http.send(k)}catch(l){}else d=null,"function"==typeof b&&b()};this.isSessionValid=function(a){if(!a)return!0;if(a.status){if(a.status.code&&
("19027"==a.status.code||"19002"==a.status.code))return{status:!1,isSession:"19027"==a.status.code?!0:!1}}else if(a.code&&("19027"==a.code||"19002"==a.code))return{status:!1,isSession:"19027"==a.code?!0:!1};return{status:!0}};this.resetSession=function(){g=null;this.useApiKey=!0};this.get=function(){return g};this.setSession=function(a){a&&(g=a,this.useApiKey=!1)};this.setApiKey=function(a){a&&(c=a,this.useApiKey=!0)};var b="sandbox";this.environment=function(){if(1==arguments.length){var a=arguments[0];
"sandbox"!=a&&"live"!=a&&(a="sandbox");b=a}return b}};a.Appacitive.getAppPrefix=function(f){return a.Appacitive.Session.environment()+"/"+a.Appacitive.appId+"/"+f};a.Appacitive.initialize=function(f){f=f||{};if(!a.Appacitive.Session.initialized){if(!f.apikey||0===f.apikey.length)throw Error("apikey is mandatory");if(!f.appId||0===f.appId.length)throw Error("appId is mandatory");a.Appacitive.Session.setApiKey(f.apikey);a.Appacitive.Session.environment(f.env||"sandbox");a.Appacitive.useApiKey=!0;a.Appacitive.appId=
f.appId;a.Appacitive.Session.initialized=!0;a.Appacitive.Session.persistUserToken=f.persistUserToken;f.debug&&(a.Appacitive.config.debug=!0);if(f.userToken)-1==f.expiry?f.expiry=null:f.expiry||(f.expiry=3600),a.Appacitive.Session.setUserAuthHeader(f.userToken,f.expiry),f.user?a.Appacitive.Users.setCurrentUser(f.user):(f=a.Appacitive.localStorage.get("Appacitive-User"))&&a.Appacitive.Users.setCurrentUser(f);else if(a.Appacitive.runtime.isBrowser){var g=a.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(g){var c=a.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");c||(c=60);(f=a.Appacitive.localStorage.get("Appacitive-User"))&&a.Appacitive.Users.setCurrentUser(f,g,c)}}}}})(global);(function(a){a.Appacitive&&a.Appacitive.http&&a.Appacitive.http.addProcessor({pre:function(f){f.headers.push({key:"e",value:a.Appacitive.Session.environment()})}})})(global);
(function(a){var f=a.Appacitive;f.GeoCoord=function(a,b){_validateGeoCoord=function(a,b){if(isNaN(a)||isNaN(b))throw Error("Invalid Latitiude or longitiude provided");if(-90>a||90<a)throw Error("Latitude "+a+" should be in range of  -90.0 to 90.");if(-180>b||180<b)throw Error("Latitude "+b+" should be in range of  -180.0 to 180.");};a&&b?(_validateGeoCoord(a,b),this.lat=a,this.lng=b):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
a,b)};this.toString=function(){return this.getValue()}};var g=function(){this.toString=function(){}},c=function(a){g.call(this);a=a||{};this.fieldType=a.fieldType;this.field=a.field||"";this.value=a.value;this.operator=a.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue())}};c.prototype=new g;c.prototype.constructor=c;var d=function(a){a=a||"";if("object"!==typeof a.value||!a.value.length)throw Error("Specify field value as array");c.call(this,a);this.toString=function(){for(var a=[],b=0;b<this.value.length;b+=1)a.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,"string"===typeof this.value[b]?"'"+this.value[b]+"'":"number"===typeof this.value[b]?this.value[b]:this.value[b].toString()));return"("+
a.join(" or ")+")"}};d.prototype=new c;d.prototype.constructor=d;var e=function(a){a=a||"";if(!a.val1)throw Error("Specify field value1 ");if(!a.val2)throw Error("Specify field value2 ");this.val1=a.val1;this.val2=a.val2;c.call(this,a);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};e.prototype=new c;e.prototype.constructor=e;var b=function(a){a=a||"";if(!(a.geoCoord&&
a.geoCoord instanceof f.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");c.call(this,a);this.value=a.geoCoord;this.unit=a.unit||"mi";this.distance=a.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};b.prototype=new c;b.prototype.constructor=e;var m=function(a){a=a||"";if(!a.geoCoords||0===a.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");
if(3>a.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");c.call(this,a);this.value=a.geoCoords;var b=function(a){var b="";a.forEach(function(a){b=0===b.length?a.toString():b+(" | "+a.toString())});return b};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b(this.value))}};m.prototype=new c;m.prototype.constructor=e;var h=function(a){g.call(this);a=a||{};if(!a.tags||"object"!=
typeof a.tags||0===a.tags.length)throw Error("Specify valid tags");this.tags=a.tags;this.operator=a.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};h.prototype=new g;h.prototype.constructor=h;var k=function(a,b){if(!b||!b.length||2>b.length)throw Error("Provide valid or atleast 2 filters");this.operator=a;this.innerFilters=[];for(var c=0;c<b.length;c+=1){if(!(b[c]instanceof g))throw Error("Invalid filter provided");this.innerFilters.push(b[c])}this.toString=
function(){var a=this.operator,b="(";this.innerFilters.forEach(function(c){b=1===b.length?b+(" "+c.toString()):b+String.format(" {0} {1} ",a,c.toString())});return b+=")"}};k.prototype=new g;k.prototype.constructor=k;var l=function(a,b){if(null===a||void 0===a||0===a.length)throw Error("Specify value");this.value=a;this.type=b?b:typeof this.value;this.getValue=function(){return"string"===this.type?"'"+String.addSlashes(this.value)+"'":"number"===this.type||"boolean"===typeof this.value?this.value:
"object"===this.type&&this.value instanceof date?"datetime('"+f.Date.toISOString(this.value)+"')":this.value.toString()}},n=function(a){this.value=a;this.getValue=function(){return"object"===typeof this.value&&this.value instanceof Date?"date('"+f.Date.toISODate(this.value)+"')":"date('"+this.value+"')"}},p=function(a){this.value=a;this.getValue=function(){return"object"===typeof this.value&&this.value instanceof Date?"time('"+f.Date.toISOTime(this.value)+"')":"time('"+this.value+"')"}},q=function(a){this.value=
a;this.getValue=function(){return"object"===typeof this.value&&this.value instanceof Date?"datetime('"+f.Date.toISOString(this.value)+"')":"datetime('"+this.value+"')"}},t=function(a,k,h){h||(h=this);h.type=a;h.name=k;h.equalTo=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"=="})};h.equalToNumber=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a,"number"),operator:"=="})};h.equalToDate=function(a){return new c({field:this.name,fieldType:this.type,
value:new n(a),operator:"=="})};h.equalToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new p(a),operator:"=="})};h.equalToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new q(a),operator:"=="})};h.greaterThan=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">"})};h.greaterThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:">"})};h.greaterThanTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new p(a),operator:">"})};h.greaterThanDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new q(a),operator:">"})};h.greaterThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:">="})};h.greaterThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:">="})};h.greaterThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new p(a),
operator:">="})};h.greaterThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new q(a),operator:">="})};h.lessThan=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<"})};h.lessThanDate=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<"})};h.lessThanTime=function(a){return new c({field:this.name,fieldType:this.type,value:new p(a),operator:"<"})};h.lessThanDateTime=function(a){return new c({field:this.name,
fieldType:this.type,value:new q(a),operator:"<"})};h.lessThanEqualTo=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a),operator:"<="})};h.lessThanEqualToDate=function(a){return new c({field:this.name,fieldType:this.type,value:new n(a),operator:"<="})};h.lessThanEqualToTime=function(a){return new c({field:this.name,fieldType:this.type,value:new p(a),operator:"<="})};h.lessThanEqualToDateTime=function(a){return new c({field:this.name,fieldType:this.type,value:new q(a),operator:"<="})};
h.like=function(a){return new c({field:this.name,fieldType:this.type,value:new l("*"+a+"*"),operator:"like"})};h.startsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new l(a+"*"),operator:"like"})};h.endsWith=function(a){return new c({field:this.name,fieldType:this.type,value:new l("*"+a),operator:"like"})};h.contains=function(a){return new d({field:this.name,fieldType:this.type,value:a,operator:"=="})};h.between=function(a,b){return new e({field:this.name,fieldType:this.type,
val1:new l(a),val2:new l(b),operator:"between"})};h.betweenDate=function(a,b){return new e({field:this.name,fieldType:this.type,val1:new n(a),val2:new n(b),operator:"between"})};h.betweenTime=function(a,b){return new e({field:this.name,fieldType:this.type,val1:new p(a),val2:new p(b),operator:"between"})};h.betweenDateTime=function(a,b){return new e({field:this.name,fieldType:this.type,val1:new q(a),val2:new q(b),operator:"between"})};h.withinCircle=function(a,c,e){return new b({field:this.name,fieldType:this.type,
geoCoord:a,distance:c,unit:e,operator:"within_circle"})};h.withinPolygon=function(a){return new m({field:this.name,fieldType:this.type,geoCoords:a,operator:"within_polygon"})}},r=function(a){if(!a||0===a.length)throw Error("Specify field name");this.field=a;t("property",a,this);return this},v=function(a){if(!a||0===a.length)throw Error("Specify field name");this.field=a;var b=new t("aggregate",a);this.equalTo=function(a){return b.equalTo(a)};this.greaterThan=function(a){return b.greaterThan(a)};this.greaterThanEqualTo=
function(a){return b.greaterThanEqualTo(a)};this.lessThan=function(a){return b.lessThan(a)};this.lessThanEqualTo=function(a){return b.lessThanEqualTo(a)};this.between=function(a,c){return b.between(a,c)};return this},u=function(a){if(!a||0===a.length)throw Error("Specify field name");this.field=a;var b=new t("attribute",a);this.like=function(a){return b.like(a)};this.startWith=function(a){return b.startsWith(a)};this.endsWith=function(a){return b.endsWith(a)};this.equalTo=function(a){return b.equalTo(a)};
this.contains=function(a){return b.contains(a)};return this};f.Filter={Property:function(a){return new r(a)},Aggregate:function(a){return new v(a)},Attribute:function(a){return new u(a)},Or:function(){return new k("or",arguments)},And:function(){return new k("and",arguments)},taggedWithOneOrMore:function(a){return new h({tags:a,operator:"tagged_with_one_or_more"})},taggedWithAll:function(a){return new h({tags:a,operator:"tagged_with_all"})}}})(global);
(function(a){a.Appacitive.Queries={};var f=function(a){a=a||{};var c=1,b=20;this.pageNumber=function(){return 1==arguments.length?(c=arguments[0]||1,this):c};this.pageSize=function(){return 1==arguments.length?(b=arguments[0]||20,this):b};this.pageNumber(a.pageNumber);this.pageSize(a.pageSize)};f.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var g=function(a){a=a||{};var c="__UtcLastUpdatedDate",b=!1;this.orderBy=function(){return 1===arguments.length?(c=
arguments[0]||"__UtcLastUpdatedDate",this):c};this.isAscending=function(){return 1===arguments.length?(b="undefined"===typeof arguments[0]?!1:arguments[0],this):b};this.orderBy(a.orderBy);this.isAscending(a.isAscending)};g.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var c=function(c){var e=c||{},b="",m="",h="",k=e.queryType||"BasicQuery",l=new f(c),n=new g(c),p=e.schema||e.relation,q=e.relation?"connection":"article",t=this;this.type=function(){return q};
this.entityType=function(){return p};this.queryType=function(){return k};this.pageQuery=function(){return l};this.pageNumber=function(){return 1===arguments.length?(l.pageNumber(arguments[0]),this):l.pageNumber()};this.pageSize=function(){return 1===arguments.length?(l.pageSize(arguments[0]),this):l.pageSize()};this.sortQuery=function(){return n};this.orderBy=function(){return 1===arguments.length?(n.orderBy(arguments[0]),this):n.orderBy()};this.isAscending=function(){return 1===arguments.length?
(n.isAscending(arguments[0]),this):n.isAscending()};this.filter=function(){return 1===arguments.length?(b=arguments[0],this):b};this.freeText=function(){if(1===arguments.length){var a=arguments[0];"string"===typeof a?m=arguments[0]:"object"===typeof a&&a.length&&(m=arguments[0].join(" "));return this}return m};this.fields=function(){if(1===arguments.length){var a=arguments[0];"string"===typeof a?h=a:"object"===typeof a&&a.length&&(h=a.join(","));return this}return h};this.filter(e.filter||"");this.freeText(e.freeText||
"");this.fields(e.fields||"");this.setFilter=function(a){this.filter(a)};this.setFreeText=function(a){this.freeText(a)};this.setFields=function(a){this.fields(a)};this.extendOptions=function(a){for(var b in a)e[b]=a[b];l=new f(e);n=new g(e);return this};this.getQueryString=function(){var a=l.toString()+"&"+n.toString();if(this.filter()){var b=this.filter().toString();0<b.trim().length&&(a+="&query="+b)}this.freeText()&&0<this.freeText().trim().length&&(a+="&freetext="+this.freeText()+"&language=en");
this.fields()&&0<this.fields().trim().length&&(a+="&fields="+this.fields());return a};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+q+"/"+p+"/find/all?"+this.getQueryString()};this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};this._setPaging=function(a){a&&(l.pageNumber(a.pagenumber),l.pageSize(a.pagesize),
this.results=this.results||[],this.results.isLastPage=!0,this.results.count=a.totalrecords,this.results.pageNumber=a.pagenumber,this.results.pageSize=a.pagesize,a.pagenumber*a.pagesize<=a.totalrecords&&(this.results.isLastPage=!0))};var r=function(b){var c=[];b||(b=[]);var e="article"===q?"Article":"Connection";p&&"user"==p.toLowerCase()&&(e="User");b.forEach(function(b){c.push(new a.Appacitive[e](b,!0))});return c};this.fetch=function(b,c){var e=this.toRequest();e.onSuccess=function(a){a&&a.status&&
"200"==a.status.code?(t.results=r(a[q+"s"]),t._setPaging(a.paginginfo),"function"===typeof b&&b(t.results,a.paginginfo)):(a=a||{},"function"===typeof c&&c(a.status||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"===typeof c&&c(a.status||{message:"Server error",code:400})};a.Appacitive.http.send(e);return this};this.fetchNext=function(a,b){var c=this.pageNumber();this.pageNumber(++c);this.fetch(a,b);return this};this.fetchPrev=function(a,b){var c=this.pageNumber(),c=c-
1;0>=c&&(c=1);this.pageNumber(c);this.fetch(a,b);return this};this.count=function(b,c){b=b||function(){};c=c||function(){};var e=l.pageSize,d=l.pageNumber;l.pageSize=1;l.pageNumber=999999999;var h=this,k=this.toRequest();k.onSuccess=function(a){l.pageSize=e;l.pageNumber=d;a=a||{};var k=a.paginginfo,f=0;if(k)f=k.totalrecords;else if(a.status&&a.status.code&&"200"==a.status.code)f=0;else{a=a.status||{message:"Server error",code:400};"function"===typeof c&&c(a,h);return}"function"===typeof b&&b(f)};
k.onError=function(a){l.pageSize=e;l.pageNumber=d;a=a||{message:"Server error",code:400};"function"===typeof c&&c(a,h)};a.Appacitive.http.send(k);return this}};a.Appacitive.Queries.FindAllQuery=function(a){a=a||{};if(!a.schema&&!a.relation||a.schema&&a.relation)throw Error("Specify either schema or relation for basic filter query");a.queryType="BasicFilterQuery";c.call(this,a);return this};a.Appacitive.Queries.FindAllQuery.prototype=new c;a.Appacitive.Queries.FindAllQuery.prototype.constructor=a.Appacitive.Queries.FindAllQuery;
a.Appacitive.Queries.ConnectedArticlesQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for connected articles query");if(!d.articleId)throw Error("Specify articleId for connected articles query");if(!d.schema)throw Error("Specify schema of article id for connected articles query");var e=d.schema;delete d.schema;d.queryType="ConnectedArticlesQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.schema=e;this.prev=d.prev;this.returnEdge=!0;void 0===d.returnEdge||
(null===d.returnEdge||d.returnEdge||this.prev)||(this.returnEdge=!1);this.label="";var b=this;d.label&&("string"===typeof d.label&&0<d.label.length)&&(this.label="&label="+d.label);this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.schema+"/"+this.articleId+"/find?"+this.getQueryString()+this.label+"&returnEdge="+this.returnEdge};var f=function(b,c){var e=
[];b.forEach(function(b){var d=null;if(b.__edge){d=b.__edge;delete b.__edge;d.__endpointa=c;d.__endpointb={articleid:b.__id,label:d.__label,type:b.__schematype};delete d.label;var h=new a.Appacitive.Connection(d,!0),d=new a.Appacitive.Article(b,!0);d.connection=h}else d=new a.Appacitive.Article(b,!0);e.push(d)});return e},h=function(b,c){var e=[];b.forEach(function(b){var d=b.__edge;delete b.__edge;d.__endpointa=c;d.__endpointb={article:b,label:d.__label,type:b.__schematype};delete d.label;b=new a.Appacitive.Connection(d,
!0);e.push(b)});return e};this.fetch=function(c,l){var g=this.toRequest();g.onSuccess=function(a){if(a&&a.status&&"200"==a.status.code){var g=f;b.prev&&(g=h);b.results=g(a.nodes?a.nodes:[],{articleid:d.articleId,type:e,label:a.parent});b._setPaging(a.paginginfo);"function"===typeof c&&c(b.results,a.paginginfo)}else a=a||{},"function"===typeof l&&l(a.status||{message:"Server error",code:400})};g.onError=function(a){a=a||{};"function"===typeof l&&l(a.status||{message:"Server error",code:400})};a.Appacitive.http.send(g);
return this};return this};a.Appacitive.Queries.ConnectedArticlesQuery.prototype=new c;a.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=a.Appacitive.Queries.ConnectedArticlesQuery;a.Appacitive.Queries.GetConnectionsQuery=function(d){d=d||{};if(!d.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!d.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!d.label||0===d.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");
d.schema&&delete d.schema;d.queryType="GetConnectionsQuery";c.call(this,d);this.articleId=d.articleId;this.relation=d.relation;this.label=d.label;this.toRequest=function(){var c=new a.Appacitive.HttpRequest;c.url=this.toUrl();c.method="get";return c};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/find/all?"+this.getQueryString()+"&articleid="+this.articleId+"&label="+this.label};return this};a.Appacitive.Queries.GetConnectionsQuery.prototype=new c;a.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=
a.Appacitive.Queries.GetConnectionsQuery;a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(d,e){d=d||{};if(!d.articleAId||"string"!==typeof d.articleAId||0===d.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!d.articleBId||"string"!==typeof d.articleBId||0===d.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");d.schema&&delete d.schema;d.queryType=e||"GetConnectionsBetweenArticlesQuery";
c.call(this,d);this.articleAId=d.articleAId;this.articleBId=d.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"===this.queryType()&&d.label&&"string"===typeof d.label&&0<d.label.length?"&label="+d.label:"";this.relation=d.relation&&"string"===typeof d.relation&&0<d.relation.length?d.relation+"/":"";this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"connection/"+this.relation+
"find/"+this.articleAId+"/"+this.articleBId+"?"+this.getQueryString()+this.label};return this};a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new c;a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;a.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");c=new a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c,
"GetConnectionsBetweenArticlesForRelationQuery");c.fetch=function(c,b){var d=this.toRequest();d.onSuccess=function(d){d&&d.status&&"200"==d.status.code?"function"===typeof c&&c(d.connection?new a.Appacitive.Connection(d.connection):null):(d=d||{},"function"===typeof b&&b(d.status||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};"function"===typeof b&&b(a.status||{message:"Server error",code:400})};a.Appacitive.http.send(d);return this};return c};a.Appacitive.Queries.InterconnectsQuery=
function(d){d=d||{};if(!d.articleAId||"string"!==typeof d.articleAId||0===d.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(d.articleBIds&&"object"===typeof d.articleBIds&&0<d.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");d.schema&&delete d.schema;d.queryType="InterconnectsQuery";c.call(this,d);this.articleAId=d.articleAId;this.articleBIds=d.articleBIds;this.toRequest=function(){var c=new a.Appacitive.HttpRequest;
c.url=this.toUrl();c.method="post";c.data={article1id:this.articleAId,article2ids:this.articleBIds};return c};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};a.Appacitive.Queries.InterconnectsQuery.prototype=new c;a.Appacitive.Queries.InterconnectsQuery.prototype.constructor=a.Appacitive.Queries.InterconnectsQuery;a.Appacitive.Queries.GraphFilterQuery=function(c,e){if(!c||0===c.length)throw Error("Specify name of filter query");
this.name=c;this.data={};this.queryType="GraphFilterQuery";e&&(this.data.placeholders=e);this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();b.method="post";b.data=this.data;return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(b,c){var e=this.toRequest();e.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"===typeof b&&b(a.ids?a.ids:[]):(a=a||{},"function"===typeof c&&c(a.status||{message:"Server error",
code:400}))};e.onError=function(a){a=a||{};"function"===typeof c&&c(a.status||{message:"Server error",code:400})};a.Appacitive.http.send(e);return this}};a.Appacitive.Queries.GraphProjectQuery=function(c,e,b){if(!c||0===c.length)throw Error("Specify name of project query");if(!e||!e.length)throw Error("Specify ids to project");this.name=c;this.data={ids:e};this.queryType="GraphProjectQuery";b&&(this.data.placeholders=b);this.toRequest=function(){var b=new a.Appacitive.HttpRequest;b.url=this.toUrl();
b.method="post";b.data=this.data;return b};this.toUrl=function(){return a.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var f=function(b){var c,e;for(e in b)if("status"!==e){c=b[e];break}var d=function(b,c,e){var h=[];b.forEach(function(b){var l=b.__children;delete b.__children;var k=b.__edge;delete b.__edge;b=new a.Appacitive.Article(b,!0);b.children={};for(var f in l)b.children[f]=[],b.children[f]=d(l[f].values,l[f].parent,b.id);k&&(k.__endpointa={articleid:e,label:c},k.__endpointb=
{articleid:b.id(),label:k.__label},delete k.__label,b.connection=new a.Appacitive.Connection(k));h.push(b)});return h};return d(c.values)};this.fetch=function(b,c){var e=this.toRequest();e.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"===typeof b&&b(f(a)):(a=a||{},"function"===typeof c&&c(a.status||{message:"Server error",code:400}))};e.onError=function(a){a=a||{};"function"===typeof c&&c(a.status||{message:"Server error",code:400})};a.Appacitive.http.send(e);return this}}})(global);
(function(a){a.Appacitive.BaseObject=function(f,g){var c={},d=function(a,b){for(var c in a)if("string"==typeof a[c])b[c]=a[c];else if("object"==typeof a[c]){b[c]=0<=a[c].length?[]:{};for(var e in a[c])b[c][e]=a[c][e]}else b[c]=a[c]},e=this,b={};d(f,b);g&&d(b,c);!c.__id&&b.__id&&(c.__id=b.__id);b.__schematype?(b.__schematype=b.__schematype.toLowerCase(),this.schema=this.entityType=b.__schematype,this.type="user"==b.__schematype||"device"==b.__schematype?b.__schematype:"article"):b.__relationtype&&
(b.__relationtype=b.__relationtype.toLowerCase(),this.relation=this.entityType=b.__relationtype,this.type="connection");var m=parseInt(1E6*Math.random(),10);this.cid=m;var h="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),k=["__link","__endpointa","__endpointb"],l=function(a){a=a||{};a.message=a.message||"Server error";a.code=a.code||"500";return a};
this.attributes=this.toJSON=this.getObject=function(){return JSON.parse(JSON.stringify(b))};this.properties=function(){var a=this.attributes();delete a.__attributes;delete a.__tags;return a};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};b.__attributes||(b.__attributes={});c.__attributes||(c.__attributes={});this.attr=function(){if(0===arguments.length)b.__attributes||(b.__attributes={});else{if(1===arguments.length)return b.__attributes||(b.__attributes=
{}),b.__attributes[arguments[0]];if(2===arguments.length){if("string"!==typeof arguments[1]&&null!==arguments[1])throw Error("only string values can be stored in attributes.");b.__attributes||(b.__attributes={});b.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return b.__attributes};var n=function(){if(!c.__attributes)return null;var a=!1,e=JSON.parse(JSON.stringify(c.__attributes)),d;for(d in b.__attributes)"undefined"==
typeof b.__attributes[d]||null===b.__attributes[d]?(e[d]=null,a=!0):b.__attributes[d]!=c.__attributes[d]?(e[d]=b.__attributes[d],a=!0):b.__attributes[d]==c.__attributes[d]&&delete e[d];return a?e:null};this.getChangedAttributes=n;this.aggregate=function(){var a={},c;for(c in b){if(!b.hasOwnProperty(c))return;"$"==c[0]&&(a[c.substring(1)]=b[c])}if(0===arguments.length)return a;if(1==arguments.length)return a[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");
};var p=[];b.__tags||(b.__tags=[]);c.__tags||(c.__tags=[]);this.tags=function(){return b.__tags?b.__tags:[]};this.addTag=function(a){if(!a||"string"!=typeof a||!a.length)return this;b.__tags||(b.__tags=[]);b.__tags.push(a);b.__tags=Array.distinct(b.__tags);if(!p||!p.length)return this;a=p.indexOf(a);-1!=a&&p.splice(a,1);return this};this.removeTag=function(a){if(!a||"string"!=typeof a||!a.length)return this;p.push(a);p=Array.distinct(p);if(!b.__tags||!b.__tags.length)return this;a=b.__tags.indexOf(a);
-1!=a&&b.__tags.splice(a,1);return this};var q=function(){if(!b.__tags)return[];if(!c.__tags)return b.__tags;var a=[];b.__tags.forEach(function(b){-1==c.__tags.indexOf(b)&&a.push(b)});return a};this.getChangedTags=q;this.getRemovedTags=function(){return _removetags};var t=function(a){var e=!1,d=JSON.parse(JSON.stringify(c)),l;for(l in b)"undefined"==typeof b[l]||null===b[l]?(d[l]=null,e=!0):b[l]!=c[l]?"__tags"==l||"__attributes"==l?delete d[l]:(d[l]=b[l],e=!0):b[l]==c[l]&&delete d[l];try{h.forEach(function(a){d[a]&&
delete d[a]})}catch(k){}a?(b.__tags&&0<b.__tags.length&&(d.__addtags=q(),e=!0),p&&0<p.length&&(d.__removetags=p,e=!0)):b.__tags&&0<b.__tags.length&&(d.__tags=q(),e=!0);(a=n())?(d.__attributes=a,e=!0):delete d.__attributes;for(var f in d)"$"==f[0]&&delete d[f];return e&&!Object.isEmpty(d)?d:!1};this.changed=function(){return t()};this.hasChanged=function(){var a=t(!0);return 0===arguments.length?Object.isEmpty(a)?!1:!0:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length&&a&&a[arguments[0]]?
!0:!1};this.changedAttributes=function(){var a=t(!0);if(0===arguments.length)return a;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var b={};arguments[0].forEach(function(c){a[c]&&b.push(a[c])});return b}return!1};this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&arguments[0].length?c[arguments[0]]:null};this.previousAttributes=function(){return c};var r="";this.fields=function(){if(1==arguments.length){var a=arguments[0];"string"==typeof a?
r=a:"object"==typeof a&&a.length&&(r=a.join(","));return this}return r};var v={integer:function(a){if(a){var b=parseInt(a);if(!isNaN(b))return b}return a},decimal:function(a){if(a){var b=parseFloat(a);if(!isNaN(b))return b}return a},"boolean":function(a){return void 0!==a&&null!==a&&("true"===a.toString().toLowerCase()||!0===a||0<a)?!0:!1},date:function(b){if(b){var c=a.Appacitive.Date.parseISODate(b);if(c)return c}return b},datetime:function(b){if(b){var c=a.Appacitive.Date.parseISODate(b);if(c)return c}return b},
time:function(b){if(b){var c=a.Appacitive.Date.parseISOTime(b);if(c)return c}return b},string:function(a){return a?a.toSting():a}};this.get=function(a,c){if(a){if(c&&v[c.toLowerCase()]){if(v[c.toLowerCase()])return v[c.toLowerCase()](b[a]);throw Error('Invalid cast-type "'+c+'"" provided for get "'+a+'"');}return b[a]}};this.tryGet=function(a,b,c){a=this.get(a,c);return void 0!==a?a:b};this.set=function(c,e){if(!c||"string"!==typeof c||0===c.length||0===c.trim().indexOf("$"))return this;null===e||
"undefined"===e?b[c]=null:"string"===typeof e?b[c]=e:"number"===typeof e||"boolean"===typeof e?b[c]=e+"":"object"===typeof e&&(e instanceof Date?b[c]=a.Appacitive.Date.toISOString(e):0<=e.length?b[c]=e:-1!==k.indexOf(c)&&(b[c]=e));return this};this.unset=function(a){if(!a||"string"!==typeof a||0===a.length||0===a.indexOf("__"))return this;try{delete b[a]}catch(c){}return this};this.has=function(a){return a&&"string"===typeof a&&0!==a.length?b[a]&&"undefined"!==typeof b[a]?!0:!1:!1};this.isNew=function(){return b.__id&&
b.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new a.Appacitive.Article(this.toJSON()):new a.Appacitive.connection(b)};this.copy=function(a,e){a&&(d(a,b),e&&d(a,c));return this};var u=[],y=function(a,b,c){if(!a||"string"!==typeof a||0===a.length||0===a.indexOf("__"))return this;b=!b||isNaN(parseInt(b))?c:parseInt(b)*c;u.push({key:a.toLowerCase(),amount:b});return e};this.increment=function(a,b){return y(a,b,1)};this.decrement=function(a,b){return y(a,b,-1)};this.save=function(){b.__id?
x.apply(this,arguments):A.apply(this,arguments);return this};var A=function(e,h,k){e=e||function(){};h=h||function(){};"string"==typeof k?r=value:k="object"==typeof k&&k.length?k.join(","):r;var f=this;k=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[this.type].getCreateUrl(b.__schematype||b.__relationtype,k);!b.__schematype||"user"!=b.__schematype.toLowerCase()&&"device"!=b.__schematype.toLowerCase()||(k=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getCreateUrl());
for(var g in b)"$"==g[0]&&delete b[g];g=new a.Appacitive.HttpRequest;g.url=k;g.method="put";b.__revision&&delete b.__revision;g.data=b;g.onSuccess=function(k){var g=null;k&&(k.article||k.connection||k.user||k.device)&&(g=k.article||k.connection||k.user||k.device);k&&g?(c=g,b.__id=g.__id,d(g,b),f.connectionCollections&&0<f.connectionCollections.length&&f.connectionCollections.forEach(function(a){a.getQuery().extendOptions({articleId:b.__id})}),"connection"==f.type&&f.parseConnection(),a.Appacitive.eventManager.fire((f.schema||
f.relation)+"."+f.type+".created",f,{object:f}),"function"==typeof e&&e(f)):(k=k||{},k.status=k.status||{},k.status=l(k.status),a.Appacitive.eventManager.fire((f.schema||f.relation)+"."+f.type+".createFailed",f,{error:k.status}),"function"==typeof h&&h(k.status,f))};g.onError=function(a){a=l(a);"function"==typeof h&&h(a,f)};a.Appacitive.http.send(g);return this},x=function(k,h,f){k=k||function(){};h=h||function(){};var g=function(g){var m=t(!0),n;for(n in m)"$"==n[0]&&delete m[n];if(Object.isEmpty(m))"function"==
typeof k&&k(e);else{"string"==typeof f?r=value:f="object"==typeof f&&f.length?f.join(","):r;n=new a.Appacitive.HttpRequest;var q=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[e.type].getUpdateUrl(b.__schematype||b.__relationtype,c.__id?c.__id:b.__id,f,g),w=e.type;b&&(b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))&&(w=b.__schematype.toLowerCase(),q=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getUpdateUrl(c.__id,
f,g));n.url=q;n.method="post";n.data=m;n.onSuccess=function(g){g&&g[w]?(u.length=0,c=g[e.type],d(c,b),p=[],a.Appacitive.eventManager.fire((e.schema||e.relation)+"."+w+"."+b.__id+".updated",e,{object:e}),"function"==typeof k&&k(e)):(g=g||{},g.status=g.status||{},g.status=l(g.status),"14008"==g.status.code&&0<u.length?x(k,h,f):(a.Appacitive.eventManager.fire((e.schema||e.relation)+"."+w+"."+b.__id+".updateFailed",e,{object:g.status}),"function"==typeof h&&h(g.status,e)))};n.onError=function(a){a=a||
{};a.message=a.message||"Server error";a.code=a.code||"500";"14008"==a.code&&0<u.length?x(k,h,f):"function"==typeof h&&h(a,e)};a.Appacitive.http.send(n)}};if(0<u.length){var m=["__revision"];u.forEach(function(a){m.push(a.key)});z(function(a){u.forEach(function(b){var c=v.integer(a[b.key]);c||(c=0);e.set(b.key,c+b.amount)});g(a.__revision)},h,m,!0)}else g();return this},z=function(k,h,f,g){k=k||function(){};h=h||function(){};if(b.__id){"string"==typeof f?r=value:f="object"==typeof f&&f.length?f.join(","):
r;f=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory[e.type].getGetUrl(b.__schematype||b.__relationtype,b.__id,f);var m=new a.Appacitive.HttpRequest;m.url=f;m.method="get";m.onSuccess=function(a){a&&a[e.type]?g?"function"==typeof k&&k(a[e.type]):(c=a[e.type],d(c,b),a.connection&&(e.endpoints||e.endpointA&&e.endpointB||e.setupConnection(b.__endpointa,b.__endpointb)),e.___collection&&"article"==e.___collection.collectionType&&e.___collection.addToCollection(e),"function"==typeof k&&k(e)):
(a=a||{},a.status=a.status||{},a.status=l(a.status),"function"==typeof h&&h(a.status,e))};m.onError=function(a){a=l(a);"function"==typeof h&&h(a,e)};a.Appacitive.http.send(m);return e}"function"==typeof h&&h({code:"400",message:"Please specify id for get operation"},e)};this.fetch=function(a,b,c){z(a,b,c)};this.del=function(c,e,d){if(b.__id){c=c||function(){};e=e||function(){};var h=this,k=a.Appacitive.config.apiBaseUrl,k=k+a.Appacitive.storage.urlFactory[this.type].getDeleteUrl(b.__schematype||b.__relationtype,
b.__id);b&&(b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))&&(k=a.Appacitive.config.apiBaseUrl,k+=a.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getDeleteUrl(b.__id));d&&!0===d&&(k=-1==k.indexOf("?")?k+"?deleteconnections=true":k+"&deleteconnections=true");d=new a.Appacitive.HttpRequest;d.url=k;d.method="delete";d.onSuccess=function(a){"200"==a.code?(h.___collection&&h.___collection.removeById(b.__id),"function"==typeof c&&c(a)):(a=l(a),
"function"==typeof e&&e(a,h))};d.onError=function(a){a=l(a);"function"==typeof e&&e(a,h)};a.Appacitive.http.send(d)}else this.___collection&&this.___collection.removeByCId(m),"function"==typeof c&&c(this)}};a.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(a){var f=function(){return Math.floor(65536*Math.random()).toString(16)};a.Appacitive.GUID=function(){var a=f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f(),c="",d,e,b,m,h,k,l=0,a=a.replace(/\r\n/g,"\n");e="";for(b=0;b<a.length;b++)m=a.charCodeAt(b),128>m?e+=String.fromCharCode(m):(127<m&&2048>m?e+=String.fromCharCode(m>>6|192):(e+=String.fromCharCode(m>>12|224),e+=String.fromCharCode(m>>6&63|128)),e+=String.fromCharCode(m&63|128));for(a=e;l<a.length;)d=a.charCodeAt(l++),e=a.charCodeAt(l++),
b=a.charCodeAt(l++),m=d>>2,d=(d&3)<<4|e>>4,h=(e&15)<<2|b>>6,k=b&63,isNaN(e)?h=k=64:isNaN(b)&&(k=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return c.toString()}})(global);
(function(a){a.Appacitive.ArticleCollection=function(f){var g=null,c=null,d=[],e={};"string"===typeof f?e.schema=f:e=f;this.collectionType="article";this.type=function(){return g};if(!e||!e.schema)throw Error("Must provide schema while initializing ArticleCollection.");var g=e.schema,b=this;f=function(d){d.type="article";d.schema?g=d.schema:d.schema=g;c=new a.Appacitive.Queries.FindAllQuery(d);e=d;b.extendOptions=c.extendOptions};this.setFilter=function(d){e.filter=d;e.type="article";c?c.filter(d):
(c=new a.Appacitive.Queries.FindAllQuery(e),b.extendOptions=c.extendOptions);return this};this.setFreeText=function(d){d||0!==d.trim().length||(e.freeText="");e.freeText=d;e.type="article";c?c.freeText(d):(c=new a.Appacitive.Queries.FindAllQuery(e),b.extendOptions=c.extendOptions);return this};this.setFields=function(d){d||(d="");e.fields=d;e.type="article";c?c.fields(d):(c=new a.Appacitive.Queries.FindAllQuery(e),b.extendOptions=c.extendOptions);return this};this.reset=function(){g=e=null;d.length=
0;c=null};var m=["BasicFilterQuery"];this.query=function(){if(1===arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1===m.indexOf(a.queryType()))throw Error("ArticleCollection only accepts "+m.join(", "));d.length=0;c=a;return this}return c};this.setOptions=f;f(e);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||
a.get("__schematype")!=g)throw Error("Null article passed or schema type mismatch");var b=null;d.forEach(function(c,e){c.get("__id")===a.get("__id")&&(b=e)});null!=b?d.splice(b,1):d.push(a);return this};this.getArticleById=function(a){var b=d.filter(function(b){return b.get("__id")===a});return 1===b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllArticles=function(){return Array.prototype.slice.call(d).map(function(a){return a.getArticle()})};this.removeById=
function(a){if(!a)return!1;var b=null;d.forEach(function(c,e){c.getArticle().__id&&c.getArticle().__id===a&&(b=e)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,e){c.cid&&c.cid===a&&(b=e)});null!==b&&d.splice(b,1);return this};var h=function(a,c,e){a.length&&0!==a.length||(a=[]);a.forEach(function(a){a.___collection=b;d.push(a)});"function"===typeof e&&e(c,b)};this.fetch=function(a,e){d.length=0;c.fetch(function(b,c){h(b,c,a)},function(a){"function"===
typeof e&&e(a,b)});return this};this.count=function(a,b){this.query.count(a,b);return this};this.fetchByPageNumber=function(a,b,e){c.pageNumber(e);this.fetch(a,b);return this};this.fetchNextPage=function(a,b){var e=c.pageNumber();c.pageNumber(++e);this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var e=c.pageNumber(),e=e-1;0>=e&&(e=1);c.pageNumber(e);this.fetch(a,b);return this};this.createNewArticle=function(c){c=c||{};c.__schematype=g;c=new a.Appacitive.Article(c);c.___collection=
b;d.push(c);return c};this.map=function(a,b){return d.map.apply(a,b||this)};this.forEach=function(a,b){return d.forEach(a,b)};this.filter=function(a,b){return d.filter.apply(a,b||this)}};a.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};a.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};a.Appacitive.ArticleCollection.prototype.articles=function(){return this.getAll()};a.Appacitive.ArticleCollection.prototype.length=
function(){return this.articles().length}})(global);
(function(a){a.Appacitive.ConnectionCollection=function(f){var g=null,c=null,d=[],e=[],b={};"string"==typeof f?b.relation=f:b=f;this.collectionType="connection";this.type=function(){return g};var m=this;if(!f||!f.relation)throw Error("Must provide relation while initializing ConnectionCollection.");g=f.relation;f=function(e){e.type="connection";e.relation?g=e.relation:e.relation=g;c=new a.Appacitive.Queries.FindAllQuery(e);b=e;return m};this.setFilter=function(e){b.filter=e;b.type="connection";c?
c.filter(e):(c=new a.Appacitive.Queries.FindAllQuery(b),m.extendOptions=c.extendOptions);return this};this.setFreeText=function(e){e||0!==e.trim().length||(b.freeText="");b.freeText=e;b.type="connection";c?c.freeText(e):(c=new a.Appacitive.Queries.FindAllQuery(b),m.extendOptions=c.extendOptions);return this};this.setFields=function(e){e||(b.fields="");b.fields=e;b.type="connection";c?c.fields(e):(c=new a.Appacitive.Queries.FindAllQuery(b),m.extendOptions=c.extendOptions);return this};this.query=function(){if(1==
arguments.length){var a=arguments[0];if(!a||!a.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==h.indexOf(a.queryType()))throw Error("ConnectionCollection only accepts "+h.join(", "));e.length=0;d.length=0;c=a;return this}return c};var h=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery"];this.reset=function(){g=b=null;e.length=0;d.length=0;c=null};this.setOptions=f;f(b);this.get=function(a){if(a!=parseInt(a,10))return null;a=parseInt(a,10);
return"number"!=typeof a||a>=d.length?null:d.slice(a,a+1)[0]};this.addToCollection=function(a){if(!a||a.get("__relationtype")!=g)throw Error("Null connection passed or relation type mismatch");var b=null;d.forEach(function(c,e){c.get("__id")==a.get("__id")&&(b=e)});null!==b?d.splice(b,1):d.push(a);return this};this.getConnection=function(a,b,c){b=d.filter(function(b){return b.get("__id")==a});return 1==b.length?b[0]:null};this.getAll=function(){return Array.prototype.slice.call(d)};this.getAllConnections=
function(){return Array.prototype.slice.call(d).map(function(a){return a.getConnection()})};this.removeById=function(a){if(!a)return!1;var b=null;d.forEach(function(c,e){c.getConnection().__id&&c.getConnection().__id==a&&(b=e)});null!==b&&d.splice(b,1);return this};this.removeByCId=function(a){if(!a)return!1;var b=null;d.forEach(function(c,e){c.cid&&c.cid==a&&(b=e)});null!==b&&d.splice(b,1);return this};var k=function(a,b,h){"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&(a=[a]);a.length&&
0!==a.length||(a=[]);a.forEach(function(a){a.___collection=m;if(a.endpointA.article||a.endpointB.article){var b=a.endpointA.article||a.endpointB.article;b.___collection=m;e.push(b)}try{a.___collection.connectedArticle||delete a.connectedArticle}catch(c){}d.push(a)});"function"==typeof h&&h(b,m)};this.getConnectedArticle=function(a){if(!e||0===e.length)return null;var b=e.filter(function(b){return b.get("__id")==a});return 0<b.length?b[0]:null};this.fetch=function(a,b){d.length=0;c.prev=!0;c.fetch(function(b,
c){k(b,c,a)},function(a){"function"==typeof b&&b(a,m)});return this};this.count=function(a,b){c.count(a,b);return this};this.fetchByPageNumber=function(a,b,e){c.pageNumber(e);this.fetch(a,b);return this};this.fetchNextPage=function(a,b){var e=c.pageNumber();c.pageNumber(++e);this.fetch(a,b);return this};this.fetchPreviousPage=function(a,b){var e=c.pageNumber(),e=e-1;0>=e&&(e=1);c.pageNumber(e);this.fetch(a,b);return this};this.createNewConnection=function(b){b=b||{};b.__relationtype=g;b=new a.Appacitive.Connection(b);
b.___collection=m;d.push(b);return b};this.map=function(a,b){return d.map.apply(a,b||this)};this.forEach=function(a,b){return d.forEach(a,b)};this.filter=function(a,b){return d.filter.apply(a,b||this)}};a.Appacitive.ConnectionCollection.prototype.toString=function(){return JSON.stringify(this.getAllConnections())};a.Appacitive.ConnectionCollection.prototype.toJSON=function(){return this.getAllConnections()};a.Appacitive.ConnectionCollection.prototype.connections=function(){return this.getAll()};a.Appacitive.ConnectionCollection.prototype.length=
function(){return this.connections().length}})(global);
(function(a){var f=function(c,d){c=c||function(){};d=d||function(){};var e=new a.Appacitive.HttpRequest;e.method="get";e.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));e.onSuccess=function(a){var e=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(e=a[0].username));null!==e?FB.api("/"+e,function(a){a?c(a):d()}):d({code:"404",message:"fb account not found"})};
e.onError=d;a.Appacitive.http.send(e)};a.Appacitive.Article=function(c,d){c=c||{};"string"==typeof c&&(c={__schematype:c});if(!c.__schematype&&!c.schema)throw Error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);a.Appacitive.BaseObject.call(this,c,d);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;this.children={};"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=f);this.toJSON=function(a){if(a){var b=
function(a){var c=[];a.forEach(function(a){var e=a.getObject();if(a.children&&!Object.isEmpty(a.children)){e.children={};for(var d in a.children)e.children[d]=b(a.children[d])}a.connection&&(e.__connection=a.connection.toJSON());c.push(e)});return c};return b([this])[0]}return this.getObject()};return this};a.Appacitive.Article.prototype=new a.Appacitive.BaseObject;a.Appacitive.Article.prototype.constructor=a.Appacitive.Article;var g=function(c){var d=[];c.forEach(function(c){d.push(new a.Appacitive.Article(c,
!0))});return d};a.Appacitive.Article.prototype.getConnections=function(c){if("article"!=this.type)return null;c=c||{};c.articleId=this.get("__id");var d=new a.Appacitive.ConnectionCollection({relation:c.relation});this.connectionCollections.push(d);d.query(new a.Appacitive.Queries.GetConnectionsQuery(c));return d};a.Appacitive.Article.prototype.getConnectedArticles=function(c){c=c||{};"string"==typeof c&&(c={relation:c});c.schema=this.entityType;c.articleId=this.get("__id");c.prev=!0;var d=new a.Appacitive.ConnectionCollection({relation:c.relation});
d.query(new a.Appacitive.Queries.ConnectedArticlesQuery(c));d.connectedArticle=this;this.connectionCollections.push(d);return d};a.Appacitive.Article.prototype.fetchConnectedArticles=function(c,d,e){c=c||{};"string"==typeof c&&(c={relation:c});c.schema=this.entityType;c.articleId=this.get("__id");var b=this,f=new a.Appacitive.Queries.ConnectedArticlesQuery(c);f.fetch(function(a,e){b.children[c.relation]=a;d&&"function"==typeof d&&d(b,e)},e);return f};a.Appacitive.Article.multiDelete=function(c,d,
e){c=c||{};if(!c.schema||"string"!==typeof c.schema||0===c.schema.length)throw Error("Specify valid schema");if("user"===c.schema.toLowerCase()||"device"===c.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(c.ids&&0<c.ids.length){d=d||function(){};e=e||function(){};var b=new a.Appacitive.HttpRequest;b.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c.schema);b.method="post";b.data={idlist:c.ids};b.onSuccess=function(a){a&&
"200"==a.code?"function"===typeof d&&d():(a=a||{},"function"===typeof e&&e(a.status||{message:"Server error",code:400}))};b.onError=function(a){a=a||{};"function"===typeof e&&e(a.status||{message:"Server error",code:400})};a.Appacitive.http.send(b)}else d()};a.Appacitive.Article.multiGet=function(c,d,e){c=c||{};if(!c.schema||"string"!==typeof c.schema||0===c.schema.length)throw Error("Specify valid schema");if(c.ids&&0<c.ids.length){var b=new a.Appacitive.HttpRequest;b.url=a.Appacitive.config.apiBaseUrl+
a.Appacitive.storage.urlFactory.article.getMultiGetUrl(c.schema,c.ids.join(","),c.fields);b.method="get";b.onSuccess=function(a){a&&a.articles?"function"===typeof d&&d(g(a.articles),a.paginginfo):(a=a||{},"function"===typeof e&&e(a.status||{message:"Server error",code:400}))};b.onError=function(a){a=a||{message:"Server error",code:400};"function"===typeof e&&e(a)};a.Appacitive.http.send(b)}else"function"===typeof d&&d([])};a.Appacitive.Article.get=function(c,d,e){c=c||{};if(!c.schema)throw Error("Specify schema");
if(!c.id)throw Error("Specify id to fetch");var b={},b="user"===c.schema.toLowerCase()?new a.Appacitive.User({__id:c.id}):new a.Appacitive.Article({__schematype:c.schema,__id:c.id});b.fetch(d,e,c.fields);return b};a.Appacitive.Article.findAll=function(c,d,e){return(new a.Appacitive.Queries.FindAllQuery(c)).fetch(d,e)}})(global);
(function(a){var f=function(c,b,d){var h={label:c.label};c.articleid&&(h.articleid=c.articleid);if(c.article)"function"===typeof c.article.getArticle?c.article.get("__id")?h.articleid=c.article.get("__id"):h.article=c.article.getArticle():"object"===typeof c.article&&c.article.__schematype&&(c.article.__id?h.articleid=c.article.__id:h.article=c.article,c.article=new a.Appacitive.Article(c.article));else if(!h.articleid&&!h.article)throw Error("Incorrectly configured endpoints provided to setupConnection");
d["endpoint"+b]=c;return h},g=function(c,b,d){c.article&&"object"===typeof c.article?(d["endpoint"+b]?d["endpoint"+b]&&d["endpoint"+b].article&&d["endpoint"+b].article instanceof a.Appacitive.Article?d["endpoint"+b].article.copy(c.article,!0):d["endpoint"+b].article=new a.Appacitive.Article(c.article,!0):(d["endpoint"+b]={},d["endpoint"+b].article=new a.Appacitive.Article(c.article,!0)),d["endpoint"+b].articleid=c.article.__id,d["endpoint"+b].label=c.label,d["endpoint"+b].type=c.type,d["endpoint"+
b].article.___collection=d.___collection):d["endpoint"+b]=c};a.Appacitive.Connection=function(c,b){c=c||{};"string"===typeof c&&(c={__relationtype:c});if(!c.__relationtype&&!c.relation)throw Error("Cannot set connection without relation");c.relation&&(c.__relationtype=c.relation,delete c.relation);c.endpoints&&2===c.endpoints.length&&(c.__endpointa=c.endpoints[0],c.__endpointb=c.endpoints[1],delete c.endpoints);a.Appacitive.BaseObject.call(this,c,b);this.type="connection";this.getConnection=this.getObject;
this.parseConnection=function(){var a="A",b="B";c.__endpointa.label.toLowerCase()!==this.get("__endpointb").label.toLowerCase()||(c.__endpointa.label.toLowerCase()==c.__endpointb.label.toLowerCase()||c.__endpointa.articleid!=this.get("__endpointb").articleid&&c.__endpointa.articleid)||(a="B",b="A");g(this.get("__endpointa"),a,this);g(this.get("__endpointb"),b,this);this.endpoints=function(){if(1===arguments.length&&"string"===typeof arguments[0]){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;
if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var a=[];a.push(this.endpointA);a.push(this.endpointB);return a};return this};b?(this.connectedArticle=function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");var a=this.___collection.connectedArticle.get("__id");if(!a)return null;var b=this.endpointA.articleid;b==a&&(b=this.endpointB.articleid);
return this.___collection.getConnectedArticle(b)},this.parseConnection(c)):c.__endpointa&&c.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};a.Appacitive.Connection.prototype=new a.Appacitive.BaseObject;a.Appacitive.Connection.prototype.constructor=a.Appacitive.Connection;a.Appacitive.Connection.prototype.setupConnection=function(a,b){if(!(a&&(a.articleid||a.article)&&a.label&&b&&(b.articleid||b.article)&&b.label))throw Error("Incorrect endpoints configuration passed.");
this.set("__endpointa",f(a,"A",this));this.set("__endpointb",f(b,"B",this));this.endpoints=function(){if(1===arguments.length&&"string"===typeof arguments[0]){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var a=[];a.push(this.endpointA);a.push(this.endpointB);return a}};a.Appacitive.Connection.get=function(c,b,d){c=c||{};if(!c.relation)throw Error("Specify relation");
if(!c.id)throw Error("Specify id to fetch");var h=new a.Appacitive.Connection({__relationtype:c.relation,__id:c.id});h.fields=c.fields;h.fetch(b,d)};var c=function(c){var b=[];c||(c=[]);c.forEach(function(c){b.push(new a.Appacitive.Connection(c,!0))});return b},d=function(e,b,d){e.onSuccess=function(a){a&&a.status&&"200"==a.status.code?"function"===typeof b&&b(c(a.connections),a.paginginfo):(a=a||{},"function"===typeof d&&d(a.status||{message:"Server error",code:400}))};e.onError=function(a){a=a||
{message:"Server error",code:400};"function"===typeof d&&d(a)};a.Appacitive.http.send(e)};a.Appacitive.Connection.multiGet=function(c,b,f){c=c||{};if(!c.relation||"string"!==typeof c.relation||0===c.relation.length)throw Error("Specify valid relation");if(c.ids&&0<c.ids.length){var h=new a.Appacitive.HttpRequest;h.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.connection.getMultiGetUrl(c.relation,c.ids.join(","),c.fields);h.method="get";return d(h,b,f)}"function"===typeof b&&b([])};
a.Appacitive.Connection.multiDelete=function(c,b,d){c=c||{};if(!c.relation||"string"!==typeof c.relation||0===c.relation.length)throw Error("Specify valid relation");if(c.ids&&0<c.ids.length){var h=new a.Appacitive.HttpRequest;h.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(c.relation);h.method="post";h.data={idlist:c.ids};h.onSuccess=function(a){a&&"200"==a.code?"function"===typeof b&&b():(a=a||{},"function"===typeof d&&d(a||{message:"Server error",
code:400}))};h.onError=function(a){a=a||{};"function"===typeof d&&d(a||{message:"Server error",code:400})};a.Appacitive.http.send(h)}else"function"===typeof b&&b()};a.Appacitive.Connection.findAll=function(c,b,d){return(new a.Appacitive.Queries.FindAllQuery(c)).fetch(b,d)};a.Appacitive.Connection.getInterconnects=function(c,b,d){return(new a.Appacitive.Queries.InterconnectsQuery(c)).fetch(b,d)};a.Appacitive.Connection.getBetweenArticles=function(c,b,d){return(new a.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(c)).fetch(b,
d)};a.Appacitive.Connection.getBetweenArticlesForRelation=function(c,b,d){(new a.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(c)).fetch(b,d)}})(global);
(function(a){a.Appacitive.Users=new function(){var f=null;this.currentUser=function(){return f};var g=function(b,c,d,e,f){var g=b.get("__id");if(!g||"string"!==typeof g||0===g.length)throw Error("Please specify valid userid");if(!c||"string"!==typeof c||0===c.length)throw Error("Please specify valid oldPassword");if(!d||"string"!==typeof d||0===d.length)throw Error("Please specify valid newPassword");e=e||function(){};f=f||function(){};c={oldpassword:c,newpassword:d};d=new a.Appacitive.HttpRequest;
d.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g);d.method="post";d.data=c;d.onSuccess=function(a){a&&"200"==a.code?"function"==typeof e&&e(b):f(a,b)};d.onError=f;a.Appacitive.http.send(d)},c=function(b,c,d){var e=b.get("__id");e&&"string"===typeof e&&0!==e.length||"function"===typeof c&&c(b.linkedAccounts(),b);c=c||function(){};d=d||function(){};var f=new a.Appacitive.HttpRequest;f.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(e);
f.method="get";f.onSuccess=function(a){a&&a.status&&"200"==a.status.code?(a=a.identities||[],0<a.length?b.set("__link",a):b.set("__link",null),"function"===typeof c&&c(a,b)):d(a.status,b)};f.onError=d;a.Appacitive.http.send(f)},d=function(b,c,d,e){var f=c.get("__id");f&&"string"===typeof f&&0!==f.length||d&&"function"==typeof d&&d();if(!b||!b.lat||!b.lng)throw Error("Invalid coordinates provides");d=d||function(){};e=e||function(){};var g=new a.Appacitive.HttpRequest;g.url=a.Appacitive.config.apiBaseUrl+
a.Appacitive.storage.urlFactory.user.getCheckinUrl(f,b.lat,b.lng);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?"function"===typeof d&&d(accounts,c):"function"===typeof e&&e(a,c)};g.onError=e;a.Appacitive.http.send(g)},e=function(b,c,d,e){d=d||function(){};e=e||function(){};var f={authtype:"facebook",accesstoken:b,name:"facebook"};b=c.get("__id");if(c.get("__id")){var g=new a.Appacitive.HttpRequest;g.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getLinkAccountUrl(b);
g.method="post";g.data=f;g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",f),"function"===typeof d&&d(c)):e(a,c)};g.onError=e;a.Appacitive.http.send(g)}else c.set("__link",f),"function"==typeof d&&d(c)},b=function(b,c,d,e){d=d||function(){};e=e||function(){};var f=c.get("__id");if(c.get("__id")){var g=new a.Appacitive.HttpRequest;g.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getLinkAccountUrl(f,b);g.method="post";g.onSuccess=function(a){a&&"200"==a.code?(c.set("__link",
null),"function"===typeof d&&d(c)):e(a,c)};g.onError=e;a.Appacitive.http.send(g)}else"function"===typeof d&&d(c)};this.setCurrentUser=function(c,k,l){if(!c)throw Error("Cannot set null object as user");var m=c;if(m instanceof a.Appacitive.User)if(m.get("__id")&&0!==m.get("__id").length)c=m.toJSON();else throw Error("Specify user __id");else m=new a.Appacitive.User(c,!0);a.Appacitive.localStorage.set("Appacitive-User",c);l||(l=60);f=m;k&&a.Appacitive.Session.setUserAuthHeader(k,l);f.logout=function(b){a.Appacitive.Users.logout(b)};
f.updatePassword=function(a,b,c,d){g(this,a,b,c,d);return this};f.linkFacebookAccount=function(b,c){var d=function(){e(Appacitive.Facebook.accessToken(),f,function(c){a.Appacitive.eventManager.fire("user..article."+c.get("__id")+".updated",c,{object:c});"function"===typeof b&&b(c)},c)};Appacitive.Facebook.getCurrentUserInfo(function(){d()},function(){Appacitive.Facebook.requestLogin(function(){d()},c)});return this};f.unlinkFacebookAccount=function(c,d){b("facebook",this,function(b){a.Appacitive.eventManager.fire("user.article."+
b.get("__id")+".updated",b,{object:b});"function"===typeof c&&c(b)},d);return this};f.logout=function(b){a.Appacitive.Users.logout(b)};f.checkin=function(a,b,c){d(a,this,b,c);return this};a.Appacitive.eventManager.clearAndSubscribe("user.article."+m.get("__id")+".updated",function(b,c){a.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())});return f};a.Appacitive.User=function(b){b=b||{};b.__schematype="user";a.Appacitive.Article.call(this,b);return this};a.Appacitive.User.prototype=
new a.Appacitive.Article("user");a.Appacitive.User.prototype.constructor=a.Appacitive.User;a.Appacitive.User.prototype.linkedAccounts=function(){var a=this.get("__link");a?"object"!==typeof a||0<=a.length?0<=a.length||(a=a[0]):a=[a]:a=[];return a};a.Appacitive.User.prototype.getAllLinkedAccounts=function(a,b){a=a||function(){};var d=this;c(this,function(b){"function"===typeof a&&a(b,d)},b);return this};a.Appacitive.User.prototype.linkFacebookAccount=function(a,b,c){e(a,this,b,c);return this};a.Appacitive.User.prototype.unlinkFacebookAccount=
function(a,c){var d=this;b("facebook",this,function(){var b=d.get("__link");b?0<=b.length||(b=[b]):b=[];0<b.length&&"facebook"==b[0].name&&d.set("__link",null);"function"===typeof a&&a(d)},c);return this};a.Appacitive.User.prototype.clone=function(){return new a.Appacitive.User(this.getObject())};this.deleteUser=function(b,c,d){if(!b)throw Error("Specify userid for user delete");c=c||function(){};d=d||function(){};(new a.Appacitive.Article({__schematype:"user",__id:b})).del(c,d)};this.deleteCurrentUser=
function(b,c){var d=function(){a.Appacitive.Session.removeUserAuthHeader();"function"===typeof b&&b()};if(null===f)d();else{var e=f.get("__id");this.deleteUser(e,function(){d()},c)}};this.createUser=this.createNewUser=function(b,c,d){b=b||{};b.__schematype="user";if(!b.username||!b.password||!b.firstname||0===b.username.length||0===b.password.length||0===b.firstname.length)throw Error("username, password and firstname are mandatory");(new a.Appacitive.User(b)).save(c,d)};this.signup=function(a,b,
c){var d=this;this.createUser(a,function(){d.login(a.username,a.password,b,c)},function(a){c(a)})};this.authenticateUser=function(b,c,d,e){c=c||function(){};d=d||function(){};b.expiry||(b.expiry=864E5);var g=this,m=new a.Appacitive.HttpRequest;m.method="post";m.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();m.data=b;m.onSuccess=function(a){a&&a.user?(e&&(a.user.__authType=e),g.setCurrentUser(a.user,a.token,b.expiry),c({user:f,token:a.token})):(a=a||
{},d(a.status))};m.onError=d;a.Appacitive.http.send(m)};this.login=function(a,b,c,d){if(!a||!b||0==a.length||0==b.length)throw Error("Please specify username and password");this.authenticateUser({username:a,password:b,expiry:864E5},c||function(){},d||function(){},"BASIC")};this.signupWithFacebook=function(a,b){this.loginWithFacebook(a,b,!1,!0)};this.loginWithFacebook=function(b,c,d,e){b=b||function(){};c=c||function(){};var g=this,m=function(){var d={accesstoken:a.Appacitive.Facebook.accessToken(),
type:"facebook",expiry:864E5,createnew:!0};g.authenticateUser(d,function(a){a.user?(a.user.__authType="FB","function"===typeof b&&b({user:f,token:a.token})):(a=a||{},"function"===typeof c&&c(a.status))},c,"FB")};d?m():a.Appacitive.Facebook.requestLogin(function(a){m(a)},c)};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(b,c){b&&("function"!==typeof b&&"boolean"===typeof b)&&(c=b,b=function(){});var d=a.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(!d)return"function"===
typeof b&&b(!1),!1;if(c)return"function"===typeof b&&b(!0),!0;try{var e=this;this.getUserByToken(d,function(a){e.setCurrentUser(a,d);"function"===typeof b&&b(!0)},function(){"function"===typeof b&&b(!1)})}catch(f){b(!1)}};this.sendResetPasswordEmail=function(b,c,d,e){d=d||function(){};e=e||function(){};if(!b||"string"!==typeof b||0===b.length)throw Error("Please specify valid username");if(c&&"string"===typeof c&&0===c.length)throw Error("Plase specify subject for email");b={username:b,subject:c};
c=new a.Appacitive.HttpRequest;c.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=b;c.onSuccess=function(a){a&&"200"==a.code?"function"===typeof d&&d():e(a)};c.onError=e;a.Appacitive.http.send(c)};var m=function(b,c,d){c=c||function(){};d=d||function(){};var e=new a.Appacitive.HttpRequest;e.url=b;e.method="get";e.onSuccess=function(b){b&&b.user?"function"===typeof c&&c(new a.Appacitive.User(b.user)):"function"===typeof d&&
d(b.status)};e.onError=d;a.Appacitive.http.send(e)};this.getUserByToken=function(b,c,d){if(!b||"string"!==typeof b||0===b.length)throw Error("Please specify valid token");var e=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getUserByTokenUrl(b);a.Appacitive.Session.setUserAuthHeader(b,0,!0);m(e,c,d)};this.getUserByUsername=function(b,c,d){if(!b||"string"!==typeof b||0===b.length)throw Error("Please specify valid username");b=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getUserByUsernameUrl(b);
m(b,c,d)};this.logout=function(b,c){f=null;a.Appacitive.Session.removeUserAuthHeader(b||function(){},c)};this.resetPassword=function(b,c,d,e){d=d||function(){};e=e||function(){};if(!b)throw Error("Please specify token");if(!c||0===c.length)throw Error("Please specify password");var f=new a.Appacitive.HttpRequest;f.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getResetPasswordUrl(b);f.method="post";f.data={newpassword:c};f.onSuccess=function(a){a&&"200"==a.code?"function"===
typeof d&&d():e(a)};f.onError=e;a.Appacitive.http.send(f)};this.validateResetPasswordToken=function(b,c,d){c=c||function(){};d=d||function(){};if(!b)throw Error("Please specify token");var e=new a.Appacitive.HttpRequest;e.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.user.getValidateResetPasswordUrl(b);e.method="post";e.data={};e.onSuccess=function(a){a.status&&"200"==a.status.code?"function"===typeof c&&c(a.user):d(a.status)};e.onError=d;a.Appacitive.http.send(e)}}})(global);
(function(a){a.Appacitive.Email=new function(){var f={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return f};var g=function(c,d,e){var b=new a.Appacitive.HttpRequest;b.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.email.getSendEmailUrl();b.method="post";b.data=c;b.onSuccess=function(a){a&&a.status&&"200"==a.status.code?d(a.email):(a=a||{},a.status=a.status||{message:"Server Error",code:"400"},
e(a.status))};a.Appacitive.http.send(b)};this.setupEmail=function(a){a=a||{};f.smtp.username=a.username||f.smtp.username;f.from=a.from||f.from;f.smtp.password=a.password||f.smtp.password;f.smtp.host=a.smtp.host||f.smtp.host;f.smtp.port=a.smtp.port||f.smtp.port;f.smtp.enablessl=a.enableSSL||f.smtp.enablessl;f.replyto=a.replyTo||f.replyto};this.sendTemplatedEmail=function(a,d,e){d=d||function(){};e=e||function(){};if(!a||!a.to||!a.to.length||0===a.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!a.subject||0===a.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!a.from&&f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!a.templateName)throw Error("template name is mandatory to send an email");var b={to:a.to||[],cc:a.cc||[],bcc:a.bcc||[],subject:a.subject,from:a.from,body:{templatename:a.templateName||"",data:a.data||{},ishtml:!1===a.isHtml?!1:!0}};if(a.useConfig){b.smtp=f.smtp;if(!a.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
b.from=a.from||f.from;b.replyto=a.replyTo||f.replyto}g(b,d,e)};this.sendRawEmail=function(a,d,e){d=d||function(){};e=e||function(){};if(!a||!a.to||!a.to.length||0===a.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!a.subject||0===a.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!a.from&&f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!a.body)throw Error("body is mandatory to send an email");
var b={to:a.to||[],cc:a.cc||[],bcc:a.bcc||[],subject:a.subject,from:a.from,body:{content:a.body||"",ishtml:!1===a.isHtml?!1:!0}};if(a.useConfig){b.smtp=f.smtp;if(!a.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");b.from=a.from||f.from;b.replyto=a.replyTo||f.replyto}g(b,d,e)}}})(global);
(function(a){var f=function(){var f=null,c=this.FB=null,d=!1;this.initialize=function(a){if(!Facebook)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!a.appId)throw Error("Please provide appid");if(!a.appSecret)throw Error("Please provide app secret");c=a.appSecret;this.FB=new (require("facebook-node-sdk"))({appId:_appId,secret:c});d=!0};this.requestLogin=function(c,b,d){d&&(f=d);a.Appacitive.Users.loginWithFacebook(c,b,!0)};this.getCurrentUserInfo=function(a,b){if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
this.FB&&f?(a=a||function(){},b=b||function(){},this.FB.api("/me",function(c,d){d?"function"===typeof a&&a(d):"function"===typeof b&&b("Access token is invalid")})):b("Either intialize facebook with your appid and appsecret or set accesstoken")};this.accessToken=function(){return 1===arguments.length?(f=arguments[0],this):f};this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(c,b){c=c||function(){};a.Appacitive.Facebook.accessToken="";"function"===
typeof c&&c()}};a.Appacitive.Facebook=a.Appacitive.runtime.isBrowser?new function(){var f=null,c=!0;this.initialize=function(a){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!a.appId)throw Error("Please provide appid");FB.init(a);c=!0};this.requestLogin=function(a,e){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");a=a||function(){};e=e||function(){};FB.login(function(b){b&&"connected"===b.status&&b.authResponse?(f=b.authResponse.accessToken,
"function"===typeof a&&a(b.authResponse)):"function"===typeof e&&e()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(a,e){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");a=a||function(){};e=e||function(){};FB.api("/me",function(b){b&&!b.error?(f=FB.getAuthResponse().accessToken,"function"===typeof a&&a(b)):"function"===typeof e&&e()})};this.accessToken=function(){return 1===arguments.length?(f=arguments[0],this):f};this.getProfilePictureUrl=
function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(c,e){c=c||function(){};e=e||function(){};a.Appacitive.Facebook.accessToken="";try{FB.logout(function(){a.Appacitive.Users.logout();"function"===typeof c&&c()})}catch(b){"function"===typeof e&&e(b.message)}}}:new f})(global);
(function(a){a.Appacitive.Push=new function(){this.send=function(f,g,c){g=g||function(){};c=c||function(){};if(!f)throw Error("Please specify push options");var d=new a.Appacitive.HttpRequest;d.url=a.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();d.method="post";d.data=f;d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?g(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};a.Appacitive.http.send(d)};
this.getNotification=function(f,g,c){g=g||function(){};c=c||function(){};if(!f)throw Error("Please specify notification id");var d=new a.Appacitive.HttpRequest;d.url=a.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(f);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?g(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};a.Appacitive.http.send(d)};this.getAllNotifications=
function(f,g,c){g=g||function(){};c=c||function(){};f?(f.pnum=f.pnum||1,f.psize=f.psize||20):f={pnum:1,psize:20};var d=new a.Appacitive.HttpRequest;d.url=a.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(f);d.method="get";d.onSuccess=function(a){a&&a.status&&"200"==a.status.code?g(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};d.onError=function(a){c(a||"Server error")};a.Appacitive.http.send(d)}}})(global);
(function(a){a.Appacitive.File=function(f){f=f||{};this.fileId=f.fileId;this.contentType=f.contentType;this.fileData=f.fileData;var g=function(b,c,d){var e=new a.Appacitive.HttpRequest;e.url=b;e.method="GET";e.onSuccess=c;e.onError=d;a.Appacitive.http.send(e)},c=function(b,c,d,e,f){(new FormData).append("fileToUpload",c);var g=new a.Appacitive.HttpRequest;g.url=b;g.method="PUT";g.data=c;g.headers.push({key:"content-type",value:d});g.onSuccess=e;g.onError=f;g.send()};this.save=function(a,c,f){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?e(this,a,c,f):d(this,a,c,f)};var d=function(b,d,e,f){if(!b.fileData)throw Error("Please specify filedata");if(f||"string"==typeof f)b.contentType=f;else{b.contentType&&"string"===typeof b.contentType&&0!==b.contentType.length||(b.contentType="text/plain");try{b.contentType=file.type}catch(l){}}f=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getUploadUrl(b.contentType,b.fileId?b.fileId:"");d=d||function(){};e=e||function(){};
g(f,function(a){a&&a.status&&"200"==a.status.code?c(a.url,b.fileData,b.contentType,function(){b.fileId=a.id;b.getDownloadUrl(function(a){d(a,b)},e)},e):"function"==typeof e&&e(a.status,b)},e);return this},e=function(b,d,e,f){if(!b.fileData)throw Error("Please specify filedata");if(f||"string"==typeof f)b.contentType=f;else{b.contentType&&"string"===typeof f&&0!==b.contentType.length||(b.contentType="text/plain");try{b.contentType=file.type}catch(l){}}f=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getUpdateUrl(b.fileId,
b.contentType);d=d||function(){};e=e||function(){};g(f,function(a){a&&a.status&&"200"==a.status.code?c(a.url,b.fileData,b.contentType,function(){b.getDownloadUrl(function(a){d(a,b)},e)},e):"function"==typeof e&&e(a.status,b)},e);return this};this.deleteFile=function(b,c){if(!this.fileId)throw Error("Please specify fileId to delete");b=b||function(){};c=c||function(){};var d=new a.Appacitive.HttpRequest;d.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
d.method="DELETE";d.onSuccess=function(a){a&&"200"==a.code?"function"==typeof b&&b():"function"==typeof c&&"function"==typeof c&&c(a,that)};d.onError=c;a.Appacitive.http.send(d);return this};this.getDownloadUrl=function(b,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;b=b||function(){};c=c||function(){};var e=new a.Appacitive.HttpRequest;e.url=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(a){a&&a.status&&"200"==a.status.code?(d.url=a.uri,"function"==typeof b&&b(a.uri)):"function"==typeof c&&"function"==typeof c&&c(a.status,d)};e.onError=c;a.Appacitive.http.send(e);return this};this.getUploadUrl=function(b,c,d){var e=this;d||"string"==typeof d?this.contentType=d:this.contentType&&"string"===typeof this.contentType&&0!==this.contentType.length||(this.contentType="text/plain");d=a.Appacitive.config.apiBaseUrl+a.Appacitive.storage.urlFactory.file.getUploadUrl(this.contentType,
this.fileId?this.fileId:"");b=b||function(){};c=c||function(){};g(d,function(a){a&&a.status&&"200"==a.status.code?(e.url=a.url,b(a.url,e)):"function"==typeof c&&c(a.status,e)},c)};return this}})(global);
(function(a){a.Appacitive.Date={};var f=function(a){return 10>a?"0"+a:a};a.Appacitive.Date.parseISODate=function(a){try{if(!/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(a))return new Date(a);var c=a.split("T"),d=c[0].split("-"),e=c[1].split("Z")[0].split(":"),b=e[2].split("."),f=Number(e[0]),h=new Date;h.setUTCFullYear(Number(d[0]));h.setUTCMonth(Number(d[1])-1);h.setUTCDate(Number(d[2]));h.setUTCHours(Number(f));h.setUTCMinutes(Number(e[1]));
h.setUTCSeconds(Number(b[0]));b[1]&&h.setUTCMilliseconds(Number(b[1].substring(0,3)));return h}catch(k){return null}};a.Appacitive.Date.toISOString=function(a){try{return a=a.toISOString(),a=a.replace("Z","0000Z")}catch(c){return null}};a.Appacitive.Date.toISODate=function(a){if(a instanceof Date)return String.format("{0}-{1}-{2}",a.getFullYear(),f(a.getMonth()+1),f(a.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};a.Appacitive.Date.toISOTime=function(a){var c=
function(a){return 10>a?a+"000000":100>a?a+"00000":1E3>a?a+"0000":1E4>a?a+"000":1E5>a?a+"00":1E6>a?a+"0":a};if(a instanceof Date)return String.format("{0}:{1}:{2}.{3}",f(a.getHours()),f(a.getMinutes()),f(a.getSeconds()),c(a.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};a.Appacitive.Date.parseISOTime=function(a){try{var c=new Date,d=a.split("T");1===d.length&&d.push(d[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(d[1]))return null;
var e=d[1].split("Z")[0].split(":"),b=e[2].split("."),f=Number(e[0]);1<d.length?(c.setUTCHours(Number(f)),c.setUTCMinutes(Number(e[1])),c.setUTCSeconds(Number(b[0])),b[1]&&c.setUTCMilliseconds(Number(b[1].substring(0,3)))):(c.setHours(Number(f)),c.setMinutes(Number(e[1])),c.setSeconds(Number(b[0])),b[1]&&c.setMilliseconds(Number(b[1].substring(0,3))));return c}catch(h){return null}}})(global);
(function(a){a.Appacitive.localStorage=new (a.Appacitive.runtime.isBrowser?function(){var f=a.Appacitive.runtime.isBrowser?window.localStorage:{getItem:function(){return null}};this.set=function(g,c){c=c||"";if(!g)return!1;if("object"===typeof c)try{c=JSON.stringify(c)}catch(d){}g=a.Appacitive.getAppPrefix(g);f[g]=c;return!0};this.get=function(g){if(!g)return null;g=a.Appacitive.getAppPrefix(g);g=f.getItem(g);if(!g)return null;if("{"===g[0])try{g=JSON.parse(g)}catch(c){}return g};this.remove=function(g){if(g){g=
a.Appacitive.getAppPrefix(g);try{delete f[g]}catch(c){}}}}:function(){var f=[];this.set=function(g,c){c=c||"";if(!g||"string"!==typeof g)return!1;g=a.Appacitive.getAppPrefix(g);f[g]=c;return!0};this.get=function(g){if(!g||"string"!==typeof g)return null;g=a.Appacitive.getAppPrefix(g);return(g=f[g])?g:null};this.remove=function(g){if(g&&"string"===typeof g){g=a.Appacitive.getAppPrefix(g);try{delete f[g]}catch(c){}}}})})(global);
(function(a){a.Appacitive.Cookie=new (a.Appacitive.runtime.isBrowser?function(){this.setCookie=function(f,g,c,d){f=a.Appacitive.getAppPrefix(f);var e="";c&&(e=new Date,e.setTime(e.getTime()+6E4*c),e.toGMTString());e=d?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":a.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";c="domain="+window.location.hostname;"localhost"==window.location.hostname&&(c="");document.cookie=f+"="+g+e+"; path=/;"+c};this.readCookie=function(f){f=
a.Appacitive.getAppPrefix(f);f+="=";for(var g=document.cookie.split(";"),c=0;c<g.length;c++){for(var d=g[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(f))return d.substring(f.length,d.length)}return null};this.eraseCookie=function(a){this.setCookie(a,"",-1,!0)}}:function(){this.setCookie=function(f,g){a.Appacitive.localStorage.set("cookie/"+f,g)};this.readCookie=function(f){return a.Appacitive.localStorage.get("cookie/"+f)};this.eraseCookie=function(f){a.Appacitive.localStorage.remove("cookie/"+
f)}})})(global);"undefined"===typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
