/*
 * AppacitiveSDK.js v0.9.8.0 - Javascript SDK to integrate applications using Appacitive
 * Copyright (c) 2013 Appacitive Software Pvt Ltd
 * MIT license  : http://www.apache.org/licenses/LICENSE-2.0.html
 * Project      : https://github.com/chiragsanghvi/JavascriptSDK
 * Contact      : support@appacitive.com | csanghvi@appacitive.com
 * Build time 	: Wed Apr 29 11:24:04 IST 2015
 */
"bind"in Function.prototype||(Function.prototype.bind=function(g){var b=this;if(1>=arguments.length)return function(){return b.apply(g,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return b.apply(g,0===arguments.length?c:c.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
"indexOf"in Array.prototype||(Array.prototype.indexOf=function(g,b){void 0===b&&(b=0);0>b&&(b+=this.length);0>b&&(b=0);for(var c=this.length;b<c;b++)if(b in this&&this[b]===g)return b;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(g,b){void 0===b&&(b=this.length-1);0>b&&(b+=this.length);b>this.length-1&&(b=this.length-1);for(b++;0<b--;)if(b in this&&this[b]===g)return b;return-1});
"forEach"in Array.prototype||(Array.prototype.forEach=function(g,b){for(var c=0,d=this.length;c<d;c++)c in this&&g.call(b,this[c],c,this)});"map"in Array.prototype||(Array.prototype.map=function(g,b){for(var c=Array(this.length),d=0,e=this.length;d<e;d++)d in this&&(c[d]=g.call(b,this[d],d,this));return c});"filter"in Array.prototype||(Array.prototype.filter=function(g,b){for(var c=[],d,e=0,h=this.length;e<h;e++)e in this&&g.call(b,d=this[e],e,this)&&c.push(d);return c});
"every"in Array.prototype||(Array.prototype.every=function(g,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&!g.call(b,this[c],c,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=function(g,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&g.call(b,this[c],c,this))return!0;return!1});"find"in Array.prototype||(Array.prototype.find=function(g,b){var c=this.length;if(0!==c)for(var d=0,e;d<c&&d in this;d++)if(e=this[d],g.call(b,e,d,this))return e});
"each"in Array.prototype||(Array.prototype.each=function(g,b){for(var c=0;c<this.length;c++)g.apply(b,[this[c]])});"difference"in Array.prototype||(Array.prototype.difference=function(g){return this.filter(function(b){return 0>g.indexOf(b)})});"without"in Array.prototype||(Array.prototype.without=function(){return this.difference(Array.prototype.slice.call(arguments,0))});
"function"!==typeof Array.prototype.reduce&&(Array.prototype.reduce=function(g){if(null===this||"undefined"===typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!==typeof g)throw new TypeError(g+" is not a function");var b=Object(this),c=b.length>>>0,d=0,e;if(2<=arguments.length)e=arguments[1];else{for(;d<c&&!d in b;)d++;if(d>=c)throw new TypeError("Reduce of empty array with no initial value");e=b[d++]}for(;d<c;d++)d in b&&(e=g(e,b[d],d,b));return e});
var _lookupIterator=function(g,b){return null==g?_.identity:_.isFunction(g)?b?function(){return g.apply(b,arguments)}:g:function(b){return b[g]}};Array.prototype.pluck=function(g){var b=[];this.each(function(c){b.push(c[g])});return b};Array.prototype.sortBy=function(g,b){g=_lookupIterator(g,b);return this.map(function(c,d){return{value:c,criteria:g.call(b,c,d,this)}},this).sort(function(b,d){var e=b.criteria,h=d.criteria;return e<h?-1:e>h?1:0}).pluck("value")};
Date.prototype.toISOString||function(){function g(b){b=String(b);1===b.length&&(b="0"+b);return b}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+g(this.getUTCMonth()+1)+"-"+g(this.getUTCDate())+"T"+g(this.getUTCHours())+":"+g(this.getUTCMinutes())+":"+g(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();
String.addSlashes=function(g){if(!g)return g;g=g.replace(/\\/g,"\\\\");g=g.replace(/\'/g,"\\'");g=g.replace(/\"/g,'\\"');return g=g.replace(/\0/g,"\\0")};String.stripSlashes=function(g){if(!g)return g;g=g.replace(/\\'/g,"'");g=g.replace(/\\"/g,'"');g=g.replace(/\\0/g,"\x00");return g=g.replace(/\\\\/g,"\\")};if("undefined"===typeof console||null===console)console={log:function(){},dir:function(){}};
for(var _type=function(g){if(null===g)return"null";if("undefined"===typeof g||"undefined"===g)return"undefined";if(g&&(1===g.nodeType||9===g.nodeType))return"element";var b=Object.prototype.toString.call(g).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===b){if(isNaN(g))return"nan";if(!isFinite(g))return"infinity"}return b},types="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),generateMethod=function(g){_type["is"+g]=function(b){return _type(b)===
g.toLowerCase()}},i=0;i<types.length;i++)generateMethod(types[i]);_type.isNullOrUndefined=function(g){return"null"==_type(g)||"undefined"==_type(g)};_type.isNumeric=function(g){return!isNaN(parseFloat(g))&&isFinite(g)};_type.isDate=function(g){return g instanceof Date};var _clone=function(g){return _type.isObject(g)?_type.isArray(g)?g.slice():_extend({},g):g};Array.prototype.removeAll=function(g){for(var b=null,c=0;c<this.length;c++)for(;this[c]===g;)b=this.splice(c,1)[0];return b};
Array.prototype.compare=function(g){if(!g||this.length!=g.length)return!1;for(var b=0,c=this.length;b<c;b++)if(this[b]instanceof Array&&g[b]instanceof Array){if(!this[b].compare(g[b]))return!1}else if(this[b]!=g[b])return!1;return!0};
Array.prototype.equals=function(g,b){if(!g)return!1;1==arguments.length&&(b=!1);if(this.length!=g.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&g[c]instanceof Array){if(!this[c].equals(g[c],b))return!1}else{if(b&&!_type.isEqual(this[c],g[c]))return!1;if(!b)return this.sort().equals(g.sort(),!0)}return!0};
var eq=function(g,b,c,d){var e=Object.prototype.toString;if(g===b)return 0!==g||1/g==1/b;if(null==g||null==b)return g===b;var h=e.call(g);if(h!=e.call(b))return!1;switch(h){case "[object String]":return g==String(b);case "[object Number]":return g!=+g?b!=+b:0==g?1/g==1/b:g==+b;case "[object Date]":case "[object Boolean]":return+g==+b}if("object"!=typeof g||"object"!=typeof b)return!1;if(g instanceof global.Appacitive.GeoCoord&&b instanceof global.Appacitive.GeoCoord)return g.toString()==b.toString();
for(e=c.length;e--;)if(c[e]==g)return d[e]==b;var e=g.constructor,l=b.constructor;if(e!==l&&!(_types.isFunction(e)&&e instanceof e&&_types.isFunction(l)&&l instanceof l)&&"constructor"in g&&"constructor"in b)return!1;c.push(g);d.push(b);e=0;l=!0;if("[object Array]"==h){if(e=g.length,l=e==b.length)for(;e--&&(l=eq(g[e],b[e],c,d)););}else{for(var f in g)if(Object.prototype.hasOwnProperty.call(g,f)&&(e++,!(l=Object.prototype.hasOwnProperty.call(b,f)&&eq(g[f],b[f],c,d))))break;if(l){for(f in b)if(Object.prototype.hasOwnProperty.call(b,
f)&&!e--)break;l=!e}}c.pop();d.pop();return l};_type.isEqual=function(g,b){return eq(g,b,[],[])};var global={};
(function(){global.Appacitive||("undefined"!==typeof module&&module.exports?(global="undefined"!==typeof process?process:{},global.Appacitive={runtime:{isNode:!0,isBrowser:!1}}):(global="undefined"!==typeof window?window:{},global.Appacitive={runtime:{isNode:!1,isBrowser:!0}}));var g=global.Appacitive,b=function(b){if(b&&b.send&&_type.isFunction(b.send))b.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var d=[],c={},h=0,e={},k=0;this.addProcessor=function(b){b&&
(b.pre=b.pre||function(){},b.post=b.post||function(){},l(b.pre),y(b.post))};var l=function(b){h+=1;c[h]=b;return h},y=function(b){k+=1;e[k]=b;return k};this.enqueueRequest=function(b){d.push(b)};this.changeRequestForCors=function(b){var f={m:b.method.toUpperCase()};b.headers.forEach(function(b){f[b.key]=b.value});b.prevHeaders=b.headers;b.headers=[];b.headers.push({key:"Content-Type",value:"text/plain; charset=utf-8"});b.method="POST";b.data&&(f.b=b.data);delete b.data;g.config.debug&&(-1===b.url.indexOf("?")?
b.url+="?debug=true":b.url+="&debug=true");g.config.metadata&&(-1===b.url.indexOf("?")?b.url+="?metadata=true":b.url+="&metadata=true");try{b.data=JSON.stringify(f)}catch(d){}return b};this.notify=function(){if(0!==d.length){var h=[],k;for(k in e)e.hasOwnProperty(k)&&h.push(e[k]);for(;0<d.length;){var g=d.shift(),r=[];for(k in c)c.hasOwnProperty(k)&&r.push(c[k](g));this.changeRequestForCors(g);b.send(g,h,r)}}};this.onResponse=function(b){console.dir(b)}},c=function(){var b=function(){throw Error("Not Implemented Exception");
};this.inOnline=this.send=b;this.onResponse=function(d,c){b()};this.onError=function(d){b()}},d=null,d=g.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest,e=function(b){var d=g.Promise.buildPromise({success:b.onSuccess,error:b.onError}),c=new XDomainRequest;c.onload=function(){var b=c.responseText,f=c.contentType||"";if("application/json"==f.toLowerCase()||"application/javascript"==f.toLowerCase()||"application/json; charset=utf-8"==f.toLowerCase()||"application/json; charset=utf-8;"==
f.toLowerCase())try{f=b,g.runtime.isBrowser||"{"!=f[0]&&(f=f.substr(1,f.length-1)),b=JSON.parse(f)}catch(h){return d.reject(c,new g.Error(g.Error.InvalidJson,"Error while parsing received json "+b))}d.fulfill(b,this)};c.onerror=c.ontimeout=function(){c.responseData="IE's XDomainRequest does not supply error info.";c.status=g.Error.XDomainRequest;d.reject(c,new g.Error(g.Error.XDomainRequest,c.responseData,"Unknown"))};c.onprogress=function(){};-1===b.url.indexOf("?")?b.url+="?ua=ie":b.url+="&ua=ie";
c.open(b.method,b.url,b.sync?!1:!0);c.send(b.data);return d},h=function(b){if(!b.url)throw Error("Please specify request url");b.method||(b.method="GET");b.headers||(b.headers=[]);var c={};b.onSuccess&&_type.isFunction(b.onSuccess)||(b.onSuccess=function(){});b.onError&&_type.isFunction(b.onError)||(b.onError=function(){});var h=g.Promise.buildPromise({success:b.onSuccess,error:b.onError}),l=!0;b.headers.forEach(function(b){"content-type"==b.key.toLowerCase()&&(l=!0,"application/json"==b.value.toLowerCase()||
"application/javascript"==b.value.toLowerCase()||"application/json; charset=utf-8"==b.value.toLowerCase()||"application/json; charset=utf-8;"==b.value.toLowerCase())&&(l=!1)});if(l)c=b.data;else if(b.data&&(c=b.data,_type.isObject(b.data)))try{c=JSON.stringify(c)}catch(p){}var k=b.url.split("/")[2]||"";if(global.navigator&&-1!=global.navigator.userAgent.indexOf("MSIE 8")&&k!==window.location.host.toLowerCase())return b.data=c,new e(b);k=new d;k.onreadystatechange=function(){if(4==this.readyState)if(200<=
this.status&&300>this.status||304==this.status){var b=this.responseText,c=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type")||"";if("application/json"==c.toLowerCase()||"application/javascript"==c.toLowerCase()||"application/json; charset=utf-8"==c.toLowerCase()||"application/json; charset=utf-8;"==c.toLowerCase())try{c=b,g.runtime.isBrowser||"{"!=c[0]&&(c=c.substr(1,c.length-1)),b=JSON.parse(c)}catch(d){return h.reject(this,new g.Error(g.Error.InvalidJson,"Error while parsing received json "+
b))}h.fulfill(b,this)}else h.reject(this,new g.Error(g.Error.ConnectionFailed,this.responseText,"Unknown"))};k.open(b.method,b.url,b.sync?!1:!0);for(var t=0;t<b.headers.length;t+=1)k.setRequestHeader(b.headers[t].key,b.headers[t].value);g.runtime.isBrowser||k.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");k.send(c);return h},l=function(){var b=new c;b.isOnline=function(){return!0};var d=function(c,d,e){c.options=c.options||{};new h({method:c.method,url:c.url,headers:c.headers,data:c.data,sync:c.options.sync,
onSuccess:function(h,n){if(h){try{h=JSON.parse(h)}catch(g){}var l=h;if(d.length!=e.length)throw Error("Callback length and state length mismatch!");for(var u=0;u<d.length;u+=1)d[u].apply({},[l,e[u]]);if(200<=h.code&&300>=h.code||h.status&&200<=h.status.code&&300>=h.status.code)b.onResponse(c,h);else h=h||{},h=h.status||h,h.message=h.message||"Bad Request",h.code=h.code||"400",b.onError(c,{responseText:h})}else b.onError(c,{responseText:{code:"400",message:"Invalid request"}})},onError:function(d,
h){var e={};h?e=g.Error.toJSON(h):(e.message=d.responseData||d.responseText||"Bad Request",e.code=d.status||"400");b.onError(c,{responseText:e})}})};b.send=function(b,c,f){if(!g.Session.initialized)throw Error("Initialize Appacitive SDK");_type.isFunction(b.beforeSend)&&b.beforeSend(b);d(b,c,f)};return b};g.http=new function(){var c=new l,d=new b(c),h=!1;this.pause=function(){h=!0};this.unpause=function(){h=!1};this.addProcessor=function(b){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');
if(!b)throw c;if(!b.pre&&!b.post)throw c;d.addProcessor(b)};this.send=function(b){b.promise=g.Promise.is(b.promise)?b.promise:new g.Promise.buildPromise({error:b.onError});d.enqueueRequest(b);c.isOnline()&&!1===h&&d.notify();return b.promise};this.flush=function(b){b?d.notify():c.isOnline()&&d.notify()};this.onError=function(b,c){var d=c.responseText;g.logs.logRequest(b,d,d,"error");b.entity&&b.entity._triggerError&&b.entity._triggerError(b.options,new g.Error(d));b.promise.reject(new g.Error(d),
b.entity)};c.onError=this.onError;this.onResponse=function(b,c){if(b.onSuccess)if(b.context)b.onSuccess.apply(b.context,[c]);else b.onSuccess(c);g.logs.logRequest(b,c,c?c.status:null,"successful")};c.onResponse=this.onResponse};g.HttpRequest=function(b){b=b||{};this.url=b.url||"";this.data=b.data||{};this.headers=b.headers||[];this.method=b.method||"GET";this.onSuccess=b.onSuccess||function(){};this.onError=b.onError||function(){};this.send=function(b){return new h(this,b)}};(function(b){var c=b.Appacitive;
c&&c.http&&(c.http.addProcessor({pre:function(b){return b},post:function(b,d){try{var f=c.Session.isSessionValid(b);f.status?b&&(b.status&&b.status.code&&("19036"==b.status.code||"421"==b.status.code)||b.code&&("19036"==b.code||"421"==b.code))?c.Users.logout():c.Session.incrementExpiry():f.isSession&&(null!==c.Session.get()&&c.Session.resetSession(),c.http.send(d))}catch(h){}}}),c.http.addProcessor({pre:function(b){return{start:(new Date).getTime(),request:b}},post:function(b,c){c.request.timeTakenInMilliseconds=
(new Date).getTime()-c.start}}))})(global)})(this);
(function(g){var b=g.Appacitive;b.logs={};var c=function(b,c){setTimeout(function(){try{b.call({},c)}catch(h){}},0)};b.logs.logRequest=function(d,e,h,g){e=e||{};h=h||{};var f={};try{f=JSON.parse(d.data),_type.isObject(f)||(f={})}catch(n){}var q={status:g,referenceId:h.referenceid,date:(new Date).toISOString(),method:f.m,url:decodeURIComponent(d.url),responseTime:d.timeTakenInMilliseconds,headers:{},request:null,response:e,description:d.description};d.headers&&d.headers.forEach(function(b){q.headers[b.key]=
b.value});d.prevHeaders&&d.prevHeaders.forEach(function(b){q.headers[b.key]=b.value});"GET"!==q.method&&(q.request=f.b);"error"==g&&(b.runtime.isBrowser&&console.dir(q),_type.isFunction(b.logs.apiErrorLog)&&c(b.logs.apiErrorLog,q));_type.isFunction(b.logs.apiLog)&&c(b.logs.apiLog,q)};b.logs.logException=function(d){_type.isFunction(b.logs.exceptionLog)&&c(b.logs.exceptionLog,d)}})(global);
(function(g){var b=g.Appacitive;String.format=function(b,d){if(1>=arguments.length)return b;for(var e=arguments.length-2,h=0;h<=e;h++)b=b.replace(new RegExp("\\{"+h+"\\}","gi"),arguments[h+1]);return b};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(b){var d=new RegExp("^"+b),e=this;d.test(e)&&(e=e.slice(1,e.length));d=new RegExp(b+"$");d.test(e)&&(e=e.slice(0,-1));return e};String.toSearchString=function(b){"undefined"===
typeof b&&(b="");for(var d="",e=0;e<b.length;e+=1)-1===" .,;#".indexOf(b[e])&&(d+=b[e]);return d=d.toLowerCase()};String.contains=function(b,d){return-1!==b.indexOf(d)};String.startsWith=function(b,d){return 0===b.indexOf(d)};Array.distinct=function(b){var d=[],e=b.length,h,g,f;for(g=0;g<e;g++){h=void 0;for(f=0;f<d.length;f++)if(b[g].toLowerCase()===d[f].toLowerCase()){h=!0;break}h||d.push(b[g])}return d};Object.isEmpty=function(b){if(!b)return!0;var d=!0,e;for(e in b){d=!1;break}return d};g.dateFromWcf=
function(b,d){var e=/Date\(([^)]+)\)/.exec(b);if(2!=e.length){if(!d)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(e[1]))};b.storage=b.storage||{};b.storage.urlFactory=new function(){b.bag=b.bag||{};var c=function(b){"object"===typeof b&&0<b.length&&("string"===typeof b[0]||"number"===typeof b[0])&&(b=b.join(","));b||(b="");return b};this.application={applicationServiceUrl:"application",getSessionCreateUrl:function(){return String.format("{0}/session",this.applicationServiceUrl)}};
this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(b,e){return String.format("{0}/create?fields={1}",this.userServiceUrl,c(e))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,e,h){return String.format("{0}/{1}?fields={2}",b,e,c(h))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token={1}",
this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",this.userServiceUrl,b)},getUpdateUrl:function(b,e,h){return h?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,b,c(e),h):String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,c(e))},getDeleteUrl:function(b,c,h){return!0===h?String.format("{0}/{1}?deleteconnections=true",this.userServiceUrl,c):String.format("{0}/{1}",this.userServiceUrl,c)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",
this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",
this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,h){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,b,c,h)},getResetPasswordUrl:function(b){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,b)},getValidateResetPasswordUrl:function(b){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,b)}};this.device={deviceServiceUrl:"device",
getCreateUrl:function(b,e){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,c(e))},getGetUrl:function(b,e,h){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,e,c(h))},getUpdateUrl:function(b,e,h){return h?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,b,c(e),h):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,c(e))},getDeleteUrl:function(b,c,h){return!0===h?String.format("{0}/{1}?deleteconnections=true",this.deviceServiceUrl,c):String.format("{0}/{1}",
this.deviceServiceUrl,c)}};this.object={objectServiceUrl:"object",getSearchAllUrl:function(b,c,h){var g="",g=String.format("{0}/search/{1}/all",this.objectServiceUrl,b),g=h?g+"?psize="+h:g+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!==c[b].trim().length&&(g=g+"&"+c[b]);return g},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.objectServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",
this.objectServiceUrl,b,c)},getMultiGetUrl:function(b,e,h){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.objectServiceUrl,b,e,c(h))},getCreateUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.objectServiceUrl,b,c(e))},getGetUrl:function(b,e,h){return String.format("{0}/{1}/{2}?fields={3}",this.objectServiceUrl,b,e,c(h))},getUpdateUrl:function(b,e,h,g){return g?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.objectServiceUrl,b,e,c(h),g):String.format("{0}/{1}/{2}?fields={3}",
this.objectServiceUrl,b,e,c(h))},getDeleteUrl:function(b,c,h){return!0===h?String.format("{0}/{1}/{2}?deleteconnections=true",this.objectServiceUrl,b,c):String.format("{0}/{1}/{2}",this.objectServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.objectServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,e,h){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,e,c(h))},getMultiGetUrl:function(b,e,h){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.connectionServiceUrl,b,e,c(h))},getCreateUrl:function(b,e){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,c(e))},getUpdateUrl:function(b,e,h,g){return g?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,b,e,c(h),g):String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,e,c(h))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,h,g){var f="",f=String.format("{0}/{1}/find/all?label={2}&objectid={3}",this.connectionServiceUrl,b,h,c);if("undefined"!==typeof g&&0<g.length)for(b=0;b<g.length;b+=1)f=f+"&"+g[b];return f},getConnectedArticles:function(b,c,h){var g="",g=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,b,c);if(h&&h.length&&0<h.length)for(b=0;b<h.length;b+=1)g=0===b?g+("?"+h[b]):g+("&"+h[b]);return g},getInterconnectsUrl:function(){return String.format("{0}/interconnects",
this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,
b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b,c){return c&&0<c.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",this.fileServiceUrl,escape(b),escape(c)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""===location.search||-1===location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(h,g){var f=g.split("="),n=f[1];2<f.length&&f.forEach(function(b,c){0!==b&&1!==b&&(n=n+"="+
f[b])});f[0].toLowerCase()===b&&(c=[f[0],n])}),c):location.search.split("?")[1].split("=")}};this.usergroup={usergroupServiceUrl:"usergroup",getUpdateUrl:function(b){return String.format("{0}/{1}/members",this.usergroupServiceUrl,b)}};this.ping={pingServiceUrl:"ping",getPingUrl:function(){return String.format("{0}/",this.pingServiceUrl)}};this.multi={multiServiceUrl:"multi",getBatchUrl:function(){return String.format("{0}/",this.multiServiceUrl)}}}})(global);
(function(g){var b=g.Appacitive,c;c=b.runtime.isNode?process.nextTick:setTimeout;var d=function(){if(!(this instanceof d))return new d;this.calls=[]};d.prototype.isResolved=function(){return 1===this.state?!0:!1};d.prototype.isRejected=function(){return 2===this.state?!0:!1};d.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};d.prototype.done=function(){var c,h,g=this.state,f=this.value;if(!g)return this;for(;c=this.calls.shift();)if(h=c[0],"function"===typeof c[g]){try{f=
2===g?c[g].call(h,this.value):c[g].apply(h,this.value)}catch(n){b.logs.logException({name:n.name,message:n.message,stack:n.stack});if(0==h.calls.length)throw n;h.reject(n)}f instanceof d||f&&"function"===typeof f.then?f.then(function(b){h.fulfill(b)},function(b){h.reject(b)}):1===g?h.fulfill(f):h.reject(f)}else 1===g?h.fulfill(f):h.reject(f)};d.prototype.fulfill=function(b){if(this.state)return this;this.state=1;this.reason=this.value=[].slice.call(arguments);this.done();return this};d.prototype.resolve=
d.prototype.fulfill;d.prototype.reject=function(b){if(this.state)return this;this.state=2;this.reason=this.value=b;this.done();return this};d.prototype.then=function(b,h){var g=this,f=new d;this.calls[this.calls.length]=[f,b,h];this.state&&c(function(){g.done()});return f};d.when=function(b){var h=[],g=[],f,n=0,q=new d;if(!b||_type.isArray(b)&&0==b.length)return q.fulfill(h),q;var r=function(){n+=1;n==f&&(q.state||(0<g.length?q.reject(g,h?h:[]):q.fulfill(h?h:[])))},p=function(f){var k=b[f];k instanceof
d||k&&"function"===typeof k.then?c(function(){k.then(function(b){h[f]=b;r()},function(b){g[f]=b;r()})}):c(function(){try{h[f]=k.call()}catch(b){g[f]=b}r()})};_type.isArray(b)||(b=[b]);f=b.length;for(var k=0;k<f;k+=1)p(k);return q};d.is=function(b){return b instanceof d?!0:!1};d.buildPromise=function(b){var c=new d;_type.isObject(b)&&c.then(b.success,b.error);return c};d._continueUntil=function(b,c){return _type.isFunction(b)&&b()?c().then(function(){return d._continueUntil(b,c)}):(new d).fulfill()};
b.Promise=d})(global);
(function(g){g.Appacitive.eventManager=new function(){function b(){var b=function(){return Math.floor(65536*Math.random()).toString(16)};return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()}var c={};this.subscribe=function(d,e){if("string"!=typeof d||"function"!=typeof e)throw Error("Incorrect subscription call");"undefined"==typeof c[d]&&(c[d]=[]);var h=b();c[d].push({callback:e,id:h});return h};this.unsubscribe=function(b){if(!b)return!1;var e=-1,h=null,g;for(g in c)for(var f=0;f<c[g].length;f+=
1)if(c[g][f].id==b){e=f;h=g;break}return-1!=e?(c[h].splice(e,1),!0):!1};this.fire=function(b,e,h){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof h||null===h)h={};h.eventName=b;if("undefined"!=typeof c.all)for(var g=0;g<c.all.length;g+=1)c.all[g].callback(e,h);g=function(b,c,f){setTimeout(function(){b(c,f)},0)};if("undefined"!=typeof c[b])for(var f=0;f<c[b].length;f+=1)g(c[b][f].callback,e,h)};this.clearSubscriptions=function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");
c[b]&&(c[b].length=0);return this};this.clearAndSubscribe=function(b,c){this.clearSubscriptions(b);this.subscribe(b,c)};this.dump=function(){console.dir(c)}}})(global);
(function(g){var b={},c=Array.prototype.forEach,d=Object.prototype.hasOwnProperty,e=Array.prototype.slice,h=0,l=function(){return{keys:Object.keys,uniqueId:function(b){var c=++h+"";return b?b+c:c},has:function(b,c){return d.call(b,c)},each:function(f,h,d){if(null!=f)if(c&&f.forEach===c)f.forEach(h,d);else if(f.length===+f.length)for(var e=0,q=f.length;e<q&&h.call(d,f[e],e,f)!==b;e++);else for(e in f)if(this.has(f,e)&&h.call(d,f[e],e,f)===b)break},once:function(b){var c=!1,f;return function(){if(c)return f;
c=!0;f=b.apply(this,arguments);b=null;return f}}}}(),f;f={on:function(b,c,f){if(!q(this,"on",b,[c,f])||!c)return this;this._events||(this._events={});(this._events[b]||(this._events[b]=[])).push({callback:c,context:f,ctx:f||this});return this},once:function(b,c,f){if(!q(this,"once",b,[c,f])||!c)return this;var h=this,d=l.once(function(){h.off(b,d);c.apply(this,arguments)});d._callback=c;return this.on(b,d,f)},off:function(b,c,f){var h,d,e,g,n,r,v,A;if(!this._events||!q(this,"off",b,[c,f]))return this;
if(!b&&!c&&!f)return this._events={},this;g=b?[b]:l.keys(this._events);n=0;for(r=g.length;n<r;n++)if(b=g[n],e=this._events[b]){this._events[b]=h=[];if(c||f)for(v=0,A=e.length;v<A;v++)d=e[v],(c&&c!==d.callback&&c!==d.callback._callback||f&&f!==d.context)&&h.push(d);h.length||delete this._events[b]}return this},trigger:function(b){if(!this._events)return this;var c=e.call(arguments,1);if(!q(this,"trigger",b,c))return this;var f=this._events[b],h=this._events.all;f&&r(f,c);h&&r(h,arguments);return this},
stopListening:function(b,c,f){var h=this._listeners;if(!h)return this;var d=!c&&!f;"object"===typeof c&&(f=this);b&&((h={})[b._listenerId]=b);for(var e in h)h[e].off(c,f,this),d&&delete this._listeners[e];return this}};var n=/\s+/,q=function(b,c,f,h){if(!f)return!0;if("object"===typeof f){for(var d in f)b[c].apply(b,[d,f[d]].concat(h));return!1}if(n.test(f)){f=f.split(n);d=0;for(var e=f.length;d<e;d++)b[c].apply(b,[f[d]].concat(h));return!1}return!0},r=function(b,c){var f,h=-1,d=b.length,e=c[0],q=
c[1],g=c[2];switch(c.length){case 0:for(;++h<d;)(f=b[h]).callback.call(f.ctx);break;case 1:for(;++h<d;)(f=b[h]).callback.call(f.ctx,e);break;case 2:for(;++h<d;)(f=b[h]).callback.call(f.ctx,e,q);break;case 3:for(;++h<d;)(f=b[h]).callback.call(f.ctx,e,q,g);break;default:for(;++h<d;)(f=b[h]).callback.apply(f.ctx,c)}};l.each({listenTo:"on",listenToOnce:"once"},function(b,c){f[c]=function(c,f,h){var d=this._listeners||(this._listeners={}),e=c._listenerId||(c._listenerId=l.uniqueId("l"));d[e]=c;"object"===
typeof f&&(h=this);c[b](f,h,this);return this}});f.bind=f.on;f.unbind=f.off;f.mixin=function(b){l.each("on once off trigger stopListening listenTo listenToOnce bind unbind".split(" "),function(c){b[c]=this[c]},this);return b};g.Appacitive.Events=f})(global);
(function(g){g.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/v1.0/",metadata:!0};!g.navigator||-1==g.navigator.userAgent.indexOf("MSIE 8")&&-1==g.navigator.userAgent.indexOf("MSIE 9")||(g.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/v1.0/")})(global);
(function(g){var b=g.Appacitive;g=function(c){var d;if(!c||!_type.isObject(c))throw Error("Please specify request options");this.promise=b.Promise.buildPromise(c.options);var e=this.request=new b.HttpRequest;d=b.storage.urlFactory[c.type];var h=c.op.replace("get","").replace("Url","")+" "+c.type;d=b.config.apiBaseUrl+d[c.op].apply(d,c.args||[]);e.url=d;e.description=h;e.method=c.method||"get";e.data=c.data||{};e.onSuccess=c.onSuccess;e.onError=c.onError;e.promise=this.promise;e.options=c.options;
c.entity&&(e.entity=c.entity);return this};g.prototype.send=function(){return b.http.send(this.request)};b._Request=g})(global);
var ArrayProto=Array.prototype,ObjectProto=Object.prototype,each=function(g,b,c){if(null!=g)if(ArrayProto.forEach&&g.forEach===ArrayProto.forEach)g.forEach(b,c);else if(g.length===+g.length)for(var d=0,e=g.length;d<e&&b.call(c,g[d],d,g)!=={};d++);else for(d in g)if(ObjectProto.hasOwnProperty.call(g,d)&&b.call(c,g[d],d,g)==={})break},_extend=function(g){each(ArrayProto.slice.call(arguments,1),function(b){if(b)for(var c in b)g[c]=b[c]});return g},_reject=function(g,b){return g.filter(function(c){return!b(c)})},
_deepExtend=function(g){each(Array.prototype.slice.call(arguments,1),function(b){for(var c in b)_type.isArray(b[c])?(_type.isArray(g[c])||(g[c]=[]),g[c]=_reject(_extend(g[c],b[c]),function(b){return _type.isNull(b)})):!_type.isObject(b[c])||b[c]instanceof global.Appacitive.Object||b[c]instanceof global.Appacitive.Connection||b[c]instanceof global.Appacitive.GeoCoord?g[c]=b[c]:(_type.isObject(g[c])||(g[c]={}),g[c]=_extend(g[c],b[c]))});return g},extend=function(g,b){var c=this,d;d=_type.isObject(g)&&
g.hasOwnProperty("constructor")?g.constructor:function(){return c.apply(this,arguments)};_extend(d,c,b);var e=function(){this.constructor=d};e.prototype=c.prototype;d.prototype=new e;g&&_extend(d.prototype,g);d.__super__=c.prototype;return d};(function(g){g.Appacitive._extend=function(b,c,d){return extend.apply(b,[c,d])}})(global);
(function(g){g=g.Appacitive;g.Error=function(b,c,d,e){if(_type.isString(b)||_type.isNumber(b))b={code:b,message:c,referenceId:d,additionalMessages:e};this.code=b.code||"400";this.message=b.message||"Unknown Error";b.referenceId&&(this.referenceId=b.referenceid||b.referenceId);b.additionalmessages&&(this.additionalMessages=b.additionalmessages||additionalMessages)};g.Error.toJSON=function(b){return{code:b.code,message:b.message,referenceId:b.referenceId,additionalmessages:b.additionalMessages}};_extend(g.Error,
{BadRequest:"400",AccessControl:"401",PaymentRequired:"402",UsageLimitReached:"403",NotFound:"404",Duplicate:"435",MvccFailure:"409",PreconditionFailed:"412",ApiAuthenticationError:"420",IdentityFailures:"421",IncorrectConfiguration:"436",InternalServerError:"500",DataAccessFailure:"512",UnknownCause:100,InvalidParameters:"400",ConnectionFailed:1001,MissingId:"404",InvalidJson:1007,DuplicateUsername:"435",DuplicateValue:"435",XDomainRequest:5E3})})(global);
(function(g){var b=g.Appacitive;b.Session=new function(){this.initialized=!1;var c=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},d=null,e=null,h=null,g=!1,f;this.useApiKey=!0;this.useMasterKey=!1;this.onSessionCreated=function(){};this.recreate=function(c){return b.Session.create(c)};this.create=function(f){if(!this.initialized)throw Error("Initialize Appacitive SDK");var h=new c;h.apikey=e;var g=new b._Request({method:"PUT",type:"application",op:"getSessionCreateUrl",
options:f,data:h,onSuccess:function(c){d=c.session.sessionkey;b.Session.useApiKey=!1;g.promise.fulfill(c);b.Session.onSessionCreated()}});return g.send()};b.http.addProcessor({pre:function(c){c.options=c.options||{};if(b.Session.useApiKey){var n=e;(c.options.useMasterKey||b.useMasterKey&&!c.options.useMasterKey)&&_type.isString(f)&&0<f.length?n=f:_type.isString(c.options.apikey)&&(n=c.options.apikey);c.headers.push({key:"ak",value:n})}else c.headers.push({key:"as",value:d});n=_type.isString(c.options.userToken)&&
0<c.options.userToken.length?c.options.userToken:!1;if(!0===g||n){var p=-1,k=c.headers.filter(function(b,c){return"ut"==b.key?(p=c,!0):!1});if(c.options.ignoreUserToken)-1!=p&&c.headers.splice(p,1);else{var t=n||h;1==k.length?c.headers.forEach(function(b){"ut"==b.key&&(b.value=t)}):c.headers.push({key:"ut",value:t})}}}});this.setUserAuthHeader=function(c,f,d){try{c&&(g=!0,h=c,d||(f||(f=-1),-1==f&&(f=null),b.localStorage.set("Appacitive-UserToken",c),b.localStorage.set("Appacitive-UserTokenExpiry",
f),b.localStorage.set("Appacitive-UserTokenDate",(new Date).getTime())))}catch(e){}};this.incrementExpiry=function(){try{b.runtime.isBrowser&&g&&b.localStorage.set("Appacitive-UserTokenDate",(new Date).getTime())}catch(c){}};this.removeUserAuthHeader=function(c,f){var d=b.Promise.buildPromise(f);c||b.User.trigger("logout",{});b.localStorage.remove("Appacitive-User");if(h&&c)try{var e=new b.HttpRequest(f);e.url=b.config.apiBaseUrl+b.storage.urlFactory.user.getInvalidateTokenUrl(h);e.method="POST";
e.data={};e.type="user";e.options=f;e.description="InvalidateToken user";e.onSuccess=e.onError=function(){g=!1;h=null;b.User.trigger("logout",{});b.localStorage.remove("Appacitive-UserToken");b.localStorage.remove("Appacitive-UserTokenExpiry");b.localStorage.remove("Appacitive-UserTokenDate");d.fulfill()};b.http.send(e);return d}catch(n){}else return g=!1,h=null,b.localStorage.remove("Appacitive-UserToken"),b.localStorage.remove("Appacitive-UserTokenExpiry"),b.localStorage.remove("Appacitive-UserTokenDate"),
d.fulfill()};this.isSessionValid=function(b){if(b.status){if(b.status.code&&("420"==b.status.code||"19027"==b.status.code||"19002"==b.status.code))return{status:!1,isSession:"19027"==b.status.code||"420"==b.status.code?!0:!1}}else if(b.code&&("420"==b.code||"19027"==b.code||"19002"==b.code))return{status:!1,isSession:"19027"==b.code||"420"==b.code?!0:!1};return{status:!0}};this.resetSession=function(){d=null;this.useApiKey=!0};this.get=function(){return d};this.setSession=function(b){b&&(d=b,this.useApiKey=
!1)};this.setApiKey=function(b){b&&(e=b,this.useApiKey=!0)};this.setMasterKey=function(b){f=b};this.reset=function(){this.removeUserAuthHeader();h=e=d=null;g=!1;f=null;this.useMasterKey=this.useApiKey=this.initialized=!1};var n="sandbox";this.environment=function(){if(1==arguments.length){var b=arguments[0];"sandbox"!=b&&"live"!=b&&(b="sandbox");n=b}return n}};b.getAppPrefix=function(c){return b.Session.environment()+"/"+b.appId+"/"+c};b.ping=function(c){if(!b.Session.initialized)throw Error("Initialize Appacitive SDK");
var d=new b._Request({method:"GET",type:"ping",op:"getPingUrl",options:c,onSuccess:function(b){return d.promise.fulfill(b.status)}});return d.send()};b.initialize=function(c){c=c||{};if(!b.Session.initialized){c.masterKey&&0<c.masterKey.length&&b.Session.setMasterKey(c.masterKey);if(!c.apikey||0===c.apikey.length)if(c.masterKey)c.apikey=c.masterKey;else throw Error("apikey is mandatory");if(!c.appId||0===c.appId.length)throw Error("appId is mandatory");b.Session.setApiKey(c.apikey);b.Session.environment(c.env||
"sandbox");b.useApiKey=!0;b.appId=c.appId;b.Session.initialized=!0;b.Session.persistUserToken=c.persistUserToken;c.debug&&(b.config.debug=!0);_type.isFunction(c.apiLog)&&(b.logs.apiLog=c.apiLog);_type.isFunction(c.apiErrorLog)&&(b.logs.apiErrorLog=c.apiErrorLog);_type.isFunction(c.exceptionLog)&&(b.logs.exceptionLog=c.exceptionLog);if(c.userToken)if(-1==c.expiry?c.expiry=null:c.expiry||(c.expiry=845E4),b.Session.setUserAuthHeader(c.userToken,c.expiry),c.user)b.Users.setCurrentUser(c.user);else{var d=
b.localStorage.get("Appacitive-User");d&&b.Users.setCurrentUser(d)}else if(b.runtime.isBrowser&&(c=b.localStorage.get("Appacitive-UserToken"))){var e=b.localStorage.get("Appacitive-UserTokenExpiry"),d=b.localStorage.get("Appacitive-UserTokenDate");e||(e=-1);d&&0<e&&new Date(d+1E3*e)<new Date||(-1==e&&(e=null),(d=b.localStorage.get("Appacitive-User"))&&b.Users.setCurrentUser(d,c,e))}}};b.reset=function(){b.Session.reset()}})(global);
(function(g){var b=g.Appacitive;b&&b.http&&(b.http.addProcessor({pre:function(c){var d=b.Session.environment();c.options=c.options||{};_type.isString(c.options.env)&&(d=c.options.env);c.headers.push({key:"e",value:d})}}),b.Events.mixin(b))})(global);
(function(g){var b=g.Appacitive;b.GeoCoord=function(c,f){var h=function(b,c){if(isNaN(b)||isNaN(c))throw Error("Invalid Latitiude or longitiude provided");if(-90>b||90<b)throw Error("Latitude "+b+" should be in range of  -90.0 to 90.");if(-180>c||180<c)throw Error("Latitude "+c+" should be in range of  -180.0 to 180.");},d=function(c){if("string"!==typeof c||0==c.length)return!1;c=c.split(",");if(2!==c.length)return!1;try{return new b.GeoCoord(c[0],c[1])}catch(f){return!1}};if(_type.isString(c)&&
!f&&(d=d(c)))return d;c&&f?(h(c,f),this.lat=c,this.lng=f):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",c,f)};this.toString=function(){return this.getValue()}};var c=function(){this.toString=function(){};this.Or=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new p(k.or,b)};this.And=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new p(k.and,
b)}},d=function(b){c.call(this);b=b||{};this.fieldType=b.fieldType;this.field=b.field||"";this.value=b.value;this.operator=b.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue())}};d.prototype=new c;d.prototype.constructor=d;var e=function(b){b=b||"";
if(!_type.isArray(b.value)||!b.value.length)throw Error("Specify field value as array");d.call(this,b);var c=function(b){return _type.isString(b)?"'"+b+"'":_type.isNumber(b)?b:b.toString()};this.toString=function(){for(var b=[],f=0;f<this.value.length;f+=1)b.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,c(this.value[f])));return"("+b.join(" or ")+")"}};e.prototype=new d;e.prototype.constructor=e;var h=function(b){b=b||"";if(!_type.isArray(b.value)||
!b.value.length)throw Error("Specify field value as array");d.call(this,b);this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.toString())}};h.prototype=new d;h.prototype.constructor=h;var l=function(b){d.call(this,b||"");this.toString=function(){return String.format("{0}{1} {2}",this.getFieldType(),this.field.toLowerCase(),this.operator)}};l.prototype=new d;l.prototype.constructor=l;var f=function(b){b=b||"";if(!b.val1)throw Error("Specify field value1 ");
if(!b.val2)throw Error("Specify field value2 ");this.val1=b.val1;this.val2=b.val2;d.call(this,b);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};f.prototype=new d;f.prototype.constructor=f;var n=function(c){c=c||"";if(!(c.geoCoord&&c.geoCoord instanceof b.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");d.call(this,
c);this.value=c.geoCoord;this.unit=c.unit||"mi";this.distance=c.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};n.prototype=new d;n.prototype.constructor=f;var q=function(b){b=b||"";if(!b.geoCoords||0===b.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");if(3>b.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");
d.call(this,b);this.value=b.geoCoords;var c=function(b){var c="";b.forEach(function(b){c=0===c.length?b.toString():c+(" | "+b.toString())});return c};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,c(this.value))}};q.prototype=new d;q.prototype.constructor=f;var r=function(b){c.call(this);b=b||{};if(!b.tags||!_type.isArray(b.tags)||0===b.tags.length)throw Error("Specify valid tags");this.tags=b.tags;this.operator=b.operator;
this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};r.prototype=new c;r.prototype.constructor=r;var p=function(b,f){if(!f||!f.length||2>f.length)throw Error("Provide valid or atleast 2 filters");this.operator=b;this.innerFilters=[];for(var h=0;h<f.length;h+=1){if(!(f[h]instanceof c))throw Error("Invalid filter provided");this.innerFilters.push(f[h])}this.toString=function(){var b=this.operator,c="(";this.innerFilters.forEach(function(f){c=1===c.length?c+
(" "+f.toString()):c+String.format(" {0} {1} ",b,f.toString())});return c+=")"}};p.prototype=new c;p.prototype.constructor=p;var k={isEqualTo:"==",notEqualTo:"<>",isGreaterThan:">",isGreaterThanEqualTo:">=",isLessThan:"<",isLessThanEqualTo:"<=",like:"like",match:"match",between:"between",withinCircle:"within_circle",withinPolygon:"within_polygon",or:"or",and:"and",taggedWithAll:"tagged_with_all",taggedWithOneOrMore:"tagged_with_one_or_more",isNull:"is null",containedIn:"in",isNotNull:"is not null",
notIn:"not in"},t=function(c,f){if(null===c||void 0===c||0===c.length)throw Error("Specify value");this.value=c;this.type=f?f:typeof this.value;if("number"===this.type&&!_type.isNumeric(this.value))throw Error("Value should be numeric for filter expression");this.getValue=function(){return"number"===this.type||_type.isBoolean(this.value)||_type.isNumber(this.value)?this.value:"object"===this.type&&_type.isDate(this.value)?"datetime('"+b.Date.toISOString(this.value)+"')":"object"==this.type&&this.value instanceof
b.GeoCoord?c.toString():"'"+this.value.toString()+"'"}},y=function(b,c,g){g||(g=this);g.type=b;g.name=c;g.equalTo=function(b){return new d({field:this.name,fieldType:this.type,value:new t(b),operator:k.isEqualTo})};g.notEqualTo=function(b){return new d({field:this.name,fieldType:this.type,value:new t(b),operator:k.notEqualTo})};g.greaterThan=function(b){return new d({field:this.name,fieldType:this.type,value:new t(b),operator:k.isGreaterThan})};g.greaterThanEqualTo=function(b){return new d({field:this.name,
fieldType:this.type,value:new t(b),operator:k.isGreaterThanEqualTo})};g.lessThan=function(b){return new d({field:this.name,fieldType:this.type,value:new t(b),operator:k.isLessThan})};g.lessThanEqualTo=function(b){return new d({field:this.name,fieldType:this.type,value:new t(b),operator:k.isLessThanEqualTo})};g.like=function(b){return new d({field:this.name,fieldType:this.type,value:new t("*"+b+"*"),operator:k.like})};g.match=function(b){return new d({field:this.name,fieldType:this.type,value:new t("*"+
b+"*"),operator:k.match})};g.startsWith=function(b){return new d({field:this.name,fieldType:this.type,value:new t(b+"*"),operator:k.like})};g.endsWith=function(b){return new d({field:this.name,fieldType:this.type,value:new t("*"+b),operator:k.like})};g.contains=function(b){return new e({field:this.name,fieldType:this.type,value:b,operator:k.isEqualTo})};g.containedIn=function(b){return new h({field:this.name,fieldType:this.type,value:b,operator:k.containedIn})};g.isNull=function(){return new l({field:this.name,
fieldType:this.type,operator:k.isNull})};g.notIn=function(b){return new h({field:this.name,fieldType:this.type,value:b,operator:k.notIn})};g.isNotNull=function(){return new l({field:this.name,fieldType:this.type,operator:k.isNotNull})};g.between=function(b,c){return new f({field:this.name,fieldType:this.type,val1:new t(b),val2:new t(c),operator:k.between})};g.withinCircle=function(b,c,f){return new n({field:this.name,fieldType:this.type,geoCoord:b,distance:c,unit:f,operator:k.withinCircle})};g.withinPolygon=
function(b){return new q({field:this.name,fieldType:this.type,geoCoords:b,operator:k.withinPolygon})}},w=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;y("property",b,this);return this},u=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;var c=new y("aggregate",b);this.equalTo=function(b){return c.equalTo(b)};this.notEqualTo=function(b){return c.notEqualTo(b)};this.greaterThan=function(b){return c.greaterThan(b)};this.greaterThanEqualTo=
function(b){return c.greaterThanEqualTo(b)};this.lessThan=function(b){return c.lessThan(b)};this.lessThanEqualTo=function(b){return c.lessThanEqualTo(b)};this.between=function(b,f){return c.between(b,f)};this.contains=function(b){return c.contains(b)};return this},z=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;var c=new y("attribute",b);this.like=function(b){return c.like(b)};this.match=function(b){return c.match(b)};this.startsWith=function(b){return c.startsWith(b)};
this.endsWith=function(b){return c.endsWith(b)};this.equalTo=function(b){return c.equalTo(b)};this.contains=function(b){return c.contains(b)};return this};b.Filter={Property:function(b){return new w(b)},Aggregate:function(b){return new u(b)},Attribute:function(b){return new z(b)},Or:function(){return new p(k.or,arguments)},And:function(){return new p(k.and,arguments)},taggedWithOneOrMore:function(b){return new r({tags:b,operator:k.taggedWithOneOrMore})},taggedWithAll:function(b){return new r({tags:b,
operator:k.taggedWithAll})}}})(global);
(function(g){var b=g.Appacitive;b.Queries={};var c=function(b){b=b||{};var c=1,f=20;this.pageNumber=function(){return 1==arguments.length?(c=arguments[0]||1,this):c};this.pageSize=function(){return 1==arguments.length?(f=arguments[0]||20,this):f};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};c.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var d=function(b){b=b||{};var c=null,f=!1;this.orderBy=function(){return 1===arguments.length&&_type.isString(arguments[0])?
(c=arguments[0],this):c};this.isAscending=function(){return 1===arguments.length?(f=void 0===arguments[0]||null==arguments[0]?!1:arguments[0],this):f};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};d.prototype.toString=function(){return this.orderBy()&&0<this.orderBy().length?"orderBy="+this.orderBy()+"&isAsc="+this.isAscending():""};var e=function(h){var e=h||{},f="",g="",q="",r=e.queryType||"BasicQuery",p=new c(h),k=new d(h),t=e.type||e.relation,y=e.relation?"connection":"object",w=this;
e.entity&&(this.entity=e.entity);this.type=function(){return y};this.entityType=function(){return t};this.queryType=function(){return r};this.pageQuery=function(){return p};this.pageNumber=function(){return 1===arguments.length?(p.pageNumber(arguments[0]),this):p.pageNumber()};this.pageSize=function(){return 1===arguments.length?(p.pageSize(arguments[0]),this):p.pageSize()};this.sortQuery=function(){return k};this.orderBy=function(){return 1===arguments.length?(k.orderBy(arguments[0]),this):k.orderBy()};
this.isAscending=function(){return 1===arguments.length?(k.isAscending(arguments[0]),this):k.isAscending()};this.filter=function(){return 1===arguments.length?(f=arguments[0],this):f};this.freeText=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?g=arguments[0]:_type.isArray(b)&&b.length&&(g=arguments[0].join(" "));return this}return g};this.fields=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?q=b:_type.isArray(b)&&b.length&&(q=b.join(","));return this}return q};
this.filter(e.filter||"");this.freeText(e.freeText||"");this.fields(e.fields||"");this.setFilter=function(b){this.filter(b)};this.setFreeText=function(b){this.freeText(b)};this.setFields=function(b){this.fields(b)};this.extendOptions=function(b){for(var f in b)e[f]=b[f];p=new c(e);k=new d(e);return this};this.getQueryString=function(){var b=p.toString(),c=k.toString();c&&(b+="&"+c);this.filter()&&(c=encodeURIComponent(this.filter().toString()),0<c.trim().length&&(b+="&query="+c));this.freeText()&&
0<this.freeText().trim().length&&(b+="&freetext="+encodeURIComponent(this.freeText())+"&language=en");this.fields()&&0<this.fields().trim().length&&(b+="&fields="+this.fields());return b};this.toUrl=function(){return{url:b.config.apiBaseUrl+y+"/"+t+"/find/all?"+this.getQueryString(),description:"FindAll "+t+" "+y+"s"}};this.toRequest=function(c){var f=new b.HttpRequest,h=this.toUrl();f.url=h.url;f.options=c;f.description=h.description;f.method="get";return f};this.getOptions=function(){var b={},c;
for(c in this)this.hasOwnProperty(c)&&!_type.isFunction(this[c])&&(b[c]=this[c]);return b};this._setPaging=function(b){b&&(p.pageNumber(b.pagenumber),p.pageSize(b.pagesize),this.results=this.results||[],this.results.isLastPage=!1,this.results.total=b.totalrecords,this.results.pageNumber=b.pagenumber,this.results.pageSize=b.pagesize,b.pagenumber*b.pagesize>=b.totalrecords&&(this.results.isLastPage=!0))};this.fetch=function(c){var f=b.Promise.buildPromise(c);c=this.toRequest(c);c.onSuccess=function(c){var h;
(h=c[y+"s"])||(h=[]);h=b["object"===y?"Object":"Connection"]._parseResult(h,e.entity,c.__meta);w.results=h;w._setPaging(c.paginginfo);f.fulfill(w.results,c.paginginfo)};c.promise=f;c.entity=this;return b.http.send(c)};this.collection=function(c,f){f=f||{};_type.isObject(c)&&(f=c,c=null);c||(c=this.results?this.results:[]);var h=e.entity;!h&&0<c.length&&c[0]instanceof b.BaseObject&&(h="object"==c[0].type?"Object":"Connection",h=b[h]._getClass(c[0].className));h||(h="object"===y?"Object":"Connection",
h=b[h]._getClass(this[h]));return new b.Collection(c,_extend(f,{model:h,query:this}))};this.fetchNext=function(b){var c=this.pageNumber();this.pageNumber(++c);return this.fetch(b)};this.fetchPrev=function(b){var c=this.pageNumber();--c;0>=c&&(c=1);this.pageNumber(c);return this.fetch(b)};this.count=function(c){var f=b.Promise.buildPromise(c);c=this.toRequest(c);c.onSuccess=function(b){b=b||{};b=b.paginginfo;var c=0,c=b?b.totalrecords:0;f.fulfill(c)};c.promise=f;c.entity=this;return b.http.send(c)}};
b.Queries.FindAllQuery=function(b){b=b||{};if(!b.type&&!b.relation)throw Error("Specify either type or relation for basic filter query");b.queryType="FindAllQuery";e.call(this,b);return this};b.Queries.FindAllQuery.prototype=new e;b.Queries.FindAllQuery.prototype.constructor=b.Queries.FindAllQuery;b.Query=b.Queries.FindAllQuery;b.Queries.ConnectedObjectsQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for connected objects query");if(!c.objectId)throw Error("Specify objectId for connected objects query");
if(!c.type)throw Error("Specify type of object id for connected objects query");var d=c.type;delete c.type;c.queryType="ConnectedObjectsQuery";e.call(this,c);this.objectId=c.objectId;this.relation=c.relation;this.type=d;c.object instanceof b.Object&&(this.object=c.object);this.returnEdge=!0;void 0===c.returnEdge||null===c.returnEdge||c.returnEdge||(this.returnEdge=!1);this.label="";var f=this;_type.isString(c.label)&&0<c.label.length&&(this.label="&label="+c.label);this.toUrl=function(){return{url:b.config.apiBaseUrl+
"connection/"+this.relation+"/"+this.type+"/"+this.objectId+"/find?"+this.getQueryString()+this.label+"&returnEdge="+this.returnEdge,description:"GetConnectedObjects for relation "+this.relation+" of type "+this.type+" for object "+this.objectId}};var g=function(c,h,d,e){var g=[];c.forEach(function(c){var f=c.__edge;delete c.__edge;var q=b.Object._create(_extend({__meta:d},c),!0);f&&(f.__endpointa=h,f.__endpointb={objectid:c.__id,label:f.__label,type:c.__type},delete f.label,q.connection=b.Connection._create(_extend({__meta:e},
f),!0));g.push(q)});f.object&&(f.object.children[f.relation]=g);return g};this.fetch=function(e){var r=b.Promise.buildPromise(e);e=this.toRequest(e);e.onSuccess=function(b){f.results=g(b.nodes?b.nodes:[],{objectid:c.objectId,type:d,label:b.parent},b.__nodemeta,b.__edgemeta);f._setPaging(b.paginginfo);r.fulfill(f.results,b.paginginfo)};e.promise=r;e.entity=this;return b.http.send(e)};return this};b.Queries.ConnectedObjectsQuery.prototype=new e;b.Queries.ConnectedObjectsQuery.prototype.constructor=
b.Queries.ConnectedObjectsQuery;b.Queries.GetConnectionsQuery=function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!c.objectId)throw Error("Specify objectId for GetConnectionsQuery query");if(!c.label||0===c.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");c.type&&delete c.type;c.queryType="GetConnectionsQuery";e.call(this,c);this.objectId=c.objectId;this.relation=c.relation;this.label=c.label;this.toUrl=function(){return{url:b.config.apiBaseUrl+
"connection/"+this.relation+"/find/all?"+this.getQueryString()+"&objectid="+this.objectId+"&label="+this.label,description:"FindAllConnections for relation "+this.relation+" from object id "+this.objectId}};return this};b.Queries.GetConnectionsQuery.prototype=new e;b.Queries.GetConnectionsQuery.prototype.constructor=b.Queries.GetConnectionsQuery;b.Queries.GetConnectionsBetweenObjectsQuery=function(c,d){c=c||{};delete c.entity;if(!c.objectAId||!_type.isString(c.objectAId)||0===c.objectAId.length)throw Error("Specify valid objectAId for GetConnectionsBetweenObjectsQuery query");
if(!c.objectBId||!_type.isString(c.objectBId)||0===c.objectBId.length)throw Error("Specify objectBId for GetConnectionsBetweenObjectsQuery query");c.type&&delete c.type;c.queryType=d||"GetConnectionsBetweenObjectsQuery";e.call(this,c);this.objectAId=c.objectAId;this.objectBId=c.objectBId;this.label="GetConnectionsBetweenObjectsForRelationQuery"===this.queryType()&&c.label&&_type.isString(c.label)&&0<c.label.length?"&label="+c.label:"";this.relation=c.relation&&_type.isString(c.relation)&&0<c.relation.length?
c.relation+"/":"";this.toUrl=function(){return{url:b.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.objectAId+"/"+this.objectBId+"?"+this.getQueryString()+this.label,description:"FindConnectionBetween for relation "+this.relation+" between object ids "+this.objectAId+" and "+this.objectBId}};return this};b.Queries.GetConnectionsBetweenObjectsQuery.prototype=new e;b.Queries.GetConnectionsBetweenObjectsQuery.prototype.constructor=b.Queries.GetConnectionsBetweenObjectsQuery;b.Queries.GetConnectionsBetweenObjectsForRelationQuery=
function(c){c=c||{};if(!c.relation)throw Error("Specify relation for GetConnectionsBetweenObjectsForRelationQuery query");var d=new b.Queries.GetConnectionsBetweenObjectsQuery(c,"GetConnectionsBetweenObjectsForRelationQuery");d.fetch=function(f){var e=b.Promise.buildPromise(f);f=this.toRequest(f);f.onSuccess=function(f){d.results=f.connection?[b.Connection._create(_extend({__meta:f.__meta},f.connection),!0,c.entity)]:null;e.fulfill(d.results?d.results[0]:null)};f.promise=e;f.entity=this;return b.http.send(f)};
return d};b.Queries.InterconnectsQuery=function(c){c=c||{};delete c.entity;if(!c.objectAId||!_type.isString(c.objectAId)||0===c.objectAId.length)throw Error("Specify valid objectAId for InterconnectsQuery query");if(!(c.objectBIds&&_type.isArray(c.objectBIds)&&0<c.objectBIds.length))throw Error("Specify list of objectBIds for InterconnectsQuery query");c.type&&delete c.type;c.queryType="InterconnectsQuery";e.call(this,c);this.objectAId=c.objectAId;this.objectBIds=c.objectBIds;this.toRequest=function(c){var f=
new b.HttpRequest,d=this.toUrl();f.url=d.url;f.options=c;f.description=d.description;f.method="post";f.data={object1id:this.objectAId,object2ids:this.objectBIds};return f};this.toUrl=function(){return{url:b.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString(),description:"GetInterConnections between objects"}};return this};b.Queries.InterconnectsQuery.prototype=new e;b.Queries.InterconnectsQuery.prototype.constructor=b.Queries.InterconnectsQuery;b.Queries.GraphQuery=function(c,d){if(!c||
0===c.length)throw Error("Specify name of filter query");this.name=c;this.data={};this.queryType="GraphFilterQuery";if(d){this.data.placeholders=d;for(var f in this.data.placeholders)this.data.placeholders[f]=this.data.placeholders[f]}this.toRequest=function(c){var f=new b.HttpRequest,d=this.toUrl();f.url=d.url;f.options=c;f.description=d.description;f.method="post";f.data=this.data;return f};this.toUrl=function(){return{url:b.config.apiBaseUrl+"search/"+this.name+"/filter",description:"Filter Query with name "+
this.name}};this.fetch=function(c){var f=b.Promise.buildPromise(c);c=this.toRequest(c);c.onSuccess=function(b){f.fulfill(b.ids?b.ids:[])};c.promise=f;c.entity=this;return b.http.send(c)}};b.Queries.GraphAPI=function(c,d,f){if(!c||0===c.length)throw Error("Specify name of project query");if(!d||!d.length)throw Error("Specify ids to project");this.name=c;this.data={ids:d};this.queryType="GraphProjectQuery";var e=this;if(f){this.data.placeholders=f;for(var g in this.data.placeholders)this.data.placeholders[g]=
this.data.placeholders[g]}this.toRequest=function(c){var f=new b.HttpRequest,d=this.toUrl();f.url=d.url;f.description=d.description;f.method="post";f.data=this.data;f.options=c;return f};this.toUrl=function(){return{url:b.config.apiBaseUrl+"search/"+this.name+"/project",description:"Project Query with name "+this.name}};var r=function(c){var f,d;for(d in c)if("status"!==d){f=c[d];break}var h=function(c,f,d,e,g){var k=[];c.forEach(function(c){var q=c.__children;delete c.__children;var n=c.__edge;delete c.__edge;
c=b.Object._create(_extend({__meta:e},c),!0);c.children={};for(var r in q)c.children[r]=[],c.children[r]=h(q[r].values,q[r].parent,c.id,q[r].__nodemeta,q[r].__edgemeta);n&&(n.__endpointa={objectid:d,label:f},n.__endpointb={objectid:c.id,label:n.__label},delete n.__label,c.connection=b.Connection._create(_extend({__meta:g},n),!0));k.push(c)});return k};return h(f.values,null,null,f.__nodemeta)};this.collection=function(c,f){f=f||{};_type.isObject(c)&&(f=c,c=null);c||(c=this.results?ths.results:[]);
var d;0<c.length&&c[0]instanceof b.BaseObject&&(d=b.Object._getClass(c[0].className));return new b.Collection(c,_extend(f,{model:d,query:this}))};this.fetch=function(c){var f=b.Promise.buildPromise(c);c=this.toRequest(c);c.onSuccess=function(b){e.results=r(b);f.fulfill(e.results)};c.promise=f;c.entity=this;return b.http.send(c)}}})(global);
(function(g){var b=g.Appacitive,c=["__link","__endpointa","__endpointb"],d={__utcdatecreated:"datetime",__utclastupdateddate:"datetime"},e=function(b){return _type.isString(b)||_type.isNumber(b)||_type.isBoolean(b)},h=function(c){return e(c)||_type.isDate(c)||c instanceof b.GeoCoord},l=function(b){b=b||{};var c={},f;for(f in b.__meta)b.__meta[f].forEach(function(b){c[b]=f});return c},f={integer:function(b){if(b){var c=parseInt(b);if(!isNaN(c))return c}return b},decimal:function(b){if(b){var c=parseFloat(b);
if(!isNaN(c))return c}return b},"boolean":function(b){return _type.isBoolean(b)?b:void 0!==b&&null!==b&&("true"===b.toString().toLowerCase()||!0===b||0<b)?!0:!1},date:function(c){if(_type.isDate(c))return c;if(c){var f=b.Date.parseISODate(c);if(f)return f}return c},datetime:function(c){if(_type.isDate(c))return c;if(c){var f=b.Date.parseISODate(c);if(f)return f}return c},time:function(c){if(_type.isDate(c))return c;if(c){var f=b.Date.parseISOTime(c);if(f)return f}return c},string:function(b){return b?
b.toString():b},geocode:function(c){if(c instanceof b.GeoCoord)return c;if(!_type.isString(c)||0==c.trim().length)return!1;c=c.split(",");return 2!==c.length?!1:new b.GeoCoord(c[0],c[1])}};f["long"]=f.integer;f.geography=f.geocode;f.text=f.string;f.bool=f["boolean"];b.cast=f;var n=function(c){return _type.isNullOrUndefined(c)?null:e(c)?c+"":_type.isDate(c)?b.Date.toISOString(c):_type.isObject(c)?c instanceof b.GeoCoord?c.toString():c.getObject?c.getObject():c:c};b._encode=function(b){var c={},f;for(f in b){var d=
b[f];_type.isArray(d)?(c[f]=[],d.forEach(function(b){(b=n(b))&&c[f].push(b)})):c[f]=n(b[f])}return c};b._decode=function(b){var c={},h=_extend({},d,l(b));delete b.__meta;for(var e in b)_type.isArray(b[e])?(c[e]=[],b[e].forEach(function(b){b=h[e]?f[h[e]](b):b;c[e].push(b)})):_type.isString(b[e])?c[e]=h[e]?f[h[e]](b[e]):b[e]:c[e]=b[e];return c};g=function(d,e){var g={};e=e||{};d=d||{};d=_deepExtend({},d);this.meta={};d.__meta=_extend(this.meta,d.__meta);e&&e.parse&&(d=this.parse(d));_type.isObject(this.defaults)&&
!e.setSnapShot&&(d=_deepExtend({},this.defaults,d));e&&e.collection&&(this.collection=e.collection);d=b._decode(d);var k=this,n=function(c,f){c.__meta=_extend(k.meta,c.__meta);k.meta=c.__meta;l(c);var d=b._decode(c),e;for(e in d)e==k.idAttribute&&(k.id=d[e]),w[e]&&delete w[e],u[e]&&delete u[e],z[e]&&delete z[e],h(d[e])?f[e]=d[e]:_type.isObject(d[e])?f[e]=_deepExtend({},f[e],d[e]):_type.isArray(d[e])?(f[e]=[],d[e].forEach(function(b){if(h(b)||"__link"==e)f[e].push(b);else throw Error("Multivalued property cannot add object or array as property of object");
})):f[e]=d[e]},l=function(c,f){var d={id:"id",__id:"id",__utclastupdateddate:"lastUpdatedAt",__utcdatecreated:"createdAt",__createdby:"createdBy",__updatedby:"lastUpdatedBy"};"id __id __utclastupdateddate __utcdatecreated __createdby __updatedby".split(" ").forEach(function(e){c[e]&&("__utcdatecreated"!==e&&"__utclastupdateddate"!==e||_type.isDate(c[e])?k[d[e]]=c[e]:k[d[e]]=b.Date.parseISODate(c[e]),f&&delete c[e])})};this.base=b.Object.prototype;this.cid=parseInt(1E8*Math.random(),10);this.idAttribute=
"__id";var w={},u={},z={},x={};n(d,x);var m=x;e.setSnapShot&&n(m,g);!g[this.idAttribute]&&x[this.idAttribute]&&(g[this.idAttribute]=x[this.idAttribute]);this.id=g[this.idAttribute];x.__type?(x.__type=x.__type.toLowerCase(),this.entityType="type",this.type="object",this.className=x.__type):x.__relationtype&&(x.__relationtype=x.__relationtype.toLowerCase(),this.entityType="relation",this.type="connection",this.className=x.__relationtype);m.__attributes||(m.__attributes={});g.__attributes||(g.__attributes=
{});var v=[];m.__tags||(m.__tags=[]);g.__tags||(g.__tags=[]);this.attributes=m;var A="";l(this.attributes);var E="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __type __relationtype __typeid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link __acls __meta".split(" "),F=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";return b};this.getObject=function(){var c=b._encode(_deepExtend({__meta:this.meta},m));"connection"==k.type&&
(c.__endpointa=m.__endpointa.toJSON(),c.__endpointb=m.__endpointb.toJSON());Object.prototype.hasOwnProperty("id")&&(c.__id=this.id);return c};var M=function(){var b=_deepExtend({__meta:this.meta},m);"connection"==k.type&&(m.__endpointa=m.__endpointa.toJSON(),m.__endpointb=m.__endpointb.toJSON());this.hasOwnProperty("id")&&this.id&&(b.__id=this.id);return b};this.toJSON=function(b){if(b&&"object"==this.type){var c=function(b){var f=[];b.forEach(function(b){var d=b.toJSON();if(b.children&&!Object.isEmpty(b.children)){d.children=
{};for(var e in b.children)_type.isArray(b.children[e])?d[e]=c(b.children[e]):d[e]=c([b.children[e]])[0],d.children[e]=d[e]}b.connection&&(d.__connection=b.connection.toJSON());f.push(d)});return f};return c([this])[0]}return M.apply(this)};this.properties=function(){var b=_deepExtend({},this.attributes);delete b.__attributes;delete b.__tags;return b};this.attr=function(){if(0===arguments.length)return m.__attributes||(m.__attributes={}),m.__attributes;if(1===arguments.length)return m.__attributes||
(m.__attributes={}),m.__attributes[arguments[0]];if(2===arguments.length){if(!_type.isString(arguments[1])&&null!==arguments[1])throw Error("only string values can be stored in attributes.");m.__attributes||(m.__attributes={});m.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");B("__attributes");return m.__attributes};var G=function(){if(m.__attributes){if(!g.__attributes)return m.__attributes;var b=!1,c=JSON.parse(JSON.stringify(g.__attributes)),
f;for(f in m.__attributes)null==m.__attributes[f]||void 0==m.__attributes[f]?(c[f]=null,b=!0):m.__attributes[f]!=g.__attributes[f]?(c[f]=m.__attributes[f],b=!0):m.__attributes[f]==g.__attributes[f]&&delete c[f];return b?c:void 0}};this.getChangedAttributes=G;this.aggregate=function(){var b={},c;for(c in m){if(!m.hasOwnProperty(c))return;"$"==c[0]&&(b[c.substring(1)]=m[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");
};this.tags=function(){return m.__tags?m.__tags:[]};this.addTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;m.__tags||(m.__tags=[]);m.__tags.push(b);m.__tags=Array.distinct(m.__tags);if(!v||!v.length)return B("__tags"),this;b=v.indexOf(b);-1!=b&&v.splice(b,1);B("__tags");return this};this.removeTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;v.push(b);v=Array.distinct(v);if(!m.__tags||!m.__tags.length)return B("__tags"),this;b=m.__tags.indexOf(b);-1!=b&&m.__tags.splice(b,
1);B("__tags");return this};var H=function(){if(m.__tags){if(!g.__tags)return m.__tags;var b=[];m.__tags.forEach(function(c){-1==g.__tags.indexOf(c)&&b.push(c)});return 0<b.length?b:void 0}};this.getChangedTags=H;this.getRemovedTags=function(){return _removetags};var I=function(b,c,f,d){if(!b||!_type.isString(b)||0===b.length||0==b.trim().indexOf("__")||0===b.trim().indexOf("$")||void 0==c||null==c)return this;b=b.toLowerCase();try{var e=function(c){if(!h(c))throw Error("Multivalued property cannot have values of property as an object");
if(m[b]&&_type.isArray(m[b]))if("additems"==f)m[b].push(c);else if("adduniqueitems"==f){var d=-1;m[b].find(function(b,f){return _type.isEqual(b,c)?(d=f,!0):!1});-1==d&&m[b].push(c)}else"removeitems"==f&&m[b].removeAll(c);else m[b]="removeitems"==f?[]:[c];u[b]||(u[b]={additems:[],adduniqueitems:[],removeitems:[]});u[b][f].push(c)};_type.isArray(c)?c.forEach(function(b){e(b)}):e(c);B(b,d)}catch(g){throw Error("Unable to add item to "+b);}return k};this.add=function(b,c,f){return I.apply(this,[b,c,"additems",
f])};this.addUnique=function(b,c,f){return I.apply(this,[b,c,"adduniqueitems",f])};this.remove=function(b,c,f){return I.apply(this,[b,c,"removeitems",f])};var C=function(b,c,f,d){var e=void 0;_type.isEqual(f,c)||("__tags"==b?(b=H())&&0<b.length&&(e=b):"__attributes"==b?(b=G(),Object.isEmpty(b)||(e=b)):_type.isArray(f)?u[b]&&!z[b]?e=d?u[b]:f:f.equals(c)||(e=f):e=w[b]&&!z[b]?d?{incrementby:w[b].value}:f:f);return e},D=function(c){var f=!1,d=_deepExtend({},g),e;for(e in d)"$"==e[0]&&delete d[e];for(var h in m)e=
C(h,d[h],m[h],c),void 0==e?delete d[h]:(f=!0,d[h]=e);try{E.forEach(function(b){d[b]&&delete d[b]})}catch(n){}c&&(d=b._encode(d));h=H();c?(h&&0<h.length&&(d.__addtags=h,f=!0),v&&0<v.length&&(d.__removetags=v,f=!0)):h&&0<h.length&&(d.__tags=h,f=!0);(c=G())&&!Object.isEmpty(c)?(d.__attributes=c,f=!0):delete d.__attributes;"object"==k.type&&k._aclFactory&&(c=k._aclFactory.getChanged())&&(f=!0,d.__acls=c);return f&&!Object.isEmpty(d)?d:!1};this.changed=function(){return this.isNew()?this.toJSON():D()};
this.hasChanged=function(){return this.isNew()?!0:0===arguments.length?Object.isEmpty(D(!0))?!1:!0:1==arguments.length&&_type.isString(arguments[0])&&0<arguments[0].length?void 0==C(arguments[0])?!1:!0:!1};this.changedAttributes=function(){if(this.isNew())return this.toJSON();if(0===arguments.length)return D();if(1==arguments.length&&_type.isArray(arguments[0])&&arguments[0].length){var b={};arguments[0].forEach(function(c){c=C(c);void 0!=c&&b.push(c)});return b}return!1};this.previous=function(){return this.isNew()?
null:1==arguments.length&&_type.isString(arguments[0])&&arguments[0].length?g[arguments[0]]:null};this.previousAttributes=function(){return this.isNew()?null:_extend({},g)};this.fields=function(){if(1==arguments.length){var b=arguments[0];_type.isString(b)?A=b:_type.isArray(b)&&(A=b.join(","));return this}return A};this.get=function(b,c){if(b){if(c&&f[c.toLowerCase()]){if(f[c.toLowerCase()])return f[c.toLowerCase()](m[b]);throw Error('Invalid cast-type "'+c+'"" provided for get "'+b+'"');}return m[b]}};
this.tryGet=function(b,c,f){b=this.get(b,f);return void 0!==b?b:c};var B=function(b,c){if(c&&!c.silent){var f=C(b,g[b],m[b]);if(void 0!=f[b]||-1!=E.indexOf(b))k.trigger("change:"+b,k,f[b]||m[b],{}),c.ignoreChange||k.trigger("change",k,c)}},J=function(b){b&&!b.silent&&k.trigger("destroy",k,k.collection,b)};this._triggerError=function(b,c){b.silent||k.trigger("error",k,c,b)};var N=function(b,f,d){if(!b||!_type.isString(b)||0===b.length||0===b.trim().indexOf("$"))return this;b=b.toLowerCase();try{if(_type.isNullOrUndefined(f))m[b]=
null;else if(h(f))m[b]=f;else if(_type.isObject(f))if(-1!==c.indexOf(b))m[b]=f;else throw Error("Property cannot have value as an object");else _type.isArray(f)&&(m[b]=[],f.forEach(function(c){if(h(c))m[b].push(c);else throw Error("Multivalued property cannot have values of property as an object");}));delete w[b];delete u[b];delete z[b];_type.isEqual(m[b],g[b])||(z[b]=!0);b==k.idAttribute&&(k.id=f);return this}catch(e){throw Error("Unable to set "+b);}};this.set=function(b,c,f){var d,e;if(null==b)return this;
null==b||"object"===typeof b?(e=b,f=c):(e={})[b]=c;f||(f={});if(!this._validate(e,f))return!1;this.idAttribute in e&&(this.id=e[this.idAttribute]);l(e);var h=!1;for(d in e)c=e[d],N.apply(this,[d,c,_extend({},f,{ignoreChange:!0})]);if(f&&!f.silent)for(d in e)if(void 0!=C(d,g[d],m[d])||-1!=E.indexOf(d))h=!0,k.trigger("change:"+b,k,m[b],{});h&&this.trigger("change",this,f);return this};this.unset=function(b,c){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();
delete m[b];B(b,c);return this};this._validate=function(b,c){if(!c.validate||!this.validate||!_type.isFunction(this.validate))return!0;b=_extend({},this.attributes,b);var f=this.validationError=this.validate(b,c)||null;if(!f)return!0;this.trigger("invalid",this,f,_extend(c,{validationError:f}));return!1};this.isValid=function(b){return this._validate({},_extend(b||{},{validate:!0}))};this.has=function(b){return b&&_type.isString(b)&&0!==b.length?m[b]&&!_type.isUndefined(m[b])?!0:!1:!1};this.isNew=
function(){return!this.has(this.idAttribute)};this.clone=function(){return"object"==this.type?b.Object._create(_deepExtend({__meta:this.meta},this.getObject())):new b.connection._create(_deepExtend({__meta:this.meta},this.getObject()))};this.copy=function(b,c){b&&(n(b,m),c&&n(b,g));return this};this.mergeWithPrevious=function(){n(m,g);k._aclFactory&&k._aclFactory.merge();l(g);v=[];w={};u={};z={};return this};var K=function(){n(g,m);k._aclFactory&&k._aclFactory.merge();l(m);v=[];w={};u={};z={}};this.rollback=
function(){m=x={};K();return this};var L=function(b,c,f,d){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();if(_type.isObject(m[b])||_type.isArray(m[b]))throw Error("Cannot increment/decrement array/object");try{_type.isObject(c)?(d=c,c=f):c=!c||isNaN(Number(c))?f:Number(c)*f,m[b]=isNaN(Number(m[b]))?c:Number(m[b])+c,k.isNew()||(w[b]={value:(w[b]?w[b].value:0)+c})}catch(e){throw Error("Cannot perform increment/decrement operation");}B(b,d);return k};this.increment=
function(b,c,f){return L(b,c,1,f)};this.decrement=function(b,c,f){return L(b,c,-1,f)};this._findUnsavedChanges=function(){var b={object:null,isNested:!1};if(this.id)b.object=D(!0);else{var c=k.getObject();delete c.__meta;for(var f in c)"$"==f[0]&&delete c[f];c.__revision&&delete c.__revision;"object"==k.type&&k._aclFactory&&(f=k._aclFactory.getChanged())&&(c.__acls=f);c.__tags&&0==c.__tags.length&&delete c.__tags;Object.isEmpty(c.__attributes)&&delete c.__attributes;"connection"==k.type&&(c.__endpointa.objectid&&
delete c.__endpointa.object,c.__endpointb.objectid&&delete c.__endpointb.object);b.object=c}return b};this.getType=function(){var b=k.type;!m.__type||"user"!=m.__type.toLowerCase()&&"device"!=m.__type.toLowerCase()||(b=m.__type.toLowerCase());return b};this._parseOutput=function(c,f){var d=k.getType(),e;c=c||{};if(f&&f[d]){c&&c.parse&&(f[d]=this.parse(f[d]));var h=this.isNew(),n=!1;"connection"==k.type&&m.__endpointa&&f[d].__endpointa.label!=m.__endpointa.label&&(n=f[d].__endpointa,f[d].__endpointa=
f[d].__endpointb,f[d].__endpointb=n,n=!0);g=b._decode(_extend({__meta:_extend(k.meta,f.__meta)},f[d]));k.id=m[k.idAttribute]=f[d][k.idAttribute];K();h?("connection"==k.type&&(c._batch||(n?(m.__endpointa.object&&f.__bmeta&&(m.__endpointa.object.__meta=f.__bmeta),m.__endpointb.object&&f.__ameta&&(m.__endpointb.object.__meta=f.__ameta)):(m.__endpointa.object&&f.__ameta&&(m.__endpointa.object.__meta=f.__ameta),m.__endpointb.object&&f.__bmeta&&(m.__endpointb.object.__meta=f.__bmeta))),k.parseConnection(c._batch)),
k.trigger("change:__id",k,k.id,{}),b.eventManager.fire(k.entityType+"."+d+".created",k,{object:k}),k.created=!0):b.eventManager.fire(k.entityType+"."+d+"."+k.id+".updated",k,{object:k});c.silent||k.trigger("sync",k,f[d],c)}else f=f||{},f.status=f.status||{},e=F(f.status),k._triggerError(c,new b.Error(e)),k.isNew()?b.eventManager.fire(k.entityType+"."+d+".createFailed",k,{error:e}):b.eventManager.fire(k.entityType+"."+d+"."+k.id+".updateFailed",k,{object:e});return e};this._save=function(){return this.id?
O.apply(this,arguments):P.apply(this,arguments)};var P=function(c){c=c||{};var f=k.getType(),d=k._findUnsavedChanges(),e=new b._Request({method:"PUT",type:f,op:"getCreateUrl",args:[this.className,A],data:d.object,options:c,entity:k,onSuccess:function(b){(b=k._parseOutput(c,b))?e.promise.reject(b,k):e.promise.fulfill(k)}});return e.send()},O=function(c,f){b.Promise.is(f)||(f=b.Promise.buildPromise(c));var d=k._findUnsavedChanges();c=c||{};if(Object.isEmpty(d.object))f.fulfill(k);else{var e=k.type,
h=[k.className,k.id,A];m&&m.__type&&("user"==m.__type.toLowerCase()||"device"==m.__type.toLowerCase())&&(e=m.__type.toLowerCase(),h.splice(0,1));var g=new b._Request({method:"POST",type:e,op:"getUpdateUrl",args:h,data:d.object,options:c,entity:k,onSuccess:function(b){(b=k._parseOutput(c,b))?g.promise.reject(b,k):g.promise.fulfill(k)}});return g.send()}return f},Q=function(c){if(!k.id)throw Error("Please specify id for get operation");c=c||{};var f=k.getType(),d=new b._Request({method:"GET",type:f,
op:"getGetUrl",args:[this.className,k.id,A],options:c,entity:k,onSuccess:function(e){e&&e[f]?(c&&c.parse&&(e[f]=k.parse(e[f])),g=b._decode(_extend({__meta:_extend(k.meta,e.__meta)},e[f])),n(g,m),l(m),k._aclFactory&&k._aclFactory._rollback(),e.connection&&(k.endpoints||k.endpointA&&k.endpointB||k.setupConnection(m.__endpointa,m.__endpointb)),c.silent||k.trigger("sync",k,e[f],c),b.eventManager.fire(k.entityType+"."+f+"."+k.id+".fetched",k,{object:k}),d.promise.fulfill(k)):(e=e||{},e.status=e.status||
{},e.status=F(e.status),k._triggerError(c,new b.Error(e.status)),d.promise.reject(e.status,k))}});return d.send()};this._fetch=function(b){return Q.apply(this,[b])};this.del=this._destroy=function(c){c=c||{};var f=c.deleteConnections;_type.isBoolean(c)&&(f=c,c={});c.wait||J(c);if(!k.id)return(new b.Promise.buildPromise(c)).fulfill();var d=k.getType(),e=new b._Request({method:"DELETE",type:d,op:"getDeleteUrl",args:[this.className,k.id,f],options:c,entity:this,onSuccess:function(f){f&&f.status?(m={},
g={},c.wait&&J(c),e.promise.fulfill(f.status)):(f=f||{},f.status=f.status||{},f.status=F(f.status),k._triggerError(c,new b.Error(f.status)),e.promise.reject(f.status,k))}});return e.send()};"object"==this.type&&(this._destroyWithConnections=function(b){return this.destroy(_extend({deleteConnections:!0},b))})};g.prototype.save=function(){return this._save.apply(this,arguments)};g.prototype.fetch=function(){return this._fetch.apply(this,arguments)};g.prototype.destroy=function(){return this._destroy.apply(this,
arguments)};g.prototype.destroyWithConnections=function(){return this._destroyWithConnections.apply(this,arguments)};b.BaseObject=g;b.BaseObject._saveAll=function(c,f,d){var e=new b.Batch;f=f||{};if(!_type.isArray(c))throw Error("Provide an array of objects for Object.saveAll");c.forEach(function(c){c instanceof b.BaseObject||!_type.isObject(c)||(c=new b[this.className||d](c));e.add(c)});return e.execute(f)};b.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())};b.BaseObject.prototype.parse=
function(b,c){return b};b.BaseObject.prototype.escape=function(b){return _.escape(this.get(b))};b.Events.mixin(b.BaseObject.prototype)})(global);
(function(g){var b=function(){return Math.floor(65536*Math.random()).toString(16)};g.Appacitive.GUID=function(){var c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b(),d="",e,h,g,f,n,q,r=0,c=c.replace(/\r\n/g,"\n");h="";for(g=0;g<c.length;g++)f=c.charCodeAt(g),128>f?h+=String.fromCharCode(f):(127<f&&2048>f?h+=String.fromCharCode(f>>6|192):(h+=String.fromCharCode(f>>12|224),h+=String.fromCharCode(f>>6&63|128)),h+=String.fromCharCode(f&63|128));for(c=h;r<c.length;)e=c.charCodeAt(r++),h=c.charCodeAt(r++),
g=c.charCodeAt(r++),f=e>>2,e=(e&3)<<4|h>>4,n=(h&15)<<2|g>>6,q=g&63,isNaN(h)?n=q=64:isNaN(g)&&(q=64),d=d+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(q);return d.toString()}})(global);
(function(g){var b=g.Appacitive,c=["allow","deny"],d=["create","read","update","delete","manageaccess"],e=function(b){var c=[];b.forEach(function(b){_type.isString(b)&&-1!=d.indexOf(b.toLowerCase())&&c.push(b.toLowerCase())});return c};b._Acl=function(h,g){var f=h||[];_type.isArray(f)||(f=[]);var n={};g&&(n=JSON.parse(JSON.stringify(f)));this.acls=f=JSON.parse(JSON.stringify(f));var q=[],r=function(d,h,g,k){if(!g)throw Error("Specify valid user or usergroup");g instanceof b.Object&&"user"==g.typeName&&
!g.isNew()&&(g=g.id);var n=f.filter(function(b){return b.sid==g&&b.type==h});n&&0!=n.length?n=n[0]:(n={sid:g,type:h,deny:[],allow:[]},f.push(n));n.allow||(n.allow=[]);n.deny||(n.deny=[]);k=e(k);var l=q.filter(function(b){return b.sid==g&&b.type==h});l&&0!=l.length?l=l[0]:(l={sid:g,type:h},q.push(l));k.forEach(function(b){for(var f=0;f<c.length;f+=1){var e=n[c[f]].indexOf(b);if(-1!=e){n[c[f]].splice(e,1);break}}"dontcare"!=d&&n[d].push(b);l[b]=d});return this},p=function(b,c,f,d){if(!f)throw Error("Please provide valid id or name for setting acls");
if(!d)throw Error("Please provide valid access permissions for setting acls");_type.isArray(d)||(d=[d]);_type.isArray(f)?f.forEach(function(f){r(b,c,f,d)}):r(b,c,f,d);return this},k=function(){f.allowUser=function(b,c){return p.apply(this,["allow","user",b,c])};f.allowGroup=function(b,c){return p.apply(this,["allow","usergroup",b,c])};f.denyUser=function(b,c){return p.apply(this,["deny","user",b,c])};f.denyGroup=function(b,c){return p.apply(this,["deny","usergroup",b,c])};f.resetUser=function(b,c){return p.apply(this,
["dontcare","user",b,c])};f.resetGroup=function(b,c){return p.apply(this,["dontcare","usergroup",b,c])};f.allowAnonymous=function(b){return p.apply(this,["allow","usergroup",["anonymous"],b])};f.denyAnonymous=function(b){return p.apply(this,["deny","usergroup",["anonymous"],b])};f.resetAnonymous=function(b){return p.apply(this,["dontcare","usergroup",["anonymous"],b])};f.allowLoggedIn=function(b){return p.apply(this,["allow","usergroup",["anonymous"],b])};f.denyLoggedIn=function(b){return p.apply(this,
["deny","usergroup",["anonymous"],b])};f.resetLoggedIn=function(b){return p.apply(this,["dontcare","usergroup",["anonymous"],b])}};this._rollback=function(){q=[];f=JSON.parse(JSON.stringify(n));k();return this};this.toJSON=this.getChanged=function(){var b=[];q.forEach(function(f){var e={sid:f.sid,type:f.type,allow:[],deny:[],dontcare:[]};d.forEach(function(b){f[b]&&e[f[b]].push(b)});c.forEach(function(b){0==e[b].length&&delete e[b]});0==e.dontcare.length&&delete e.dontcare;b.push(e)});return 0==b.length?
null:b};this.merge=function(){q=[];return this};k();return this};b.Group=new function(){var c=function(c,f,d,e){if(!f||!_type.isString(f)||0===f.length)throw Error("Please specify valid groupname");_type.isArray(d)||(d=[d]);var h={};h[c]=[];d.forEach(function(f){f&&(f instanceof b.Object&&"user"==f.typeName&&!f.isNew()?h[c].push(f.id):_type.isString(f)&&h[c].push(f))});if(0==h[c].length)throw Error("Please specify valid members as second argument");var g=new b._Request({method:"POST",type:"usergroup",
op:"getUpdateUrl",args:[f],data:h,entity:this,options:e,onSuccess:function(b){g.promise.fulfill(b)}});return g.send()};this.addMembers=function(b,f,d){return c("add",b,f)};this.removeMembers=function(b,f,d){return c("remove",b,f)}}})(global);
(function(g){var b=g.Appacitive;b.Object=function(c,d){c=c||{};d=d||{};this.className&&(c.__type=this.className);_type.isString(c)&&(c={__type:c});if(!c.__type)throw Error("Cannot set object without __type");_type.isBoolean(d)&&(d={setSnapShot:!0});b.BaseObject.call(this,c,d);this.type="object";this.getObject=this.getObject;this.children={};this.typeName=c.__type;this._aclFactory=new b._Acl(d.__acls,d.setSnapShot);this.acls=this._aclFactory.acls;_type.isFunction(this.initialize)&&this.initialize.apply(this,
[c]);return this};b.Object.prototype=new b.BaseObject;b.Object.prototype.constructor=b.Object;b.Object.extend=function(d,e,f){_type.isObject(d)&&(f=e,e=d,d=e.typeName);if(!_type.isString(d)||0==d.length)throw Error("Appacitive.Object.extend's first argument should be the type-name.");var g=null;e=e||{};e.className=d;g=b._extend(b.Object,e,f);delete g.extend;g.className=d;g.type=d;return c[d]=g};var c={},d=function(d){if(!_type.isString(d))throw"_getClass requires a string argument.";var e=c[d];e||
(e=b.Object.extend(d),c[d]=e);return e};b.Object._getClass=d;b.Object._create=function(b,c,f){return(new (this.className?this:f?f:d(b.__type))(b)).copy(b,c)};var e=function(c,d,f){var e=[];c.forEach(function(c){c=b.Object._create(_extend(c,{__meta:f}),!0,d);e.push(c)});return e};b.Object._parseResult=e;b.Object.multiDelete=function(c,d){c=c||{};d=d||{};var f=[];this.className&&(c.type=this.className);_type.isArray(c)&&0<c.length&&(c[0]instanceof b.Object?(f=c,c={type:f[0].className,ids:f.map(function(b){return b.id}).filter(function(b){return b})}):
c={type:this.className,ids:c});if(!c.type||!_type.isString(c.type)||0===c.type.length)throw Error("Specify valid type");if("user"===c.type.toLowerCase()||"device"===c.type.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var e=new b._Request({method:"POST",data:{idlist:c.ids},type:"object",op:"getMultiDeleteUrl",args:[c.type],options:d,onSuccess:function(b){d&&!d.silent&&f.forEach(function(b){b.trigger("destroy",
b,b.collection,d)});e.promise.fulfill()}});return e.send()};b.Object.multiGet=function(c,d){c=c||{};d=d||{};_type.isArray(c)&&0<c.length&&(c=c[0]instanceof b.Object?{ids:c.map(function(b){return b.id}).filter(function(b){return b})}:{ids:c});this.className&&(c.type=this.className,c.entity=this);if(!c.type||!_type.isString(c.type)||0===c.type.length)throw Error("Specify valid type");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var f=new b._Request({method:"GET",type:"object",op:"getMultiGetUrl",
args:[c.type,c.ids.join(","),c.fields],options:d,onSuccess:function(b){f.promise.fulfill(e(b.objects,c.entity,b.__meta))}});return f.send()};b.Object.get=function(c,d){c=c||{};_type.isString(c)&&this.className&&(c={id:c});this.className&&(c.type=this.className,c.entity=this);if(!c.type)throw Error("Specify type");if(!c.id)throw Error("Specify id to fetch");var f=b.Object._create({__type:c.type,__id:c.id});f.fields=c.fields;return f.fetch(d)};b.Object.prototype.getConnections=function(c){if(this.isNew())throw Error("Cannot fetch connections for new object");
c.objectId=this.get("__id");return new b.Queries.GetConnectionsQuery(c)};b.Object.prototype.getConnectedObjects=function(c){if(this.isNew())throw Error("Cannot fetch connections for new object");c=c||{};_type.isString(c)&&(c={relation:c});c.type=this.get("__type");c.objectId=this.get("__id");c.object=this;return new b.Queries.ConnectedObjectsQuery(c)};b.Object.prototype.fetchConnectedObjects=b.Object.prototype.getConnectedObjects;b.Object.findAll=b.Object.findAllQuery=function(c){c=c||{};this.className&&
(c.type=this.className,c.entity=this);return new b.Queries.FindAllQuery(c)};b.Object.saveAll=function(c,d){return b.BaseObject._saveAll(c,d,"Object")}})(global);
(function(g){var b=g.Appacitive,c=function(c,d,e){var g={label:c.label};c.objectid&&(g.objectid=c.objectid);if(c.object)c.object instanceof b.Object?c.object.id&&(c.objectid=g.objectid=c.object.id):_type.isObject(c.object)&&(c.object.__id&&(c.objectid=g.objectid=c.object.__id),c.object=b.Object._create(c.object)),g.object=c.object.getObject();else if(!g.objectid&&!g.object)throw Error("Incorrectly configured endpoints provided to parseConnection");g.toJSON=function(){var b=_extend({},this);if(b.object&&
(b.object=c.object.toJSON(),c.object._aclFactory)){var d=c.object._aclFactory.toJSON();d&&(b.object.__acls=d)}delete b.toJSON;return b};e["endpoint"+d]=c;return g},d=function(c,d,e,g){c.object&&_type.isObject(c.object)?(g||(e["endpoint"+d]?e["endpoint"+d]&&e["endpoint"+d].object&&e["endpoint"+d].object instanceof b.Object?e["endpoint"+d].object.copy(c.object,!0):e["endpoint"+d].object=b.Object._create(c.object,!0):(e["endpoint"+d]={},e["endpoint"+d].object=b.Object._create(c.object,!0)),e["endpoint"+
d]._aclFactory&&e["endpoint"+d]._aclFactory.merge(),g=e["endpoint"+d].object,g.trigger("change:__id",g,g.id,{})),e["endpoint"+d].objectid=c.objectid||c.object.__id,e["endpoint"+d].label=c.label,e["endpoint"+d].type=c.type):e["endpoint"+d]=c;c.toJSON=function(){var b=_extend({},this);if(b.object&&(b.object=e["endpoint"+d].object.toJSON(),e["endpoint"+d].object._aclFactory)){var c=e["endpoint"+d].object._aclFactory.toJSON();c&&(b.object.__acls=c)}delete b.toJSON;return b}};b.Connection=function(c,e){c=
c||{};e=e||{};this.className&&(c.__relationtype=this.className);_type.isString(c)&&(c={__relationtype:c});if(!c.__relationtype&&!c.relation)throw Error("Cannot set connection without relation");c.relation&&(c.__relationtype=c.relation,delete c.relation);_type.isBoolean(e)&&(e={setSnapShot:!0});c.endpoints&&2===c.endpoints.length&&(c.__endpointa=c.endpoints[0],c.__endpointb=c.endpoints[1],delete c.endpoints);b.BaseObject.call(this,c,e);this.type="connection";this.getConnection=this.getObject;this.parseConnection=
function(b){var e="A",g="B";c.__endpointa.label.toLowerCase()!==this.get("__endpointb").label.toLowerCase()||c.__endpointa.label.toLowerCase()==c.__endpointb.label.toLowerCase()||c.__endpointa.objectid!=this.get("__endpointb").objectid&&c.__endpointa.objectid||(e="B",g="A");d(this.get("__endpointa"),e,this,b);d(this.get("__endpointb"),g,this,b);this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;
if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b};return this};e.setSnapShot?this.parseConnection(c):c.__endpointa&&c.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));this.relationName=c.__relationtype;_type.isFunction(this.initialize)&&this.initialize.apply(this,[c]);return this};b.Connection.prototype=new b.BaseObject;b.Connection.prototype.constructor=
b.Connection;b.Connection.extend=function(c,d,g){_type.isObject(c)&&(g=d,d=c,c=d.relationName);if(!_type.isString(c))throw Error("Appacitive.Connection.extend's first argument should be the relationName.");var h=null;d=d||{};d.className=c;h=b._extend(b.Connection,d,g);delete h.extend;h.className=c;h.relation=c;return e[c]=h};var e={},h=function(c){if(!_type.isString(c))throw"_getClass requires a string argument.";var d=e[c];d||(d=b.Connection.extend(c),e[c]=d);return d};b.Connection._getClass=h;b.Connection._create=
function(b,c,d){return(new (this.className?this:d?d:h(b.__relationtype))(b)).copy(b,c)};var l=function(c,d,e){var g=[];c||(c=[]);c.forEach(function(c){g.push(b.Connection._create(_extend(c,{__meta:e}),!0,d))});return g};b.Connection._parseResult=l;b.Connection.prototype.setupConnection=function(b,d){if(!(b&&(b.objectid||b.object)&&b.label&&d&&(d.objectid||d.object)&&d.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",c(b,"A",this),{silent:!0});this.set("__endpointb",
c(d,"B",this),{silent:!0});this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b}};b.Connection.prototype.get=b.Connection.get=function(c,d){c=c||{};_type.isString(c)&&this.className&&(c={id:c});
this.className&&(c.relation=this.className,c.entity=this);if(!c.relation)throw Error("Specify relation");if(!c.id)throw Error("Specify id to fetch");var e=b.Connection._create({__relationtype:c.relation,__id:c.id});e.fields=c.fields;return e.fetch(d)};b.Connection.multiGet=function(c,d){c=c||{};d=d||{};_type.isArray(c)&&0<c.length&&(c=c[0]instanceof b.Connection?{ids:c.map(function(b){return b.id}).filter(function(b){return b})}:{ids:c});this.className&&(c.relation=this.className,c.entity=this);if(!c.relation||
!_type.isString(c.relation)||0===c.relation.length)throw Error("Specify valid relation");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var e=new b._Request({method:"GET",type:"connection",op:"getMultiGetUrl",args:[c.relation,c.ids.join(","),c.fields],options:d,onSuccess:function(b){e.promise.fulfill(l(b.connections,c.entity,b.__meta))}});return e.send()};b.Connection.multiDelete=function(c,d){c=c||{};d=d||{};var e=[];this.className&&(c.relation=this.className);_type.isArray(c)&&
0<c.length&&(c[0]instanceof b.Connection?(e=c,c={relation:e[0].className,ids:e.map(function(b){return b.id}).filter(function(b){return b})}):c={relation:this.className,ids:c});if(!c.relation||!_type.isString(c.relation)||0===c.relation.length)throw Error("Specify valid relation");if(!c.ids||0===c.ids.length)throw Error("Specify ids to delete");var g=new b._Request({method:"POST",data:{idlist:c.ids},type:"connection",op:"getMultiDeleteUrl",args:[c.relation],options:d,onSuccess:function(b){d&&!d.silent&&
e.forEach(function(b){b.trigger("destroy",b,b.collection,d)});g.promise.fulfill()}});return g.send()};b.Connection.findAll=b.Connection.findAllQuery=function(c){c=c||{};this.className&&(c.relation=this.className,c.entity=this);return new b.Queries.FindAllQuery(c)};b.Connection.interconnectsQuery=b.Connection.getInterconnects=function(c){return new b.Queries.InterconnectsQuery(c)};b.Connection.betweenObjectsQuery=b.Connection.getBetweenObjects=function(c){return new b.Queries.GetConnectionsBetweenObjectsQuery(c)};
b.Connection.betweenObjectsForRelationQuery=b.Connection.getBetweenObjectsForRelation=function(c){c=c||{};this.className&&(c.relation=this.className,c.entity=this);return new b.Queries.GetConnectionsBetweenObjectsForRelationQuery(c)};b.Connection.saveAll=function(c,d){return b.BaseObject._saveAll(c,d,"Connection")}})(global);
(function(g){var b=g.Appacitive,c=function(c,d){c=c||{};c.__type="user";b.Object.call(this,c,d);return this},d=null;c.currentUser=c.current=function(){return d};var e=function(c,d,e){var g=this.get("__id");if(!g||!_type.isString(g)||0===g.length)throw Error("Please specify valid userid");if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid oldPassword");if(!d||!_type.isString(d)||0===d.length)throw Error("Please specify valid newPassword");var h=this,k=new b._Request({method:"POST",
type:"user",op:"getUpdatePasswordUrl",args:[g],options:e,data:{oldpassword:c,newpassword:d},entity:this,onSuccess:function(b){k.promise.fulfill(h)}});return k.send()},h=function(c,d){var e=this.get("__id");if(!this.get("__id"))return this.set("__link",c),b.Promise.buildPromise(d).fulfill(this);var g=this,h=new b._Request({method:"POST",type:"user",op:"getLinkAccountUrl",args:[e],options:d,data:c,entity:this,onSuccess:function(b){b=g.get("__link");_type.isArray(b)||(b=b?[b]:[]);b.push(c);g.copy({__link:b},
!0);h.promise.fulfill(g)}});return h.send()};c.setCurrentUser=function(c,g,h){if(!c)throw Error("Cannot set null object as user");var l=c;if(l instanceof b.User)if(l.get("__id")&&0!==l.get("__id").length)c=l.getObject();else throw Error("Specify user __id");else l=new b.User(c,!0);b.localStorage.set("Appacitive-User",c);h||(h=864E5);d=l;g&&b.Session.setUserAuthHeader(g,h);d.logout=function(c){return b.Users.logout(c)};d.updatePassword=function(b,c,d){return e.apply(this,[b,c,d])};d.logout=function(c){return b.Users.logout(c)};
b.eventManager.clearAndSubscribe("type.user."+l.get("__id")+".updated",function(c,d){b.localStorage.set("Appacitive-User",d.object.getObject())});return d};c.prototype.linkedAccounts=function(){var b=this.get("__link");b?_type.isArray(b)||(b=[b]):b=[];return b};c.prototype.getAllLinkedAccounts=function(c){var d=this.get("__id");if(!d||!_type.isString(d)||0===d.length)return b.Promise.buildPromise(c).fulfill(this.linkedAccounts(),this);var e=this,g=new b._Request({method:"GET",type:"user",op:"getGetAllLinkedAccountsUrl",
args:[d],options:c,entity:this,onSuccess:function(){var b=a.identities||[];0<b.length?e.set("__link",b):e.set("__link",null);g.promise.fulfill(b,e)}});return g.send()};c.prototype.checkin=function(c,d){var e=this.get("__id");e&&_type.isString(e)&&0!==e.length||onSuccess&&_type.isFunction(onSuccess)&&onSuccess();if(!(c&&c instanceof b.GeoCoord))throw Error("Invalid coordinates provided");var g=this,h=new b._Request({method:"POST",type:"user",op:"getCheckinUrl",args:[e,c.lat,c.lngerId],options:d,entity:this,
onSuccess:function(){h.promise.fulfill(g)}});return h.send()};c.prototype.linkFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return h.apply(this,[{authtype:"facebook",accesstoken:b,name:"facebook"},c])};c.prototype.linkTwitter=function(b,c){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var d={authtype:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret};b.consumerKey&&
b.consumerSecret&&(d.consumersecret=b.consumerSecret,d.consumerkey=b.consumerKey);return h.apply(this,[d,c])};c.prototype.unlink=function(c,d){if(!_.isString(c))throw Error("Specify aouth account type for unlinking");var e=this.get("__id");if(!this.get("__id"))return this.set("__link",null),promise.fulfill(this),promise;var g=this,h=new b._Request({method:"POST",type:"user",op:"getDelinkAccountUrl",args:[e,c],options:d,entity:this,onSuccess:function(b){(b=g.get("__link"))?_type.isArray(b)||(b=[b]):
b=[];if(0<=b.length){var d=null;b.forEach(function(b,e){b.name==c.toLowerCase()&&(d=e)});null!=d&&b.splice(d,1);g.copy({__link:b},!0)}else g.copy({__link:[]},!0);h.promise.fulfill(g)}});return h.send()};c.prototype.clone=function(){return new b.User(this.getObject())};b.User=b.Object.extend("user",c.prototype);delete b.User._create;delete b.User._parseResult;delete b.User.multiDelete;c.deleteUser=function(c,d){if(!c)throw Error("Specify userid for user delete");return(new b.Object({__type:"user",
__id:c})).destroyWithConnections(d)};c.deleteCurrentUser=function(c){var e=b.Promise.buildPromise(c);if(null===d)return b.Session.removeUserAuthHeader(),e.fulfill(),e;c=d.get("__id");this.deleteUser(c).then(function(){d=null;b.Session.removeUserAuthHeader();e.fulfill()},function(){e.reject.apply(e,arguments)});return e};c.createNewUser=function(c,d){c=c||{};c.__type="user";if(!c.username||!c.password||!c.firstname||0===c.username.length||0===c.password.length||0===c.firstname.length)throw Error("username, password and firstname are mandatory");
return(new b.User(c)).save(d)};c.createUser=c.createNewUser;c.signup=function(c,d){var e=this,g=b.Promise.buildPromise(d);this.createUser(c).then(function(){e.login(c.username,c.password).then(function(){g.fulfill.apply(g,arguments)},function(b){g.reject.apply(g,arguments)})},function(){g.reject.apply(g,arguments)});return g};c.authenticateUser=function(c,e,h){e=e||{};c.expiry||(c.expiry=864E5);var l=this,p;_type.isString(h)&&_type.isObject(e.user)&&(c.user=e.user instanceof g.Appacitive.User?e.user.toJSON():
e.user,delete c.user.__meta,p=e.user);var k=new b._Request({method:"POST",type:"user",op:"getAuthenticateUserUrl",options:e,data:c,onSuccess:function(e){e&&e.user?(h&&(e.user.__authType=h),_extend(e.user,{__meta:e.__meta}),p instanceof g.Appacitive.User&&(e.user=p.copy(e.user,!0)),l.setCurrentUser(e.user,e.token,c.expiry),b.User.trigger("login",d,d,e.token),k.promise.fulfill({user:d,token:e.token})):k.promise.reject(e.status)}});return k.send()};c.login=function(b,c,d){if(!b||!c||0==b.length||0==
c.length)throw Error("Please specify username and password");return this.authenticateUser({username:b,password:c,expiry:864E5},d,"BASIC")};c.loginWithFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");c=c||{};var d=!0;0==c.create&&(d=!1);return this.authenticateUser({accesstoken:b,type:"facebook",expiry:864E5,createnew:d},c,"FB")};c.loginWithTwitter=function(b,c){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");
var d=!0;0==c.create&&(d=!1);d={type:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret,expiry:864E5,createnew:d};b.consumerKey&&b.consumerSecret&&(d.consumersecret=b.consumerSecret,d.consumerkey=b.consumerKey);return this.authenticateUser(d,c,"TWITTER")};c.validateCurrentUser=function(c,d){var e=b.Promise.buildPromise({success:d});d&&_type.isBoolean(d)&&(c=d,d=function(){});var g=b.localStorage.get("Appacitive-UserToken");if(!g)return e.fulfill(!1),e;if(c)e.fulfill(!0);else try{var h=
this;this.getUserByToken(g).then(function(b){h.setCurrentUser(b,g);e.fulfill(!0)},function(){e.fulfill(!1)})}catch(k){e.fulfill(!1)}return e};var l=function(c,d,e){e=e||{};var g=new b._Request({method:"GET",type:"user",op:c,options:e,args:d,onSuccess:function(c){c&&c.user?g.promise.fulfill(new b.User(_extend(c.user,{__meta:c.__meta}),_extend(e,{setSnapShot:!0}))):g.promise.reject(c.status)}});return g.send()};c.getUserByToken=function(c,d){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid token");
b.Session.setUserAuthHeader(c,0,!0);return l("getUserByTokenUrl",[c],d)};c.getUserByUsername=function(b,c){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");return l("getUserByUsernameUrl",[b],c)};c.logout=function(c,e){d=null;return b.Session.removeUserAuthHeader(c,e)};c.sendResetPasswordEmail=function(c,d,e){if(!c||!_type.isString(c)||0===c.length)throw Error("Please specify valid username");if(!d||!_type.isString(d)||0===d.length)throw Error("Plase specify subject for email");
c={username:c,subject:d};e=e||{};_type.isString(e.templateName)&&(c.templatename=e.templateName);_type.isString(e.resetLink)&&(c.resetlink=e.resetLink);var g=new b._Request({method:"POST",type:"user",op:"getSendResetPasswordEmailUrl",options:e,data:c,onSuccess:function(){g.promise.fulfill()}});return g.send()};c.resetPassword=function(c,d,e){if(!c)throw Error("Please specify token");if(!d||0===d.length)throw Error("Please specify password");var g=new b._Request({method:"POST",type:"user",op:"getResetPasswordUrl",
options:e,data:{newpassword:d},args:[c],onSuccess:function(){g.promise.fulfill()}});return g.send()};c.validateResetPasswordToken=function(c,d){if(!c)throw Error("Please specify token");d=d||{};var e=new b._Request({method:"POST",type:"user",op:"getValidateResetPasswordUrl",options:d,data:{},args:[c],onSuccess:function(c){e.promise.fulfill(new b.User(_extend(c.user,{__meta:c.__meta}),_extend(d,{setSnapShot:!0})))}});return e.send()};b.Users=b.User;b.Events.mixin(b.User)})(global);
(function(g){var b=g.Appacitive;b.Collection=function(b,d){d||(d={});d.model&&(this.model=d.model);if(!this.model)throw Error("Please specify model for collection");void 0!==d.comparator&&(this.comparator=d.comparator);d.query&&this.query(d.query);this._reset();this.initialize.apply(this,arguments);b&&this.reset(b,{silent:!0})};b.Events.mixin(b.Collection.prototype);_extend(b.Collection.prototype,{models:[],initialize:function(){},_query:null,toJSON:function(b){return this.models.map(function(d){return d.toJSON(b)})},
getObject:function(b){return this.models.map(function(d){return d.getObject(b)})},add:function(b,d){d=d||{};var e,g,l,f,n,q={},r={},p=[],k=d.sort,t;b=_type.isArray(b)?b.slice():[b];e=0;for(g=b.length;e<g;e++){b[e]=this._prepareModel(b[e]);l=b[e];if(!l)throw Error("Can't add an invalid model to a collection");f=l.cid;if(q[f]||this._byCid[f])throw Error("Duplicate cid: can't add the same model to a collection twice");(n=l.id)&&((t=r[n])||(t=this._byId[n]))?(t.copy(l.getObject(),d.setSnapShot),t.children=
l.children):(r[n]=l,q[f]=l,p.push(l),this._addReference(l,d))}this.models.splice.apply(this.models,[null!=d.at?d.at:this.models.length,0].concat(p));k&&this.comparator&&this.sort({silent:!0});this.length=this.models.length;if(d.silent)return this;e=0;for(g=p.length;e<g;e++)l=p[e],d.index=e,l.trigger("add",l,this,d);return this},remove:function(b,d){var e,g,l,f;d=d||{};b=_type.isArray(b)?b.slice():[b];e=0;for(g=b.length;e<g;e++)if(f=this.getByCid(b[e])||this.get(b[e]))delete this._byId[f.id],delete this._byCid[f.cid],
l=this.models.indexOf(f),this.models.splice(l,1),this.length--,d.silent||(d.index=l,f.trigger("remove",f,this,d)),this._removeReference(f);return this},push:function(b,d){return this.add(b,_extend({at:this.length},d))},pop:function(b){var d=this.at(this.length-1);this.remove(d,b);return d},unshift:function(b,d){return this.add(b,_extend({at:0},d))},shift:function(b){var d=this.at(0);this.remove(d,b);return d},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(c){return c&&
this._byId[c instanceof b.BaseObject?c.id:c]},query:function(c){if(c){if(c instanceof b.Query||c instanceof b.Queries.GraphAPI)return this._query=c,this;throw Error("Cannot bind this query");}this._query||(this._query=new b.Query(this.model));return this._query},getByCid:function(b){return b&&this._byCid[b.cid||b]},at:function(b){return this.models[b]},where:function(b,d){return Object.isEmpty(b)?d?void 0:[]:this.models[d?"find":"filter"](function(d){for(var g in b)if(b[g]!==d.get(g))return!1;return!0})},
findWhere:function(b){return this.where(b,!0)},sort:function(b){b=b||{};if(!this.comparator)throw Error("Cannot sort a set without a comparator");1===this.comparator.length?this.models=this.models.sortBy(this.comparator):this.models.sort(this.comparator.bind(this.models));b.silent||this.trigger("reset",this,b);return this},pluck:function(b){return this.models.map(function(d){return d.get(b)})},first:function(){return 0<this.length?this.models[0]:null},last:function(){return 0<this.length?this.models[this.length-
1]:null},reset:function(b,d){d||(d={});for(var e=0,g=this.models.length;e<g;e++)this._removeReference(this.models[e],d);this._reset();this.add(b,_extend({silent:!0},d));d.silent||this.trigger("reset",this,d);return this},fetch:function(c){c=_clone(c)||{};var d=this,e=this.query()||new b.Query(this.model),g=b.Promise.buildPromise(c);e.fetch(c).then(function(b){0==c.reset?d.add(b,_extend({setSnapShot:!0},c)):d.reset(b,c);g.fulfill(d)},function(){g.reject.apply(g,arguments)});return g},fetchNext:function(b){var d=
this.query().pageNumber();this.query().pageNumber(++d);return this.fetch(b)},fetchPrev:function(b){var d=this.query().pageNumber();--d;0>=d&&(d=1);this.query().pageNumber(d);return this.fetch(b)},mutiGet:function(c){c=_clone(c)||{};var d=this,e=b.Promise.buildPromise(c);c=c||{};_type.isArray(c)&&(c[0]instanceof b.Object?(models=c,c={ids:models.map(function(b){return b.id}).filter(function(b){return b})}):c={ids:c});var g=c.ids||[];if(0==g.length)return e.fulfill(d);this.model.multiGet({ids:g,fields:c.fields}).then(function(b){c.add?
d.add(b,c):d.reset(b,c);e.fulfill(d)},function(){e.reject.apply(e,arguments)});return e},saveAll:function(b){return this.model.saveAll(this.models,_extend({},b))},save:function(b){return this.model.saveAll(this.models,_extend({},b))},create:function(b,d){var e=this;d=d?_clone(d):{};if(!(b=this._prepareModel(b,d)))return!1;d.wait||this.add(b,d);var g=d.success;d.success=function(){d.wait&&e.add(b,_extend({setSnapShot:!0},d));g&&g(b,e)};b.save(d);return b},_reset:function(b){this.length=0;this.models=
[];this._byId={};this._byCid={}},_prepareModel:function(c){c instanceof b.BaseObject||(c=new this.model(c));c.collection||(c.collection=this);return c},_addReference:function(b){this._byId[b.cid]=b;null!=b.id&&(this._byId[b.id]=b);b.collection||(b.collection=this);b.on("all",this._onModelEvent,this)},_removeReference:function(b){this===b.collection&&delete b.collection;b.off("all",this._onModelEvent,this)},_onModelEvent:function(b,d,e,g){if("add"!==b&&"remove"!==b||e===this)"destroy"===b&&this.remove(d,
g),d&&"change:__id"===b&&(delete this._byId[d.previous(d.idAttribute)],null!=d.id&&(this._byId[d.id]=d)),this.trigger.apply(this,arguments)}});b.Collection.extend=function(c,d){c&&c.query&&(c._query=c.query,delete c.query);var e=b._extend(this,c,d);e.extend=this.extend;return e};"forEach each map find filter every some indexOf lastIndexOf isEmpty difference without reduce".split(" ").each(function(c){b.Collection.prototype[c]=function(){var b=Array.prototype.slice.call(arguments);return Array.prototype[c].apply(this.models,
b)}})})(global);
(function(g){var b=g.Appacitive;b.Batch=function(){this.objects=[];this.connections=[];this.objectDeletions=[];this.edgeDeletions=[]};var c=function(b){-1==this.connections.indexOf(b)&&this.connections.push(b)},d=function(b){-1==this.objects.indexOf(b)&&this.objects.push(b)},e=function(c,d,e){var f;if(_type.isString(c)){if(f=c,!_type.isString(d)&&0<d.trim().length)throw Error("Specify typename as second argument to Batch.removeObjects");}else if(_type.isObject(c)&&c instanceof b.Object){if(c.isNew())return;f=
c.id;e=d;d=c.typeName}else throw Error("Batch.removeObjects accepts only Appacitive.Object or ids with typeName");this.objectDeletions.find(function(b){return f==b.id})||this.objectDeletions.push({type:d,id:f,deleteconnections:e})},h=function(c,d){var e;if(_type.isString(c)){if(e=c,!_type.isString(d)&&0<d.trim().length)throw Error("Specify relationName as second argument to Batch.removeConnections");}else if(_type.isObject(c)&&c instanceof b.Connection){if(c.isNew())return;e=c.id;d=c.relationName}else throw Error("Batch.removeConnection accepts only Appacitive.Connection or ids with relationName");
this.edgeDeletions.find(function(b){return e==b.id})||this.edgeDeletions.push({type:d,id:e})},l=function(e){if(_type.isObject(e)){if(e instanceof b.Object)return d.apply(this,[e]);if(e instanceof b.Connection)return c.apply(this,[e])}throw Error("Batch accepts only Appacitive.Object and Appacitive.Connection instances");},f=function(){var b=[];this.objects.forEach(function(c,d){var e=c._findUnsavedChanges();if(e.object){e.object.__type=c.className;var f=b.find(function(b){return c.id&&c.id==b.object.__id||
c.cid==b.name});f&&(f.object=e.object,e=f);delete e.isNested;c.isNew()?e.name=""+c.cid:e.object.__id=c.id;f||b.push(e)}});return b},n=function(){var b=this,c=[];this.connections.forEach(function(d){var e=d._findUnsavedChanges().object;e&&(e.__relationtype=d.className,e.__endpointa&&delete e.__endpointa.object,e.__endpointb&&delete e.__endpointb.object);var f=d.endpointA.object;_type.isObject(f)&&(d.isNew()&&(f.isNew()?e.__endpointa.name=""+d.endpointA.object.cid:e.__endpointa.objectid=d.endpointA.object.id),
l.apply(b,[f]));f=d.endpointB.object;_type.isObject(f)&&(d.isNew()&&(f.isNew()?e.__endpointb.name=""+d.endpointB.object.cid:e.__endpointb.objectid=d.endpointB.object.id),l.apply(b,[f]));if(e){var f=c.find(function(b){return d.id&&d.id==b.connection.__id||d.cid==b.name}),g={connection:e};f&&(f.connection=e,g=f);d.isNew()?g.name=""+d.cid:g.connection.__id=d.id;f||c.push(g)}});return c};b.Batch.prototype.add=function(){var b=this;_type.isArray(arguments[0])?arguments[0].forEach(function(c){l.apply(b,
[c])}):l.apply(this,arguments);return this};b.Batch.prototype.removeObjects=function(){var b=this,c=arguments;_type.isArray(c[0])?arguments[0].forEach(function(d){e.apply(b,[d,c[1],c[2]])}):e.apply(this,c);return this};b.Batch.prototype.removeConnections=function(){var b=this,c=arguments;_type.isArray(c[0])?arguments[0].forEach(function(d){h.apply(b,[d,c[1],c[2]])}):h.apply(this,c);return this};b.Batch.prototype.toJSON=function(){var b={nodes:[],edges:[],edgedeletions:[],nodedeletions:[]};b.edges=
n.apply(this,[]);b.nodes=f.apply(this,[]);b.nodedeletions=this.objectDeletions;b.edgedeletions=this.edgeDeletions;return b};var q=function(b,c,d){var e=this;b.forEach(function(b){var f=b.object;e.objects.forEach(function(e){if(e.cid==b.name||e.id==f.__id||e.get("__id")==f.__id){var g={__meta:c[e.className]};g[e.getType()]=f;e._parseOutput(d,g)}})})},r=function(b,c,d){var e=this;b.forEach(function(b){var f=b.connection;e.connections.forEach(function(e){if(e.cid==b.name||e.id==f.__id||e.get("__id")==
f.__id){var g={__meta:c[e.className]};g[e.getType()]=f;e._parseOutput(d,g)}})})},p=function(c,d){var e;c&&c.edges&&c.nodes&&0<=c.edges.length&&0<=c.nodes.length?(q.call(this,c.nodes,c.__meta.__type,d),r.call(this,c.edges,c.__meta.__rel,d),d.silent||this.trigger("sync",this,{objects:this.objects,connections:this.connections},d)):(c=c||{},c.status=c.status||{},e=(e=c.status)||{},e.message=e.message||"Server error",e.code=e.code||"500",this._triggerError(d,new b.Error(e)));return e};b.Batch.prototype._triggerError=
function(b,c){b.silent||this.trigger("error",this,c,b)};b.Batch.prototype.execute=function(c){var d=this.toJSON();c=_extend({_batch:!0},c);if(0==d.nodes.length&&0==d.edges.length&&0==d.edgedeletions.length&&0==d.nodedeletions.length)return c.silent||this.trigger("sync",this,{objects:this.objects,connections:this.connections},c),(new b.Promise).fulfill(this);var e=this,f=new b._Request({method:"PUT",type:"multi",op:"getBatchUrl",data:d,options:c,entity:this,onSuccess:function(b){(b=p.apply(e,[b,c]))?
f.promise.reject(b,e):f.promise.fulfill(e)}});return f.send()};b.Events.mixin(b.Batch.prototype)})(global);
(function(g){var b=g.Appacitive;g=function(){var c=null,d=this.FB=null,e=!1;this.initialize=function(b){if(!Facebook)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!b.appId)throw Error("Please provide appid");if(!b.appSecret)throw Error("Please provide app secret");d=b.appSecret;this.FB=new (require("facebook-node-sdk"))({appId:_appId,secret:d});e=!0};this.requestLogin=function(d){d&&(c=d);return(new b.Promise).fulfill()};this.getCurrentUserInfo=function(){if(!e)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
var d=new b.Promise;this.FB&&c?this.FB.api("/me",function(b,c){c?d.fulfill(c):d.reject("Access token is invalid")}):d.reject("Either intialize facebook with your appid and appsecret or set accesstoken");return d};this.accessToken=function(){return 1===arguments.length?(c=arguments[0],this):c};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){b.Facebook.accessToken="";return(new b.Promise).fulfill()}};b.Facebook=b.runtime.isBrowser?new function(){var c=
null,d=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);d=!0};this.requestLogin=function(e){e=e||{};if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var g=new b.Promise;FB.login(function(b){b&&"connected"===b.status&&b.authResponse?(c=b.authResponse.accessToken,g.fulfill(b.authResponse)):g.reject()},e);return g};this.getCurrentUserInfo=function(){if(!d)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
var e=new b.Promise;FB.api("/me",function(b){b&&!b.error?(c=FB.getAuthResponse().accessToken,e.fulfill(b)):e.reject()});return e};this.accessToken=function(){return 1===arguments.length?(c=arguments[0],this):c};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){c=null;var d=new b.Promise;try{FB.logout(function(){b.Users.logout();d.fulfill()})}catch(g){d.reject(g.message)}return d}}:new g})(global);
(function(g){var b=g.Appacitive;b.Email=new function(){var c={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return c};var d=function(c,d){var g=new b._Request({method:"POST",type:"email",op:"getSendEmailUrl",options:d,data:c,entity:c,onSuccess:function(b){g.promise.fulfill(b.email)}});return g.send()};this.setupEmail=function(b){b=b||{};c.smtp.username=b.username||c.smtp.username;c.from=b.from||c.from;c.smtp.password=
b.password||c.smtp.password;c.smtp.host=b.smtp.host||c.smtp.host;c.smtp.port=b.smtp.port||c.smtp.port;c.smtp.enablessl=b.enableSSL||c.smtp.enablessl;c.replyto=b.replyTo||c.replyto};this.sendTemplatedEmail=function(b,g){if(!b||!b.to||!b.to.length||0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&c.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");
if(!b.templateName)throw Error("template name is mandatory to send an email");var l={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){l.smtp=c.smtp;if(!b.from&&!c.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");l.from=b.from||c.from;l.replyto=b.replyTo||c.replyto}return d(l,g)};this.sendRawEmail=function(b,g){if(!b||!b.to||!b.to.length||
0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&c.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.body)throw Error("body is mandatory to send an email");var l={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{content:b.body||"",ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){l.smtp=
c.smtp;if(!b.from&&!c.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");l.from=b.from||c.from;l.replyto=b.replyTo||c.replyto}return d(l,g)}}})(global);
(function(g){var b=g.Appacitive;b.Push=new function(){this.send=function(c,d){if(!c)throw Error("Please specify push options");var e=new b._Request({method:"POST",type:"push",op:"getPushUrl",options:d,data:c,entity:c,onSuccess:function(b){e.promise.fulfill(b.id)}});return e.send()};this.getNotification=function(c,d){if(!c)throw Error("Please specify notification id");var e=new b._Request({method:"GET",type:"push",op:"getGetNotificationUrl",args:[c],options:d,onSuccess:function(b){e.promise.fulfill(b.pushnotification)}});
return e.send()};this.getAllNotifications=function(c,d){c?(c.pnum=c.pnum||1,c.psize=c.psize||20):c={pnum:1,psize:20};var e=new b._Request({method:"GET",type:"push",op:"getGetAllNotificationsUrl",args:[c],options:d,onSuccess:function(b){e.promise.fulfill(b.pushnotifications,b.paginginfo)}});return e.send()}}})(global);
(function(g){var b=g.Appacitive;b.File=function(c){c=c||{};this.fileId=c.fileId;this.contentType=c.contentType;this.fileData=c.fileData;var d=this,e=function(c,e,f,g,h){var l=new b.HttpRequest;l.url=c;l.method="GET";l.description=g;l.onSuccess=e;l.promise=f;l.entity=d;l.options=h;b.http.send(l)},g=function(c,e,f,g,h){var l=new b.HttpRequest;l.url=c;l.method="PUT";l.log=!1;l.description="Upload file";l.data=e;l.headers.push({key:"Content-Type",value:f});l.send().then(g,function(b){h.reject(b,d)})};
this.save=function(b,c){"number"!==typeof b&&(c=b,b=-1);return this.fileId&&_type.isString(this.fileId)&&0<this.fileId.length?f(b,c):l(b,c)};var l=function(c,f){if(!d.fileData)throw Error("Please specify filedata");if(!d.contentType)try{d.contentType=d.fileData.type}catch(l){}d.contentType&&_type.isString(d.contentType)&&0!==d.contentType.length||(d.contentType="text/plain");var p=b.Promise.buildPromise(f),k=b.config.apiBaseUrl+b.storage.urlFactory.file.getUploadUrl(d.contentType,d.fileId?d.fileId:
"");e(k,function(b){g(b.url,d.fileData,d.contentType,function(){d.fileId=b.id;d.getDownloadUrl(c,f).then(function(b){return p.fulfill(b,d)},function(b){return p.reject(b)})},p)},p," Get upload url for file ",f);return p},f=function(c,f){if(!d.fileData)throw Error("Please specify filedata");if(!d.contentType)try{d.contentType=d.fileData.type}catch(l){}d.contentType&&_type.isString(d.contentType)&&0!==d.contentType.length||(d.contentType="text/plain");var p=b.Promise.buildPromise(f),k=b.config.apiBaseUrl+
b.storage.urlFactory.file.getUpdateUrl(d.fileId,d.contentType);e(k,function(b){g(b.url,d.fileData,d.contentType,function(){d.getDownloadUrl(c,f).then(function(b){p.fulfill(b,d)},function(b){p.reject(b)})},p)},p," Get update url for file "+d.fileId,f);return p};this.destroy=function(c){if(!this.fileId)throw Error("Please specify fileId to delete");var e=b.Promise.buildPromise(c),f=new b.HttpRequest;f.url=b.config.apiBaseUrl+b.storage.urlFactory.file.getDeleteUrl(this.fileId);f.method="DELETE";f.description=
"Delete file with id "+this.fileId;f.onSuccess=function(b){e.fulfill()};f.promise=e;f.entity=d;f.options=c;return b.http.send(f)};this.getDownloadUrl=function(c,f){if(!this.fileId)throw Error("Please specify fileId to download");"number"!==typeof c&&(f=c,c=-1);var g=b.Promise.buildPromise(f),h=b.config.apiBaseUrl+b.storage.urlFactory.file.getDownloadUrl(this.fileId,c);e(h,function(b){d.url=b.uri;g.fulfill(b.uri)},g," Get download url for file "+this.fileId,f);return g};this.getUploadUrl=function(c){d.contentType&&
_type.isString(d.contentType)&&0!==d.contentType.length||(d.contentType="text/plain");var f=b.Promise.buildPromise(c),g=b.config.apiBaseUrl+b.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");e(g,function(b){d.url=b.url;f.fulfill(b.url,d)},f," Get upload url for file "+this.fileId,c);return f}}})(global);
(function(g){g=g.Appacitive;g.Date={};var b=function(b){return 10>b?"0"+b:b};g.Date.parseISODate=function(b){try{if(!/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(b))return new Date(b);var d=b.split("T"),e=d[0].split("-"),g=d[1].split("Z")[0].split(":"),l=g[2].split("."),f=Number(g[0]),n=new Date;n.setUTCFullYear(Number(e[0]));n.setUTCDate(Number(e[2]));n.setUTCMonth(Number(e[1])-1);n.setUTCHours(Number(f));n.setUTCMinutes(Number(g[1]));n.setUTCSeconds(Number(l[0]));
l[1]&&n.setUTCMilliseconds(Number(l[1].substring(0,3)));return n}catch(q){return null}};g.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(d){return null}};g.Date.toISODate=function(c){if(c instanceof Date)return String.format("{0}-{1}-{2}",c.getFullYear(),b(c.getMonth()+1),b(c.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};g.Date.toISOTime=function(c){var d=function(b){return 10>b?b+"000000":100>b?b+"00000":1E3>b?b+"0000":
1E4>b?b+"000":1E5>b?b+"00":1E6>b?b+"0":b};if(c instanceof Date)return String.format("{0}:{1}:{2}.{3}",b(c.getHours()),b(c.getMinutes()),b(c.getSeconds()),d(c.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};g.Date.parseISOTime=function(b){try{var d=new Date,e=b.split("T");1===e.length&&e.push(e[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(e[1]))return null;var g=e[1].split("Z")[0].split(":"),l=g[2].split("."),f=Number(g[0]);1<e.length?
(d.setUTCHours(Number(f)),d.setUTCMinutes(Number(g[1])),d.setUTCSeconds(Number(l[0])),l[1]&&d.setUTCMilliseconds(Number(l[1].substring(0,3)))):(d.setHours(Number(f)),d.setMinutes(Number(g[1])),d.setSeconds(Number(l[0])),l[1]&&d.setMilliseconds(Number(l[1].substring(0,3))));return d}catch(n){return null}}})(global);
(function(g){var b=g.Appacitive;b.localStorage=new (b.runtime.isBrowser?function(){var c=b.runtime.isBrowser?window.localStorage:{getItem:function(){return null}},d=function(){try{return c.setItem("test","1"),c.removeItem("test"),!0}catch(b){return!1}};this.set=function(e,g){g=g||"";if(!e)return!1;if(_type.isObject(g)||_type.isArray(g))try{g=JSON.stringify(g)}catch(l){}d()?(e=b.getAppPrefix(e),c[e]=g):b.Cookie.setCookie(e,g);return this};this.get=function(e){if(!e)return null;d()?(e=b.getAppPrefix(e),
e=c.getItem(e)):e=b.Cookie.readCookie(e);if(!e)return null;if("{"===e[0])try{e=JSON.parse(e)}catch(g){}return e};this.remove=function(e){if(e)if(d()){e=b.getAppPrefix(e);try{delete c[e]}catch(g){}}else b.Cookie.eraseCookie(e)}}:function(){var c=[];this.set=function(d,e){e=e||"";if(!d||_type.isString(d))return!1;d=b.getAppPrefix(d);c[d]=e;return this};this.get=function(d){if(!d||_type.isString(d))return null;d=b.getAppPrefix(d);return(d=c[d])?d:null};this.remove=function(d){if(d&&!_type.isString(d)){d=
b.getAppPrefix(d);try{delete c[d]}catch(e){}}}})})(global);
(function(g){var b=g.Appacitive;b.Cookie=new (b.runtime.isBrowser?function(){this.setCookie=function(c,d,e,g){c=b.getAppPrefix(c);var l="";e&&(l=new Date,l.setTime(l.getTime()+6E4*e),l.toGMTString());l=g?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":b.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";e="domain="+window.location.hostname;"localhost"==window.location.hostname&&(e="");document.cookie=c+"="+d+l+"; path=/;"+e};this.readCookie=function(c){c=b.getAppPrefix(c);c+=
"=";for(var d=document.cookie.split(";"),e=0;e<d.length;e++){for(var g=d[e];" "==g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(c))return g.substring(c.length,g.length)}return null};this.eraseCookie=function(b){this.setCookie(b,"",-1,!0)}}:function(){this.setCookie=function(c,d){b.localStorage.set("cookie/"+c,d)};this.readCookie=function(c){return b.localStorage.get("cookie/"+c)};this.eraseCookie=function(c){b.localStorage.remove("cookie/"+c)}})})(global);
"undefined"===typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
