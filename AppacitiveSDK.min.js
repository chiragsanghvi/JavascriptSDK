/*
 * AppacitiveSDK.js vappacitive-js-sdk-v1.0.8 - Javascript SDK to integrate applications using Appacitive
 * Copyright (c) 2015 Appacitive Software Pvt Ltd
 * MIT license  : http://www.apache.org/licenses/LICENSE-2.0.html
 * Project      : https://github.com/chiragsanghvi/JavascriptSDK
 * Contact      : support@appacitive.com | csanghvi@appacitive.com
 * Build time 	: Tue Feb 16 20:34:07 PST 2016
 */
var global={};
(function(){global.Appacitive={runtime:{}};"undefined"!==typeof process&&process.versions&&process.versions.node?global.Appacitive.runtime.isNode=!0:"undefined"!==typeof window&&(global=window,global.Appacitive={runtime:{isBrowser:!0}});var n=global.Appacitive;n.initialize=function(c){c=c||{};var g=new n.Promise;if(n.Session.initialized)return g.fulfill(n);c.masterKey&&0<c.masterKey.length&&n.Session.setMasterKey(c.masterKey);if(!c.apikey||0===c.apikey.length)if(c.masterKey)c.apikey=c.masterKey;else throw Error("apikey is mandatory");
if(!c.appId||0===c.appId.length)throw Error("appId is mandatory");n.Session.setApiKey(c.apikey);n.Session.environment(c.env||"sandbox");n.useApiKey=!0;n.appId=c.appId;n.Session.persistUserToken=c.persistUserToken;c.debug&&(n.config.debug=!0);n.utils._type.isFunction(c.apiLog)&&(n.logs.apiLog=c.apiLog);n.utils._type.isFunction(c.apiErrorLog)&&(n.logs.apiErrorLog=c.apiErrorLog);n.utils._type.isFunction(c.exceptionLog)&&(n.logs.exceptionLog=c.exceptionLog);if(c.userToken)-1==c.expiry?c.expiry=null:c.expiry||
(c.expiry=845E4),n.Session.setUserAuthHeader(c.userToken,c.expiry),c.user&&n.Users.setCurrentUser(c.user);else if(n.runtime.isBrowser){var h=n.LocalStorage.multiGet("Appacitive-UserToken","Appacitive-UserTokenExpiry","Appacitive-UserTokenDate","Appacitive-User");c=h["Appacitive-UserToken"];var b=h["Appacitive-UserTokenExpiry"],e=h["Appacitive-User"],h=h["Appacitive-User"];if(c){b||(b=-1);if(e&&0<b&&new Date(e+1E3*b)<new Date)return;-1==b&&(b=null);h&&n.Users.setCurrentUser(h,c,b)}}n.Session.initialized=
!0;g.fulfill(n.User.current());return g}})(this);
(function(n){var c=n.Appacitive,g=function(b){var e=c.Promise.buildPromise({success:b.onSuccess,error:b.onError}),l=new XDomainRequest;l.onload=function(){var b=l.responseText,m=l.contentType||"";if("application/json"==m.toLowerCase()||"application/javascript"==m.toLowerCase()||"application/json; charset=utf-8"==m.toLowerCase()||"application/json; charset=utf-8;"==m.toLowerCase())try{m=b,c.runtime.isBrowser||"{"!=m[0]&&(m=m.substr(1,m.length-1)),b=JSON.parse(m)}catch(f){return e.reject(l,new c.Error(c.Error.InvalidJson,
"Error while parsing received json "+b))}e.fulfill(b,this)};l.onerror=l.ontimeout=function(){l.responseData="IE's XDomainRequest does not supply error info.";l.status=c.Error.XDomainRequest;e.reject(l,new c.Error(c.Error.XDomainRequest,l.responseData,"Unknown"))};l.onprogress=function(){};-1===b.url.indexOf("?")?b.url+="?ua=ie":b.url+="&ua=ie";l.open(b.method,b.url,b.sync?!1:!0);l.send(b.data);return e},h=c.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest;
c._Http=function(b){if(!b.url)throw Error("Please specify request url");b.method||(b.method="GET");b.headers||(b.headers=[]);var e={};b.onSuccess&&"function"==typeof b.onSuccess||(b.onSuccess=function(){});b.onError&&"function"==typeof b.onError||(b.onError=function(){});var l=c.Promise.buildPromise({success:b.onSuccess,error:b.onError}),d=!0;b.headers.forEach(function(f){"content-type"==f.key.toLowerCase()&&(d=!0,"application/json"==f.value.toLowerCase()||"application/javascript"==f.value.toLowerCase()||
"application/json; charset=utf-8"==f.value.toLowerCase()||"application/json; charset=utf-8;"==f.value.toLowerCase())&&(d=!1)});if(d)e=b.data;else if(b.data&&(e=b.data,"object"==typeof b.data))try{e=JSON.stringify(e)}catch(m){}var f=b.url.split("/")[2]||"";if(n.navigator&&_type.isObject(n.navigator.userAgent)&&_type.isFunction(n.navigator.userAgent.indexOf)&&-1!=n.navigator.userAgent.indexOf("MSIE 9")&&n.location&&n.location.host&&f!==n.location.host.toLowerCase())return b.data=e,new g(b);var k=new h;
k.onreadystatechange=function(){if(4==k.readyState)if(200<=k.status&&300>k.status||304==k.status){var f=k.responseText,b=k.getResponseHeader("content-type")||k.getResponseHeader("Content-Type")||"";if("application/json"==b.toLowerCase()||"application/javascript"==b.toLowerCase()||"application/json; charset=utf-8"==b.toLowerCase()||"application/json; charset=utf-8;"==b.toLowerCase())try{b=f,c.runtime.isBrowser||"{"!=b[0]&&(b=b.substr(1,b.length-1)),f=JSON.parse(b)}catch(d){return l.reject(k,new c.Error(c.Error.InvalidJson,
"Error while parsing received json "+f))}l.fulfill(f,k)}else l.reject(k,new c.Error(c.Error.ConnectionFailed,k.responseText,"Unknown"))};k.open(b.method,b.url,b.sync?!1:!0);for(f=0;f<b.headers.length;f+=1)k.setRequestHeader(b.headers[f].key,b.headers[f].value);c.runtime.isBrowser||k.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");k.send(e);return l}})(global);
(function(n){var c=n.Appacitive,g=function(b){if(b&&b.send&&"function"==typeof b.send)b.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var l=[],d={},m=0,f={},k=0;this.addProcessor=function(f){f&&(f.pre=f.pre||function(){},f.post=f.post||function(){},p(f.pre),h(f.post))};var p=function(f){m+=1;d[m]=f;return m},h=function(b){k+=1;f[k]=b;return k};this.enqueueRequest=function(f){l.push(f)};this.changeRequestForCors=function(f){var k={m:f.method.toUpperCase()};
f.headers.forEach(function(f){k[f.key]=f.value});f.prevHeaders=f.headers;f.headers=[];f.headers.push({key:"Content-Type",value:"text/plain; charset=utf-8"});f.method="POST";f.data&&(k.b=f.data);delete f.data;c.config.debug&&(-1===f.url.indexOf("?")?f.url+="?debug=true":f.url+="&debug=true");c.config.metadata&&(-1===f.url.indexOf("?")?f.url+="?metadata=true":f.url+="&metadata=true");try{f.data=JSON.stringify(k)}catch(b){}return f};this.notify=function(){if(0!==l.length){var k=[],c;for(c in f)f.hasOwnProperty(c)&&
k.push(f[c]);for(;0<l.length;){var p=l.shift(),m=[];for(c in d)d.hasOwnProperty(c)&&m.push(d[c](p));this.changeRequestForCors(p);b.send(p,k,m)}}};this.onResponse=function(f){console.dir(f)}},h=function(){var b=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=b;this.onResponse=function(c,d){b()};this.onError=function(c){b()}},b=function(){var b=new h;b.isOnline=function(){return!0};var l=function(d,l,f){d.options=d.options||{};new c._Http({method:d.method,url:d.url,headers:d.headers,
data:d.data,sync:d.options.sync,onSuccess:function(k,c){if(k){try{k=JSON.parse(k)}catch(h){}var q=k;if(l.length!=f.length)throw Error("Callback length and state length mismatch!");for(var g=0;g<l.length;g+=1)l[g].apply({},[q,f[g]]);if(200<=k.code&&300>=k.code||k.status&&200<=k.status.code&&300>=k.status.code)b.onResponse(d,k);else k=k||{},k=k.status||k,k.message=k.message||"Bad Request",k.code=k.code||"400",b.onError(d,{responseText:k})}else b.onError(d,{responseText:{code:"400",message:"Invalid request"}})},
onError:function(f,p){var l={};p?l=c.Error.toJSON(p):(l.message=f.responseData||f.responseText||"Bad Request",l.code=f.status||"400");b.onError(d,{responseText:l})}})};b.send=function(b,e,f){if(!c.Session.initialized)throw Error("Initialize Appacitive SDK");"function"==typeof b.beforeSend&&b.beforeSend(b);l(b,e,f)};return b};c.http=new function(){var e=new b,l=new g(e),d=!1;this.pause=function(){d=!0};this.unpause=function(){d=!1};this.addProcessor=function(b){var f=Error('Must provide a processor object with either a "pre" function or a "post" function.');
if(!b)throw f;if(!b.pre&&!b.post)throw f;l.addProcessor(b)};this.send=function(b){b.promise=c.Promise.is(b.promise)?b.promise:new c.Promise.buildPromise({error:b.onError});l.enqueueRequest(b);e.isOnline()&&!1===d&&l.notify();return b.promise};this.flush=function(b){b?l.notify():e.isOnline()&&l.notify()};this.onError=function(b,f){var k=f.responseText;c.logs.logRequest(b,k,k,"error");b.entity&&b.entity._triggerError&&b.entity._triggerError(b.options,new c.Error(k));b.promise.reject(new c.Error(k),
b.entity)};e.onError=this.onError;this.onResponse=function(b,f){if(b.onSuccess)if(b.context)b.onSuccess.apply(b.context,[f]);else b.onSuccess(f);c.logs.logRequest(b,f,f?f.status:null,"successful")};e.onResponse=this.onResponse};c.HttpRequest=function(b){b=b||{};this.url=b.url||"";this.data=b.data||{};this.headers=b.headers||[];this.method=b.method||"GET";this.onSuccess=b.onSuccess||function(){};this.onError=b.onError||function(){};this.send=function(b){return new c._Http(this,b)}};(function(b){var c=
b.Appacitive;c&&c.http&&(c.http.addProcessor({pre:function(b){return b},post:function(b,e){try{var f=c.Session.isSessionValid(b);f.status?b&&(b.status&&b.status.code&&("19036"==b.status.code||"421"==b.status.code)||b.code&&("19036"==b.code||"421"==b.code))?c.Users.logout():c.Session.incrementExpiry():f.isSession&&(null!==c.Session.get()&&c.Session.resetSession(),c.http.send(e))}catch(k){}}}),c.http.addProcessor({pre:function(b){return{start:(new Date).getTime(),request:b}},post:function(b,c){c.request.timeTakenInMilliseconds=
(new Date).getTime()-c.start}}))})(n)})(global);var _type=function(n){if(null===n)return"null";if("undefined"===typeof n||"undefined"===n)return"undefined";if(n&&(1===n.nodeType||9===n.nodeType))return"element";var c=Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===c){if(isNaN(n))return"nan";if(!isFinite(n))return"infinity"}return c};
(function(n){"bind"in Function.prototype||(Function.prototype.bind=function(b){var d=this;if(1>=arguments.length)return function(){return d.apply(b,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return d.apply(b,0===arguments.length?c:c.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(b,d){void 0===
d&&(d=0);0>d&&(d+=this.length);0>d&&(d=0);for(var c=this.length;d<c;d++)if(d in this&&this[d]===b)return d;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(b,d){void 0===d&&(d=this.length-1);0>d&&(d+=this.length);d>this.length-1&&(d=this.length-1);for(d++;0<d--;)if(d in this&&this[d]===b)return d;return-1});"forEach"in Array.prototype||(Array.prototype.forEach=function(b,d){for(var c=0,f=this.length;c<f;c++)c in this&&b.call(d,this[c],c,this)});"map"in Array.prototype||
(Array.prototype.map=function(b,d){for(var c=Array(this.length),f=0,k=this.length;f<k;f++)f in this&&(c[f]=b.call(d,this[f],f,this));return c});"filter"in Array.prototype||(Array.prototype.filter=function(b,d){for(var c=[],f,k=0,p=this.length;k<p;k++)k in this&&b.call(d,f=this[k],k,this)&&c.push(f);return c});"every"in Array.prototype||(Array.prototype.every=function(b,d){for(var c=0,f=this.length;c<f;c++)if(c in this&&!b.call(d,this[c],c,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=
function(b,d){for(var c=0,f=this.length;c<f;c++)if(c in this&&b.call(d,this[c],c,this))return!0;return!1});"find"in Array.prototype||(Array.prototype.find=function(b,d){var c=this.length;if(0!==c)for(var f=0,k;f<c&&f in this;f++)if(k=this[f],b.call(d,k,f,this))return k});"where"in Array.prototype||(Array.prototype.where=function(b,d){return 0===this.length?void 0:Object.isEmpty(b)?d?void 0:[]:this[d?"find":"filter"](function(d){for(var f in b)if(b[f]!==d[f])return!1;return!0})},Array.prototype.findWhere=
function(b){return this.where(b,!0)});"each"in Array.prototype||(Array.prototype.each=function(b,d){for(var c=0;c<this.length;c++)b.apply(d,[this[c]])});"difference"in Array.prototype||(Array.prototype.difference=function(b){return this.filter(function(d){return 0>b.indexOf(d)})});"without"in Array.prototype||(Array.prototype.without=function(){return this.difference(Array.prototype.slice.call(arguments,0))});"function"!==typeof Array.prototype.reduce&&(Array.prototype.reduce=function(b){if(null===
this||"undefined"===typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!==typeof b)throw new TypeError(b+" is not a function");var d=Object(this),c=d.length>>>0,f=0,k;if(2<=arguments.length)k=arguments[1];else{for(;f<c&&!f in d;)f++;if(f>=c)throw new TypeError("Reduce of empty array with no initial value");k=d[f++]}for(;f<c;f++)f in d&&(k=b(k,d[f],f,d));return k});var c=function(b,d){return null==b?_.identity:_.isFunction(b)?d?function(){return b.apply(d,
arguments)}:b:function(d){return d[b]}};Array.prototype.pluck=function(b){var d=[];this.each(function(c){d.push(c[b])});return d};Array.prototype.sortBy=function(b,d){b=c(b,d);return this.map(function(c,f){return{value:c,criteria:b.call(d,c,f,this)}},this).sort(function(b,f){var k=b.criteria,d=f.criteria;return k<d?-1:k>d?1:0}).pluck("value")};Array.prototype.removeAll=function(b){for(var d=null,c=0;c<this.length;c++)for(;this[c]===b;)d=this.splice(c,1)[0];return d};Array.prototype.compare=function(b){if(!b||
this.length!=b.length)return!1;for(var d=0,c=this.length;d<c;d++)if(this[d]instanceof Array&&b[d]instanceof Array){if(!this[d].compare(b[d]))return!1}else if(this[d]!=b[d])return!1;return!0};Array.prototype.equals=function(b,d){if(!b)return!1;1==arguments.length&&(d=!1);if(this.length!=b.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&b[c]instanceof Array){if(!this[c].equals(b[c],d))return!1}else{if(d&&!_type.isEqual(this[c],b[c]))return!1;if(!d)return this.sort().equals(b.sort(),
!0)}return!0};Date.prototype.toISOString||function(){function b(c){c=String(c);1===c.length&&(c="0"+c);return c}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();String.addSlashes=function(b){if(!b)return b;b=b.replace(/\\/g,"\\\\");b=b.replace(/\'/g,"\\'");b=b.replace(/\"/g,
'\\"');return b=b.replace(/\0/g,"\\0")};String.stripSlashes=function(b){if(!b)return b;b=b.replace(/\\'/g,"'");b=b.replace(/\\"/g,'"');b=b.replace(/\\0/g,"\x00");return b=b.replace(/\\\\/g,"\\")};if("undefined"===typeof console||null===console)console={log:function(){},dir:function(){}};for(var g="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),h=function(b){_type["is"+b]=function(c){return _type(c)===b.toLowerCase()}},b=0;b<g.length;b++)h(g[b]);
_type.isNullOrUndefined=function(b){return"null"==_type(b)||"undefined"==_type(b)};_type.isNumeric=function(b){return!isNaN(parseFloat(b))&&isFinite(b)};_type.isDate=function(b){return b instanceof Date};var e=function(b,c,h,f){var k=Object.prototype.toString;if(b===c)return 0!==b||1/b==1/c;if(null==b||null==c)return b===c;var p=k.call(b);if(p!=k.call(c))return!1;switch(p){case "[object String]":return b==String(c);case "[object Number]":return b!=+b?c!=+c:0==b?1/b==1/c:b==+c;case "[object Date]":case "[object Boolean]":return+b==
+c}if("object"!=typeof b||"object"!=typeof c)return!1;if(b instanceof n.Appacitive.GeoCoord&&c instanceof n.Appacitive.GeoCoord)return b.toString()==c.toString();for(k=h.length;k--;)if(h[k]==b)return f[k]==c;var k=b.constructor,g=c.constructor;if(k!==g&&!(_types.isFunction(k)&&k instanceof k&&_types.isFunction(g)&&g instanceof g)&&"constructor"in b&&"constructor"in c)return!1;h.push(b);f.push(c);k=0;g=!0;if("[object Array]"==p){if(k=b.length,g=k==c.length)for(;k--&&(g=e(b[k],c[k],h,f)););}else{for(var q in b)if(Object.prototype.hasOwnProperty.call(b,
q)&&(k++,!(g=Object.prototype.hasOwnProperty.call(c,q)&&e(b[q],c[q],h,f))))break;if(g){for(q in c)if(Object.prototype.hasOwnProperty.call(c,q)&&!k--)break;g=!k}}h.pop();f.pop();return g};_type.isEqual=function(b,c){return e(b,c,[],[])};n.Appacitive.utils=n.Appacitive.utils||{};n.Appacitive.utils._type=_type})(global);
(function(n){var c=Array.prototype,g=Object.prototype,h=n.Appacitive;h.utils._each=function(b,h,d){if(null!=b)if(c.forEach&&b.forEach===c.forEach)b.forEach(h,d);else if(b.length===+b.length)for(var m=0,f=b.length;m<f&&h.call(d,b[m],m,b)!=={};m++);else for(m in b)if(g.hasOwnProperty.call(b,m)&&h.call(d,b[m],m,b)==={})break};h.utils._extend=function(b){h.utils._each(c.slice.call(arguments,1),function(c){if(c)for(var d in c)b[d]=c[d]});return b};h.utils._reject=function(b,c){return b.filter(function(b){return!c(b)})};
h.utils._deepExtend=function(b){h.utils._each(Array.prototype.slice.call(arguments,1),function(c){for(var d in c)h.utils._type.isArray(c[d])?(h.utils._type.isArray(b[d])||(b[d]=[]),b[d]=h.utils._reject(h.utils._extend(b[d],c[d]),function(b){return h.utils._type.isNull(b)})):!h.utils._type.isObject(c[d])||c[d]instanceof h.Object||c[d]instanceof h.Connection||c[d]instanceof h.GeoCoord?b[d]=c[d]:(h.utils._type.isObject(b[d])||(b[d]={}),b[d]=h.utils._extend(b[d],c[d]))});return b};var b=function(b,c){var d=
this,g;g=h.utils._type.isObject(b)&&b.hasOwnProperty("constructor")?b.constructor:function(){return d.apply(this,arguments)};h.utils._extend(g,d,c);var f=function(){this.constructor=g};f.prototype=d.prototype;g.prototype=new f;b&&h.utils._extend(g.prototype,b);g.__super__=d.prototype;return g};h.utils.classExtend=function(c,h,d){return b.apply(c,[h,d])};h.utils._result=function(b,c,d){c=null==b?void 0:b[c];void 0===c&&(c=d);return h.utils._type.isFunction(c)?c.call(b):c};h.clone=h.utils._clone=function(b){return h.utils._type.isObject(b)?
h.utils._type.isArray(b)?b.slice():h.utils._extend({},b):b}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type;c.logs={};var h=function(b,c){setTimeout(function(){try{b.call({},c)}catch(h){}},0)};c.logs.logRequest=function(b,e,l,d){e=e||{};l=l||{};var m={};try{m=JSON.parse(b.data),g.isObject(m)||(m={})}catch(f){}var k={status:d,referenceId:l.referenceid,date:(new Date).toISOString(),method:m.m,url:decodeURIComponent(b.url),responseTime:b.timeTakenInMilliseconds,headers:{},request:null,response:e,description:b.description};b.headers&&b.headers.forEach(function(b){k.headers[b.key]=
b.value});b.prevHeaders&&b.prevHeaders.forEach(function(b){k.headers[b.key]=b.value});"GET"!==k.method&&(k.request=m.b);"error"==d&&(c.runtime.isBrowser&&console.dir(k),g.isFunction(c.logs.apiErrorLog)&&h(c.logs.apiErrorLog,k));g.isFunction(c.logs.apiLog)&&h(c.logs.apiLog,k)};c.logs.logException=function(b){g.isFunction(c.logs.exceptionLog)&&h(c.logs.exceptionLog,b)}})(global);
(function(n){var c=n.Appacitive;String.format=function(c,h){if(1>=arguments.length)return c;for(var b=arguments.length-2,e=0;e<=b;e++)c=c.replace(new RegExp("\\{"+e+"\\}","gi"),arguments[e+1]);return c};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(c){var h=new RegExp("^"+c),b=this;h.test(b)&&(b=b.slice(1,b.length));h=new RegExp(c+"$");h.test(b)&&(b=b.slice(0,-1));return b};String.toSearchString=function(c){"undefined"===
typeof c&&(c="");for(var h="",b=0;b<c.length;b+=1)-1===" .,;#".indexOf(c[b])&&(h+=c[b]);return h=h.toLowerCase()};String.contains=function(c,h){return-1!==c.indexOf(h)};String.startsWith=function(c,h){return 0===c.indexOf(h)};Array.distinct=function(c){var h=[],b=c.length,e,l,d;for(l=0;l<b;l++){e=void 0;for(d=0;d<h.length;d++)if(c[l].toLowerCase()===h[d].toLowerCase()){e=!0;break}e||h.push(c[l])}return h};Object.isEmpty=function(c){if(!c)return!0;var h=!0,b;for(b in c){h=!1;break}return h};n.dateFromWcf=
function(c,h){var b=/Date\(([^)]+)\)/.exec(c);if(2!=b.length){if(!h)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(b[1]))};c.storage=c.storage||{};c.storage.urlFactory=new function(){c.bag=c.bag||{};var g=function(c){"object"===typeof c&&0<c.length&&("string"===typeof c[0]||"number"===typeof c[0])&&(c=c.join(","));c||(c="");return c};this.application={applicationServiceUrl:"application",getSessionCreateUrl:function(){return String.format("{0}/session",this.applicationServiceUrl)}};
this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(c,b){return String.format("{0}/create?fields={1}",this.userServiceUrl,g(b))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(c,b,e){return String.format("{0}/{1}?fields={2}",c,b,g(e))},getUserByTokenUrl:function(c){return String.format("{0}/me?useridtype=token&token={1}",
this.userServiceUrl,c)},getUserByUsernameUrl:function(c){return String.format("{0}/{1}?useridtype=username",this.userServiceUrl,c)},getUpdateUrl:function(c,b,e){return e?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,c,g(b),e):String.format("{0}/{1}?fields={2}",this.userServiceUrl,c,g(b))},getDeleteUrl:function(c,b,e){return!0===e?String.format("{0}/{1}?deleteconnections=true",this.userServiceUrl,b):String.format("{0}/{1}",this.userServiceUrl,b)},getGetAllLinkedAccountsUrl:function(c){return String.format("{0}/{1}/linkedaccounts",
this.userServiceUrl,c)},getValidateTokenUrl:function(c){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,c)},getInvalidateTokenUrl:function(c){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,c)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(c){return String.format("{0}/{1}/changepassword",this.userServiceUrl,c)},getLinkAccountUrl:function(c){return String.format("{0}/{1}/link",
this.userServiceUrl,c)},getDelinkAccountUrl:function(c,b){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,c,b)},getCheckinUrl:function(c,b,e){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,c,b,e)},getResetPasswordUrl:function(c){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,c)},getValidateResetPasswordUrl:function(c){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,c)}};this.device={deviceServiceUrl:"device",
getCreateUrl:function(c,b){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,g(b))},getGetUrl:function(c,b,e){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,g(e))},getUpdateUrl:function(c,b,e){return e?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,c,g(b),e):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,c,g(b))},getDeleteUrl:function(c,b,e){return!0===e?String.format("{0}/{1}?deleteconnections=true",this.deviceServiceUrl,b):String.format("{0}/{1}",
this.deviceServiceUrl,b)}};this.object={objectServiceUrl:"object",getSearchAllUrl:function(c,b,e){var g="",g=String.format("{0}/search/{1}/all",this.objectServiceUrl,c),g=e?g+"?psize="+e:g+"?psize=10";if("undefined"!==typeof b&&0<b.length)for(c=0;c<b.length;c+=1)0!==b[c].trim().length&&(g=g+"&"+b[c]);return g},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.objectServiceUrl)},getPropertiesSearchUrl:function(c,b){return String.format("{0}/search/{1}/all?properties={2}",
this.objectServiceUrl,c,b)},getMultiGetUrl:function(c,b,e){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.objectServiceUrl,c,b,g(e))},getCreateUrl:function(c,b){return String.format("{0}/{1}?fields={2}",this.objectServiceUrl,c,g(b))},getGetUrl:function(c,b,e){return String.format("{0}/{1}/{2}?fields={3}",this.objectServiceUrl,c,b,g(e))},getUpdateUrl:function(c,b,e,l){return l?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.objectServiceUrl,c,b,g(e),l):String.format("{0}/{1}/{2}?fields={3}",
this.objectServiceUrl,c,b,g(e))},getDeleteUrl:function(c,b,e){return!0===e?String.format("{0}/{1}/{2}?deleteconnections=true",this.objectServiceUrl,c,b):String.format("{0}/{1}/{2}",this.objectServiceUrl,c,b)},getMultiDeleteUrl:function(c){return String.format("{0}/{1}/bulkdelete",this.objectServiceUrl,c)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(c,b,e){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,c,b,g(e))},getMultiGetUrl:function(c,b,e){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.connectionServiceUrl,c,b,g(e))},getCreateUrl:function(c,b){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,c,g(b))},getUpdateUrl:function(c,b,e,l){return l?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,c,b,g(e),l):String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,c,b,g(e))},getDeleteUrl:function(c,b){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,c,b)},getMultiDeleteUrl:function(c){return String.format("{0}/{1}/bulkdelete",
this.connectionServiceUrl,c)},getSearchByArticleUrl:function(c,b,e,g){var d="",d=String.format("{0}/{1}/find/all?label={2}&objectid={3}",this.connectionServiceUrl,c,e,b);if("undefined"!==typeof g&&0<g.length)for(c=0;c<g.length;c+=1)d=d+"&"+g[c];return d},getConnectedArticles:function(c,b,e){var g="",g=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,c,b);if(e&&e.length&&0<e.length)for(c=0;c<e.length;c+=1)g=0===c?g+("?"+e[c]):g+("&"+e[c]);return g},getInterconnectsUrl:function(){return String.format("{0}/interconnects",
this.connectionServiceUrl)},getPropertiesSearchUrl:function(c,b){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,c,b)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(c){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,c)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(c){return String.format("{0}/notification/{1}",this.pushServiceUrl,
c)},getGetAllNotificationsUrl:function(c){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,c.psize,c.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(c,b){return b&&0<b.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",this.fileServiceUrl,escape(c),escape(b)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(c))},getUpdateUrl:function(c,b){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,c,escape(b))},getDownloadUrl:function(c,b){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,c,b)},getDeleteUrl:function(c){return String.format("{0}/delete/{1}",this.fileServiceUrl,c)}};this.query={params:function(c){var b=[];return""===location.search||-1===location.search.indexOf("?")?b:c?(c=c.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(e,g){var d=g.split("="),m=d[1];2<d.length&&d.forEach(function(b,c){0!==b&&1!==b&&(m=m+"="+
d[b])});d[0].toLowerCase()===c&&(b=[d[0],m])}),b):location.search.split("?")[1].split("=")}};this.usergroup={usergroupServiceUrl:"usergroup",getUpdateUrl:function(c){return String.format("{0}/{1}/members",this.usergroupServiceUrl,c)}};this.ping={pingServiceUrl:"ping",getPingUrl:function(){return String.format("{0}/",this.pingServiceUrl)}};this.multi={multiServiceUrl:"multi",getBatchUrl:function(){return String.format("{0}/",this.multiServiceUrl)}}}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h;h=c.runtime.isNode?process.nextTick:setTimeout;var b=function(){if(!(this instanceof b))return new b;this.calls=[]};b.prototype.isResolved=function(){return 1===this.state?!0:!1};b.prototype.isRejected=function(){return 2===this.state?!0:!1};b.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};b.prototype.done=function(){var e,g,d=this.state,h=this.value;if(!d)return this;for(;e=this.calls.shift();)if(g=e[0],"function"===
typeof e[d]){try{h=2===d?e[d].call(g,this.value):e[d].apply(g,this.value)}catch(f){c.logs.logException({name:f.name,message:f.message,stack:f.stack});if(0==g.calls.length)throw f;g.reject(f)}h instanceof b||h&&"function"===typeof h.then?h.then(function(b){g.fulfill(b)},function(b){g.reject(b)}):1===d?g.fulfill(h):g.reject(h)}else 1===d?g.fulfill(h):g.reject(h)};b.prototype.fulfill=function(b){if(this.state)return this;this.state=1;this.reason=this.value=[].slice.call(arguments);this.done();return this};
b.prototype.resolve=b.prototype.fulfill;b.prototype.reject=function(b){if(this.state)return this;this.state=2;this.reason=this.value=b;this.done();return this};b.prototype.then=function(c,g){var d=this,m=new b;this.calls[this.calls.length]=[m,c,g];this.state&&h(function(){d.done()});return m};b.when=function(c){var l=[],d=[],m,f=0,k=new b;if(!c||g.isArray(c)&&0==c.length)return k.fulfill(l),k;var p=function(){f+=1;f==m&&(k.state||(0<d.length?k.reject(d,l?l:[]):k.fulfill(l?l:[])))},t=function(f){var k=
c[f];k instanceof b||k&&"function"===typeof k.then?h(function(){k.then(function(b){l[f]=b;p()},function(b){d[f]=b;p()})}):h(function(){try{l[f]=k.call()}catch(b){d[f]=b}p()})};g.isArray(c)||(c=[c]);m=c.length;for(var q=0;q<m;q+=1)t(q);return k};b.is=function(c){return c instanceof b?!0:!1};b.buildPromise=function(c){var h=new b;g.isObject(c)&&h.then(c.success,c.error);return h};b._continueUntil=function(c,h){return g.isFunction(c)&&c()?h().then(function(){return b._continueUntil(c,h)}):(new b).fulfill()};
c.Promise=b})(global);
(function(n){n.Appacitive.eventManager=new function(){function c(){var c=function(){return Math.floor(65536*Math.random()).toString(16)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}var g={};this.subscribe=function(h,b){if("string"!=typeof h||"function"!=typeof b)throw Error("Incorrect subscription call");"undefined"==typeof g[h]&&(g[h]=[]);var e=c();g[h].push({callback:b,id:e});return e};this.unsubscribe=function(c){if(!c)return!1;var b=-1,e=null,l;for(l in g)for(var d=0;d<g[l].length;d+=
1)if(g[l][d].id==c){b=d;e=l;break}return-1!=b?(g[e].splice(b,1),!0):!1};this.fire=function(c,b,e){if("string"!=typeof c)throw Error("Incorrect fire call");if("undefined"==typeof e||null===e)e={};e.eventName=c;if("undefined"!=typeof g.all)for(var l=0;l<g.all.length;l+=1)g.all[l].callback(b,e);l=function(b,f,c){setTimeout(function(){b(f,c)},0)};if("undefined"!=typeof g[c])for(var d=0;d<g[c].length;d+=1)l(g[c][d].callback,b,e)};this.clearSubscriptions=function(c){if("string"!=typeof c)throw Error("Event Name must be string in EventManager.clearSubscriptions");
g[c]&&(g[c].length=0);return this};this.clearAndSubscribe=function(c,b){this.clearSubscriptions(c);this.subscribe(c,b)};this.dump=function(){console.dir(g)}}})(global);
(function(n){var c={},g=Array.prototype.forEach,h=Object.prototype.hasOwnProperty,b=Array.prototype.slice,e=0,l=function(){return{keys:Object.keys,uniqueId:function(b){var f=++e+"";return b?b+f:f},has:function(b,f){return h.call(b,f)},each:function(b,f,k){if(null!=b)if(g&&b.forEach===g)b.forEach(f,k);else if(b.length===+b.length)for(var d=0,e=b.length;d<e&&f.call(k,b[d],d,b)!==c;d++);else for(d in b)if(this.has(b,d)&&f.call(k,b[d],d,b)===c)break},once:function(b){var f=!1,c;return function(){if(f)return c;
f=!0;c=b.apply(this,arguments);b=null;return c}}}}(),d;d={on:function(b,c,k){if(!f(this,"on",b,[c,k])||!c)return this;this._events||(this._events={});(this._events[b]||(this._events[b]=[])).push({callback:c,context:k,ctx:k||this});return this},once:function(b,c,k){if(!f(this,"once",b,[c,k])||!c)return this;var d=this,g=l.once(function(){d.off(b,g);c.apply(this,arguments)});g._callback=c;return this.on(b,g,k)},off:function(b,c,k){var d,g,e,h,m,n,v,w;if(!this._events||!f(this,"off",b,[c,k]))return this;
if(!b&&!c&&!k)return this._events={},this;h=b?[b]:l.keys(this._events);m=0;for(n=h.length;m<n;m++)if(b=h[m],e=this._events[b]){this._events[b]=d=[];if(c||k)for(v=0,w=e.length;v<w;v++)g=e[v],(c&&c!==g.callback&&c!==g.callback._callback||k&&k!==g.context)&&d.push(g);d.length||delete this._events[b]}return this},trigger:function(c){if(!this._events)return this;var d=b.call(arguments,1);if(!f(this,"trigger",c,d))return this;var g=this._events[c],e=this._events.all;g&&k(g,d);e&&k(e,arguments);return this},
stopListening:function(b,c,f){var k=this._listeners;if(!k)return this;var d=!c&&!f;"object"===typeof c&&(f=this);b&&((k={})[b._listenerId]=b);for(var g in k)k[g].off(c,f,this),d&&delete this._listeners[g];return this}};var m=/\s+/,f=function(b,c,f,k){if(!f)return!0;if("object"===typeof f){for(var d in f)b[c].apply(b,[d,f[d]].concat(k));return!1}if(m.test(f)){f=f.split(m);d=0;for(var g=f.length;d<g;d++)b[c].apply(b,[f[d]].concat(k));return!1}return!0},k=function(b,f){var c,k=-1,d=b.length,g=f[0],e=
f[1],h=f[2];switch(f.length){case 0:for(;++k<d;)(c=b[k]).callback.call(c.ctx);break;case 1:for(;++k<d;)(c=b[k]).callback.call(c.ctx,g);break;case 2:for(;++k<d;)(c=b[k]).callback.call(c.ctx,g,e);break;case 3:for(;++k<d;)(c=b[k]).callback.call(c.ctx,g,e,h);break;default:for(;++k<d;)(c=b[k]).callback.apply(c.ctx,f)}};l.each({listenTo:"on",listenToOnce:"once"},function(b,c){d[c]=function(c,f,k){var d=this._listeners||(this._listeners={}),g=c._listenerId||(c._listenerId=l.uniqueId("l"));d[g]=c;"object"===
typeof f&&(k=this);c[b](f,k,this);return this}});d.bind=d.on;d.unbind=d.off;d.mixin=function(b){l.each("on once off trigger stopListening listenTo listenToOnce bind unbind".split(" "),function(c){b[c]=this[c]},this);return b};n.Appacitive.Events=d})(global);
(function(n){n.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/v1.0/",metadata:!0};n.navigator&&_type.isObject(n.navigator.userAgent)&&_type.isFunction(n.navigator.userAgent.indexOf)&&(-1!=n.navigator.userAgent.indexOf("MSIE 8")||-1!=n.navigator.userAgent.indexOf("MSIE 9"))&&(n.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/v1.0/")})(global);
(function(n){var c=n.Appacitive,g=c.utils._type;n=function(h){var b;if(!h||!g.isObject(h))throw Error("Please specify request options");this.promise=c.Promise.buildPromise(h.options);var e=this.request=new c.HttpRequest;b=c.storage.urlFactory[h.type];var l=h.op.replace("get","").replace("Url","")+" "+h.type;b=c.config.apiBaseUrl+b[h.op].apply(b,h.args||[]);e.url=b;e.description=l;e.method=h.method||"get";e.data=h.data||{};e.onSuccess=h.onSuccess;e.onError=h.onError;e.promise=this.promise;e.options=
h.options;h.entity&&(e.entity=h.entity);return this};n.prototype.send=function(){return c.http.send(this.request)};c._Request=n})(global);
(function(n){n=n.Appacitive;var c=n.utils._type,g=n.utils._extend;n.Error=function(g,b,e,l){if(c.isString(g)||c.isNumber(g))g={code:g,message:b,referenceId:e,additionalMessages:l};this.code=g.code||"400";this.message=g.message||"Unknown Error";g.referenceId&&(this.referenceId=g.referenceid||g.referenceId);g.additionalmessages&&(this.additionalMessages=g.additionalmessages||additionalMessages)};n.Error.toJSON=function(c){return{code:c.code,message:c.message,referenceId:c.referenceId,additionalmessages:c.additionalMessages}};
g(n.Error,{BadRequest:"400",AccessControl:"401",PaymentRequired:"402",UsageLimitReached:"403",NotFound:"404",Duplicate:"435",MvccFailure:"409",PreconditionFailed:"412",ApiAuthenticationError:"420",IdentityFailures:"421",IncorrectConfiguration:"436",InternalServerError:"500",DataAccessFailure:"512",UnknownCause:100,InvalidParameters:"400",ConnectionFailed:1001,MissingId:"404",InvalidJson:1007,DuplicateUsername:"435",DuplicateValue:"435",XDomainRequest:5E3})})(global);
(function(n){var c=n.Appacitive,g=c.utils._type;c.Session=new function(){this.initialized=!1;var h=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},b=null,e=null,l=null,d=!1,m;this.useApiKey=!0;this.useMasterKey=!1;this.onSessionCreated=function(){};this.recreate=function(b){return c.Session.create(b)};this.create=function(f){if(!this.initialized)throw Error("Initialize Appacitive SDK");var d=new h;d.apikey=e;var g=new c._Request({method:"PUT",type:"application",
op:"getSessionCreateUrl",options:f,data:d,onSuccess:function(f){b=f.session.sessionkey;c.Session.useApiKey=!1;g.promise.fulfill(f);c.Session.onSessionCreated()}});return g.send()};c.http.addProcessor({pre:function(f){f.options=f.options||{};if(c.Session.useApiKey){var p=e;(f.options.useMasterKey||c.useMasterKey&&!f.options.useMasterKey)&&g.isString(m)&&0<m.length?p=m:g.isString(f.options.apikey)&&(p=f.options.apikey);f.headers.push({key:"ak",value:p})}else f.headers.push({key:"as",value:b});p=g.isString(f.options.userToken)&&
0<f.options.userToken.length?f.options.userToken:!1;if(!0===d||p){var t=-1,q=f.headers.filter(function(b,f){return"ut"==b.key?(t=f,!0):!1});if(f.options.ignoreUserToken)-1!=t&&f.headers.splice(t,1);else{var r=p||l;1==q.length?f.headers.forEach(function(b){"ut"==b.key&&(b.value=r)}):f.headers.push({key:"ut",value:r})}}}});this.setUserAuthHeader=function(b,f,g){try{b&&(d=!0,l=b,g||(f||(f=-1),-1==f&&(f=null),c.LocalStorage.set("Appacitive-UserToken",b),c.LocalStorage.set("Appacitive-UserTokenExpiry",
f),c.LocalStorage.set("Appacitive-UserTokenDate",(new Date).getTime())))}catch(e){}};this.incrementExpiry=function(){try{c.runtime.isBrowser&&d&&c.LocalStorage.set("Appacitive-UserTokenDate",(new Date).getTime())}catch(b){}};this.removeUserAuthHeader=function(b,f){var g=c.Promise.buildPromise(f);b||c.User.trigger("logout",{});c.LocalStorage.remove("Appacitive-User");if(l&&b)try{var e=new c.HttpRequest(f);e.url=c.config.apiBaseUrl+c.storage.urlFactory.user.getInvalidateTokenUrl(l);e.method="POST";
e.data={};e.type="user";e.options=f;e.description="InvalidateToken user";e.onSuccess=e.onError=function(){d=!1;l=null;c.User.trigger("logout",{});c.LocalStorage.remove("Appacitive-UserToken");c.LocalStorage.remove("Appacitive-UserTokenExpiry");c.LocalStorage.remove("Appacitive-UserTokenDate");g.fulfill()};c.http.send(e);return g}catch(r){}else return d=!1,l=null,c.LocalStorage.remove("Appacitive-UserToken"),c.LocalStorage.remove("Appacitive-UserTokenExpiry"),c.LocalStorage.remove("Appacitive-UserTokenDate"),
g.fulfill()};this.isSessionValid=function(b){if(b.status){if(b.status.code&&("420"==b.status.code||"19027"==b.status.code||"19002"==b.status.code))return{status:!1,isSession:"19027"==b.status.code||"420"==b.status.code?!0:!1}}else if(b.code&&("420"==b.code||"19027"==b.code||"19002"==b.code))return{status:!1,isSession:"19027"==b.code||"420"==b.code?!0:!1};return{status:!0}};this.resetSession=function(){b=null;this.useApiKey=!0};this.get=function(){return b};this.setSession=function(f){f&&(b=f,this.useApiKey=
!1)};this.setApiKey=function(b){b&&(e=b,this.useApiKey=!0)};this.setMasterKey=function(b){m=b};this.reset=function(){this.removeUserAuthHeader();l=e=b=null;d=!1;m=null;this.useMasterKey=this.useApiKey=this.initialized=!1};var f="sandbox";this.environment=function(){if(1==arguments.length){var b=arguments[0];"sandbox"!=b&&"live"!=b&&(b="sandbox");f=b}return f}};c.getAppPrefix=function(g){return c.Session.environment()+"/"+c.appId+"/"+g};c.ping=function(g){if(!c.Session.initialized)throw Error("Initialize Appacitive SDK");
var b=new c._Request({method:"GET",type:"ping",op:"getPingUrl",options:g,onSuccess:function(c){return b.promise.fulfill(c.status)}});return b.send()};c.reset=function(){c.Session.reset()}})(global);(function(n){var c=n.Appacitive;c&&c.http&&(c.http.addProcessor({pre:function(g){var h=c.Session.environment();g.options=g.options||{};_type.isString(g.options.env)&&(h=g.options.env);g.headers.push({key:"e",value:h})}}),c.Events.mixin(c))})(global);
(function(n){var c=n.Appacitive,g=c.utils._type;c.GeoCoord=function(b,f){var k=function(b,f){if(isNaN(b)||isNaN(f))throw Error("Invalid Latitiude or longitiude provided");if(-90>b||90<b)throw Error("Latitude "+b+" should be in range of  -90.0 to 90.");if(-180>f||180<f)throw Error("Latitude "+f+" should be in range of  -180.0 to 180.");},d=function(b){if("string"!==typeof b||0==b.length)return!1;b=b.split(",");if(2!==b.length)return!1;try{return new c.GeoCoord(b[0],b[1])}catch(f){return!1}};if(g.isString(b)&&
!f&&(d=d(b)))return d;b&&f?(k(b,f),this.lat=b,this.lng=f):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",b,f)};this.toString=function(){return this.getValue()}};var h=function(){this.toString=function(){};this.Or=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new t(q.or,b)};this.And=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new t(q.and,
b)}},b=function(b){h.call(this);b=b||{};this.fieldType=b.fieldType;this.field=b.field||"";this.value=b.value;this.operator=b.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue())}};b.prototype=new h;b.prototype.constructor=b;var e=function(f){f=f||"";
if(!g.isArray(f.value)||!f.value.length)throw Error("Specify field value as array");b.call(this,f);var k=function(b){return g.isString(b)?"'"+b+"'":g.isNumber(b)?b:g.isDate(b)?"datetime('"+c.Date.toISOString(b)+"')":"'"+b.toString()+"'"};this.toString=function(){for(var b=[],f=0;f<this.value.length;f+=1)b.push(String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,k(this.value[f])));return"("+b.join(" or ")+")"}};e.prototype=new b;e.prototype.constructor=e;var l=
function(f){f=f||"";if(!g.isArray(f.value)||!f.value.length)throw Error("Specify field value as array");b.call(this,f);var c=function(b){return g.isString(b)?"'"+b+"'":g.isNumber(b)?b:b.toString()};this.toString=function(){for(var b=[],f=0;f<this.value.length;f+=1)b.push(c(this.value[f]));return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,b.join(","))}};l.prototype=new b;l.prototype.constructor=l;var d=function(f){b.call(this,f||"");this.toString=function(){return String.format("{0}{1} {2}",
this.getFieldType(),this.field.toLowerCase(),this.operator)}};d.prototype=new b;d.prototype.constructor=d;var m=function(f){f=f||"";if(!f.val1)throw Error("Specify field value1 ");if(!f.val2)throw Error("Specify field value2 ");this.val1=f.val1;this.val2=f.val2;b.call(this,f);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};m.prototype=new b;m.prototype.constructor=
m;var f=function(f){f=f||"";if(!(f.geoCoord&&f.geoCoord instanceof c.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");b.call(this,f);this.value=f.geoCoord;this.unit=f.unit||"mi";this.distance=f.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue(),this.distance,this.unit)}};f.prototype=new b;f.prototype.constructor=m;var k=function(f){f=f||"";if(!f.geoCoords||
0===f.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");if(3>f.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");b.call(this,f);this.value=f.geoCoords;var c=function(b){var f="";b.forEach(function(b){f=0===f.length?b.toString():f+(" | "+b.toString())});return f};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,c(this.value))}};
k.prototype=new b;k.prototype.constructor=m;var p=function(b){h.call(this);b=b||{};if(!b.tags||!g.isArray(b.tags)||0===b.tags.length)throw Error("Specify valid tags");this.tags=b.tags;this.operator=b.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};p.prototype=new h;p.prototype.constructor=p;var t=function(b,f){if(!f||!f.length||2>f.length)throw Error("Provide valid or atleast 2 filters");this.operator=b;this.innerFilters=[];for(var c=0;c<f.length;c+=
1){if(!(f[c]instanceof h))throw Error("Invalid filter provided");this.innerFilters.push(f[c])}this.toString=function(){var b=this.operator,f="(";this.innerFilters.forEach(function(c){f=1===f.length?f+(" "+c.toString()):f+String.format(" {0} {1} ",b,c.toString())});return f+=")"}};t.prototype=new h;t.prototype.constructor=t;var q={isEqualTo:"==",notEqualTo:"<>",isGreaterThan:">",isGreaterThanEqualTo:">=",isLessThan:"<",isLessThanEqualTo:"<=",like:"like",match:"match",between:"between",withinCircle:"within_circle",
withinPolygon:"within_polygon",or:"or",and:"and",taggedWithAll:"tagged_with_all",taggedWithOneOrMore:"tagged_with_one_or_more",isNull:"is null",containedIn:"in",isNotNull:"is not null",notIn:"not in"},r=function(b,f){if(null===b||void 0===b||0===b.length)throw Error("Specify value");this.value=b;this.type=f?f:typeof this.value;if("number"===this.type&&!g.isNumeric(this.value))throw Error("Value should be numeric for filter expression");this.getValue=function(){return"number"===this.type||g.isBoolean(this.value)||
g.isNumber(this.value)?this.value:"object"===this.type&&g.isDate(this.value)?"datetime('"+c.Date.toISOString(this.value)+"')":"object"==this.type&&this.value instanceof c.GeoCoord?this.value.toString():"'"+this.value.toString()+"'"}},u=function(c,g,p){p||(p=this);p.type=c;p.name=g;p.equalTo=function(f){return new b({field:this.name,fieldType:this.type,value:new r(f),operator:q.isEqualTo})};p.notEqualTo=function(f){return new b({field:this.name,fieldType:this.type,value:new r(f),operator:q.notEqualTo})};
p.greaterThan=function(f){return new b({field:this.name,fieldType:this.type,value:new r(f),operator:q.isGreaterThan})};p.greaterThanEqualTo=function(f){return new b({field:this.name,fieldType:this.type,value:new r(f),operator:q.isGreaterThanEqualTo})};p.lessThan=function(f){return new b({field:this.name,fieldType:this.type,value:new r(f),operator:q.isLessThan})};p.lessThanEqualTo=function(f){return new b({field:this.name,fieldType:this.type,value:new r(f),operator:q.isLessThanEqualTo})};p.like=function(f){return new b({field:this.name,
fieldType:this.type,value:new r("*"+f+"*"),operator:q.like})};p.match=function(f){return new b({field:this.name,fieldType:this.type,value:new r("*"+f+"*"),operator:q.match})};p.startsWith=function(f){return new b({field:this.name,fieldType:this.type,value:new r(f+"*"),operator:q.like})};p.endsWith=function(f){return new b({field:this.name,fieldType:this.type,value:new r("*"+f),operator:q.like})};p.contains=function(b){return new e({field:this.name,fieldType:this.type,value:b,operator:q.isEqualTo})};
p.containedIn=function(b){return new l({field:this.name,fieldType:this.type,value:b,operator:q.containedIn})};p.isNull=function(){return new d({field:this.name,fieldType:this.type,operator:q.isNull})};p.notIn=function(b){return new l({field:this.name,fieldType:this.type,value:b,operator:q.notIn})};p.isNotNull=function(){return new d({field:this.name,fieldType:this.type,operator:q.isNotNull})};p.between=function(b,f){return new m({field:this.name,fieldType:this.type,val1:new r(b),val2:new r(f),operator:q.between})};
p.withinCircle=function(b,c,k){return new f({field:this.name,fieldType:this.type,geoCoord:b,distance:c,unit:k,operator:q.withinCircle})};p.withinPolygon=function(b){return new k({field:this.name,fieldType:this.type,geoCoords:b,operator:q.withinPolygon})}},x=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;u("property",b,this);return this},y=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;var f=new u("aggregate",b);this.equalTo=function(b){return f.equalTo(b)};
this.notEqualTo=function(b){return f.notEqualTo(b)};this.greaterThan=function(b){return f.greaterThan(b)};this.greaterThanEqualTo=function(b){return f.greaterThanEqualTo(b)};this.lessThan=function(b){return f.lessThan(b)};this.lessThanEqualTo=function(b){return f.lessThanEqualTo(b)};this.between=function(b,c){return f.between(b,c)};this.contains=function(b){return f.contains(b)};return this},z=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;var f=new u("attribute",b);
this.like=function(b){return f.like(b)};this.match=function(b){return f.match(b)};this.startsWith=function(b){return f.startsWith(b)};this.endsWith=function(b){return f.endsWith(b)};this.equalTo=function(b){return f.equalTo(b)};this.notEqualTo=function(b){return f.notEqualTo(b)};this.contains=function(b){return f.contains(b)};this.containedIn=function(b){return f.containedIn(b)};this.notIn=function(b){return f.notIn(b)};this.isNull=function(){return f.isNull()};this.isNotNull=function(){return f.isNull()};
return this};c.Filter={Property:function(b){return new x(b)},Aggregate:function(b){return new y(b)},Attribute:function(b){return new z(b)},Or:function(){return new t(q.or,arguments)},And:function(){return new t(q.and,arguments)},taggedWithOneOrMore:function(b){return new p({tags:b,operator:q.taggedWithOneOrMore})},taggedWithAll:function(b){return new p({tags:b,operator:q.taggedWithAll})}}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.utils._extend;c.Queries={};var b=function(b){b=b||{};this._pageNumber=1;this._pageSize=null;this.isPageDefault=!0;this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};b.prototype.pageNumber=function(){return 1!=arguments.length||g.isNullOrUndefined(arguments[0])?this._pageNumber:(this._pageNumber=arguments[0]||1,this.isPageDefault=!1,this)};b.prototype.pageSize=function(){return 1!=arguments.length||g.isNullOrUndefined(arguments[0])?this._pageSize:
(this._pageSize=arguments[0],this.isPageDefault=!1,this)};b.prototype.resetPaging=function(){this._pageSize=null;this._pageNumber=1;this.isPageDefault=!0;return this};b.prototype.pageString=function(){return"pnum="+this._pageNumber+(this._pageSize?"&psize="+this._pageSize:"")};var e=function(b){b=b||{};this._isAscending=!1;this._order=[];this.isSortSet=!1;g.isNullOrUndefined(b.isAscending)||this.isAscending(b.isAscending);this.orderBy(b.orderBy);b.ascending&&this.ascending(b.ascending);b.descending&&
this.descending(b.descending)};e.prototype.orderBy=function(){return 1===arguments.length&&g.isString(arguments[0])?(this._order=[{orderBy:arguments[0],isAscending:this._isAscending}],this.isSortSet=!0,this):this._order[0]?this._order[0].orderBy:null};e.prototype.isAscending=function(){if(1===arguments.length){var b=void 0===arguments[0]||null==arguments[0]?!1:arguments[0];this._order.forEach(function(c){c.isAscending=b});this._isAscending=b;this.isSortSet=!0;return this}return 0<this._order.length?
order[0].isAscending:this._isAscending};e.prototype.resetSorting=function(){this._order=[];this.isSortSet=this._isAscending=!1;return this};e.prototype._setSorting=function(b,c){if(arguments.length){var f=this;b.forEach(function(b){Array.isArray(b)&&(b=b.join());b.replace(/\s/g,"").split(",").forEach(function(b){var k=f._order.findWhere({orderBy:b.toLowerCase()});k?k.isAscending=c:f._order.push({orderBy:b.toLowerCase(),isAscending:c})})});this.isSortSet=!0}return this};e.prototype.ascending=function(){return this._setSorting(Array.prototype.slice.call(arguments),
!0)};e.prototype.descending=function(){return this._setSorting(Array.prototype.slice.call(arguments),!1)};e.prototype.sortString=function(){return this._order&&0<this._order.length?"orderBy="+this._order.map(function(b){return b.orderBy+" "+(b.isAscending?"asc":"desc")}).join(","):""};n=function(){};n.prototype._setPaging=function(b){b&&(this.pageNumber(b.pagenumber),this.pageSize(b.pagesize),this.results=this.results||[],this.results.isLastPage=!1,this.results.total=b.totalrecords,this.results.pageNumber=
b.pagenumber,this.results.pageSize=b.pagesize,b.pagenumber*b.pagesize>=b.totalrecords&&(this.results.isLastPage=!0))};n.prototype.fields=function(){if(1===arguments.length){var b=arguments[0];g.isString(b)?this._fields=[b]:g.isArray(b)&&b.length&&(this._fields=b);return this}return this._fields};n.prototype._parse=function(b,g,f){b||(b=[]);var k="object"===this.type()?"Object":"Connection";return c[k]._parseResult(b,f.entity,g)};n.prototype.collection=function(b,e){e=e||{};g.isObject(b)&&(e=b,b=null);
b||(b=this.results?this.results:[]);var f=options.entity;!f&&0<b.length&&b[0]instanceof c.BaseObject&&(f="object"==b[0].type?"Object":"Connection",f=c[f]._getClass(b[0].className));f||(f="object"===_etype?"Object":"Connection",f=c[f]._getClass(this[f]));return new c.Collection(b,h(e,{model:f,query:this}))};n.prototype.fetchNext=function(b){var c=this.pageNumber();if(!c||0>=c)c=1;this.pageNumber(++c);return this.fetch(b)};n.prototype.fetchPrev=function(b){var c=this.pageNumber();--c;if(!c||0>=c)c=
1;this.pageNumber(c);return this.fetch(b)};n.prototype.count=function(b){var g=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){b=b||{};b=b.paginginfo;var c=0,c=b?b.totalrecords:0;g.fulfill(c)};b.promise=g;b.entity=this;return c.http.send(b)};var l=function(d){var h=d||{};b.call(this,d);e.call(this,d);var f="",k="",p=h.queryType||"BasicQuery",t=h.type||h.relation,q=h.relation?"connection":"object",r=this;this._fields=[];h.entity&&(this.entity=h.entity);this.type=function(){return q};
this.entityType=function(){return t};this.queryType=function(){return p};this.filter=function(){return 1===arguments.length?(f=arguments[0],this):f};this.freeText=function(){if(1===arguments.length){var b=arguments[0];g.isString(b)?k=arguments[0]:g.isArray(b)&&b.length&&(k=arguments[0].join(" "));return this}return k};this.filter(h.filter||"");this.freeText(h.freeText||"");this.fields(h.fields||[]);this.setFilter=function(b){this.filter(b)};this.setFreeText=function(b){this.freeText(b)};this.setFields=
function(b){this.fields(b)};this.extendOptions=function(f){for(var c in f)h[c]=f[c];b.call(this,h);e.call(this,h);return this};this.getQueryString=function(){var b=this.pageString(),f=this.sortString();f&&(b+="&"+f);this.filter()&&(f=encodeURIComponent(this.filter().toString()),0<f.trim().length&&(b+="&query="+f));this.freeText()&&0<this.freeText().trim().length&&(b+="&freetext="+encodeURIComponent(this.freeText())+"&language=en");this._fields&&0<this._fields.length&&(b+="&fields="+this._fields.join(","));
return b};this.toUrl=function(){return{url:c.config.apiBaseUrl+q+"/"+t+"/find/all?"+this.getQueryString(),description:"FindAll "+t+" "+q+"s"}};this.toRequest=function(b){var f=new c.HttpRequest,k=this.toUrl();f.url=k.url;f.options=b;f.description=k.description;f.method="get";return f};this.getOptions=function(){var b={},f;for(f in this)this.hasOwnProperty(f)&&!g.isFunction(this[f])&&(b[f]=this[f]);return b};this.fetch=function(b){var f=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){r.results=
r._parse(b[q+"s"],b.__meta,h);r._setPaging(b.paginginfo);f.fulfill(r.results,b.paginginfo)};b.promise=f;b.entity=this;return c.http.send(b)};this.fetch=function(b){var f=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){r.results=r._parse(b[q+"s"],b.__meta,h);r._setPaging(b.paginginfo);f.fulfill(r.results,b.paginginfo)};b.promise=f;b.entity=this;return c.http.send(b)}};h(l.prototype,n.prototype,e.prototype,b.prototype);c.Queries.FindAllQuery=function(b){b=b||{};if(!b.type&&!b.relation)throw Error("Specify either type or relation for basic filter query");
b.queryType="FindAllQuery";l.call(this,b);return this};c.Queries.FindAllQuery.prototype=new l;c.Queries.FindAllQuery.prototype.constructor=c.Queries.FindAllQuery;c.Query=c.Queries.FindAllQuery;c.Queries.ConnectedObjectsQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for connected objects query");if(!b.objectId)throw Error("Specify objectId for connected objects query");if(!b.type)throw Error("Specify type of object id for connected objects query");var e=b.type;delete b.type;
b.queryType="ConnectedObjectsQuery";l.call(this,b);this.objectId=b.objectId;this.relation=b.relation;this.type=e;b.object instanceof c.Object&&(this.object=b.object);this.returnEdge=!0;void 0===b.returnEdge||null===b.returnEdge||b.returnEdge||(this.returnEdge=!1);this.label="";var f=this;g.isString(b.label)&&0<b.label.length&&(this.label="&label="+b.label);this.toUrl=function(){return{url:c.config.apiBaseUrl+"connection/"+this.relation+"/"+this.type+"/"+this.objectId+"/find?"+this.getQueryString()+
this.label+"&returnEdge="+this.returnEdge,description:"GetConnectedObjects for relation "+this.relation+" of type "+this.type+" for object "+this.objectId}};var k=function(b,k,d,g){var e=[];b.forEach(function(b){var f=b.__edge;delete b.__edge;var p=c.Object._create(h({__meta:d},b),!0);f&&(f.__endpointa=k,f.__endpointb={objectid:b.__id,label:f.__label,type:b.__type},delete f.label,p.connection=c.Connection._create(h({__meta:g},f),!0));e.push(p)});f.object&&(f.object.children[f.relation]=e);return e};
this.fetch=function(p){var g=c.Promise.buildPromise(p);p=this.toRequest(p);p.onSuccess=function(c){f.results=k(c.nodes?c.nodes:[],{objectid:b.objectId,type:e,label:c.parent},c.__nodemeta,c.__edgemeta);f._setPaging(c.paginginfo);g.fulfill(f.results,c.paginginfo)};p.promise=g;p.entity=this;return c.http.send(p)};return this};c.Queries.ConnectedObjectsQuery.prototype=new l;c.Queries.ConnectedObjectsQuery.prototype.constructor=c.Queries.ConnectedObjectsQuery;c.Queries.GetConnectionsQuery=function(b){b=
b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!b.objectId)throw Error("Specify objectId for GetConnectionsQuery query");if(!b.label||0===b.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");b.type&&delete b.type;b.queryType="GetConnectionsQuery";l.call(this,b);this.objectId=b.objectId;this.relation=b.relation;this.label=b.label;this.toUrl=function(){return{url:c.config.apiBaseUrl+"connection/"+this.relation+"/find/all?"+this.getQueryString()+
"&objectid="+this.objectId+"&label="+this.label,description:"FindAllConnections for relation "+this.relation+" from object id "+this.objectId}};return this};c.Queries.GetConnectionsQuery.prototype=new l;c.Queries.GetConnectionsQuery.prototype.constructor=c.Queries.GetConnectionsQuery;c.Queries.GetConnectionsBetweenObjectsQuery=function(b,e){b=b||{};delete b.entity;if(!b.objectAId||!g.isString(b.objectAId)||0===b.objectAId.length)throw Error("Specify valid objectAId for GetConnectionsBetweenObjectsQuery query");
if(!b.objectBId||!g.isString(b.objectBId)||0===b.objectBId.length)throw Error("Specify objectBId for GetConnectionsBetweenObjectsQuery query");b.type&&delete b.type;b.queryType=e||"GetConnectionsBetweenObjectsQuery";l.call(this,b);this.objectAId=b.objectAId;this.objectBId=b.objectBId;this.label="GetConnectionsBetweenObjectsForRelationQuery"===this.queryType()&&b.label&&g.isString(b.label)&&0<b.label.length?"&label="+b.label:"";this.relation=b.relation&&g.isString(b.relation)&&0<b.relation.length?
b.relation+"/":"";this.toUrl=function(){return{url:c.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.objectAId+"/"+this.objectBId+"?"+this.getQueryString()+this.label,description:"FindConnectionBetween for relation "+this.relation+" between object ids "+this.objectAId+" and "+this.objectBId}};return this};c.Queries.GetConnectionsBetweenObjectsQuery.prototype=new l;c.Queries.GetConnectionsBetweenObjectsQuery.prototype.constructor=c.Queries.GetConnectionsBetweenObjectsQuery;c.Queries.GetConnectionsBetweenObjectsForRelationQuery=
function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsBetweenObjectsForRelationQuery query");var g=new c.Queries.GetConnectionsBetweenObjectsQuery(b,"GetConnectionsBetweenObjectsForRelationQuery");g.fetch=function(f){var k=c.Promise.buildPromise(f);f=this.toRequest(f);f.onSuccess=function(f){g.results=f.connection?[c.Connection._create(h({__meta:f.__meta},f.connection),!0,b.entity)]:null;k.fulfill(g.results?g.results[0]:null)};f.promise=k;f.entity=this;return c.http.send(f)};
return g};c.Queries.InterconnectsQuery=function(b){b=b||{};delete b.entity;if(!b.objectAId||!g.isString(b.objectAId)||0===b.objectAId.length)throw Error("Specify valid objectAId for InterconnectsQuery query");if(!(b.objectBIds&&g.isArray(b.objectBIds)&&0<b.objectBIds.length))throw Error("Specify list of objectBIds for InterconnectsQuery query");b.type&&delete b.type;b.queryType="InterconnectsQuery";l.call(this,b);this.objectAId=b.objectAId;this.objectBIds=b.objectBIds;this.toRequest=function(b){var f=
new c.HttpRequest,k=this.toUrl();f.url=k.url;f.options=b;f.description=k.description;f.method="post";f.data={object1id:this.objectAId,object2ids:this.objectBIds};return f};this.toUrl=function(){return{url:c.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString(),description:"GetInterConnections between objects"}};return this};c.Queries.InterconnectsQuery.prototype=new l;c.Queries.InterconnectsQuery.prototype.constructor=c.Queries.InterconnectsQuery;c.Queries.GraphQuery=function(d,h,f){g.isObject(d)&&
(f=d,f.returnObjects=d.returnObjects||f.returnObjects,h=f.placeholders||{},d=f.name);if(!d||0===d.length)throw Error("Specify name of filter query");f=f||{};this.placeholders=h||{};this.returnObjects=f.returnObjects;b.call(this,f);e.call(this,f);this.name=d;this.queryType="GraphQuery";this.fields(f.fields||[]);var k=this;this.type=function(){return"object"};this.toRequest=function(b){var f=new c.HttpRequest,k=this.toUrl();f.url=k.url;f.options=b;f.description=k.description;f.method="post";this.data=
{};if(this.placeholders){this.data.placeholders=this.placeholders;for(var d in this.data.placeholders)this.data.placeholders[d]=this.data.placeholders[d]}f.data=this.data;return f};this.getQueryString=function(){var b=[];this.isPageDefault||b.push(this.pageString());this.isSortSet&&b.push(this.sortString());this._fields&&0<this._fields.length&&b.push("fields="+this._fields.join(","));return b.join("&")};this.toUrl=function(){return{url:c.config.apiBaseUrl+"search/"+this.name+"/"+(this.returnObjects?
"graphquery":"filter")+"?"+this.getQueryString(),description:"Filter Query with name "+this.name}};this.fetch=function(b){var d=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){var c;k.returnObjects?(k.results=k._parse(b.objects,b.__meta,f),c=k.results):this.results=c=b.ids?b.ids:[];b.paginginfo&&k._setPaging(b.paginginfo);d.fulfill(c,b.paginginfo)};b.promise=d;b.entity=this;return c.http.send(b)}};h(c.Queries.GraphQuery.prototype,n.prototype,e.prototype,b.prototype);c.Queries.GraphAPI=
function(b,e,f){if(!b||0===b.length)throw Error("Specify name of project query");if(!e||!e.length)throw Error("Specify ids to project");this.name=b;this.data={ids:e};this.queryType="GraphApi";var k=this;if(f){this.data.placeholders=f;for(var p in this.data.placeholders)this.data.placeholders[p]=this.data.placeholders[p]}this.toRequest=function(b){var f=new c.HttpRequest,k=this.toUrl();f.url=k.url;f.description=k.description;f.method="post";f.data=this.data;f.options=b;return f};this.toUrl=function(){return{url:c.config.apiBaseUrl+
"search/"+this.name+"/project",description:"Project Query with name "+this.name}};var t=function(b){var f,k;for(k in b)if("status"!==k){f=b[k];break}var d=function(b,f,k,g,p){var e=[];b.forEach(function(b){var q=b.__children;delete b.__children;var r=b.__edge;delete b.__edge;b=c.Object._create(h({__meta:g},b),!0);b.children={};for(var t in q)b.children[t]=[],b.children[t]=d(q[t].values,q[t].parent,b.id,q[t].__nodemeta,q[t].__edgemeta);r&&(r.__endpointa={objectid:k,label:f},r.__endpointb={objectid:b.id,
label:r.__label},delete r.__label,b.connection=c.Connection._create(h({__meta:p},r),!0));e.push(b)});return e};return d(f.values,null,null,f.__nodemeta)};this.collection=function(b,f){f=f||{};g.isObject(b)&&(f=b,b=null);b||(b=this.results?ths.results:[]);var k;0<b.length&&b[0]instanceof c.BaseObject&&(k=c.Object._getClass(b[0].className));return new c.Collection(b,h(f,{model:k,query:this}))};this.fetch=function(b){var f=c.Promise.buildPromise(b);b=this.toRequest(b);b.onSuccess=function(b){k.results=
t(b);f.fulfill(k.results)};b.promise=f;b.entity=this;return c.http.send(b)}}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.utils._extend,b={__utcdatecreated:"datetime",__utclastupdateddate:"datetime"},e=function(b){return g.isString(b)||g.isNumber(b)||g.isBoolean(b)},l=function(b){return b instanceof c.GeoCoord},d=function(b){b=b||{};var f={},c;for(c in b.__meta)b.__meta[c].forEach(function(b){f[b]=c});return f},m={integer:function(b){if(b){var f=parseInt(b);if(!isNaN(f))return f}return b},decimal:function(b){if(b){var f=parseFloat(b);if(!isNaN(f))return f}return b},
"boolean":function(b){return g.isBoolean(b)?b:void 0!==b&&null!==b&&("true"===b.toString().toLowerCase()||!0===b||0<b)?!0:!1},date:function(b){if(g.isDate(b))return b;if(b){var f=c.Date.parseISODate(b);if(f)return f}return b},datetime:function(b){if(g.isDate(b))return b;if(b){var f=c.Date.parseISODate(b);if(f)return f}return b},time:function(b){if(g.isDate(b))return b;if(b){var f=c.Date.parseISOTime(b);if(f)return f}return b},string:function(b){return b?b.toString():b},geocode:function(b){if(l(b))return b;
if(!g.isString(b)||0==b.trim().length)return!1;b=b.split(",");return 2!==b.length?!1:new c.GeoCoord(b[0],b[1])}};m["long"]=m.integer;m.geography=m.geocode;m.text=m.string;m.bool=m["boolean"];c.utils._cast=m;c.utils._cast.isString=e;c.utils._cast.isGeocode=l;var f=function(b){return g.isNullOrUndefined(b)?null:e(b)?b+"":g.isDate(b)?c.Date.toISOString(b):g.isObject(b)?l(b)?b.toString():b.getObject?b.getObject():b:b};c.utils._encode=function(b){var c={},d;for(d in b){var e=b[d];g.isArray(e)?(c[d]=[],
e.forEach(function(b){(b=f(b))&&c[d].push(b)})):c[d]=f(b[d])}return c};c.utils._decode=function(f){var c={},e=h({},b,d(f));delete f.__meta;for(var q in f)g.isArray(f[q])?(c[q]=[],f[q].forEach(function(b){b=e[q]?m[e[q]](b):b;c[q].push(b)})):g.isString(f[q])?c[q]=e[q]?m[e[q]](f[q]):f[q]:c[q]=f[q];return c}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.utils._extend,b=c.utils._deepExtend,e=c.utils._cast,l=["__link","__endpointa","__endpointb"],d="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __type __relationtype __typeid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link __acls __meta".split(" "),m=function(b){return e.isString(b)||g.isDate(b)||e.isGeocode(b)};n=function(f,k){this._snapshot={};k=k||{};f=f||{};this.objectOptions=b({},f);this.meta=
{};this.objectOptions.__meta=h(this.meta,this.objectOptions.__meta);k&&k.parse&&(this.objectOptions=this.parse(this.objectOptions));this.defaults=c.utils._result(this,"defaults");g.isObject(this.defaults)&&!k.setSnapShot&&(this.objectOptions=b({},this._defaults,this.objectOptions));k&&k.collection&&(this.collection=k.collection);this.objectOptions=c.utils._decode(f);this.cid=parseInt(1E8*Math.random(),10);this.idAttribute="__id";this._atomicProps={};this._multivaluedProps={};this._setOps={};var d=
{};this._copy(this.objectOptions,d);k.setSnapShot&&this._copy(d,this._snapshot);!this._snapshot[this.idAttribute]&&d[this.idAttribute]&&(this._snapshot[this.idAttribute]=d[this.idAttribute]);this.id=this._snapshot[this.idAttribute];d.__type?(d.__type=d.__type.toLowerCase(),this.entityType="type",this.type="object",this.className=d.__type,this.base=c.Object.prototype):d.__relationtype&&(d.__relationtype=d.__relationtype.toLowerCase(),this.entityType="relation",this.type="connection",this.className=
d.__relationtype,this.base=c.Connection.prototype);"object"==this.type&&(this._destroyWithConnections=function(b){return this.destroy(h({deleteConnections:!0},b))});d.__attributes||(d.__attributes={});this._snapshot.__attributes||(this._snapshot.__attributes={});this._removeTags=[];d.__tags||(d.__tags=[]);this._snapshot.__tags||(this._snapshot.__tags=[]);this.attributes=this._object=d;this._fields="";this._mergePrivateFields(this.attributes)};h(n.prototype,{_copy:function(f,k){f.__meta=h(this.meta,
f.__meta);this.meta=f.__meta;this._mergePrivateFields(f);var d=c.utils._decode(f),e;for(e in d)e==this.idAttribute&&(this.id=d[e]),this._atomicProps[e]&&delete this._atomicProps[e],this._multivaluedProps[e]&&delete this._multivaluedProps[e],this._setOps[e]&&delete this._setOps[e],m(d[e])?k[e]=d[e]:g.isObject(d[e])?k[e]=b({},k[e],d[e]):g.isArray(d[e])?(k[e]=[],d[e].forEach(function(b){if(m(b)||"__link"==e)k[e].push(b);else throw Error("Multivalued property cannot add object or array as property of object");
})):k[e]=d[e]},_mergePrivateFields:function(b,k){var d={id:"id",__id:"id",__utclastupdateddate:"lastUpdatedAt",__utcdatecreated:"createdAt",__createdby:"createdBy",__updatedby:"lastUpdatedBy"},e=this;"id __id __utclastupdateddate __utcdatecreated __createdby __updatedby".split(" ").forEach(function(h){b[h]&&("__utcdatecreated"!==h&&"__utclastupdateddate"!==h||g.isDate(b[h])?e[d[h]]=b[h]:e[d[h]]=c.Date.parseISODate(b[h]),k&&delete b[h])})},_getOutpuStatus:function(b){b=b||{};b.message=b.message||"Server error";
b.code=b.code||"500";return b},getObject:function(){var f=c.utils._encode(b({__meta:this.meta},this._object));"connection"==this.type&&(f.__endpointa=this._object.__endpointa.toJSON(),f.__endpointb=this._object.__endpointb.toJSON());this.hasOwnProperty("id")&&(f.__id=this.id);return f},toJSON:function(f){if(f&&"object"==this.type){var c=function(b){var f=[];b.forEach(function(b){var d=b.toJSON();if(b.children&&!Object.isEmpty(b.children)){d.children={};for(var e in b.children)g.isArray(b.children[e])?
d[e]=c(b.children[e]):d[e]=c([b.children[e]])[0],d.children[e]=d[e]}b.connection&&(d.__connection=b.connection.toJSON());f.push(d)});return f};return c([this])[0]}f=b({__meta:this.meta},this._object);"connection"==this.type&&(this._object.__endpointa=this._object.__endpointa.toJSON(),this._object.__endpointb=this._object.__endpointb.toJSON());this.hasOwnProperty("id")&&this.id&&(f.__id=this.id);return f},properties:function(){var f=b({},this.attributes);delete f.__attributes;delete f.__tags;return f},
attr:function(){if(0===arguments.length)return this._object.__attributes||(this._object.__attributes={}),this._object.__attributes;if(1===arguments.length)return this._object.__attributes||(this._object.__attributes={}),this._object.__attributes[arguments[0]];if(2===arguments.length){if(!g.isString(arguments[1])&&null!==arguments[1])throw Error("only string values can be stored in attributes.");this._object.__attributes||(this._object.__attributes={});this._object.__attributes[arguments[0]]=arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");
this.triggerChangeEvent("__attributes");return this._object.__attributes},getChangedAttributes:function(){if(this._object.__attributes){if(!this._snapshot.__attributes)return this._object.__attributes;var b=!1,c=JSON.parse(JSON.stringify(this._snapshot.__attributes)),d;for(d in this._object.__attributes)null==this._object.__attributes[d]||void 0==this._object.__attributes[d]?(c[d]=null,b=!0):this._object.__attributes[d]!=this._snapshot.__attributes[d]?(c[d]=object.__attributes[d],b=!0):this._object.__attributes[d]==
this._snapshot.__attributes[d]&&delete c[d];return b?c:void 0}},aggregate:function(){var b={},c;for(c in this._object){if(!this._object.hasOwnProperty(c))return;"$"==c[0]&&(b[c.substring(1)]=this._object[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");},tags:function(){return this._object.__tags?this._object.__tags:[]},addTag:function(b){if(!b||!g.isString(b)||!b.length)return this;
this._object.__tags||(this._object.__tags=[]);this._object.__tags.push(b);this._object.__tags=Array.distinct(this._object.__tags);if(!_removeTags||!_removeTags.length)return this.triggerChangeEvent("__tags"),this;b=_removeTags.indexOf(b);-1!=b&&_removeTags.splice(b,1);this.triggerChangeEvent("__tags");return this},removeTag:function(b){if(!b||!g.isString(b)||!b.length)return this;this._removeTags.push(b);this._removeTags=Array.distinct(this._removeTags);if(!this._object.__tags||!this._object.__tags.length)return this.triggerChangeEvent("__tags"),
this;b=this._object.__tags.indexOf(b);-1!=b&&this._object.__tags.splice(b,1);this.triggerChangeEvent("__tags");return this},getChangedTags:function(){if(this._object.__tags){if(!this._snapshot.__tags)return this._object.__tags;var b=[],c=this;this._object.__tags.forEach(function(d){-1==c._snapshot.__tags.indexOf(d)&&b.push(d)});return 0<b.length?b:void 0}},getRemovedTags:function(){return this._removetags},_setMutliItems:function(b,c,d,e){if(!b||!g.isString(b)||0===b.length||0==b.trim().indexOf("__")||
0===b.trim().indexOf("$")||void 0==c||null==c)return this;b=b.toLowerCase();var h=this;try{var r=function(c){if(!m(c))throw Error("Multivalued property cannot have values of property as an object");if(h._object[b]&&g.isArray(h._object[b]))if("additems"==d)h._object[b].push(c);else if("adduniqueitems"==d){var k=-1;h._object[b].find(function(b,f){return g.isEqual(b,c)?(k=f,!0):!1});-1==k&&h._object[b].push(c)}else"removeitems"==d&&h._object[b].removeAll(c);else h._object[b]="removeitems"==d?[]:[c];
h._multivaluedProps[b]||(h._multivaluedProps[b]={additems:[],adduniqueitems:[],removeitems:[]});h._multivaluedProps[b][d].push(c)};g.isArray(c)?c.forEach(function(b){r(b)}):r(c);this.triggerChangeEvent(b,e)}catch(l){throw Error("Unable to add item to "+b);}return this},add:function(b,c,d){return this._setMutliItems(b,c,"additems",d)},addUnique:function(b,c,d){return this._setMutliItems(b,c,"adduniqueitems",d)},remove:function(b,c,d){return this._setMutliItems(b,c,"removeitems",d)},_hasChanged:function(b,
c,d,e){var h=void 0;g.isEqual(d,c)||("__tags"==b?(b=this.getChangedTags())&&0<b.length&&(h=b):"__attributes"==b?(b=this.getChangedAttributes(),Object.isEmpty(b)||(h=b)):g.isArray(d)?this._multivaluedProps[b]&&!this._setOps[b]?h=e?this._multivaluedProps[b]:d:d.equals(c)||(h=d):h=this._atomicProps[b]&&!this._setOps[b]?e?{incrementby:this._atomicProps[b].value}:d:d);return h},_getChanged:function(f){var k=!1,e=b({},this._snapshot),g;for(g in e)"$"==g[0]&&delete e[g];for(var h in this._object)g=this._hasChanged(h,
e[h],this._object[h],f),void 0===g?delete e[h]:(k=!0,e[h]=g);try{d.forEach(function(b){e[b]&&delete e[b]})}catch(r){}f&&(e=c.utils._encode(e));h=this.getChangedTags();f?(h&&0<h.length&&(e.__addtags=h,k=!0),this._removeTags&&0<this._removeTags.length&&(e.__removetags=this._removeTags,k=!0)):h&&0<h.length&&(e.__tags=h,k=!0);(f=this.getChangedAttributes())&&!Object.isEmpty(f)?(e.__attributes=f,k=!0):delete e.__attributes;"object"==this.type&&this._aclFactory&&(f=this._aclFactory.getChanged())&&(k=!0,
e.__acls=f);return k&&!Object.isEmpty(e)?e:!1},changed:function(){return this.isNew()?this.toJSON():this._getChanged()},hasChanged:function(){return this.isNew()?!0:0===arguments.length?Object.isEmpty(this._getChanged(!0))?!1:!0:1==arguments.length&&g.isString(arguments[0])&&0<arguments[0].length?void 0==this._hasChanged(arguments[0],this._snapshot[arguments[0]],this._object[arguments[0]])?!1:!0:!1},changedAttributes:function(){if(this.isNew())return this.toJSON();if(0===arguments.length)return this._getChanged();
if(1==arguments.length&&g.isArray(arguments[0])&&arguments[0].length){var b={},c=this;arguments[0].forEach(function(d){d=c._hasChanged(d,c._snapshot[d],c._object[d]);void 0!=d&&b.push(d)});return b}return!1},previous:function(){return this.isNew()?null:1==arguments.length&&g.isString(arguments[0])&&arguments[0].length?this._snapshot[arguments[0]]:null},previousAttributes:function(){return this.isNew()?null:h({},this._snapshot)},fields:function(){if(1==arguments.length){var b=arguments[0];g.isString(b)?
this._fields=b:g.isArray(b)&&(this._fields=b.join(","));return this}return this._fields},get:function(b,c){if(b){if(c&&e[c.toLowerCase()]){if(e[c.toLowerCase()])return e[c.toLowerCase()](this._object[b]);throw Error('Invalid cast-type "'+c+'"" provided for get "'+b+'"');}return this._object[b]}},tryGet:function(b,c,d){b=this.get(b,d);return void 0!==b?b:c},triggerChangeEvent:function(b,c){if(c&&!c.silent){var e=this._hasChanged(b,this._snapshot[b],this._object[b]);if(void 0!=e[b]||-1!=d.indexOf(b))this.trigger("change:"+
b,this,e[b]||this._object[b],{}),c.ignoreChange||this.trigger("change",this,c)}},triggerDestroy:function(b){b&&!b.silent&&this.trigger("destroy",this,this.collection,b)},_triggerError:function(b,c){b.silent||this.trigger("error",this,c,b)},_set:function(b,c,d){if(!b||!g.isString(b)||0===b.length||0===b.trim().indexOf("$"))return this;var e=this;b=b.toLowerCase();try{if(g.isNullOrUndefined(c))this._object[b]=null;else if(m(c))this._object[b]=c;else if(g.isObject(c))if(-1!==l.indexOf(b))this._object[b]=
c;else throw Error("Property cannot have value as an object");else g.isArray(c)&&(this._object[b]=[],c.forEach(function(c){if(m(c))e._object[b].push(c);else throw Error("Multivalued property cannot have values of property as an object");}));delete this._atomicProps[b];delete this._multivaluedProps[b];delete this._setOps[b];g.isEqual(this._object[b],this._snapshot[b])||(this._setOps[b]=!0);b==this.idAttribute&&(this.id=c);return this}catch(h){throw Error("Unable to set "+b);}},set:function(b,c,e){var g,
l;if(null==b)return this;null==b||"object"===typeof b?(l=b,e=c):(l={})[b]=c;e||(e={});if(!this._validate(l,e))return!1;this.idAttribute in l&&(this.id=l[this.idAttribute]);this._mergePrivateFields(l);var r=!1;for(g in l)c=l[g],this._set(g,c,h({},e,{ignoreChange:!0}));if(e&&!e.silent)for(g in l)if(void 0!=this._hasChanged(g,this._snapshot[g],this._object[g])||-1!=d.indexOf(g))r=!0,this.trigger("change:"+b,this,this._object[b],{});r&&this.trigger("change",this,e);return this},unset:function(b,c){if(!b||
!g.isString(b)||0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();delete this._object[b];this.triggerChangeEvent(b,c);return this},_validate:function(b,c){if(!c.validate||!this.validate||!g.isFunction(this.validate))return!0;b=h({},this.attributes,b);var d=this.validationError=this.validate(b,c)||null;if(!d)return!0;this.trigger("invalid",this,d,h(c,{validationError:d}));return!1},isValid:function(b){return this._validate({},h(b||{},{validate:!0}))},has:function(b){return b&&g.isString(b)&&
0!==b.length?this._object[b]&&!g.isUndefined(this._object[b])?!0:!1:!1},isNew:function(){return!(!g.isNullOrUndefined(this.id)||this.has(this.idAttribute))},clone:function(){return"object"==this.type?c.Object._create(b({__meta:this.meta},this.getObject())):c.Connection._create(b({__meta:this.meta},this.getObject()))},copy:function(b,c){b&&(this._copy(b,this._object),c&&this._copy(b,this._snapshot));return this},mergeWithPrevious:function(){this._copy(this._object,this._snapshot);this._aclFactory&&
this._aclFactory.merge();this._mergePrivateFields(this._snapshot);this._removeTags=[];this._atomicProps={};this._multivaluedProps={};this._setOps={};return this},_merge:function(){this._copy(this._snapshot,this._object);this._aclFactory&&this._aclFactory.merge();this._mergePrivateFields(this._object);this._removeTags=[];this._atomicProps={};this._multivaluedProps={};this._setOps={}},rollback:function(){this._object=this.raw={};this._merge();return this},_atomic:function(b,c,d,e){if(!b||!g.isString(b)||
0===b.length||0===b.indexOf("__"))return this;b=b.toLowerCase();if(g.isObject(this._object[b])||g.isArray(this._object[b]))throw Error("Cannot increment/decrement array/object");try{g.isObject(c)?(e=c,c=d):c=!c||isNaN(Number(c))?d:Number(c)*d,this._object[b]=isNaN(Number(this._object[b]))?c:Number(this._object[b])+c,this.isNew()||(this._atomicProps[b]={value:(this._atomicProps[b]?this._atomicProps[b].value:0)+c})}catch(h){throw Error("Cannot perform increment/decrement operation");}this.triggerChangeEvent(b,
e);return this},increment:function(b,c,d){return this._atomic(b,c,1,d)},decrement:function(b,c,d){return this._atomic(b,c,-1,d)},_findUnsavedChanges:function(){var b={object:null,isNested:!1};if(this.id)b.object=this._getChanged(!0);else{var c=this.getObject();delete c.__meta;for(var d in c)"$"==d[0]&&delete c[d];c.__revision&&delete c.__revision;"object"==this.type&&this._aclFactory&&(d=this._aclFactory.getChanged())&&(c.__acls=d);c.__tags&&0==c.__tags.length&&delete c.__tags;Object.isEmpty(c.__attributes)&&
delete c.__attributes;"connection"==this.type&&(c.__endpointa.objectid&&delete c.__endpointa.object,c.__endpointb.objectid&&delete c.__endpointb.object);b.object=c}return b},getType:function(){var b=this.type;!this._object.__type||"user"!=this._object.__type.toLowerCase()&&"device"!=this._object.__type.toLowerCase()||(b=this._object.__type.toLowerCase());return b},_parseOutput:function(b,d){var e=this.getType(),g;b=b||{};if(d&&d[e]){b&&b.parse&&(d[e]=this.parse(d[e]));var l=this.isNew(),r=!1;"connection"==
this.type&&this._object.__endpointa&&d[e].__endpointa.label!=this._object.__endpointa.label&&(r=d[e].__endpointa,d[e].__endpointa=d[e].__endpointb,d[e].__endpointb=r,r=!0);this._snapshot=c.utils._decode(h({__meta:h(this.meta,d.__meta)},d[e]));this.id=this._object[this.idAttribute]=d[e][this.idAttribute];this._merge();l?("connection"==this.type&&(b._batch||(r?(this._object.__endpointa.object&&d.__bmeta&&(this._object.__endpointa.object.__meta=d.__bmeta),this._object.__endpointb.object&&d.__ameta&&
(this._object.__endpointb.object.__meta=d.__ameta)):(this._object.__endpointa.object&&d.__ameta&&(this._object.__endpointa.object.__meta=d.__ameta),this._object.__endpointb.object&&d.__bmeta&&(this._object.__endpointb.object.__meta=d.__bmeta))),this.parseConnection(b._batch)),this.trigger("change:__id",this,this.id,{}),c.eventManager.fire(this.entityType+"."+e+".created",this,{object:this}),this.created=!0):c.eventManager.fire(this.entityType+"."+e+"."+this.id+".updated",this,{object:this});b.silent||
this.trigger("sync",this,d[e],b)}else d=d||{},d.status=d.status||{},g=this._getOutpuStatus(d.status),this._triggerError(b,new c.Error(g)),this.isNew()?c.eventManager.fire(this.entityType+"."+e+".createFailed",this,{error:g}):c.eventManager.fire(this.entityType+"."+e+"."+this.id+".updateFailed",this,{object:g});return g},_save:function(){return this.id?this._update(arguments):this._create(arguments)},_create:function(b){b=b||{};var d=this.getType(),e=this._findUnsavedChanges(),g=this,h=new c._Request({method:"PUT",
type:d,op:"getCreateUrl",args:[this.className,this._fields],data:e.object,options:b,entity:g,onSuccess:function(c){(c=g._parseOutput(b,c))?h.promise.reject(c,g):h.promise.fulfill(g)}});return h.send()},_update:function(b,d){c.Promise.is(d)||(d=c.Promise.buildPromise(b));var e=this._findUnsavedChanges(),g=this;b=b||{};if(Object.isEmpty(e.object))d.fulfill(this);else{var h=this.type,l=[this.className,this.id,this._fields];this._object&&this._object.__type&&("user"==this._object.__type.toLowerCase()||
"device"==this._object.__type.toLowerCase())&&(h=this._object.__type.toLowerCase(),l.splice(0,1));var m=new c._Request({method:"POST",type:h,op:"getUpdateUrl",args:l,data:e.object,options:b,entity:this,onSuccess:function(c){(c=g._parseOutput(b,c))?m.promise.reject(c,g):m.promise.fulfill(g)}});return m.send()}return d},_fetch:function(b){if(!this.id)throw Error("Please specify id for get operation");b=b||{};var d=this.getType(),e=this,g=new c._Request({method:"GET",type:d,op:"getGetUrl",args:[this.className,
this.id,this._fields],options:b,entity:e,onSuccess:function(l){l&&l[d]?(b&&b.parse&&(l[d]=e.parse(l[d])),e._snapshot=c.utils._decode(h({__meta:h(e.meta,l.__meta)},l[d])),e._copy(e._snapshot,e._object),e._mergePrivateFields(e._object),e._aclFactory&&e._aclFactory._rollback(),l.connection&&(e.endpoints||e.endpointA&&e.endpointB||e.setupConnection(e._object.__endpointa,e._object.__endpointb)),b.silent||e.trigger("sync",e,l[d],b),c.eventManager.fire(e.entityType+"."+d+"."+e.id+".fetched",e,{object:e}),
g.promise.fulfill(e)):(l=l||{},l.status=l.status||{},l.status=_getOutpuStatus(l.status),e._triggerError(b,new c.Error(l.status)),g.promise.reject(l.status,e))}});return g.send()},_destroy:function(b){b=b||{};var d=b.deleteConnections,e=this;g.isBoolean(b)&&(d=b,b={});b.wait||this.triggerDestroy(b);if(!this.id)return(new c.Promise.buildPromise(b)).fulfill();var h=this.getType(),l=new c._Request({method:"DELETE",type:h,op:"getDeleteUrl",args:[this.className,this.id,d],options:b,entity:this,onSuccess:function(d){d&&
d.status?(e._object={},e._snapshot={},b.wait&&e.triggerDestroy(b),l.promise.fulfill(d.status)):(d=d||{},d.status=d.status||{},d.status=e._getOutpuStatus(d.status),e._triggerError(b,new c.Error(d.status)),l.promise.reject(d.status,e))}});return l.send()},save:function(){return this._save.apply(this,arguments)},fetch:function(){return this._fetch.apply(this,arguments)},destroy:function(){return this._destroy.apply(this,arguments)},destroyWithConnections:function(){return this._destroyWithConnections.apply(this,
arguments)},toString:function(){return JSON.stringify(this.getObject())},parse:function(b,c){return b},escape:function(b){return _.escape(this.get(b))}});c.BaseObject=n;c.BaseObject._saveAll=function(b,d,e){var h=new c.Batch;d=d||{};if(!g.isArray(b))throw Error("Provide an array of objects for Object.saveAll");b.forEach(function(b){b instanceof c.BaseObject||!g.isObject(b)||(b=new c[this.className||e](b));h.add(b)});return h.execute(d)};n.prototype.del=n.prototype._destroy;c.Events.mixin(c.BaseObject.prototype)})(global);
(function(n){var c=function(){return Math.floor(65536*Math.random()).toString(16)};n.Appacitive.GUID=function(){var g=c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c(),h="",b,e,l,d,m,f,k=0,g=g.replace(/\r\n/g,"\n");e="";for(l=0;l<g.length;l++)d=g.charCodeAt(l),128>d?e+=String.fromCharCode(d):(127<d&&2048>d?e+=String.fromCharCode(d>>6|192):(e+=String.fromCharCode(d>>12|224),e+=String.fromCharCode(d>>6&63|128)),e+=String.fromCharCode(d&63|128));for(g=e;k<g.length;)b=g.charCodeAt(k++),e=g.charCodeAt(k++),
l=g.charCodeAt(k++),d=b>>2,b=(b&3)<<4|e>>4,m=(e&15)<<2|l>>6,f=l&63,isNaN(e)?m=f=64:isNaN(l)&&(f=64),h=h+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);return h.toString()}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=["allow","deny"],b=["create","read","update","delete","manageaccess"],e=function(c){var d=[];c.forEach(function(c){g.isString(c)&&-1!=b.indexOf(c.toLowerCase())&&d.push(c.toLowerCase())});return d};c._Acl=function(l,d){var m=l||[];g.isArray(m)||(m=[]);var f={};d&&(f=JSON.parse(JSON.stringify(m)));this.acls=m=JSON.parse(JSON.stringify(m));var k=[],p=function(b,f,d,g){if(!d)throw Error("Specify valid user or usergroup");d instanceof c.Object&&"user"==
d.typeName&&!d.isNew()&&(d=d.id);var l=m.filter(function(b){return b.sid==d&&b.type==f});l&&0!=l.length?l=l[0]:(l={sid:d,type:f,deny:[],allow:[]},m.push(l));l.allow||(l.allow=[]);l.deny||(l.deny=[]);g=e(g);var p=k.filter(function(b){return b.sid==d&&b.type==f});p&&0!=p.length?p=p[0]:(p={sid:d,type:f},k.push(p));g.forEach(function(c){for(var f=0;f<h.length;f+=1){var d=l[h[f]].indexOf(c);if(-1!=d){l[h[f]].splice(d,1);break}}"dontcare"!=b&&l[b].push(c);p[c]=b});return this},t=function(b,c,f,d){if(!f)throw Error("Please provide valid id or name for setting acls");
if(!d)throw Error("Please provide valid access permissions for setting acls");g.isArray(d)||(d=[d]);g.isArray(f)?f.forEach(function(f){p(b,c,f,d)}):p(b,c,f,d);return this},q=function(){m.allowUser=function(b,c){return t.apply(this,["allow","user",b,c])};m.allowGroup=function(b,c){return t.apply(this,["allow","usergroup",b,c])};m.denyUser=function(b,c){return t.apply(this,["deny","user",b,c])};m.denyGroup=function(b,c){return t.apply(this,["deny","usergroup",b,c])};m.resetUser=function(b,c){return t.apply(this,
["dontcare","user",b,c])};m.resetGroup=function(b,c){return t.apply(this,["dontcare","usergroup",b,c])};m.allowAnonymous=function(b){return t.apply(this,["allow","usergroup",["anonymous"],b])};m.denyAnonymous=function(b){return t.apply(this,["deny","usergroup",["anonymous"],b])};m.resetAnonymous=function(b){return t.apply(this,["dontcare","usergroup",["anonymous"],b])};m.allowLoggedIn=function(b){return t.apply(this,["allow","usergroup",["anonymous"],b])};m.denyLoggedIn=function(b){return t.apply(this,
["deny","usergroup",["anonymous"],b])};m.resetLoggedIn=function(b){return t.apply(this,["dontcare","usergroup",["anonymous"],b])}};this._rollback=function(){k=[];m=JSON.parse(JSON.stringify(f));q();return this};this.toJSON=this.getChanged=function(){var c=[];k.forEach(function(f){var d={sid:f.sid,type:f.type,allow:[],deny:[],dontcare:[]};b.forEach(function(b){f[b]&&d[f[b]].push(b)});h.forEach(function(b){0==d[b].length&&delete d[b]});0==d.dontcare.length&&delete d.dontcare;c.push(d)});return 0==c.length?
null:c};this.merge=function(){k=[];return this};q();return this};c.Group=new function(){var b=function(b,e,f,k){if(!e||!g.isString(e)||0===e.length)throw Error("Please specify valid groupname");g.isArray(f)||(f=[f]);var h={};h[b]=[];f.forEach(function(f){f&&(f instanceof c.Object&&"user"==f.typeName&&!f.isNew()?h[b].push(f.id):g.isString(f)&&h[b].push(f))});if(0==h[b].length)throw Error("Please specify valid members as second argument");var l=new c._Request({method:"POST",type:"usergroup",op:"getUpdateUrl",
args:[e],data:h,entity:this,options:k,onSuccess:function(b){l.promise.fulfill(b)}});return l.send()};this.addMembers=function(c,e,f){return b("add",c,e)};this.removeMembers=function(c,e,f){return b("remove",c,e)}}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.utils._extend;c.Object=function(b,e){b=b||{};e=e||{};this.className&&(b.__type=this.className);g.isString(b)&&(b={__type:b});if(!b.__type)throw Error("Cannot set object without __type");g.isBoolean(e)&&(e={setSnapShot:!0});c.BaseObject.call(this,b,e);this.type="object";this.getObject=this.getObject;this.children={};this.typeName=b.__type;this._aclFactory=new c._Acl(e.__acls,e.setSnapShot);this.acls=this._aclFactory.acls;g.isFunction(this.initialize)&&
this.initialize.apply(this,[b]);return this};c.Object.prototype=new c.BaseObject;c.Object.prototype.constructor=c.Object;c.Object.extend=function(d,e,f){g.isObject(d)&&(f=e,e=d,d=e.typeName);if(!g.isString(d)||0==d.length)throw Error("Appacitive.Object.extend's first argument should be the type-name.");var k=null;e=e||{};e.className=d;k=c.utils.classExtend(c.Object,e,f);delete k.extend;k.className=d;k.type=d;return b[d]=k};var b={},e=function(d){if(!g.isString(d))throw"_getClass requires a string argument.";
var e=b[d];e||(e=c.Object.extend(d),b[d]=e);return e};c.Object._getClass=e;c.Object._create=function(b,c,f){return(new (this.className?this:f?f:e(b.__type))(b)).copy(b,c)};var l=function(b,e,f){var g=[];b.forEach(function(b){b=c.Object._create(h(b,{__meta:f}),!0,e);g.push(b)});return g};c.Object._parseResult=l;c.Object.multiDelete=function(b,e){b=b||{};e=e||{};var f=[];this.className&&(b.type=this.className);g.isArray(b)&&0<b.length&&(b[0]instanceof c.Object?(f=b,b={type:f[0].className,ids:f.map(function(b){return b.id}).filter(function(b){return b})}):
b={type:this.className,ids:b});if(!b.type||!g.isString(b.type)||0===b.type.length)throw Error("Specify valid type");if("user"===b.type.toLowerCase()||"device"===b.type.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var k=new c._Request({method:"POST",data:{idlist:b.ids},type:"object",op:"getMultiDeleteUrl",args:[b.type],options:e,onSuccess:function(b){e&&!e.silent&&f.forEach(function(b){b.trigger("destroy",
b,b.collection,e)});k.promise.fulfill()}});return k.send()};c.Object.multiGet=function(b,e){b=b||{};e=e||{};g.isArray(b)&&0<b.length&&(b=b[0]instanceof c.Object?{ids:b.map(function(b){return b.id}).filter(function(b){return b})}:{ids:b});this.className&&(b.type=this.className,b.entity=this);if(!b.type||!g.isString(b.type)||0===b.type.length)throw Error("Specify valid type");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var f=new c._Request({method:"GET",type:"object",op:"getMultiGetUrl",
args:[b.type,b.ids.join(","),b.fields],options:e,onSuccess:function(c){f.promise.fulfill(l(c.objects,b.entity,c.__meta))}});return f.send()};c.Object.get=function(b,e){b=b||{};g.isString(b)&&this.className&&(b={id:b});this.className&&(b.type=this.className,b.entity=this);if(!b.type)throw Error("Specify type");if(!b.id)throw Error("Specify id to fetch");var f=c.Object._create({__type:b.type,__id:b.id});f.fields=b.fields;return f.fetch(e)};c.Object.prototype.getConnections=function(b){if(this.isNew())throw Error("Cannot fetch connections for new object");
b.objectId=this.get("__id");return new c.Queries.GetConnectionsQuery(b)};c.Object.prototype.getConnectedObjects=function(b){if(this.isNew())throw Error("Cannot fetch connections for new object");b=b||{};g.isString(b)&&(b={relation:b});b.type=this.get("__type");b.objectId=this.get("__id");b.object=this;return new c.Queries.ConnectedObjectsQuery(b)};c.Object.prototype.fetchConnectedObjects=c.Object.prototype.getConnectedObjects;c.Object.findAll=c.Object.findAllQuery=function(b){b=b||{};this.className&&
(b.type=this.className,b.entity=this);return new c.Queries.FindAllQuery(b)};c.Object.saveAll=function(b,e){return c.BaseObject._saveAll(b,e,"Object")}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.utils._extend,b=function(b,e,d){var l={label:b.label};b.objectid&&(l.objectid=b.objectid);if(b.object)b.object instanceof c.Object?b.object.id&&(b.objectid=l.objectid=b.object.id):g.isObject(b.object)&&(b.object.__id&&(b.objectid=l.objectid=b.object.__id),b.object=c.Object._create(b.object)),l.object=b.object.getObject();else if(!l.objectid&&!l.object)throw Error("Incorrectly configured endpoints provided to parseConnection");l.toJSON=function(){var c=
h({},this);if(c.object&&(c.object=b.object.toJSON(),b.object._aclFactory)){var e=b.object._aclFactory.toJSON();e&&(c.object.__acls=e)}delete c.toJSON;return c};d["endpoint"+e]=b;return l},e=function(b,e,d,l){b.object&&g.isObject(b.object)?(l||(d["endpoint"+e]?d["endpoint"+e]&&d["endpoint"+e].object&&d["endpoint"+e].object instanceof c.Object?d["endpoint"+e].object.copy(b.object,!0):d["endpoint"+e].object=c.Object._create(b.object,!0):(d["endpoint"+e]={},d["endpoint"+e].object=c.Object._create(b.object,
!0)),d["endpoint"+e]._aclFactory&&d["endpoint"+e]._aclFactory.merge(),l=d["endpoint"+e].object,l.trigger("change:__id",l,l.id,{})),d["endpoint"+e].objectid=b.objectid||b.object.__id,d["endpoint"+e].label=b.label,d["endpoint"+e].type=b.type):d["endpoint"+e]=b;b.toJSON=function(){var b=h({},this);if(b.object&&(b.object=d["endpoint"+e].object.toJSON(),d["endpoint"+e].object._aclFactory)){var c=d["endpoint"+e].object._aclFactory.toJSON();c&&(b.object.__acls=c)}delete b.toJSON;return b}};c.Connection=
function(b,d){b=b||{};d=d||{};this.className&&(b.__relationtype=this.className);g.isString(b)&&(b={__relationtype:b});if(!b.__relationtype&&!b.relation)throw Error("Cannot set connection without relation");b.relation&&(b.__relationtype=b.relation,delete b.relation);g.isBoolean(d)&&(d={setSnapShot:!0});b.endpoints&&2===b.endpoints.length&&(b.__endpointa=b.endpoints[0],b.__endpointb=b.endpoints[1],delete b.endpoints);c.BaseObject.call(this,b,d);this.type="connection";this.getConnection=this.getObject;
this.parseConnection=function(c){var d="A",k="B";b.__endpointa.label.toLowerCase()!==this.get("__endpointb").label.toLowerCase()||b.__endpointa.label.toLowerCase()==b.__endpointb.label.toLowerCase()||b.__endpointa.objectid!=this.get("__endpointb").objectid&&b.__endpointa.objectid||(d="B",k="A");e(this.get("__endpointa"),d,this,c);e(this.get("__endpointb"),k,this,c);this.endpoints=function(){if(1===arguments.length&&g.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;
if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b};return this};d.setSnapShot?this.parseConnection(b):b.__endpointa&&b.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));this.relationName=b.__relationtype;g.isFunction(this.initialize)&&this.initialize.apply(this,[b]);return this};c.Connection.prototype=new c.BaseObject;c.Connection.prototype.constructor=
c.Connection;c.Connection.extend=function(b,e,d){g.isObject(b)&&(d=e,e=b,b=e.relationName);if(!g.isString(b))throw Error("Appacitive.Connection.extend's first argument should be the relationName.");var h=null;e=e||{};e.className=b;h=c.utils.classExtend(c.Connection,e,d);delete h.extend;h.className=b;h.relation=b;return l[b]=h};var l={},d=function(b){if(!g.isString(b))throw"_getClass requires a string argument.";var e=l[b];e||(e=c.Connection.extend(b),l[b]=e);return e};c.Connection._getClass=d;c.Connection._create=
function(b,c,e){return(new (this.className?this:e?e:d(b.__relationtype))(b)).copy(b,c)};var m=function(b,e,d){var g=[];b||(b=[]);b.forEach(function(b){g.push(c.Connection._create(h(b,{__meta:d}),!0,e))});return g};c.Connection._parseResult=m;c.Connection.prototype.setupConnection=function(c,e){if(!(c&&(c.objectid||c.object)&&c.label&&e&&(e.objectid||e.object)&&e.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",b(c,"A",this),{silent:!0});this.set("__endpointb",
b(e,"B",this),{silent:!0});this.endpoints=function(){if(1===arguments.length&&g.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b}};c.Connection.get=function(b,e){b=b||{};g.isString(b)&&this.className&&(b={id:b});this.className&&(b.relation=this.className,
b.entity=this);if(!b.relation)throw Error("Specify relation");if(!b.id)throw Error("Specify id to fetch");var d=c.Connection._create({__relationtype:b.relation,__id:b.id});d.fields=b.fields;return d.fetch(e)};c.Connection.multiGet=function(b,e){b=b||{};e=e||{};g.isArray(b)&&0<b.length&&(b=b[0]instanceof c.Connection?{ids:b.map(function(b){return b.id}).filter(function(b){return b})}:{ids:b});this.className&&(b.relation=this.className,b.entity=this);if(!b.relation||!g.isString(b.relation)||0===b.relation.length)throw Error("Specify valid relation");
if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var d=new c._Request({method:"GET",type:"connection",op:"getMultiGetUrl",args:[b.relation,b.ids.join(","),b.fields],options:e,onSuccess:function(c){d.promise.fulfill(m(c.connections,b.entity,c.__meta))}});return d.send()};c.Connection.multiDelete=function(b,e){b=b||{};e=e||{};var d=[];this.className&&(b.relation=this.className);g.isArray(b)&&0<b.length&&(b[0]instanceof c.Connection?(d=b,b={relation:d[0].className,ids:d.map(function(b){return b.id}).filter(function(b){return b})}):
b={relation:this.className,ids:b});if(!b.relation||!g.isString(b.relation)||0===b.relation.length)throw Error("Specify valid relation");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var h=new c._Request({method:"POST",data:{idlist:b.ids},type:"connection",op:"getMultiDeleteUrl",args:[b.relation],options:e,onSuccess:function(b){e&&!e.silent&&d.forEach(function(b){b.trigger("destroy",b,b.collection,e)});h.promise.fulfill()}});return h.send()};c.Connection.findAll=c.Connection.findAllQuery=
function(b){b=b||{};this.className&&(b.relation=this.className,b.entity=this);return new c.Queries.FindAllQuery(b)};c.Connection.interconnectsQuery=c.Connection.getInterconnects=function(b){return new c.Queries.InterconnectsQuery(b)};c.Connection.betweenObjectsQuery=c.Connection.getBetweenObjects=function(b){return new c.Queries.GetConnectionsBetweenObjectsQuery(b)};c.Connection.betweenObjectsForRelationQuery=c.Connection.getBetweenObjectsForRelation=function(b){b=b||{};this.className&&(b.relation=
this.className,b.entity=this);return new c.Queries.GetConnectionsBetweenObjectsForRelationQuery(b)};c.Connection.saveAll=function(b,e){return c.BaseObject._saveAll(b,e,"Connection")}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.utils._extend,b=function(b,e){b=b||{};b.__type="user";c.Object.call(this,b,e);return this},e=null;b.currentUser=b.current=function(){return e};var l=function(b,e,d){var h=this.get("__id");if(!h||!g.isString(h)||0===h.length)throw Error("Please specify valid userid");if(!b||!g.isString(b)||0===b.length)throw Error("Please specify valid oldPassword");if(!e||!g.isString(e)||0===e.length)throw Error("Please specify valid newPassword");var l=this,r=new c._Request({method:"POST",
type:"user",op:"getUpdatePasswordUrl",args:[h],options:d,data:{oldpassword:b,newpassword:e},entity:this,onSuccess:function(b){r.promise.fulfill(l)}});return r.send()},d=function(b,e){var d=this.get("__id");if(!this.get("__id"))return this.set("__link",b),c.Promise.buildPromise(e).fulfill(this);var h=this,l=new c._Request({method:"POST",type:"user",op:"getLinkAccountUrl",args:[d],options:e,data:b,entity:this,onSuccess:function(c){c=h.get("__link");g.isArray(c)||(c=c?[c]:[]);c.push(b);h.copy({__link:c},
!0);l.promise.fulfill(h)}});return l.send()};b.setCurrentUser=function(b,d,g){if(!b)throw Error("Cannot set null object as user");var h=b;if(h instanceof c.User)if(h.get("__id")&&0!==h.get("__id").length)b=h.getObject();else throw Error("Specify user __id");else h=new c.User(b,!0);c.LocalStorage.set("Appacitive-User",b);g||(g=864E5);e=h;d&&c.Session.setUserAuthHeader(d,g);e.logout=function(b){return c.Users.logout(b)};e.updatePassword=function(b,c,f){return l.apply(this,[b,c,f])};e.logout=function(b){return c.Users.logout(b)};
c.eventManager.clearAndSubscribe("type.user."+h.get("__id")+".updated",function(b,f){c.LocalStorage.set("Appacitive-User",f.object.getObject())});return e};b.prototype.linkedAccounts=function(){var b=this.get("__link");b?g.isArray(b)||(b=[b]):b=[];return b};b.prototype.getAllLinkedAccounts=function(b){var e=this.get("__id");if(!e||!g.isString(e)||0===e.length)return c.Promise.buildPromise(b).fulfill(this.linkedAccounts(),this);var d=this,h=new c._Request({method:"GET",type:"user",op:"getGetAllLinkedAccountsUrl",
args:[e],options:b,entity:this,onSuccess:function(){var b=a.identities||[];0<b.length?d.set("__link",b):d.set("__link",null);h.promise.fulfill(b,d)}});return h.send()};b.prototype.checkin=function(b,e){var d=this.get("__id");d&&g.isString(d)&&0!==d.length||onSuccess&&g.isFunction(onSuccess)&&onSuccess();if(!(b&&b instanceof c.GeoCoord))throw Error("Invalid coordinates provided");var h=this,l=new c._Request({method:"POST",type:"user",op:"getCheckinUrl",args:[d,b.lat,b.lngerId],options:e,entity:this,
onSuccess:function(){l.promise.fulfill(h)}});return l.send()};b.prototype.linkFacebook=function(b,c){if(!b||!g.isString(b))throw Error("Please provide accessToken");return d.apply(this,[{authtype:"facebook",accesstoken:b,name:"facebook"},c])};b.prototype.linkTwitter=function(b,c){if(!g.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var e={authtype:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret};b.consumerKey&&
b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=b.consumerKey);return d.apply(this,[e,c])};b.prototype.unlink=function(b,e){if(!_.isString(b))throw Error("Specify aouth account type for unlinking");var d=this.get("__id");if(!this.get("__id"))return this.set("__link",null),promise.fulfill(this),promise;var h=this,l=new c._Request({method:"POST",type:"user",op:"getDelinkAccountUrl",args:[d,b],options:e,entity:this,onSuccess:function(c){(c=h.get("__link"))?g.isArray(c)||(c=[c]):c=
[];if(0<=c.length){var e=null;c.forEach(function(c,d){c.name==b.toLowerCase()&&(e=d)});null!=e&&c.splice(e,1);h.copy({__link:c},!0)}else h.copy({__link:[]},!0);l.promise.fulfill(h)}});return l.send()};b.prototype.clone=function(){return new c.User(this.getObject())};c.User=c.Object.extend("user",b.prototype);delete c.User._create;delete c.User._parseResult;delete c.User.multiDelete;b.deleteUser=function(b,e){if(!b)throw Error("Specify userid for user delete");return(new c.Object({__type:"user",__id:b})).destroyWithConnections(e)};
b.deleteCurrentUser=function(b){var d=c.Promise.buildPromise(b);if(null===e)return c.Session.removeUserAuthHeader(),d.fulfill(),d;b=e.get("__id");this.deleteUser(b).then(function(){e=null;c.Session.removeUserAuthHeader();d.fulfill()},function(){d.reject.apply(d,arguments)});return d};b.createNewUser=function(b,e){b=b||{};b.__type="user";if(!b.username||!b.password||!b.firstname||0===b.username.length||0===b.password.length||0===b.firstname.length)throw Error("username, password and firstname are mandatory");
return(new c.User(b)).save(e)};b.createUser=b.createNewUser;b.signup=function(b,e){var d=this,g=c.Promise.buildPromise(e);this.createUser(b).then(function(){d.login(b.username,b.password).then(function(){g.fulfill.apply(g,arguments)},function(b){g.reject.apply(g,arguments)})},function(){g.reject.apply(g,arguments)});return g};b.authenticateUser=function(b,d,l){d=d||{};b.expiry||(b.expiry=864E5);var m=this,q;g.isString(l)&&g.isObject(d.user)&&(b.user=d.user instanceof n.Appacitive.User?d.user.toJSON():
d.user,delete b.user.__meta,q=d.user);var r=new c._Request({method:"POST",type:"user",op:"getAuthenticateUserUrl",options:d,data:b,onSuccess:function(d){d&&d.user?(l&&(d.user.__authType=l),h(d.user,{__meta:d.__meta}),q instanceof n.Appacitive.User&&(d.user=q.copy(d.user,!0)),m.setCurrentUser(d.user,d.token,b.expiry),c.User.trigger("login",e,e,d.token),r.promise.fulfill({user:e,token:d.token})):r.promise.reject(d.status)}});return r.send()};b.login=function(b,c,e){if(!b||!c||0==b.length||0==c.length)throw Error("Please specify username and password");
return this.authenticateUser({username:b,password:c,expiry:864E5},e,"BASIC")};b.loginWithFacebook=function(b,c){if(!b||!g.isString(b))throw Error("Please provide accessToken");c=c||{};var e=!0;0==c.create&&(e=!1);return this.authenticateUser({accesstoken:b,type:"facebook",expiry:864E5,createnew:e},c,"FB")};b.loginWithTwitter=function(b,c){if(!g.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var e=!0;0==c.create&&(e=!1);e={type:"twitter",
oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret,expiry:864E5,createnew:e};b.consumerKey&&b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=b.consumerKey);return this.authenticateUser(e,c,"TWITTER")};b.validateCurrentUser=function(b,e){var d=c.Promise.buildPromise({success:e});e&&g.isBoolean(e)&&(b=e,e=function(){});var h=this,l=function(c){if(c)if(b)d.fulfill(!0);else try{h.getUserByToken(c).then(function(b){h.setCurrentUser(b,c);d.fulfill(!0)},function(){d.fulfill(!1)})}catch(e){d.fulfill(!1)}else d.fulfill(!1)};
c.runtime.isReactNative?c.LocalStorage.get("Appacitive-UserToken").then(function(b){l(b)}):l(c.LocalStorage.get("Appacitive-UserToken"));return d};var m=function(b,e,d){d=d||{};var g=new c._Request({method:"GET",type:"user",op:b,options:d,args:e,onSuccess:function(b){b&&b.user?g.promise.fulfill(new c.User(h(b.user,{__meta:b.__meta}),h(d,{setSnapShot:!0}))):g.promise.reject(b.status)}});return g.send()};b.getUserByToken=function(b,e){if(!b||!g.isString(b)||0===b.length)throw Error("Please specify valid token");
c.Session.setUserAuthHeader(b,0,!0);return m("getUserByTokenUrl",[b],e)};b.getUserByUsername=function(b,c){if(!b||!g.isString(b)||0===b.length)throw Error("Please specify valid username");return m("getUserByUsernameUrl",[b],c)};b.logout=function(b,d){e=null;return c.Session.removeUserAuthHeader(b,d)};b.sendResetPasswordEmail=function(b,e,d){if(!b||!g.isString(b)||0===b.length)throw Error("Please specify valid username");if(!e||!g.isString(e)||0===e.length)throw Error("Plase specify subject for email");
b={username:b,subject:e};d=d||{};g.isString(d.templateName)&&(b.templatename=d.templateName);g.isString(d.resetLink)&&(b.resetlink=d.resetLink);var h=new c._Request({method:"POST",type:"user",op:"getSendResetPasswordEmailUrl",options:d,data:b,onSuccess:function(){h.promise.fulfill()}});return h.send()};b.resetPassword=function(b,e,d){if(!b)throw Error("Please specify token");if(!e||0===e.length)throw Error("Please specify password");var g=new c._Request({method:"POST",type:"user",op:"getResetPasswordUrl",
options:d,data:{newpassword:e},args:[b],onSuccess:function(){g.promise.fulfill()}});return g.send()};b.validateResetPasswordToken=function(b,e){if(!b)throw Error("Please specify token");e=e||{};var d=new c._Request({method:"POST",type:"user",op:"getValidateResetPasswordUrl",options:e,data:{},args:[b],onSuccess:function(b){d.promise.fulfill(new c.User(h(b.user,{__meta:b.__meta}),h(e,{setSnapShot:!0})))}});return d.send()};c.Users=c.User;c.Events.mixin(c.User)})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.utils._extend;c.Collection=function(b,c){c||(c={});c.model&&(this.model=c.model);if(!this.model)throw Error("Please specify model for collection");void 0!==c.comparator&&(this.comparator=c.comparator);c.query&&this.query(c.query);this._reset();this.initialize.apply(this,arguments);b&&this.reset(b,{silent:!0})};c.Events.mixin(c.Collection.prototype);h(c.Collection.prototype,{models:[],initialize:function(){},_query:null,toJSON:function(b){return this.models.map(function(c){return c.toJSON(b)})},
getObject:function(b){return this.models.map(function(c){return c.getObject(b)})},add:function(b,c){c=c||{};var h,d,m,f,k,n={},t={},q=[],r=c.sort,u;b=g.isArray(b)?b.slice():[b];h=0;for(d=b.length;h<d;h++){b[h]=this._prepareModel(b[h]);m=b[h];if(!m)throw Error("Can't add an invalid model to a collection");f=m.cid;if(n[f]||this._byCid[f])throw Error("Duplicate cid: can't add the same model to a collection twice");(k=m.id)&&((u=t[k])||(u=this._byId[k]))?(u.copy(m.getObject(),c.setSnapShot),u.children=
m.children):(t[k]=m,n[f]=m,q.push(m),this._addReference(m,c))}this.models.splice.apply(this.models,[null!=c.at?c.at:this.models.length,0].concat(q));r&&this.comparator&&this.sort({silent:!0});this.length=this.models.length;if(c.silent)return this;h=0;for(d=q.length;h<d;h++)m=q[h],c.index=h,m.trigger("add",m,this,c);return this},remove:function(b,c){var h,d,m,f;c=c||{};b=g.isArray(b)?b.slice():[b];h=0;for(d=b.length;h<d;h++)if(f=this.getByCid(b[h])||this.get(b[h]))delete this._byId[f.id],delete this._byCid[f.cid],
m=this.models.indexOf(f),this.models.splice(m,1),this.length--,c.silent||(c.index=m,f.trigger("remove",f,this,c)),this._removeReference(f);return this},push:function(b,c){return this.add(b,h({at:this.length},c))},pop:function(b){var c=this.at(this.length-1);this.remove(c,b);return c},unshift:function(b,c){return this.add(b,h({at:0},c))},shift:function(b){var c=this.at(0);this.remove(c,b);return c},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(b){return b&&
this._byId[b instanceof c.BaseObject?b.id:b]},query:function(b){if(b)return this._query=b,this;this._query||(this._query=new c.Query(this.model));return this._query},getByCid:function(b){return b&&this._byCid[b.cid||b]},at:function(b){return this.models[b]},where:function(b,c){return Object.isEmpty(b)?c?void 0:[]:this.models[c?"find":"filter"](function(c){for(var e in b)if(b[e]!==c.get(e))return!1;return!0})},findWhere:function(b){return this.where(b,!0)},sort:function(b){b=b||{};if(!this.comparator)throw Error("Cannot sort a set without a comparator");
1===this.comparator.length?this.models=this.models.sortBy(this.comparator):this.models.sort(this.comparator.bind(this.models));b.silent||this.trigger("reset",this,b);return this},pluck:function(b){return this.models.map(function(c){return c.get(b)})},first:function(){return 0<this.length?this.models[0]:null},last:function(){return 0<this.length?this.models[this.length-1]:null},reset:function(b,c){c||(c={});for(var g=0,d=this.models.length;g<d;g++)this._removeReference(this.models[g],c);this._reset();
this.add(b,h({silent:!0},c));c.silent||this.trigger("reset",this,c);return this},fetch:function(b){b=c.utils._clone(b)||{};var e=this,g=this.query()||new c.Query(this.model),d=c.Promise.buildPromise(b);g.fetch(b).then(function(c){0==b.reset?e.add(c,h({setSnapShot:!0},b)):e.reset(c,b);d.fulfill(e)},function(){d.reject.apply(d,arguments)});return d},fetchNext:function(b){var c=this.query().pageNumber();this.query().pageNumber(++c);return this.fetch(b)},fetchPrev:function(b){var c=this.query().pageNumber();
--c;0>=c&&(c=1);this.query().pageNumber(c);return this.fetch(b)},mutiGet:function(b){b=c.utils._clone(b)||{};var e=this,h=c.Promise.buildPromise(b);b=b||{};g.isArray(b)&&(b[0]instanceof c.Object?(models=b,b={ids:models.map(function(b){return b.id}).filter(function(b){return b})}):b={ids:b});var d=b.ids||[];if(0==d.length)return h.fulfill(e);this.model.multiGet({ids:d,fields:b.fields}).then(function(c){b.add?e.add(c,b):e.reset(c,b);h.fulfill(e)},function(){h.reject.apply(h,arguments)});return h},saveAll:function(b){return this.model.saveAll(this.models,
h({},b))},save:function(b){return this.model.saveAll(this.models,h({},b))},create:function(b,e){var g=this;e=e?c.utils._clone(e):{};if(!(b=this._prepareModel(b,e)))return!1;e.wait||this.add(b,e);var d=e.success;e.success=function(){e.wait&&g.add(b,h({setSnapShot:!0},e));d&&d(b,g)};b.save(e);return b},_reset:function(b){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(b){b instanceof c.BaseObject||(b=new this.model(b));b.collection||(b.collection=this);return b},_addReference:function(b){this._byId[b.cid]=
b;null!=b.id&&(this._byId[b.id]=b);b.collection||(b.collection=this);b.on("all",this._onModelEvent,this)},_removeReference:function(b){this===b.collection&&delete b.collection;b.off("all",this._onModelEvent,this)},_onModelEvent:function(b,c,g,d){if("add"!==b&&"remove"!==b||g===this)"destroy"===b&&this.remove(c,d),c&&"change:__id"===b&&(delete this._byId[c.previous(c.idAttribute)],null!=c.id&&(this._byId[c.id]=c)),this.trigger.apply(this,arguments)}});c.Collection.extend=function(b,e){b&&b.query&&
(b._query=b.query,delete b.query);var g=c.utils.classExtend(this,b,e);g.extend=this.extend;return g};"forEach each map find filter every some indexOf lastIndexOf isEmpty difference without reduce".split(" ").each(function(b){c.Collection.prototype[b]=function(){var c=Array.prototype.slice.call(arguments);return Array.prototype[b].apply(this.models,c)}})})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.utils._extend;c.Batch=function(){this.objects=[];this.connections=[];this.objectDeletions=[];this.edgeDeletions=[]};var b=function(b){-1==this.connections.indexOf(b)&&this.connections.push(b)},e=function(b){-1==this.objects.indexOf(b)&&this.objects.push(b)},l=function(b,d,f){var e;if(g.isString(b)){if(e=b,!g.isString(d)&&0<d.trim().length)throw Error("Specify typename as second argument to Batch.removeObjects");}else if(g.isObject(b)&&b instanceof
c.Object){if(b.isNew())return;e=b.id;f=d;d=b.typeName}else throw Error("Batch.removeObjects accepts only Appacitive.Object or ids with typeName");this.objectDeletions.find(function(b){return e==b.id})||this.objectDeletions.push({type:d,id:e,deleteconnections:f})},d=function(b,d){var e;if(g.isString(b)){if(e=b,!g.isString(d)&&0<d.trim().length)throw Error("Specify relationName as second argument to Batch.removeConnections");}else if(g.isObject(b)&&b instanceof c.Connection){if(b.isNew())return;e=b.id;
d=b.relationName}else throw Error("Batch.removeConnection accepts only Appacitive.Connection or ids with relationName");this.edgeDeletions.find(function(b){return e==b.id})||this.edgeDeletions.push({type:d,id:e})},m=function(d){if(g.isObject(d)){if(d instanceof c.Object)return e.apply(this,[d]);if(d instanceof c.Connection)return b.apply(this,[d])}throw Error("Batch accepts only Appacitive.Object and Appacitive.Connection instances");},f=function(){var b=[];this.objects.forEach(function(c,d){var e=
c._findUnsavedChanges();if(e.object){e.object.__type=c.className;var f=b.find(function(b){return c.id&&c.id==b.object.__id||c.cid==b.name});f&&(f.object=e.object,e=f);delete e.isNested;c.isNew()?e.name=""+c.cid:e.object.__id=c.id;f||b.push(e)}});return b},k=function(){var b=this,c=[];this.connections.forEach(function(d){var e=d._findUnsavedChanges().object;e&&(e.__relationtype=d.className,e.__endpointa&&delete e.__endpointa.object,e.__endpointb&&delete e.__endpointb.object);var f=d.endpointA.object;
g.isObject(f)&&(d.isNew()&&(f.isNew()?e.__endpointa.name=""+d.endpointA.object.cid:e.__endpointa.objectid=d.endpointA.object.id),m.apply(b,[f]));f=d.endpointB.object;g.isObject(f)&&(d.isNew()&&(f.isNew()?e.__endpointb.name=""+d.endpointB.object.cid:e.__endpointb.objectid=d.endpointB.object.id),m.apply(b,[f]));if(e){var f=c.find(function(b){return d.id&&d.id==b.connection.__id||d.cid==b.name}),h={connection:e};f&&(f.connection=e,h=f);d.isNew()?h.name=""+d.cid:h.connection.__id=d.id;f||c.push(h)}});
return c};c.Batch.prototype.add=function(){var b=this;g.isArray(arguments[0])?arguments[0].forEach(function(c){m.apply(b,[c])}):m.apply(this,arguments);return this};c.Batch.prototype.removeObjects=function(){var b=this,c=arguments;g.isArray(c[0])?arguments[0].forEach(function(d){l.apply(b,[d,c[1],c[2]])}):l.apply(this,c);return this};c.Batch.prototype.removeConnections=function(){var b=this,c=arguments;g.isArray(c[0])?arguments[0].forEach(function(e){d.apply(b,[e,c[1],c[2]])}):d.apply(this,c);return this};
c.Batch.prototype.toJSON=function(){var b={nodes:[],edges:[],edgedeletions:[],nodedeletions:[]};b.edges=k.apply(this,[]);b.nodes=f.apply(this,[]);b.nodedeletions=this.objectDeletions;b.edgedeletions=this.edgeDeletions;return b};var p=function(b,c,d){var e=this;b.forEach(function(b){var f=b.object;e.objects.forEach(function(e){if(e.cid==b.name||e.id==f.__id||e.get("__id")==f.__id){var g={__meta:c[e.className]};g[e.getType()]=f;e._parseOutput(d,g)}})})},t=function(b,c,d){var e=this;b.forEach(function(b){var f=
b.connection;e.connections.forEach(function(e){if(e.cid==b.name||e.id==f.__id||e.get("__id")==f.__id){var g={__meta:c[e.className]};g[e.getType()]=f;e._parseOutput(d,g)}})})},q=function(b,d){var e;b&&b.edges&&b.nodes&&0<=b.edges.length&&0<=b.nodes.length?(p.call(this,b.nodes,b.__meta.__type,d),t.call(this,b.edges,b.__meta.__rel,d),d.silent||this.trigger("sync",this,{objects:this.objects,connections:this.connections},d)):(b=b||{},b.status=b.status||{},e=(e=b.status)||{},e.message=e.message||"Server error",
e.code=e.code||"500",this._triggerError(d,new c.Error(e)));return e};c.Batch.prototype._triggerError=function(b,c){b.silent||this.trigger("error",this,c,b)};c.Batch.prototype.execute=function(b){var d=this.toJSON();b=h({_batch:!0},b);if(0==d.nodes.length&&0==d.edges.length&&0==d.edgedeletions.length&&0==d.nodedeletions.length)return b.silent||this.trigger("sync",this,{objects:this.objects,connections:this.connections},b),(new c.Promise).fulfill(this);var e=this,f=new c._Request({method:"PUT",type:"multi",
op:"getBatchUrl",data:d,options:b,entity:this,onSuccess:function(c){(c=q.apply(e,[c,b]))?f.promise.reject(c,e):f.promise.fulfill(e)}});return f.send()};c.Events.mixin(c.Batch.prototype)})(global);
(function(n){var c=n.Appacitive;c.Facebook=new function(){var g=null,h=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);h=!0};this.requestLogin=function(b){b=b||{};if(!h)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var e=c.Promise.buildPromise(b);b.scope||(b.scope="email");FB.login(function(b){b&&"connected"===b.status&&b.authResponse?(g=b.authResponse.accessToken,
e.fulfill(b.authResponse)):e.reject()},b);return e};this.getCurrentUserInfo=function(b){if(!h)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");b=b||{};var e=c.Promise.buildPromise(b);FB.api("/me",function(b){b&&!b.error?(g=FB.getAuthResponse().accessToken,e.fulfill(b)):e.reject()});return e};this.accessToken=function(){return 1===arguments.length?(g=arguments[0],this):g};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=
function(b){g=null;b=b||{};var e=c.Promise.buildPromise(b);try{FB.logout(function(){c.Users.logout();e.fulfill()})}catch(h){e.reject(h.message)}return e}}})(global);
(function(n){var c=n.Appacitive;c.Email=new function(){var g={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return g};var h=function(b,e){var g=new c._Request({method:"POST",type:"email",op:"getSendEmailUrl",options:e,data:b,entity:b,onSuccess:function(b){g.promise.fulfill(b.email)}});return g.send()};this.setupEmail=function(b){b=b||{};g.smtp.username=b.username||g.smtp.username;g.from=b.from||g.from;g.smtp.password=
b.password||g.smtp.password;g.smtp.host=b.smtp.host||g.smtp.host;g.smtp.port=b.smtp.port||g.smtp.port;g.smtp.enablessl=b.enableSSL||g.smtp.enablessl;g.replyto=b.replyTo||g.replyto};this.sendTemplatedEmail=function(b,c){if(!b||!b.to||!b.to.length||0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");
if(!b.templateName)throw Error("template name is mandatory to send an email");var l={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{templatename:b.templateName||"",data:b.data||{},ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){l.smtp=g.smtp;if(!b.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");l.from=b.from||g.from;l.replyto=b.replyTo||g.replyto}return h(l,c)};this.sendRawEmail=function(b,c){if(!b||!b.to||!b.to.length||
0===b.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!b.subject||0===b.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!b.from&&g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!b.body)throw Error("body is mandatory to send an email");var l={to:b.to||[],cc:b.cc||[],bcc:b.bcc||[],subject:b.subject,from:b.from,body:{content:b.body||"",ishtml:!1===b.isHtml?!1:!0}};if(b.useConfig){l.smtp=
g.smtp;if(!b.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");l.from=b.from||g.from;l.replyto=b.replyTo||g.replyto}return h(l,c)}}})(global);
(function(n){var c=n.Appacitive;c.Push=new function(){this.send=function(g,h){if(!g)throw Error("Please specify push options");var b=new c._Request({method:"POST",type:"push",op:"getPushUrl",options:h,data:g,entity:g,onSuccess:function(c){b.promise.fulfill(c.id)}});return b.send()};this.getNotification=function(g,h){if(!g)throw Error("Please specify notification id");var b=new c._Request({method:"GET",type:"push",op:"getGetNotificationUrl",args:[g],options:h,onSuccess:function(c){b.promise.fulfill(c.pushnotification)}});
return b.send()};this.getAllNotifications=function(g,h){g?(g.pnum=g.pnum||1,g.psize=g.psize||20):g={pnum:1,psize:20};var b=new c._Request({method:"GET",type:"push",op:"getGetAllNotificationsUrl",args:[g],options:h,onSuccess:function(c){b.promise.fulfill(c.pushnotifications,c.paginginfo)}});return b.send()}}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type;c.File=function(h){h=h||{};this.fileId=h.fileId;this.contentType=h.contentType;this.fileData=h.fileData;var b=this,e=function(d,e,g,h,l){var m=new c.HttpRequest;m.url=d;m.method="GET";m.description=h;m.onSuccess=e;m.promise=g;m.entity=b;m.options=l;c.http.send(m)},l=function(d,e,g,h,l){var m=new c.HttpRequest;m.url=d;m.method="PUT";m.log=!1;m.description="Upload file";m.data=e;m.headers.push({key:"Content-Type",value:g});m.send().then(h,function(c){l.reject(c,
b)})};this.save=function(b,c){"number"!==typeof b&&(c=b,b=-1);return this.fileId&&g.isString(this.fileId)&&0<this.fileId.length?m(b,c):d(b,c)};var d=function(d,h){if(!b.fileData)throw Error("Please specify filedata");if(!b.contentType)try{b.contentType=b.fileData.type}catch(m){}b.contentType&&g.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var n=c.Promise.buildPromise(h),q=c.config.apiBaseUrl+c.storage.urlFactory.file.getUploadUrl(b.contentType,b.fileId?b.fileId:
"");e(q,function(c){l(c.url,b.fileData,b.contentType,function(){b.fileId=c.id;b.getDownloadUrl(d,h).then(function(c){return n.fulfill(c,b)},function(b){return n.reject(b)})},n)},n," Get upload url for file ",h);return n},m=function(d,h){if(!b.fileData)throw Error("Please specify filedata");if(!b.contentType)try{b.contentType=b.fileData.type}catch(m){}b.contentType&&g.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var n=c.Promise.buildPromise(h),q=c.config.apiBaseUrl+
c.storage.urlFactory.file.getUpdateUrl(b.fileId,b.contentType);e(q,function(c){l(c.url,b.fileData,b.contentType,function(){b.getDownloadUrl(d,h).then(function(c){n.fulfill(c,b)},function(b){n.reject(b)})},n)},n," Get update url for file "+b.fileId,h);return n};this.destroy=function(d){if(!this.fileId)throw Error("Please specify fileId to delete");var e=c.Promise.buildPromise(d),g=new c.HttpRequest;g.url=c.config.apiBaseUrl+c.storage.urlFactory.file.getDeleteUrl(this.fileId);g.method="DELETE";g.description=
"Delete file with id "+this.fileId;g.onSuccess=function(b){e.fulfill()};g.promise=e;g.entity=b;g.options=d;return c.http.send(g)};this.getDownloadUrl=function(d,g){if(!this.fileId)throw Error("Please specify fileId to download");"number"!==typeof d&&(g=d,d=-1);var h=c.Promise.buildPromise(g),l=c.config.apiBaseUrl+c.storage.urlFactory.file.getDownloadUrl(this.fileId,d);e(l,function(c){b.url=c.uri;h.fulfill(c.uri)},h," Get download url for file "+this.fileId,g);return h};this.getUploadUrl=function(d){b.contentType&&
g.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var h=c.Promise.buildPromise(d),l=c.config.apiBaseUrl+c.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");e(l,function(c){b.url=c.url;h.fulfill(c.url,b)},h," Get upload url for file "+this.fileId,d);return h}}})(global);
(function(n){var c=n.Appacitive;c.Date={};var g=function(c){return 10>c?"0"+c:c};c.Date.parse=function(c){var b,e=0,g=[1,4,5,6,7,10,11];if(b=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}|\d{7}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(c)){c=0;for(var d;d=g[c];++c)b[d]=+b[d]||0;b[2]=(+b[2]||1)-1;b[3]=+b[3]||1;"Z"!==b[8]&&void 0!==b[9]?(e=60*b[10]+b[11],"+"===b[9]&&(e=0-e)):"Z"==b[8]&&(b[7]=b[7].toString().substring(0,3));b=Date.UTC(b[1],b[2],b[3],b[4],
b[5]+e,b[6],b[7])}else b=Date.parse?Date.parse(c):NaN;return b};c.Date.parseISODate=function(g){try{return new Date(c.Date.parse(g))}catch(b){return null}};c.Date.toISOString=function(c){try{return c=c.toISOString(),c=c.replace("Z","0000Z")}catch(b){return null}};c.Date.toISODate=function(c){if(c instanceof Date)return String.format("{0}-{1}-{2}",c.getFullYear(),g(c.getMonth()+1),g(c.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};c.Date.toISOTime=function(c){var b=
function(b){return 10>b?b+"000000":100>b?b+"00000":1E3>b?b+"0000":1E4>b?b+"000":1E5>b?b+"00":1E6>b?b+"0":b};if(c instanceof Date)return String.format("{0}:{1}:{2}.{3}",g(c.getHours()),g(c.getMinutes()),g(c.getSeconds()),b(c.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};c.Date.parseISOTime=function(c){try{var b=new Date,e=c.split("T");1===e.length&&e.push(e[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(e[1]))return null;var g=e[1].split("Z")[0].split(":"),
d=g[2].split("."),m=Number(g[0]);1<e.length?(b.setUTCHours(Number(m)),b.setUTCMinutes(Number(g[1])),b.setUTCSeconds(Number(d[0])),d[1]&&b.setUTCMilliseconds(Number(d[1].substring(0,3)))):(b.setHours(Number(m)),b.setMinutes(Number(g[1])),b.setSeconds(Number(d[0])),d[1]&&b.setMilliseconds(Number(d[1].substring(0,3))));return b}catch(f){return null}}})(global);
(function(n){var c=n.Appacitive,g=c.utils._type,h=c.runtime.isBrowser&&"object"==typeof window.localStorage&&g.isFunction(window.localStorage.getItem);c.LocalStorage=new function(){var b=h?window.localStorage:{};this.set=function(e,h){h=h||"";if(!g.isString(e))return this;if(g.isObject(h)||g.isArray(h))try{h=JSON.stringify(h)}catch(d){}var m=c.getAppPrefix(e);b[m]=h;return this};this.get=function(e){if(!g.isString(e))return promise.fulfill(null,e);e=c.getAppPrefix(e);(e=h?b.getItem(e):b[e])||(e=null);
if(e&&"{"===e[0])try{e=JSON.parse(e)}catch(l){}return e};this.multiGet=function(){var b=this,c=Array.prototype.slice.call(arguments);if(1<arguments.length){var d={};c.forEach(function(c){Array.isArray(c)&&(c=c.join());c.replace(/\s/g,"").split(",").forEach(function(c){d[c]=b.get(c)})});return d}throw Error("Appacitive.LocalStorage.multiGet requires atleast one argument");};this.remove=function(e){if(!g.isString(e))return this;e=c.getAppPrefix(e);try{delete b[e]}catch(h){}}}})(global);
(function(n){var c=n.Appacitive;n=c.utils._type;"undefined"!=typeof document&&n.isString(document.cookie)&&(c.Cookie=new function(){this.setCookie=function(g,h,b,e){g=c.getAppPrefix(g);var l="";b&&(l=new Date,l.setTime(l.getTime()+6E4*b),l.toGMTString());l=e?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":c.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";b="domain="+window.location.hostname;"localhost"==window.location.hostname&&(b="");document.cookie=g+"="+h+l+"; path=/;"+
b};this.readCookie=function(g){g=c.getAppPrefix(g);g+="=";for(var h=document.cookie.split(";"),b=0;b<h.length;b++){for(var e=h[b];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(g))return e.substring(g.length,e.length)}return null};this.eraseCookie=function(c){this.setCookie(c,"",-1,!0)}})})(global);"object"===typeof module&&module.exports&&"function"===typeof require&&(module.exports=global.Appacitive);
