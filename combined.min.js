try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(f,d){Object.defineProperty(this,f,{get:d,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(f,d){Object.defineProperty(this,f,{set:d,enumerable:!0,configurable:!0})}}))}catch(defPropException){}var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var f=function(b){if(!b||!b.send||"function"!=typeof b.send)throw Error("No applicable httpTransport class found");b.onResponse=this.onResponse;var e=[],c={},d=0,g={},f=0;this.addProcessor=function(b){if(b){b.pre=b.pre||function(){};b.post=b.post||function(){};var e=b.pre;d+=1;c[d]=e;b=b.post;f+=1;g[f]=b}};this.enqueueRequest=
function(b){e.push(b)};this.notify=function(){if(0!==e.length){var d=[],f;for(f in g)g.hasOwnProperty(f)&&d.push(g[f]);for(;0<e.length;){var k=e.shift(),r=[];for(f in c)c.hasOwnProperty(f)&&r.push(c[f](k));b.send(k,d,r)}}};this.onResponse=function(b){console.dir(b)}},d=function(){var b=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=b;this.onResponse=function(){b()};this.onError=function(){b()}},g=null,g=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,
c=function(b,e){if("undefined"!==typeof XDomainRequest)throw Error("Appacitive doesn't support versions of IE6, IE7, IE8, IE9 due to crossdomain calls");if(!b.url)throw Error("Please specify request url");b.method||(b.method="GET");b.headers||(b.headers=[]);var c={};if(e)c=b.data;else try{b.data&&(c=b.data),c=JSON.stringify(c)}catch(d){}if(!b.onSuccess||"function"!=typeof b.onSuccess)b.onSuccess=function(){};if(!b.onError||"function"!=typeof b.onError)b.onError=function(){};var f=new g;f.onreadystatechange=
function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var e=this.responseText;try{var c=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==c.toLowerCase()||"application/javascript"==c.toLowerCase())e=JSON.parse(e)}catch(d){}b.onSuccess(e,this)}else b.onError({code:this.status,message:this.statusText},this)};f.open(b.method,b.url,!0);for(var l=0;l<b.headers.length;l+=1)f.setRequestHeader(b.headers[l].key,b.headers[l].value);
global.Appacitive.runtime.isBrowser||f.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");f.send(c);return f},b=function(){var b=new d;b.isOnline=function(){return!0};var e=function(e,d,g,f){f||e.headers.push({key:"content-type",value:"application/json"});new c({method:e.method,url:e.url,headers:e.headers,data:e.data,onSuccess:function(c){try{c=JSON.parse(c)}catch(f){}var j=c;if(d.length!=g.length)throw Error("Callback length and state length mismatch!");for(var r=0;r<d.length;r+=1)d[r].apply({},
[j,g[r]]);b.onResponse(c,e)},onError:function(c){b.onError(e,c)}})};b.send=function(b,c,d){"function"==typeof b.beforeSend&&b.beforeSend(b);e(b,c,d)};b.upload=function(b,c,d){"function"==typeof b.beforeSend&&b.beforeSend(b);e(b,c,d,!0)};return b};global.Appacitive.http=new function(){var e=new b,c=new f(e),d=!1;this.pause=function(){d=!0};this.unpause=function(){d=!1};this.addProcessor=function(b){var e=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!b)throw e;
if(!b.pre&&!b.post)throw e;c.addProcessor(b)};this.send=function(b){c.enqueueRequest(b);e.isOnline()&&!1==d&&c.notify()};this.flush=function(b){b?c.notify():e.isOnline()&&c.notify()};this.onError=function(b,e){if(b.onError)if(b.context)b.onError.apply(b.context,[e]);else b.onError(e)};e.onError=this.onError;this.onResponse=function(b,e){if(e.onSuccess)if(e.context)e.onSuccess.apply(e.context,[b]);else e.onSuccess(b)};e.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(b){b=b||{};
this.url=b.url||"";this.data=b.data||{};this.headers=b.headers||[];this.method=b.method||"GET";this.onSuccess=b.onSuccess||function(){};this.onSuccess=b.onError||function(){};this.send=function(b){return new c(this,b)}};var e=global;e.Appacitive&&e.Appacitive.http&&(e.Appacitive.http.addProcessor({pre:function(b){return b},post:function(b,c){try{e.Appacitive.session.isSessionValid(b)?b&&(b.status&&b.status.code&&"8036"==b.status.code||b.code&&"8036"==b.code)?e.Appacitive.Users.logout(function(){},
!0):e.Appacitive.session.incrementExpiry():(null!=e.Appacitive.session.get()&&e.Appacitive.session.resetSession(),e.Appacitive.http.send(c))}catch(d){}}}),e.Appacitive.http.addProcessor({pre:function(){return(new Date).getTime()},post:function(b,e){var c=(new Date).getTime()-e;b._timeTakenInMilliseconds=c}}))})();
(function(f){String.format=function(d,g){if(1>=arguments.length)return d;for(var c=arguments.length-2,b=0;b<=c;b++)d=d.replace(RegExp("\\{"+b+"\\}","gi"),arguments[b+1]);return d};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(d){var g=RegExp("^"+d),c=this;g.test(c)&&(c=c.slice(1,c.length));g=RegExp(d+"$");g.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(d){"undefined"==typeof d&&(d="");for(var g=
"",c=0;c<d.length;c+=1)-1==" .,;#".indexOf(d[c])&&(g+=d[c]);return g=g.toLowerCase()};String.contains=function(d,g){return-1!=d.indexOf(g)};String.startsWith=function(d,g){return 0==d.indexOf(g)};Array.distinct=function(d){var g=[],c=d.length,b,e,f;for(e=0;e<c;e++){b=void 0;for(f=0;f<g.length;f++)if(d[e].toLowerCase()===g[f].toLowerCase()){b=!0;break}b||g.push(d[e])}return g};f.dateFromWcf=function(d,g){var c=/Date\(([^)]+)\)/.exec(d);if(2!=c.length){if(!g)return s;throw Error(s+" is not .net json date.");
}return new Date(parseFloat(c[1]))};f.Appacitive.storage=f.Appacitive.storage||{};f.Appacitive.storage.urlFactory=new function(){f.Appacitive.bag=f.Appacitive.bag||{};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(){return String.format("{0}/create",this.userServiceUrl)},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getUserUrl:function(d){return String.format("{0}/{1}",
this.userServiceUrl,d)},getUpdateUrl:function(d){return String.format("{0}/{1}",this.userServiceUrl,d)},getDeleteUrl:function(d){return String.format("{0}/{1}",this.userServiceUrl,d)},getGetAllLinkedAccountsUrl:function(d){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,d)},getValidateTokenUrl:function(d){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,d)},getInvalidateTokenUrl:function(d){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,
d)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(d){return String.format("{0}/{1}/changepassword",this.userServiceUrl,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(){return String.format("{0}/register",this.deviceServiceUrl)},getUpdateUrl:function(d){return String.format("{0}/{1}",this.deviceServiceUrl,d)},getDeleteUrl:function(d){return String.format("{0}/{1}",this.deviceServiceUrl,
d)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(d,g,c){var b="",b=String.format("{0}/search/{1}/all",this.articleServiceUrl,d),b=c?b+"?psize="+c:b+"?psize=10";if("undefined"!==typeof g&&0<g.length)for(d=0;d<g.length;d+=1)0!=g[d].trim().length&&(b=b+"&"+g[d]);return b},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(d,g){var c=String.format("{0}/search/{1}/all",this.articleServiceUrl,d);return c+
("?properties="+g)},getGetUrl:function(d,g){return String.format("{0}/{1}/{2}",this.articleServiceUrl,d,g)},getMultiGetUrl:function(d,g){return String.format("{0}/{1}/multiGet/{2}",this.articleServiceUrl,d,g)},getCreateUrl:function(d){return String.format("{0}/{1}",this.articleServiceUrl,d)},getUpdateUrl:function(d,g){return String.format("{0}/{1}/{2}",this.articleServiceUrl,d,g)},getDeleteUrl:function(d,g){return String.format("{0}/{1}/{2}",this.articleServiceUrl,d,g)},getMultiDeleteUrl:function(d){return String.format("{0}/{1}/bulkdelete",
this.articleServiceUrl,d)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(d,g){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,d,g)},getMultiGetUrl:function(d,g){return String.format("{0}/{1}/multiGet/{2}",this.connectionServiceUrl,d,g)},getCreateUrl:function(d){return String.format("{0}/{1}",this.connectionServiceUrl,d)},getUpdateUrl:function(d,g){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,d,g)},getDeleteUrl:function(d,g){return String.format("{0}/{1}/{2}",
this.connectionServiceUrl,d,g)},getMultiDeleteUrl:function(d){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,d)},getSearchByArticleUrl:function(d,g,c,b){var e="",e=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,d,c,g);if("undefined"!==typeof b&&0<b.length)for(d=0;d<b.length;d+=1)e=e+"&"+b[d];return e},getConnectedArticles:function(d,g,c){var b="",b=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,d,g);if(c&&c.length&&0<c.length)for(d=
0;d<c.length;d+=1)b=0==d?b+("?"+c[d]):b+("&"+c[d]);return b},getInterconnectsUrl:function(){var d="";return d=String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(d,g){var c=String.format("{0}/{1}/find/all",this.connectionServiceUrl,d);return c+("?properties="+g)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(d){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,d)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",
this.pushServiceUrl)},getGetNotificationUrl:function(d){return String.format("{0}/notification/{1}",this.pushServiceUrl,d)},getGetAllNotificationsUrl:function(d){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,d.psize,d.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(d){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(d))},getUpdateUrl:function(d,g){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,d,escape(g))},getDownloadUrl:function(d,g){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,d,g)},getDeleteUrl:function(d){return String.format("{0}/delete/{1}",this.fileServiceUrl,d)}};this.query={params:function(d){var g=[];return""==location.search||-1==location.search.indexOf("?")?g:d?(d=d.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(c,b){var e=b.split("="),f=e[1];2<e.length&&e.forEach(function(b){0==b||1==b||(f=f+"="+e[b])});
e[0].toLowerCase()==d&&(g=[e[0],f])}),g):location.search.split("?")[1].split("=")}}}})(global);
(function(f){f.Appacitive.eventManager=new function(){var d={};this.subscribe=function(g,c){if("string"!=typeof g||"function"!=typeof c)throw Error("Incorrect subscription call");"undefined"==typeof d[g]&&(d[g]=[]);var b;b=function(){return Math.floor(65536*Math.random()).toString(16)};b=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();d[g].push({callback:c,id:b});return b};this.unsubscribe=function(g){if(!g)return!1;var c=-1,b=null,e;for(e in d)for(var f=0;f<d[e].length;f+=1)if(d[e][f].id==g){c=f;
b=e;break}return-1!=c?(d[b].splice(c,1),!0):!1};this.fire=function(g,c,b){if("string"!=typeof g)throw Error("Incorrect fire call");if("undefined"==typeof b||null===b)b={};b.eventName=g;if("undefined"!=typeof d.all)for(var e=0;e<d.all.length;e+=1)d.all[e].callback(c,b);e=function(b,e,c){setTimeout(function(){b(e,c)},0)};if("undefined"!=typeof d[g])for(var f=0;f<d[g].length;f+=1)e(d[g][f].callback,c,b)};this.clearSubscriptions=function(g){if("string"!=typeof g)throw Error("Event Name must be string in EventManager.clearSubscriptions");
d[g]&&(d[g].length=0);return this};this.clearAndSubscribe=function(d,c){this.clearSubscriptions(d);this.subscribe(d,c)};this.dump=function(){console.dir(d)}}})(global);(function(f){f.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"}})(global);
(function(f){f.Appacitive.session=new function(){var d=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},g=null,c=null,b=null,e=null,h=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){f.Appacitive.session.create(c)};this.create=function(e){c=e=e||{};var h=new d;e.apikey?(h.apikey=e.apikey||"",b=h.apikey):h.apikey=b;h.isnonsliding=e.isnonsliding||h.isnonsliding;h.usagecount=e.usagecount||h.usagecount;h.windowtime=e.windowtime||h.windowtime;
e=new f.Appacitive.HttpRequest;e.url=f.Appacitive.config.apiBaseUrl+"application.svc/session";e.method="put";e.data=h;e.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(g=b.session.sessionkey,f.Appacitive.session.useApiKey=!1,f.Appacitive.eventManager.fire("session.success",{},b),f.Appacitive.session.onSessionCreated()):f.Appacitive.eventManager.fire("session.error",{},b)};f.Appacitive.http.send(e)};f.Appacitive.http.addProcessor({pre:function(c){f.Appacitive.session.useApiKey?c.headers.push({key:"appacitive-apikey",
value:b}):c.headers.push({key:"appacitive-session",value:g});!0===h&&(1==c.headers.filter(function(b){return"appacitive-user-auth"==b.key}).length?c.headers.forEach(function(b){"appacitive-user-auth"==b.key&&(b.value=e)}):c.headers.push({key:"appacitive-user-auth",value:e}))}});this.setUserAuthHeader=function(b,c,d){try{b&&(h=!0,e=b,d||(c||(c=60),-1==c&&(c=null),f.Appacitive.runtime.isBrowser&&(f.Appacitive.Cookie.setCookie("Appacitive-UserToken",b,c),f.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",
c?c:-1,c))))}catch(g){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(b,c){b&&("function"!=typeof b&&"boolean"==typeof b)&&(c=b,b=function(){});h=!1;b=b||function(){};f.Appacitive.localStorage.remove("Appacitive-User");f.Appacitive.runtime.isBrowser&&(f.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),f.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(e&&!c)try{var d=new f.Appacitive.HttpRequest;d.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(e);
e=null;d.method="POST";d.data={};d.onSuccess=function(){"function"==typeof b&&b()};f.Appacitive.http.send(d)}catch(g){}else e=null,"function"==typeof b&&b()};this.isSessionValid=function(b){if(!b)return!0;if(b.status){if(b.status.code&&("8027"==b.status.code||"8002"==b.status.code))return!1}else if(b.code&&("8027"==b.code||"8002"==b.code))return!1;return!0};this.resetSession=function(){g=null;this.useApiKey=!0};this.get=function(){return g};this.setSession=function(b){b&&(g=b,this.useApiKey=!1)};
this.setApiKey=function(e){e&&(b=e,this.useApiKey=!0)};var j="sandbox";this.__defineGetter__("environment",function(){return j});this.__defineSetter__("environment",function(b){"sandbox"!=b&&"live"!=b&&(b="sandbox");j=b})};f.Appacitive.initialize=function(d){f.Appacitive.session.setApiKey(d.apikey||"");f.Appacitive.session.environment=d.env||"";f.Appacitive.useApiKey=!0;if(d.userToken)-1==d.expiry?d.expiry=null:d.expiry||(d.expiry=3600),f.Appacitive.session.setUserAuthHeader(d.userToken,d.expiry),
d.user&&(f.Appacitive.localStorage.set("Appacitive-User",d.user),f.Appacitive.Users.setCurrentUser(d.user));else if(f.Appacitive.runtime.isBrowser&&(d=f.Appacitive.Cookie.readCookie("Appacitive-UserToken"))){var g=f.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");g||(g=60);var c=f.Appacitive.localStorage.get("Appacitive-User");f.Appacitive.Users.setCurrentUser(c,d,g)}}})(global);
(function(f){f.Appacitive&&f.Appacitive.http&&f.Appacitive.http.addProcessor({pre:function(d){d.headers.push({key:"appacitive-environment",value:f.Appacitive.session.environment})}})})(global);
(function(f){f.Appacitive.Queries={};var d=function(b){b=b||{};var e=1,c=200;this.__defineGetter__("pageNumber",function(){return e});this.__defineSetter__("pageNumber",function(b){e=b||1});this.__defineGetter__("pageSize",function(){return c});this.__defineSetter__("pageSize",function(b){c=b||200});this.pageNumber=b.pageNumber;this.pageSize=b.pageSize};d.prototype.toString=function(){return"psize="+this.pageSize+"&pnum="+this.pageNumber};var g=function(b){b=b||{};var e="__UtcLastUpdatedDate",c=!1;
this.__defineGetter__("orderBy",function(){return e});this.__defineSetter__("orderBy",function(b){e=b||"__UtcLastUpdatedDate"});this.__defineGetter__("isAscending",function(){return c});this.__defineSetter__("isAscending",function(b){c="undefined"==typeof b?!1:b});this.orderBy=b.orderBy;this.isAscending=b.isAscending};g.prototype.toString=function(){return"orderBy="+this.orderBy+"&isAsc="+this.isAscending};var c=function(b){var e=b||{},c="",f="",m="",k=b.queryType,n=new d(b),l=new g(b),p=b.schema||
b.relation,q=b.schema?"article":"connection";this.__defineGetter__("type",function(){return q});this.__defineGetter__("entityType",function(){return p});this.__defineGetter__("queryType",function(){return k});this.__defineGetter__("pageQuery",function(){return n});this.__defineGetter__("sortQuery",function(){return l});this.__defineGetter__("filter",function(){return c});this.__defineSetter__("filter",function(b){c=b});this.__defineGetter__("freeText",function(){return f});this.__defineSetter__("freeText",
function(b){"string"==typeof b?f=b:"object"==typeof b&&b.length&&(f=b.join(" "))});this.__defineGetter__("fields",function(){return m});this.__defineSetter__("fields",function(b){"string"==typeof b?m=b:"object"==typeof b&&b.length&&(m=b.join(","))});this.filter=e.filter||"";this.freeText=e.freeText||"";this.fields=e.fields||"";this.setFilter=function(b){this.filter=b};this.setFreeText=function(b){this.freeText=b};this.setFields=function(b){this.fields=b};this.extendOptions=function(b){for(var c in b)e[c]=
b[c];n=new d(e);l=new g(e)};this.getQueryString=function(){var b=this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(b+="&query="+this.filter);this.freeText&&0<this.freeText.trim().length&&(b+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(b+="&fields="+this.fields);return b};this.getOptions=function(){var b={},e;for(e in this)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(b[e]=this[e]);return b}};f.Appacitive.Queries.BasicFilterQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";b=new c(b);b.toRequest=function(){var b=new f.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};b.toUrl=function(){return f.Appacitive.config.apiBaseUrl+this.type+".svc/"+this.entityType+"/find/all?"+this.getQueryString()};return b};f.Appacitive.Queries.ConnectedArticlesQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for connected articles query");
if(!b.articleId)throw Error("Specify articleId for connected articles query");b.schema&&delete b.schema;b.queryType="ConnectedArticlesQuery";var e=new c(b);e.articleId=b.articleId;e.toRequest=function(){var b=new f.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};e.toUrl=function(){return f.Appacitive.config.apiBaseUrl+"connection/"+b.relation+"/"+this.articleId+"/find?"+e.getQueryString()};return e};f.Appacitive.Queries.GetConnectionsQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsQuery query");
if(!b.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!b.label||0==b.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");b.schema&&delete b.schema;b.queryType="GetConnectionsQuery";var e=new c(b);e.articleId=b.articleId;e.label=b.label;e.toRequest=function(){var b=new f.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};e.toUrl=function(){return f.Appacitive.config.apiBaseUrl+"connection/"+b.relation+"/find/all?articleid="+this.articleId+
"&label="+this.label+e.getQueryString()};return e};f.Appacitive.Queries.GraphQuery=function(b){b=b||{};if(!b.graphQuery)throw Error("graphQuery object is mandatory");this.toRequest=function(){var e=new f.Appacitive.HttpRequest;e.url=f.Appacitive.config.apiBaseUrl;e.url+=f.Appacitive.storage.urlFactory.article.getProjectionQueryUrl();e.method="post";e.data=b.graphQuery;return e}}})(global);
(function(f){f.Appacitive.BaseObject=function(d,g){var c={},b=d=d||{};if(g)for(var e in b)if("string"==typeof b[e]||"number"==typeof b[e])c[e]=b[e];else if("object"==typeof b[e]){c[e]=0<=b[e].length?[]:{};for(var h in b[e])c[e][h]=b[e][h]}else c[e]=obj[e];!c.__id&&d.__id&&(c.__id=d.__id);d.__schematype?(d.__schematype=d.__schematype.toLowerCase(),this.entityType=d.__schematype,this.type="user"==d.__schematype||"device"==d.__schematype?d.__schematype:"article"):d.__relationtype&&(d.__relationtype=
d.__relationtype.toLowerCase(),this.entityType=d.__relationtype,this.type="connection");var j=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500"},m=function(e){for(var c in e)if("string"==typeof e[c])b[c]=e[c];else if("object"==typeof e[c]){b[c]=0<=e[c].length?[]:{};for(var d in e[c])b[c][d]=e[c][d]}else b[c]=e[c]};this.getObject=function(){return b};this.toJSON=function(){return b};this.attributes=function(){if(0===arguments.length)return b.__attributes||(b.__attributes=
{}),b.__attributes;if(1==arguments.length)return b.__attributes||(b.__attributes={}),b.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1])throw Error("only string values can be stored in attributes.");b.__attributes||(b.__attributes={});b.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");};this.aggregates=function(){var e={},c;for(c in b){if(!b.hasOwnProperty(c))return;"$"==
c[0]&&(e[c]=b[c])}if(0===arguments.length)return e;if(1==arguments.length)return e[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var k=[];this.__defineGetter__("tags",function(){return!b.__tags?[]:b.__tags});this.addTags=function(e){e&&("string"==typeof e&&e.length)&&(b.__tags.push(e),b.__tags=Array.distinct(b.__tags),k&&k.length&&(e=k.indexOf(e),-1!=e&&k.splice(e,1)))};this.removeTags=function(e){e&&("string"==typeof e&&e.length)&&
(k.push(e),k=Array.distinct(k),b.__tags&&b.__tags.length&&(e=b.__tags.indexOf(e),-1!=e&&b.__tags.splice(e,1)))};this.get=function(e){if(e)return b[e]};this.set=function(e,c){if(!e||"string"!=typeof e||0==e.length)return c;null==c||"undefined"==c?b[e]=null:"string"==typeof c?b[e]=c:"number"==typeof c?b[e]=c+"":"object"==typeof c&&0<=c.length&&(b[e]=c);return c};this.copy=function(b){b&&m(b)};this.save=function(e,c){b.__id?l.apply(this,arguments):n.apply(this,arguments)};var n=function(e,d){e=e||function(){};
d=d||function(){};var g=this,h=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory[this.type].getCreateUrl(b.__schematype||b.__relationtype);if(b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))h=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getCreateUrl();var k=new f.Appacitive.HttpRequest;k.url=h;k.method="put";b.__revision&&delete b.__revision;k.data=b;k.onSuccess=function(f){var h=null;if(f&&
(f.article||f.connection||f.user||f.device))h=f.article||f.connection||f.user||f.device;f&&h?(c=h,b.__id=h.__id,m(h),g.connectionCollections&&0<g.connectionCollections.length&&g.connectionCollections.forEach(function(e){e.getQuery().extendOptions({articleId:b.__id})}),"connection"==g.type&&g.parseConnection(),Appacitive.eventManager.fire((g.__schematype||g.__relationtype)+"."+g.type+".created","base",{object:g}),"function"==typeof e&&e(g)):(f=f||{},f.status=f.status||{},f.status=j(f.status),Appacitive.eventManager.fire((g.__schematype||
g.__relationtype)+"."+g.type+".createFailed","base",{error:f.status}),"function"==typeof d&&d(f.status,g))};k.onError=function(b){b=j(b);"function"==typeof d&&d(b,g)};f.Appacitive.http.send(k)},l=function(e,d){e=e||function(){};d=d||function(){};var g=!1,h=JSON.parse(JSON.stringify(c)),n;for(n in b)"undefined"==typeof b[n]||null===b[n]?(h[n]=null,g=!0):b[n]!=c[n]?(h[n]=b[n],g=!0):b[n]==c[n]&&delete h[n];try{h.__revision&&delete h.__revision,h.__endpointa&&delete h.__endpointa,h.__endpointb&&delete h.__endpointb,
h.__createdby&&delete h.__createdby,h.__lastmodifiedby&&delete h.__lastmodifiedby,h.__schematype&&delete h.__schematype,h.__relationtype&&delete h.__relationtype,h.__utcdatecreated&&delete h.__utcdatecreated,h.__utclastupdateddate&&delete h.__utclastupdateddate,h.__tags&&delete h.__tags}catch(l){}b.__tags&&0<b.__tags.length&&(h.__addtags=b.__tags);k&&0<k.length&&(h.__removetags=k);var t=this;if(g){g=new f.Appacitive.HttpRequest;n=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory[this.type].getUpdateUrl(b.__schematype||
b.__relationtype,c.__id?c.__id:b.__id);if(b&&b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))n=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getUpdateUrl(c.__id);g.url=n;g.method="post";g.data=h;g.onSuccess=function(g){g&&(g.article||g.connection||g.user||g.device)?(c=g.article||g.connection||g.user||g.device,m(c),Appacitive.eventManager.fire(t.type+"."+b.__id+".updated","base",{object:t}),"function"==typeof e&&
e(t)):(g=g||{},g.status=g.status||{},g.status=j(g.status),Appacitive.eventManager.fire(t.type+"."+b.__id+".updateFailed","base",{object:g.status}),"function"==typeof d&&d(g.status,t))};g.onError=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";"function"==typeof d&&d(b,t)};f.Appacitive.http.send(g)}else"function"==typeof e&&e(t)};this.fetch=function(e,d){e=e||function(){};d=d||function(){};if(b.__id){var g=this,h=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory[this.type].getGetUrl(b.__schematype||
b.__relationtype,b.__id),k=new f.Appacitive.HttpRequest;k.url=h;k.method="get";k.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,m(c),g.___collection&&"article"==g.___collection.collectionType&&g.___collection.addToCollection(g),"function"==typeof e&&e(g)):(b=b||{},b.status=b.status||{},b.status=j(b),"function"==typeof d&&d(b.status,g))};k.onError=function(b){b=j(b);"function"==typeof d&&d(b,g)};f.Appacitive.http.send(k)}else"function"==
typeof d&&d({code:"400",message:"Please specify id for get operation"},this)};this.del=function(e,c,d){if(!b.__id&&this.___collection)this.___collection.removeByCId(this.__cid),"function"==typeof e&&e(this);else{e=e||function(){};c=c||function(){};d=d||{};var g=this,h=f.Appacitive.config.apiBaseUrl,h=h+f.Appacitive.storage.urlFactory[this.type].getDeleteUrl(b.__schematype||b.__relationtype,b.__id);if(b&&b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))h=
f.Appacitive.config.apiBaseUrl,h+=f.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getDeleteUrl(b.__id);d.deleteConnections&&!0===d.deleteConnections&&(h=-1==h.indexOf("?")?h+"?deleteconnections=true":h+"&deleteconnections=true");d=new f.Appacitive.HttpRequest;d.url=h;d.method="delete";d.onSuccess=function(d){"200"==d.code?(g.___collection&&g.___collection.removeById(b.__id),"function"==typeof e&&e(d)):(d=j(d),"function"==typeof c&&c(d,g))};d.onError=function(b){b=j(b);"function"==typeof c&&
c(b,g)};f.Appacitive.http.send(d)}}};f.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(f){var d=function(){return Math.floor(65536*Math.random()).toString(16)};f.Appacitive.GUID=function(){var g=d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d(),c="",b,e,f,j,m,k,n=0,g=g.replace(/\r\n/g,"\n");e="";for(f=0;f<g.length;f++)j=g.charCodeAt(f),128>j?e+=String.fromCharCode(j):(127<j&&2048>j?e+=String.fromCharCode(j>>6|192):(e+=String.fromCharCode(j>>12|224),e+=String.fromCharCode(j>>6&63|128)),e+=String.fromCharCode(j&63|128));for(g=e;n<g.length;)b=g.charCodeAt(n++),e=g.charCodeAt(n++),
f=g.charCodeAt(n++),j=b>>2,b=(b&3)<<4|e>>4,m=(e&15)<<2|f>>6,k=f&63,isNaN(e)?m=k=64:isNaN(f)&&(k=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return c.toString()}})(global);
(function(f){f.Appacitive.ArticleCollection=function(d){var g=null,c=null,b=[],e=d;this.collectionType="article";if(!d||!d.schema)throw Error("Must provide schema while initializing ArticleCollection.");var g=d.schema,h=this,j=function(b){b.type="article";b.schema?g=b.schema:b.schema=g;c=new f.Appacitive.Queries.BasicFilterQuery(b);e=b;h.extendOptions=c.extendOptions};this.setFilter=function(b){e.filter=b;e.type="article";c?c.filter=b:(c=new f.Appacitive.Queries.BasicFilterQuery(e),h.extendOptions=
c.extendOptions)};this.setFreeText=function(b){!b&&0==b.trim().length&&(e.freeText="");e.freeText=b;e.type="article";c?c.freeText=b:(c=new f.Appacitive.Queries.BasicFilterQuery(e),h.extendOptions=c.extendOptions)};this.setFields=function(b){b||(e.fields="");e.fields=b;e.type="article";c?c.fields=b:(c=new f.Appacitive.Queries.BasicFilterQuery(e),h.extendOptions=c.extendOptions)};this.reset=function(){g=e=null;b.length=0;c=null};this.__defineGetter__("query",function(){return c});this.getQuery=function(){return c};
this.__defineSetter__("query",function(e){if(!e||!e.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if("BasicFilterQuery"!==e.type)throw Error("ArticleCollection only accepts BasicFilterQuery");b.length=0;c=e});this.setQuery=function(e){if(!e||!e.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");b.length=0;c=e};this.setOptions=j;j(d);this.get=function(e){if(e!=parseInt(e,10))return null;e=parseInt(e,10);return"number"!=typeof e||e>=b.length?
null:b.slice(e,e+1)[0]};this.addToCollection=function(e){if(!e||e.get("__schematype")!=g)throw Error("Null article passed or schema type mismatch");var c=null;b.forEach(function(b,d){b.get("__id")==e.get("__id")&&(c=d)});0!=c?b.splice(c,1):b.push(e)};this.getArticleById=function(e,c,d){c=c||function(){};d=d||function(){};var g=b.filter(function(b){return b.get("__id")==e});1==g.length?c(Array.prototype.slice.call(g)[0]):d()};this.getAll=function(){return Array.prototype.slice.call(b)};this.getAllArticles=
function(){return Array.prototype.slice.call(b).map(function(b){return b.getArticle()})};this.removeById=function(e){if(!e)return!1;var c=null;b.forEach(function(b,d){b.getArticle().__id&&b.getArticle().__id==e&&(c=d)});return null!==c?(b.splice(c,1),!0):!1};this.removeByCId=function(e){if(!e)return!1;var c=null;b.forEach(function(b,d){b.__cid&&b.__cid==e&&(c=d)});return null!==c?(b.splice(c,1),!0):!1};this.fetch=function(e,d){e=e||function(){};d=d||function(){};b.length=0;var g=c.toRequest();g.onSuccess=
function(c){var g=e,j=c.articles;if(j){if(!j.length||0===j.length)j=[];j.forEach(function(e){e=new f.Appacitive.Article(e,!0);e.___collection=h;b.push(e)});g(c.paginginfo||{})}else d(c.status)};f.Appacitive.http.send(g)};this.fetchByPageNumber=function(b,e,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(b,e)};this.fetchNextPage=function(b,e){c.getOptions().pageQuery.pageNumber+=1;this.fetch(b,e)};this.fetchPreviousPage=function(b,e){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&
(d.pageNumber=1);this.fetch(b,e)};this.createNewArticle=function(e){e=e||{};e.__schematype=g;e=new f.Appacitive.Article(e);e.___collection=h;e.__cid=parseInt(1E6*Math.random(),10);b.push(e);return e};this.map=function(){return b.map.apply(this,arguments)};this.forEach=function(){return b.forEach.apply(this,arguments)};this.filter=function(){return b.filter.apply(this,arguments)}};f.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};f.Appacitive.ArticleCollection.prototype.toJSON=
function(){return this.getAllArticles()};f.Appacitive.ArticleCollection.prototype.__defineGetter__("articles",function(){return this.getAll()})})(global);
(function(f){f.Appacitive.ConnectionCollection=function(d){var g=null,c=null,b=[],e=[],h=d;this.collectionType="connection";if(!d||!d.relation)throw Error("Must provide relation while initializing ConnectionCollection.");var g=d.relation,j=function(b){b.type="connection";b.relation?g=b.relation:b.relation=g;c=new f.Appacitive.Queries.BasicFilterQuery(b);h=b};this.setFilter=function(b){h.filter=b;h.type="connection";c?c.filter=b:(c=new f.Appacitive.Queries.BasicFilterQuery(h),m.extendOptions=c.extendOptions)};
this.setFreeText=function(b){!b&&0==b.trim().length&&(h.freeText="");h.freeText=b;h.type="connection";c?c.freeText=b:(c=new f.Appacitive.Queries.BasicFilterQuery(h),m.extendOptions=c.extendOptions)};this.setFields=function(b){b||(h.fields="");h.fields=b;h.type="connection";c?c.fields=b:(c=new f.Appacitive.Queries.BasicFilterQuery(h),m.extendOptions=c.extendOptions)};this.__defineGetter__("query",function(){return c});this.getQuery=function(){return c};this.__defineSetter__("query",function(d){if(!d||
!d.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");e.length=0;b.length=0;c=d});this.setQuery=function(d){if(!d||!d.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");e.length=0;b.length=0;c=d};this.reset=function(){g=h=null;e.length=0;b.length=0;c=null};this.setOptions=j;j(d);this.get=function(e){if(e!=parseInt(e,10))return null;e=parseInt(e,10);return"number"!=typeof e||e>=b.length?null:b.slice(e,e+1)[0]};this.addToCollection=function(e){if(!e||
e.get("__relationtype")!=g)throw Error("Null connection passed or relation type mismatch");var c=null;b.forEach(function(b,d){b.get("__id")==e.get("__id")&&(c=d)});null!==c?b.splice(c,1):b.push(e)};this.getConnection=function(e,c,d){c=c||function(){};d=d||function(){};var g=b.filter(function(b){return b.get("__id")==e});1==g.length?c(Array.prototype.slice.call(g)[0]):d()};this.getAll=function(){return Array.prototype.slice.call(b)};this.getAllConnections=function(){return Array.prototype.slice.call(b).map(function(b){return b.getConnection()})};
this.removeById=function(e){if(!e)return!1;var c=null;b.forEach(function(b,d){b.getConnection().__id&&b.getConnection().__id==e&&(c=d)});return null!==c?(b.splice(c,1),!0):!1};this.removeByCId=function(e){if(!e)return!1;var c=null;b.forEach(function(b,d){b.__cid&&b.__cid==e&&(c=d)});return null!==c?(b.splice(c,1),!0):!1};var m=this;this.getConnectedArticle=function(b){if(!e||0===e.length)return null;var c=e.filter(function(e){return e.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(d,
g){d=d||function(){};g=g||function(){};b.length=0;var h=c.toRequest();h.onSuccess=function(c){a:{var h=d;c=c||{};var j=c.connections;if(!j)if(c.status&&c.status.code&&"200"==c.status.code)j=[];else{g(c.status);break a}if(!j.length||0===j.length)j=[];j.forEach(function(c){c=new f.Appacitive.Connection(c,!0);c.___collection=m;if(c.endpointA.article||c.endpointB.article){var d=c.endpointA.article||c.endpointB.article;d.___collection=m;e.push(d)}try{c.___collection.connectedArticle||delete c.connectedArticle}catch(g){}b.push(c)});
h(c.paginginfo||{})}};f.Appacitive.http.send(h)};this.fetchByPageNumber=function(b,e,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(b,e)};this.fetchNextPage=function(b,e){c.getOptions().pageQuery.pageNumber+=1;this.fetch(b,e)};this.fetchPreviousPage=function(b,e){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(b,e)};this.createNewConnection=function(e){e=e||{};e.__relationtype=g;e=new f.Appacitive.Connection(e);e.___collection=m;e.__cid=parseInt(1E6*
Math.random(),10);b.push(e);return e};this.map=function(){return b.map.apply(this,arguments)};this.forEach=function(e,c){return b.forEach(e,c||this)};this.filter=function(){return b.filter.apply(this,arguments)}}})(global);
(function(f){var d=function(d,c){d=d||function(){};c=c||function(){};var b=new f.Appacitive.HttpRequest;b.method="get";b.url=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));b.onSuccess=function(b){var f=null;b&&(b.identities&&0<b.identities.length)&&(b=b.identities.filter(function(b){return"facebook"==b.authtype.toLowerCase()}),1==b.length&&(f=b[0].username));null!==f?FB.api("/"+f,function(b){b?d(b):c()}):c()};b.onError=function(){c()};
f.Appacitive.http.send(b)};f.Appacitive.Article=function(g,c){if(!g.__schematype&&!g.schema)throw new error("Cannot set article without __schematype");g.schema&&(g.__schematype=g.schema,delete g.schema);var b=new f.Appacitive.BaseObject(g,c);b.type="article";b.connectionCollections=[];b.getArticle=b.getObject;b.get("__schematype")&&"user"==b.get("__schematype").toLowerCase()&&(b.getFacebookProfile=d);b.getConnectedArticles=function(b){if("article"!=this.type)return null;b=b||{};b.articleId=this.get("__id");
var c=new f.Appacitive.ConnectionCollection({relation:b.relation});c.connectedArticle=this;this.connectionCollections.push(c);c.query=new f.Appacitive.Queries.ConnectedArticlesQuery(b);return c};b.getConnections=function(b){if("article"!=this.type)return null;b=b||{};b.articleId=this.get("__id");var c=new f.Appacitive.ConnectionCollection({relation:b.relation});this.connectionCollections.push(c);c.query=new f.Appacitive.Queries.GetConnectionsQuery(b);return c};return b};f.Appacitive.Article.multiDelete=
function(d,c,b,e){if(!d)throw Error("Specify schemaName");if("user"==d.toLowerCase()||"device"==d.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(0<c.length){b=b||function(){};e=e||function(){};var h=new f.Appacitive.HttpRequest;h.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(d);h.method="post";h.data={idlist:c};h.onSuccess=function(c){c&&"200"==c.code?"function"==typeof b&&b():(c=c||{},"function"==typeof e&&e(c.status||
{message:"Server error",code:400}))};h.onError=function(b){b=b||{};"function"==typeof e&&e(b.status||{message:"Server error",code:400})};f.Appacitive.http.send(h)}else b()};f.Appacitive.Article.multiGet=function(d,c,b,e){if(!d)throw Error("Specify schemaName");if("user"==d.toLowerCase()||"device"==d.toLowerCase())throw Error("Cannot multiget user and devices using multidelete");if("object"==typeof c&&0<c.length){var h=new f.Appacitive.HttpRequest;h.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(d,
c.join(","));h.method="get";h.onSuccess=function(c){if(c&&c.articles){if("function"==typeof b){var d=[];c.articles.forEach(function(b){d.push(new f.Appacitive.Article(b))});b(d)}}else c=c||{},"function"==typeof e&&e(c.status||{message:"Server error",code:400})};h.onError=function(b){b=b||{};"function"==typeof e&&e(b.status||{message:"Server error",code:400})};f.Appacitive.http.send(h)}else b([])}})(global);
(function(f){var d=function(c,b,e){var d={label:c.label};c.articleid&&(d.articleid=c.articleid);if(c.article)"function"==typeof c.article.getArticle?c.article.get("__id")?d.articleid=c.article.get("__id"):d.article=c.article.getArticle():"object"==typeof c.article&&c.article.__schematype&&(c.article.__id?d.articleid=c.article.__id:d.article=c.article,c.article=new Appacitive.Article(c.article));else if(!d.articleid&&!d.article)throw Error("Incorrectly configured endpoints provided to setupConnection");
e["endpoint"+b]=c;return d},g=function(c,b,e){e.get("__endpoint"+b.toLowerCase()).article&&"object"==typeof e.get("__endpoint"+b.toLowerCase()).article?(e["endpoint"+b]?e["endpoint"+b]&&e["endpoint"+b].article&&e["endpoint"+b].article.getArticle?e["endpoint"+b].article.copy(e.get("__endpointb").article):e["endpoint"+b].article=new f.Appacitive.Article(e.get("__endpoint"+b.toLowerCase()).article):(e["endpoint"+b]={},e["endpoint"+b].article=new f.Appacitive.Article(e.get("__endpoint"+b.toLowerCase()).article)),
e["endpoint"+b].articleid=e.get("__endpoint"+b.toLowerCase()).articleid,e["endpoint"+b].label=e.get("__endpoint"+b.toLowerCase()).label,e["endpoint"+b].type=e.get("__endpoint"+b.toLowerCase()).type,e["endpoint"+b].article.___collection=e.___collection,delete e.get("__endpoint"+b.toLowerCase()).article):e["endpoint"+b]=e.get("__endpoint"+b.toLowerCase())};f.Appacitive.Connection=function(c,b){if(!c.__relationtype&&!c.relation)throw new error("Cannot set connection without relation");c.relation&&(c.__relationtype=
c.relation,delete c.relation);c.endpoints&&2==c.endpoints.length&&(c.__endpointa=c.endpoints[0],c.__endpointb=c.endpoints[1],delete c.endpoints);var e=new f.Appacitive.BaseObject(c);e.type="connection";e.getConnection=e.getObject;e.setupConnection=function(b,c){if(!b||!b.articleid&&!b.article||!b.label||!c||!c.articleid&&!c.article||!c.label)throw Error("Incorrect endpoints configuration passed.");e.set("__endpointa",d(b,"A",e));e.set("__endpointb",d(c,"B",e))};e.parseConnection=function(){var b=
"A",d="B";c.__endpointa.label==this.get("__endpointb").label&&c.__endpointa.articleid==this.get("__endpointb").articleid&&(b="B",d="A");g(this.get("__endpointa"),b,e);g(this.get("__endpointb"),d,e);e.__defineGetter__("endpoints",function(){var b=[];b.push(this.endpointA);b.push(this.endpointB);return b});return e};b?(e.__defineGetter__("connectedArticle",function(){if(!e.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");var b=
e.___collection.connectedArticle.get("__id");if(!b)return null;var c=e.getConnection().__endpointa.articleid;e.getConnection().__endpointa.articleid==b&&(c=e.getConnection().__endpointb.articleid);return e.___collection.getConnectedArticle(c)}),e.parseConnection()):c.__endpointa&&c.__endpointb&&e.setupConnection(e.get("__endpointa"),e.get("__endpointb"));return e};f.Appacitive.Connection.multiDelete=function(c,b,e,d){if(!c)throw Error("Specify relationName");if(0<b.length){var g=new f.Appacitive.HttpRequest;
g.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(c);g.method="post";g.data={idlist:b};g.onSuccess=function(b){b&&"200"==b.code?e():(b=b||{},d(b||{message:"Server error",code:400}))};g.onError=function(b){b=b||{};d(b||{message:"Server error",code:400})};f.Appacitive.http.send(g)}else e()};f.Appacitive.Connection.multiGet=function(c,b,e,d){if(!c)throw Error("Specify schemaName");if("object"==typeof b&&0<b.length){var g=new f.Appacitive.HttpRequest;g.url=
f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(c,b.join(","));g.method="get";g.onSuccess=function(b){if(b&&b.connections){if("function"==typeof e){var c=[];b.connections.forEach(function(){c.push(new f.Appacitive.Connection(a))});e(c)}}else b=b||{},"function"==typeof d&&d(b.status||{message:"Server error",code:400})};g.onError=function(b){b=b||{};"function"==typeof d&&d(b.status||{message:"Server error",code:400})};f.Appacitive.http.send(g)}else e([])}})(global);
(function(f){f.Appacitive.Users=new function(){var d=null;this.__defineGetter__("currentUser",function(){return d});this.setCurrentUser=function(g,c,b){if(!g||"object"!=typeof g)throw Error("Cannot set null object as user");var e=g;g.getArticle||(e=new Appacitive.User(g));if(!e.get("__id")||0==e.get("__id").length)throw Error("Specify user __id");f.Appacitive.localStorage.set("Appacitive-User",g);b||(b=60);d=e;c&&Appacitive.session.setUserAuthHeader(c,b);d.logout=function(b){Appacitive.Users.logout(b)};
d.updatePassword=function(b,e,c,d){var g=this.get("__id"),l=c,p=d;if(!g||"string"!==typeof g||0==g.length)throw Error("Please specify valid userid");if(!b||"string"!==typeof b||0==b.length)throw Error("Please specify valid oldPassword");if(!e||"string"!==typeof e||0==e.length)throw Error("Please specify valid newPassword");l=l||function(){};p=p||function(){};b==e?"function"==typeof l&&l():(b={oldpassword:b,newpassword:e},e=new f.Appacitive.HttpRequest,e.url=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(g),
e.method="post",e.data=b,e.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof l?l():p(b))},e.onError=p,f.Appacitive.http.send(e))};Appacitive.eventManager.clearAndSubscribe("user."+e.get("__id")+".updated",function(b,e){f.Appacitive.localStorage.set("Appacitive-User",e.object.getArticle())})};f.Appacitive.User=function(d){d.__schematype="user";return new f.Appacitive.Article(d,!0)};this.deleteUser=function(d,c,b){if(!d)throw Error("Specify userid for user delete");(new Appacitive.Article({__schematype:"user",
__id:d})).del(c||function(){},b||function(){})};this.deleteCurrentUser=function(g,c){g=g||function(){};if(null===d)throw Error("Current user is not yet set for delete operation");var b=d.get("__id");this.deleteUser(b,function(b){f.Appacitive.session.removeUserAuthHeader();"function"==typeof g&&g(b)},c)};this.createUser=this.createNewUser=function(d,c,b){d=d||{};d.__schematype="user";if(!d.username||!d.password||!d.firstname||0==d.username.length||0==d.password.length||0==d.firstname.length)throw Error("username, password and firstname are mandatory");
var e=new Appacitive.Article(d);d.type="user";e.save(c,b)};this.signup=function(d,c,b){var e=this;this.createUser(d,function(){e.login(d.username,d.password,c,b)},function(e){b(e)})};this.authenticateUser=function(d,c,b){c=c||function(){};b=b||function(){};d.expiry||(d.expiry=-1);var e=this,h=new f.Appacitive.HttpRequest;h.method="post";h.url=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();h.data=d;h.onSuccess=function(f){f&&f.user?(e.setCurrentUser(f.user,
f.token,d.expiry),c({user:e.currentUser,token:f.token})):(f=f||{},b(f.status))};h.onError=b;f.Appacitive.http.send(h)};this.login=function(d,c,b,e){if(!d||!c||0==d.length||0==c.length)throw Error("Please specify username and password");this.authenticateUser({username:d,password:c,expiry:-1},b||function(){},e||function(){})};this.authenticateWithFacebook=this.signupWithFacebook=function(d,c){d=d||function(){};c=c||function(){};var b=this;FB?FB.api("/me",function(){var e={accesstoken:f.Appacitive.facebook.accessToken,
type:"facebook",expiry:-1,createnew:!0},h=new f.Appacitive.HttpRequest;h.url=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();h.method="post";h.data=e;h.onSuccess=function(e){e.user?(b.setCurrentUser(e.user,e.token,120),d({user:b.currentUser,token:e.token})):(data=data||{},c(data))};h.onError=c;f.Appacitive.http.send(h)}):c()};this.validateCurrentUser=function(d,c){d&&("function"!=typeof d&&"boolean"==typeof d)&&(c=d,d=function(){});var b=f.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(!b)return"function"==typeof d&&d(!1),!1;if(c)return"function"==typeof d&&d(!0),!0;try{var e=new f.Appacitive.HttpRequest;e.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getValidateTokenUrl(b);e.method="POST";e.data={};e.onSuccess=function(b){"function"==typeof d&&d(b.result)};f.Appacitive.http.send(e)}catch(h){d(!1)}};this.sendResetPasswordEmail=function(d,c,b,e){b=b||function(){};e=e||function(){};if(!d||"string"!=typeof d||0==d.length)throw Error("Please specify valid username");
if(c&&"string"==typeof c&&0==c.length)throw Error("Plase specify subject for email");d={username:d,subject:c};c=new f.Appacitive.HttpRequest;c.url=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();c.method="post";c.data=d;c.onSuccess=function(c){c&&"200"==c.code&&("function"==typeof b?b():e(c))};c.onError=e;f.Appacitive.http.send(c)};this.logout=function(g,c){d=null;f.Appacitive.session.removeUserAuthHeader(g||function(){},c)}}})(global);
(function(f){f.Appacitive.email=new function(){var d={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return d};var g=function(c,b,e){var d=new f.Appacitive.HttpRequest;d.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.email.getSendEmailUrl();d.method="post";d.data=c;d.onSuccess=function(c){c&&c.status&&"200"==c.status.code?b(c.email):(c=c||{},c.status=c.status||{},e(c.status.message||"Server error"))};
f.Appacitive.http.send(d)};this.setupEmail=function(c){c=c||{};d.smtp.username=c.username||d.smtp.username;d.from=c.from||d.from;d.smtp.password=c.password||d.smtp.password;d.smtp.host=c.smtp.host||d.smtp.host;d.smtp.port=c.smtp.port||d.smtp.port;d.smtp.enablessl=c.enableSSL||d.smtp.enablessl;d.replyto=c.replyTo||d.replyto};this.sendTemplatedEmail=function(c,b,e){b=b||function(){};e=e||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");if(!c.templateName)throw Error("template name is mandatory to send an email");var f={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{templatename:c.templateName||"",data:c.data||{},ishtml:!1==c.isHtml?!1:!0}};if(c.useConfig){f.smtp=d.smtp;if(!c.from&&!d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
f.from=c.from||d.from;f.replyto=c.replyTo||d.replyto}g(f,b,e)};this.sendRawEmail=function(c,b,e){b=b||function(){};e=e||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.body)throw Error("body is mandatory to send an email");var f={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{content:c.body||"",ishtml:!1==c.isHtml?
!1:!0}};if(c.useConfig){f.smtp=d.smtp;if(!c.from&&!d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");f.from=c.from||d.from;f.replyto=c.replyTo||d.replyto}g(f,b,e)}}})(global);
(function(f){var d=function(){var d=require("facebook-node-sdk"),c=null;this.FB=null;this.initialize=function(b,e){if(!b)throw Error("Please provide appid");if(!e)throw Error("Please provide app secret");this.FB=new d({appId:b,secret:e})};this.requestLogin=function(b,e,d){this.FB?(c=accesstoken,FB.setAccessToken(b)):d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,e){this.FB&&c?(b=b||function(){},e=e||function(){},this.FB.api("/me",function(c,d){d?b(d):e("Access token is invalid")})):
e("Either intialize facebook with your appid and appsecret or set accesstoken")};this.__defineGetter__("accessToken",function(){return c});this.__defineSetter__("accessToken",function(b){console.log(b);c=b;this.FB&&this.FB.setAccessToken(b)});this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"}};f.Appacitive.facebook=f.Appacitive.runtime.isBrowser?new function(){var d=null;this.requestLogin=function(c,b){c=c||function(){};b=b||function(){};FB?FB.login(function(e){e.authResponse?
(d=e.authResponse.accessToken,c(e.authResponse)):b()},{scope:"email,user_birthday"}):b()};this.getCurrentUserInfo=function(c,b){c=c||function(){};b=b||function(){};FB.api("/me",function(e){e?c(e):b()})};this.__defineGetter__("accessToken",function(){return d});this.__defineSetter__("accessToken",function(c){d=c});this.getProfilePictureUrl=function(c){return"https://graph.facebook.com/"+c+"/picture"};this.logout=function(c,b){c=c||function(){};b=b||function(){};Appacitive.facebook.accessToken="";try{FB.logout(function(){Appacitive.Users.logout();
c()})}catch(e){b(e.message)}}}:new d})(global);
(function(f){f.Appacitive.push=new function(){this.send=function(d,g,c){g=g||function(){};c=c||function(){};if(!d)throw Error("Please specify push options");var b=new f.Appacitive.HttpRequest;b.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();b.method="post";b.data=d;b.onSuccess=function(b){b&&b.status&&"200"==b.status.code?g(b.id):(b=b||{},b.status=b.status||{},c(b.status.message||"Server error"))};b.onError=function(b){c(b||"Server error")};f.Appacitive.http.send(b)};
this.getNotification=function(d,g,c){g=g||function(){};c=c||function(){};if(!d)throw Error("Please specify notification id");var b=new f.Appacitive.HttpRequest;b.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(d);b.method="get";b.onSuccess=function(b){b&&b.status&&"200"==b.status.code?g(b.pushnotification):(b=b||{},b.status=b.status||{},c(b.status.message||"Server error"))};b.onError=function(b){c(b||"Server error")};f.Appacitive.http.send(b)};this.getAllNotifications=
function(d,g,c){g=g||function(){};c=c||function(){};d?(d.pnum=d.pnum||1,d.psize=d.psize||20):d={pnum:1,psize:20};var b=new f.Appacitive.HttpRequest;b.url=f.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(d);b.method="get";b.onSuccess=function(b){b&&b.status&&"200"==b.status.code?g(b.pushnotifications,b.paginginfo):(b=b||{},b.status=b.status||{},c(b.status.message||"Server error"))};b.onError=function(b){c(b||"Server error")};f.Appacitive.http.send(b)}}})(global);
(function(f){f.Appacitive.File=function(d){d=d||{};this.fileId=d.fileId;this.contentType=d.contentType;this.fileData=d.fileData;var g=function(b,c,d){var g=new f.Appacitive.HttpRequest;g.url=b;g.method="GET";g.onSuccess=c;g.onError=d;f.Appacitive.http.send(g)},c=function(b,c,d,g,m){(new FormData).append("fileToUpload",c);var k=new f.Appacitive.HttpRequest;k.url=b;k.method="PUT";k.data=c;k.headers.push({key:"content-type",value:d});k.onSuccess=g;k.onError=m;k.send(!0)};this.save=function(b,e,d){if(this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length){var j=this,m=b,k=e;if(!j.fileData)throw Error("Please specify filedata");if(d||"string"==typeof d)j.contentType=d;else{if(!j.contentType||"string"!==typeof d||0==j.contentType.length)j.contentType="text/plain";try{j.contentType=file.type}catch(n){}}b=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.file.getUpdateUrl(j.fileId,j.contentType);m=m||function(){};k=k||function(){};g(b,function(b){b&&b.status&&"200"==b.status.code?c(b.url,
j.fileData,j.contentType,function(){j.getDownloadUrl(function(b){m(b)},k)},k):"function"==typeof k&&k(b.status,j)},k)}else{var l=this,p=b,q=e;if(!l.fileData)throw Error("Please specify filedata");if(d||"string"==typeof d)l.contentType=d;else{if(!l.contentType||"string"!==typeof d||0==l.contentType.length)l.contentType="text/plain";try{l.contentType=file.type}catch(u){}}b=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.file.getUploadUrl(l.contentType);p=p||function(){};q=q||function(){};
g(b,function(b){b&&b.status&&"200"==b.status.code?c(b.url,l.fileData,l.contentType,function(){l.fileId=b.id;l.getDownloadUrl(function(b){p(b)},q)},q):"function"==typeof q&&q(b.status,l)},q)}};this.deleteFile=function(b,c){if(!this.fileId)throw Error("Please specify fileId to delete");b=b||function(){};c=c||function(){};var d=new f.Appacitive.HttpRequest;d.url=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);d.method="DELETE";d.onSuccess=function(d){d&&
"200"==d.code?"function"==typeof b&&b():"function"==typeof c&&"function"==typeof c&&c(d)};d.onError=c;f.Appacitive.http.send(d)};this.getDownloadUrl=function(b,c){if(!this.fileId)throw Error("Please specify fileId to download");var d=this;b=b||function(){};c=c||function(){};var g=new f.Appacitive.HttpRequest;g.url=f.Appacitive.config.apiBaseUrl+f.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);g.method="GET";g.onSuccess=function(f){f&&f.status&&"200"==f.status.code?(d.url=f.uri,
"function"==typeof b&&b(f.uri)):"function"==typeof c&&"function"==typeof c&&c(f.status)};g.onError=c;f.Appacitive.http.send(g)}}})(global);
(function(f){f.Appacitive.parseISODate=function(d){try{var f=new Date(d);if(isNaN(f)){if(/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(d)){var c=d.split("T"),b=c[0].split("-"),e=c[1].split("Z")[0].split(":"),h=e[2].split("."),j=Number(e[0]),f=new Date;f.setUTCFullYear(Number(b[0]));f.setUTCMonth(Number(b[1])-1);f.setUTCDate(Number(b[2]));f.setUTCHours(Number(j));f.setUTCMinutes(Number(e[1]));f.setUTCSeconds(Number(h[0]));h[1]&&f.setUTCMilliseconds(Number(h[1]));
return f}return null}return f}catch(m){return null}};f.Appacitive.toISOString=function(d){try{return d=d.toISOString(),d.indexOf("Z"),d=replace("Z","0000Z")}catch(f){return null}}})(global);
(function(f){f.Appacitive.localStorage=new function(){var d=window.localStorage||{};this.set=function(f,c){c=c||"";if(!f)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(b){}d[f]=c;return!0};this.get=function(f){if(!f)return null;f=d.getItem(f);if(!f)return null;if("{"==f[0])try{f=JSON.parse(f)}catch(c){}return f};this.remove=function(f){if(f)try{delete d[f]}catch(c){}}}})(global);
(function(f){f.Appacitive.runtime.isBrowser&&(f.Appacitive.Cookie=new function(){this.setCookie=function(d,f,c,b){if(c){var e=new Date;e.setTime(e.getTime()+6E4*c);e="; expires="+e.toGMTString()}b||(e="");document.cookie=d+"="+f+e+"; path=/"};this.readCookie=function(d){d+="=";for(var f=document.cookie.split(";"),c=0;c<f.length;c++){for(var b=f[c];" "==b.charAt(0);)b=b.substring(1,b.length);if(0==b.indexOf(d))return b.substring(d.length,b.length)}return null};this.eraseCookie=function(d){this.setCookie(d,
"",-1,!0)}})})(global);"undefined"!=typeof module&&(module.exports=function(f){global.Appacitive.initialize({apikey:f});return global.Appacitive});