try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(e,d){Object.defineProperty(this,e,{get:d,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(e,d){Object.defineProperty(this,e,{set:d,enumerable:!0,configurable:!0})}}))}catch(defPropException){}var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var e=function(a){if(!a||!a.send||"function"!=typeof a.send)throw Error("No applicable httpTransport class found");a.onResponse=this.onResponse;var b=[],c={},d=0,e={},l=0;this.addProcessor=function(a){if(a){a.pre=a.pre||function(){};a.post=a.post||function(){};var b=a.pre;d+=1;c[d]=b;a=a.post;l+=1;e[l]=a}};this.enqueueRequest=
function(a){b.push(a)};this.notify=function(){if(0!==b.length){var d=[],j;for(j in e)e.hasOwnProperty(j)&&d.push(e[j]);for(;0<b.length;){var l=b.shift(),n=[];for(j in c)c.hasOwnProperty(j)&&n.push(c[j](l));a.send(l,d,n)}}};this.onResponse=function(a){console.dir(a)}},d=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(){a()};this.onError=function(){a()}},b=function(){var a=new d;a.type="jQuery based http provider";a.send=function(a,
g,d){"function"==typeof a.beforeSend&&a.beforeSend(a);switch(a.method.toLowerCase()){case "get":$.ajax({url:a.url,type:"GET",async:a.async,beforeSend:function(b){for(var c=0;c<a.headers.length;c+=1)b.setRequestHeader(a.headers[c].key,a.headers[c].value)},success:function(e){try{e=JSON.parse(e)}catch(k){}b(e,g,d);c.onResponse(e,a)},error:function(b){c.onError(a,b)}});break;case "post":$.ajax({url:a.url,type:"POST",async:a.async,contentType:"application/json",data:JSON.stringify(a.data),beforeSend:function(b){for(var c=
0;c<a.headers.length;c+=1)b.setRequestHeader(a.headers[c].key,a.headers[c].value)},success:function(e){try{e=JSON.parse(e)}catch(k){}b(e,g,d);c.onResponse(e,a)},error:function(b){c.onError(a,b)}});break;case "put":$.ajax({url:a.url,type:"PUT",contentType:"application/json",data:JSON.stringify(a.data),async:a.async,beforeSend:function(b){for(var c=0;c<a.headers.length;c+=1)b.setRequestHeader(a.headers[c].key,a.headers[c].value)},success:function(e){try{e=JSON.parse(e)}catch(k){}b(e,g,d);c.onResponse(e,
a)},error:function(b){c.onError(a,b)}});break;case "delete":$.ajax({url:a.url,type:"DELETE",async:a.async,beforeSend:function(b){for(var c=0;c<a.headers.length;c+=1)b.setRequestHeader(a.headers[c].key,a.headers[c].value)},success:function(e){try{e=JSON.parse(e)}catch(k){}b(e,g,d);c.onResponse(e,a)},error:function(b){c.onError(a,b)}});break;default:throw Error("Unrecognized http method: "+a.method);}};a.isOnline=function(){return window.navigator.onLine||!0};var b=function(a,b,c){if(b.length!=c.length)throw Error("Callback length and state length mismatch!");
for(var g=0;g<b.length;g+=1)b[g].apply({},[a,c[g]])},c=a;$=$||{};$.ajax=$.ajax||{};return a},c=function(){var a=new d;a.type="Http provider for nodejs";a.send=function(a,g,d){"function"==typeof a.beforeSend&&a.beforeSend(a);var k=a;a=require("url").parse(k.url);var k=k||{},m;for(m in k)if("headers"==m)for(var n=0;n<k.headers.length;n+=1)c.headers[k.headers[n].key]=k.headers[n].value;else c[m]=k[m];c.host=a.host;c.port=a.port||80;c.path=a.path;c.method=k.method.toUpperCase();"string"!=typeof c.data&&
(c.data=JSON.stringify(c.data));c.headers["Content-Length"]=c.data.length;c.headers["Content-Type"]="application/json";m=e.request(c,function(a){var c="";a.setEncoding("utf8");a.on("data",function(a){c+=a});a.on("end",function(){if("application/json"==a.headers["content-type"]&&"200"==a.statusCode){"{"!=c[0]&&(c=c.substr(1,c.length-1));a.json=JSON.parse(c);var e=a.json;if(g.length!=d.length)throw Error("Callback length and state length mismatch!");for(var j=0;j<g.length;j+=1)g[j].apply({},[e,d[j]]);
b.onResponse(a.json,k)}else a.text=c,b.onError(k,a)})});m.write(c.data);m.on("error",function(a){b.onError(k,a)});m.end()};a.isOnline=function(){return!0};var b=a,c={host:"localhost",port:80,path:"",data:"{}",method:"GET",headers:{"Content-Type":"application/json",accept:"application/json"}},e=require("http");return a};global.Appacitive.http=new function(){var a=global.Appacitive.runtime.isBrowser?new b:new c,d=new e(a),h=!1;this.pause=function(){h=!0};this.unpause=function(){h=!1};this.addProcessor=
function(a){var b=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw b;if(!a.pre&&!a.post)throw b;d.addProcessor(a)};this.send=function(b){d.enqueueRequest(b);a.isOnline()&&!1==h&&d.notify()};this.flush=function(b){b?d.notify():a.isOnline()&&d.notify()};this.onError=function(a,b){if(a.onError)if(a.context)a.onError.apply(a.context,[b]);else a.onError(b)};a.onError=this.onError;this.onResponse=function(a,b){if(b.onSuccess)if(b.context)b.onSuccess.apply(b.context,
[a]);else b.onSuccess(a)};a.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(){this.url="";this.data={};this.async=!0;this.headers=[];this.method="GET"};global.Appacitive&&global.Appacitive.http&&global.Appacitive.http.addProcessor({pre:function(){return(new Date).getTime()},post:function(a,b){var c=(new Date).getTime()-b;a._timeTakenInMilliseconds=c}});var a=global;a.Appacitive&&a.Appacitive.http&&a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(b,c){try{a.Appacitive.session.isSessionValid(b)?
b&&(b.status&&b.status.code&&"8036"==b.status.code||b.code&&"8036"==b.code)?a.Appacitive.session.removeUserAuthHeader(!0):a.Appacitive.session.incrementExpiry():(null!=a.Appacitive.session.get()&&a.Appacitive.session.resetSession(),a.Appacitive.http.send(c))}catch(d){}}})})();
(function(e){String.format=function(d,b){if(1>=arguments.length)return d;for(var c=arguments.length-2,a=0;a<=c;a++)d=d.replace(RegExp("\\{"+a+"\\}","gi"),arguments[a+1]);return d};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(d){var b=RegExp("^"+d),c=this;b.test(c)&&(c=c.slice(1,c.length));b=RegExp(d+"$");b.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(d){"undefined"==typeof d&&(d="");for(var b=
"",c=0;c<d.length;c+=1)-1==" .,;#".indexOf(d[c])&&(b+=d[c]);return b=b.toLowerCase()};String.contains=function(d,b){return-1!=d.indexOf(b)};String.startsWith=function(d,b){return 0==d.indexOf(b)};e.dateFromWcf=function(d,b){var c=/Date\(([^)]+)\)/.exec(d);if(2!=c.length){if(!b)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(c[1]))};e.Appacitive.storage=e.Appacitive.storage||{};e.Appacitive.storage.urlFactory=new function(){e.Appacitive.bag=e.Appacitive.bag||{};this.email=
{emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(){return String.format("{0}/create",this.userServiceUrl)},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getUserUrl:function(d){return String.format("{0}/{1}",this.userServiceUrl,d)},getUpdateUrl:function(d){return String.format("{0}/{1}",this.userServiceUrl,d)},getDeleteUrl:function(d){return String.format("{0}/{1}",
this.userServiceUrl,d)},getGetAllLinkedAccountsUrl:function(d){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,d)},getValidateTokenUrl:function(d){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,d)},getInvalidateTokenUrl:function(d){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(){return String.format("{0}/register",this.deviceServiceUrl)},getUpdateUrl:function(d){return String.format("{0}/{1}",
this.deviceServiceUrl,d)},getDeleteUrl:function(d){return String.format("{0}/{1}",this.deviceServiceUrl,d)}};this.article={articleServiceUrl:"article",getGetUrl:function(d,b){return String.format("{0}/{1}/{2}",this.articleServiceUrl,d,b)},getMultiGetUrl:function(d,b,c){return String.format("{0}/multiGet/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(d,b){return String.format("{0}/multidelete/{1}",this.articleServiceUrl,b)},getSearchAllUrl:function(d,b,c,a){d="";d=String.format("{0}/search/{1}/all",
this.articleServiceUrl,b);d=a?d+"?psize="+a:d+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!=c[b].trim().length&&(d=d+"&"+c[b]);return d},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(d,b,c){d=String.format("{0}/search/{1}/all",this.articleServiceUrl,b);return d+("?properties="+c)},getDeleteUrl:function(d,b){return String.format("{0}/{1}/{2}",this.articleServiceUrl,d,b)},getCreateUrl:function(d){return String.format("{0}/{1}",
this.articleServiceUrl,d)},getUpdateUrl:function(d,b){return String.format("{0}/{1}/{2}",this.articleServiceUrl,d,b)},getMultideleteUrl:function(d){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,d)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(d,b){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,d,b)},getCreateUrl:function(d){return String.format("{0}/{1}",this.connectionServiceUrl,d)},getUpdateUrl:function(d,b,c){return String.format("{0}/update/{1}/{2}",
this.connectionServiceUrl,b,c)},getDeleteUrl:function(d,b){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,d,b)},getMultiDeleteUrl:function(d){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,d)},getSearchByArticleUrl:function(d,b,c,a,g){d="";d=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,a,c);if("undefined"!==typeof g&&0<g.length)for(b=0;b<g.length;b+=1)d=d+"&"+g[b];return d},getConnectedArticles:function(d,b,c,a){d="";d=String.format("{0}/{1}/{2}/find",
this.connectionServiceUrl,b,c);if(a&&a.length&&0<a.length)for(b=0;b<a.length;b+=1)d=0==b?d+("?"+a[b]):d+("&"+a[b]);return d},getInterconnectsUrl:function(){var d="";return d=String.format("{0}/connectedarticles",this.connectionServiceUrl)},getPropertiesSearchUrl:function(d,b,c){d=String.format("{0}/{1}/find/all",this.connectionServiceUrl,b);return d+("?properties="+c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(d){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,
d)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(d){return String.format("{0}/notification/{1}",this.pushServiceUrl,d)},getGetAllNotificationsUrl:function(d){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,d.psize,d.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(contenttype))},
getUploadUrl:function(d,b){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,b,escape(contenttype))},getDownloadUrl:function(d,b){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,d,b)},getDeleteUrl:function(){return String.format("{0}/delete/{1}",this.fileServiceUrl,fileId)}};this.query={params:function(d){var b=[];return""==location.search||-1==location.search.indexOf("?")?b:d?(d=d.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(c,
a){var g=a.split("="),e=g[1];2<g.length&&g.forEach(function(a){0==a||1==a||(e=e+"="+g[a])});g[0].toLowerCase()==d&&(b=[g[0],e])}),b):location.search.split("?")[1].split("=")}}}})(global);
(function(e){e.Appacitive.eventManager=new function(){var d={};this.subscribe=function(b,c){if("string"!=typeof b||"function"!=typeof c)throw Error("Incorrect subscription call");"undefined"==typeof d[b]&&(d[b]=[]);var a;a=function(){return Math.floor(65536*Math.random()).toString(16)};a=a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();d[b].push({callback:c,id:a});return a};this.unsubscribe=function(b){if(!b)return!1;var c=-1,a=null,g;for(g in d)for(var e=0;e<d[g].length;e+=1)if(d[g][e].id==b){c=e;
a=g;break}return-1!=c?(d[a].splice(c,1),!0):!1};this.fire=function(b,c,a){if("string"!=typeof b)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=b;console&&(console.log&&"function"==typeof console.log)&&console.log(b+" fired");if("undefined"!=typeof d.all)for(var g=0;g<d.all.length;g+=1)d.all[g].callback(c,a);g=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof d[b])for(var e=0;e<d[b].length;e+=1)g(d[b][e].callback,c,a)};this.clearSubscriptions=
function(b){if("string"!=typeof b)throw Error("Event Name must be string in EventManager.clearSubscriptions");d[b]&&(d[b].length=0);return this};this.clearAndSubscribe=function(b,c){this.clearSubscriptions(b);this.subscribe(b,c)};this.dump=function(){console.dir(d)}}})(global);(function(e){e.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"}})(global);
(function(e){e.Appacitive.session=new function(){var d=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},b=null,c=null,a=null,g=null,f=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){e.Appacitive.session.create(c)};this.create=function(g){c=g=g||{};var f=new d;g.apikey?(f.apikey=g.apikey||"",a=f.apikey):f.apikey=a;f.isnonsliding=g.isnonsliding||f.isnonsliding;f.usagecount=g.usagecount||f.usagecount;f.windowtime=g.windowtime||f.windowtime;
g=new e.Appacitive.HttpRequest;g.url=e.Appacitive.config.apiBaseUrl+"application.svc/session";g.method="put";g.data=f;g.onSuccess=function(a){a&&a.status&&"200"==a.status.code?(b=a.session.sessionkey,e.Appacitive.session.useApiKey=!1,e.Appacitive.eventManager.fire("session.success",{},a),e.Appacitive.session.onSessionCreated()):e.Appacitive.eventManager.fire("session.error",{},a)};e.Appacitive.http.send(g)};e.Appacitive.http.addProcessor({pre:function(c){e.Appacitive.session.useApiKey?c.headers.push({key:"appacitive-apikey",
value:a}):c.headers.push({key:"appacitive-session",value:b});!0===f&&(1==c.headers.filter(function(a){return"appacitive-user-auth"==a.key}).length?c.headers.forEach(function(a){"appacitive-user-auth"==a.key&&(a.value=g)}):c.headers.push({key:"appacitive-user-auth",value:g}))}});this.setUserAuthHeader=function(a,b,c){try{a&&(f=!0,g=a,c||(b||(b=60),-1==b&&(b=null),e.Appacitive.runtime.isBrowser&&(e.Appacitive.Cookie.setCookie("Appacitive-UserToken",a,b),e.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",
b?b:-1,b))))}catch(d){}};this.incrementExpiry=function(){try{if(e.Appacitive.runtime.isBrowser&&f){var a=e.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");a||(a=60);-1==a&&(a=null);e.Appacitive.Cookie.setCookie("Appacitive-UserToken",g,a);e.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",a?a:-1,a)}}catch(b){}};this.removeUserAuthHeader=function(a,b){a&&("function"!=typeof a&&"boolean"==typeof a)&&(b=a,a=function(){});f=!1;a=a||function(){};e.Appacitive.localStorage.remove("Appacitive-User");
e.Appacitive.runtime.isBrowser&&e.Appacitive.Cookie.eraseCookie("Appacitive-UserToken");if(g&&!b)try{var c=new e.Appacitive.HttpRequest;c.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(g);g=null;c.method="POST";c.data={};c.onSuccess=function(){"function"==typeof a&&a()};e.Appacitive.http.send(c)}catch(d){}else g=null,"function"==typeof a&&a()};this.isSessionValid=function(a){if(!a)return!0;if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==
a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){b=null;this.useApiKey=!0};this.get=function(){return b};this.setSession=function(a){a&&(b=a,this.useApiKey=!1)};this.setApiKey=function(b){b&&(a=b,this.useApiKey=!0)};var h="sandbox";this.__defineGetter__("environment",function(){return h});this.__defineSetter__("environment",function(a){"sandbox"!=a&&"live"!=a&&(a="sandbox");h=a})};e.Appacitive.initialize=function(d){e.Appacitive.session.setApiKey(d.apikey||
"");e.Appacitive.session.environment=d.env||"";e.Appacitive.useApiKey=!0;if(d.userToken)-1==d.expiry?d.expiry=null:d.expiry||(d.expiry=3600),e.Appacitive.session.setUserAuthHeader(d.userToken,d.expiry),d.user&&(e.Appacitive.localStorage.set("Appacitive-User",d.user),e.Appacitive.Users.setCurrentUser(d.user));else if(e.Appacitive.runtime.isBrowser&&(d=e.Appacitive.Cookie.readCookie("Appacitive-UserToken"))){var b=e.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");b||(b=60);var c=e.Appacitive.localStorage.get("Appacitive-User");
e.Appacitive.Users.setCurrentUser(c,d,b)}}})(global);(function(e){e.Appacitive&&e.Appacitive.http&&e.Appacitive.http.addProcessor({pre:function(d){d.headers.push({key:"appacitive-environment",value:e.Appacitive.session.environment})}})})(global);
(function(e){e.Appacitive.queries={};var d=function(a){a=a||{};this.pageNumber=a.pageNumber||1;this.pageSize=a.pageSize||200};d.prototype.toString=function(){return"psize="+this.pageSize+"&pnum="+this.pageNumber};var b=function(a){a=a||{};this.orderBy=a.orderBy||"__UtcLastUpdatedDate";this.isAscending="undefined"==typeof a.isAscending?!1:a.isAscending};b.prototype.toString=function(){return"orderBy="+this.orderBy+"&isAsc="+this.isAscending};var c=function(a){var c=a||{};this.pageQuery=new d(a);this.sortQuery=
new b(a);this.baseType=a.schema||a.relation;if(!this.baseType)throw Error("schema or relation name is mandatory");this.type=a.schema?"article":"connection";this.extendOptions=function(a){for(var e in a)c[e]=a[e];this.pageQuery=new d(c);this.sortQuery=new b(c)};this.toUrl=function(){var a=e.Appacitive.config.apiBaseUrl+this.type+".svc/"+this.baseType+"/find/all?"+this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(a+="&query="+this.filter);this.freeText&&
0<this.freeText.trim().length&&(a+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(a+="&fields="+this.fields);return a};this.toString=function(){var a=this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(a+="&query="+this.filter);this.freeText&&0<this.freeText.trim().length&&(a+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(a+="&fields="+this.fields);return a}};e.Appacitive.queries.BasicFilterQuery=
function(a){a=a||{};var b=new c(a);this.__defineSetter__("filter",function(a){b.filter=a});this.__defineGetter__("freeText",function(){return b.freetext});this.__defineSetter__("freeText",function(a){"string"==typeof freeText?b.freeText=a:"object"==typeof freeText&&a.length&&(b.freeText=a.join(","))});this.__defineGetter__("fields",function(){return b.fields});this.__defineSetter__("fields",function(a){"string"==typeof fields?b.fields=a:"object"==typeof fields&&a.length&&(b.fields=a.join(","))});
this.filter=a.filter||"";this.freeText=a.freeText||"";this.fields=a.fields||"";this.toRequest=function(){var a=new e.Appacitive.HttpRequest;a.url=b.toUrl();a.method="get";return a};this.setFilter=function(a){b.filter=a};this.setFreeText=function(a){this.freeText=a};this.setFields=function(a){this.fields=a};this.extendOptions=function(){b.extendOptions.apply(b,arguments)};this.getOptions=function(){var a={},c;for(c in b)b.hasOwnProperty(c)&&"function"!=typeof b[c]&&(a[c]=b[c]);return a}};e.Appacitive.queries.GraphQuery=
function(a){a=a||{};if(!a.graphQuery)throw Error("graphQuery object is mandatory");this.toRequest=function(){var b=new e.Appacitive.HttpRequest;b.url=e.Appacitive.config.apiBaseUrl;b.url+=e.Appacitive.storage.urlFactory.article.getProjectionQueryUrl();b.method="post";b.data=a.graphQuery;return b}};e.Appacitive.queries.ConnectedArticlesQuery=function(a){a=a||{};var b=new c(a);this.__defineGetter__("filter",function(){return b.filter});this.__defineSetter__("filter",function(a){b.filter=a});this.__defineGetter__("freeText",
function(){return b.freetext});this.__defineSetter__("freeText",function(a){"string"==typeof freeText?b.freeText=a:"object"==typeof freeText&&a.length&&(b.freeText=a.join(","))});this.__defineGetter__("fields",function(){return b.fields});this.__defineSetter__("fields",function(a){"string"==typeof fields?b.fields=a:"object"==typeof fields&&a.length&&(b.fields=a.join(","))});this.filter=a.filter||"";this.freeText=a.freeText||"";this.fields=a.fields||"";this.toRequest=function(){var c=new e.Appacitive.HttpRequest;
c.url=e.Appacitive.config.apiBaseUrl+"connection/"+a.relation+"/"+a.articleId+"/find?"+b.toString();return c};this.extendOptions=function(){b.extendOptions.apply(b,arguments)};this.setFilter=function(a){b.filter=a};this.setFreeText=function(a){this.freeText=a};this.setFields=function(a){this.fields=a};this.getOptions=function(){var a={},c;for(c in b)b.hasOwnProperty(c)&&"function"!=typeof b[c]&&(a[c]=b[c]);return a}}})(global);
(function(e){e.Appacitive.BaseObject=function(d,b){var c={},a=d=d||{};if(b)for(var g in a)c[g]=a[g];!c.__id&&d.__id&&(c.__id=d.__id);this.fetch=function(b,d){b=b||function(){};d=d||function(){};if(a.__id){var g=this,f=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id),h=new e.Appacitive.HttpRequest;h.url=f;h.method="get";h.onSuccess=function(e){if(e&&(e.article||e.connection||e.user||e.device)){c=e.article||e.connection||e.user||
e.device;e=e.article||e.connection||e.user||e.device;a.__id=e.__id;for(var f in e)"undefined"==typeof a[f]&&(a[f]=e[f]);g.___collection&&"article"==g.___collection.collectionType&&g.___collection.addToCollection(g);b()}else d(e.status)};e.Appacitive.http.send(h)}else d()};this.del=function(b,c,d){b=b||function(){};c=c||function(){};d=d||{};if(!a.__id&&this.___collection)this.___collection.removeByCId(this.__cid),b();else{var g=this,f=e.Appacitive.config.apiBaseUrl,f=f+e.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||
a.__relationtype,a.__id);if(a&&a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))f=e.Appacitive.config.apiBaseUrl,f+=e.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id);d.deleteConnections&&!0===d.deleteConnections&&(f=-1==f.indexOf("?")?f+"?deleteconnections=true":f+"&deleteconnections=true");d=new e.Appacitive.HttpRequest;d.url=f;d.method="delete";d.onSuccess=function(d){"200"==d.code?(g.___collection&&g.___collection.removeById(a.__id),
b()):c(d)};d.onError=function(a){c(a)};e.Appacitive.http.send(d)}};this.getObject=function(){return a};this.toJSON=function(){return a};this.attributes=function(){if(0===arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes;if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1])throw Error("only string values can be stored in attributes.");a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=
arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");};this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};this.get=function(b){if(b)return a[b]};this.set=function(b,c){b&&(a[b]=c);return c};this.save=function(b,
c){a.__id?f.apply(this,arguments):h.apply(this,arguments)};this.copy=function(b){for(var c in b)a[c]=b[c]};var f=function(b,d){b=b||function(){};d=d||function(){};var g=!1,f=JSON.parse(JSON.stringify(c)),h;for(h in a)"undefined"==typeof a[h]||null===a[h]?(f[h]=null,g=!0):a[h]!=c[h]?(f[h]=a[h],g=!0):a[h]==c[h]&&delete f[h],f.__revision&&delete f.__revision;if(g){g=new e.Appacitive.HttpRequest;h=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||a.__relationtype,
c.__id?c.__id:a.__id);if(a&&a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))h=e.Appacitive.config.apiBaseUrl,h+=e.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(c.__id);g.url=h;g.method="post";g.data=f;g.onSuccess=function(a){a&&(a.article||a.connection||a.user||a.device)?(c=a.article||a.connection||a.user||a.device,"function"==typeof b&&b()):"function"==typeof d&&d(a.status)};g.onError=function(a){d(a)};e.Appacitive.http.send(g)}else b()},
h=function(b,d){b=b||function(){};d=d||function(){};var g=this,f=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype);if(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))f=e.Appacitive.config.apiBaseUrl,f+=e.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl();var h=new e.Appacitive.HttpRequest;h.url=f;h.method="put";a.__revision&&delete a.__revision;h.data=a;h.onSuccess=
function(e){var f=null;if(e&&(e.article||e.connection||e.user||e.device))f=e.article||e.connection||e.user||e.device;if(e&&f){c=f;a.__id=f.__id;for(var h in f)"undefined"==typeof a[h]&&(a[h]=f[h]);g.connectionCollections&&0<g.connectionCollections.length&&g.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})});"connection"==g.type&&g.parseConnection();"function"==typeof b&&b(g)}else"function"==typeof d&&d(e.status)};h.onError=function(a){d(a)};e.Appacitive.http.send(h)}};
e.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(e){var d=function(){return Math.floor(65536*Math.random()).toString(16)};e.Appacitive.GUID=function(){var b=d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d(),c="",a,e,f,h,j,p,l=0,b=b.replace(/\r\n/g,"\n");e="";for(f=0;f<b.length;f++)h=b.charCodeAt(f),128>h?e+=String.fromCharCode(h):(127<h&&2048>h?e+=String.fromCharCode(h>>6|192):(e+=String.fromCharCode(h>>12|224),e+=String.fromCharCode(h>>6&63|128)),e+=String.fromCharCode(h&63|128));for(b=e;l<b.length;)a=b.charCodeAt(l++),e=b.charCodeAt(l++),
f=b.charCodeAt(l++),h=a>>2,a=(a&3)<<4|e>>4,j=(e&15)<<2|f>>6,p=f&63,isNaN(e)?j=p=64:isNaN(f)&&(p=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);return c.toString()}})(global);
(function(e){e.Appacitive.ArticleCollection=function(d){var b=null,c=null,a=[],g=d;this.collectionType="article";if(!d||!d.schema)throw Error("Must provide schema while initializing ArticleCollection.");var b=d.schema,f=this,h=function(a){a.type="article";a.schema?b=a.schema:a.schema=b;c=new e.Appacitive.queries.BasicFilterQuery(a);g=a;f.extendOptions=c.extendOptions};this.setFilter=function(a){g.filter=a;g.type="article";c?c.filter=a:(c=new e.Appacitive.queries.BasicFilterQuery(g),f.extendOptions=
c.extendOptions)};this.setFreeText=function(a){!a&&0==a.trim().length&&(g.freeText="");g.freeText=a;g.type="article";c?c.freeText=a:(c=new e.Appacitive.queries.BasicFilterQuery(g),f.extendOptions=c.extendOptions)};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="article";c?c.fields=a:(c=new e.Appacitive.queries.BasicFilterQuery(g),f.extendOptions=c.extendOptions)};this.reset=function(){b=g=null;a.length=0;c=null};this.__defineGetter__("query",function(){return c});this.getQuery=function(){return c};
this.__defineSetter__("query",function(b){if(!b||!b.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");a.length=0;c=b});this.setQuery=function(b){if(!b||!b.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");a.length=0;c=b};this.setOptions=h;h(d);this.get=function(b){if(b!=parseInt(b,10))return null;b=parseInt(b,10);return"number"!=typeof b||b>=a.length?null:a.slice(b,b+1)[0]};this.addToCollection=function(c){if(!c||c.get("__schematype")!=b)throw Error("Null article passed or schema type mismatch");
var d=null;a.forEach(function(a,b){a.get("__id")==c.get("__id")&&(d=b)});0!=d?a.splice(d,1):a.push(c)};this.getArticleById=function(b,c,d){c=c||function(){};d=d||function(){};var e=a.filter(function(a){return a.get("__id")==b});1==e.length?c(Array.prototype.slice.call(e)[0]):d()};this.getAll=function(){return Array.prototype.slice.call(a)};this.getAllArticles=function(){return Array.prototype.slice.call(a).map(function(a){return a.getArticle()})};this.removeById=function(b){if(!b)return!1;var c=null;
a.forEach(function(a,d){a.getArticle().__id&&a.getArticle().__id==b&&(c=d)});return null!==c?(a.splice(c,1),!0):!1};this.removeByCId=function(b){if(!b)return!1;var c=null;a.forEach(function(a,d){a.__cid&&a.__cid==b&&(c=d)});return null!==c?(a.splice(c,1),!0):!1};this.fetch=function(b,d){b=b||function(){};d=d||function(){};a.length=0;var g=c.toRequest();g.onSuccess=function(c){var g=b,h=c.articles;if(h){if(!h.length||0===h.length)h=[];h.forEach(function(b){b=new e.Appacitive.Article(b,!0);b.___collection=
f;a.push(b)});g(c.paginginfo||{})}else d(c.status)};e.Appacitive.http.send(g)};this.fetchByPageNumber=function(a,b,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(a,b)};this.fetchNextPage=function(a,b){c.getOptions().pageQuery.pageNumber+=1;this.fetch(a,b)};this.fetchPreviousPage=function(a,b){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(a,b)};this.createNewArticle=function(c){c=c||{};c.__schematype=b;c=new e.Appacitive.Article(c);c.___collection=
f;c.__cid=parseInt(1E6*Math.random(),10);a.push(c);return c};this.map=function(){return a.map.apply(this,arguments)};this.forEach=function(){return a.forEach.apply(this,arguments)};this.filter=function(){return a.filter.apply(this,arguments)}};e.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};e.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};e.Appacitive.ArticleCollection.prototype.__defineGetter__("articles",
function(){return this.getAll()})})(global);
(function(e){e.Appacitive.ConnectionCollection=function(d){var b=null,c=null,a=[],g=[],f=d;this.collectionType="connection";if(!d||!d.relation)throw Error("Must provide relation while initializing ConnectionCollection.");var b=d.relation,h=function(a){a.type="connection";a.relation?b=a.relation:a.relation=b;c=new e.Appacitive.queries.BasicFilterQuery(a);f=a};this.setFilter=function(a){f.filter=a;f.type="connection";c?c.filter=a:(c=new e.Appacitive.queries.BasicFilterQuery(f),j.extendOptions=c.extendOptions)};
this.setFreeText=function(a){!a&&0==a.trim().length&&(f.freeText="");f.freeText=a;f.type="connection";c?c.freeText=a:(c=new e.Appacitive.queries.BasicFilterQuery(f),j.extendOptions=c.extendOptions)};this.setFields=function(a){a||(f.fields="");f.fields=a;f.type="connection";c?c.fields=a:(c=new e.Appacitive.queries.BasicFilterQuery(f),j.extendOptions=c.extendOptions)};this.__defineGetter__("query",function(){return c});this.getQuery=function(){return c};this.__defineSetter__("query",function(b){if(!b||
!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");g.length=0;a.length=0;c=b});this.setQuery=function(b){if(!b||!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");g.length=0;a.length=0;c=b};this.reset=function(){b=f=null;g.length=0;a.length=0;c=null};this.setOptions=h;h(d);this.get=function(b){if(b!=parseInt(b,10))return null;b=parseInt(b,10);return"number"!=typeof b||b>=a.length?null:a.slice(b,b+1)[0]};this.addToCollection=function(c){if(!c||
c.get("__relationtype")!=b)throw Error("Null connection passed or relation type mismatch");var d=null;a.forEach(function(a,b){a.get("__id")==c.get("__id")&&(d=b)});null!==d?a.splice(d,1):a.push(c)};this.getConnection=function(b,c,d){c=c||function(){};d=d||function(){};var e=a.filter(function(a){return a.get("__id")==b});1==e.length?c(Array.prototype.slice.call(e)[0]):d()};this.getAll=function(){return Array.prototype.slice.call(a)};this.getAllConnections=function(){return Array.prototype.slice.call(a).map(function(a){return a.getConnection()})};
this.removeById=function(b){if(!b)return!1;var c=null;a.forEach(function(a,d){a.getConnection().__id&&a.getConnection().__id==b&&(c=d)});return null!==c?(a.splice(c,1),!0):!1};this.removeByCId=function(b){if(!b)return!1;var c=null;a.forEach(function(a,d){a.__cid&&a.__cid==b&&(c=d)});return null!==c?(a.splice(c,1),!0):!1};var j=this;this.getConnectedArticle=function(a){if(!g||0===g.length)return null;var b=g.filter(function(b){return b.get("__id")==a});return 0<b.length?b[0]:null};this.fetch=function(b,
d){b=b||function(){};d=d||function(){};a.length=0;var f=c.toRequest();f.onSuccess=function(c){a:{var f=b;c=c||{};var h=c.connections;if(!h)if(c.status&&c.status.code&&"200"==c.status.code)h=[];else{d(c.status);break a}if(!h.length||0===h.length)h=[];h.forEach(function(b){var c=new e.Appacitive.Connection(b,!0);c.___collection=j;a.push(c);if(b.__endpointa.article||b.__endpointb.article)b=new e.Appacitive.Article(b.__endpointa.article||b.__endpointb.article),b.___collection=j,g.push(b)});f(c.paginginfo||
{})}};e.Appacitive.http.send(f)};this.createNewConnection=function(c){c=c||{};c.__relationtype=b;c=new e.Appacitive.Connection(c);c.___collection=j;c.__cid=parseInt(1E6*Math.random(),10);a.push(c);return c};this.map=function(){return a.map.apply(this,arguments)};this.forEach=function(b,c){return a.forEach(b,c||this)};this.filter=function(){return a.filter.apply(this,arguments)}}})(global);
(function(e){var d=function(b,c){b=b||function(){};c=c||function(){};var a=new e.Appacitive.HttpRequest;a.method="get";a.url=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var d=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(d=a[0].username));null!==d?FB.api("/"+d,function(a){a?b(a):c()}):c()};a.onError=function(){c()};
e.Appacitive.http.send(a)};e.Appacitive.Article=function(b,c){if(!b.__schematype&&!b.schema)throw new error("Cannot set article without __schematype");b.schema&&(b.__schematype=b.schema,delete b.schema);var a=new e.Appacitive.BaseObject(b,c);a.type="article";a.connectionCollections=[];a.getArticle=a.getObject;a.get("__schematype")&&"user"==a.get("__schematype").toLowerCase()&&(a.getFacebookProfile=d);return a};e.Appacitive.BaseObject.prototype.getConnectedArticles=function(b){if("article"!=this.type)return null;
b=b||{};b.articleId=this.get("__id");var c=new e.Appacitive.ConnectionCollection({relation:b.relation});c.connectedArticle=this;this.connectionCollections.push(c);b=new e.Appacitive.queries.ConnectedArticlesQuery(b);c.query=b;return c};e.Appacitive.Article.multiDelete=function(b,c,a,d){if(!b)throw Error("Specify schemaName");if("user"==b.toLowerCase()||"device"==b.toLowerCase())throw Error("Cannot delete schema and devices using multidelete");if(0<c.length){var f=new e.Appacitive.HttpRequest;f.url=
e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultideleteUrl(b);f.method="post";f.data={idlist:c};f.onSuccess=function(b){b&&"200"==b.code?a():(b=b||{},d(b||{message:"Server error",code:400}))};f.onError=function(a){a=a||{};d(a||{message:"Server error",code:400})};e.Appacitive.http.send(f)}else a()}})(global);
(function(e){var d=function(b,c,a){var d={label:b.label};if(b.articleid)d.articleid=b.articleid;else if(b.article&&"function"==typeof b.article.getArticle)b.article.get("__id")?d.articleid=b.article.get("__id"):d.article=b.article.getArticle(),a["endpoint"+c]=b;else if("object"==typeof b.article&&b.article.__schematype)b.article.__id?d.articleid=b.article.__id:d.article=b.article;else throw Error("Incorrectly configured endpoints provided to setupConnection");return d};e.Appacitive.Connection=function(b,
c){if(!b.__relationtype&&!b.relation)throw new error("Cannot set connection without schema");b.schema&&(b.__schematype=b.schema,delete b.schema);b.endpoints&&2==b.endpoints.length&&(b.__endpointa=b.endpoints[0],b.__endpointb=b.endpoints[1],delete b.endpoints);if(!b.__endpointa||!b.__endpointb)throw Error("Provide both endpoints.");var a=new e.Appacitive.BaseObject(b);a.type="connection";a.getConnection=a.getObject;a.setupConnection=function(b,c){if(!b||!b.articleid&&!b.article||!b.label||!c||!c.articleid&&
!c.article||!c.label)throw Error("Incorrect endpoints configuration passed.");a.set("__endpointa",d(b,"A",a));a.set("__endpointb",d(c,"B",a))};a.__defineGetter__("endpoints",function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a});a.parseConnection=function(){var c="A",d="B";b.__endpointa.articleid==this.get("__endpointa").articleid&&(c="B",d="A");"object"==typeof this.get("__endpointa").article?(this.endpointa?this["endpoint"+c].copy(this.get("__endpointb").getArticle()):this["endpoint"+
c]=new e.Appacitive.Article(this.get("__endpointa").article),this["endpoint"+c].___collection=this.___collection):this["endpoint"+c]=this.get("__endpointa");"object"==typeof this.get("__endpointb").article?(this.endpointb?this["endpoint"+d].copy(this.get("__endpointb").getArticle()):this["endpoint"+d]=new e.Appacitive.Article(this.get("__endpointb").article),this["endpoint"+d].___collection=this.___collection):this["endpoint"+d]=this.get("__endpointb");return a};c?a.__defineGetter__("connectedArticle",
function(){if(!a.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");var b=a.___collection.connectedArticle.get("__id");if(!b)return null;var c=a.getConnection().__endpointa.articleid;a.getConnection().__endpointa.articleid==b&&(c=a.getConnection().__endpointb.articleid);return a.___collection.getConnectedArticle(c)}):a.setupConnection(a.get("__endpointa"),a.get("__endpointb"));return a};e.Appacitive.Connection.multiDelete=function(b,
c,a,d){if(!b)throw Error("Specify relationName");if(0<c.length){var f=new e.Appacitive.HttpRequest;f.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultideleteUrl(b);f.method="post";f.data={idlist:c};f.onSuccess=function(b){b&&"200"==b.code?a():(b=b||{},d(b||{message:"Server error",code:400}))};f.onError=function(a){a=a||{};d(a||{message:"Server error",code:400})};e.Appacitive.http.send(f)}else a()}})(global);
(function(e){e.Appacitive.Users=new function(){var d=null;this.__defineGetter__("currentUser",function(){return d});this.setCurrentUser=function(b,c,a){e.Appacitive.localStorage.set("Appacitive-User",b);a||(a=60);d=b;c&&Appacitive.session.setUserAuthHeader(c,a)};e.Appacitive.User=function(b){b=new e.Appacitive.BaseObject(b);b.type="user";b.connectionCollections=[];b.get("__schematype")&&"user"==b.get("__schematype").toLowerCase()&&(b.getFacebookProfile=_getFacebookProfile);return b};this.deleteUser=
function(b,c,a){c=c||function(){};a=a||function(){};var d=new e.Appacitive.HttpRequest;d.method="delete";d.url=e.Appacitive.config.apiBaseUrl;d.url+=e.Appacitive.storage.urlFactory.user.getDeleteUrl(b);d.onSuccess=function(b){b&&b.code&&"200"==b.code?c(b):(b=b||{},b.message=b.message||"Server error",a(b))};d.onError=a;e.Appacitive.http.send(d)};this.deleteCurrentUser=function(b,c){b=b||function(){};if(null===d)throw Error("Current user is not set yet for delete operation");this.deleteUser(d.__id,
function(a){e.Appacitive.session.removeUserAuthHeader();b(a)},c||function(){})};this.createUser=this.signup=function(b,c,a){c=c||function(){};a=a||function(){};b=b||{};b.__schematype="user";if(!b.username||!b.password||!b.firstname||0==b.username.length||0==b.password.length||0==b.firstname.length)throw Error("Username, password and firstname are mandatory");var d=new e.Appacitive.HttpRequest;d.method="put";d.url=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory.user.getCreateUrl();d.data=
b;d.onSuccess=function(b){b&&b.user?c(b.user):a((b||{}).status||"No response from APIs.")};d.onError=a;e.Appacitive.http.send(d)};this.authenticateUser=function(b,c,a){c=c||function(){};a=a||function(){};b.expiry||(b.expiry=-1);var g=this,f=new e.Appacitive.HttpRequest;f.method="post";f.url=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();f.data=b;f.onSuccess=function(e){e&&e.user?(d=e.user,g.setCurrentUser(e.user,e.token,b.expiry),c(e)):(e=e||{},a(e.status))};
f.onError=a;e.Appacitive.http.send(f)};this.authenticate=function(b,c,a,g){a=a||function(){};g=g||function(){};if(!b||!c||0==b.length||0==c.length)throw Error("Please specify username and password");var f=this;b=new e.Appacitive.HttpRequest;b.method="post";b.url=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();b.data=authRequest;b.onSuccess=function(b){b&&b.user?(d=b.user,f.setCurrentUser(b.user,b.token,authRequest.expiry),a(b)):(b=b||{},g(b.status))};b.onError=
g;e.Appacitive.http.send(b)};this.authenticateWithFacebook=this.signupWithFacebook=function(b,c){b=b||function(){};c=c||function(){};var a=this;FB?FB.api("/me",function(){var g={accesstoken:e.Appacitive.facebook.accessToken,type:"facebook",expiry:80,attempts:-1,createnew:!0},f=new e.Appacitive.HttpRequest;f.url=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();f.method="post";f.data=g;f.onSuccess=function(e){e.user?(e.user.__authType="FB",d=e.user,a.setCurrentUser(e.user,
e.token,80),b(e)):c(e)};f.onError=function(){c()};e.Appacitive.http.send(f)}):c()};this.validateCurrentUser=function(b,c){b&&("function"!=typeof b&&"boolean"==typeof b)&&(c=b,b=function(){});var a=e.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(!a)return"function"==typeof b&&b(!1),!1;if(c)return"function"==typeof b&&b(!0),!0;try{var d=new e.Appacitive.HttpRequest;d.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getValidateTokenUrl(a);d.method="POST";d.data={};d.onSuccess=
function(a){"function"==typeof b&&b(a.result)};e.Appacitive.http.send(d)}catch(f){b(!1)}};this.logout=function(b){b=b||function(){};this.currentUser?e.Appacitive.session.removeUserAuthHeader(b):b()}}})(global);
(function(e){e.Appacitive.email=new function(){var d={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return d};var b=function(b,a,d){var f=new e.Appacitive.HttpRequest;f.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.email.getSendEmailUrl();f.method="post";f.data=b;f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?a(b.email):(b=b||{},b.status=b.status||{},d(b.status.message||"Server error"))};
e.Appacitive.http.send(f)};this.setupEmail=function(b){b=b||{};d.smtp.username=b.username||d.smtp.username;d.from=b.from||d.from;d.smtp.password=b.password||d.smtp.password;d.smtp.host=b.smtp.host||d.smtp.host;d.smtp.port=b.smtp.port||d.smtp.port;d.smtp.enablessl=b.enableSSL||d.smtp.enablessl;d.replyto=b.replyTo||d.replyto};this.sendTemplatedEmail=function(c,a,e){a=a||function(){};e=e||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");if(!c.templateName)throw Error("template name is mandatory to send an email");var f={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{templatename:c.templateName||"",data:c.data||{},ishtml:!1==c.isHtml?!1:!0}};if(c.useConfig){f.smtp=d.smtp;if(!c.from&&!d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
f.from=c.from||d.from;f.replyto=c.replyTo||d.replyto}b(f,a,e)};this.sendRawEmail=function(c,a,e){a=a||function(){};e=e||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.body)throw Error("body is mandatory to send an email");var f={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{content:c.body||"",ishtml:!1==c.isHtml?
!1:!0}};if(c.useConfig){f.smtp=d.smtp;if(!c.from&&!d.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");f.from=c.from||d.from;f.replyto=c.replyTo||d.replyto}b(f,a,e)}}})(global);
(function(e){var d=function(){var b=require("facebook-node-sdk"),c=null;this.FB=null;this.initialize=function(a,c){if(!a)throw Error("Please provide appid");if(!c)throw Error("Please provide app secret");this.FB=new b({appId:a,secret:c})};this.requestLogin=function(a,b,d){this.FB?(c=accesstoken,FB.setAccessToken(a)):d("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(a,b){this.FB&&c?(a=a||function(){},b=b||function(){},this.FB.api("/me",function(c,d){d?a(d):b("Access token is invalid")})):
b("Either intialize facebook with your appid and appsecret or set accesstoken")};this.__defineGetter__("accessToken",function(){return c});this.__defineSetter__("accessToken",function(a){console.log(a);c=a;this.FB&&this.FB.setAccessToken(a)});this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"}};e.Appacitive.facebook=e.Appacitive.runtime.isBrowser?new function(){var b=null;this.requestLogin=function(c,a){c=c||function(){};a=a||function(){};FB?FB.login(function(d){d.authResponse?
(b=d.authResponse.accessToken,c(d.authResponse)):a()},{scope:"email,user_birthday"}):a()};this.getCurrentUserInfo=function(b,a){b=b||function(){};a=a||function(){};FB.api("/me",function(d){d?b(d):a()})};this.__defineGetter__("accessToken",function(){return b});this.__defineSetter__("accessToken",function(c){b=c});this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b,a){b=b||function(){};a=a||function(){};Appacitive.facebook.accessToken="";try{FB.logout(function(){b()})}catch(d){a(d.message)}}}:
new d})(global);
(function(e){e.Appacitive.push=new function(){this.send=function(d,b,c){b=b||function(){};c=c||function(){};if(!d)throw Error("Please specify push options");var a=new e.Appacitive.HttpRequest;a.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();a.method="post";a.data=d;a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?b(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};a.onError=function(a){c(a||"Server error")};e.Appacitive.http.send(a)};this.getNotification=
function(d,b,c){b=b||function(){};c=c||function(){};if(!d)throw Error("Please specify notification id");var a=new e.Appacitive.HttpRequest;a.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(d);a.method="get";a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?b(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};a.onError=function(a){c(a||"Server error")};e.Appacitive.http.send(a)};this.getAllNotifications=function(d,
b,c){b=b||function(){};c=c||function(){};d?(d.pnum=d.pnum||1,d.psize=d.psize||20):d={pnum:1,psize:20};var a=new e.Appacitive.HttpRequest;a.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(d);a.method="get";a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?b(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};a.onError=function(a){c(a||"Server error")};e.Appacitive.http.send(a)}}})(global);
(function(e){e.Appacitive.parseISODate=function(d){try{var b=new Date(d);if(isNaN(b)){if(/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(d)){var c=d.split("T"),a=c[0].split("-"),e=c[1].split("Z")[0].split(":"),f=e[2].split("."),h=Number(e[0]),b=new Date;b.setUTCFullYear(Number(a[0]));b.setUTCMonth(Number(a[1])-1);b.setUTCDate(Number(a[2]));b.setUTCHours(Number(h));b.setUTCMinutes(Number(e[1]));b.setUTCSeconds(Number(f[0]));f[1]&&b.setUTCMilliseconds(Number(f[1]));
return b}return null}return b}catch(j){return null}};e.Appacitive.toISOString=function(d){try{return d=d.toISOString(),d.indexOf("Z"),d=replace("Z","0000Z")}catch(b){return null}}})(global);
(function(e){e.Appacitive.localStorage=new function(){var d=window.localStorage||{};this.set=function(b,c){c=c||"";if(!b)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(a){}d[b]=c;return!0};this.get=function(b){if(!b)return null;b=d.getItem(b);if(!b)return null;if("{"==b[0])try{b=JSON.parse(b)}catch(c){}return b};this.remove=function(b){if(b)try{delete d[b]}catch(c){}}}})(global);
(function(e){e.Appacitive.runtime.isBrowser&&(e.Appacitive.Cookie=new function(){this.setCookie=function(d,b,c){if(c){var a=new Date;a.setTime(a.getTime()+6E4*c);c="; expires="+a.toGMTString()}else c="";document.cookie=d+"="+b+c+"; path=/"};this.readCookie=function(d){d+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var a=b[c];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(d))return a.substring(d.length,a.length)}return null};this.eraseCookie=function(d){this.setCookie(d,
"",-1)}})})(global);"undefined"!=typeof module&&(module.exports=function(e){global.Appacitive.initialize({apikey:e});return global.Appacitive});