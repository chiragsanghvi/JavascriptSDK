try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(e,d){Object.defineProperty(this,e,{get:d,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(e,d){Object.defineProperty(this,e,{set:d,enumerable:!0,configurable:!0})}}))}catch(defPropException){}var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var e=function(a){if(!a||!a.send||"function"!=typeof a.send)throw Error("No applicable httpTransport class found");a.onResponse=this.onResponse;var b=[],c={},j=0,d={},e=0;this.addProcessor=function(a){if(a){a.pre=a.pre||function(){};a.post=a.post||function(){};var b=a.pre;j+=1;c[j]=b;a=a.post;e+=1;d[e]=a}};this.enqueueRequest=
function(a){b.push(a)};this.notify=function(){if(0!==b.length){var j=[],e;for(e in d)d.hasOwnProperty(e)&&j.push(d[e]);for(;0<b.length;){var n=b.shift(),p=[];for(e in c)c.hasOwnProperty(e)&&p.push(c[e](n));a.send(n,j,p)}}};this.onResponse=function(a){console.dir(a)}},d=function(){var a=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=a;this.onResponse=function(){a()};this.onError=function(){a()}},c=function(){var a=new d;a.type="jQuery based http provider";a.send=function(a,
f,d){"function"==typeof a.beforeSend&&a.beforeSend(a);switch(a.method.toLowerCase()){case "get":$.ajax({url:a.url,type:"GET",async:a.async,beforeSend:function(b){for(var f=0;f<a.headers.length;f+=1)b.setRequestHeader(a.headers[f].key,a.headers[f].value)},success:function(e){try{e=JSON.parse(e)}catch(k){}b(e,f,d);c.onResponse(e,a)},error:function(b){c.onError(a,b)}});break;case "post":$.ajax({url:a.url,type:"POST",async:a.async,contentType:"application/json",data:JSON.stringify(a.data),beforeSend:function(b){for(var f=
0;f<a.headers.length;f+=1)b.setRequestHeader(a.headers[f].key,a.headers[f].value)},success:function(e){try{e=JSON.parse(e)}catch(k){}b(e,f,d);c.onResponse(e,a)},error:function(b){c.onError(a,b)}});break;case "put":$.ajax({url:a.url,type:"PUT",contentType:"application/json",data:JSON.stringify(a.data),async:a.async,beforeSend:function(b){for(var f=0;f<a.headers.length;f+=1)b.setRequestHeader(a.headers[f].key,a.headers[f].value)},success:function(e){try{e=JSON.parse(e)}catch(k){}b(e,f,d);c.onResponse(e,
a)},error:function(b){c.onError(a,b)}});break;case "delete":$.ajax({url:a.url,type:"DELETE",async:a.async,beforeSend:function(b){for(var f=0;f<a.headers.length;f+=1)b.setRequestHeader(a.headers[f].key,a.headers[f].value)},success:function(e){try{e=JSON.parse(e)}catch(k){}b(e,f,d);c.onResponse(e,a)},error:function(b){c.onError(a,b)}});break;default:throw Error("Unrecognized http method: "+a.method);}};a.isOnline=function(){return window.navigator.onLine||!0};var b=function(a,b,f){if(b.length!=f.length)throw Error("Callback length and state length mismatch!");
for(var c=0;c<b.length;c+=1)b[c].apply({},[a,f[c]])},c=a;$=$||{};$.ajax=$.ajax||{};return a},b=function(){var a=new d;a.type="Http provider for nodejs";a.send=function(a,f,d){"function"==typeof a.beforeSend&&a.beforeSend(a);var k=a;a=require("url").parse(k.url);var k=k||{},m;for(m in k)if("headers"==m)for(var p=0;p<k.headers.length;p+=1)c.headers[k.headers[p].key]=k.headers[p].value;else c[m]=k[m];c.host=a.host;c.port=a.port||80;c.path=a.path;c.method=k.method.toUpperCase();"string"!=typeof c.data&&
(c.data=JSON.stringify(c.data));c.headers["Content-Length"]=c.data.length;c.headers["Content-Type"]="application/json";m=e.request(c,function(a){var c="";a.setEncoding("utf8");a.on("data",function(a){c+=a});a.on("end",function(){if("application/json"==a.headers["content-type"]&&"200"==a.statusCode){"{"!=c[0]&&(c=c.substr(1,c.length-1));a.json=JSON.parse(c);var e=a.json;if(f.length!=d.length)throw Error("Callback length and state length mismatch!");for(var j=0;j<f.length;j+=1)f[j].apply({},[e,d[j]]);
b.onResponse(a.json,k)}else a.text=c,b.onError(k,a)})});m.write(c.data);m.on("error",function(a){b.onError(k,a)});m.end()};a.isOnline=function(){return!0};var b=a,c={host:"localhost",port:80,path:"",data:"{}",method:"GET",headers:{"Content-Type":"application/json",accept:"application/json"}},e=require("http");return a};global.Appacitive.http=new function(){var a=global.Appacitive.runtime.isBrowser?new c:new b,d=new e(a),h=!1;this.pause=function(){h=!0};this.unpause=function(){h=!1};this.addProcessor=
function(a){var b=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!a)throw b;if(!a.pre&&!a.post)throw b;d.addProcessor(a)};this.send=function(b){d.enqueueRequest(b);a.isOnline()&&!1==h&&d.notify()};this.flush=function(b){b?d.notify():a.isOnline()&&d.notify()};this.onError=function(a,b){if(a.onError)if(a.context)a.onError.apply(a.context,[b]);else a.onError(b)};a.onError=this.onError;this.onResponse=function(a,b){if(b.onSuccess)if(b.context)b.onSuccess.apply(b.context,
[a]);else b.onSuccess(a)};a.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(){this.url="";this.data={};this.async=!0;this.headers=[];this.method="GET"};global.Appacitive&&global.Appacitive.http&&global.Appacitive.http.addProcessor({pre:function(){return(new Date).getTime()},post:function(a,b){var c=(new Date).getTime()-b;a._timeTakenInMilliseconds=c}});var a=global;a.Appacitive&&a.Appacitive.http&&a.Appacitive.http.addProcessor({pre:function(a){return a},post:function(b,c){try{a.Appacitive.session.isSessionValid(b)?
b&&(b.status&&b.status.code&&"8036"==b.status.code||b.code&&"8036"==b.code)?a.Appacitive.session.removeUserAuthHeader(!0):a.Appacitive.session.incrementExpiry():(null!=a.Appacitive.session.get()&&a.Appacitive.session.resetSession(),a.Appacitive.http.send(c))}catch(d){}}})})();
(function(e){String.format=function(d,c){if(1>=arguments.length)return d;for(var b=arguments.length-2,a=0;a<=b;a++)d=d.replace(RegExp("\\{"+a+"\\}","gi"),arguments[a+1]);return d};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(d){var c=RegExp("^"+d),b=this;c.test(b)&&(b=b.slice(1,b.length));c=RegExp(d+"$");c.test(b)&&(b=b.slice(0,-1));return b};String.toSearchString=function(d){"undefined"==typeof d&&(d="");for(var c=
"",b=0;b<d.length;b+=1)-1==" .,;#".indexOf(d[b])&&(c+=d[b]);return c=c.toLowerCase()};String.contains=function(d,c){return-1!=d.indexOf(c)};String.startsWith=function(d,c){return 0==d.indexOf(c)};e.dateFromWcf=function(d,c){var b=/Date\(([^)]+)\)/.exec(d);if(2!=b.length){if(!c)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(b[1]))};e.Appacitive.storage=e.Appacitive.storage||{};e.Appacitive.storage.urlFactory=new function(){e.Appacitive.bag=e.Appacitive.bag||{};this.email=
{emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(){return String.format("{0}/create",this.userServiceUrl)},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getUserUrl:function(d){return String.format("{0}/{1}",this.userServiceUrl,d)},getUpdateUrl:function(d){return String.format("{0}/{1}",this.userServiceUrl,d)},getDeleteUrl:function(d){return String.format("{0}/{1}",
this.userServiceUrl,d)},getGetAllLinkedAccountsUrl:function(d){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,d)},getValidateTokenUrl:function(d){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,d)},getInvalidateTokenUrl:function(d){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,d)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(){return String.format("{0}/register",this.deviceServiceUrl)},getUpdateUrl:function(d){return String.format("{0}/{1}",
this.deviceServiceUrl,d)},getDeleteUrl:function(d){return String.format("{0}/{1}",this.deviceServiceUrl,d)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(d,c,b){var a="",a=String.format("{0}/search/{1}/all",this.articleServiceUrl,d),a=b?a+"?psize="+b:a+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(d=0;d<c.length;d+=1)0!=c[d].trim().length&&(a=a+"&"+c[d]);return a},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(d,
c){var b=String.format("{0}/search/{1}/all",this.articleServiceUrl,d);return b+("?properties="+c)},getGetUrl:function(d,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,d,c)},getMultiGetUrl:function(d,c){return String.format("{0}/multiGet/{1}/{2}",this.articleServiceUrl,d,c)},getCreateUrl:function(d){return String.format("{0}/{1}",this.articleServiceUrl,d)},getUpdateUrl:function(d,c){return String.format("{0}/{1}/{2}",this.articleServiceUrl,d,c)},getDeleteUrl:function(d,c){return String.format("{0}/{1}/{2}",
this.articleServiceUrl,d,c)},getMultiDeleteUrl:function(d){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,d)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(d,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,d,c)},getMultiGetUrl:function(d,c){return String.format("{0}/multiGet/{1}/{2}",this.articleServiceUrl,d,c)},getCreateUrl:function(d){return String.format("{0}/{1}",this.connectionServiceUrl,d)},getUpdateUrl:function(d,c){return String.format("{0}/{1}/{2}",
this.connectionServiceUrl,d,c)},getDeleteUrl:function(d,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,d,c)},getMultiDeleteUrl:function(d){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,d)},getSearchByArticleUrl:function(d,c,b,a){var f="",f=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,d,b,c);if("undefined"!==typeof a&&0<a.length)for(d=0;d<a.length;d+=1)f=f+"&"+a[d];return f},getConnectedArticles:function(d,c,b){var a="",a=
String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,d,c);if(b&&b.length&&0<b.length)for(d=0;d<b.length;d+=1)a=0==d?a+("?"+b[d]):a+("&"+b[d]);return a},getInterconnectsUrl:function(){var d="";return d=String.format("{0}/connectedarticles",this.connectionServiceUrl)},getPropertiesSearchUrl:function(d,c){var b=String.format("{0}/{1}/find/all",this.connectionServiceUrl,d);return b+("?properties="+c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(d){return String.format("{0}/list/{1}/contents",
this.cannedListServiceUrl,d)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(d){return String.format("{0}/notification/{1}",this.pushServiceUrl,d)},getGetAllNotificationsUrl:function(d){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,d.psize,d.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,
escape(contenttype))},getUploadUrl:function(d,c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,c,escape(contenttype))},getDownloadUrl:function(d,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,d,c)},getDeleteUrl:function(){return String.format("{0}/delete/{1}",this.fileServiceUrl,fileId)}};this.query={params:function(d){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:d?(d=d.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(b,
a){var f=a.split("="),e=f[1];2<f.length&&f.forEach(function(a){0==a||1==a||(e=e+"="+f[a])});f[0].toLowerCase()==d&&(c=[f[0],e])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(e){e.Appacitive.eventManager=new function(){var d={};this.subscribe=function(c,b){if("string"!=typeof c||"function"!=typeof b)throw Error("Incorrect subscription call");"undefined"==typeof d[c]&&(d[c]=[]);var a;a=function(){return Math.floor(65536*Math.random()).toString(16)};a=a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();d[c].push({callback:b,id:a});return a};this.unsubscribe=function(c){if(!c)return!1;var b=-1,a=null,f;for(f in d)for(var e=0;e<d[f].length;e+=1)if(d[f][e].id==c){b=e;
a=f;break}return-1!=b?(d[a].splice(b,1),!0):!1};this.fire=function(c,b,a){if("string"!=typeof c)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=c;console&&(console.log&&"function"==typeof console.log)&&console.log(c+" fired");if("undefined"!=typeof d.all)for(var f=0;f<d.all.length;f+=1)d.all[f].callback(b,a);f=function(a,b,c){setTimeout(function(){a(b,c)},0)};if("undefined"!=typeof d[c])for(var e=0;e<d[c].length;e+=1)f(d[c][e].callback,b,a)};this.clearSubscriptions=
function(c){if("string"!=typeof c)throw Error("Event Name must be string in EventManager.clearSubscriptions");d[c]&&(d[c].length=0);return this};this.clearAndSubscribe=function(c,b){this.clearSubscriptions(c);this.subscribe(c,b)};this.dump=function(){console.dir(d)}}})(global);(function(e){e.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"}})(global);
(function(e){e.Appacitive.session=new function(){var d=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},c=null,b=null,a=null,f=null,g=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){e.Appacitive.session.create(b)};this.create=function(f){b=f=f||{};var l=new d;f.apikey?(l.apikey=f.apikey||"",a=l.apikey):l.apikey=a;l.isnonsliding=f.isnonsliding||l.isnonsliding;l.usagecount=f.usagecount||l.usagecount;l.windowtime=f.windowtime||l.windowtime;
f=new e.Appacitive.HttpRequest;f.url=e.Appacitive.config.apiBaseUrl+"application.svc/session";f.method="put";f.data=l;f.onSuccess=function(a){a&&a.status&&"200"==a.status.code?(c=a.session.sessionkey,e.Appacitive.session.useApiKey=!1,e.Appacitive.eventManager.fire("session.success",{},a),e.Appacitive.session.onSessionCreated()):e.Appacitive.eventManager.fire("session.error",{},a)};e.Appacitive.http.send(f)};e.Appacitive.http.addProcessor({pre:function(b){e.Appacitive.session.useApiKey?b.headers.push({key:"appacitive-apikey",
value:a}):b.headers.push({key:"appacitive-session",value:c});!0===g&&(1==b.headers.filter(function(a){return"appacitive-user-auth"==a.key}).length?b.headers.forEach(function(a){"appacitive-user-auth"==a.key&&(a.value=f)}):b.headers.push({key:"appacitive-user-auth",value:f}))}});this.setUserAuthHeader=function(a,b,c){try{a&&(g=!0,f=a,c||(b||(b=60),-1==b&&(b=null),e.Appacitive.runtime.isBrowser&&(e.Appacitive.Cookie.setCookie("Appacitive-UserToken",a,b),e.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",
b?b:-1,b))))}catch(d){}};this.incrementExpiry=function(){try{if(e.Appacitive.runtime.isBrowser&&g){var a=e.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");a||(a=60);-1==a&&(a=null);e.Appacitive.Cookie.setCookie("Appacitive-UserToken",f,a);e.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",a?a:-1,a)}}catch(b){}};this.removeUserAuthHeader=function(a,b){a&&("function"!=typeof a&&"boolean"==typeof a)&&(b=a,a=function(){});g=!1;a=a||function(){};e.Appacitive.localStorage.remove("Appacitive-User");
e.Appacitive.runtime.isBrowser&&e.Appacitive.Cookie.eraseCookie("Appacitive-UserToken");if(f&&!b)try{var c=new e.Appacitive.HttpRequest;c.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(f);f=null;c.method="POST";c.data={};c.onSuccess=function(){"function"==typeof a&&a()};e.Appacitive.http.send(c)}catch(d){}else f=null,"function"==typeof a&&a()};this.isSessionValid=function(a){if(!a)return!0;if(a.status){if(a.status.code&&("8027"==a.status.code||"8002"==
a.status.code))return!1}else if(a.code&&("8027"==a.code||"8002"==a.code))return!1;return!0};this.resetSession=function(){c=null;this.useApiKey=!0};this.get=function(){return c};this.setSession=function(a){a&&(c=a,this.useApiKey=!1)};this.setApiKey=function(b){b&&(a=b,this.useApiKey=!0)};var h="sandbox";this.__defineGetter__("environment",function(){return h});this.__defineSetter__("environment",function(a){"sandbox"!=a&&"live"!=a&&(a="sandbox");h=a})};e.Appacitive.initialize=function(d){e.Appacitive.session.setApiKey(d.apikey||
"");e.Appacitive.session.environment=d.env||"";e.Appacitive.useApiKey=!0;if(d.userToken)-1==d.expiry?d.expiry=null:d.expiry||(d.expiry=3600),e.Appacitive.session.setUserAuthHeader(d.userToken,d.expiry),d.user&&(e.Appacitive.localStorage.set("Appacitive-User",d.user),e.Appacitive.Users.setCurrentUser(d.user));else if(e.Appacitive.runtime.isBrowser&&(d=e.Appacitive.Cookie.readCookie("Appacitive-UserToken"))){var c=e.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");c||(c=60);var b=e.Appacitive.localStorage.get("Appacitive-User");
e.Appacitive.Users.setCurrentUser(b,d,c)}}})(global);(function(e){e.Appacitive&&e.Appacitive.http&&e.Appacitive.http.addProcessor({pre:function(d){d.headers.push({key:"appacitive-environment",value:e.Appacitive.session.environment})}})})(global);
(function(e){e.Appacitive.queries={};var d=function(a){a=a||{};this.pageNumber=a.pageNumber||1;this.pageSize=a.pageSize||200};d.prototype.toString=function(){return"psize="+this.pageSize+"&pnum="+this.pageNumber};var c=function(a){a=a||{};this.orderBy=a.orderBy||"__UtcLastUpdatedDate";this.isAscending="undefined"==typeof a.isAscending?!1:a.isAscending};c.prototype.toString=function(){return"orderBy="+this.orderBy+"&isAsc="+this.isAscending};var b=function(a){var b=a||{},e="",h="",j="",l=a.queryType,
n=new d(a),q=new c(a),k=a.schema||a.relation,m=a.schema?"article":"connection";this.__defineGetter__("type",function(){return m});this.__defineGetter__("entityType",function(){return k});this.__defineGetter__("queryType",function(){return l});this.__defineGetter__("pageQuery",function(){return n});this.__defineGetter__("sortQuery",function(){return q});this.__defineGetter__("filter",function(){return e});this.__defineSetter__("filter",function(a){e=a});this.__defineGetter__("freeText",function(){return h});
this.__defineSetter__("freeText",function(a){"string"==typeof a?h=a:"object"==typeof a&&a.length&&(h=a.join(","))});this.__defineGetter__("fields",function(){return j});this.__defineSetter__("fields",function(a){"string"==typeof a?j=a:"object"==typeof a&&a.length&&(j=a.join(","))});this.filter=b.filter||"";this.freeText=b.freeText||"";this.fields=b.fields||"";this.setFilter=function(a){this.filter=a};this.setFreeText=function(a){this.freeText=a};this.setFields=function(a){this.fields=a};this.extendOptions=
function(a){for(var e in a)b[e]=a[e];n=new d(b);q=new c(b)};this.getQueryString=function(){var a=this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(a+="&query="+this.filter);this.freeText&&0<this.freeText.trim().length&&(a+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(a+="&fields="+this.fields);return a}};e.Appacitive.queries.BasicFilterQuery=function(a){a=a||{};if(!a.schema&&!a.relation)throw Error("Specify either schema or relation name for basic filter query");
a.queryType="BasicFilterQuery";a=new b(a);a.toRequest=function(){var a=new e.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};a.toUrl=function(){return e.Appacitive.config.apiBaseUrl+this.type+".svc/"+this.entityType+"/find/all?"+this.getQueryString()};a.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};return a};e.Appacitive.queries.GraphQuery=function(a){a=a||{};if(!a.graphQuery)throw Error("graphQuery object is mandatory");
this.toRequest=function(){var b=new e.Appacitive.HttpRequest;b.url=e.Appacitive.config.apiBaseUrl;b.url+=e.Appacitive.storage.urlFactory.article.getProjectionQueryUrl();b.method="post";b.data=a.graphQuery;return b}};e.Appacitive.queries.ConnectedArticlesQuery=function(a){a=a||{};if(!a.relation)throw Error("Specify relation for connected articles query");if(!a.articleId)throw Error("Specify articleId for connected articles query");a.queryType="ConnectedArticlesQuery";var c=new b(a);c.toRequest=function(){var a=
new e.Appacitive.HttpRequest;a.url=this.toUrl();return a};c.toUrl=function(){return e.Appacitive.config.apiBaseUrl+"connection/"+a.relation+"/"+a.articleId+"/find?"+c.getQueryString()};c.getOptions=function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"function"!=typeof this[b]&&(a[b]=this[b]);return a};return c}})(global);
(function(e){e.Appacitive.BaseObject=function(d,c){var b={},a=d=d||{};if(c)for(var f in a)b[f]=a[f];!b.__id&&d.__id&&(b.__id=d.__id);this.fetch=function(c,f){c=c||function(){};f=f||function(){};if(a.__id){var d=this,g=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory[this.type].getGetUrl(a.__schematype||a.__relationtype,a.__id),h=new e.Appacitive.HttpRequest;h.url=g;h.method="get";h.onSuccess=function(e){if(e&&(e.article||e.connection||e.user||e.device)){b=e.article||e.connection||e.user||
e.device;e=e.article||e.connection||e.user||e.device;a.__id=e.__id;for(var g in e)"undefined"==typeof a[g]&&(a[g]=e[g]);d.___collection&&"article"==d.___collection.collectionType&&d.___collection.addToCollection(d);c()}else f(e.status)};e.Appacitive.http.send(h)}else f()};this.del=function(b,c,f){b=b||function(){};c=c||function(){};f=f||{};if(!a.__id&&this.___collection)this.___collection.removeByCId(this.__cid),b();else{var d=this,g=e.Appacitive.config.apiBaseUrl,g=g+e.Appacitive.storage.urlFactory[this.type].getDeleteUrl(a.__schematype||
a.__relationtype,a.__id);if(a&&a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))g=e.Appacitive.config.apiBaseUrl,g+=e.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getDeleteUrl(a.__id);f.deleteConnections&&!0===f.deleteConnections&&(g=-1==g.indexOf("?")?g+"?deleteconnections=true":g+"&deleteconnections=true");f=new e.Appacitive.HttpRequest;f.url=g;f.method="delete";f.onSuccess=function(f){"200"==f.code?(d.___collection&&d.___collection.removeById(a.__id),
b()):c(f)};f.onError=function(a){c(a)};e.Appacitive.http.send(f)}};this.getObject=function(){return a};this.toJSON=function(){return a};this.attributes=function(){if(0===arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes;if(1==arguments.length)return a.__attributes||(a.__attributes={}),a.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1])throw Error("only string values can be stored in attributes.");a.__attributes||(a.__attributes={});a.__attributes[arguments[0]]=
arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");};this.aggregates=function(){var b={},c;for(c in a){if(!a.hasOwnProperty(c))return;"$"==c[0]&&(b[c]=a[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};this.get=function(b){if(b)return a[b]};this.set=function(b,c){b&&(a[b]=c);return c};this.save=function(b,
c){a.__id?g.apply(this,arguments):h.apply(this,arguments)};this.copy=function(b){for(var c in b)a[c]=b[c]};var g=function(c,f){c=c||function(){};f=f||function(){};var d=!1,g=JSON.parse(JSON.stringify(b)),h;for(h in a)"undefined"==typeof a[h]||null===a[h]?(g[h]=null,d=!0):a[h]!=b[h]?(g[h]=a[h],d=!0):a[h]==b[h]&&delete g[h],g.__revision&&delete g.__revision,g.__endpointa&&delete g.__endpointa,g.__endpointb&&delete g.__endpointb;var m=this;if(d){d=new e.Appacitive.HttpRequest;h=e.Appacitive.config.apiBaseUrl+
e.Appacitive.storage.urlFactory[this.type].getUpdateUrl(a.__schematype||a.__relationtype,b.__id?b.__id:a.__id);if(a&&a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))h=e.Appacitive.config.apiBaseUrl,h+=e.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getUpdateUrl(b.__id);d.url=h;d.method="post";d.data=g;d.onSuccess=function(a){a&&(a.article||a.connection||a.user||a.device)?(b=a.article||a.connection||a.user||a.device,"function"==typeof c&&
c(m)):"function"==typeof f&&f(a.status)};d.onError=function(a){f(a)};e.Appacitive.http.send(d)}else c()},h=function(c,f){c=c||function(){};f=f||function(){};var d=this,g=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory[this.type].getCreateUrl(a.__schematype||a.__relationtype);if(a.__schematype&&("user"==a.__schematype.toLowerCase()||"device"==a.__schematype.toLowerCase()))g=e.Appacitive.config.apiBaseUrl,g+=e.Appacitive.storage.urlFactory[a.__schematype.toLowerCase()].getCreateUrl();
var h=new e.Appacitive.HttpRequest;h.url=g;h.method="put";a.__revision&&delete a.__revision;h.data=a;h.onSuccess=function(e){var g=null;if(e&&(e.article||e.connection||e.user||e.device))g=e.article||e.connection||e.user||e.device;if(e&&g){b=g;a.__id=g.__id;for(var h in g)if("undefined"==typeof a[h])a[h]=g[h];else if("object"==typeof g[h])for(var k in g[h])a[h][k]=g[h][k];d.connectionCollections&&0<d.connectionCollections.length&&d.connectionCollections.forEach(function(b){b.getQuery().extendOptions({articleId:a.__id})});
"connection"==d.type&&d.parseConnection();"function"==typeof c&&c(d)}else"function"==typeof f&&f(e.status)};h.onError=function(a){f(a)};e.Appacitive.http.send(h)}};e.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(e){var d=function(){return Math.floor(65536*Math.random()).toString(16)};e.Appacitive.GUID=function(){var c=d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d(),b="",a,f,e,h,j,l,n=0,c=c.replace(/\r\n/g,"\n");f="";for(e=0;e<c.length;e++)h=c.charCodeAt(e),128>h?f+=String.fromCharCode(h):(127<h&&2048>h?f+=String.fromCharCode(h>>6|192):(f+=String.fromCharCode(h>>12|224),f+=String.fromCharCode(h>>6&63|128)),f+=String.fromCharCode(h&63|128));for(c=f;n<c.length;)a=c.charCodeAt(n++),f=c.charCodeAt(n++),
e=c.charCodeAt(n++),h=a>>2,a=(a&3)<<4|f>>4,j=(f&15)<<2|e>>6,l=e&63,isNaN(f)?j=l=64:isNaN(e)&&(l=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);return b.toString()}})(global);
(function(e){e.Appacitive.ArticleCollection=function(d){var c=null,b=null,a=[],f=d;this.collectionType="article";if(!d||!d.schema)throw Error("Must provide schema while initializing ArticleCollection.");var c=d.schema,g=this,h=function(a){a.type="article";a.schema?c=a.schema:a.schema=c;b=new e.Appacitive.queries.BasicFilterQuery(a);f=a;g.extendOptions=b.extendOptions};this.setFilter=function(a){f.filter=a;f.type="article";b?b.filter=a:(b=new e.Appacitive.queries.BasicFilterQuery(f),g.extendOptions=
b.extendOptions)};this.setFreeText=function(a){!a&&0==a.trim().length&&(f.freeText="");f.freeText=a;f.type="article";b?b.freeText=a:(b=new e.Appacitive.queries.BasicFilterQuery(f),g.extendOptions=b.extendOptions)};this.setFields=function(a){a||(f.fields="");f.fields=a;f.type="article";b?b.fields=a:(b=new e.Appacitive.queries.BasicFilterQuery(f),g.extendOptions=b.extendOptions)};this.reset=function(){c=f=null;a.length=0;b=null};this.__defineGetter__("query",function(){return b});this.getQuery=function(){return b};
this.__defineSetter__("query",function(c){if(!c||!c.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");a.length=0;b=c});this.setQuery=function(c){if(!c||!c.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");a.length=0;b=c};this.setOptions=h;h(d);this.get=function(b){if(b!=parseInt(b,10))return null;b=parseInt(b,10);return"number"!=typeof b||b>=a.length?null:a.slice(b,b+1)[0]};this.addToCollection=function(b){if(!b||b.get("__schematype")!=c)throw Error("Null article passed or schema type mismatch");
var f=null;a.forEach(function(a,c){a.get("__id")==b.get("__id")&&(f=c)});0!=f?a.splice(f,1):a.push(b)};this.getArticleById=function(b,c,f){c=c||function(){};f=f||function(){};var d=a.filter(function(a){return a.get("__id")==b});1==d.length?c(Array.prototype.slice.call(d)[0]):f()};this.getAll=function(){return Array.prototype.slice.call(a)};this.getAllArticles=function(){return Array.prototype.slice.call(a).map(function(a){return a.getArticle()})};this.removeById=function(b){if(!b)return!1;var c=null;
a.forEach(function(a,f){a.getArticle().__id&&a.getArticle().__id==b&&(c=f)});return null!==c?(a.splice(c,1),!0):!1};this.removeByCId=function(b){if(!b)return!1;var c=null;a.forEach(function(a,f){a.__cid&&a.__cid==b&&(c=f)});return null!==c?(a.splice(c,1),!0):!1};this.fetch=function(c,f){c=c||function(){};f=f||function(){};a.length=0;var d=b.toRequest();d.onSuccess=function(b){var d=c,h=b.articles;if(h){if(!h.length||0===h.length)h=[];h.forEach(function(b){b=new e.Appacitive.Article(b,!0);b.___collection=
g;a.push(b)});d(b.paginginfo||{})}else f(b.status)};e.Appacitive.http.send(d)};this.fetchByPageNumber=function(a,c,f){b.getOptions().pageQuery.pageNumber=f;this.fetch(a,c)};this.fetchNextPage=function(a,c){b.getOptions().pageQuery.pageNumber+=1;this.fetch(a,c)};this.fetchPreviousPage=function(a,c){var f=b.getOptions().pageQuery;f.pageNumber-=1;0===f.pageNumber&&(f.pageNumber=1);this.fetch(a,c)};this.createNewArticle=function(b){b=b||{};b.__schematype=c;b=new e.Appacitive.Article(b);b.___collection=
g;b.__cid=parseInt(1E6*Math.random(),10);a.push(b);return b};this.map=function(){return a.map.apply(this,arguments)};this.forEach=function(){return a.forEach.apply(this,arguments)};this.filter=function(){return a.filter.apply(this,arguments)}};e.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};e.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};e.Appacitive.ArticleCollection.prototype.__defineGetter__("articles",
function(){return this.getAll()})})(global);
(function(e){e.Appacitive.ConnectionCollection=function(d){var c=null,b=null,a=[],f=[],g=d;this.collectionType="connection";if(!d||!d.relation)throw Error("Must provide relation while initializing ConnectionCollection.");var c=d.relation,h=function(a){a.type="connection";a.relation?c=a.relation:a.relation=c;b=new e.Appacitive.queries.BasicFilterQuery(a);g=a};this.setFilter=function(a){g.filter=a;g.type="connection";b?b.filter=a:(b=new e.Appacitive.queries.BasicFilterQuery(g),j.extendOptions=b.extendOptions)};
this.setFreeText=function(a){!a&&0==a.trim().length&&(g.freeText="");g.freeText=a;g.type="connection";b?b.freeText=a:(b=new e.Appacitive.queries.BasicFilterQuery(g),j.extendOptions=b.extendOptions)};this.setFields=function(a){a||(g.fields="");g.fields=a;g.type="connection";b?b.fields=a:(b=new e.Appacitive.queries.BasicFilterQuery(g),j.extendOptions=b.extendOptions)};this.__defineGetter__("query",function(){return b});this.getQuery=function(){return b};this.__defineSetter__("query",function(c){if(!c||
!c.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");f.length=0;a.length=0;b=c});this.setQuery=function(c){if(!c||!c.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");f.length=0;a.length=0;b=c};this.reset=function(){c=g=null;f.length=0;a.length=0;b=null};this.setOptions=h;h(d);this.get=function(b){if(b!=parseInt(b,10))return null;b=parseInt(b,10);return"number"!=typeof b||b>=a.length?null:a.slice(b,b+1)[0]};this.addToCollection=function(b){if(!b||
b.get("__relationtype")!=c)throw Error("Null connection passed or relation type mismatch");var f=null;a.forEach(function(a,c){a.get("__id")==b.get("__id")&&(f=c)});null!==f?a.splice(f,1):a.push(b)};this.getConnection=function(b,c,f){c=c||function(){};f=f||function(){};var d=a.filter(function(a){return a.get("__id")==b});1==d.length?c(Array.prototype.slice.call(d)[0]):f()};this.getAll=function(){return Array.prototype.slice.call(a)};this.getAllConnections=function(){return Array.prototype.slice.call(a).map(function(a){return a.getConnection()})};
this.removeById=function(b){if(!b)return!1;var c=null;a.forEach(function(a,f){a.getConnection().__id&&a.getConnection().__id==b&&(c=f)});return null!==c?(a.splice(c,1),!0):!1};this.removeByCId=function(b){if(!b)return!1;var c=null;a.forEach(function(a,f){a.__cid&&a.__cid==b&&(c=f)});return null!==c?(a.splice(c,1),!0):!1};var j=this;this.getConnectedArticle=function(a){if(!f||0===f.length)return null;var b=f.filter(function(b){return b.get("__id")==a});return 0<b.length?b[0]:null};this.fetch=function(c,
d){c=c||function(){};d=d||function(){};a.length=0;var g=b.toRequest();g.onSuccess=function(b){a:{var g=c;b=b||{};var h=b.connections;if(!h)if(b.status&&b.status.code&&"200"==b.status.code)h=[];else{d(b.status);break a}if(!h.length||0===h.length)h=[];h.forEach(function(b){b=new e.Appacitive.Connection(b,!0);b.___collection=j;a.push(b);if(b.endpointA.article||b.endpointB.article)b=b.endpointA.article||b.endpointB.article,b.___collection=j,f.push(b)});g(b.paginginfo||{})}};e.Appacitive.http.send(g)};
this.fetchByPageNumber=function(a,c,f){b.getOptions().pageQuery.pageNumber=f;this.fetch(a,c)};this.fetchNextPage=function(a,c){b.getOptions().pageQuery.pageNumber+=1;this.fetch(a,c)};this.fetchPreviousPage=function(a,c){var f=b.getOptions().pageQuery;f.pageNumber-=1;0===f.pageNumber&&(f.pageNumber=1);this.fetch(a,c)};this.createNewConnection=function(b){b=b||{};b.__relationtype=c;b=new e.Appacitive.Connection(b);b.___collection=j;b.__cid=parseInt(1E6*Math.random(),10);a.push(b);return b};this.map=
function(){return a.map.apply(this,arguments)};this.forEach=function(b,c){return a.forEach(b,c||this)};this.filter=function(){return a.filter.apply(this,arguments)}}})(global);
(function(e){var d=function(c,b){c=c||function(){};b=b||function(){};var a=new e.Appacitive.HttpRequest;a.method="get";a.url=e.Appacitive.config.apiBaseUrl+e.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var d=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(a){return"facebook"==a.authtype.toLowerCase()}),1==a.length&&(d=a[0].username));null!==d?FB.api("/"+d,function(a){a?c(a):b()}):b()};a.onError=function(){b()};
e.Appacitive.http.send(a)};e.Appacitive.Article=function(c,b){if(!c.__schematype&&!c.schema)throw new error("Cannot set article without __schematype");c.schema&&(c.__schematype=c.schema,delete c.schema);var a=new e.Appacitive.BaseObject(c,b);a.type="article";a.connectionCollections=[];a.getArticle=a.getObject;a.get("__schematype")&&"user"==a.get("__schematype").toLowerCase()&&(a.getFacebookProfile=d);return a};e.Appacitive.BaseObject.prototype.getConnectedArticles=function(c){if("article"!=this.type)return null;
c=c||{};c.articleId=this.get("__id");var b=new e.Appacitive.ConnectionCollection({relation:c.relation});b.connectedArticle=this;this.connectionCollections.push(b);c=new e.Appacitive.queries.ConnectedArticlesQuery(c);b.query=c;return b};e.Appacitive.Article.multiDelete=function(c,b,a,f){if(!c)throw Error("Specify schemaName");if("user"==c.toLowerCase()||"device"==c.toLowerCase())throw Error("Cannot delete schema and devices using multidelete");if(0<b.length){var d=new e.Appacitive.HttpRequest;d.url=
e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(c);d.method="post";d.data={idlist:b};d.onSuccess=function(b){b&&"200"==b.code?a():(b=b||{},f(b||{message:"Server error",code:400}))};d.onError=function(a){a=a||{};f(a||{message:"Server error",code:400})};e.Appacitive.http.send(d)}else a()}})(global);
(function(e){var d=function(b,a,c){var d={label:b.label};b.articleid&&(d.articleid=b.articleid);if(b.article)"function"==typeof b.article.getArticle?b.article.get("__id")?d.articleid=b.article.get("__id"):d.article=b.article.getArticle():"object"==typeof b.article&&b.article.__schematype&&(b.article.__id?d.articleid=b.article.__id:d.article=b.article,b.article=new Appacitive.Article(b.article));else if(!d.articleid&&!d.article)throw Error("Incorrectly configured endpoints provided to setupConnection");
c["endpoint"+a]=b;return d},c=function(b,a,c){c.get("__endpoint"+a.toLowerCase()).article&&"object"==typeof c.get("__endpoint"+a.toLowerCase()).article?(c["endpoint"+a]?c["endpoint"+a]&&c["endpoint"+a].article&&c["endpoint"+a].article.getArticle?c["endpoint"+a].article.copy(c.get("__endpointb").article):c["endpoint"+a].article=new e.Appacitive.Article(c.get("__endpointb").article):(c["endpoint"+a]={},c["endpoint"+a].article=new e.Appacitive.Article(c.get("__endpoint"+a.toLowerCase()).article)),c["endpoint"+
a].articleid=c.get("__endpoint"+a.toLowerCase()).articleid,c["endpoint"+a].label=c.get("__endpoint"+a.toLowerCase()).label,c["endpoint"+a].type=c.get("__endpoint"+a.toLowerCase()).type,c["endpoint"+a].article.___collection=c.___collection,delete c.get("__endpoint"+a.toLowerCase()).article):c["endpoint"+a]=c.get("__endpoint"+a.toLowerCase())};e.Appacitive.Connection=function(b,a){if(!b.__relationtype&&!b.relation)throw new error("Cannot set connection without relation");b.relation&&(b.__relationtype=
b.relation,delete b.relation);b.endpoints&&2==b.endpoints.length&&(b.__endpointa=b.endpoints[0],b.__endpointb=b.endpoints[1],delete b.endpoints);var f=new e.Appacitive.BaseObject(b);f.type="connection";f.getConnection=f.getObject;f.setupConnection=function(a,b){if(!a||!a.articleid&&!a.article||!a.label||!b||!b.articleid&&!b.article||!b.label)throw Error("Incorrect endpoints configuration passed.");f.set("__endpointa",d(a,"A",f));f.set("__endpointb",d(b,"B",f))};f.parseConnection=function(){var a=
"A",d="B";b.__endpointa.label==this.get("__endpointb").label&&b.__endpointa.articleid==this.get("__endpointb").articleid&&(a="B",d="A");c(this.get("__endpointa"),a,f);c(this.get("__endpointb"),d,f);f.__defineGetter__("endpoints",function(){var a=[];a.push(this.endpointA);a.push(this.endpointB);return a});return f};a?(f.__defineGetter__("connectedArticle",function(){if(!f.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");var a=
f.___collection.connectedArticle.get("__id");if(!a)return null;var b=f.getConnection().__endpointa.articleid;f.getConnection().__endpointa.articleid==a&&(b=f.getConnection().__endpointb.articleid);return f.___collection.getConnectedArticle(b)}),f.parseConnection()):b.__endpointa&&b.__endpointb&&f.setupConnection(f.get("__endpointa"),f.get("__endpointb"));return f};e.Appacitive.Connection.multiDelete=function(b,a,c,d){if(!b)throw Error("Specify relationName");if(0<a.length){var h=new e.Appacitive.HttpRequest;
h.url=e.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(b);h.method="post";h.data={idlist:a};h.onSuccess=function(a){a&&"200"==a.code?c():(a=a||{},d(a||{message:"Server error",code:400}))};h.onError=function(a){a=a||{};d(a||{message:"Server error",code:400})};e.Appacitive.http.send(h)}else c()}})(global);
(function(e){e.Appacitive.Users=new function(){var d=null;this.__defineGetter__("currentUser",function(){return d});this.setCurrentUser=function(c,b,a){e.Appacitive.localStorage.set("Appacitive-User",c);a||(a=60);d=c;b&&Appacitive.session.setUserAuthHeader(b,a)};e.Appacitive.User=function(c){c=new e.Appacitive.BaseObject(c);c.type="user";c.connectionCollections=[];c.get("__schematype")&&"user"==c.get("__schematype").toLowerCase()&&(c.getFacebookProfile=_getFacebookProfile);return c};this.deleteUser=
function(c,b,a){b=b||function(){};