try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(d,g){Object.defineProperty(this,d,{get:g,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(d,g){Object.defineProperty(this,d,{set:g,enumerable:!0,configurable:!0})}}))}catch(defPropException){}var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var d=function(b){if(!b||!b.send||"function"!=typeof b.send)throw Error("No applicable httpTransport class found");b.onResponse=this.onResponse;var a=[],c={},e=0,f={},d=0;this.addProcessor=function(b){if(b){b.pre=b.pre||function(){};b.post=b.post||function(){};var a=b.pre;e+=1;c[e]=a;b=b.post;d+=1;f[d]=b}};this.enqueueRequest=
function(b){a.push(b)};this.notify=function(){if(0!==a.length){var e=[],d;for(d in f)f.hasOwnProperty(d)&&e.push(f[d]);for(;0<a.length;){var k=a.shift(),g=[];for(d in c)c.hasOwnProperty(d)&&g.push(c[d](k));b.send(k,e,g)}}};this.onResponse=function(b){console.dir(b)}},g=function(){var b=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=b;this.onResponse=function(){b()};this.onError=function(){b()}},f=null,f=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest,
c=function(b,a){if("undefined"!==typeof XDomainRequest)throw Error("Appacitive doesn't support versions of IE6, IE7, IE8, IE9 due to crossdomain calls");if(!b.url)throw Error("Please specify request url");b.method||(b.method="GET");b.headers||(b.headers=[]);var c={};if(a)c=b.data;else try{b.data&&(c=b.data),c=JSON.stringify(c)}catch(e){}if(!b.onSuccess||"function"!=typeof b.onSuccess)b.onSuccess=function(){};if(!b.onError||"function"!=typeof b.onError)b.onError=function(){};var d=new f;d.onreadystatechange=
function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var a=this.responseText;try{var c=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==c.toLowerCase()||"application/javascript"==c.toLowerCase())c=a,global.Appacitive.runtime.isBrowser||"{"!=c[0]&&(c=c.substr(1,c.length-1)),a=JSON.parse(c)}catch(e){}b.onSuccess(a,this)}else b.onError({code:this.status,message:this.statusText},this)};d.open(b.method,b.url,!0);for(var g=
0;g<b.headers.length;g+=1)d.setRequestHeader(b.headers[g].key,b.headers[g].value);global.Appacitive.runtime.isBrowser||d.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");d.send(c);return d},a=function(){var b=new g;b.isOnline=function(){return!0};var a=function(a,e,f,d){d||a.headers.push({key:"content-type",value:"application/json"});new c({method:a.method,url:a.url,headers:a.headers,data:a.data,onSuccess:function(c){try{c=JSON.parse(c)}catch(d){}var h=c;if(e.length!=f.length)throw Error("Callback length and state length mismatch!");
for(var g=0;g<e.length;g+=1)e[g].apply({},[h,f[g]]);b.onResponse(c,a)},onError:function(c){b.onError(a,c)}})};b.send=function(b,c,e){"function"==typeof b.beforeSend&&b.beforeSend(b);a(b,c,e)};b.upload=function(b,c,e){"function"==typeof b.beforeSend&&b.beforeSend(b);a(b,c,e,!0)};return b};global.Appacitive.http=new function(){var b=new a,c=new d(b),e=!1;this.pause=function(){e=!0};this.unpause=function(){e=!1};this.addProcessor=function(b){var a=Error('Must provide a processor object with either a "pre" function or a "post" function.');
if(!b)throw a;if(!b.pre&&!b.post)throw a;c.addProcessor(b)};this.send=function(a){c.enqueueRequest(a);b.isOnline()&&!1==e&&c.notify()};this.flush=function(a){a?c.notify():b.isOnline()&&c.notify()};this.onError=function(b,a){if(b.onError)if(b.context)b.onError.apply(b.context,[a]);else b.onError(a)};b.onError=this.onError;this.onResponse=function(b,a){if(a.onSuccess)if(a.context)a.onSuccess.apply(a.context,[b]);else a.onSuccess(b)};b.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(b){b=
b||{};this.url=b.url||"";this.data=b.data||{};this.headers=b.headers||[];this.method=b.method||"GET";this.onSuccess=b.onSuccess||function(){};this.onError=b.onError||function(){};this.send=function(b){return new c(this,b)}};var e=global;e.Appacitive&&e.Appacitive.http&&(e.Appacitive.http.addProcessor({pre:function(b){return b},post:function(b,a){try{e.Appacitive.Session.isSessionValid(b)?b&&(b.status&&b.status.code&&"8036"==b.status.code||b.code&&"8036"==b.code)?e.Appacitive.Users.logout(function(){},
!0):e.Appacitive.Session.incrementExpiry():(null!=e.Appacitive.Session.get()&&e.Appacitive.Session.resetSession(),e.Appacitive.http.send(a))}catch(c){}}}),e.Appacitive.http.addProcessor({pre:function(){return(new Date).getTime()},post:function(b,a){var c=(new Date).getTime()-a;b._timeTakenInMilliseconds=c}}))})();
(function(d){String.format=function(d,f){if(1>=arguments.length)return d;for(var c=arguments.length-2,a=0;a<=c;a++)d=d.replace(RegExp("\\{"+a+"\\}","gi"),arguments[a+1]);return d};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(d){var f=RegExp("^"+d),c=this;f.test(c)&&(c=c.slice(1,c.length));f=RegExp(d+"$");f.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(d){"undefined"==typeof d&&(d="");for(var f=
"",c=0;c<d.length;c+=1)-1==" .,;#".indexOf(d[c])&&(f+=d[c]);return f=f.toLowerCase()};String.contains=function(d,f){return-1!=d.indexOf(f)};String.startsWith=function(d,f){return 0==d.indexOf(f)};Array.distinct=function(d){var f=[],c=d.length,a,e,b;for(e=0;e<c;e++){a=void 0;for(b=0;b<f.length;b++)if(d[e].toLowerCase()===f[b].toLowerCase()){a=!0;break}a||f.push(d[e])}return f};d.dateFromWcf=function(d,f){var c=/Date\(([^)]+)\)/.exec(d);if(2!=c.length){if(!f)return s;throw Error(s+" is not .net json date.");
}return new Date(parseFloat(c[1]))};d.Appacitive.storage=d.Appacitive.storage||{};d.Appacitive.storage.urlFactory=new function(){d.Appacitive.bag=d.Appacitive.bag||{};var g=function(d){if("object"==typeof d&&0<d.length&&("string"==typeof d[0]||"number"==typeof d[0]))d=d.join(",");d||(d="");return d};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(d){return String.format("{0}/create?fields={1}",
this.userServiceUrl,g(d))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,d,g(c))},getUpdateUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.userServiceUrl,d,g(c))},getDeleteUrl:function(d){return String.format("{0}/{1}",this.userServiceUrl,d)},getGetAllLinkedAccountsUrl:function(d){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,
d)},getValidateTokenUrl:function(d){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,d)},getInvalidateTokenUrl:function(d){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,d)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(d){return String.format("{0}/{1}/changepassword",this.userServiceUrl,d)},getLinkAccountUrl:function(d){return String.format("{0}/{1}/link",
this.userServiceUrl,d)},getDelinkAccountUrl:function(d,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,d,c)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(d){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,g(d))},getGetUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,d,g(c))},getUpdateUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,d,g(c))},getDeleteUrl:function(d){return String.format("{0}/{1}",
this.deviceServiceUrl,d)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(d,c,a){var e="",e=String.format("{0}/search/{1}/all",this.articleServiceUrl,d),e=a?e+"?psize="+a:e+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(d=0;d<c.length;d+=1)0!=c[d].trim().length&&(e=e+"&"+c[d]);return e},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(d,c){return String.format("{0}/search/{1}/all?properties={2}",
this.articleServiceUrl,d,c)},getMultiGetUrl:function(d,c,a){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.articleServiceUrl,d,c,g(a))},getCreateUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,d,g(c))},getGetUrl:function(d,c,a){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,d,c,g(a))},getUpdateUrl:function(d,c,a){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,d,c,g(a))},getDeleteUrl:function(d,c){return String.format("{0}/{1}/{2}",
this.articleServiceUrl,d,c)},getMultiDeleteUrl:function(d){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,d)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(d,c,a){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,d,c,g(a))},getMultiGetUrl:function(d,c,a){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.connectionServiceUrl,d,c,g(a))},getCreateUrl:function(d,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,
d,g(c))},getUpdateUrl:function(d,c,a){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,d,c,g(a))},getDeleteUrl:function(d,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,d,c)},getMultiDeleteUrl:function(d){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,d)},getSearchByArticleUrl:function(d,c,a,e){var b="",b=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,d,a,c);if("undefined"!==typeof e&&0<e.length)for(d=
0;d<e.length;d+=1)b=b+"&"+e[d];return b},getConnectedArticles:function(d,c,a){var e="",e=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,d,c);if(a&&a.length&&0<a.length)for(d=0;d<a.length;d+=1)e=0==d?e+("?"+a[d]):e+("&"+a[d]);return e},getInterconnectsUrl:function(){return String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(d,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,d,c)}};this.cannedList={cannedListServiceUrl:"list",
getGetListItemsUrl:function(d){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,d)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(d){return String.format("{0}/notification/{1}",this.pushServiceUrl,d)},getGetAllNotificationsUrl:function(d){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,d.psize,d.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(d){return String.format("{0}/uploadurl?contenttype={1}&expires=20",
this.fileServiceUrl,escape(d))},getUpdateUrl:function(d,c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,d,escape(c))},getDownloadUrl:function(d,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,d,c)},getDeleteUrl:function(d){return String.format("{0}/delete/{1}",this.fileServiceUrl,d)}};this.query={params:function(d){var c=[];return""==location.search||-1==location.search.indexOf("?")?c:d?(d=d.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(a,
e){var b=e.split("="),h=b[1];2<b.length&&b.forEach(function(a){0==a||1==a||(h=h+"="+b[a])});b[0].toLowerCase()==d&&(c=[b[0],h])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(d){d.Appacitive.eventManager=new function(){var d={};this.subscribe=function(f,c){if("string"!=typeof f||"function"!=typeof c)throw Error("Incorrect subscription call");"undefined"==typeof d[f]&&(d[f]=[]);var a;a=function(){return Math.floor(65536*Math.random()).toString(16)};a=a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();d[f].push({callback:c,id:a});return a};this.unsubscribe=function(f){if(!f)return!1;var c=-1,a=null,e;for(e in d)for(var b=0;b<d[e].length;b+=1)if(d[e][b].id==f){c=b;
a=e;break}return-1!=c?(d[a].splice(c,1),!0):!1};this.fire=function(f,c,a){if("string"!=typeof f)throw Error("Incorrect fire call");if("undefined"==typeof a||null===a)a={};a.eventName=f;if("undefined"!=typeof d.all)for(var e=0;e<d.all.length;e+=1)d.all[e].callback(c,a);e=function(b,a,d){setTimeout(function(){b(a,d)},0)};if("undefined"!=typeof d[f])for(var b=0;b<d[f].length;b+=1)e(d[f][b].callback,c,a)};this.clearSubscriptions=function(f){if("string"!=typeof f)throw Error("Event Name must be string in EventManager.clearSubscriptions");
d[f]&&(d[f].length=0);return this};this.clearAndSubscribe=function(d,c){this.clearSubscriptions(d);this.subscribe(d,c)};this.dump=function(){console.dir(d)}}})(global);(function(d){d.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"}})(global);
(function(d){d.Appacitive.Session=new function(){var g=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},f=null,c=null,a=null,e=null,b=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){d.Appacitive.Session.create(c)};this.create=function(b){c=b=b||{};var e=new g;b.apikey?(e.apikey=b.apikey||"",a=e.apikey):e.apikey=a;e.isnonsliding=b.isnonsliding||e.isnonsliding;e.usagecount=b.usagecount||e.usagecount;e.windowtime=b.windowtime||e.windowtime;
b=new d.Appacitive.HttpRequest;b.url=d.Appacitive.config.apiBaseUrl+"application.svc/session";b.method="put";b.data=e;b.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(f=b.session.sessionkey,d.Appacitive.Session.useApiKey=!1,d.Appacitive.eventManager.fire("session.success",{},b),d.Appacitive.Session.onSessionCreated()):d.Appacitive.eventManager.fire("session.error",{},b)};d.Appacitive.http.send(b)};d.Appacitive.http.addProcessor({pre:function(c){d.Appacitive.Session.useApiKey?c.headers.push({key:"appacitive-apikey",
value:a}):c.headers.push({key:"appacitive-session",value:f});!0===b&&(1==c.headers.filter(function(b){return"appacitive-user-auth"==b.key}).length?c.headers.forEach(function(b){"appacitive-user-auth"==b.key&&(b.value=e)}):c.headers.push({key:"appacitive-user-auth",value:e}))}});this.setUserAuthHeader=function(a,c,f){try{a&&(b=!0,e=a,f||(c||(c=60),-1==c&&(c=null),d.Appacitive.runtime.isBrowser&&(d.Appacitive.Cookie.setCookie("Appacitive-UserToken",a,c),d.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",
c?c:-1,c))))}catch(h){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(a,c){a&&("function"!=typeof a&&"boolean"==typeof a)&&(c=a,a=function(){});b=!1;a=a||function(){};d.Appacitive.localStorage.remove("Appacitive-User");d.Appacitive.runtime.isBrowser&&(d.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),d.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(e&&!c)try{var f=new d.Appacitive.HttpRequest;f.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(e);
e=null;f.method="POST";f.data={};f.onSuccess=function(){"function"==typeof a&&a()};d.Appacitive.http.send(f)}catch(h){}else e=null,"function"==typeof a&&a()};this.isSessionValid=function(b){if(!b)return!0;if(b.status){if(b.status.code&&("8027"==b.status.code||"8002"==b.status.code))return!1}else if(b.code&&("8027"==b.code||"8002"==b.code))return!1;return!0};this.resetSession=function(){f=null;this.useApiKey=!0};this.get=function(){return f};this.setSession=function(b){b&&(f=b,this.useApiKey=!1)};
this.setApiKey=function(b){b&&(a=b,this.useApiKey=!0)};var h="sandbox";this.__defineGetter__("environment",function(){return h});this.__defineSetter__("environment",function(b){"sandbox"!=b&&"live"!=b&&(b="sandbox");h=b})};d.Appacitive.initialize=function(g){d.Appacitive.Session.setApiKey(g.apikey||"");d.Appacitive.Session.environment=g.env||"";d.Appacitive.useApiKey=!0;if(g.userToken)-1==g.expiry?g.expiry=null:g.expiry||(g.expiry=3600),d.Appacitive.Session.setUserAuthHeader(g.userToken,g.expiry),
g.user?d.Appacitive.Users.setCurrentUser(g.user):(g=d.Appacitive.localStorage.get("Appacitive-User"))&&d.Appacitive.Users.setCurrentUser(g);else if(d.Appacitive.runtime.isBrowser){var f=d.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(f){var c=d.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");c||(c=60);(g=d.Appacitive.localStorage.get("Appacitive-User"))&&d.Appacitive.Users.setCurrentUser(g,f,c)}}}})(global);
(function(d){d.Appacitive&&d.Appacitive.http&&d.Appacitive.http.addProcessor({pre:function(g){g.headers.push({key:"appacitive-environment",value:d.Appacitive.Session.environment})}})})(global);
(function(d){d.Appacitive.Queries={};var g=function(a){a=a||{};var d=1,b=200;this.__defineGetter__("pageNumber",function(){return d});this.__defineSetter__("pageNumber",function(b){d=b||1});this.__defineGetter__("pageSize",function(){return b});this.__defineSetter__("pageSize",function(a){b=a||200});this.pageNumber=a.pageNumber;this.pageSize=a.pageSize};g.prototype.toString=function(){return"psize="+this.pageSize+"&pnum="+this.pageNumber};var f=function(a){a=a||{};var d="__UtcLastUpdatedDate",b=!1;
this.__defineGetter__("orderBy",function(){return d});this.__defineSetter__("orderBy",function(b){d=b||"__UtcLastUpdatedDate"});this.__defineGetter__("isAscending",function(){return b});this.__defineSetter__("isAscending",function(a){b="undefined"==typeof a?!1:a});this.orderBy=a.orderBy;this.isAscending=a.isAscending};f.prototype.toString=function(){return"orderBy="+this.orderBy+"&isAsc="+this.isAscending};var c=function(a){var c=a||{},b="",h="",j="",k=a.queryType,l=new g(a),m=new f(a),n=a.schema||
a.relation,p=a.schema?"article":"connection";this.__defineGetter__("type",function(){return p});this.__defineGetter__("entityType",function(){return n});this.__defineGetter__("queryType",function(){return k});this.__defineGetter__("pageQuery",function(){return l});this.__defineGetter__("sortQuery",function(){return m});this.__defineGetter__("filter",function(){return b});this.__defineSetter__("filter",function(a){b=a});this.__defineGetter__("freeText",function(){return h});this.__defineSetter__("freeText",
function(b){"string"==typeof b?h=b:"object"==typeof b&&b.length&&(h=b.join(" "))});this.__defineGetter__("fields",function(){return j});this.__defineSetter__("fields",function(b){"string"==typeof b?j=b:"object"==typeof b&&b.length&&(j=b.join(","))});this.filter=c.filter||"";this.freeText=c.freeText||"";this.fields=c.fields||"";this.setFilter=function(b){this.filter=b};this.setFreeText=function(b){this.freeText=b};this.setFields=function(b){this.fields=b};this.extendOptions=function(b){for(var a in b)c[a]=
b[a];l=new g(c);m=new f(c)};this.getQueryString=function(){var b=this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(b+="&query="+this.filter);this.freeText&&0<this.freeText.trim().length&&(b+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(b+="&fields="+this.fields);return b};this.toUrl=function(){return d.Appacitive.config.apiBaseUrl+n+"/find/all?"+this.getQueryString()};this.toRequest=function(){var b=new d.Appacitive.HttpRequest;
b.url=this.toUrl();b.method="get";return b};this.getOptions=function(){var b={},a;for(a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&(b[a]=this[a]);return b};this.fetch=function(b,a){var c=this.toRequest();c.onSuccess=function(c){if(c&&c.status&&"200"==c.status.code){if("function"==typeof b){var e=c[p+"s"],f=[];e||(e=[]);var h="article"==p?"Article":"Connection";e.forEach(function(b){f.push(new d.Appacitive[h](b))});b(f,c.paginginfo)}}else c=c||{},"function"==typeof a&&a(c.status||
{message:"Server error",code:400})};c.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};d.Appacitive.http.send(c);return this}};d.Appacitive.Queries.BasicFilterQuery=function(a){a=a||{};if(!a.schema&&!a.relation||a.schema&&a.relation)throw Error("Specify either schema or relation for basic filter query");a.queryType="BasicFilterQuery";a=new c(a);a.toRequest=function(){var a=new d.Appacitive.HttpRequest;a.url=this.toUrl();a.method="get";return a};a.toUrl=
function(){return d.Appacitive.config.apiBaseUrl+this.type+".svc/"+this.entityType+"/find/all?"+this.getQueryString()};return a};d.Appacitive.Queries.ConnectedArticlesQuery=function(a){a=a||{};if(!a.relation)throw Error("Specify relation for connected articles query");if(!a.articleId)throw Error("Specify articleId for connected articles query");a.schema&&delete a.schema;a.queryType="ConnectedArticlesQuery";var e=new c(a);e.articleId=a.articleId;e.relation=a.relation;e.label="";a.label&&("string"==
typeof a.label&&0<a.label.length)&&(e.label="&label="+a.label);e.toRequest=function(){var b=new d.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};e.toUrl=function(){return d.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.articleId+"/find?"+this.getQueryString()+this.label};return e};d.Appacitive.Queries.GetConnectionsQuery=function(a){a=a||{};if(!a.relation)throw Error("Specify relation for GetConnectionsQuery query");if(!a.articleId)throw Error("Specify articleId for GetConnectionsQuery query");
if(!a.label||0==a.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");a.schema&&delete a.schema;a.queryType="GetConnectionsQuery";var e=new c(a);e.articleId=a.articleId;e.relation=a.relation;e.label=a.label;e.toRequest=function(){var b=new d.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};e.toUrl=function(){return d.Appacitive.config.apiBaseUrl+"connection/"+e.relation+"/find/all?articleid="+this.articleId+"&label="+this.label+e.getQueryString()};return e};
d.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(a,e){a=a||{};if(!a.articleAId||"string"!=typeof a.articleAId||0==a.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");if(!a.articleBId||"string"!=typeof a.articleBId||0==a.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");a.schema&&delete a.schema;a.queryType=e||"GetConnectionsBetweenArticlesQuery";var b=new c(a);b.articleAId=a.articleAId;
b.articleBId=a.articleBId;b.label="GetConnectionsBetweenArticlesForRelationQuery"==b.queryType&&a.label&&"string"==typeof a.label&&0<a.label.length?"&label="+a.label:"";b.relation=a.relation&&"string"==typeof a.relation&&0<a.relation.length?a.relation+"/":"";b.toRequest=function(){var b=new d.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};b.toUrl=function(){return d.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+"?"+this.getQueryString()+
this.label};return b};d.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(a){a=a||{};if(!a.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");a=new d.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a,"GetConnectionsBetweenArticlesForRelationQuery");a.fetch=function(a,b){this.toUrl();var c=this.toRequest();c.onSuccess=function(c){c&&c.status&&"200"==c.status.code?"function"==typeof a&&a(new d.Appacitive.Connection(c.connection)):
(c=c||{},"function"==typeof b&&b(c.status||{message:"Server error",code:400}))};c.onError=function(a){a=a||{};"function"==typeof b&&b(a.status||{message:"Server error",code:400})};d.Appacitive.http.send(c);return this};return a};d.Appacitive.Queries.InterconnectsQuery=function(a){a=a||{};if(!a.articleAId||"string"!=typeof a.articleAId||0==a.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!a.articleBIds||"object"!=typeof a.articleBIds||!(0<a.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");
a.schema&&delete a.schema;a.queryType="InterconnectsQuery";var e=new c(a);e.articleAId=a.articleAId;e.articleBIds=a.articleBIds;e.toRequest=function(){var b=new d.Appacitive.HttpRequest;b.url=this.toUrl();b.method="post";b.data={article1id:this.articleAId,article2ids:this.articleBIds};return b};e.toUrl=function(){return d.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return e};d.Appacitive.Queries.GraphQuery=function(a){a=a||{};if(!a.graphQuery)throw Error("graphQuery object is mandatory");
this.toRequest=function(){var c=new d.Appacitive.HttpRequest;c.url=d.Appacitive.config.apiBaseUrl;c.url+=d.Appacitive.storage.urlFactory.article.getProjectionQueryUrl();c.method="post";c.data=a.graphQuery;return c}}})(global);
(function(d){d.Appacitive.BaseObject=function(g,f){var c={},a={},e=function(b,a){for(var c in b)if("string"==typeof b[c])a[c]=b[c];else if("object"==typeof b[c]){a[c]=0<=b[c].length?[]:{};for(var d in b[c])a[c][d]=b[c][d]}else a[c]=b[c]},b={};e(g,b);f&&(e(b,c),e(b,a));!c.__id&&b.__id&&(c.__id=b.__id);b.__schematype?(b.__schematype=b.__schematype.toLowerCase(),this.schema=this.entityType=b.__schematype,this.type="user"==b.__schematype||"device"==b.__schematype?b.__schematype:"article"):b.__relationtype&&
(b.__relationtype=b.__relationtype.toLowerCase(),this.relation=this.entityType=b.__relationtype,this.type="connection");var h=parseInt(1E6*Math.random(),10);this.__defineGetter__("cid",function(){return h});var j="__revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),k=["__link","__endpointa","__endpointb"],l=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";
return b};this.getObject=function(){return b};this.toJSON=function(){return b};this.__defineGetter__("id",function(){return this.get("__id")});this.__defineSetter__("id",function(b){this.set("__id",b)});b.__attributes||(b.__attributes={});c.__attributes||(c.__attributes={});this.attributes=function(){if(0===arguments.length)b.__attributes||(b.__attributes={});else{if(1==arguments.length)return b.__attributes||(b.__attributes={}),b.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1]&&
null!=arguments[1])throw Error("only string values can be stored in attributes.");b.__attributes||(b.__attributes={});b.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return b.__attributes};var m=function(){var a=!1,d=JSON.parse(JSON.stringify(c.__attributes)),e;for(e in b.__attributes)"undefined"==typeof b.__attributes[e]||null===b.__attributes[e]?(d[e]=null,a=!0):b.__attributes[e]!=c.__attributes[e]?
(d[e]=b.__attributes[e],a=!0):b.__attributes[e]==c.__attributes[e]&&delete d[e];return!a?null:d};this.getChangedAttributes=m;this.aggregates=function(){var a={},c;for(c in b){if(!b.hasOwnProperty(c))return;"$"==c[0]&&(a[c]=b[c])}if(0===arguments.length)return a;if(1==arguments.length)return a[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var n=[];b.__tags||(b.__tags=[]);c.__tags||(c.__tags=[]);this.__defineGetter__("tags",function(){return!b.__tags?
[]:b.__tags});this.addTag=function(a){if(!a||"string"!=typeof a||!a.length)return this;b.__tags.push(a);b.__tags=Array.distinct(b.__tags);if(!n||!n.length)return this;a=n.indexOf(a);-1!=a&&n.splice(a,1);return this};this.removeTag=function(a){if(!a||"string"!=typeof a||!a.length)return this;n.push(a);n=Array.distinct(n);if(!b.__tags||!b.__tags.length)return this;a=b.__tags.indexOf(a);-1!=a&&b.__tags.splice(a,1);return this};this.getChangedTags=function(){var a=[];b.__tags.every(function(b){-1==c.__tags.indexOf(b)&&
a.push(b)});return a};this.getRemovedTags=function(){return _removetags};var p=function(a){var d=!1,e=JSON.parse(JSON.stringify(c)),f;for(f in b)"undefined"==typeof b[f]||null===b[f]?(e[f]=null,d=!0):b[f]!=c[f]?(e[f]=b[f],d=!0):b[f]==c[f]&&delete e[f];try{j.forEach(function(b){e[b]&&delete e[b]})}catch(h){}a?(delete e.__tags,b.__tags&&0<b.__tags.length&&(e.__addtags=this.getChangedTags()),n&&0<n.length&&(e.__removetags=n)):b.__tags&&0<b.__tags.length&&(e.__tags=this.getChangedTags());(a=m())?e.__attributes=
a:delete e.__attributes;return d?e:!1};this.__defineGetter__("changed",function(){return p()});this.hasChanged=function(){var b=p(!0);return 0===arguments.length?b?!0:!1:1==arguments.length&&"string"==typeof arguments[0]&&0<arguments[0].length?b[arguments[0]]?!0:!1:null};this.changedAttributes=function(){var b=p(!0);if(0===arguments.length)return b;if(1==arguments.length&&"object"==typeof arguments[0]&&arguments[0].length){var a={};arguments[0].forEach(function(c){b[c]&&a.push(b[c])});return a}return!1};
this.previous=function(){return 1==arguments.length&&"string"==typeof arguments[0]&&arguments[0].length?a[arguments]:null};this.previousAttributes=function(){return a};var q="";this.__defineGetter__("fields",function(){return q});this.__defineSetter__("fields",function(b){"string"==typeof b?q=b:"object"==typeof b&&b.length&&(q=b.join(","))});this.get=function(a){if(a)return b[a]};this.set=function(a,c){if(!a||"string"!=typeof a||0==a.length)return this;null==c||"undefined"==c?b[a]=null:"string"==
typeof c?b[a]=c:"number"==typeof c?b[a]=c+"":"object"==typeof c&&(0<=c.length?b[a]=c:-1!==k.indexOf(a)&&(b[a]=c));return this};this.unset=function(a){if(!a||"string"!=typeof a||0==a.length||0==a.indexOf("__"))return this;try{delete b[a]}catch(c){}return this};this.has=function(a){return!a||"string"!=typeof a||0==a.length?!1:b[a]&&"undefined"!=typeof b[a]?!0:!1};this.isNew=function(){return b.__id&&b.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new Appacitive.Article(b):new Appacitive.connection(b)};
this.copy=function(a){a&&e(a,b);return this};this.save=function(a,c){b.__id?t.apply(this,arguments):r.apply(this,arguments);return this};var r=function(a,f){a=a||function(){};f=f||function(){};var h=this,j=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[this.type].getCreateUrl(b.__schematype||b.__relationtype,q);if(b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))j=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getCreateUrl();
var k=new d.Appacitive.HttpRequest;k.url=j;k.method="put";b.__revision&&delete b.__revision;k.data=b;k.onSuccess=function(j){var k=null;if(j&&(j.article||j.connection||j.user||j.device))k=j.article||j.connection||j.user||j.device;j&&k?(c=k,b.__id=k.__id,e(k,b),h.connectionCollections&&0<h.connectionCollections.length&&h.connectionCollections.forEach(function(a){a.getQuery().extendOptions({articleId:b.__id})}),"connection"==h.type&&h.parseConnection(),d.Appacitive.eventManager.fire((h.__schematype||
h.__relationtype)+"."+h.type+".created","base",{object:h}),"function"==typeof a&&a(h)):(j=j||{},j.status=j.status||{},j.status=l(j.status),d.Appacitive.eventManager.fire((h.__schematype||h.__relationtype)+"."+h.type+".createFailed","base",{error:j.status}),"function"==typeof f&&f(j.status,h))};k.onError=function(b){b=l(b);"function"==typeof f&&f(b,h)};d.Appacitive.http.send(k);return this},t=function(f,h){f=f||function(){};h=h||function(){};var j=p(!0),k=this;if(j){var g=new d.Appacitive.HttpRequest,
m=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[this.type].getUpdateUrl(b.__schematype||b.__relationtype,c.__id?c.__id:b.__id,q);if(b&&b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))m=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getUpdateUrl(c.__id);g.url=m;g.method="post";g.data=j;g.onSuccess=function(j){j&&(j.article||j.connection||j.user||j.device)?(e(b,a),c=j.article||j.connection||
j.user||j.device,e(c,b),n=[],d.Appacitive.eventManager.fire(k.type+"."+b.__id+".updated","base",{object:k}),"function"==typeof f&&f(k)):(j=j||{},j.status=j.status||{},j.status=l(j.status),d.Appacitive.eventManager.fire(k.type+"."+b.__id+".updateFailed","base",{object:j.status}),"function"==typeof h&&h(j.status,k))};g.onError=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";"function"==typeof h&&h(b,k)};d.Appacitive.http.send(g)}else"function"==typeof f&&f(k);return this};
this.fetch=function(a,f){a=a||function(){};f=f||function(){};if(b.__id){var j=this,h=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory[this.type].getGetUrl(b.__schematype||b.__relationtype,b.__id,q),k=new d.Appacitive.HttpRequest;k.url=h;k.method="get";k.onSuccess=function(d){d&&(d.article||d.connection||d.user||d.device)?(c=d.article||d.connection||d.user||d.device,e(c,b),j.___collection&&"article"==j.___collection.collectionType&&j.___collection.addToCollection(j),"function"==typeof a&&
a(j)):(d=d||{},d.status=d.status||{},d.status=l(d),"function"==typeof f&&f(d.status,j))};k.onError=function(b){b=l(b);"function"==typeof f&&f(b,j)};d.Appacitive.http.send(k);return this}"function"==typeof f&&f({code:"400",message:"Please specify id for get operation"},this)};this.del=function(a,c,e){if(!b.__id&&this.___collection)this.___collection.removeByCId(h),"function"==typeof a&&a(this);else{a=a||function(){};c=c||function(){};e=e||{};var f=this,j=d.Appacitive.config.apiBaseUrl,j=j+d.Appacitive.storage.urlFactory[this.type].getDeleteUrl(b.__schematype||
b.__relationtype,b.__id);if(b&&b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))j=d.Appacitive.config.apiBaseUrl,j+=d.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getDeleteUrl(b.__id);e.deleteConnections&&!0===e.deleteConnections&&(j=-1==j.indexOf("?")?j+"?deleteconnections=true":j+"&deleteconnections=true");e=new d.Appacitive.HttpRequest;e.url=j;e.method="delete";e.onSuccess=function(d){"200"==d.code?(f.___collection&&f.___collection.removeById(b.__id),
"function"==typeof a&&a(d)):(d=l(d),"function"==typeof c&&c(d,f))};e.onError=function(b){b=l(b);"function"==typeof c&&c(b,f)};d.Appacitive.http.send(e)}}};d.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(d){var g=function(){return Math.floor(65536*Math.random()).toString(16)};d.Appacitive.GUID=function(){var d=g()+g()+"-"+g()+"-"+g()+"-"+g()+"-"+g()+g()+g(),c="",a,e,b,h,j,k,l=0,d=d.replace(/\r\n/g,"\n");e="";for(b=0;b<d.length;b++)h=d.charCodeAt(b),128>h?e+=String.fromCharCode(h):(127<h&&2048>h?e+=String.fromCharCode(h>>6|192):(e+=String.fromCharCode(h>>12|224),e+=String.fromCharCode(h>>6&63|128)),e+=String.fromCharCode(h&63|128));for(d=e;l<d.length;)a=d.charCodeAt(l++),e=d.charCodeAt(l++),
b=d.charCodeAt(l++),h=a>>2,a=(a&3)<<4|e>>4,j=(e&15)<<2|b>>6,k=b&63,isNaN(e)?j=k=64:isNaN(b)&&(k=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return c.toString()}})(global);
(function(d){d.Appacitive.ArticleCollection=function(g){var f=null,c=null,a=[],e={};"string"==typeof g?e.schema=g:e=g;this.collectionType="article";if(!e||!e.schema)throw Error("Must provide schema while initializing ArticleCollection.");var f=e.schema,b=this;g=function(a){a.type="article";a.schema?f=a.schema:a.schema=f;c=new d.Appacitive.Queries.BasicFilterQuery(a);e=a;b.extendOptions=c.extendOptions};this.setFilter=function(a){e.filter=a;e.type="article";c?c.filter=a:(c=new d.Appacitive.Queries.BasicFilterQuery(e),
b.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){!a&&0==a.trim().length&&(e.freeText="");e.freeText=a;e.type="article";c?c.freeText=a:(c=new d.Appacitive.Queries.BasicFilterQuery(e),b.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(e.fields="");e.fields=a;e.type="article";c?c.fields=a:(c=new d.Appacitive.Queries.BasicFilterQuery(e),b.extendOptions=c.extendOptions);return this};this.reset=function(){f=e=null;a.length=0;c=null};this.__defineGetter__("query",
function(){return c});this.getQuery=function(){return c};var h=["BasicFilterQuery"];this.__defineSetter__("query",function(b){if(!b||!b.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if(-1==h.indexOf(b.queryType))throw Error("ArticleCollection only accepts "+h.join(", "));a.length=0;c=b});this.setQuery=function(b){this.query=b;return this};this.setOptions=g;g(e);this.get=function(b){if(b!=parseInt(b,10))return null;b=parseInt(b,10);return"number"!=typeof b||b>=a.length?
null:a.slice(b,b+1)[0]};this.addToCollection=function(b){if(!b||b.get("__schematype")!=f)throw Error("Null article passed or schema type mismatch");var c=null;a.forEach(function(a,d){a.get("__id")==b.get("__id")&&(c=d)});0!=c?a.splice(c,1):a.push(b);return this};this.getArticleById=function(b){var c=a.filter(function(a){return a.get("__id")==b});return 1==c.length?c[0]:null};this.getAll=function(){return Array.prototype.slice.call(a)};this.getAllArticles=function(){return Array.prototype.slice.call(a).map(function(b){return b.getArticle()})};
this.removeById=function(b){if(!b)return!1;var c=null;a.forEach(function(a,d){a.getArticle().__id&&a.getArticle().__id==b&&(c=d)});null!==c&&a.splice(c,1);return this};this.removeByCId=function(b){if(!b)return!1;var c=null;a.forEach(function(a,d){a.cid&&a.cid==b&&(c=d)});null!==c&&a.splice(c,1);return this};this.fetch=function(e,f){e=e||function(){};f=f||function(){};a.length=0;var h=c.toRequest();h.onSuccess=function(c){a:{var h=e;c=c||{};var g=c.articles;if(!g)if(c.status&&c.status.code&&"200"==
c.status.code)g=[];else{h=c.status||{message:"Server error",code:400};"function"==typeof f&&f(h,b);break a}if(!g.length||0===g.length)g=[];g.forEach(function(c){c=new d.Appacitive.Article(c,!0);c.___collection=b;a.push(c)});h(c.paginginfo||{},b)}};h.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof f&&f(a,b)};d.Appacitive.http.send(h);return this};this.fetchByPageNumber=function(b,a,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(b,a);return this};this.fetchNextPage=
function(b,a){c.getOptions().pageQuery.pageNumber+=1;this.fetch(b,a);return this};this.fetchPreviousPage=function(b,a){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(b,a);return this};this.createNewArticle=function(c){c=c||{};c.__schematype=f;c=new d.Appacitive.Article(c);c.___collection=b;a.push(c);return c};this.map=function(){return a.map.apply(this,arguments)};this.forEach=function(){return a.forEach.apply(this,arguments)};this.filter=function(){return a.filter.apply(this,
arguments)}};d.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};d.Appacitive.ArticleCollection.prototype.toJSON=function(){return this.getAllArticles()};d.Appacitive.ArticleCollection.prototype.__defineGetter__("articles",function(){return this.getAll()})})(global);
(function(d){d.Appacitive.ConnectionCollection=function(g){var f=null,c=null,a=[],e=[],b={};"string"==typeof g?b.relation=g:b=g;this.collectionType="connection";var h=this;if(!g||!g.relation)throw Error("Must provide relation while initializing ConnectionCollection.");f=g.relation;g=function(a){a.type="connection";a.relation?f=a.relation:a.relation=f;c=new d.Appacitive.Queries.BasicFilterQuery(a);b=a;return h};this.setFilter=function(a){b.filter=a;b.type="connection";c?c.filter=a:(c=new d.Appacitive.Queries.BasicFilterQuery(b),
h.extendOptions=c.extendOptions);return this};this.setFreeText=function(a){!a&&0==a.trim().length&&(b.freeText="");b.freeText=a;b.type="connection";c?c.freeText=a:(c=new d.Appacitive.Queries.BasicFilterQuery(b),h.extendOptions=c.extendOptions);return this};this.setFields=function(a){a||(b.fields="");b.fields=a;b.type="connection";c?c.fields=a:(c=new d.Appacitive.Queries.BasicFilterQuery(b),h.extendOptions=c.extendOptions);return this};this.__defineGetter__("query",function(){return c});this.getQuery=
function(){return c};var j=["BasicFilterQuery","ConnectedArticlesQuery","GetConnectionsQuery","GetConnectionsBetweenArticlesForRelationQuery"];this.__defineSetter__("query",function(b){if(!b||!b.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");if(-1==j.indexOf(b.queryType))throw Error("ConnectionCollection only accepts "+j.join(", "));e.length=0;a.length=0;c=b});this.setQuery=function(b){this.query=b;return this};this.reset=function(){f=b=null;e.length=0;a.length=
0;c=null};this.setOptions=g;g(b);this.get=function(b){if(b!=parseInt(b,10))return null;b=parseInt(b,10);return"number"!=typeof b||b>=a.length?null:a.slice(b,b+1)[0]};this.addToCollection=function(b){if(!b||b.get("__relationtype")!=f)throw Error("Null connection passed or relation type mismatch");var c=null;a.forEach(function(a,d){a.get("__id")==b.get("__id")&&(c=d)});null!==c?a.splice(c,1):a.push(b);return this};this.getConnection=function(b){var c=a.filter(function(a){return a.get("__id")==b});return 1==
c.length?c[0]:null};this.getAll=function(){return Array.prototype.slice.call(a)};this.getAllConnections=function(){return Array.prototype.slice.call(a).map(function(b){return b.getConnection()})};this.removeById=function(b){if(!b)return!1;var c=null;a.forEach(function(a,d){a.getConnection().__id&&a.getConnection().__id==b&&(c=d)});null!==c&&a.splice(c,1);return this};this.removeByCId=function(b){if(!b)return!1;var c=null;a.forEach(function(a,d){a.cid&&a.cid==b&&(c=d)});null!==c&&a.splice(c,1);return this};
this.getConnectedArticle=function(b){if(!e||0===e.length)return null;var a=e.filter(function(a){return a.get("__id")==b});return 0<a.length?a[0]:null};this.fetch=function(b,f){b=b||function(){};f=f||function(){};a.length=0;var g=c.toRequest();g.onSuccess=function(g){a:{var j=b;g=g||{};var m=g.connections;"GetConnectionsBetweenArticlesForRelationQuery"==c.queryType&&g.connection&&(m=[g.connection]);if(!m)if(g.status&&g.status.code&&"200"==g.status.code)m=[];else{j=g.status||{message:"Server error",
code:400};"function"==typeof f&&f(j,h);break a}if(!m.length||0===m.length)m=[];m.forEach(function(b){b=new d.Appacitive.Connection(b,!0);b.___collection=h;if(b.endpointA.article||b.endpointB.article){var c=b.endpointA.article||b.endpointB.article;c.___collection=h;e.push(c)}try{b.___collection.connectedArticle||delete b.connectedArticle}catch(f){}a.push(b)});j(g.paginginfo||{},h)}};g.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof f&&f(b)};d.Appacitive.http.send(g);return this};
this.fetchByPageNumber=function(b,a,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(b,a);return this};this.fetchNextPage=function(b,a){c.getOptions().pageQuery.pageNumber+=1;this.fetch(b,a);return this};this.fetchPreviousPage=function(b,a){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(b,a);return this};this.createNewConnection=function(b){b=b||{};b.__relationtype=f;b=new d.Appacitive.Connection(b);b.___collection=h;a.push(b);return b};this.map=function(){return a.map.apply(this,
arguments)};this.forEach=function(b,c){return a.forEach(b,c||this)};this.filter=function(){return a.filter.apply(this,arguments)}}})(global);
(function(d){var g=function(f,c){f=f||function(){};c=c||function(){};var a=new d.Appacitive.HttpRequest;a.method="get";a.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));a.onSuccess=function(a){var b=null;a&&(a.identities&&0<a.identities.length)&&(a=a.identities.filter(function(b){return"facebook"==b.authtype.toLowerCase()}),1==a.length&&(b=a[0].username));null!==b?FB.api("/"+b,function(b){b?f(b):c()}):c({code:"404",message:"fb account not found"})};
a.onError=c;d.Appacitive.http.send(a)};d.Appacitive.Article=function(f,c){f=f||{};"string"==typeof f&&(f={__schematype:f});if(!f.__schematype&&!f.schema)throw Error("Cannot set article without __schematype");f.schema&&(f.__schematype=f.schema,delete f.schema);d.Appacitive.BaseObject.call(this,f,c);this.type="article";this.connectionCollections=[];this.getArticle=this.getObject;"user"==this.get("__schematype").toLowerCase()&&(this.getFacebookProfile=g);return this};d.Appacitive.Article.prototype=new d.Appacitive.BaseObject;
d.Appacitive.Article.prototype.constructor=d.Appacitive.Article;d.Appacitive.Article.prototype.getConnections=function(f){if("article"!=this.type)return null;f=f||{};f.articleId=this.get("__id");var c=new d.Appacitive.ConnectionCollection({relation:f.relation});this.connectionCollections.push(c);c.query=new d.Appacitive.Queries.GetConnectionsQuery(f);return c};d.Appacitive.Article.prototype.getConnectedArticles=function(f){f=f||{};"string"==typeof f&&(rName=f,f={relation:rName});f.articleId=this.get("__id");
var c=new d.Appacitive.ConnectionCollection({relation:f.relation});c.connectedArticle=this;this.connectionCollections.push(c);c.query=new d.Appacitive.Queries.ConnectedArticlesQuery(f);return c};d.Appacitive.Article.multiDelete=function(f,c,a){f=f||{};if(!f.schema||"string"!=typeof f.schema||0==f.schema.length)throw Error("Specify valid schema");if("user"==f.schema.toLowerCase()||"device"==f.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(f.ids&&0<f.ids.length){c=
c||function(){};a=a||function(){};var e=new d.Appacitive.HttpRequest;e.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(f.schema);e.method="post";e.data={idlist:f.ids};e.onSuccess=function(b){b&&"200"==b.code?"function"==typeof c&&c():(b=b||{},"function"==typeof a&&a(b.status||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof a&&a(b.status||{message:"Server error",code:400})};d.Appacitive.http.send(e)}else c()};d.Appacitive.Article.multiGet=
function(f,c,a){f=f||{};if(!f.schema||"string"!=typeof f.schema||0==f.schema.length)throw Error("Specify valid schema");if(f.ids&&0<f.ids.length){var e=new d.Appacitive.HttpRequest;e.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(f.schema,f.ids.join(","),f.fields);e.method="get";e.onSuccess=function(b){if(b&&b.articles){if("function"==typeof c){var e=[];b.articles.forEach(function(b){e.push(new d.Appacitive.Article(b))});c(e,b.paginginfo)}}else b=b||{},"function"==
typeof a&&a(b.status||{message:"Server error",code:400})};e.onError=function(b){b=b||{message:"Server error",code:400};"function"==typeof a&&a(b)};d.Appacitive.http.send(e)}else"function"==typeof c&&c([])};d.Appacitive.Article.get=function(f,c,a){f=f||{};if(!f.schema)throw Error("Specify schema");if(!f.id)throw Error("Specify id to fetch");var e={},e="user"==f.schema.toLowerCase()?new d.Appacitive.User({__id:f.id}):new d.Appacitive.Article({__schematype:f.schema,__id:f.id});e.fields=f.fields;e.fetch(c,
a);return e}})(global);
(function(d){var g=function(a,c,b){var f={label:a.label};a.articleid&&(f.articleid=a.articleid);if(a.article)"function"==typeof a.article.getArticle?a.article.get("__id")?f.articleid=a.article.get("__id"):f.article=a.article.getArticle():"object"==typeof a.article&&a.article.__schematype&&(a.article.__id?f.articleid=a.article.__id:f.article=a.article,a.article=new d.Appacitive.Article(a.article));else if(!f.articleid&&!f.article)throw Error("Incorrectly configured endpoints provided to setupConnection");b["endpoint"+
c]=a;return f},f=function(a,c,b){a.article&&"object"==typeof a.article?(b["endpoint"+c]?b["endpoint"+c]&&b["endpoint"+c].article&&b["endpoint"+c].article.getArticle?b["endpoint"+c].article.copy(a.article):b["endpoint"+c].article=new d.Appacitive.Article(a.article):(b["endpoint"+c]={},b["endpoint"+c].article=new d.Appacitive.Article(a.article)),b["endpoint"+c].articleid=a.articleid,b["endpoint"+c].label=a.label,b["endpoint"+c].type=a.type,b["endpoint"+c].article.___collection=b.___collection):b["endpoint"+
c]=a};d.Appacitive.Connection=function(a,c){a=a||{};"string"==typeof a&&(a={__relationtype:a});if(!a.__relationtype&&!a.relation)throw new error("Cannot set connection without relation");a.relation&&(a.__relationtype=a.relation,delete a.relation);a.endpoints&&2==a.endpoints.length&&(a.__endpointa=a.endpoints[0],a.__endpointb=a.endpoints[1],delete a.endpoints);d.Appacitive.BaseObject.call(this,a);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var b="A",c="B";
if(a.__endpointa.label==this.get("__endpointb").label&&a.__endpointa.label!=a.__endpointb.label&&(a.__endpointa.articleid==this.get("__endpointb").articleid||!a.__endpointa.articleid))b="B",c="A";f(this.get("__endpointa"),b,this);f(this.get("__endpointb"),c,this);this.__defineGetter__("endpoints",function(){var b=[];b.push(this.endpointA);b.push(this.endpointB);return b});return this};c?(this.__defineGetter__("connectedArticle",function(){if(!this.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");
var b=this.___collection.connectedArticle.get("__id");if(!b)return null;var a=this.getConnection().__endpointa.articleid;this.getConnection().__endpointa.articleid==b&&(a=this.getConnection().__endpointb.articleid);return this.___collection.getConnectedArticle(a)}),this.parseConnection(a)):a.__endpointa&&a.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};d.Appacitive.Connection.prototype=new d.Appacitive.BaseObject;d.Appacitive.Connection.prototype.constructor=
d.Appacitive.Connection;d.Appacitive.Connection.prototype.setupConnection=function(a,c){if(!a||!a.articleid&&!a.article||!a.label||!c||!c.articleid&&!c.article||!c.label)throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",g(a,"A",this));this.set("__endpointb",g(c,"B",this))};d.Appacitive.Connection.get=function(a,c,b,f){options=options||{};if(!options.relation)throw Error("Specify relation");if(!options.id)throw Error("Specify id to fetch");a=new d.Appacitive.Connection({__relationtype:options.relation,
__id:options.id});a.fields=options.fields;a.fetch(b,f)};var c=function(a,c,b){a.onSuccess=function(a){if(a&&a.status&&"200"==a.status.code){if("function"==typeof c){var f=a.connections,g=[];f||(f=[]);f.forEach(function(b){g.push(new d.Appacitive.Connection(b))});c(g,a.paginginfo)}}else a=a||{},"function"==typeof b&&b(a.status||{message:"Server error",code:400})};a.onError=function(a){a=a||{message:"Server error",code:400};"function"==typeof b&&b(a)};d.Appacitive.http.send(a)};d.Appacitive.Connection.multiGet=
function(a,e,b,f){options=options||{};if(!options.relation||"string"!=typeof options.relation||0==options.relation.length)throw Error("Specify valid relation");if(options.ids&&0<options.ids.length)return a=new d.Appacitive.HttpRequest,a.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(options.relation,options.ids.join(","),options.fields),a.method="get",c(a,b,f);"function"==typeof b&&b([])};d.Appacitive.Connection.multiDelete=function(a,c,b){a=a||{};if(!a.relation||
"string"!=typeof a.relation||0==a.relation.length)throw Error("Specify valid relation");if(a.ids&&0<a.ids.length){var f=new d.Appacitive.HttpRequest;f.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(a.relation);f.method="post";f.data={idlist:a.ids};f.onSuccess=function(a){a&&"200"==a.code?"function"==typeof c&&c():(a=a||{},"function"==typeof b&&b(a||{message:"Server error",code:400}))};f.onError=function(a){a=a||{};"function"==typeof b&&b(a||{message:"Server error",
code:400})};d.Appacitive.http.send(f)}else c()};d.Appacitive.Connection.getInterconnects=function(a,d,b){a=new Appacitive.Queries.InterconnectsQuery(a);c(a.toRequest(),request,d,b)};d.Appacitive.Connection.getBetweenArticles=function(a,d,b){a=new Appacitive.Queries.GetConnectionsBetweenArticlesQuery(a);c(a.toRequest(),d,b)};d.Appacitive.Connection.getBetweenArticlesForRelation=function(a,c,b){a=(new Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(a)).toRequest();a.onSuccess=function(a){a&&
a.status&&"200"==a.status.code?"function"==typeof c&&(a=a.connection?new d.Appacitive.Connection(a.connection):null,"function"==typeof c&&c(a)):(a=a||{},"function"==typeof b&&b(a.status||{message:"Server error",code:400}))};a.onError=function(a){a=a||{};"function"==typeof b&&b(a.status||{message:"Server error",code:400})};d.Appacitive.http.send(a)}})(global);
(function(d){d.Appacitive.Users=new function(){var g=null;this.__defineGetter__("currentUser",function(){return g});var f=function(c,a,e,b){e=e||function(){};b=b||function(){};var f={authtype:"facebook",accesstoken:c,name:"facebook"};c=a.get("__id");if(a.get("__id")){var g=new d.Appacitive.HttpRequest;g.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getLinkAccountUrl(c);g.method="post";g.data=f;g.onSuccess=function(c){c&&"200"==c.code?(a.set("__link",f),"function"==typeof e&&
e(a)):b(c,a)};g.onError=b;d.Appacitive.http.send(g)}else a.set("__link",f),"function"==typeof e&&e(a)};this.setCurrentUser=function(c,a,e){if(!c||"object"!=typeof c||0<=c.length)throw Error("Cannot set null object as user");var b=c;c.getArticle||(b=new d.Appacitive.User(c));if(!b.get("__id")||0==b.get("__id").length)throw Error("Specify user __id");d.Appacitive.localStorage.set("Appacitive-User",c);e||(e=60);g=b;a&&d.Appacitive.Session.setUserAuthHeader(a,e);g.logout=function(b){d.Appacitive.Users.logout(b)};
g.updatePassword=function(b,a,c,e){var f=this,g=c,p=e;c=f.get("__id");if(!c||"string"!==typeof c||0==c.length)throw Error("Please specify valid userid");if(!b||"string"!==typeof b||0==b.length)throw Error("Please specify valid oldPassword");if(!a||"string"!==typeof a||0==a.length)throw Error("Please specify valid newPassword");g=g||function(){};p=p||function(){};b==a?"function"==typeof g&&g(f):(b={oldpassword:b,newpassword:a},a=new d.Appacitive.HttpRequest,a.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getUpdatePasswordUrl(c),
a.method="post",a.data=b,a.onSuccess=function(b){b&&"200"==b.code&&("function"==typeof g?g(f):p(b,f))},a.onError=p,d.Appacitive.http.send(a));return this};g.linkFacebookAccount=function(b,a){var c=function(){f(Appacitive.Facebook.accessToken,g,function(a){d.Appacitive.eventManager.fire("user."+a.get("__id")+".updated",a,{object:a});"function"==typeof b&&b(a)},a)};Appacitive.Facebook.getCurrentUserInfo(function(){c()},function(){Appacitive.Facebook.requestLogin(function(){c()},a)});return this};g.unlinkFacebookAccount=
function(b,a){f("facebook",this,function(a){d.Appacitive.eventManager.fire("user."+a.get("__id")+".updated",a,{object:a});"function"==typeof b&&b(a)},a);return this};g.logout=function(b){Appacitive.Users.logout(b)};d.Appacitive.eventManager.clearAndSubscribe("user."+b.get("__id")+".updated",function(b,a){d.Appacitive.localStorage.set("Appacitive-User",a.object.getArticle())});return g};d.Appacitive.User=function(c){c=c||{};c.__schematype="user";d.Appacitive.Article.call(this,c);return this};d.Appacitive.User.prototype=
new d.Appacitive.Article("user");d.Appacitive.User.prototype.constructor=d.Appacitive.User;d.Appacitive.User.prototype.__defineGetter__("linkedAccounts",function(){var c=this.get("__link");c?"object"==typeof c&&!(0<=c.length)?c=[c]:0<=c.length||(c=c[0]):c=[];return c});d.Appacitive.User.prototype.getAllLinkedAccounts=function(c,a){c=c||function(){};var e=this,b=this,f=function(b){e.linkedAccounts=b;"function"==typeof c&&c(b,e)},g=a,k=b.get("__id");(!k||"string"!==typeof k||0==k.length)&&"function"==
typeof f&&f(b.linkedAccounts,b);var f=f||function(){},g=g||function(){},l=new d.Appacitive.HttpRequest;l.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(k);l.method="get";l.onSuccess=function(a){a&&a.status&&"200"==a.status.code?(a=a.identities||[],0<a.length?b.set("__link",a):b.set("__link",null),"function"==typeof f&&f(a,b)):g(a.status,b)};l.onError=g;d.Appacitive.http.send(l);return this};d.Appacitive.User.prototype.linkFacebookAccount=function(c,
a,d){f(c,this,a,d);return this};d.Appacitive.User.prototype.unlinkFacebookAccount=function(c,a){var e=this;var b=this,f=function(){var b=e.get("__link");b?0<=b.length||(b=b[0]):b=[];0<b.length&&"name"==b[0].name&&e.set("__link",null);"function"==typeof c&&c(e)},g=a,f=f||function(){},g=g||function(){},k=b.get("__id");if(b.get("__id")){var l=new d.Appacitive.HttpRequest;l.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getLinkAccountUrl(k,"facebook");l.method="post";l.onSuccess=
function(a){a&&"200"==a.code?"function"==typeof f&&f(b):g(a,b)};l.onError=g;d.Appacitive.http.send(l)}else"function"==typeof f&&f(b);return this};d.Appacitive.User.prototype.clone=function(){return new Appacitive.User(this.getObject())};this.deleteUser=function(c,a,e){if(!c)throw Error("Specify userid for user delete");(new d.Appacitive.Article({__schematype:"user",__id:c})).del(a||function(){},e||function(){})};this.deleteCurrentUser=function(c,a){c=c||function(){};if(null===g)throw Error("Current user is not yet set for delete operation");
var e=g.get("__id");this.deleteUser(e,function(b){d.Appacitive.Session.removeUserAuthHeader();"function"==typeof c&&c(b)},a)};this.createUser=this.createNewUser=function(c,a,e){c=c||{};c.__schematype="user";if(!c.username||!c.password||!c.firstname||0==c.username.length||0==c.password.length||0==c.firstname.length)throw Error("username, password and firstname are mandatory");(new d.Appacitive.User(c)).save(a,e)};this.signup=function(c,a,d){var b=this;this.createUser(c,function(){b.login(c.username,
c.password,a,d)},function(b){d(b)})};this.authenticateUser=function(c,a,e,b){a=a||function(){};e=e||function(){};c.expiry||(c.expiry=864E5);var f=this,g=new d.Appacitive.HttpRequest;g.method="post";g.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();g.data=c;g.onSuccess=function(d){d&&d.user?(b&&(d.user.__authType=b),f.setCurrentUser(d.user,d.token,c.expiry),a({user:f.currentUser,token:d.token})):(d=d||{},e(d.status))};g.onError=e;d.Appacitive.http.send(g)};
this.login=function(c,a,d,b){if(!c||!a||0==c.length||0==a.length)throw Error("Please specify username and password");this.authenticateUser({username:c,password:a,expiry:864E5},d||function(){},b||function(){},"BASIC")};this.loginWithFacebook=function(c,a,e){c=c||function(){};a=a||function(){};var b=this,f=function(){b.authenticateUser({accesstoken:d.Appacitive.Facebook.accessToken,type:"facebook",expiry:864E5,createnew:!0},function(d){d.user?(d.user.__authType="FB","function"==typeof c&&c({user:b.currentUser,
token:d.token})):(d=d||{},"function"==typeof a&&a(d.status))},a,"FB")};e?f():FB?Appacitive.Facebook.requestLogin(function(){f()},a):"function"==typeof a&&a()};this.authenticateWithFacebook=this.signupWithFacebook;this.validateCurrentUser=function(c,a){c&&("function"!=typeof c&&"boolean"==typeof c)&&(a=c,c=function(){});var e=d.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(!e)return"function"==typeof c&&c(!1),!1;if(a)return"function"==typeof c&&c(!0),!0;try{var b=new d.Appacitive.HttpRequest;
b.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getValidateTokenUrl(e);b.method="POST";b.data={};b.onSuccess=function(b){"function"==typeof c&&c(b.result)};d.Appacitive.http.send(b)}catch(f){c(!1)}};this.sendResetPasswordEmail=function(c,a,e,b){e=e||function(){};b=b||function(){};if(!c||"string"!=typeof c||0==c.length)throw Error("Please specify valid username");if(a&&"string"==typeof a&&0==a.length)throw Error("Plase specify subject for email");c={username:c,subject:a};
a=new d.Appacitive.HttpRequest;a.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.user.getSendResetPasswordEmailUrl();a.method="post";a.data=c;a.onSuccess=function(a){a&&"200"==a.code&&("function"==typeof e?e():b(a))};a.onError=b;d.Appacitive.http.send(a)};this.logout=function(c,a){g=null;d.Appacitive.Session.removeUserAuthHeader(c||function(){},a)}}})(global);
(function(d){d.Appacitive.Email=new function(){var g={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return g};var f=function(c,a,e){var b=new d.Appacitive.HttpRequest;b.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.email.getSendEmailUrl();b.method="post";b.data=c;b.onSuccess=function(b){b&&b.status&&"200"==b.status.code?a(b.email):(b=b||{},b.status=b.status||{},e(b.status.message||"Server error"))};
d.Appacitive.http.send(b)};this.setupEmail=function(c){c=c||{};g.smtp.username=c.username||g.smtp.username;g.from=c.from||g.from;g.smtp.password=c.password||g.smtp.password;g.smtp.host=c.smtp.host||g.smtp.host;g.smtp.port=c.smtp.port||g.smtp.port;g.smtp.enablessl=c.enableSSL||g.smtp.enablessl;g.replyto=c.replyTo||g.replyto};this.sendTemplatedEmail=function(c,a,d){a=a||function(){};d=d||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!c.templateName)throw Error("template name is mandatory to send an email");var b={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{templatename:c.templateName||"",data:c.data||{},ishtml:!1==c.isHtml?!1:!0}};if(c.useConfig){b.smtp=g.smtp;if(!c.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
b.from=c.from||g.from;b.replyto=c.replyTo||g.replyto}f(b,a,d)};this.sendRawEmail=function(c,a,d){a=a||function(){};d=d||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.body)throw Error("body is mandatory to send an email");var b={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{content:c.body||"",ishtml:!1==c.isHtml?
!1:!0}};if(c.useConfig){b.smtp=g.smtp;if(!c.from&&!g.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");b.from=c.from||g.from;b.replyto=c.replyTo||g.replyto}f(b,a,d)}}})(global);
(function(d){var g=function(){var d=require("facebook-node-sdk"),c=null,a=this.FB=null,e=!0;this.initialize=function(b){if(!d)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!b.appId)throw Error("Please provide appid");if(!b.appSecret)throw Error("Please provide app secret");a=b.appSecret;this.FB=new d({appId:_appId,secret:a});e=!0};this.requestLogin=function(b,a,d){e?(c=accesstoken,FB.setAccessToken(d),Appacitive.Users.loginWithFacebook(b,a,!0)):"function"==typeof a&&
a("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,a){if(!e)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");this.FB&&c?(b=b||function(){},a=a||function(){},this.FB.api("/me",function(c,d){d?"function"==typeof b&&b(d):"function"==typeof a&&a("Access token is invalid")})):a("Either intialize facebook with your appid and appsecret or set accesstoken")};this.__defineGetter__("accessToken",function(){return c});this.__defineSetter__("accessToken",
function(b){console.log(b);c=b;this.FB&&this.FB.setAccessToken(b)});this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(b){b=b||function(){};Appacitive.facebook.accessToken="";"function"==typeof b&&b()}};d.Appacitive.Facebook=d.Appacitive.runtime.isBrowser?new function(){var d=null,c=!0;this.initialize=function(a){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!a.appId)throw Error("Please provide appid");FB.init(a);
c=!0};this.requestLogin=function(a,e){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");a=a||function(){};e=e||function(){};FB.login(function(b){b&&"connected"===b.status&&b.authResponse?(d=b.authResponse.accessToken,"function"==typeof a&&a(b.authResponse)):"function"==typeof e&&e()},{scope:"email,user_birthday"})};this.getCurrentUserInfo=function(a,e){if(!c)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");a=a||function(){};
e=e||function(){};FB.api("/me",function(b){b&&!b.error?(d=FB.getAuthResponse().accessToken,"function"==typeof a&&a(b)):"function"==typeof e&&e()})};this.__defineGetter__("accessToken",function(){return d});this.__defineSetter__("accessToken",function(a){d=a});this.getProfilePictureUrl=function(a){return"https://graph.facebook.com/"+a+"/picture"};this.logout=function(a,c){a=a||function(){};c=c||function(){};Appacitive.facebook.accessToken="";try{FB.logout(function(){Appacitive.Users.logout();"function"==
typeof a&&a()})}catch(b){"function"==typeof c&&c(b.message)}}}:new g})(global);
(function(d){d.Appacitive.Push=new function(){this.send=function(g,f,c){f=f||function(){};c=c||function(){};if(!g)throw Error("Please specify push options");var a=new d.Appacitive.HttpRequest;a.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();a.method="post";a.data=g;a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.id):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};a.onError=function(a){c(a||"Server error")};d.Appacitive.http.send(a)};
this.getNotification=function(g,f,c){f=f||function(){};c=c||function(){};if(!g)throw Error("Please specify notification id");var a=new d.Appacitive.HttpRequest;a.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(g);a.method="get";a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotification):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};a.onError=function(a){c(a||"Server error")};d.Appacitive.http.send(a)};this.getAllNotifications=
function(g,f,c){f=f||function(){};c=c||function(){};g?(g.pnum=g.pnum||1,g.psize=g.psize||20):g={pnum:1,psize:20};var a=new d.Appacitive.HttpRequest;a.url=d.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(g);a.method="get";a.onSuccess=function(a){a&&a.status&&"200"==a.status.code?f(a.pushnotifications,a.paginginfo):(a=a||{},a.status=a.status||{},c(a.status.message||"Server error"))};a.onError=function(a){c(a||"Server error")};d.Appacitive.http.send(a)}}})(global);
(function(d){d.Appacitive.File=function(g){g=g||{};this.fileId=g.fileId;this.contentType=g.contentType;this.fileData=g.fileData;var f=function(a,c,f){var e=new d.Appacitive.HttpRequest;e.url=a;e.method="GET";e.onSuccess=c;e.onError=f;d.Appacitive.http.send(e)},c=function(a,c,f,e,g){(new FormData).append("fileToUpload",c);var m=new d.Appacitive.HttpRequest;m.url=a;m.method="PUT";m.data=c;m.headers.push({key:"content-type",value:f});m.onSuccess=e;m.onError=g;m.send(!0)};this.save=function(b,c,d){this.fileId&&
"string"==typeof this.fileId&&0<this.fileId.length?e(this,b,c,d):a(this,b,c,d)};var a=function(a,e,g,k){if(!a.fileData)throw Error("Please specify filedata");if(k||"string"==typeof k)a.contentType=k;else{if(!a.contentType||"string"!==typeof k||0==a.contentType.length)a.contentType="text/plain";try{a.contentType=file.type}catch(l){}}k=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.file.getUploadUrl(a.contentType);e=e||function(){};g=g||function(){};f(k,function(d){d&&d.status&&"200"==
d.status.code?c(d.url,a.fileData,a.contentType,function(){a.fileId=d.id;a.getDownloadUrl(function(c){e(c,a)},g)},g):"function"==typeof g&&g(d.status,a)},g);return this},e=function(a,e,g,k){if(!a.fileData)throw Error("Please specify filedata");if(k||"string"==typeof k)a.contentType=k;else{if(!a.contentType||"string"!==typeof k||0==a.contentType.length)a.contentType="text/plain";try{a.contentType=file.type}catch(l){}}k=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.file.getUpdateUrl(a.fileId,
a.contentType);e=e||function(){};g=g||function(){};f(k,function(d){d&&d.status&&"200"==d.status.code?c(d.url,a.fileData,a.contentType,function(){a.getDownloadUrl(function(c){e(c,a)},g)},g):"function"==typeof g&&g(d.status,a)},g);return this};this.deleteFile=function(a,c){if(!this.fileId)throw Error("Please specify fileId to delete");a=a||function(){};c=c||function(){};var f=new d.Appacitive.HttpRequest;f.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);
f.method="DELETE";f.onSuccess=function(d){d&&"200"==d.code?"function"==typeof a&&a():"function"==typeof c&&"function"==typeof c&&c(d,that)};f.onError=c;d.Appacitive.http.send(f);return this};this.getDownloadUrl=function(a,c){if(!this.fileId)throw Error("Please specify fileId to download");var f=this;a=a||function(){};c=c||function(){};var e=new d.Appacitive.HttpRequest;e.url=d.Appacitive.config.apiBaseUrl+d.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);e.method="GET";e.onSuccess=
function(d){d&&d.status&&"200"==d.status.code?(f.url=d.uri,"function"==typeof a&&a(d.uri)):"function"==typeof c&&"function"==typeof c&&c(d.status,f)};e.onError=c;d.Appacitive.http.send(e);return this}}})(global);
(function(d){d.Appacitive.Date={};d.Appacitive.Date.parseISODate=function(d){try{var f=new Date(d);if(isNaN(f)){var c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/,a=!1;if(!c.exec(d))if(c=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})/,c.exec(d))a=!0;else return null;var e=d.split("T"),b=e[0].split("-"),h=e[1].split("Z")[0].split(":"),j=h[2].split("."),k=Number(h[0]),f=new Date;f.setUTCFullYear(Number(b[0]));f.setUTCMonth(Number(b[1])-1);f.setUTCDate(Number(b[2]));
a||(f.setUTCHours(Number(k)),f.setUTCMinutes(Number(h[1])),f.setUTCSeconds(Number(j[0])),j[1]&&f.setUTCMilliseconds(Number(j[1])))}return f}catch(l){return null}};d.Appacitive.Date.toISOString=function(d){try{return d=d.toISOString(),d=d.replace("Z","0000Z")}catch(f){return null}};d.Appacitive.Date.toISODate=function(d){try{return d=d.toISOString()[0]}catch(f){return null}};d.Appacitive.Date.toISOTime=function(d){try{return d=d.toISOString().split("T")[1],d=d.replace("Z","0000Z")}catch(f){return null}};
d.Appacitive.Date.parseISOTime=function(d){try{var f=new Date;if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(d))return null;var c=d.split("T");1==c.length&&c.push(c[0]);var a=c[1].split("Z")[0].split(":"),e=a[2].split(".");f.setUTCHours(Number(Number(a[0])));f.setUTCMinutes(Number(a[1]));f.setUTCSeconds(Number(e[0]));e[1]&&f.setUTCMilliseconds(Number(e[1]));return f}catch(b){return null}}})(global);
(function(d){d.Appacitive.localStorage=new function(){var g=d.Appacitive.runtime.isBrowser?window.localStorage:{};this.set=function(d,c){c=c||"";if(!d)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(a){}g[d]=c;return!0};this.get=function(d){if(!d)return null;d=g.getItem(d);if(!d)return null;if("{"==d[0])try{d=JSON.parse(d)}catch(c){}return d};this.remove=function(d){if(d)try{delete g[d]}catch(c){}}}})(global);
(function(d){d.Appacitive.runtime.isBrowser&&(d.Appacitive.Cookie=new function(){this.setCookie=function(d,f,c,a){if(c){var e=new Date;e.setTime(e.getTime()+6E4*c);e="; expires="+e.toGMTString()}a||(e="");document.cookie=d+"="+f+e+"; path=/"};this.readCookie=function(d){d+="=";for(var f=document.cookie.split(";"),c=0;c<f.length;c++){for(var a=f[c];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(d))return a.substring(d.length,a.length)}return null};this.eraseCookie=function(d){this.setCookie(d,
"",-1,!0)}})})(global);"undefined"!=typeof module&&!global.Appacitive.runtime.isBrowser&&(module.exports=global.Appacitive);