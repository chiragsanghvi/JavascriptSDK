try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(g,e){Object.defineProperty(this,g,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(g,e){Object.defineProperty(this,g,{set:e,enumerable:!0,configurable:!0})}}))}catch(defPropException){}var global={};
(function(){global="undefined"==typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var g=function(b){if(!b||!b.send||"function"!=typeof b.send)throw Error("No applicable httpTransport class found");b.onResponse=this.onResponse;var c=[],e={},d=0,g={},l=0;this.addProcessor=function(b){if(b){b.pre=b.pre||function(){};b.post=b.post||function(){};var f=b.pre;d+=1;e[d]=f;b=b.post;l+=1;g[l]=b}};this.enqueueRequest=
function(b){c.push(b)};this.notify=function(){if(0!==c.length){var d=[],k;for(k in g)g.hasOwnProperty(k)&&d.push(g[k]);for(;0<c.length;){var l=c.shift(),q=[];for(k in e)e.hasOwnProperty(k)&&q.push(e[k](l));b.send(l,d,q)}}};this.onResponse=function(b){console.dir(b)}},e=function(){var b=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=b;this.onResponse=function(){b()};this.onError=function(){b()}},d=function(){var b=new e;b.type="jQuery based http provider";b.send=function(b,
f,e){"function"==typeof b.beforeSend&&b.beforeSend(b);switch(b.method.toLowerCase()){case "get":$.ajax({url:b.url,type:"GET",async:b.async,beforeSend:function(f){for(var c=0;c<b.headers.length;c+=1)f.setRequestHeader(b.headers[c].key,b.headers[c].value)},success:function(g){try{g=JSON.parse(g)}catch(n){}c(g,f,e);d.onResponse(g,b)},error:function(f){d.onError(b,f)}});break;case "post":$.ajax({url:b.url,type:"POST",async:b.async,contentType:"application/json",data:JSON.stringify(b.data),beforeSend:function(f){for(var c=
0;c<b.headers.length;c+=1)f.setRequestHeader(b.headers[c].key,b.headers[c].value)},success:function(g){try{g=JSON.parse(g)}catch(n){}c(g,f,e);d.onResponse(g,b)},error:function(f){d.onError(b,f)}});break;case "put":$.ajax({url:b.url,type:"PUT",contentType:"application/json",data:JSON.stringify(b.data),async:b.async,beforeSend:function(f){for(var c=0;c<b.headers.length;c+=1)f.setRequestHeader(b.headers[c].key,b.headers[c].value)},success:function(g){try{g=JSON.parse(g)}catch(n){}c(g,f,e);d.onResponse(g,
b)},error:function(f){d.onError(b,f)}});break;case "delete":$.ajax({url:b.url,type:"DELETE",async:b.async,beforeSend:function(f){for(var c=0;c<b.headers.length;c+=1)f.setRequestHeader(b.headers[c].key,b.headers[c].value)},success:function(g){try{g=JSON.parse(g)}catch(n){}c(g,f,e);d.onResponse(g,b)},error:function(f){d.onError(b,f)}});break;default:throw Error("Unrecognized http method: "+b.method);}};b.isOnline=function(){return window.navigator.onLine||!0};var c=function(b,f,c){if(f.length!=c.length)throw Error("Callback length and state length mismatch!");
for(var d=0;d<f.length;d+=1)f[d].apply({},[b,c[d]])},d=b;$=$||{};$.ajax=$.ajax||{};return b},c=function(){var b=new e;b.type="Http provider for nodejs";b.send=function(b,f,e){"function"==typeof b.beforeSend&&b.beforeSend(b);var n=b;b=require("url").parse(n.url);var n=n||{},p;for(p in n)if("headers"==p)for(var q=0;q<n.headers.length;q+=1)d.headers[n.headers[q].key]=n.headers[q].value;else d[p]=n[p];d.host=b.host;d.port=b.port||80;d.path=b.path;d.method=n.method.toUpperCase();"string"!=typeof d.data&&
(d.data=JSON.stringify(d.data));d.headers["Content-Length"]=d.data.length;d.headers["Content-Type"]="application/json";p=g.request(d,function(b){var d="";b.setEncoding("utf8");b.on("data",function(b){d+=b});b.on("end",function(){if("application/json"==b.headers["content-type"]&&"200"==b.statusCode){"{"!=d[0]&&(d=d.substr(1,d.length-1));b.json=JSON.parse(d);var g=b.json;if(f.length!=e.length)throw Error("Callback length and state length mismatch!");for(var k=0;k<f.length;k+=1)f[k].apply({},[g,e[k]]);
c.onResponse(b.json,n)}else b.text=d,c.onError(n,b)})});p.write(d.data);p.on("error",function(b){c.onError(n,b)});p.end()};b.isOnline=function(){return!0};var c=b,d={host:"localhost",port:80,path:"",data:"{}",method:"GET",headers:{"Content-Type":"application/json",accept:"application/json"}},g=require("http");return b};global.Appacitive.http=new function(){var b=global.Appacitive.runtime.isBrowser?new d:new c,e=new g(b),j=!1;this.pause=function(){j=!0};this.unpause=function(){j=!1};this.addProcessor=
function(b){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!b)throw c;if(!b.pre&&!b.post)throw c;e.addProcessor(b)};this.send=function(c){e.enqueueRequest(c);b.isOnline()&&!1==j&&e.notify()};this.flush=function(c){c?e.notify():b.isOnline()&&e.notify()};this.onError=function(b,c){if(b.onError)if(b.context)b.onError.apply(b.context,[c]);else b.onError(c)};b.onError=this.onError;this.onResponse=function(b,c){if(c.onSuccess)if(c.context)c.onSuccess.apply(c.context,
[b]);else c.onSuccess(b)};b.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(){this.url="";this.data={};this.async=!0;this.headers=[];this.method="GET"};global.Appacitive&&global.Appacitive.http&&global.Appacitive.http.addProcessor({pre:function(){return(new Date).getTime()},post:function(b,c){var d=(new Date).getTime()-c;b._timeTakenInMilliseconds=d}});var b=global;b.Appacitive&&b.Appacitive.http&&b.Appacitive.http.addProcessor({pre:function(b){return b},post:function(c,d){try{b.Appacitive.session.isSessionValid(c)?
c&&(c.status&&c.status.code&&"8036"==c.status.code||c.code&&"8036"==c.code)?b.Appacitive.session.logout(function(){},!0):b.Appacitive.session.incrementExpiry():(null!=b.Appacitive.session.get()&&b.Appacitive.session.resetSession(),b.Appacitive.http.send(d))}catch(e){}}})})();
(function(g){String.format=function(e,d){if(1>=arguments.length)return e;for(var c=arguments.length-2,b=0;b<=c;b++)e=e.replace(RegExp("\\{"+b+"\\}","gi"),arguments[b+1]);return e};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(e){var d=RegExp("^"+e),c=this;d.test(c)&&(c=c.slice(1,c.length));d=RegExp(e+"$");d.test(c)&&(c=c.slice(0,-1));return c};String.toSearchString=function(e){"undefined"==typeof e&&(e="");for(var d=
"",c=0;c<e.length;c+=1)-1==" .,;#".indexOf(e[c])&&(d+=e[c]);return d=d.toLowerCase()};String.contains=function(e,d){return-1!=e.indexOf(d)};String.startsWith=function(e,d){return 0==e.indexOf(d)};Array.distinct=function(e){var d=[],c=e.length,b,f,g;for(f=0;f<c;f++){b=void 0;for(g=0;g<d.length;g++)if(e[f].toLowerCase()===d[g].toLowerCase()){b=!0;break}b||d.push(e[f])}return d};g.dateFromWcf=function(e,d){var c=/Date\(([^)]+)\)/.exec(e);if(2!=c.length){if(!d)return s;throw Error(s+" is not .net json date.");
}return new Date(parseFloat(c[1]))};g.Appacitive.storage=g.Appacitive.storage||{};g.Appacitive.storage.urlFactory=new function(){g.Appacitive.bag=g.Appacitive.bag||{};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(){return String.format("{0}/create",this.userServiceUrl)},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getUserUrl:function(e){return String.format("{0}/{1}",
this.userServiceUrl,e)},getUpdateUrl:function(e){return String.format("{0}/{1}",this.userServiceUrl,e)},getDeleteUrl:function(e){return String.format("{0}/{1}",this.userServiceUrl,e)},getGetAllLinkedAccountsUrl:function(e){return String.format("{0}/{1}/linkedaccounts",this.userServiceUrl,e)},getValidateTokenUrl:function(e){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,e)},getInvalidateTokenUrl:function(e){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,
e)}};this.device={deviceServiceUrl:"device",getCreateUrl:function(){return String.format("{0}/register",this.deviceServiceUrl)},getUpdateUrl:function(e){return String.format("{0}/{1}",this.deviceServiceUrl,e)},getDeleteUrl:function(e){return String.format("{0}/{1}",this.deviceServiceUrl,e)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(e,d,c){var b="",b=String.format("{0}/search/{1}/all",this.articleServiceUrl,e),b=c?b+"?psize="+c:b+"?psize=10";if("undefined"!==typeof d&&0<d.length)for(e=
0;e<d.length;e+=1)0!=d[e].trim().length&&(b=b+"&"+d[e]);return b},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(e,d){var c=String.format("{0}/search/{1}/all",this.articleServiceUrl,e);return c+("?properties="+d)},getGetUrl:function(e,d){return String.format("{0}/{1}/{2}",this.articleServiceUrl,e,d)},getMultiGetUrl:function(e,d){return String.format("{0}/{1}/multiGet/{2}",this.articleServiceUrl,e,d)},getCreateUrl:function(e){return String.format("{0}/{1}",
this.articleServiceUrl,e)},getUpdateUrl:function(e,d){return String.format("{0}/{1}/{2}",this.articleServiceUrl,e,d)},getDeleteUrl:function(e,d){return String.format("{0}/{1}/{2}",this.articleServiceUrl,e,d)},getMultiDeleteUrl:function(e){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,e)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(e,d){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,e,d)},getMultiGetUrl:function(e,d){return String.format("{0}/{1}/multiGet/{2}",
this.connectionServiceUrl,e,d)},getCreateUrl:function(e){return String.format("{0}/{1}",this.connectionServiceUrl,e)},getUpdateUrl:function(e,d){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,e,d)},getDeleteUrl:function(e,d){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,e,d)},getMultiDeleteUrl:function(e){return String.format("{0}/{1}/bulkdelete",this.connectionServiceUrl,e)},getSearchByArticleUrl:function(e,d,c,b){var f="",f=String.format("{0}/{1}/find/all?label={2}&articleid={3}",
this.connectionServiceUrl,e,c,d);if("undefined"!==typeof b&&0<b.length)for(e=0;e<b.length;e+=1)f=f+"&"+b[e];return f},getConnectedArticles:function(e,d,c){var b="",b=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,e,d);if(c&&c.length&&0<c.length)for(e=0;e<c.length;e+=1)b=0==e?b+("?"+c[e]):b+("&"+c[e]);return b},getInterconnectsUrl:function(){var e="";return e=String.format("{0}/interconnects",this.connectionServiceUrl)},getPropertiesSearchUrl:function(e,d){var c=String.format("{0}/{1}/find/all",
this.connectionServiceUrl,e);return c+("?properties="+d)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(e){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,e)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(e){return String.format("{0}/notification/{1}",this.pushServiceUrl,e)},getGetAllNotificationsUrl:function(e){return String.format("{0}/getAll?psize={1}&pnum={2}",
this.pushServiceUrl,e.psize,e.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(){return String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(contenttype))},getUploadUrl:function(e,d){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",this.fileServiceUrl,d,escape(contenttype))},getDownloadUrl:function(e,d){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,e,d)},getDeleteUrl:function(){return String.format("{0}/delete/{1}",
this.fileServiceUrl,fileId)}};this.query={params:function(e){var d=[];return""==location.search||-1==location.search.indexOf("?")?d:e?(e=e.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(c,b){var f=b.split("="),g=f[1];2<f.length&&f.forEach(function(b){0==b||1==b||(g=g+"="+f[b])});f[0].toLowerCase()==e&&(d=[f[0],g])}),d):location.search.split("?")[1].split("=")}}}})(global);
(function(g){g.Appacitive.eventManager=new function(){var e={};this.subscribe=function(d,c){if("string"!=typeof d||"function"!=typeof c)throw Error("Incorrect subscription call");"undefined"==typeof e[d]&&(e[d]=[]);var b;b=function(){return Math.floor(65536*Math.random()).toString(16)};b=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();e[d].push({callback:c,id:b});return b};this.unsubscribe=function(d){if(!d)return!1;var c=-1,b=null,f;for(f in e)for(var g=0;g<e[f].length;g+=1)if(e[f][g].id==d){c=g;
b=f;break}return-1!=c?(e[b].splice(c,1),!0):!1};this.fire=function(d,c,b){if("string"!=typeof d)throw Error("Incorrect fire call");if("undefined"==typeof b||null===b)b={};b.eventName=d;if("undefined"!=typeof e.all)for(var f=0;f<e.all.length;f+=1)e.all[f].callback(c,b);f=function(b,c,f){setTimeout(function(){b(c,f)},0)};if("undefined"!=typeof e[d])for(var g=0;g<e[d].length;g+=1)f(e[d][g].callback,c,b)};this.clearSubscriptions=function(d){if("string"!=typeof d)throw Error("Event Name must be string in EventManager.clearSubscriptions");
e[d]&&(e[d].length=0);return this};this.clearAndSubscribe=function(d,c){this.clearSubscriptions(d);this.subscribe(d,c)};this.dump=function(){console.dir(e)}}})(global);(function(g){g.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"}})(global);
(function(g){g.Appacitive.session=new function(){var e=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},d=null,c=null,b=null,f=null,h=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(){g.Appacitive.session.create(c)};this.create=function(f){c=f=f||{};var h=new e;f.apikey?(h.apikey=f.apikey||"",b=h.apikey):h.apikey=b;h.isnonsliding=f.isnonsliding||h.isnonsliding;h.usagecount=f.usagecount||h.usagecount;h.windowtime=f.windowtime||h.windowtime;
f=new g.Appacitive.HttpRequest;f.url=g.Appacitive.config.apiBaseUrl+"application.svc/session";f.method="put";f.data=h;f.onSuccess=function(b){b&&b.status&&"200"==b.status.code?(d=b.session.sessionkey,g.Appacitive.session.useApiKey=!1,g.Appacitive.eventManager.fire("session.success",{},b),g.Appacitive.session.onSessionCreated()):g.Appacitive.eventManager.fire("session.error",{},b)};g.Appacitive.http.send(f)};g.Appacitive.http.addProcessor({pre:function(c){g.Appacitive.session.useApiKey?c.headers.push({key:"appacitive-apikey",
value:b}):c.headers.push({key:"appacitive-session",value:d});!0===h&&(1==c.headers.filter(function(b){return"appacitive-user-auth"==b.key}).length?c.headers.forEach(function(b){"appacitive-user-auth"==b.key&&(b.value=f)}):c.headers.push({key:"appacitive-user-auth",value:f}))}});this.setUserAuthHeader=function(b,c,d){try{b&&(h=!0,f=b,d||(c||(c=60),-1==c&&(c=null),g.Appacitive.runtime.isBrowser&&(g.Appacitive.Cookie.setCookie("Appacitive-UserToken",b,c),g.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",
c?c:-1,c))))}catch(e){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(b,c){b&&("function"!=typeof b&&"boolean"==typeof b)&&(c=b,b=function(){});h=!1;b=b||function(){};g.Appacitive.localStorage.remove("Appacitive-User");g.Appacitive.runtime.isBrowser&&(g.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),g.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"));if(f&&!c)try{var d=new g.Appacitive.HttpRequest;d.url=g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(f);
f=null;d.method="POST";d.data={};d.onSuccess=function(){"function"==typeof b&&b()};g.Appacitive.http.send(d)}catch(e){}else f=null,"function"==typeof b&&b()};this.isSessionValid=function(b){if(!b)return!0;if(b.status){if(b.status.code&&("8027"==b.status.code||"8002"==b.status.code))return!1}else if(b.code&&("8027"==b.code||"8002"==b.code))return!1;return!0};this.resetSession=function(){d=null;this.useApiKey=!0};this.get=function(){return d};this.setSession=function(b){b&&(d=b,this.useApiKey=!1)};
this.setApiKey=function(c){c&&(b=c,this.useApiKey=!0)};var j="sandbox";this.__defineGetter__("environment",function(){return j});this.__defineSetter__("environment",function(b){"sandbox"!=b&&"live"!=b&&(b="sandbox");j=b})};g.Appacitive.initialize=function(e){g.Appacitive.session.setApiKey(e.apikey||"");g.Appacitive.session.environment=e.env||"";g.Appacitive.useApiKey=!0;if(e.userToken)-1==e.expiry?e.expiry=null:e.expiry||(e.expiry=3600),g.Appacitive.session.setUserAuthHeader(e.userToken,e.expiry),
e.user&&(g.Appacitive.localStorage.set("Appacitive-User",e.user),g.Appacitive.Users.setCurrentUser(e.user));else if(g.Appacitive.runtime.isBrowser&&(e=g.Appacitive.Cookie.readCookie("Appacitive-UserToken"))){var d=g.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");d||(d=60);var c=g.Appacitive.localStorage.get("Appacitive-User");g.Appacitive.Users.setCurrentUser(c,e,d)}}})(global);
(function(g){g.Appacitive&&g.Appacitive.http&&g.Appacitive.http.addProcessor({pre:function(e){e.headers.push({key:"appacitive-environment",value:g.Appacitive.session.environment})}})})(global);
(function(g){g.Appacitive.Queries={};var e=function(b){b=b||{};var c=1,d=200;this.__defineGetter__("pageNumber",function(){return c});this.__defineSetter__("pageNumber",function(b){c=b||1});this.__defineGetter__("pageSize",function(){return d});this.__defineSetter__("pageSize",function(b){d=b||200});this.pageNumber=b.pageNumber;this.pageSize=b.pageSize};e.prototype.toString=function(){return"psize="+this.pageSize+"&pnum="+this.pageNumber};var d=function(b){b=b||{};var c="__UtcLastUpdatedDate",d=!1;
this.__defineGetter__("orderBy",function(){return c});this.__defineSetter__("orderBy",function(b){c=b||"__UtcLastUpdatedDate"});this.__defineGetter__("isAscending",function(){return d});this.__defineSetter__("isAscending",function(b){d="undefined"==typeof b?!1:b});this.orderBy=b.orderBy;this.isAscending=b.isAscending};d.prototype.toString=function(){return"orderBy="+this.orderBy+"&isAsc="+this.isAscending};var c=function(b){var c=b||{},g="",j="",k="",m=b.queryType,l=new e(b),t=new d(b),n=b.schema||
b.relation,p=b.schema?"article":"connection";this.__defineGetter__("type",function(){return p});this.__defineGetter__("entityType",function(){return n});this.__defineGetter__("queryType",function(){return m});this.__defineGetter__("pageQuery",function(){return l});this.__defineGetter__("sortQuery",function(){return t});this.__defineGetter__("filter",function(){return g});this.__defineSetter__("filter",function(b){g=b});this.__defineGetter__("freeText",function(){return j});this.__defineSetter__("freeText",
function(b){"string"==typeof b?j=b:"object"==typeof b&&b.length&&(j=b.join(" "))});this.__defineGetter__("fields",function(){return k});this.__defineSetter__("fields",function(b){"string"==typeof b?k=b:"object"==typeof b&&b.length&&(k=b.join(","))});this.filter=c.filter||"";this.freeText=c.freeText||"";this.fields=c.fields||"";this.setFilter=function(b){this.filter=b};this.setFreeText=function(b){this.freeText=b};this.setFields=function(b){this.fields=b};this.extendOptions=function(b){for(var g in b)c[g]=
b[g];l=new e(c);t=new d(c)};this.getQueryString=function(){var b=this.pageQuery.toString()+"&"+this.sortQuery.toString();this.filter&&0<this.filter.trim().length&&(b+="&query="+this.filter);this.freeText&&0<this.freeText.trim().length&&(b+="&freetext="+this.freeText+"&language=en");this.fields&&0<this.fields.trim().length&&(b+="&fields="+this.fields);return b};this.getOptions=function(){var b={},c;for(c in this)this.hasOwnProperty(c)&&"function"!=typeof this[c]&&(b[c]=this[c]);return b}};g.Appacitive.Queries.BasicFilterQuery=
function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";b=new c(b);b.toRequest=function(){var b=new g.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};b.toUrl=function(){return g.Appacitive.config.apiBaseUrl+this.type+".svc/"+this.entityType+"/find/all?"+this.getQueryString()};return b};g.Appacitive.Queries.ConnectedArticlesQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for connected articles query");
if(!b.articleId)throw Error("Specify articleId for connected articles query");b.schema&&delete b.schema;b.queryType="ConnectedArticlesQuery";var f=new c(b);f.articleId=b.articleId;f.toRequest=function(){var b=new g.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};f.toUrl=function(){return g.Appacitive.config.apiBaseUrl+"connection/"+b.relation+"/"+this.articleId+"/find?"+f.getQueryString()};return f};g.Appacitive.Queries.GetConnectionsQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsQuery query");
if(!b.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!b.label||0==b.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");b.schema&&delete b.schema;b.queryType="GetConnectionsQuery";var f=new c(b);f.articleId=b.articleId;f.label=b.label;f.toRequest=function(){var b=new g.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};f.toUrl=function(){return g.Appacitive.config.apiBaseUrl+"connection/"+b.relation+"/find/all?articleid="+this.articleId+
"&label="+this.label+f.getQueryString()};return f};g.Appacitive.Queries.GraphQuery=function(b){b=b||{};if(!b.graphQuery)throw Error("graphQuery object is mandatory");this.toRequest=function(){var c=new g.Appacitive.HttpRequest;c.url=g.Appacitive.config.apiBaseUrl;c.url+=g.Appacitive.storage.urlFactory.article.getProjectionQueryUrl();c.method="post";c.data=b.graphQuery;return c}}})(global);
(function(g){g.Appacitive.BaseObject=function(e,d){var c={},b=e=e||{};if(d)for(var f in b)if("string"==typeof b[f]||"number"==typeof b[f])c[f]=b[f];else if("object"==typeof b[f]){c[f]=0<=b[f].length?[]:{};for(var h in b[f])c[f][h]=b[f][h]}else c[f]=obj[f];!c.__id&&e.__id&&(c.__id=e.__id);e.__schematype?(e.__schematype=e.__schematype.toLowerCase(),this.entityType=e.__schematype,this.type="user"==e.__schematype||"device"==e.__schematype?e.__schematype:"article"):e.__relationtype&&(e.__relationtype=
e.__relationtype.toLowerCase(),this.entityType=e.__relationtype,this.type="connection");var j=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500"},k=function(c){for(var f in c)if("string"==typeof c[f])b[f]=c[f];else if("object"==typeof c[f]){b[f]=0<=c[f].length?[]:{};for(var d in c[f])b[f][d]=c[f][d]}else b[f]=c[f]};this.getObject=function(){return b};this.toJSON=function(){return b};this.attributes=function(){if(0===arguments.length)return b.__attributes||(b.__attributes=
{}),b.__attributes;if(1==arguments.length)return b.__attributes||(b.__attributes={}),b.__attributes[arguments[0]];if(2==arguments.length){if("string"!==typeof arguments[1])throw Error("only string values can be stored in attributes.");b.__attributes||(b.__attributes={});b.__attributes[arguments[0]]=arguments[1]}else throw Error(".attributes() called with an incorrect number of arguments. 0, 1, 2 are supported.");};this.aggregates=function(){var c={},f;for(f in b){if(!b.hasOwnProperty(f))return;"$"==
f[0]&&(c[f]=b[f])}if(0===arguments.length)return c;if(1==arguments.length)return c[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};var m=[];this.__defineGetter__("tags",function(){return!b.__tags?[]:b.__tags});this.addTags=function(c){c&&("string"==typeof c&&c.length)&&(b.__tags.push(c),b.__tags=Array.distinct(b.__tags),m&&m.length&&(c=m.indexOf(c),-1!=c&&m.splice(c,1)))};this.removeTags=function(c){c&&("string"==typeof c&&c.length)&&
(m.push(c),m=Array.distinct(m),b.__tags&&b.__tags.length&&(c=b.__tags.indexOf(c),-1!=c&&b.__tags.splice(c,1)))};this.get=function(c){if(c)return b[c]};this.set=function(c,f){if(!c||"string"!=typeof c||0==c.length)return f;null==f||"undefined"==f?b[c]=null:"string"==typeof f?b[c]=f:"number"==typeof f?b[c]=f+"":"object"==typeof f&&0<=f.length&&(b[c]=f);return f};this.copy=function(b){b&&k(b)};this.save=function(c,f){b.__id?t.apply(this,arguments):l.apply(this,arguments)};var l=function(f,d){f=f||function(){};
d=d||function(){};var e=this,h=g.Appacitive.config.apiBaseUrl+g.Appacitive.storage.urlFactory[this.type].getCreateUrl(b.__schematype||b.__relationtype);if(b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))h=g.Appacitive.config.apiBaseUrl+g.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getCreateUrl();var m=new g.Appacitive.HttpRequest;m.url=h;m.method="put";b.__revision&&delete b.__revision;m.data=b;m.onSuccess=function(g){var h=null;if(g&&
(g.article||g.connection||g.user||g.device))h=g.article||g.connection||g.user||g.device;g&&h?(c=h,b.__id=h.__id,k(h),e.connectionCollections&&0<e.connectionCollections.length&&e.connectionCollections.forEach(function(c){c.getQuery().extendOptions({articleId:b.__id})}),"connection"==e.type&&e.parseConnection(),Appacitive.eventManager.fire((e.__schematype||e.__relationtype)+"."+e.type+".created","base",{object:e}),"function"==typeof f&&f(e)):(g=g||{},g.status=g.status||{},g.status=j(g.status),Appacitive.eventManager.fire((e.__schematype||
e.__relationtype)+"."+e.type+".createFailed","base",{error:g.status}),"function"==typeof d&&d(g.status,e))};m.onError=function(b){b=j(b);"function"==typeof d&&d(b,e)};g.Appacitive.http.send(m)},t=function(f,d){f=f||function(){};d=d||function(){};var e=!1,h=JSON.parse(JSON.stringify(c)),l;for(l in b)"undefined"==typeof b[l]||null===b[l]?(h[l]=null,e=!0):b[l]!=c[l]?(h[l]=b[l],e=!0):b[l]==c[l]&&delete h[l];try{h.__revision&&delete h.__revision,h.__endpointa&&delete h.__endpointa,h.__endpointb&&delete h.__endpointb,
h.__createdby&&delete h.__createdby,h.__lastmodifiedby&&delete h.__lastmodifiedby,h.__schematype&&delete h.__schematype,h.__relationtype&&delete h.__relationtype,h.__utcdatecreated&&delete h.__utcdatecreated,h.__utclastupdateddate&&delete h.__utclastupdateddate,h.__tags&&delete h.__tags}catch(t){}b.__tags&&0<b.__tags.length&&(h.__addtags=b.__tags);m&&0<m.length&&(h.__removetags=m);var r=this;if(e){e=new g.Appacitive.HttpRequest;l=g.Appacitive.config.apiBaseUrl+g.Appacitive.storage.urlFactory[this.type].getUpdateUrl(b.__schematype||
b.__relationtype,c.__id?c.__id:b.__id);if(b&&b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))l=g.Appacitive.config.apiBaseUrl+g.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getUpdateUrl(c.__id);e.url=l;e.method="post";e.data=h;e.onSuccess=function(e){e&&(e.article||e.connection||e.user||e.device)?(c=e.article||e.connection||e.user||e.device,k(c),Appacitive.eventManager.fire(r.type+"."+b.__id+".updated","base",{object:r}),"function"==typeof f&&
f(r)):(e=e||{},e.status=e.status||{},e.status=j(e.status),Appacitive.eventManager.fire(r.type+"."+b.__id+".updateFailed","base",{object:e.status}),"function"==typeof d&&d(e.status,r))};e.onError=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";"function"==typeof d&&d(b,r)};g.Appacitive.http.send(e)}else"function"==typeof f&&f(r)};this.fetch=function(f,d){f=f||function(){};d=d||function(){};if(b.__id){var e=this,h=g.Appacitive.config.apiBaseUrl+g.Appacitive.storage.urlFactory[this.type].getGetUrl(b.__schematype||
b.__relationtype,b.__id),m=new g.Appacitive.HttpRequest;m.url=h;m.method="get";m.onSuccess=function(b){b&&(b.article||b.connection||b.user||b.device)?(c=b.article||b.connection||b.user||b.device,k(c),e.___collection&&"article"==e.___collection.collectionType&&e.___collection.addToCollection(e),"function"==typeof f&&f(e)):(b=b||{},b.status=b.status||{},b.status=j(b),"function"==typeof d&&d(b.status,e))};m.onError=function(b){b=j(b);"function"==typeof d&&d(b,e)};g.Appacitive.http.send(m)}else"function"==
typeof d&&d({code:"400",message:"Please specify id for get operation"},this)};this.del=function(c,f,d){if(!b.__id&&this.___collection)this.___collection.removeByCId(this.__cid),"function"==typeof c&&c(this);else{c=c||function(){};f=f||function(){};d=d||{};var e=this,h=g.Appacitive.config.apiBaseUrl,h=h+g.Appacitive.storage.urlFactory[this.type].getDeleteUrl(b.__schematype||b.__relationtype,b.__id);if(b&&b.__schematype&&("user"==b.__schematype.toLowerCase()||"device"==b.__schematype.toLowerCase()))h=
g.Appacitive.config.apiBaseUrl,h+=g.Appacitive.storage.urlFactory[b.__schematype.toLowerCase()].getDeleteUrl(b.__id);d.deleteConnections&&!0===d.deleteConnections&&(h=-1==h.indexOf("?")?h+"?deleteconnections=true":h+"&deleteconnections=true");d=new g.Appacitive.HttpRequest;d.url=h;d.method="delete";d.onSuccess=function(d){"200"==d.code?(e.___collection&&e.___collection.removeById(b.__id),"function"==typeof c&&c(d)):(d=j(d),"function"==typeof f&&f(d,e))};d.onError=function(b){b=j(b);"function"==typeof f&&
f(b,e)};g.Appacitive.http.send(d)}}};g.Appacitive.BaseObject.prototype.toString=function(){return JSON.stringify(this.getObject())}})(global);
(function(g){var e=function(){return Math.floor(65536*Math.random()).toString(16)};g.Appacitive.GUID=function(){var d=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),c="",b,f,g,j,k,m,l=0,d=d.replace(/\r\n/g,"\n");f="";for(g=0;g<d.length;g++)j=d.charCodeAt(g),128>j?f+=String.fromCharCode(j):(127<j&&2048>j?f+=String.fromCharCode(j>>6|192):(f+=String.fromCharCode(j>>12|224),f+=String.fromCharCode(j>>6&63|128)),f+=String.fromCharCode(j&63|128));for(d=f;l<d.length;)b=d.charCodeAt(l++),f=d.charCodeAt(l++),
g=d.charCodeAt(l++),j=b>>2,b=(b&3)<<4|f>>4,k=(f&15)<<2|g>>6,m=g&63,isNaN(f)?k=m=64:isNaN(g)&&(m=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m);return c.toString()}})(global);
(function(g){g.Appacitive.ArticleCollection=function(e){var d=null,c=null,b=[],f=e;this.collectionType="article";if(!e||!e.schema)throw Error("Must provide schema while initializing ArticleCollection.");var d=e.schema,h=this,j=function(b){b.type="article";b.schema?d=b.schema:b.schema=d;c=new g.Appacitive.Queries.BasicFilterQuery(b);f=b;h.extendOptions=c.extendOptions};this.setFilter=function(b){f.filter=b;f.type="article";c?c.filter=b:(c=new g.Appacitive.Queries.BasicFilterQuery(f),h.extendOptions=
c.extendOptions)};this.setFreeText=function(b){!b&&0==b.trim().length&&(f.freeText="");f.freeText=b;f.type="article";c?c.freeText=b:(c=new g.Appacitive.Queries.BasicFilterQuery(f),h.extendOptions=c.extendOptions)};this.setFields=function(b){b||(f.fields="");f.fields=b;f.type="article";c?c.fields=b:(c=new g.Appacitive.Queries.BasicFilterQuery(f),h.extendOptions=c.extendOptions)};this.reset=function(){d=f=null;b.length=0;c=null};this.__defineGetter__("query",function(){return c});this.getQuery=function(){return c};
this.__defineSetter__("query",function(f){if(!f||!f.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");if("BasicFilterQuery"!==f.type)throw Error("ArticleCollection only accepts BasicFilterQuery");b.length=0;c=f});this.setQuery=function(f){if(!f||!f.toRequest)throw Error("Invalid  appacitive query passed to articleCollection");b.length=0;c=f};this.setOptions=j;j(e);this.get=function(c){if(c!=parseInt(c,10))return null;c=parseInt(c,10);return"number"!=typeof c||c>=b.length?
null:b.slice(c,c+1)[0]};this.addToCollection=function(c){if(!c||c.get("__schematype")!=d)throw Error("Null article passed or schema type mismatch");var f=null;b.forEach(function(b,d){b.get("__id")==c.get("__id")&&(f=d)});0!=f?b.splice(f,1):b.push(c)};this.getArticleById=function(c,f,d){f=f||function(){};d=d||function(){};var e=b.filter(function(b){return b.get("__id")==c});1==e.length?f(Array.prototype.slice.call(e)[0]):d()};this.getAll=function(){return Array.prototype.slice.call(b)};this.getAllArticles=
function(){return Array.prototype.slice.call(b).map(function(b){return b.getArticle()})};this.removeById=function(c){if(!c)return!1;var f=null;b.forEach(function(b,d){b.getArticle().__id&&b.getArticle().__id==c&&(f=d)});return null!==f?(b.splice(f,1),!0):!1};this.removeByCId=function(c){if(!c)return!1;var f=null;b.forEach(function(b,d){b.__cid&&b.__cid==c&&(f=d)});return null!==f?(b.splice(f,1),!0):!1};this.fetch=function(f,d){f=f||function(){};d=d||function(){};b.length=0;var e=c.toRequest();e.onSuccess=
function(c){var e=f,j=c.articles;if(j){if(!j.length||0===j.length)j=[];j.forEach(function(c){c=new g.Appacitive.Article(c,!0);c.___collection=h;b.push(c)});e(c.paginginfo||{})}else d(c.status)};g.Appacitive.http.send(e)};this.fetchByPageNumber=function(b,f,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(b,f)};this.fetchNextPage=function(b,f){c.getOptions().pageQuery.pageNumber+=1;this.fetch(b,f)};this.fetchPreviousPage=function(b,f){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&
(d.pageNumber=1);this.fetch(b,f)};this.createNewArticle=function(c){c=c||{};c.__schematype=d;c=new g.Appacitive.Article(c);c.___collection=h;c.__cid=parseInt(1E6*Math.random(),10);b.push(c);return c};this.map=function(){return b.map.apply(this,arguments)};this.forEach=function(){return b.forEach.apply(this,arguments)};this.filter=function(){return b.filter.apply(this,arguments)}};g.Appacitive.ArticleCollection.prototype.toString=function(){return JSON.stringify(this.getAllArticles())};g.Appacitive.ArticleCollection.prototype.toJSON=
function(){return this.getAllArticles()};g.Appacitive.ArticleCollection.prototype.__defineGetter__("articles",function(){return this.getAll()})})(global);
(function(g){g.Appacitive.ConnectionCollection=function(e){var d=null,c=null,b=[],f=[],h=e;this.collectionType="connection";if(!e||!e.relation)throw Error("Must provide relation while initializing ConnectionCollection.");var d=e.relation,j=function(b){b.type="connection";b.relation?d=b.relation:b.relation=d;c=new g.Appacitive.Queries.BasicFilterQuery(b);h=b};this.setFilter=function(b){h.filter=b;h.type="connection";c?c.filter=b:(c=new g.Appacitive.Queries.BasicFilterQuery(h),k.extendOptions=c.extendOptions)};
this.setFreeText=function(b){!b&&0==b.trim().length&&(h.freeText="");h.freeText=b;h.type="connection";c?c.freeText=b:(c=new g.Appacitive.Queries.BasicFilterQuery(h),k.extendOptions=c.extendOptions)};this.setFields=function(b){b||(h.fields="");h.fields=b;h.type="connection";c?c.fields=b:(c=new g.Appacitive.Queries.BasicFilterQuery(h),k.extendOptions=c.extendOptions)};this.__defineGetter__("query",function(){return c});this.getQuery=function(){return c};this.__defineSetter__("query",function(d){if(!d||
!d.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");f.length=0;b.length=0;c=d});this.setQuery=function(d){if(!d||!d.toRequest)throw Error("Invalid  appacitive query passed to connectionCollection");f.length=0;b.length=0;c=d};this.reset=function(){d=h=null;f.length=0;b.length=0;c=null};this.setOptions=j;j(e);this.get=function(c){if(c!=parseInt(c,10))return null;c=parseInt(c,10);return"number"!=typeof c||c>=b.length?null:b.slice(c,c+1)[0]};this.addToCollection=function(c){if(!c||
c.get("__relationtype")!=d)throw Error("Null connection passed or relation type mismatch");var f=null;b.forEach(function(b,d){b.get("__id")==c.get("__id")&&(f=d)});null!==f?b.splice(f,1):b.push(c)};this.getConnection=function(c,f,d){f=f||function(){};d=d||function(){};var e=b.filter(function(b){return b.get("__id")==c});1==e.length?f(Array.prototype.slice.call(e)[0]):d()};this.getAll=function(){return Array.prototype.slice.call(b)};this.getAllConnections=function(){return Array.prototype.slice.call(b).map(function(b){return b.getConnection()})};
this.removeById=function(c){if(!c)return!1;var f=null;b.forEach(function(b,d){b.getConnection().__id&&b.getConnection().__id==c&&(f=d)});return null!==f?(b.splice(f,1),!0):!1};this.removeByCId=function(c){if(!c)return!1;var f=null;b.forEach(function(b,d){b.__cid&&b.__cid==c&&(f=d)});return null!==f?(b.splice(f,1),!0):!1};var k=this;this.getConnectedArticle=function(b){if(!f||0===f.length)return null;var c=f.filter(function(c){return c.get("__id")==b});return 0<c.length?c[0]:null};this.fetch=function(d,
e){d=d||function(){};e=e||function(){};b.length=0;var h=c.toRequest();h.onSuccess=function(c){a:{var h=d;c=c||{};var j=c.connections;if(!j)if(c.status&&c.status.code&&"200"==c.status.code)j=[];else{e(c.status);break a}if(!j.length||0===j.length)j=[];j.forEach(function(c){c=new g.Appacitive.Connection(c,!0);c.___collection=k;if(c.endpointA.article||c.endpointB.article){var d=c.endpointA.article||c.endpointB.article;d.___collection=k;f.push(d)}try{c.___collection.connectedArticle||delete c.connectedArticle}catch(e){}b.push(c)});
h(c.paginginfo||{})}};g.Appacitive.http.send(h)};this.fetchByPageNumber=function(b,f,d){c.getOptions().pageQuery.pageNumber=d;this.fetch(b,f)};this.fetchNextPage=function(b,f){c.getOptions().pageQuery.pageNumber+=1;this.fetch(b,f)};this.fetchPreviousPage=function(b,f){var d=c.getOptions().pageQuery;d.pageNumber-=1;0===d.pageNumber&&(d.pageNumber=1);this.fetch(b,f)};this.createNewConnection=function(c){c=c||{};c.__relationtype=d;c=new g.Appacitive.Connection(c);c.___collection=k;c.__cid=parseInt(1E6*
Math.random(),10);b.push(c);return c};this.map=function(){return b.map.apply(this,arguments)};this.forEach=function(c,f){return b.forEach(c,f||this)};this.filter=function(){return b.filter.apply(this,arguments)}}})(global);
(function(g){var e=function(d,c){d=d||function(){};c=c||function(){};var b=new g.Appacitive.HttpRequest;b.method="get";b.url=g.Appacitive.config.apiBaseUrl+g.Appacitive.storage.urlFactory.user.getGetAllLinkedAccountsUrl(this.get("__id"));b.onSuccess=function(b){var e=null;b&&(b.identities&&0<b.identities.length)&&(b=b.identities.filter(function(b){return"facebook"==b.authtype.toLowerCase()}),1==b.length&&(e=b[0].username));null!==e?FB.api("/"+e,function(b){b?d(b):c()}):c()};b.onError=function(){c()};
g.Appacitive.http.send(b)};g.Appacitive.Article=function(d,c){if(!d.__schematype&&!d.schema)throw new error("Cannot set article without __schematype");d.schema&&(d.__schematype=d.schema,delete d.schema);var b=new g.Appacitive.BaseObject(d,c);b.type="article";b.connectionCollections=[];b.getArticle=b.getObject;b.get("__schematype")&&"user"==b.get("__schematype").toLowerCase()&&(b.getFacebookProfile=e);b.getConnectedArticles=function(b){if("article"!=this.type)return null;b=b||{};b.articleId=this.get("__id");
var c=new g.Appacitive.ConnectionCollection({relation:b.relation});c.connectedArticle=this;this.connectionCollections.push(c);c.query=new g.Appacitive.Queries.ConnectedArticlesQuery(b);return c};b.getConnections=function(b){if("article"!=this.type)return null;b=b||{};b.articleId=this.get("__id");var c=new g.Appacitive.ConnectionCollection({relation:b.relation});this.connectionCollections.push(c);c.query=new g.Appacitive.Queries.GetConnectionsQuery(b);return c};return b};g.Appacitive.Article.multiDelete=
function(d,c,b,f){if(!d)throw Error("Specify schemaName");if("user"==d.toLowerCase()||"device"==d.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(0<c.length){b=b||function(){};f=f||function(){};var e=new g.Appacitive.HttpRequest;e.url=g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiDeleteUrl(d);e.method="post";e.data={idlist:c};e.onSuccess=function(c){c&&"200"==c.code?"function"==typeof b&&b():(c=c||{},"function"==typeof f&&f(c.status||
{message:"Server error",code:400}))};e.onError=function(b){b=b||{};"function"==typeof f&&f(b.status||{message:"Server error",code:400})};g.Appacitive.http.send(e)}else b()};g.Appacitive.Article.multiGet=function(d,c,b,f){if(!d)throw Error("Specify schemaName");if("user"==d.toLowerCase()||"device"==d.toLowerCase())throw Error("Cannot multiget user and devices using multidelete");if("object"==typeof c&&0<c.length){var e=new g.Appacitive.HttpRequest;e.url=g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.article.getMultiGetUrl(d,
c.join(","));e.method="get";e.onSuccess=function(c){if(c&&c.articles){if("function"==typeof b){var d=[];c.articles.forEach(function(b){d.push(new g.Appacitive.Article(b))});b(d)}}else c=c||{},"function"==typeof f&&f(c.status||{message:"Server error",code:400})};e.onError=function(b){b=b||{};"function"==typeof f&&f(b.status||{message:"Server error",code:400})};g.Appacitive.http.send(e)}else b([])}})(global);
(function(g){var e=function(c,b,f){var d={label:c.label};c.articleid&&(d.articleid=c.articleid);if(c.article)"function"==typeof c.article.getArticle?c.article.get("__id")?d.articleid=c.article.get("__id"):d.article=c.article.getArticle():"object"==typeof c.article&&c.article.__schematype&&(c.article.__id?d.articleid=c.article.__id:d.article=c.article,c.article=new Appacitive.Article(c.article));else if(!d.articleid&&!d.article)throw Error("Incorrectly configured endpoints provided to setupConnection");
f["endpoint"+b]=c;return d},d=function(c,b,f){f.get("__endpoint"+b.toLowerCase()).article&&"object"==typeof f.get("__endpoint"+b.toLowerCase()).article?(f["endpoint"+b]?f["endpoint"+b]&&f["endpoint"+b].article&&f["endpoint"+b].article.getArticle?f["endpoint"+b].article.copy(f.get("__endpointb").article):f["endpoint"+b].article=new g.Appacitive.Article(f.get("__endpoint"+b.toLowerCase()).article):(f["endpoint"+b]={},f["endpoint"+b].article=new g.Appacitive.Article(f.get("__endpoint"+b.toLowerCase()).article)),
f["endpoint"+b].articleid=f.get("__endpoint"+b.toLowerCase()).articleid,f["endpoint"+b].label=f.get("__endpoint"+b.toLowerCase()).label,f["endpoint"+b].type=f.get("__endpoint"+b.toLowerCase()).type,f["endpoint"+b].article.___collection=f.___collection,delete f.get("__endpoint"+b.toLowerCase()).article):f["endpoint"+b]=f.get("__endpoint"+b.toLowerCase())};g.Appacitive.Connection=function(c,b){if(!c.__relationtype&&!c.relation)throw new error("Cannot set connection without relation");c.relation&&(c.__relationtype=
c.relation,delete c.relation);c.endpoints&&2==c.endpoints.length&&(c.__endpointa=c.endpoints[0],c.__endpointb=c.endpoints[1],delete c.endpoints);var f=new g.Appacitive.BaseObject(c);f.type="connection";f.getConnection=f.getObject;f.setupConnection=function(b,c){if(!b||!b.articleid&&!b.article||!b.label||!c||!c.articleid&&!c.article||!c.label)throw Error("Incorrect endpoints configuration passed.");f.set("__endpointa",e(b,"A",f));f.set("__endpointb",e(c,"B",f))};f.parseConnection=function(){var b=
"A",e="B";c.__endpointa.label==this.get("__endpointb").label&&c.__endpointa.articleid==this.get("__endpointb").articleid&&(b="B",e="A");d(this.get("__endpointa"),b,f);d(this.get("__endpointb"),e,f);f.__defineGetter__("endpoints",function(){var b=[];b.push(this.endpointA);b.push(this.endpointB);return b});return f};b?(f.__defineGetter__("connectedArticle",function(){if(!f.___collection.connectedArticle)throw Error("connectedArticle can be accessed only by using the getConnectedArticles call");var b=
f.___collection.connectedArticle.get("__id");if(!b)return null;var c=f.getConnection().__endpointa.articleid;f.getConnection().__endpointa.articleid==b&&(c=f.getConnection().__endpointb.articleid);return f.___collection.getConnectedArticle(c)}),f.parseConnection()):c.__endpointa&&c.__endpointb&&f.setupConnection(f.get("__endpointa"),f.get("__endpointb"));return f};g.Appacitive.Connection.multiDelete=function(c,b,f,d){if(!c)throw Error("Specify relationName");if(0<b.length){var e=new g.Appacitive.HttpRequest;
e.url=g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiDeleteUrl(c);e.method="post";e.data={idlist:b};e.onSuccess=function(b){b&&"200"==b.code?f():(b=b||{},d(b||{message:"Server error",code:400}))};e.onError=function(b){b=b||{};d(b||{message:"Server error",code:400})};g.Appacitive.http.send(e)}else f()};g.Appacitive.Connection.multiGet=function(c,b,d,e){if(!c)throw Error("Specify schemaName");if("object"==typeof b&&0<b.length){var j=new g.Appacitive.HttpRequest;j.url=
g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.connection.getMultiGetUrl(c,b.join(","));j.method="get";j.onSuccess=function(b){if(b&&b.connections){if("function"==typeof d){var c=[];b.connections.forEach(function(){c.push(new g.Appacitive.Connection(a))});d(c)}}else b=b||{},"function"==typeof e&&e(b.status||{message:"Server error",code:400})};j.onError=function(b){b=b||{};"function"==typeof e&&e(b.status||{message:"Server error",code:400})};g.Appacitive.http.send(j)}else d([])}})(global);
(function(g){g.Appacitive.Users=new function(){var e=null;this.__defineGetter__("currentUser",function(){return e});this.setCurrentUser=function(d,c,b){if(!d||"object"!=typeof d)throw Error("Cannot set null object as user");var f=d;d.getArticle||(f=new Appacitive.User(d));if(!f.get("__id")||0==f.get("__id").length)throw Error("Specify user __id");g.Appacitive.localStorage.set("Appacitive-User",d);b||(b=60);e=f;c&&Appacitive.session.setUserAuthHeader(c,b);e.logout=function(b){Appacitive.Users.logout(b)};
Appacitive.eventManager.clearAndSubscribe("user."+f.get("__id")+".updated",function(b,c){g.Appacitive.localStorage.set("Appacitive-User",c.object.getArticle())})};g.Appacitive.User=function(d){d.__schematype="user";return new g.Appacitive.Article(d,!0)};this.deleteUser=function(d,c,b){if(!d)throw Error("Specify userid for user delete");(new Appacitive.Article({__schematype:"user",__id:d})).del(c||function(){},b||function(){})};this.deleteCurrentUser=function(d,c){d=d||function(){};if(null===e)throw Error("Current user is not yet set for delete operation");
var b=e.get("__id");this.deleteUser(b,function(b){g.Appacitive.session.removeUserAuthHeader();"function"==typeof d&&d(b)},c)};this.createUser=this.createNewUser=function(d,c,b){d=d||{};d.__schematype="user";if(!d.username||!d.password||!d.firstname||0==d.username.length||0==d.password.length||0==d.firstname.length)throw Error("username, password and firstname are mandatory");var f=new Appacitive.Article(d);d.type="user";f.save(c,b)};this.signup=function(d,c,b){var f=this;this.createUser(d,function(){f.login(d.username,
d.password,c,b)},function(c){b(c)})};this.authenticateUser=function(d,c,b){c=c||function(){};b=b||function(){};d.expiry||(d.expiry=-1);var f=this,e=new g.Appacitive.HttpRequest;e.method="post";e.url=g.Appacitive.config.apiBaseUrl+g.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();e.data=d;e.onSuccess=function(e){e&&e.user?(f.setCurrentUser(e.user,e.token,d.expiry),c({user:f.currentUser,token:e.token})):(e=e||{},b(e.status))};e.onError=b;g.Appacitive.http.send(e)};this.login=function(d,
c,b,f){if(!d||!c||0==d.length||0==c.length)throw Error("Please specify username and password");this.authenticateUser({username:d,password:c,expiry:-1},b||function(){},f||function(){})};this.authenticateWithFacebook=this.signupWithFacebook=function(d,c){d=d||function(){};c=c||function(){};var b=this;FB?FB.api("/me",function(){var f={accesstoken:g.Appacitive.facebook.accessToken,type:"facebook",expiry:-1,createnew:!0},e=new g.Appacitive.HttpRequest;e.url=g.Appacitive.config.apiBaseUrl+g.Appacitive.storage.urlFactory.user.getAuthenticateUserUrl();
e.method="post";e.data=f;e.onSuccess=function(f){f.user?(b.setCurrentUser(f.user,f.token,120),d({user:b.currentUser,token:f.token})):(data=data||{},c(data))};e.onError=c;g.Appacitive.http.send(e)}):c()};this.validateCurrentUser=function(d,c){d&&("function"!=typeof d&&"boolean"==typeof d)&&(c=d,d=function(){});var b=g.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(!b)return"function"==typeof d&&d(!1),!1;if(c)return"function"==typeof d&&d(!0),!0;try{var f=new g.Appacitive.HttpRequest;f.url=
g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.user.getValidateTokenUrl(b);f.method="POST";f.data={};f.onSuccess=function(b){"function"==typeof d&&d(b.result)};g.Appacitive.http.send(f)}catch(e){d(!1)}};this.logout=function(d,c){e=null;g.Appacitive.session.removeUserAuthHeader(d||function(){},c)}}})(global);
(function(g){g.Appacitive.email=new function(){var e={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return e};var d=function(c,b,d){var e=new g.Appacitive.HttpRequest;e.url=g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.email.getSendEmailUrl();e.method="post";e.data=c;e.onSuccess=function(c){c&&c.status&&"200"==c.status.code?b(c.email):(c=c||{},c.status=c.status||{},d(c.status.message||"Server error"))};
g.Appacitive.http.send(e)};this.setupEmail=function(c){c=c||{};e.smtp.username=c.username||e.smtp.username;e.from=c.from||e.from;e.smtp.password=c.password||e.smtp.password;e.smtp.host=c.smtp.host||e.smtp.host;e.smtp.port=c.smtp.port||e.smtp.port;e.smtp.enablessl=c.enableSSL||e.smtp.enablessl;e.replyto=c.replyTo||e.replyto};this.sendTemplatedEmail=function(c,b,f){b=b||function(){};f=f||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");
if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");if(!c.templateName)throw Error("template name is mandatory to send an email");var g={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{templatename:c.templateName||"",data:c.data||{},ishtml:!1==c.isHtml?!1:!0}};if(c.useConfig){g.smtp=e.smtp;if(!c.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");
g.from=c.from||e.from;g.replyto=c.replyTo||e.replyto}d(g,b,f)};this.sendRawEmail=function(c,b,f){b=b||function(){};f=f||function(){};if(!c||!c.to||!c.to.length||0==c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0==c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.body)throw Error("body is mandatory to send an email");var g={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,body:{content:c.body||"",ishtml:!1==c.isHtml?
!1:!0}};if(c.useConfig){g.smtp=e.smtp;if(!c.from&&!e.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=c.from||e.from;g.replyto=c.replyTo||e.replyto}d(g,b,f)}}})(global);
(function(g){var e=function(){var d=require("facebook-node-sdk"),c=null;this.FB=null;this.initialize=function(b,c){if(!b)throw Error("Please provide appid");if(!c)throw Error("Please provide app secret");this.FB=new d({appId:b,secret:c})};this.requestLogin=function(b,d,e){this.FB?(c=accesstoken,FB.setAccessToken(b)):e("Intialize facebook with your appid and appsecret")};this.getCurrentUserInfo=function(b,d){this.FB&&c?(b=b||function(){},d=d||function(){},this.FB.api("/me",function(c,e){e?b(e):d("Access token is invalid")})):
d("Either intialize facebook with your appid and appsecret or set accesstoken")};this.__defineGetter__("accessToken",function(){return c});this.__defineSetter__("accessToken",function(b){console.log(b);c=b;this.FB&&this.FB.setAccessToken(b)});this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"}};g.Appacitive.facebook=g.Appacitive.runtime.isBrowser?new function(){var d=null;this.requestLogin=function(c,b){c=c||function(){};b=b||function(){};FB?FB.login(function(e){e.authResponse?
(d=e.authResponse.accessToken,c(e.authResponse)):b()},{scope:"email,user_birthday"}):b()};this.getCurrentUserInfo=function(c,b){c=c||function(){};b=b||function(){};FB.api("/me",function(d){d?c(d):b()})};this.__defineGetter__("accessToken",function(){return d});this.__defineSetter__("accessToken",function(c){d=c});this.getProfilePictureUrl=function(c){return"https://graph.facebook.com/"+c+"/picture"};this.logout=function(c,b){c=c||function(){};b=b||function(){};Appacitive.facebook.accessToken="";try{FB.logout(function(){Appacitive.Users.logout();
c()})}catch(d){b(d.message)}}}:new e})(global);
(function(g){g.Appacitive.push=new function(){this.send=function(e,d,c){d=d||function(){};c=c||function(){};if(!e)throw Error("Please specify push options");var b=new g.Appacitive.HttpRequest;b.url=g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getPushUrl();b.method="post";b.data=e;b.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.id):(b=b||{},b.status=b.status||{},c(b.status.message||"Server error"))};b.onError=function(b){c(b||"Server error")};g.Appacitive.http.send(b)};
this.getNotification=function(e,d,c){d=d||function(){};c=c||function(){};if(!e)throw Error("Please specify notification id");var b=new g.Appacitive.HttpRequest;b.url=g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetNotificationUrl(e);b.method="get";b.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.pushnotification):(b=b||{},b.status=b.status||{},c(b.status.message||"Server error"))};b.onError=function(b){c(b||"Server error")};g.Appacitive.http.send(b)};this.getAllNotifications=
function(e,d,c){d=d||function(){};c=c||function(){};e?(e.pnum=e.pnum||1,e.psize=e.psize||20):e={pnum:1,psize:20};var b=new g.Appacitive.HttpRequest;b.url=g.Appacitive.config.apiBaseUrl+Appacitive.storage.urlFactory.push.getGetAllNotificationsUrl(e);b.method="get";b.onSuccess=function(b){b&&b.status&&"200"==b.status.code?d(b.pushnotifications,b.paginginfo):(b=b||{},b.status=b.status||{},c(b.status.message||"Server error"))};b.onError=function(b){c(b||"Server error")};g.Appacitive.http.send(b)}}})(global);
(function(g){g.Appacitive.parseISODate=function(e){try{var d=new Date(e);if(isNaN(d)){if(/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(e)){var c=e.split("T"),b=c[0].split("-"),f=c[1].split("Z")[0].split(":"),g=f[2].split("."),j=Number(f[0]),d=new Date;d.setUTCFullYear(Number(b[0]));d.setUTCMonth(Number(b[1])-1);d.setUTCDate(Number(b[2]));d.setUTCHours(Number(j));d.setUTCMinutes(Number(f[1]));d.setUTCSeconds(Number(g[0]));g[1]&&d.setUTCMilliseconds(Number(g[1]));
return d}return null}return d}catch(k){return null}};g.Appacitive.toISOString=function(e){try{return e=e.toISOString(),e.indexOf("Z"),e=replace("Z","0000Z")}catch(d){return null}}})(global);
(function(g){g.Appacitive.localStorage=new function(){var e=window.localStorage||{};this.set=function(d,c){c=c||"";if(!d)return!1;if("object"==typeof c)try{c=JSON.stringify(c)}catch(b){}e[d]=c;return!0};this.get=function(d){if(!d)return null;d=e.getItem(d);if(!d)return null;if("{"==d[0])try{d=JSON.parse(d)}catch(c){}return d};this.remove=function(d){if(d)try{delete e[d]}catch(c){}}}})(global);
(function(g){g.Appacitive.runtime.isBrowser&&(g.Appacitive.Cookie=new function(){this.setCookie=function(e,d,c,b){if(c){var f=new Date;f.setTime(f.getTime()+6E4*c);f="; expires="+f.toGMTString()}b||(f="");document.cookie=e+"="+d+f+"; path=/"};this.readCookie=function(e){e+="=";for(var d=document.cookie.split(";"),c=0;c<d.length;c++){for(var b=d[c];" "==b.charAt(0);)b=b.substring(1,b.length);if(0==b.indexOf(e))return b.substring(e.length,b.length)}return null};this.eraseCookie=function(e){this.setCookie(e,
"",-1,!0)}})})(global);"undefined"!=typeof module&&(module.exports=function(g){global.Appacitive.initialize({apikey:g});return global.Appacitive});