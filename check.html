<!DOCTYPE html>
<html>
<head >
    <title>SignalR Client</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="jquery.signalR.js"></script>
</head>
<body>
	<input type="text" id = "txtUrl"  placeholder="url to connect" style="width:300px;"/>
	<input type="button" id = "btnConnect" value="Connect"/>
	<input type="button" id = "btnSend" value="Send Data" disabled="disabled"/>
	<br>
	<div id="divConnecting"></div>
	<script type="text/javascript">
		$(function () {
			var url = "";
			$('#btnConnect').click(function() {
				if ($('#txtUrl').val().trim() == '') {
					alert("enter url");
					return;
				} else if (url == $('#txtUrl').val().trim()) {
					alert("already connected");
				} else {
					$('#btnSend').attr('disabled', 'disabled');
					$('#divConnecting').html("Connecting...");
					$('#btnConnect').attr("disabled","disabled");

					window.conn = $.connection($('#txtUrl').val().trim());
					window.conn.qs = "ak=bY1Oeq3rBLUPpmqX8jKGjJ7gAIYyIIwvyet+nj9/7+c=&e=live";
					window.conn.error = function(err) {
						console.log(err);
						alert("unable to connect");
						$('#btnConnect').removeAttr('disabled');
						$('#divConnecting').html("");
						window.conn = null;
					};
					$(document).ajaxError(function(err, jqXHR, ajaxSettings, thrownError) {
						if(!window.conn)  return;
						console.log(thrownError);
						alert("unable to connect");
						$('#btnConnect').removeAttr('disabled');
						$('#divConnecting').html("");
						window.conn = null;
					});
					window.conn.start().done(function() {
						if(!window.conn)  return;
						console.log("done");
						alert("connected");
						console.log(window.conn);
						$('#btnConnect').attr("disabled","disabled");
						$('#btnSend').removeAttr('disabled');
						$('#divConnecting').html("");
						url = window.conn.url;
					});
				}
			});

			$('#btnSend').click(function() {
				window.conn.error = function(err) {
					console.log(err);
					alert("unable to send data");
				};

				$(document).ajaxError(function(err, jqXHR, ajaxSettings, thrownError) {
					if(!window.conn)  return;
					console.log(thrownError);
					alert("unable to send data");
				});
				if (!window.conn) {
					alert("Connect first");
					return;
				} else {
					var msg = {
						mt : "5",
						et: "ac",
						ot: "profile"
					}
					$('#divConnecting').html(JSON.stringify(msg));
					window.conn.send(msg);
					alert("message send");
				}
			});
		});
	</script>
</body>
</html>